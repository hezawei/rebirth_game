2025-09-14 23:56:48 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-14 23:56:48 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-14 23:56:48 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-14 23:56:48 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-14 23:56:48 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-14 23:56:48 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-14 23:56:50 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-14 23:56:50 | INFO     | backend.main:startup_event:84 - 重生之我是……API服务启动
2025-09-14 23:56:50 | INFO     | backend.main:startup_event:85 - 调试模式: True
2025-09-14 23:56:50 | INFO     | backend.main:startup_event:90 - 当前使用模型: doubao-seed-1.6-flash
2025-09-14 23:56:50 | INFO     | backend.main:startup_event:91 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:05:11 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:05:11 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:05:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:05:11 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:05:11 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:05:11 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:05:13 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:05:13 | INFO     | backend.main:startup_event:84 - 重生之我是……API服务启动
2025-09-15 00:05:13 | INFO     | backend.main:startup_event:85 - 调试模式: True
2025-09-15 00:05:13 | INFO     | backend.main:startup_event:90 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:05:13 | INFO     | backend.main:startup_event:91 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:21:24 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:21:24 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:21:24 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:21:24 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:21:24 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:21:24 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:21:26 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:21:26 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:21:26 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:21:26 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:21:26 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:23:46 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:23:46 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:23:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:23:46 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:23:46 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:23:46 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:23:48 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:23:48 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:23:48 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:23:48 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:23:48 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:24:23 | ERROR    | backend.main:global_exception_handler:73 - 全局异常: (psycopg2.errors.UndefinedColumn) column users.email does not exist
LINE 1: SELECT users.id AS users_id, users.email AS users_email, use...
                                     ^

[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.nickname AS users_nickname, users.age AS users_age, users.identity AS users_identity, users.photo_url AS users_photo_url, users.created_at AS users_created_at 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': '690161230@qq.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-15 00:29:13 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:29:13 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:29:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:29:13 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:29:13 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:29:13 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:29:15 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:29:15 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:29:15 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:29:15 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:29:15 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:39:15 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:39:15 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:39:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:39:15 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:39:15 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:39:15 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:39:15 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:39:15 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:39:15 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:39:15 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:39:15 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:39:28 | ERROR    | backend.main:global_exception_handler:73 - 全局异常: (sqlite3.OperationalError) unknown function: now()
[SQL: INSERT INTO users (id, email, hashed_password, nickname, age, identity, photo_url) VALUES (?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('a6667dbc-2da3-4eb2-8804-480f654d37a9', '690161230@qq.com', '$2b$12$hS/EZzto/YEnz2mqYEnlc.Zlgga5F.Ra95rGi5QoZuBkcU9TdwBvy', '690161230', None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-15 00:42:12 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:42:12 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:42:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:42:12 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:42:12 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:42:12 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:42:12 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:42:12 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:42:12 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:42:12 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:42:12 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:42:20 | INFO     | backend.database.crud:create_user:31 - 创建新用户: 690161230@qq.com
2025-09-15 00:42:30 | INFO     | api.story:start_new_story:39 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 00:42:30 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 00:42:36 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 876
2025-09-15 00:42:36 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "古老的橡木图书馆里，阳光被彩绘玻璃滤成斑斓碎片，落在摊开的《星界图谱》上。莱昂指尖还沾着凝固的金色火焰灰烬，猛地抬头——镜中映出的是十年前的自己，青涩的学徒袍上别着初阶魔法师徽章。三天前，正是此刻，他在导师的注视下强行催动星界能量，导致魔法阵爆炸，右手被灼出狰狞的疤痕，也断送了晋升机会。而现在，导师格雷厄姆正倚着门框，灰眼睛像淬了冰的黑曜石：“莱昂，你的火焰咒文还没背熟，星图推演也错了三处，确定要继续？”羊皮纸卷上的星图在烛光里微微发烫，莱昂知道，这是他重生的第二次机会，也是唯一一次能改写命运的机会。",
  "choices": ["按导师要求停止实验", "偷偷修改关键咒语", "坦白错误寻求帮助"]
}
2025-09-15 00:42:36 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 253
2025-09-15 00:42:36 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 00:42:36 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '古老的橡木图书馆里，阳光被彩绘玻璃滤成斑...' 匹配到图片: magic_forest.jpg
2025-09-15 00:42:36 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-15 00:42:36 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-15 00:42:36 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 00:42:36 | INFO     | api.story:start_new_story:81 - 新故事生成成功
2025-09-15 00:56:09 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:56:09 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:56:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:56:09 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:56:09 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:56:09 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:56:09 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:56:09 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:56:09 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:56:09 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:56:09 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:58:20 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 00:58:20 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:58:20 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 00:58:20 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 00:58:20 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 00:58:20 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 00:58:20 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 00:58:20 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 00:58:20 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 00:58:20 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 00:58:20 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 00:58:31 | INFO     | api.story:start_new_story:39 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 00:58:31 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 00:58:39 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 920
2025-09-15 00:58:39 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "石地冰冷刺骨，凯伦猛地睁开眼，断裂的魔杖硌着掌心。十年前的记忆如潮水涌来——被学徒刺穿胸膛时，那淬毒匕首上的符文还在发光，而他毕生研究的星界罗盘，此刻正被敌人夺走。他挣扎起身，环顾四周，魔法塔的穹顶已塌了一半，烧焦的书架残骸间，竟有几缕熟悉的学徒气息飘来。脚步声越来越近，带着金属碰撞的脆响，他知道，这是他重生的第一天，也是他必须改写命运的时刻。",
  "choices": ["修复断裂魔杖", "启动星界罗盘", "释放火焰屏障"]
}
2025-09-15 00:58:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 173
2025-09-15 00:58:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 00:58:39 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '石地冰冷刺骨，凯伦猛地睁开眼，断裂的魔杖...' 匹配到图片: magic_forest.jpg
2025-09-15 00:58:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-15 00:58:39 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-15 00:58:39 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 00:58:39 | INFO     | api.story:start_new_story:81 - 新故事生成成功
2025-09-15 00:58:51 | INFO     | api.story:continue_existing_story:97 - 收到故事继续请求，选择: 修复断裂魔杖
2025-09-15 00:58:51 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 修复断裂魔杖
2025-09-15 00:58:59 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1119
2025-09-15 00:58:59 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "凯伦指尖抚过魔杖断裂处，焦黑的木茬泛着不祥的暗纹。这是师父留给他的星银木杖，杖身刻满星轨符文，断裂时符文竟发出微弱的哀鸣。他猛地咬破舌尖，殷红的血珠滴在裂缝上，与断裂处渗出的木浆交融。「以我残魂，续你星脉——」咒语在喉间滚过，他从怀中摸出半块嵌着星晶的罗盘碎片（那是他重生后在废墟里找到的），按在杖尾。星晶骤然爆发出刺眼的蓝芒，能量顺着血痕游走，断裂处的焦黑如潮水般退去，星轨符文重新亮起，甚至比从前更亮三分。就在魔杖完全修复的瞬间，「轰隆」一声巨响，厚重的石门被巨力撞开，三个身披黑曜石斗篷的人影踏了进来，为首者手中，赫然握着他那枚完整的星界罗盘，冰冷的目光直刺凯伦。",
  "choices": ["A. 举杖释放星界风暴 B. 利用星轨符文制造幻象 C. 冲向敌人夺回罗盘"]
}
2025-09-15 00:58:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 285
2025-09-15 00:58:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 00:58:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-15 00:58:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-15 00:58:59 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-15 00:58:59 | INFO     | api.story:continue_existing_story:143 - 故事继续生成成功
2025-09-15 01:02:54 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:02:54 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:02:54 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:02:54 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:02:55 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:02:55 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:02:55 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:02:55 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:02:55 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:02:55 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:02:55 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:03:14 | INFO     | api.story:start_new_story:39 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 01:03:14 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 01:03:24 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1014
2025-09-15 01:03:24 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "冰冷的石屑硌着背脊，林越猛地睁开眼。断壁残垣间，月光从穹顶破洞漏下，在他胸口投下菱形光斑——那是“星核印记”，他前世的魔法本源，却在被暗影法师刺穿心脏时碎裂。“快找到‘时光沙漏’！”导师临终的声音还在耳边炸响，而此刻，走廊尽头传来利爪刮擦石板的尖啸，三个黑袍人影正举着骨杖逼近。他挣扎着坐起身，指尖刚触到腰间的空皮袋，就听见为首者冷笑：“重生者？这次你的灵魂，归我们了。”",
  "choices": ["从密道逃向禁书区", "凝聚星核与敌人硬拼", "用灵魂契约召唤守护兽"]
}
2025-09-15 01:03:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 186
2025-09-15 01:03:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 01:03:24 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '冰冷的石屑硌着背脊，林越猛地睁开眼。断壁...' 匹配到图片: magic_forest.jpg
2025-09-15 01:03:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 01:03:24 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 01:03:24 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 01:03:24 | INFO     | api.story:start_new_story:81 - 新故事生成成功
2025-09-15 01:03:36 | INFO     | api.story:continue_existing_story:97 - 收到故事继续请求，选择: 从密道逃向禁书区
2025-09-15 01:03:36 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 从密道逃向禁书区
2025-09-15 01:03:44 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1336
2025-09-15 01:03:44 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "指尖刚触到腰间空皮袋，记忆碎片突然炸开——导师书房暗格里的星核印记，曾在危急时亮起微光，指向走廊东侧那幅‘星图壁画’。林越猛地转身撞向壁画，砖石簌簌剥落，露出黑黢黢的洞口，阴风裹挟着霉味灌出来。他矮身钻进去，密道里满是蛛网和碎石，脚下突然踩空，身体沿着倾斜的石壁滑下，腰间星核印记发烫，竟在黑暗中映出符文——‘星轨机关，引星者开’。身后传来利爪刮地的尖啸，三个黑袍人影已站在壁画前，为首者骨杖一挥，‘找到密道了？’前方豁然开朗，禁书区的鎏金大门近在眼前，却有个身披银甲的身影背对着他，手中长剑泛着幽蓝光芒——是‘守书者’，传说中禁书区的活尸守卫。",
  "choices": ["A. 用星核印记强行破阵", "B. 与守书者虚与委蛇", "C. 转身退回与黑袍人硬拼"]
}
2025-09-15 01:03:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 273
2025-09-15 01:03:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 01:03:44 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-15 01:03:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /rebirth_gate_placeholder.png
2025-09-15 01:03:44 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-15 01:03:44 | INFO     | api.story:continue_existing_story:143 - 故事继续生成成功
2025-09-15 01:03:48 | INFO     | api.story:continue_existing_story:97 - 收到故事继续请求，选择: B. 与守书者虚与委蛇
2025-09-15 01:03:48 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: B. 与守书者虚与委蛇
2025-09-15 01:03:58 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1616
2025-09-15 01:03:58 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "密道尽头豁然开朗，禁书区的鎏金大门在月光下泛着冷辉，守书者银甲上的符文随着沉重的步伐亮起幽蓝微光，长剑拖曳在地，刮出刺耳声响。林越收住脚步，胸口星核印记烫得像团火，他想起导师曾说“星核引星，可破死物”，猛地抬手将印记对准守书者。“我是来取《星轨溯源》的！”他声音发紧却刻意平稳，“导师说它能唤醒被暗影污染的灵魂，守书者大人，放我过去。”守书者没有回头，长剑突然发出一声嗡鸣，幽蓝光芒如毒蛇般扫向林越面门。他狼狈后退，星核印记骤然爆发出耀眼白光，守书者的动作猛地僵住，银甲纹路像活过来般流转，竟缓缓转向他——但就在这时，密道入口传来黑袍人尖利的笑：“别信他！重生者都是骗子！”林越瞳孔骤缩，守书者的动作开始松动，利爪刮地声越来越近，他必须在黑袍人追上来前做出选择。",
  "choices": ["1. 冲向大厅中央的石书架翻找沙漏", "2. 躲进右侧古籍堆，用星核光芒隐藏气息", "3. 抽出腰间断剑，趁守书者僵直时硬闯"]
}
2025-09-15 01:03:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 331
2025-09-15 01:03:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 01:03:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-15 01:03:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 01:03:58 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-15 01:03:58 | INFO     | api.story:continue_existing_story:143 - 故事继续生成成功
2025-09-15 01:13:20 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:13:20 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:13:20 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:13:20 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:14:42 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:14:42 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:14:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:14:42 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:15:50 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:15:50 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:15:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:15:50 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:17:08 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:17:08 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:17:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:17:08 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:17:08 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:17:08 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:17:08 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:17:08 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:17:08 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:17:08 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:17:08 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:17:29 | ERROR    | backend.main:global_exception_handler:73 - 全局异常: 3 validation errors:
  {'type': 'string_type', 'loc': ('response', 0, 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2025, 9, 14, 17, 3, 24)}
  {'type': 'string_type', 'loc': ('response', 1, 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2025, 9, 14, 16, 58, 39)}
  {'type': 'string_type', 'loc': ('response', 2, 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2025, 9, 14, 16, 42, 36)}

2025-09-15 01:19:46 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:19:46 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:19:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:19:46 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:19:46 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:19:46 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:19:46 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:19:46 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:19:46 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:19:46 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:19:46 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:20:10 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 5
2025-09-15 01:20:10 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 5 之后进行时空回溯...
2025-09-15 01:20:10 | INFO     | database.crud:prune_story_after_node:135 - 节点 5 的所有后代节点 [6] 将被删除。
2025-09-15 01:20:10 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-15 01:20:15 | INFO     | api.story:continue_existing_story:98 - 收到故事继续请求，选择: A. 用星核印记强行破阵
2025-09-15 01:20:15 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: A. 用星核印记强行破阵
2025-09-15 01:20:25 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1701
2025-09-15 01:20:25 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "林越咬破舌尖，一口精血喷在胸口的星核印记上。那碎裂的菱形光斑骤然爆发出刺目金光，仿佛沉睡的恒星苏醒——“嗡”的一声，密道两侧的石壁符文全部亮起，与印记共鸣出螺旋状的能量波。守书者猛地转身，银甲下的骨骼发出“咔嗒”脆响，骨杖顶端的骷髅头眼眶燃起幽绿魂火，暗影能量如潮水般涌来。林越双手按在鎏金大门的凹槽上，星核印记的光芒顺着手臂爬满全身，他低吼一声，将所有魔力注入印记：“以我残躯，引星破阵！”金光与暗影在门扉前炸开，守书者被震得后退三步，胸前的符文核心竟寸寸碎裂，鎏金大门“嘎吱”一声向两侧滑开，露出里面悬浮着无数发光典籍的穹顶。而走廊尽头，黑袍人影已举着骨杖逼近，为首者狞笑道：“想跑？”",
  "choices": ["冲进禁书区寻找时光沙漏", "回身对抗守书者与黑袍人", "触发禁书区的终极机关"]
}
2025-09-15 01:20:25 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 295
2025-09-15 01:20:25 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 01:20:25 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-15 01:20:25 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /background1.jpg
2025-09-15 01:20:25 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-15 01:20:25 | INFO     | api.story:continue_existing_story:144 - 故事继续生成成功
2025-09-15 01:39:40 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:39:40 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:39:40 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:39:40 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:39:40 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:39:40 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:39:40 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:39:40 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:39:40 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:39:40 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:39:40 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:42:28 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:42:28 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:42:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:42:28 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:42:29 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:42:29 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:42:29 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:42:29 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:42:29 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:42:29 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:42:29 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:53:12 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:53:12 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:53:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:53:12 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:53:12 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:53:12 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:53:12 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:53:12 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:53:12 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:53:12 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:53:12 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:53:49 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:53:49 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:53:49 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:53:49 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:53:49 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:53:49 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:53:49 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:53:49 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:53:49 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:53:49 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:53:49 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:55:14 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:55:14 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:55:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:55:14 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:55:14 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:55:14 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:55:14 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:55:14 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:55:14 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:55:14 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:55:14 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:56:51 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 01:56:51 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 01:56:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 01:56:51 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 01:56:51 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 01:56:51 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 01:56:51 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 01:56:51 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 01:56:51 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 01:56:51 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 01:56:51 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:00:58 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:00:58 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:00:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:00:58 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:00:58 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:00:58 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:00:58 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:00:58 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:00:58 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:00:58 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:00:58 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:03:59 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:03:59 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:03:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:03:59 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:03:59 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:03:59 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:03:59 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:03:59 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:03:59 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:03:59 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:03:59 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:09:35 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:09:35 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:09:43 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1134
2025-09-15 02:09:43 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "猩红的魔法阵在地面扭曲成焦黑的纹路，空气中还飘着失败咒语残留的硫磺味。林默猛地睁开眼，指尖触到的羊皮纸烫得他一缩——这不是他耗尽最后魔力启动时空回溯时的实验室，而是他少年时住的魔法塔房间。镜中映出张十七岁的脸，青涩却带着与年龄不符的疲惫。三天后就是皇家魔法学院的入学大典，往年此刻他早已能自如操控三级火焰术，可现在，连最基础的火球术都在掌心挣扎成一缕青烟。门外传来脚步声，是负责看守的老管家来送早餐，他必须在大典前掌握至少一种魔法，否则将永远失去成为魔法师的资格。",
  "choices": ["潜入图书馆禁书区", "跪求导师破例指导", "前往黑森林采魔晶"]
}
2025-09-15 02:09:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 232
2025-09-15 02:09:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:09:43 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '猩红的魔法阵在地面扭曲成焦黑的纹路，空气...' 匹配到图片: magic_forest.jpg
2025-09-15 02:09:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:09:43 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 02:09:43 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:09:43 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:13:51 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:13:51 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:13:57 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 867
2025-09-15 02:13:57 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "猩红的魔法阵在石台上滋滋发烫，灰烬从穹顶裂缝漏下来，像凝固的血。林薇猛地睁开眼，指尖还残留着前世被黑魔法吞噬时的灼痛感——上一世，她就是在这里被暗影法师偷袭，没能阻止“虚空裂隙”扩大，导致半个大陆化为焦土。身后传来石门轰然关闭的巨响，她被困在了传说中“永寂之渊”的入口，而三天后，这里将被魔法风暴彻底吞噬。她低头看向胸口，那枚曾被暗影法师夺走的“星核吊坠”正散发着微弱的蓝光，提醒着她重生的机会。",
  "choices": ["启动“星轨罗盘”定位裂隙", "潜入暗影法师据点夺吊坠", "用生命魔法加固结界"]
}
2025-09-15 02:13:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-15 02:13:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:13:57 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '猩红的魔法阵在石台上滋滋发烫，灰烬从穹顶...' 匹配到图片: magic_forest.jpg
2025-09-15 02:13:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:13:57 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 02:13:57 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:13:57 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:14:06 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:14:06 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:14:06 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:14:06 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:14:06 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:14:06 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:14:06 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:14:06 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:14:06 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:14:06 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:14:06 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:16:16 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:16:16 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:16:25 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1032
2025-09-15 02:16:25 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "冰冷的石墙贴着潮湿的苔藓，空气中弥漫着铁锈与龙涎香的诡异混合。瑟兰猛地睁开眼，左臂缠着渗血的绷带，指尖还残留着凝固的黑色血迹——这不是他最后倒在龙穴里的场景。记忆如潮水涌来：三天前，他被最信任的学徒背叛，魔法核心被夺走，坠入深渊。可现在，他竟回到了被背叛的前一夜，壁炉里的火焰还在噼啪作响，桌上摊着未完成的星象图。“吱呀”一声，门外传来沉重的脚步声，金属摩擦地面的刺耳声响正步步逼近。",
  "choices": ["A. 捏碎传送卷轴", "B. 藏起魔法书", "C. 点燃火焰陷阱"]
}
2025-09-15 02:16:25 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 192
2025-09-15 02:16:25 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:16:25 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '冰冷的石墙贴着潮湿的苔藓，空气中弥漫着铁...' 匹配到图片: magic_forest.jpg
2025-09-15 02:16:25 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:16:25 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 02:16:25 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:16:25 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:16:29 | INFO     | api.story:continue_existing_story:98 - 收到故事继续请求，选择: B. 藏起魔法书
2025-09-15 02:16:29 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: B. 藏起魔法书
2025-09-15 02:16:41 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1603
2025-09-15 02:16:41 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "瑟兰的指尖刚触到《星界法典》的羊皮封面，门外传来金属靴钉刮擦石地的声响——凯伦来了。他猛地将法典塞进星象图夹层，用青铜镇纸压住边缘，转身时撞翻了木椅，声响在寂静的石屋里格外刺耳。凯伦站在门口，麦饼碎屑沾在嘴角，灰眸像两潭深不见底的冰：“先生，您在发抖。” 瑟兰强扯出笑，指尖却掐进掌心：“夜里风大，有些着凉。” 凯伦缓步走近，目光扫过他左臂——那道未来会渗血的绷带此刻光洁如新，他忽然抬手，指尖擦过瑟兰的肩：“是在担心星轨吗？听说北方星象异动，您上周还彻夜未眠。” 瑟兰的呼吸一滞，镇纸下的法典正微微发烫，仿佛在嘲笑他的徒劳。",
  "choices": ["A. 扑向星象图，假装整理纸张", "B. 突然按住凯伦手腕，质问他为何深夜来访", "C. 转身去添柴，避开他的目光"]
}
2025-09-15 02:16:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 263
2025-09-15 02:16:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:16:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-15 02:16:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /rebirth_gate_placeholder.png
2025-09-15 02:16:41 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-15 02:16:41 | INFO     | api.story:continue_existing_story:144 - 故事继续生成成功
2025-09-15 02:17:04 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 10
2025-09-15 02:17:04 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 10 之后进行时空回溯...
2025-09-15 02:17:04 | INFO     | database.crud:prune_story_after_node:142 - 节点 10 没有后代，无需删除。
2025-09-15 02:17:04 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 10。
2025-09-15 02:24:04 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 一个随机的冒险者
2025-09-15 02:24:04 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '一个随机的冒险者'
2025-09-15 02:24:12 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1139
2025-09-15 02:24:12 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "残阳把战场染成血红色，断剑斜插在碎石堆里，剑柄上还沾着暗红的血渍。林野猛地睁开眼，头痛欲裂，陌生的记忆碎片涌进来——他好像刚从一场厮杀里爬出来，又好像……根本不是他的记忆。“嗬……嗬……”粗重的喘息声从左后方传来，他僵硬地转头，看见半截被砍断的手臂搭在断墙边缘，腐烂的手指还在微微抽搐。远处，马蹄声像闷雷滚过，夹杂着“抓住他”的嘶吼，至少三个骑士正朝这边冲来。他低头看了看自己，穿着破烂的皮甲，腰间挂着个空钱袋，脚边的水壶早就空了。残剑在晨光里泛着冷光，他握紧剑柄，指节泛白——跑？还是……",
  "choices": ["躲进断墙后", "举剑冲过去", "往森林方向逃"]
}
2025-09-15 02:24:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 245
2025-09-15 02:24:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:24:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-15 02:24:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /cyberpunk_city.jpg
2025-09-15 02:24:12 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /cyberpunk_city.jpg
2025-09-15 02:24:12 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:24:12 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:30:58 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:30:58 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:30:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:30:58 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:30:58 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:30:58 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:30:58 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:30:58 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:30:58 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:30:58 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:30:58 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:31:46 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:31:46 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:31:56 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1093
2025-09-15 02:31:56 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "石砌的魔法塔尖刺破铅灰色云层，冰冷的石地贴着后背，破碎的水晶球在脚边闪着幽蓝微光。指尖还残留着黑魔法灼烧的刺痛——他记得导师转身时嘴角那抹淬毒的笑，记得自己拼尽最后魔力设下的屏障如何寸寸碎裂。猛地睁眼，雕花橡木床顶悬着的星芒灯晃得人眼晕。他下意识摸向胸口，那枚刻着导师家族纹章的银质徽章还在，温热的触感像烙铁烫进皮肤。十年前的入学礼，他本该在礼堂接受分院帽的选择，可现在……窗外传来熟悉的脚步声，是导师带着新生们来参观禁书区的声音。这一次，他绝不会让那只披着人皮的毒蛇再靠近自己半步。",
  "choices": ["堵门阻止导师入内", "速去禁书区设结界", "向院长揭发导师阴谋"]
}
2025-09-15 02:31:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 242
2025-09-15 02:31:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:31:56 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '石砌的魔法塔尖刺破铅灰色云层，冰冷的石地...' 匹配到图片: magic_forest.jpg
2025-09-15 02:31:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:31:56 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 02:31:56 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:31:56 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:32:02 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 12
2025-09-15 02:32:02 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 12 之后进行时空回溯...
2025-09-15 02:32:02 | INFO     | database.crud:prune_story_after_node:142 - 节点 12 没有后代，无需删除。
2025-09-15 02:32:02 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 12。
2025-09-15 02:32:06 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 9
2025-09-15 02:32:06 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 9 之后进行时空回溯...
2025-09-15 02:32:06 | INFO     | database.crud:prune_story_after_node:135 - 节点 9 的所有后代节点 [10] 将被删除。
2025-09-15 02:32:06 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-15 02:32:13 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 5
2025-09-15 02:32:13 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 5 之后进行时空回溯...
2025-09-15 02:32:13 | INFO     | database.crud:prune_story_after_node:135 - 节点 5 的所有后代节点 [6] 将被删除。
2025-09-15 02:32:13 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-15 02:37:19 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:37:19 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:37:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:37:19 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:37:19 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:37:19 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:37:19 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:37:19 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:37:19 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:37:19 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:37:19 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:39:05 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:39:05 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:39:05 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:39:05 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:39:05 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:39:05 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:39:05 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:39:05 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:39:05 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:39:05 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:39:05 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:42:07 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:42:07 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:42:15 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1090
2025-09-15 02:42:15 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "月光从彩绘玻璃窗漏进塔楼，莉娜猛地坐起，指尖还残留着爆炸的焦痕。她盯着掌心——这不是她最后一次施法时的样子！十年前，她为保护魔法学院，引爆了自己的魔杖，却被诬陷为叛徒，连灵魂都被封印在黑曜石里。而现在，她回到了十五岁，正是“挚友”凯尔偷换她的魔药，让她在新生大典上当众出丑的那天。“莉娜，准备好了吗？”楼下传来凯尔的声音，带着刻意的温柔。她望向窗外，晨光中，学院广场上，新生们正期待地望着塔楼。今天，她必须阻止这一切。",
  "choices": ["假装生病躲起来", "直接冲下楼质问", "先去检查魔药瓶"]
}
2025-09-15 02:42:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 209
2025-09-15 02:42:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:42:15 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '月光从彩绘玻璃窗漏进塔楼，莉娜猛地坐起，...' 匹配到图片: magic_forest.jpg
2025-09-15 02:42:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:42:15 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 02:42:15 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:42:15 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:42:22 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 13
2025-09-15 02:42:22 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 13 之后进行时空回溯...
2025-09-15 02:42:22 | INFO     | database.crud:prune_story_after_node:142 - 节点 13 没有后代，无需删除。
2025-09-15 02:42:22 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 13。
2025-09-15 02:42:24 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 12
2025-09-15 02:42:24 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 12 之后进行时空回溯...
2025-09-15 02:42:24 | INFO     | database.crud:prune_story_after_node:142 - 节点 12 没有后代，无需删除。
2025-09-15 02:42:24 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 12。
2025-09-15 02:42:29 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 11
2025-09-15 02:42:29 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 11 之后进行时空回溯...
2025-09-15 02:42:29 | INFO     | database.crud:prune_story_after_node:142 - 节点 11 没有后代，无需删除。
2025-09-15 02:42:29 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 11。
2025-09-15 02:42:31 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 13
2025-09-15 02:42:31 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 13 之后进行时空回溯...
2025-09-15 02:42:31 | INFO     | database.crud:prune_story_after_node:142 - 节点 13 没有后代，无需删除。
2025-09-15 02:42:31 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 13。
2025-09-15 02:42:34 | INFO     | api.story:continue_existing_story:98 - 收到故事继续请求，选择: 直接冲下楼质问
2025-09-15 02:42:34 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 直接冲下楼质问
2025-09-15 02:42:45 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1643
2025-09-15 02:42:45 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "莉娜抓起塔楼栏杆，裙摆扫过石级，发出急促的声响。楼下传来的“温柔”男声还未消散，她已如离弦之箭冲下旋转梯。橡木大门“砰”地被推开，凯尔正站在广场边缘，手里捏着一个贴着标签的水晶瓶，阳光在他发梢镀上金边，笑容恰到好处。“莉娜？你怎么……”他话未说完，莉娜已冲到他面前，掌心焦痕在晨光里泛着诡异的红，“这瓶魔药，是你换的。”凯尔瞳孔微缩，随即又漾起无辜的笑：“你在说什么？新生大典的魔药不是我帮你拿的吗？”“帮我拿的？”莉娜冷笑，指尖魔力微动，空气中瞬间弥漫开熟悉的苦杏仁味——那是她本该喝下的、会让她全身麻痹的“昏睡魔药”，此刻却在凯尔的水晶瓶里。“你敢说，这瓶里没有加‘忘忧草粉’？”周围的新生开始窃窃私语，目光在两人之间游移。凯尔的笑容僵住，喉结滚动了一下：“莉娜，别闹了，你是不是没休息好？”莉娜猛地抬手，将水晶瓶从他手中夺过，瓶身碎裂，淡紫色粉末撒了一地。“闹？”她声音发颤，却字字清晰，“十年前，我为保护学院引爆魔杖，你说我是叛徒；十年后，你又想让我在所有人面前出丑！凯尔，你到底想干什么？！”凯尔脸色骤变，眼中闪过一丝慌乱，随即被阴鸷取代：“你……你怎么知道……”莉娜的心沉了下去——他果然和当年的事有关！",
  "choices": ["当众揭穿凯尔的阴谋，拿出更多证据", "暂时隐忍，假装被说服，寻找机会反击", "立刻冲向学院长老会，寻求他们的帮助"]
}
2025-09-15 02:42:45 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 508
2025-09-15 02:42:45 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:42:45 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-15 02:42:45 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:42:45 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-15 02:42:45 | INFO     | api.story:continue_existing_story:144 - 故事继续生成成功
2025-09-15 02:42:48 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 14
2025-09-15 02:42:48 | INFO     | database.crud:prune_story_after_node:124 - 正在从节点 14 之后进行时空回溯...
2025-09-15 02:42:48 | INFO     | database.crud:prune_story_after_node:142 - 节点 14 没有后代，无需删除。
2025-09-15 02:42:48 | INFO     | database.crud:prune_story_after_node:149 - 已成功完成回溯，当前故事线的终点为节点 14。
2025-09-15 02:46:43 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:46:43 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:46:43 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:46:43 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:46:43 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:46:43 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:46:43 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:46:43 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:46:43 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:46:43 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:46:43 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:56:16 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 02:56:16 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:56:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 02:56:16 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 02:56:16 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 02:56:16 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 02:56:16 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 02:56:16 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 02:56:16 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 02:56:16 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 02:56:16 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 02:57:13 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:57:13 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:57:20 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 860
2025-09-15 02:57:20 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "石砌教室的穹顶漏下几缕金阳，在石桌上投下彩绘玻璃的斑斓光斑。空气中飘着硫磺与薄荷的混合气味，阿明猛地睁开眼，头痛欲裂——他不是该在禁林里被摄魂怪啃噬灵魂吗？指尖触到冰凉的坩埚边缘，旁边摊开的魔药课本上，17岁的字迹歪歪扭扭。讲台上，斯内普教授的黑袍扫过地面，发出沙沙声响，他正盯着第三排那个熟悉的背影——前世就是这个时候，自己手忙脚乱地把狼毒药剂熬成了黏糊糊的黑泥，被教授罚站到黄昏，还害得莉莉为他顶了错。坩埚里的液体正咕嘟冒泡，阿明的心跳得像擂鼓，他该怎么办？",
  "choices": ["背诵正确魔药步骤", "假装魔药已成功", "向莉莉求助"]
}
2025-09-15 02:57:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 231
2025-09-15 02:57:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:57:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-15 02:57:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /background1.jpg
2025-09-15 02:57:20 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /background1.jpg
2025-09-15 02:57:20 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:57:20 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 02:57:36 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 02:57:36 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 02:57:44 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1012
2025-09-15 02:57:44 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "月光从破碎的穹顶漏进来，灰尘在光柱里翻滚。林薇猛地睁开眼，指尖残留着烧焦的痛感——三天前，她就是在这里，为了挽救濒死的导师，强行催动禁忌魔法“时间回溯”，结果沙漏炸裂，整个学院被卷入时空乱流，导师和她自己都化为飞灰。可现在，沙漏静静地躺在石桌上，里面的沙正以诡异的速度倒流，而门外传来了导师沉稳的脚步声，他说过明天要带她去参加“星轨试炼”。林薇的心脏狂跳，她知道，这是重来一次的机会，也是最后的机会。",
  "choices": ["打开沙漏确认时间", "向导师坦白禁忌", "立刻逃离禁地"]
}
2025-09-15 02:57:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 200
2025-09-15 02:57:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 02:57:44 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '月光从破碎的穹顶漏进来，灰尘在光柱里翻滚...' 匹配到图片: magic_forest.jpg
2025-09-15 02:57:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 02:57:44 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 02:57:44 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 02:57:44 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 03:00:12 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:00:12 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:00:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:00:12 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:00:12 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:00:12 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:00:12 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:00:12 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:00:12 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:00:12 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:00:12 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:02:29 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:02:29 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:02:29 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:02:29 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:02:29 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:02:29 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:02:29 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:02:29 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:02:29 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:02:29 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:02:29 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:05:00 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:05:00 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:05:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:05:00 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:05:00 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:05:00 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:05:00 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:05:00 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:05:00 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:05:00 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:05:00 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:09:29 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:09:29 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:09:29 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:09:29 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:09:29 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:09:29 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:09:29 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:09:29 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:09:29 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:09:29 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:09:29 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:13:57 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:13:57 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:13:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:13:57 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:13:57 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:13:57 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:13:57 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:13:57 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:13:57 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:13:57 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:13:57 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:15:04 | INFO     | api.story:start_new_story:40 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-15 03:15:04 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 03:15:16 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 1394
2025-09-15 03:15:16 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "碎石堆里渗出幽蓝磷火，林薇猛地呛咳着坐起身。胸口的灼痛感还在尖叫——那是“暗影吞噬”的诅咒，三天前她就是在这里被黑魔法师撕碎灵魂的。可现在，指尖竟凝起一缕温暖的光，像濒死蝴蝶扑闪着翅膀。突然，身后传来锁链拖曳的声响。她僵硬转头，看见三个黑袍人举着骨杖走来，兜帽下的眼睛闪着猩红。“找到他了，”为首的人低笑，“这具身体，正好给暗影大人当容器。”林薇的手在颤抖，不是因为恐惧，而是因为脑海里突然涌入的记忆——这具身体，曾是“星陨学院”最年轻的元素导师，而那三个黑袍人，正是覆灭学院的“影刃教派”。她摸向胸口，那里藏着半块破碎的星石，是她重生的关键。",
  "choices": ["A. 捏碎星石强行传送", "B. 凝聚元素力正面迎敌", "C. 躲进碎石堆伪装气息"]
}
2025-09-15 03:15:16 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 272
2025-09-15 03:15:16 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 03:15:16 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '碎石堆里渗出幽蓝磷火，林薇猛地呛咳着坐起...' 匹配到图片: magic_forest.jpg
2025-09-15 03:15:16 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 03:15:16 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 03:15:16 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 03:15:16 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 03:15:25 | INFO     | backend.database.crud:create_user:31 - 创建新用户: 2930922@qq.com
2025-09-15 03:18:31 | INFO     | api.story:start_new_story:40 - 用户 7e66d85a-576d-436a-beb9-707a6da90402 收到新故事请求，愿望: 超人
2025-09-15 03:18:31 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '超人'
2025-09-15 03:18:37 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 745
2025-09-15 03:18:37 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "宇宙的黑暗像冰冷的潮水包裹着他，氪星的碎片在眼前炸开成血色星云。克拉克·肯特感觉自己的意识像风中残烛，身体却奇异地充满了撕裂般的力量——那是他熟悉的、属于超人的力量，正从骨髓里疯狂涌出。但这股力量带着灼烧感，他低头看见胸口的S标志正发出刺目的红光，而远处，一艘巨大的机械战舰正缓缓逼近，舰身上闪烁着布莱尼亚克的标志，它的引力光束已经锁定了他坠落的轨迹。",
  "choices": ["全力冲向战舰", "修复逃生舱", "向地球发信号"]
}
2025-09-15 03:18:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 176
2025-09-15 03:18:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 03:18:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-15 03:18:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /rebirth_gate_placeholder.png
2025-09-15 03:18:37 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /rebirth_gate_placeholder.png
2025-09-15 03:18:37 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 03:18:37 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 03:18:56 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:18:56 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:18:56 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:18:56 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:18:56 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:18:56 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:18:56 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:18:56 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:18:56 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:18:56 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:18:56 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:19:41 | INFO     | api.story:start_new_story:40 - 用户 7e66d85a-576d-436a-beb9-707a6da90402 收到新故事请求，愿望: 迪迦奥特曼
2025-09-15 03:19:41 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '迪迦奥特曼'
2025-09-15 03:19:50 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1.6-flash, tokens使用: 866
2025-09-15 03:19:50 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "生锈的旋转木马在月光下泛着冷光，小翼攥着褪色的照片蹲在废弃游乐园的摩天轮下。照片上穿校服的女孩笑靥如花，是三天前在这里失踪的同班同学。突然，地面震颤，黑雾从摩天轮齿轮间涌出，一个遮天蔽日的阴影压下来——那是加坦杰厄的触手！他想跑，身体却像被钉在原地，心脏狂跳时，掌心竟亮起微弱的蓝光。下一秒，天旋地转，耳边传来熟悉的机械音效，他猛地睁开眼，发现自己坐在十年前的课桌前，黑板上写着“迪迦奥特曼”的简笔画，而窗外，正是2000年的东京夜空。",
  "choices": ["冲去仓库找神光棒", "去操场等居间惠队长", "先找失踪的同班同学"]
}
2025-09-15 03:19:50 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 218
2025-09-15 03:19:50 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 03:19:50 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-15 03:19:50 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /space_station.jpg
2025-09-15 03:19:50 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /space_station.jpg
2025-09-15 03:19:50 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 03:19:50 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 03:25:33 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 03:25:33 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 03:25:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 03:25:33 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 03:25:33 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 03:25:33 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 03:25:33 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 03:25:33 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 03:25:33 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 03:25:33 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 03:25:33 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 06:19:51 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1.6-flash
2025-09-15 06:19:51 | INFO     | core.llm_clients:__init__:37 - API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 06:19:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 06:19:51 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 06:19:51 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 06:19:51 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 06:19:51 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 06:19:51 | INFO     | backend.main:startup_event:85 - 重生之我是……API服务启动
2025-09-15 06:19:51 | INFO     | backend.main:startup_event:86 - 调试模式: True
2025-09-15 06:19:51 | INFO     | backend.main:startup_event:91 - 当前使用模型: doubao-seed-1.6-flash
2025-09-15 06:19:51 | INFO     | backend.main:startup_event:92 - 模型API地址: https://ai-hub.xiaopeng.com/api/v1
2025-09-15 13:47:13 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-15 13:47:13 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-15 13:47:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 13:47:13 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 13:47:13 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 13:47:13 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 13:47:13 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 13:47:13 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-15 13:47:13 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-15 13:47:13 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-15 13:47:13 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-15 13:50:45 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-15 13:50:45 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-15 13:50:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 13:50:45 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 13:50:46 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 13:50:46 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 13:50:46 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 13:50:46 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-15 13:50:46 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-15 13:50:46 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-15 13:50:46 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-15 13:51:17 | INFO     | api.story:start_new_story:40 - 用户 7e66d85a-576d-436a-beb9-707a6da90402 收到新故事请求，愿望: 魔法师
2025-09-15 13:51:17 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-15 13:51:33 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1230
2025-09-15 13:51:33 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "星陨图书馆的穹顶正漏下碎金般的月光，我蜷缩在古籍堆里，指尖触到的羊皮纸还带着前世被魔火吞噬的焦糊味。额头的灼痛突然炸开——三天前我本该在星界共鸣仪式上被暗魔法撕碎，现在却回到了仪式开始前的三个时辰。书架顶端垂落的幽蓝藤蔓突然剧烈震颤，将星图典籍缠绕成发光的茧，而我胸口的魔法徽章正疯狂发烫，那是前世导致我失败的罪魁祸首——被我误触的魔纹阵眼正在发烫，黑色符文像蛛网般爬满墙壁。仪式的倒计时钟声已在脑海中敲响，我必须在藤蔓彻底封锁出口前，做出选择。",
  "choices": ["修复发烫的魔纹阵眼", "用空间魔法撕裂藤蔓", "唤醒沉睡的导师之灵"]
}
2025-09-15 13:51:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 223
2025-09-15 13:51:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 13:51:33 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '星陨图书馆的穹顶正漏下碎金般的月光，我蜷...' 匹配到图片: magic_forest.jpg
2025-09-15 13:51:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /magic_forest.jpg
2025-09-15 13:51:33 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /magic_forest.jpg
2025-09-15 13:51:33 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 13:51:33 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 13:51:59 | INFO     | api.story:start_new_story:40 - 用户 7e66d85a-576d-436a-beb9-707a6da90402 收到新故事请求，愿望: 迪迦
2025-09-15 13:51:59 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '迪迦'
2025-09-15 13:52:15 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1948
2025-09-15 13:52:15 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "暴雨如注的夜晚，城市第七区的霓虹在积水里碎成一片血色。我蜷缩在便利店冰柜旁，心脏像被迪迦计时器的红光烫过——喉咙里还残留着变身器的金属味。不是梦。左手腕上，那枚本该在2000年消失的神光棒正发烫，玻璃门外，哥尔赞的巨爪撕开了‘胜利队’大楼的残骸，远处传来人类军队的防空警报，而我口袋里，还有三瓶没开封的电解质水。迪迦的彩色计时器正疯狂闪烁，巨人的左臂已经被哥尔赞的獠牙咬断，而我知道，下一秒，人类最后的希望就会被这头怪兽碾碎。",
  "choices": ["举棒变身迪迦", "躲进建筑找掩体", "回便利店拿能量水"]
}
2025-09-15 13:52:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 213
2025-09-15 13:52:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 13:52:15 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '暴雨如注的夜晚，城市第七区的霓虹在积水里...' 匹配到图片: cyberpunk_city.jpg
2025-09-15 13:52:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /cyberpunk_city.jpg
2025-09-15 13:52:15 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /cyberpunk_city.jpg
2025-09-15 13:52:15 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 13:52:15 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 13:52:22 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 19
2025-09-15 13:52:22 | INFO     | database.crud:prune_story_after_node:138 - 正在从节点 19 之后进行时空回溯...
2025-09-15 13:52:22 | INFO     | database.crud:prune_story_after_node:156 - 节点 19 没有后代，无需删除。
2025-09-15 13:52:22 | INFO     | database.crud:prune_story_after_node:163 - 已成功完成回溯，当前故事线的终点为节点 19。
2025-09-15 13:57:19 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-15 13:57:19 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-15 13:57:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-15 13:57:19 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-15 13:57:19 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-15 13:57:19 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-15 13:57:19 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-15 13:57:19 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-15 13:57:19 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-15 13:57:19 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-15 13:57:19 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-15 13:57:51 | INFO     | api.story:start_new_story:40 - 用户 7e66d85a-576d-436a-beb9-707a6da90402 收到新故事请求，愿望: 迪迦
2025-09-15 13:57:51 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '迪迦'
2025-09-15 13:58:04 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1440
2025-09-15 13:58:04 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "生锈的铁秋千在夜风里吱呀摇晃，手腕上的奥特曼手表烫得像块烙铁。我猛地坐起，发现自己穿着洗得发白的校服，书包里露出半截《迪迦完全指南》——封面上的迪迦正举着哉佩利敖光线，而窗外传来的不是蝉鸣，是哥尔赞的咆哮。远处居民楼的玻璃像饼干般碎裂，暗红的光映在我颤抖的手背上。记忆突然炸开：1998年那个雷雨夜，我躲在被子里哭，电视里迪迦刚变成石像，而现在，怪兽的爪子正扒拉着操场铁栅栏。"
  ,
  "choices": ["捡起石子砸向怪兽", "冲回家找爸爸的光棒", "翻开指南念变身台词"]
}
2025-09-15 13:58:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 188
2025-09-15 13:58:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-15 13:58:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-15 13:58:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /space_station.jpg
2025-09-15 13:58:04 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /space_station.jpg
2025-09-15 13:58:04 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-15 13:58:04 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-15 13:58:19 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 21
2025-09-15 13:58:19 | INFO     | database.crud:prune_story_after_node:138 - 正在从节点 21 之后进行时空回溯...
2025-09-15 13:58:19 | INFO     | database.crud:prune_story_after_node:156 - 节点 21 没有后代，无需删除。
2025-09-15 13:58:19 | INFO     | database.crud:prune_story_after_node:163 - 已成功完成回溯，当前故事线的终点为节点 21。
2025-09-15 13:58:24 | INFO     | api.story:retry_from_node:161 - 收到时空回溯请求，目标节点: 20
2025-09-15 13:58:24 | INFO     | database.crud:prune_story_after_node:138 - 正在从节点 20 之后进行时空回溯...
2025-09-15 13:58:24 | INFO     | database.crud:prune_story_after_node:156 - 节点 20 没有后代，无需删除。
2025-09-15 13:58:24 | INFO     | database.crud:prune_story_after_node:163 - 已成功完成回溯，当前故事线的终点为节点 20。
2025-09-20 13:42:02 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-20 13:42:02 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-20 13:42:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-20 13:42:02 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-20 13:42:02 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: c:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-20 13:42:02 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-20 13:42:02 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-20 13:42:02 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-20 13:42:02 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-20 13:42:02 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-20 13:42:02 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-20 17:30:17 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-20 17:30:17 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-20 17:30:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-20 17:30:17 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-20 17:30:18 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-20 17:30:18 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-20 17:30:18 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-20 17:30:18 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-20 17:30:18 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-20 17:30:18 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-20 17:30:18 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 15:45:00 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 15:45:00 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 15:45:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 15:45:00 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 15:45:01 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 15:45:01 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 15:45:01 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 15:45:01 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 15:45:01 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 15:45:01 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 15:45:01 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 15:45:44 | INFO     | backend.database.crud:create_user:31 - 创建新用户: 379902501@qq.com
2025-09-21 15:46:25 | INFO     | backend.database.crud:create_user:31 - 创建新用户: test1@qq.com
2025-09-21 15:56:38 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 15:56:38 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 15:56:38 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 15:56:38 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 15:56:38 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 15:56:38 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 15:56:38 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 15:56:38 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 15:56:38 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 15:56:38 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 15:56:38 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:11:02 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:11:03 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:11:03 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:11:03 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:11:03 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:11:03 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:11:03 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 16:11:03 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 16:11:03 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:11:03 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:11:03 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:11:03 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:11:05 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:11:07 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:11:07 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:11:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:11:07 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:11:07 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:11:07 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 16:11:07 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 16:11:07 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:11:07 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:11:07 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:11:07 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:11:19 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:11:22 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:11:22 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:11:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:11:22 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:11:22 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:11:22 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 16:11:22 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 16:11:22 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:11:22 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:11:22 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:11:22 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:12:22 | INFO     | api.story:start_new_story:40 - 用户 755f3235-de6e-4882-9aaa-a67ced4b9a9e 收到新故事请求，愿望: 项羽
2025-09-21 16:12:22 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-21 16:12:39 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1618
2025-09-21 16:12:39 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "寒夜垓下，楚歌如鬼哭漫过营帐。项羽猛地坐起，肋下箭伤仍在渗血，虞姬正用颤抖的手替他缠裹。‘大王……’她声音哽咽，帐外‘楚地已失’的呼喊像毒蛇缠颈。他攥紧腰间霸王枪，指节泛白——昨夜乌江亭长的船明明近在眼前，此刻却躺在熟悉的军帐里，帐外八千子弟兵只剩最后喘息。虞姬发丝垂落肩头，带着冷香，楚歌里混着故乡乡音，是汉军的诱敌之计。他该信谁？是重蹈鸿门宴的犹豫，还是……项羽目光扫过帐外火把，汉军马蹄声已震得地动山摇。",
  "choices": ["A. 率八百骑破阵突围", "B. 帐内安抚军心", "C. 传霸王令死战"]
}
2025-09-21 16:12:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 205
2025-09-21 16:12:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 16:12:39 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-21 16:12:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-21 16:12:39 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/background1.jpg
2025-09-21 16:12:39 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 16:12:39 | INFO     | api.story:start_new_story:82 - 新故事生成成功
2025-09-21 16:27:11 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:27:14 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:27:14 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:27:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:27:14 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:27:14 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:27:14 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 16:27:14 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 16:27:14 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:27:14 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:27:14 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:27:14 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:32:56 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:32:58 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:32:58 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:32:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:32:58 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:32:58 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:32:58 | INFO     | database.base:init_db:35 - 正在初始化数据库...
2025-09-21 16:32:58 | INFO     | database.base:init_db:37 - 数据库初始化成功，所有表已创建。
2025-09-21 16:32:58 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:32:58 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:32:58 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:32:58 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:34:44 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:34:45 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:34:45 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:34:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:34:45 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:34:46 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:34:46 | INFO     | database.base:init_db:43 - 正在初始化数据库...
2025-09-21 16:34:46 | INFO     | database.base:init_db:45 - 数据库初始化成功，所有表已创建。
2025-09-21 16:34:46 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:34:46 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:34:46 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:34:46 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:36:38 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:36:40 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:36:40 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:36:40 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:36:40 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:36:40 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:36:40 | INFO     | database.base:init_db:43 - 正在初始化数据库...
2025-09-21 16:36:40 | INFO     | database.base:init_db:45 - 数据库初始化成功，所有表已创建。
2025-09-21 16:36:40 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:36:40 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:36:40 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:36:40 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:38:09 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:38:11 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:38:11 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:38:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:38:11 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:38:11 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:38:11 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:38:11 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:38:11 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:38:11 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:38:11 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:38:11 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:38:50 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:38:51 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:38:51 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:38:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:38:51 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:38:52 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:38:52 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:38:52 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:38:52 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:38:52 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:38:52 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:38:52 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:39:26 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:39:28 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:39:28 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:39:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:39:28 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:39:28 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:39:28 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:39:28 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:39:28 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:39:28 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:39:28 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:39:28 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:39:58 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:39:59 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:39:59 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:39:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:39:59 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:40:00 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:40:00 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:40:00 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:40:00 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:40:00 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:40:00 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:40:00 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:40:36 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:40:38 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:40:38 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:40:38 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:40:38 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:40:38 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:40:38 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:40:38 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:40:38 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:40:38 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:40:38 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:40:38 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:41:21 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:41:23 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:41:23 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:41:23 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:41:23 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:41:23 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:41:23 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:41:23 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:41:23 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:41:23 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:41:23 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:41:23 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:42:12 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:42:13 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:42:13 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:42:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:42:14 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:42:14 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:42:14 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:42:14 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:42:14 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:42:14 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:42:14 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:42:14 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:45:12 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:45:14 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:45:14 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:45:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:45:14 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:45:14 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:45:14 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:45:14 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:45:14 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:45:14 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:45:14 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:45:14 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:48:09 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:48:11 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:48:11 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:48:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:48:11 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:48:11 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:48:11 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:48:11 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:48:11 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:48:11 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:48:11 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:48:11 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:48:55 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:48:56 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:48:56 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:48:56 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:48:56 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:48:57 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:48:57 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:48:57 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:48:57 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:48:57 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:48:57 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:48:57 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:50:38 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 16:50:39 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 16:50:39 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 16:50:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 16:50:39 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 16:50:39 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 16:50:39 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 16:50:39 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 16:50:39 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 16:50:39 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 16:50:39 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 16:50:39 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:04:17 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:04:18 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:04:18 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:04:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:04:18 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:04:18 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:04:18 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:04:18 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:04:18 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:04:18 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:04:18 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:04:18 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:05:17 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:05:19 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:05:19 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:05:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:05:19 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:05:19 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:05:19 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:05:19 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:05:19 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:05:19 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:05:19 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:05:19 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:09:35 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:09:41 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:09:41 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:09:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:09:41 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:09:41 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:09:41 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:09:41 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:09:41 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:09:41 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:09:41 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:09:41 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:26:21 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:26:22 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:26:22 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:26:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:26:22 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:26:22 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:26:22 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:26:22 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:26:22 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:26:22 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:26:22 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:26:22 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:27:36 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:27:38 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:27:38 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:27:38 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:27:38 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:27:38 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:27:38 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:27:38 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:27:38 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:27:38 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:27:38 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:27:38 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:28:57 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:28:59 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:28:59 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:28:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:28:59 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:28:59 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:28:59 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:28:59 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:28:59 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:28:59 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:28:59 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:28:59 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:29:56 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:29:58 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:29:58 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:29:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:29:58 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:29:58 | INFO     | backend.main:<module>:49 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:29:58 | INFO     | database.base:init_db:55 - 正在初始化数据库...
2025-09-21 17:29:58 | INFO     | database.base:init_db:57 - 数据库初始化成功，所有表已创建。
2025-09-21 17:29:58 | INFO     | backend.main:startup_event:92 - 重生之我是……API服务启动
2025-09-21 17:29:58 | INFO     | backend.main:startup_event:93 - 调试模式: True
2025-09-21 17:29:58 | INFO     | backend.main:startup_event:98 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:29:58 | INFO     | backend.main:startup_event:99 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:34:55 | INFO     | backend.main:shutdown_event:105 - 重生之我是……API服务关闭
2025-09-21 17:34:57 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:34:57 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:34:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:34:57 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:34:57 | INFO     | backend.main:<module>:52 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:34:57 | INFO     | backend.main:_run_alembic_cmd:91 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 17:34:58 | INFO     | backend.main:_run_alembic_cmd:93 - Alembic migration complete.
2025-09-21 17:34:58 | INFO     | backend.main:startup_event:104 - 重生之我是……API服务启动
2025-09-21 17:34:58 | INFO     | backend.main:startup_event:105 - 调试模式: True
2025-09-21 17:34:58 | INFO     | backend.main:startup_event:110 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:34:58 | INFO     | backend.main:startup_event:111 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:37:15 | INFO     | backend.main:shutdown_event:117 - 重生之我是……API服务关闭
2025-09-21 17:37:18 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:37:18 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:37:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:37:18 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:37:18 | INFO     | backend.main:<module>:52 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:37:18 | INFO     | backend.main:_run_alembic_cmd:91 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 17:37:19 | INFO     | backend.main:_run_alembic_cmd:93 - Alembic migration complete.
2025-09-21 17:37:19 | INFO     | backend.main:startup_event:104 - 重生之我是……API服务启动
2025-09-21 17:37:19 | INFO     | backend.main:startup_event:105 - 调试模式: True
2025-09-21 17:37:19 | INFO     | backend.main:startup_event:110 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:37:19 | INFO     | backend.main:startup_event:111 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:59:44 | INFO     | backend.main:shutdown_event:117 - 重生之我是……API服务关闭
2025-09-21 17:59:50 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 17:59:50 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 17:59:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 17:59:50 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 17:59:50 | INFO     | backend.main:<module>:52 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 17:59:50 | INFO     | backend.main:_run_alembic_cmd:91 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 17:59:51 | INFO     | backend.main:_run_alembic_cmd:93 - Alembic migration complete.
2025-09-21 17:59:51 | INFO     | backend.main:startup_event:104 - 重生之我是……API服务启动
2025-09-21 17:59:51 | INFO     | backend.main:startup_event:105 - 调试模式: True
2025-09-21 17:59:51 | INFO     | backend.main:startup_event:110 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 17:59:51 | INFO     | backend.main:startup_event:111 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 18:01:11 | INFO     | api.story:start_new_story:41 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-21 18:01:11 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-21 18:01:26 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1362
2025-09-21 18:01:26 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "冰冷的石墙沁着寒气，潮湿的铁锈味钻进鼻腔。林默猛地睁开眼，铁栅栏外月光碎成银箔，映着审判官猩红的法袍——他回来了，回到了被诬陷为黑魔法师的那个雪夜。喉咙里卡着焦糊的记忆碎片：上一世，他就是在这囚牢里被‘净化之火’烧成灰烬，连灵魂都没能逃脱。沉重的铁门‘吱呀’转动，脚步声踏碎寂静。审判官的火焰魔法在他掌心凝成跳动的橘色，‘林默学徒，你可知罪？’林默攥紧藏在袖中的‘星尘之晶’——这是他用最后的魔力凝成的护身符，此刻正发烫。他知道，一旦承认‘罪名’，便是死亡；可若反抗，门外的守卫会立刻将他撕碎。铁门已开到一半，审判官的火焰近在咫尺。",
  "choices": ["立刻用星尘之晶反抗", "假装认罪拖延时间", "击碎铁栅栏逃亡"]
}
2025-09-21 18:01:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 266
2025-09-21 18:01:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 18:01:26 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '冰冷的石墙沁着寒气，潮湿的铁锈味钻进鼻腔...' 匹配到图片: magic_forest.jpg
2025-09-21 18:01:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-21 18:01:26 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-21 18:01:26 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 18:01:26 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 18:23:44 | INFO     | backend.main:shutdown_event:117 - 重生之我是……API服务关闭
2025-09-21 18:23:45 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 18:23:45 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 18:23:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 18:23:45 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 18:23:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 18:23:45 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 18:23:46 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 18:23:46 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 18:23:46 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 18:23:46 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 18:23:46 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 18:49:11 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 18:49:12 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 18:49:12 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 18:49:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 18:49:12 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 18:49:12 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 18:49:12 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 18:49:13 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 18:49:13 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 18:49:13 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 18:49:13 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 18:49:13 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:04:19 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:04:23 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:04:23 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:04:23 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:04:23 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:04:23 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 19:04:23 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 19:04:24 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 19:04:24 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 19:04:24 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 19:04:24 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 19:04:24 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:05:02 | INFO     | api.story:start_new_story:41 - 用户 61cb2be7-d6bf-40dc-a136-9c67f1e8b510 收到新故事请求，愿望: 魔法师
2025-09-21 19:05:02 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-21 19:05:12 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1345
2025-09-21 19:05:12 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "月光从铁窗斜切进来，在潮湿的石壁上投下细长的银刃。你蜷缩在囚牢角落，指尖残留着魔力灼烧的刺痛——三天前，你在黑魔法议会的审判席上被剥夺了所有魔力，此刻却在石牢的碎石缝里摸到了熟悉的魔法阵纹路。囚服粗粝的麻布擦过锁骨，门外传来沉重的锁链声，守卫正踩着你的重生节点走来。记忆如潮水涌来：如果现在不动，你的灵魂将被议会炼化为黑暗魔晶。",
  "choices": ["A. 血契唤醒古老魔法阵", "B. 撕裂空间紧急传送", "C. 凝聚魔力制造幻象"]
}
2025-09-21 19:05:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 164
2025-09-21 19:05:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 19:05:12 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '月光从铁窗斜切进来，在潮湿的石壁上投下细...' 匹配到图片: magic_forest.jpg
2025-09-21 19:05:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-21 19:05:12 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-21 19:05:12 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 19:05:12 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 19:19:17 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:19:18 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:19:18 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:19:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:19:18 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:19:19 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 19:19:19 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 19:19:19 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 19:19:19 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 19:19:19 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 19:19:19 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 19:19:19 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:20:27 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:20:28 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:20:28 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:20:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:20:28 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:20:29 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 19:20:29 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 19:20:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 19:20:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 19:20:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 19:20:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 19:20:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:21:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:21:08 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:21:08 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:21:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:21:08 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:21:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 19:21:08 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 19:21:09 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 19:21:09 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 19:21:09 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 19:21:09 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 19:21:09 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:21:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:21:46 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:21:46 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:21:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:21:46 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:21:46 | INFO     | database.base:<module>:29 - 数据库配置: vendor=sqlite, url=sqlite:///rebirth_game.db
2025-09-21 19:21:46 | INFO     | backend.database.base:<module>:29 - 数据库配置: vendor=sqlite, url=sqlite:///rebirth_game.db
2025-09-21 19:21:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 19:21:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 19:21:46 | INFO     | backend.database.base:<module>:29 - 数据库配置: vendor=sqlite, url=sqlite:///rebirth_game.db
2025-09-21 19:21:46 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 19:21:46 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 19:21:46 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 19:21:46 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 19:21:46 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:34:22 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:34:24 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:34:24 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:34:24 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:34:24 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:34:24 | INFO     | database.base:<module>:29 - 数据库配置: vendor=sqlite, url=sqlite:///rebirth_game.db
2025-09-21 19:34:24 | INFO     | backend.database.base:<module>:29 - 数据库配置: vendor=sqlite, url=sqlite:///rebirth_game.db
2025-09-21 19:34:24 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 19:34:24 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 19:34:24 | INFO     | backend.database.base:<module>:29 - 数据库配置: vendor=sqlite, url=sqlite:///rebirth_game.db
2025-09-21 19:34:25 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 19:34:25 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 19:34:25 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 19:34:25 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 19:34:25 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:35:15 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 19:35:17 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:35:17 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:35:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:35:17 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:36:18 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:36:18 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:36:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:36:18 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:37:16 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:37:16 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:37:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:37:16 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 19:38:02 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 19:38:02 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 19:38:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 19:38:02 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 21:38:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:38:25 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 21:38:25 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:38:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 21:38:25 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 21:38:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:38:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:38:25 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 21:38:25 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 21:38:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:38:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 21:38:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 21:38:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 21:38:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 21:38:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:39:19 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: (psycopg2.errors.UndefinedFunction) operator does not exist: character varying = uuid
LINE 3: WHERE users.id = '4145a3a9-7b62-46d3-a15e-461775d5cfc7'::UUI...
                       ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: SELECT users.id, users.email, users.hashed_password, users.nickname, users.age, users.identity, users.photo_url, users.created_at, users.token_version 
FROM users 
WHERE users.id = %(pk_1)s::UUID]
[parameters: {'pk_1': '4145a3a9-7b62-46d3-a15e-461775d5cfc7'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-21 21:43:30 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 21:43:32 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 21:43:32 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:43:32 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 21:43:32 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 21:43:32 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:43:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:43:32 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 21:43:32 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 21:43:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:43:33 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 21:43:33 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 21:43:33 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 21:43:33 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 21:43:33 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:48:23 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 21:48:25 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 21:48:25 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:48:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 21:48:25 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 21:48:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:48:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:48:25 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 21:48:25 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 21:48:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:48:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 21:48:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 21:48:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 21:48:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 21:48:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:56:26 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 21:56:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:56:34 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 21:56:34 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:56:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 21:56:34 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 21:56:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:56:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:56:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 21:56:34 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 21:56:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:56:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 21:56:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 21:56:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 21:56:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 21:56:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:56:46 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: 1 validation error for UserProfile
id
  Input should be a valid string [type=string_type, input_value=UUID('4145a3a9-7b62-46d3-a15e-461775d5cfc7'), input_type=UUID]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-09-21 21:58:34 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 21:58:36 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 21:58:36 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 21:58:36 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 21:58:36 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 21:58:36 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:58:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:58:36 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 21:58:36 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 21:58:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 21:58:37 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 21:58:37 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 21:58:37 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 21:58:37 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 21:58:37 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 22:00:42 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 22:00:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:00:47 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 22:00:47 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 22:00:47 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 22:00:47 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 22:00:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:00:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:00:47 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 22:00:47 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 22:00:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:00:48 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 22:00:48 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 22:00:48 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 22:00:48 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 22:00:48 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 22:04:51 | INFO     | api.story:start_new_story:41 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 魔法师
2025-09-21 22:04:51 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-21 22:05:03 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1706
2025-09-21 22:05:03 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "冰冷的月光从铁窗缝隙漏进来，在石墙上割出一道惨白的裂痕。艾瑞克挣扎着坐起身，头痛如被冰锥反复穿刺——他记得自己明明死在了‘暗影议会’的献祭仪式上，为何指尖还残留着星尘水晶的灼热？石牢的墙壁上，古老的反制魔法阵正发出幽蓝微光，将他的影子扭曲成怪物的形状。手腕上的魔法锁链滋滋作响，将他仅存的魔力一点点抽走。三天前，他还是魔法学院最年轻的院长，可现在，却成了阶下囚。‘必须赶在黎明前离开这里。’艾瑞克咬紧下唇，舌尖尝到一丝血腥味——他藏在舌下的传送符正在发烫。记忆碎片如潮水涌来：前世的背叛者、断裂的魔杖、还有那个被夺走的‘星尘水晶’……脚步声由远及近，沉重的铁门正发出‘吱呀’的呻吟。",
  "choices": ["唤醒墙壁发烫的符文", "咬破舌尖传送符", "呼唤契约兽‘幽影狼’"]
}
2025-09-21 22:05:03 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 291
2025-09-21 22:05:03 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 22:05:03 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '冰冷的月光从铁窗缝隙漏进来，在石墙上割出...' 匹配到图片: magic_forest.jpg
2025-09-21 22:05:03 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-21 22:05:03 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-21 22:05:03 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 22:05:03 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 22:05:19 | INFO     | api.story:continue_existing_story:103 - 收到故事继续请求，选择: 咬破舌尖传送符
2025-09-21 22:05:19 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 咬破舌尖传送符
2025-09-21 22:05:35 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1815
2025-09-21 22:05:35 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "舌尖的剧痛炸开，温热的血瞬间漫过舌下。传送符烫得像块烙铁，星尘水晶的灼热记忆碎片般涌入脑海——那是他被夺走的力量核心！幽蓝的反制魔法阵突然剧烈震颤，艾瑞克的影子在墙上扭曲成巨爪形状，仿佛要从石墙上爬出来撕碎他。\n\n‘吼——！’他猛地咬破舌尖，血珠混着传送符的光芒从嘴角溢出。‘嗡——’魔法锁链骤然绷紧，发出刺耳的嘶鸣，锁链上的符文竟亮起血红色！就在此时，厚重的铁门‘哐当’被撞开，火把的烈焰瞬间舔舐到艾瑞克的后背——他必须立刻传送！\n\n传送符的光芒骤然爆发，将整个石牢染成绯红色。艾瑞克感觉身体被一股狂乱的力量撕扯，眼前闪过无数破碎的星图：断裂的魔杖、背叛者的狞笑、还有……暗影议会的祭坛！他像片落叶般被抛向未知的虚空，在意识彻底消散前，瞥见铁门后站着的人影——为首者黑袍上绣着的银色月牙，竟与他记忆中那个‘盟友’的徽章一模一样！",
  "choices": ["探索传送落点，寻找破局之法", "利用记忆碎片，回忆敌人弱点", "唤醒体内残留的星尘力量反击"]
}
2025-09-21 22:05:35 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 365
2025-09-21 22:05:35 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 22:05:35 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '舌尖的剧痛炸开，温热的血瞬间漫过舌下。传...' 匹配到图片: magic_forest.jpg
2025-09-21 22:05:35 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-21 22:05:35 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-21 22:05:35 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: A transaction is already begun on this Session.
2025-09-21 22:19:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 22:19:46 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 22:19:46 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 22:19:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 22:19:46 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 22:19:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:19:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:19:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 22:19:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 22:19:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:19:47 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 22:19:47 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 22:19:47 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 22:19:47 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 22:19:47 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 22:21:57 | INFO     | api.story:continue_existing_story:103 - 收到故事继续请求，选择: 咬破舌尖传送符
2025-09-21 22:21:57 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 咬破舌尖传送符
2025-09-21 22:22:12 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1891
2025-09-21 22:22:12 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "舌尖的剧痛炸开，血珠混着星尘水晶的灼热从舌下涌出——传送符在滚烫的血液里瞬间融化，化作一道猩红光痕缠绕住他的指尖。艾瑞克猛地攥紧拳头，锁链传来‘咔嚓’脆响，反制魔法阵的幽蓝光芒骤然暴涨，石墙上的符文竟开始扭曲成利爪的形状！\n\n‘砰！’铁门被巨力撞开，三个黑袍人举着淬毒的骨杖冲进来，为首者的兜帽滑落，露出半张被暗影啃噬的脸——正是他曾信任的导师！艾瑞克瞳孔骤缩，传送符的灼热已顺着血管爬满全身，眼前开始浮现破碎的记忆：断裂的魔杖、星尘水晶的碎片、还有导师脖颈上那枚与他传送符同源的黑色徽章！\n\n‘院长阁下，您逃不掉的。’导师枯瘦的手指指向他，骨杖顶端的暗影化作毒蛇扑来。艾瑞克脑中轰然一响，传送符的光芒突然失控，他像断线的风筝般被抛向空中，重重摔进一片粘稠的黑暗里。落地瞬间，他摸到冰冷的金属触感——原来自己掉进了一间摆满破碎水晶棺的囚室，棺中躺着的，竟是……",
  "choices": ["检查那具‘自己’的尸体", "用剩余魔力击碎水晶棺", "寻找房间的隐藏机关"]
}
2025-09-21 22:22:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 380
2025-09-21 22:22:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 22:22:12 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '舌尖的剧痛炸开，血珠混着星尘水晶的灼热从...' 匹配到图片: magic_forest.jpg
2025-09-21 22:22:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-21 22:22:12 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-21 22:22:12 | INFO     | api.story:continue_existing_story:205 - 故事继续生成成功
2025-09-21 22:23:15 | INFO     | api.story:start_new_story:41 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 项羽
2025-09-21 22:23:15 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-21 22:23:29 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1299
2025-09-21 22:23:29 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "垓下的风裹着呜咽，吹得军帐外旌旗如濒死蝶翼。项羽猛地睁眼，胸口还残留着虞姬剑刃划破皮肉的痛感——不对，这是三年前鸿门宴的幻象？帐内烛火摇曳，他攥霸王枪的手触到一片冰凉汗渍，帐外楚歌突然尖锐如刀：‘汉兵已略地，四面楚歌声……’残兵蜷缩在角落，甲胄上的血污在月光下泛着暗红。他低头看见掌心‘霸王’二字烙印，突然意识到：自己竟回到了垓下之围的第一个寒夜。”，" 
  ,"choices": ["率八百骑死战突围", "回彭城重整旧部", "夜袭汉军粮草营"]
}
2025-09-21 22:23:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 176
2025-09-21 22:23:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 22:23:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-21 22:23:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-21 22:23:29 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/cyberpunk_city.jpg
2025-09-21 22:23:29 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 22:23:29 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 22:38:27 | INFO     | api.story:start_new_story:41 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 魔法师
2025-09-21 22:38:27 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-21 22:38:37 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1387
2025-09-21 22:38:37 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "实验室的空气像凝固的墨汁，烛光在坩埚残骸上投下狰狞的影子。我挣扎着坐起身，指节因紧握实验台而泛白——这是我16岁时的魔法初阶考核前夜，可记忆却像被揉碎的星尘，前世被导师推下深渊的剧痛还在骨髓里灼烧。‘别以为睡一觉就能抹去失败！’走廊传来导师沙哑的咆哮，他总说我的‘混沌系魔法’是学院的耻辱。我颤抖着翻开笔记，本该记录‘火焰亲和术’的页面，此刻却爬满扭曲的蛇形咒文——那是我死前才学会的禁术，是谁篡改了它？窗外传来翅膀扑棱的声响，是导师养的‘侦查鸦’。考核只剩三个时辰，而我的魔力正在以肉眼可见的速度溃散。",
  "choices": ["速寻导师质问篡改者", "销毁笔记阻止禁术扩散", "冒险施展禁术自救"]
}
2025-09-21 22:38:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 252
2025-09-21 22:38:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 22:38:37 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '实验室的空气像凝固的墨汁，烛光在坩埚残骸...' 匹配到图片: magic_forest.jpg
2025-09-21 22:38:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-21 22:38:37 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-21 22:38:37 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 22:38:37 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 22:45:39 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 22:45:41 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 22:45:41 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 22:45:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 22:45:41 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 22:45:41 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:45:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:45:41 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 22:45:41 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 22:45:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 22:45:42 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 22:45:42 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 22:45:42 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 22:45:42 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 22:45:42 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:02:12 | INFO     | api.story:start_new_story:41 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 项羽
2025-09-21 23:02:12 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-21 23:02:32 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1637
2025-09-21 23:02:32 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "寒夜，垓下的风裹着血腥味掠过营帐，项羽猛地从榻上坐起。帐外楚歌像毒蛇缠上来，每一声都咬着他的心——那是故乡子弟的歌声，如今却成了催命符。他攥紧腰间佩剑，剑鞘上的龙纹已被血污浸得发黑，腕间旧伤裂开，渗出的血珠混着冷汗滴在残破的军靴上。帐帘被掀开，虞姬鬓边金步摇晃得像风中残烛，她捧着一碗冷酒，指尖在颤抖：“大王，江东……还能回吗？”项羽望着帐外星子般的火把，三十万楚军已溃不成军，韩信的“十面埋伏”铁壁般压来，连最忠诚的季布都带着亲兵叛逃了。他忽然想起鸿门宴上放过的刘邦，想起火烧阿房宫时的烈焰，想起虞姬为他舞剑时的决绝——若能重来，他绝不会让八千子弟魂断乌江。此刻，帐外传来亲兵嘶哑的呼喊：“楚军已破！大王快走！”他必须立刻做决定。",
  "choices": ["A. 率八百骑连夜突围", "B. 召集残兵死战到底", "C. 护虞姬自刎乌江前"]
}
2025-09-21 23:02:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 316
2025-09-21 23:02:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 23:02:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-21 23:02:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-21 23:02:32 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/space_station.jpg
2025-09-21 23:02:32 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 23:02:32 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 23:02:33 | INFO     | api.story:get_latest_node_for_session:271 - [latest] user=4145a3a9-7b62-46d3-a15e-461775d5cfc7 querying session_id=4
2025-09-21 23:02:33 | INFO     | api.story:get_latest_node_for_session:292 - [latest] returning node_id=5 session_id=4 chapter=1 choices=3
2025-09-21 23:02:42 | INFO     | api.story:continue_existing_story:103 - 收到故事继续请求，选择: B. 召集残兵死战到底
2025-09-21 23:02:42 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: B. 召集残兵死战到底
2025-09-21 23:02:55 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1773
2025-09-21 23:02:55 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "项羽猛地掀翻案几，青铜酒樽碎裂成星点火光。'随我杀！'他提着剑大步冲出，腰间佩剑划破夜雾，声如惊雷炸响在帐外。残兵们本已瘫软在地，闻言纷纷挣扎起身，断裂的旌旗被人扯在半空，半截断矛在火把下泛着冷光。他策马冲在最前，霸王枪挑飞七八个汉兵，枪尖血珠溅在甲胄上，顺着裂痕蜿蜒成河。楚歌突然噤声，汉营方向传来骚动——楚军的反扑竟撕开一道口子！可身后只剩二十余骑，刀刃卷刃，铠甲裂成蛛网。他瞥见垓下坡上飘着'汉'字大纛，刘邦的身影就在旗下，项羽突然狂笑，策马直冲：'刘邦匹夫！来接你霸王爷爷的刀！'刀光闪过，血花在寒夜里炸开成一朵妖异的红。",
  "choices": ["项羽力战而亡，乌江畔留下霸王别姬的绝唱", "虞姬持剑杀至项羽身侧，二人背靠背战死", "季布突然率残部回援，项羽终被围困"]
}
2025-09-21 23:02:55 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 265
2025-09-21 23:02:55 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 23:02:55 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-21 23:02:55 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-21 23:02:55 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-21 23:02:55 | INFO     | api.story:continue_existing_story:205 - 故事继续生成成功
2025-09-21 23:02:58 | INFO     | api.story:continue_existing_story:103 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-21 23:02:58 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-21 23:03:09 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1941
2025-09-21 23:03:09 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "虞姬持剑杀至项羽身侧，二人背靠背战死。垓下的雪混着血沫落满他们的铠甲，项羽的霸王枪已卷刃，虞姬的青霜剑却仍在她手中颤出冷芒。'大王，'虞姬声音轻得像风中烛火，'当年你引八千子弟出江东，如今我陪你守这垓下土。'项羽回手揽住她汗湿的鬓角，枪尖刺穿第七个汉兵咽喉时，腕间旧伤崩裂的血珠溅在虞姬脸颊，她却笑了，用剑鞘抵住他后背：'这刀光里，我们永远是楚地最亮的星。'汉兵的马蹄踏碎了最后一面残破的'楚'字旗，项羽突然将虞姬护在怀中，霸王枪横扫而出，枪尖挑起漫天血花——当他最后一声怒吼震碎苍穹时，虞姬的剑正从他心口拔出，又刺入自己胸膛。雪地里，两具交叠的尸身渐渐冻成楚地最后的图腾。",
  "choices": []
}
2025-09-21 23:03:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 287
2025-09-21 23:03:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 23:03:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-21 23:03:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-21 23:03:09 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-21 23:03:09 | INFO     | api.story:continue_existing_story:205 - 故事继续生成成功
2025-09-21 23:03:53 | INFO     | api.story:start_new_story:41 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 魔法师
2025-09-21 23:03:53 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '魔法师'
2025-09-21 23:04:09 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1959
2025-09-21 23:04:09 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "星陨魔法学院的礼堂穹顶缀满星辰符文，中央悬浮的召唤阵正发出濒死的暗红微光。艾拉指尖渗出冷汗，前世在此刻因魔力暴走撕裂空间，被永恒黑暗吞噬的剧痛仿佛还卡在喉间——她重生了，回到了毕业考核的最后三分钟。‘艾拉同学，你的元素共鸣已失控，放弃吧。’首席导师的声音像淬冰的长矛。她攥紧掌心的魔晶杖，杖身刻着的家族纹章正发烫——那是前世她偷偷刻下的求救印记，此刻却像个嘲讽的笑话。魔法阵突然剧烈震颤，一道黑影从阵眼裂缝中钻出，是她最恐惧的‘虚空残响’！艾拉的瞳孔骤然收缩，她必须在黑影吞噬前做出选择。",
  "choices": ["强行引导魔法力召唤守护灵", "启动家族禁术虚空防御", "击碎魔晶杖逃离考核场"]
}
2025-09-21 23:04:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 244
2025-09-21 23:04:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 23:04:09 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '星陨魔法学院的礼堂穹顶缀满星辰符文，中央...' 匹配到图片: space_station.jpg
2025-09-21 23:04:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-21 23:04:09 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/space_station.jpg
2025-09-21 23:04:09 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 23:04:09 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 23:04:13 | INFO     | api.story:get_latest_node_for_session:271 - [latest] user=4145a3a9-7b62-46d3-a15e-461775d5cfc7 querying session_id=5
2025-09-21 23:04:13 | INFO     | api.story:get_latest_node_for_session:292 - [latest] returning node_id=8 session_id=5 chapter=1 choices=3
2025-09-21 23:04:25 | INFO     | api.story:get_latest_node_for_session:271 - [latest] user=4145a3a9-7b62-46d3-a15e-461775d5cfc7 querying session_id=5
2025-09-21 23:04:25 | INFO     | api.story:get_latest_node_for_session:292 - [latest] returning node_id=8 session_id=5 chapter=1 choices=3
2025-09-21 23:09:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 23:10:00 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 23:10:00 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:10:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 23:10:00 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 23:10:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:10:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:10:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 23:10:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 23:10:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:10:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 23:10:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 23:10:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 23:10:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 23:10:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:12:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 23:12:05 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 23:12:05 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:12:05 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 23:12:05 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 23:12:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:12:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:12:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 23:12:05 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 23:12:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:12:06 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 23:12:06 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 23:12:06 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 23:12:06 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 23:12:06 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:14:09 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 23:14:11 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 23:14:11 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:14:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 23:14:11 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 23:14:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:14:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:14:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 23:14:11 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 23:14:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:14:12 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 23:14:12 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 23:14:12 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 23:14:12 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 23:14:12 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:14:49 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-21 23:14:51 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-21 23:14:51 | INFO     | core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:14:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-21 23:14:51 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-21 23:14:51 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:14:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:14:51 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-21 23:14:51 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-21 23:14:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-21 23:14:52 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-21 23:14:52 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-21 23:14:52 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-21 23:14:52 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-21 23:14:52 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-21 23:24:38 | INFO     | api.story:start_new_story:41 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 项羽
2025-09-21 23:24:38 | INFO     | core.story_engine:start_story:50 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-21 23:24:51 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1766
2025-09-21 23:24:51 | DEBUG    | core.story_engine:start_story:57 - LLM原始回应: {
  "text": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……",
  "choices": ["率八百骑直破汉军大阵", "以虞姬为饵诱敌深入", "重唤楚魂瓦解敌军斗志"]
}
2025-09-21 23:24:51 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 185
2025-09-21 23:24:51 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 23:24:51 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-21 23:24:51 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-21 23:24:51 | INFO     | core.story_engine:start_story:65 - 成功生成开篇故事，图片为: /static/space_station.jpg
2025-09-21 23:24:51 | INFO     | core.story_engine:start_story:81 - 新故事生成成功
2025-09-21 23:24:51 | INFO     | api.story:start_new_story:83 - 新故事生成成功
2025-09-21 23:24:57 | INFO     | api.story:get_user_latest_node:310 - [latest-global] user=4145a3a9-7b62-46d3-a15e-461775d5cfc7 querying deepest progress across all sessions
2025-09-21 23:24:57 | INFO     | api.story:get_user_latest_node:329 - [latest-global] returning node_id=7 session_id=4 chapter=3 choices=0
2025-09-21 23:28:44 | INFO     | api.story:retry_from_node:226 - 收到时空回溯请求，目标节点: 9
2025-09-21 23:28:44 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-21 23:28:44 | INFO     | database.crud:prune_story_after_node:235 - 节点 9 没有后代，无需删除。
2025-09-21 23:28:44 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-21 23:28:49 | INFO     | api.story:retry_from_node:226 - 收到时空回溯请求，目标节点: 6
2025-09-21 23:28:49 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 6 之后进行时空回溯...
2025-09-21 23:28:49 | INFO     | database.crud:prune_story_after_node:231 - 节点 6 的所有后代节点 [7] 将被删除。
2025-09-21 23:28:49 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 6。
2025-09-21 23:28:56 | INFO     | api.story:continue_existing_story:103 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-21 23:28:56 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-21 23:29:04 | INFO     | core.llm_clients:generate:61 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1734
2025-09-21 23:29:04 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: {
  "text": "虞姬持剑杀至项羽身侧，二人背靠背战死。霸王枪如虬龙摆尾，枪尖挑飞第七个汉兵的头颅，血珠溅在虞姬云纹铠甲上，像绽开的红梅。项羽左臂已被劈中，甲胄裂成蛛网，他却反手将虞姬护在身后，枪杆横扫逼退三骑。虞姬咬碎银牙，长剑舞成白练，将刺向项羽后心的长戟格开，剑锋擦过她脖颈，带起一缕青丝。'大王，你说过要护我到乌江的。'她声音嘶哑，却笑得凄艳。项羽喉间滚出血沫，枪尖刺穿最后一个敌人咽喉，轰然倒地时，霸王枪斜插在冻土中，枪缨犹自颤抖。虞姬转身抱住他垂落的身躯，剑刃抵着自己心口，'妾愿与大王同归。'寒夜中，两人渐渐冰冷的身躯依偎成一座血色丰碑，楚歌在风中呜咽，再无人声。",
  "choices": []
}
2025-09-21 23:29:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 280
2025-09-21 23:29:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-21 23:29:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-21 23:29:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-21 23:29:04 | INFO     | core.story_engine:continue_story:117 - 故事继续生成成功
2025-09-21 23:29:04 | INFO     | api.story:continue_existing_story:205 - 故事继续生成成功
2025-09-22 23:29:20 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-22 23:29:20 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-23 00:32:42 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-23 00:32:42 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-23 00:35:10 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:35:10 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:35:49 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:35:49 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:35:55 | INFO     | backend.core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 327
2025-09-23 00:40:30 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:40:30 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:40:33 | INFO     | backend.core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 236
2025-09-23 00:41:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:41:17 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:41:17 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:41:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 00:41:17 | INFO     | core.story_engine:__init__:20 - 故事引擎初始化完成
2025-09-23 00:41:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:41:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:41:17 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 00:41:17 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 00:41:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:41:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 00:41:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 00:41:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 00:41:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:41:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 00:42:27 | INFO     | api.story:retry_from_node:279 - 收到时空回溯请求，目标节点: 6
2025-09-23 00:42:27 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 6 之后进行时空回溯...
2025-09-23 00:42:27 | INFO     | database.crud:prune_story_after_node:231 - 节点 6 的所有后代节点 [10] 将被删除。
2025-09-23 00:42:27 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 6。
2025-09-23 00:42:35 | INFO     | api.story:continue_existing_story:156 - 收到故事继续请求，选择: 项羽力战而亡，乌江畔留下霸王别姬的绝唱
2025-09-23 00:42:35 | INFO     | core.story_engine:continue_story:86 - 继续故事，用户选择: 项羽力战而亡，乌江畔留下霸王别姬的绝唱
2025-09-23 00:43:27 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1331
2025-09-23 00:43:27 | DEBUG    | core.story_engine:continue_story:93 - LLM原始回应: 空响应次数达到上限
请修改输入提示词
2025-09-23 00:43:27 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Expecting value: line 1 column 1 (char 0)
2025-09-23 00:46:19 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 00:46:20 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:46:20 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:46:20 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 00:46:20 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 00:46:20 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:46:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:46:21 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 00:46:21 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 00:46:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:46:22 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 00:46:22 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 00:46:22 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 00:46:22 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:46:22 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 00:46:57 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 00:46:59 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:46:59 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:46:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 00:46:59 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 00:46:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:46:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:46:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 00:46:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 00:47:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:47:00 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 00:47:00 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 00:47:00 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 00:47:00 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:47:00 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 00:47:55 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 00:47:57 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:47:57 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:47:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 00:47:57 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 00:47:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:47:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:47:57 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 00:47:57 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 00:47:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:47:58 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 00:47:58 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 00:47:58 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 00:47:58 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:47:58 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 00:48:37 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 00:48:39 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:48:39 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 00:48:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 00:48:39 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 00:48:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:48:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:48:39 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 00:48:39 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 00:48:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 00:48:40 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 00:48:40 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 00:48:40 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 00:48:40 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 00:48:40 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:30:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:30:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:30:49 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:30:49 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:30:49 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:30:49 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:30:49 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:30:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:30:49 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:30:49 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:30:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:30:50 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:30:50 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:30:50 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:30:50 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:30:50 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:31:34 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 6
2025-09-23 01:31:34 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 6 之后进行时空回溯...
2025-09-23 01:31:34 | INFO     | database.crud:prune_story_after_node:235 - 节点 6 没有后代，无需删除。
2025-09-23 01:31:34 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 6。
2025-09-23 01:31:36 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:31:36 | INFO     | core.story_engine:continue_story:125 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:32:05 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1371
2025-09-23 01:32:05 | DEBUG    | core.story_engine:continue_story:132 - LLM原始回应: 空响应次数达到上限
请修改输入提示词
2025-09-23 01:32:05 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Expecting value: line 1 column 1 (char 0)
2025-09-23 01:32:40 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:32:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:32:44 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:32:44 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:32:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:32:44 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:32:44 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:32:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:32:44 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:32:44 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:32:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:32:45 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:32:45 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:32:45 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:32:45 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:32:45 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:35:53 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:35:53 | INFO     | core.story_engine:continue_story:125 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:36:24 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1371
2025-09-23 01:36:24 | DEBUG    | core.story_engine:continue_story:132 - LLM原始回应: 空响应次数达到上限
请修改输入提示词
2025-09-23 01:36:24 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Expecting value: line 1 column 1 (char 0)
2025-09-23 01:38:02 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:38:04 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:38:04 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:38:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:38:04 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:38:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:38:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:38:04 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:38:04 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:38:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:38:05 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:38:05 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:38:05 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:38:05 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:38:05 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:40:24 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:40:25 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:40:25 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:40:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:40:25 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:40:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:40:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:40:25 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:40:25 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:40:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:40:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:40:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:40:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:40:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:40:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:44:43 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:44:43 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:45:14 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1371
2025-09-23 01:45:14 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 01:45:14 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 01:45:14 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 01:45:14 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 01:45:14 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 01:45:19 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 510
2025-09-23 01:45:19 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 01:45:19 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 01:45:19 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 01:45:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 01:45:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 01:45:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-23 01:45:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-23 01:45:19 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 01:45:19 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 01:45:35 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:45:40 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:45:40 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:45:46 | INFO     | backend.core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 481
2025-09-23 01:47:18 | INFO     | backend.core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:47:18 | INFO     | backend.core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:47:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:47:29 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:47:29 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:47:29 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:47:29 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:47:29 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:47:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:47:29 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:47:29 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:47:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:47:30 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:47:30 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:47:30 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:47:30 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:47:30 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:47:45 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 6
2025-09-23 01:47:45 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 6 之后进行时空回溯...
2025-09-23 01:47:45 | INFO     | database.crud:prune_story_after_node:231 - 节点 6 的所有后代节点 [43] 将被删除。
2025-09-23 01:47:45 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 6。
2025-09-23 01:47:46 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:47:46 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 01:48:19 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1371
2025-09-23 01:48:19 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 01:48:19 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 01:48:19 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 01:48:19 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 01:48:19 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 01:48:23 | INFO     | core.llm_clients:generate:76 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 673
2025-09-23 01:48:23 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 01:48:23 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 01:48:23 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 01:48:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 01:48:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 01:48:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-23 01:48:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-23 01:48:23 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 01:48:23 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 01:51:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:51:30 | INFO     | core.llm_clients:__init__:36 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:51:30 | INFO     | core.llm_clients:__init__:37 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:51:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:51:30 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:51:30 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:51:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:51:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:51:31 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:51:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:51:31 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:51:31 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:51:31 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:51:31 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:51:31 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 01:52:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 01:52:13 | INFO     | core.llm_clients:__init__:37 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:52:13 | INFO     | core.llm_clients:__init__:38 - API地址: https://new.wuxuai.com/v1
2025-09-23 01:52:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 01:52:13 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 01:52:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:52:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:52:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 01:52:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 01:52:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 01:52:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 01:52:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 01:52:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 01:52:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 01:52:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 02:01:25 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 02:01:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 02:01:31 | INFO     | core.llm_clients:__init__:37 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 02:01:31 | INFO     | core.llm_clients:__init__:38 - API地址: https://new.wuxuai.com/v1
2025-09-23 02:01:31 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 02:01:31 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 02:01:31 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 02:01:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 02:01:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 02:01:31 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 02:01:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 02:01:31 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 02:01:31 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 02:01:31 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 02:01:31 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 02:01:31 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 02:02:46 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 6
2025-09-23 02:02:46 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 6 之后进行时空回溯...
2025-09-23 02:02:46 | INFO     | database.crud:prune_story_after_node:231 - 节点 6 的所有后代节点 [44] 将被删除。
2025-09-23 02:02:46 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 6。
2025-09-23 02:02:50 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 02:02:50 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 02:03:18 | INFO     | core.llm_clients:generate:104 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1472
2025-09-23 02:03:18 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 02:03:18 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 02:03:18 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 02:03:18 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 02:03:18 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 02:03:21 | INFO     | core.llm_clients:generate:104 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 413
2025-09-23 02:03:21 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 02:03:21 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 02:03:21 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 02:03:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 02:03:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 02:03:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-23 02:03:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-23 02:03:21 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 02:03:21 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 20:34:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:35:00 | INFO     | core.llm_clients:__init__:37 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250715
2025-09-23 20:35:00 | INFO     | core.llm_clients:__init__:38 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-23 20:35:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 20:35:00 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 20:35:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:35:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:35:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 20:35:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 20:35:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:35:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 20:35:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 20:35:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 20:35:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250715
2025-09-23 20:35:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-23 20:36:11 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 6
2025-09-23 20:36:11 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 6 之后进行时空回溯...
2025-09-23 20:36:11 | INFO     | database.crud:prune_story_after_node:231 - 节点 6 的所有后代节点 [45] 将被删除。
2025-09-23 20:36:11 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 6。
2025-09-23 20:36:12 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 20:36:12 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 虞姬持剑杀至项羽身侧，二人背靠背战死
2025-09-23 20:36:25 | INFO     | core.llm_clients:generate:104 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250715, tokens使用: 1898
2025-09-23 20:36:25 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=489 预览='{"text": "虞姬的身影如惊鸿般掠过尸山血海，青锋剑划破汉兵的咽喉，带起的血珠溅在项羽背上。她扑到他身侧，剑鞘重重撞在他甲胄上，嘶哑道：“大王，别怕！”项羽猛地回头，看见她鬓边金步摇已断了半截，嘴角还沾着血沫，却笑得比帐外寒星更亮。“虞兮虞兮奈若何……”他低喃着，霸王枪横扫，将涌上来的汉兵挑飞，枪尖的血顺着枪缨滴落，在地上汇成小小的溪流。虞姬的剑与他的枪交织成网，汉兵的嘶吼、兵器的碰撞声在寒夜里炸开，可他们身后，是越来越密的铁蹄。虞姬突然将剑塞进项羽手中，自己拔出他腰间断剑，转身扑向最前面的汉将，“大王，活下去！”剑光闪过，她的身影却晃了晃，重重倒在项羽背上。项羽僵住，怀中的人身体渐冷，'
2025-09-23 20:36:25 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=489 预览='{"text": "虞姬的身影如惊鸿般掠过尸山血海，青锋剑划破汉兵的咽喉，带起的血珠溅在项羽背上。她扑到他身侧，剑鞘重重撞在他甲胄上，嘶哑道：“大王，别怕！”项羽猛地回头，看见她鬓边金步摇已断了半截，嘴角还沾着血沫，却笑得比帐外寒星更亮。“虞兮虞兮奈若何……”他低喃着，霸王枪横扫，将涌上来的汉兵挑飞，枪尖的血顺着枪缨滴'
2025-09-23 20:36:25 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=489 预览='{"text": "虞姬的身影如惊鸿般掠过尸山血海，青锋剑划破汉兵的咽喉，带起的血珠溅在项羽背上。她扑到他身侧，剑鞘重重撞在他甲胄上，嘶哑道：“大王，别怕！”项羽猛地回头，看见她鬓边金步摇已断了半截，嘴角还沾着血沫，却笑得比帐外寒星更亮。“虞兮虞兮奈若何……”他低喃着，霸王枪横扫，将涌上来的汉兵挑飞，枪尖的血顺着枪缨滴'
2025-09-23 20:36:25 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=489 预览='{"text": "虞姬的身影如惊鸿般掠过尸山血海，青锋剑划破汉兵的咽喉，带起的血珠溅在项羽背上。她扑到他身侧，剑鞘重重撞在他甲胄上，嘶哑道：“大王，别怕！”项羽猛地回头，看见她鬓边金步摇已断了半截，嘴角还沾着血沫，却笑得比帐外寒星更亮。“虞兮虞兮奈若何……”他低喃着，霸王枪横扫，将涌上来的汉兵挑飞，枪尖的血顺着枪缨滴落，在地上汇成小小的溪流。虞姬的剑与他的枪交织成网，汉兵的嘶吼、兵器的碰撞声在寒'
2025-09-23 20:36:25 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 462
2025-09-23 20:36:25 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 20:36:25 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-23 20:36:25 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-23 20:36:25 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 20:36:25 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 20:42:22 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 20:42:23 | INFO     | core.llm_clients:__init__:37 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250715
2025-09-23 20:42:23 | INFO     | core.llm_clients:__init__:38 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-23 20:42:23 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 20:42:23 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 20:42:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:42:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:42:23 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 20:42:23 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 20:42:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:42:24 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 20:42:24 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 20:42:24 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 20:42:24 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250715
2025-09-23 20:42:24 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-23 20:44:53 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 20:44:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:44:57 | INFO     | core.llm_clients:__init__:37 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 20:44:57 | INFO     | core.llm_clients:__init__:38 - API地址: https://new.wuxuai.com/v1
2025-09-23 20:44:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 20:44:57 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 20:44:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:44:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:44:57 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 20:44:57 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 20:44:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 20:44:58 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 20:44:58 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 20:44:58 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 20:44:58 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 20:44:58 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 20:45:08 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 20:45:08 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 20:45:08 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [6, 78] 将被删除。
2025-09-23 20:45:08 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 20:45:09 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: B. 召集残兵死战到底
2025-09-23 20:45:09 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: B. 召集残兵死战到底
2025-09-23 20:45:44 | INFO     | core.llm_clients:generate:107 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1009
2025-09-23 20:45:44 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 20:45:44 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 20:45:44 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 20:45:44 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 20:45:44 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 20:45:50 | INFO     | core.llm_clients:generate:107 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 705
2025-09-23 20:45:50 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=76 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词\\nru13yl2tFN",\n  "choices": []\n}\n```'
2025-09-23 20:45:50 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=76 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词\\nru13yl2tFN",\n  "choices": []\n}\n```'
2025-09-23 20:45:50 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=64 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词\\nru13yl2tFN",\n  "choices": []\n}'
2025-09-23 20:45:50 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 29
2025-09-23 20:45:50 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 20:45:50 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-23 20:45:50 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-23 20:45:50 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 20:45:50 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 20:47:35 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 20:47:40 | INFO     | backend.core.llm_clients:__init__:37 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 20:47:40 | INFO     | backend.core.llm_clients:__init__:38 - API地址: https://new.wuxuai.com/v1
2025-09-23 20:47:44 | INFO     | backend.core.llm_clients:generate:107 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 349
2025-09-23 21:18:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:18:18 | INFO     | core.llm_clients:__init__:47 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:18:18 | INFO     | core.llm_clients:__init__:48 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:18:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:18:18 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:18:18 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:18:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:18:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:18:18 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:18:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:18:19 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:18:19 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:18:19 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:18:19 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:18:19 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:19:33 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 21:19:33 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 21:19:33 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [79] 将被删除。
2025-09-23 21:19:33 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 21:19:36 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: A. 率八百骑连夜突围
2025-09-23 21:19:36 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: A. 率八百骑连夜突围
2025-09-23 21:20:16 | INFO     | core.llm_clients:generate:117 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1012
2025-09-23 21:20:16 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:20:16 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:20:16 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:20:16 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:20:16 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:20:20 | INFO     | core.llm_clients:generate:117 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 470
2025-09-23 21:20:20 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:20:20 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:20:20 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:20:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:20:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:20:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-23 21:20:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-23 21:20:20 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:20:20 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:21:31 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:21:33 | INFO     | core.llm_clients:__init__:49 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:21:33 | INFO     | core.llm_clients:__init__:50 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:21:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:21:33 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:21:33 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:21:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:21:33 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:21:33 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:21:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:21:34 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:21:34 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:21:34 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:21:34 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:21:34 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:24:03 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 21:24:03 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 21:24:03 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [80] 将被删除。
2025-09-23 21:24:03 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 21:24:05 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: A. 率八百骑连夜突围
2025-09-23 21:24:05 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: A. 率八百骑连夜突围
2025-09-23 21:24:39 | INFO     | core.llm_clients:generate:119 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1012
2025-09-23 21:24:39 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:24:39 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:24:39 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:24:39 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:24:39 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:24:43 | INFO     | core.llm_clients:generate:119 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 423
2025-09-23 21:24:43 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:24:43 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:24:43 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:24:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:24:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:24:43 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-23 21:24:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-23 21:24:43 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:24:43 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:24:43 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:24:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:24:50 | INFO     | core.llm_clients:__init__:49 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:24:50 | INFO     | core.llm_clients:__init__:50 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:24:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:24:50 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:24:50 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:24:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:24:50 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:24:50 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:24:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:24:51 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:24:51 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:24:51 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:24:51 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:24:51 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:25:13 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 21:25:13 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 21:25:13 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [81] 将被删除。
2025-09-23 21:25:13 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 21:25:18 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: A. 率八百骑连夜突围
2025-09-23 21:25:18 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: A. 率八百骑连夜突围
2025-09-23 21:25:53 | INFO     | core.llm_clients:generate:119 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1012
2025-09-23 21:25:53 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:25:53 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:25:53 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:25:53 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:25:53 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:25:56 | INFO     | core.llm_clients:generate:119 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 429
2025-09-23 21:25:56 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:25:56 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:25:56 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:25:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:25:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:25:56 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-23 21:25:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-23 21:25:56 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:25:56 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:27:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:27:08 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:27:08 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:27:08 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:27:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:27:08 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:27:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:27:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:27:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:27:08 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:27:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:27:09 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:27:09 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:27:09 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:27:09 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:27:09 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:31:06 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 21:31:06 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 21:31:06 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [82] 将被删除。
2025-09-23 21:31:06 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 21:31:08 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: A. 率八百骑连夜突围
2025-09-23 21:31:08 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: A. 率八百骑连夜突围
2025-09-23 21:31:50 | INFO     | core.llm_clients:generate:120 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1012
2025-09-23 21:31:50 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:31:50 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:31:50 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:31:50 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:31:50 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:31:55 | INFO     | core.llm_clients:generate:120 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 457
2025-09-23 21:31:55 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:31:55 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:31:55 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:31:55 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:31:55 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:31:55 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-23 21:31:55 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-23 21:31:55 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:31:55 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:32:11 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:32:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:32:15 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:32:15 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:32:15 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:32:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:32:15 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:32:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:32:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:32:15 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:32:15 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:32:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:32:16 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:32:16 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:32:16 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:32:16 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:32:16 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:32:39 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 21:32:39 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 21:32:39 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [83] 将被删除。
2025-09-23 21:32:39 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 21:32:42 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: C. 护虞姬自刎乌江前
2025-09-23 21:32:42 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: C. 护虞姬自刎乌江前
2025-09-23 21:32:58 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Request timed out.
2025-09-23 21:34:37 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:34:39 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:34:39 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:34:39 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:34:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:34:39 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:34:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:34:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:34:39 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:34:39 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:34:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:34:40 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:34:40 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:34:40 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:34:40 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:34:40 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:35:19 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:35:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:35:24 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:35:24 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:35:24 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:35:24 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:35:24 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:35:24 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:35:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:35:24 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:35:24 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:35:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:35:25 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:35:25 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:35:25 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:35:25 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:35:25 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:35:42 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: B. 召集残兵死战到底
2025-09-23 21:35:42 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: B. 召集残兵死战到底
2025-09-23 21:35:42 | ERROR    | core.llm_clients:generate:96 - 构建 cURL 命令失败: 'URL' object has no attribute 'strip'
2025-09-23 21:36:21 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1009
2025-09-23 21:36:21 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:36:21 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:36:21 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:36:21 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:36:21 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:36:21 | ERROR    | core.llm_clients:generate:96 - 构建 cURL 命令失败: 'URL' object has no attribute 'strip'
2025-09-23 21:36:24 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 447
2025-09-23 21:36:24 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:36:24 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:36:24 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:36:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:36:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:36:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-23 21:36:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-23 21:36:24 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:36:24 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:36:24 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:36:26 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:36:26 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:36:26 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:36:26 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:36:26 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:36:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:36:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:36:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:27 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:36:27 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:36:27 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:36:27 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:36:27 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:36:27 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:36:28 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:36:28 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:36:28 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:36:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:36:28 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:36:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:28 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:36:28 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:36:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:36:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:36:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:36:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:36:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:36:45 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:36:47 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:36:47 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:36:47 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:36:47 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:36:47 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:36:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:47 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:36:47 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:36:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:36:48 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:36:48 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:36:48 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:36:48 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:36:48 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:36:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:37:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:37:02 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:37:02 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:37:02 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:37:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:37:02 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:37:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:37:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:37:02 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:37:02 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:37:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:37:03 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:37:03 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:37:03 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:37:03 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:37:03 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:38:00 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 5
2025-09-23 21:38:00 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 5 之后进行时空回溯...
2025-09-23 21:38:00 | INFO     | database.crud:prune_story_after_node:231 - 节点 5 的所有后代节点 [84] 将被删除。
2025-09-23 21:38:00 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 5。
2025-09-23 21:38:01 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: B. 召集残兵死战到底
2025-09-23 21:38:01 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: B. 召集残兵死战到底
2025-09-23 21:38:01 | CRITICAL | core.llm_clients:generate:94 - [CURL COMMAND] curl --location 'https://new.wuxuai.com/v1/chat/completions' --header 'Accept: */*' --header 'Content-Type: application/json' --header 'User-Agent: PostmanRuntime/7.47.1' --header 'X-Stainless-Lang: python' --header 'X-Stainless-Package-Version: 1.65.5' --header 'X-Stainless-OS: Windows' --header 'X-Stainless-Arch: other:amd64' --header 'X-Stainless-Runtime: CPython' --header 'X-Stainless-Runtime-Version: 3.11.3' --header 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' --header 'Cache-Control: no-cache' --header 'Accept-Encoding: gzip, deflate, br' --header 'Connection: keep-alive' --header 'X-Stainless-Async: false' --header 'OpenAI-Organization: <openai.Omit object at 0x000001B71836CED0>' --header 'OpenAI-Project: <openai.Omit object at 0x000001B71810E610>' --data '{"model": "[自营]gemini-2.5-flash-lite-preview-06-17", "max_tokens": 500, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 'text'（字符串）和 'choices'（字符串数组）。当无法继续时，将 'choices' 设为 []。"}, {"role": "assistant", "content": "寒夜，垓下的风裹着血腥味掠过营帐，项羽猛地从榻上坐起。帐外楚歌像毒蛇缠上来，每一声都咬着他的心——那是故乡子弟的歌声，如今却成了催命符。他攥紧腰间佩剑，剑鞘上的龙纹已被血污浸得发黑，腕间旧伤裂开，渗出的血珠混着冷汗滴在残破的军靴上。帐帘被掀开，虞姬鬓边金步摇晃得像风中残烛，她捧着一碗冷酒，指尖在颤抖：“大王，江东……还能回吗？”项羽望着帐外星子般的火把，三十万楚军已溃不成军，韩信的“十面埋伏”铁壁般压来，连最忠诚的季布都带着亲兵叛逃了。他忽然想起鸿门宴上放过的刘邦，想起火烧阿房宫时的烈焰，想起虞姬为他舞剑时的决绝——若能重来，他绝不会让八千子弟魂断乌江。此刻，帐外传来亲兵嘶哑的呼喊：“楚军已破！大王快走！”他必须立刻做决定。"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点，或者一个恰当的结局\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n\n---\n【重要规则】\n- 如果你认为故事可以继续发展，请在结尾提供2到3个清晰、有意义的行动选项。\n- 如果你认为故事在当前节点已经达到了一个精彩的、合乎逻辑的结局，请给出一个收尾性的段落，并且将选项设置为空列表 `[]`。\n---\n\n用户选择：\"B. 召集残兵死战到底\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本或结局...\",\n  \"choices\": [\"新的选项X\", \"新的选项Y\"]\n}\n"}]}'
2025-09-23 21:38:31 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 1009
2025-09-23 21:38:31 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:38:31 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:38:31 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:38:31 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:38:31 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:38:31 | CRITICAL | core.llm_clients:generate:94 - [CURL COMMAND] curl --location 'https://new.wuxuai.com/v1/chat/completions' --header 'Accept: */*' --header 'Content-Type: application/json' --header 'User-Agent: PostmanRuntime/7.47.1' --header 'X-Stainless-Lang: python' --header 'X-Stainless-Package-Version: 1.65.5' --header 'X-Stainless-OS: Windows' --header 'X-Stainless-Arch: other:amd64' --header 'X-Stainless-Runtime: CPython' --header 'X-Stainless-Runtime-Version: 3.11.3' --header 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' --header 'Cache-Control: no-cache' --header 'Accept-Encoding: gzip, deflate, br' --header 'Connection: keep-alive' --header 'X-Stainless-Async: false' --header 'OpenAI-Organization: <openai.Omit object at 0x000001B71841DCD0>' --header 'OpenAI-Project: <openai.Omit object at 0x000001B718412110>' --data '{"model": "[自营]gemini-2.5-flash-lite-preview-06-17", "max_tokens": 800, "temperature": 0.1, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 'text'（字符串）和 'choices'（字符串数组）。当无法继续时，将 'choices' 设为 []。"}, {"role": "user", "content": "你是一个严格的JSON转换器。请将以下内容转换为一个严格的JSON对象，必须包含键 'text' (字符串) 和 'choices' (字符串数组)。如果没有选项，则 'choices' 设为 [].\n输出要求：仅输出JSON本体，不要使用Markdown代码块或任何额外文字。\n\n原始内容如下：\n<<<\n空响应次数达到上限\n请修改输入提示词\n>>>\n"}]}'
2025-09-23 21:38:35 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 445
2025-09-23 21:38:35 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:38:35 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:38:35 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:38:35 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:38:35 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:38:35 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-23 21:38:35 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-23 21:38:35 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:38:35 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:46:56 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:46:58 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:46:58 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:46:58 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:46:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:46:58 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:46:58 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:46:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:46:58 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:46:58 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:46:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:46:59 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:46:59 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:46:59 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:46:59 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:46:59 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:49:31 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:49:32 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:49:32 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:49:32 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:49:32 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:49:32 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:49:32 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:49:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:49:32 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:49:32 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:49:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:49:33 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:49:33 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:49:33 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:49:33 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:49:33 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:50:46 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:50:48 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:50:48 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:50:48 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:50:48 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:50:48 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:50:48 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:50:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:50:48 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:50:48 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:50:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:50:49 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:50:49 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:50:49 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:50:49 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:50:49 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:50:55 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:50:57 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:50:57 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:50:57 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:50:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:50:57 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:50:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:50:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:50:57 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:50:57 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:50:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:50:58 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:50:58 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:50:58 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:50:58 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:50:58 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:51:36 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:51:38 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:51:38 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:51:38 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:51:38 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:51:38 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:51:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:51:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:51:38 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:51:38 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:51:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:51:39 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:51:39 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:51:39 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:51:39 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:51:39 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:56:32 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:56:34 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:56:34 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:56:34 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:56:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:56:34 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:56:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:56:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:56:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:56:34 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:56:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:56:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:56:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:56:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:56:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:56:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:56:57 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:57:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:57:01 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:57:01 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:57:01 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:57:01 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:57:01 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:57:01 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:57:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:57:01 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:57:01 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:57:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:57:02 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:57:02 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:57:02 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:57:02 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:57:02 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 21:58:08 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-23 21:58:08 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-23 21:58:08 | INFO     | database.crud:prune_story_after_node:235 - 节点 9 没有后代，无需删除。
2025-09-23 21:58:08 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-23 21:58:10 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 以虞姬为饵诱敌深入
2025-09-23 21:58:10 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 以虞姬为饵诱敌深入
2025-09-23 21:58:10 | ERROR    | core.llm_clients:_build_curl_command:182 - 写入 cURL 调试日志失败: 'Settings' object has no attribute 'BASE_DIR'
2025-09-23 21:58:10 | CRITICAL | core.llm_clients:generate:94 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000020ECE9AB350>' -H 'OpenAI-Project: <openai.Omit object at 0x0000020ECE9F1C50>' --data-raw '{"model": "[自营]gemini-2.5-flash-lite-preview-06-17", "max_tokens": 500, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点，或者一个恰当的结局\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n\n---\n【重要规则】\n- 如果你认为故事可以继续发展，请在结尾提供2到3个清晰、有意义的行动选项。\n- 如果你认为故事在当前节点已经达到了一个精彩的、合乎逻辑的结局，请给出一个收尾性的段落，并且将选项设置为空列表 `[]`。\n---\n\n用户选择：\"以虞姬为饵诱敌深入\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本或结局...\",\n  \"choices\": [\"新的选项X\", \"新的选项Y\"]\n}\n"}]}'
2025-09-23 21:58:51 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 804
2025-09-23 21:58:51 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:58:51 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:58:51 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 21:58:51 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 21:58:51 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 21:58:51 | ERROR    | core.llm_clients:_build_curl_command:182 - 写入 cURL 调试日志失败: 'Settings' object has no attribute 'BASE_DIR'
2025-09-23 21:58:51 | CRITICAL | core.llm_clients:generate:94 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000020ECE85F750>' -H 'OpenAI-Project: <openai.Omit object at 0x0000020ECEB64E90>' --data-raw '{"model": "[自营]gemini-2.5-flash-lite-preview-06-17", "max_tokens": 800, "temperature": 0.1, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "你是一个严格的JSON转换器。请将以下内容转换为一个严格的JSON对象，必须包含键 '"'"'text'"'"' (字符串) 和 '"'"'choices'"'"' (字符串数组)。如果没有选项，则 '"'"'choices'"'"' 设为 [].\n输出要求：仅输出JSON本体，不要使用Markdown代码块或任何额外文字。\n\n原始内容如下：\n<<<\n空响应次数达到上限\n请修改输入提示词\n>>>\n"}]}'
2025-09-23 21:58:57 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 584
2025-09-23 21:58:57 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:58:57 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 21:58:57 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 21:58:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 21:58:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 21:58:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-23 21:58:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-23 21:58:57 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 21:58:57 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 21:59:53 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 21:59:55 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 21:59:55 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:59:55 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 21:59:55 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 21:59:55 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 21:59:55 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:59:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:59:55 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 21:59:55 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 21:59:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 21:59:56 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 21:59:56 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 21:59:56 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 21:59:56 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 21:59:56 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:02:22 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:02:24 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:02:24 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:02:24 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:02:24 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:02:24 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:02:24 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:02:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:02:24 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:02:24 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:02:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:02:25 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:02:25 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:02:25 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:02:25 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:02:25 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:03:23 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:03:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:03:28 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:03:28 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:03:28 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:03:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:03:28 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:03:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:03:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:03:28 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:03:28 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:03:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:03:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:03:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:03:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:03:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:03:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:03:50 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-23 22:03:50 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-23 22:03:50 | INFO     | database.crud:prune_story_after_node:231 - 节点 9 的所有后代节点 [86] 将被删除。
2025-09-23 22:03:50 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-23 22:03:52 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 率八百骑直破汉军大阵
2025-09-23 22:03:52 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 率八百骑直破汉军大阵
2025-09-23 22:03:52 | CRITICAL | core.llm_clients:generate:94 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000021139D32E50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000021139C06E90>' --data-raw '{"model": "[自营]gemini-2.5-flash-lite-preview-06-17", "max_tokens": 500, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点，或者一个恰当的结局\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n\n---\n【重要规则】\n- 如果你认为故事可以继续发展，请在结尾提供2到3个清晰、有意义的行动选项。\n- 如果你认为故事在当前节点已经达到了一个精彩的、合乎逻辑的结局，请给出一个收尾性的段落，并且将选项设置为空列表 `[]`。\n---\n\n用户选择：\"率八百骑直破汉军大阵\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本或结局...\",\n  \"choices\": [\"新的选项X\", \"新的选项Y\"]\n}\n"}]}'
2025-09-23 22:05:07 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 807
2025-09-23 22:05:07 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 22:05:07 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 22:05:07 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 22:05:07 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=18 预览='空响应次数达到上限\n请修改输入提示词'
2025-09-23 22:05:07 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 22:05:07 | CRITICAL | core.llm_clients:generate:94 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000021139C021D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000021139D62390>' --data-raw '{"model": "[自营]gemini-2.5-flash-lite-preview-06-17", "max_tokens": 800, "temperature": 0.1, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "你是一个严格的JSON转换器。请将以下内容转换为一个严格的JSON对象，必须包含键 '"'"'text'"'"' (字符串) 和 '"'"'choices'"'"' (字符串数组)。如果没有选项，则 '"'"'choices'"'"' 设为 [].\n输出要求：仅输出JSON本体，不要使用Markdown代码块或任何额外文字。\n\n原始内容如下：\n<<<\n空响应次数达到上限\n请修改输入提示词\n>>>\n"}]}'
2025-09-23 22:05:15 | INFO     | core.llm_clients:generate:127 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17, tokens使用: 441
2025-09-23 22:05:15 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 22:05:15 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=64 预览='```json\n{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}\n```'
2025-09-23 22:05:15 | DEBUG    | core.story_engine:_extract_json:40 - [JSON] 捕获到Markdown代码围栏，内层长度=52 预览='{\n  "text": "空响应次数达到上限\\n请修改输入提示词",\n  "choices": []\n}'
2025-09-23 22:05:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 18
2025-09-23 22:05:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 22:05:15 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-23 22:05:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-23 22:05:15 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 22:05:15 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 22:11:08 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:11:10 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:11:10 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:11:10 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:11:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:11:10 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:11:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:11:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:11:10 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:11:10 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:11:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:11:11 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:11:11 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:11:11 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:11:11 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:11:11 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:11:46 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:13:26 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:13:26 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:13:26 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:13:26 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:13:26 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:13:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:13:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:13:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:13:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:13:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:13:27 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:13:27 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:13:27 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:13:27 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-lite-preview-06-17
2025-09-23 22:13:27 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:13:43 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:15:11 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:15:11 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:15:11 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:15:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:15:11 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:15:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:15:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:15:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:15:11 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:15:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:15:12 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:15:12 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:15:12 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:15:12 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:15:12 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:15:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:15:13 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:15:13 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:15:13 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:15:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:15:13 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:15:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:15:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:15:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:15:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:15:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:15:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:15:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:15:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:15:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:15:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:16:16 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-23 22:16:16 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-23 22:16:16 | INFO     | database.crud:prune_story_after_node:231 - 节点 9 的所有后代节点 [87] 将被删除。
2025-09-23 22:16:16 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-23 22:16:18 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 率八百骑直破汉军大阵
2025-09-23 22:16:18 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 率八百骑直破汉军大阵
2025-09-23 22:16:18 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000013472816F90>' -H 'OpenAI-Project: <openai.Omit object at 0x000001347287AA50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点，或者一个恰当的结局\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n\n---\n【重要规则】\n- 如果你认为故事可以继续发展，请在结尾提供2到3个清晰、有意义的行动选项。\n- 如果你认为故事在当前节点已经达到了一个精彩的、合乎逻辑的结局，请给出一个收尾性的段落，并且将选项设置为空列表 `[]`。\n---\n\n用户选择：\"率八百骑直破汉军大阵\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本或结局...\",\n  \"choices\": [\"新的选项X\", \"新的选项Y\"]\n}\n"}]}'
2025-09-23 22:16:35 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1315
2025-09-23 22:16:35 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=0 预览=''
2025-09-23 22:16:35 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=0 预览=''
2025-09-23 22:16:35 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 22:16:35 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=0 预览=''
2025-09-23 22:16:35 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 22:16:35 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-MKRcTuU296AOOQNz5wtNpG5J4R2hJyeNsAMLnU2g3CMYSDoI' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001347288B510>' -H 'OpenAI-Project: <openai.Omit object at 0x000001347288F790>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.1, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "你是一个严格的JSON转换器。请将以下内容转换为一个严格的JSON对象，必须包含键 '"'"'text'"'"' (字符串) 和 '"'"'choices'"'"' (字符串数组)。如果没有选项，则 '"'"'choices'"'"' 设为 [].\n输出要求：仅输出JSON本体，不要使用Markdown代码块或任何额外文字。\n\n原始内容如下：\n<<<\n\n>>>\n"}]}'
2025-09-23 22:16:35 | ERROR    | core.story_engine:_attempt_json_fix:139 - [JSON-FIX] 修复失败: Error code: 401 - {'error': {'message': '无效的令牌 (request id: 20250923221635353328074E14e9VsS) (request id: 20250923141635304175870BAhRJjre)', 'type': 'new_api_error', 'param': '', 'code': ''}}; 原始预览=''
2025-09-23 22:16:35 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Error code: 401 - {'error': {'message': '无效的令牌 (request id: 20250923221635353328074E14e9VsS) (request id: 20250923141635304175870BAhRJjre)', 'type': 'new_api_error', 'param': '', 'code': ''}}
2025-09-23 22:20:20 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:20:22 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:20:22 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:20:22 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:20:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:20:22 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:20:22 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:22 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:20:22 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:20:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:23 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:20:23 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:20:23 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:20:23 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:20:23 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:20:23 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:20:25 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:20:25 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:20:25 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:20:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:20:25 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:20:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:25 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:20:25 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:20:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:20:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:20:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:20:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:20:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:20:26 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:20:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:46 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:20:46 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:20:46 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:20:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:20:46 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:20:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:20:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:20:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:20:47 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:20:47 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:20:47 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:20:47 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:20:47 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:20:55 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 以虞姬为饵诱敌深入
2025-09-23 22:20:55 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 以虞姬为饵诱敌深入
2025-09-23 22:20:55 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001E1FF885290>' -H 'OpenAI-Project: <openai.Omit object at 0x000001E1FFA6B390>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点，或者一个恰当的结局\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n\n---\n【重要规则】\n- 如果你认为故事可以继续发展，请在结尾提供2到3个清晰、有意义的行动选项。\n- 如果你认为故事在当前节点已经达到了一个精彩的、合乎逻辑的结局，请给出一个收尾性的段落，并且将选项设置为空列表 `[]`。\n---\n\n用户选择：\"以虞姬为饵诱敌深入\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本或结局...\",\n  \"choices\": [\"新的选项X\", \"新的选项Y\"]\n}\n"}]}'
2025-09-23 22:21:13 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1313
2025-09-23 22:21:13 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=0 预览=''
2025-09-23 22:21:13 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=0 预览=''
2025-09-23 22:21:13 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-23 22:21:13 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=0 预览=''
2025-09-23 22:21:13 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-23 22:21:13 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001E1FFA6D310>' -H 'OpenAI-Project: <openai.Omit object at 0x000001E1FFA813D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.1, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "你是一个严格的JSON转换器。请将以下内容转换为一个严格的JSON对象，必须包含键 '"'"'text'"'"' (字符串) 和 '"'"'choices'"'"' (字符串数组)。如果没有选项，则 '"'"'choices'"'"' 设为 [].\n输出要求：仅输出JSON本体，不要使用Markdown代码块或任何额外文字。\n\n原始内容如下：\n<<<\n\n>>>\n"}]}'
2025-09-23 22:21:19 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 625
2025-09-23 22:21:19 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=37 预览='{\n    "text": "",\n    "choices": []\n}'
2025-09-23 22:21:19 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=37 预览='{\n    "text": "",\n    "choices": []\n}'
2025-09-23 22:21:19 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=37 预览='{\n    "text": "",\n    "choices": []\n}'
2025-09-23 22:21:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 0
2025-09-23 22:21:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-23 22:21:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-23 22:21:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-23 22:21:19 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-23 22:21:19 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-23 22:25:46 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: '\n  "level_title"'
2025-09-23 22:27:05 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:27:07 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:27:07 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:27:07 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:27:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:27:07 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:27:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:27:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:27:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:27:07 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:27:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:27:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:27:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:27:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:27:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:27:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:28:04 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000027B0D78A090>' -H 'OpenAI-Project: <openai.Omit object at 0x0000027B0D78A7D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名优秀的游戏关卡设计师。请根据用户的重生愿望，为第一关生成结构化的关卡元信息。\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（100-150字），描述此关的时代、地点、主要冲突或氛围。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字）。\n\n用户重生愿望：\"魔法师\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-23 22:28:17 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1083
2025-09-23 22:28:17 | ERROR    | api.story:prepare_start_level:83 - 解析关卡元信息失败: Expecting value: line 1 column 1 (char 0); 原始响应: 
2025-09-23 22:31:20 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:31:22 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:31:22 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:31:22 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:31:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:31:22 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:31:22 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:31:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:31:22 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:31:22 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:31:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:31:23 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:31:23 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:31:23 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:31:23 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:31:23 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:31:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:31:31 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:31:31 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:31:31 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:31:31 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:31:31 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:31:31 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:31:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:31:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:31:31 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:31:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:31:32 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:31:32 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:31:32 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:31:32 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:31:32 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-23 22:33:39 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-23 22:33:41 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-23 22:33:41 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:33:41 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-23 22:33:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-23 22:33:41 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-23 22:33:41 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:33:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:33:41 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-23 22:33:41 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-23 22:33:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-23 22:33:42 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-23 22:33:42 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-23 22:33:42 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-23 22:33:42 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-23 22:33:42 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:13:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:13:24 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:13:24 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:13:24 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:13:24 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:13:25 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:13:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:13:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:13:25 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:13:25 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:13:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:13:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:13:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:13:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:13:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:13:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:14:56 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 01:14:56 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 01:14:56 | INFO     | database.crud:prune_story_after_node:231 - 节点 9 的所有后代节点 [88] 将被删除。
2025-09-24 01:14:56 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 01:14:58 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 率八百骑直破汉军大阵
2025-09-24 01:14:58 | INFO     | core.story_engine:continue_story:180 - 继续故事，用户选择: 率八百骑直破汉军大阵
2025-09-24 01:14:58 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000002472AA53D90>' -H 'OpenAI-Project: <openai.Omit object at 0x000002472AD508D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点，或者一个恰当的结局\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n\n---\n【重要规则】\n- 如果你认为故事可以继续发展，请在结尾提供2到3个清晰、有意义的行动选项。\n- 如果你认为故事在当前节点已经达到了一个精彩的、合乎逻辑的结局，请给出一个收尾性的段落，并且将选项设置为空列表 `[]`。\n---\n\n用户选择：\"率八百骑直破汉军大阵\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本或结局...\",\n  \"choices\": [\"新的选项X\", \"新的选项Y\"]\n}\n"}]}'
2025-09-24 01:15:10 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1315
2025-09-24 01:15:10 | INFO     | core.story_engine:continue_story:187 - [LLM raw][continue] 长度=0 预览=''
2025-09-24 01:15:10 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=0 预览=''
2025-09-24 01:15:10 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-24 01:15:10 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=0 预览=''
2025-09-24 01:15:10 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-24 01:15:10 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000002472AD85FD0>' -H 'OpenAI-Project: <openai.Omit object at 0x000002472AD8F210>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.1, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "你是一个严格的JSON转换器。请将以下内容转换为一个严格的JSON对象，必须包含键 '"'"'text'"'"' (字符串) 和 '"'"'choices'"'"' (字符串数组)。如果没有选项，则 '"'"'choices'"'"' 设为 [].\n输出要求：仅输出JSON本体，不要使用Markdown代码块或任何额外文字。\n\n原始内容如下：\n<<<\n\n>>>\n"}]}'
2025-09-24 01:15:17 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 591
2025-09-24 01:15:17 | DEBUG    | core.story_engine:_attempt_json_fix:135 - [JSON-FIX] 修复返回长度=33 预览='{\n  "text": "",\n  "choices": []\n}'
2025-09-24 01:15:17 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=33 预览='{\n  "text": "",\n  "choices": []\n}'
2025-09-24 01:15:17 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=33 预览='{\n  "text": "",\n  "choices": []\n}'
2025-09-24 01:15:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 0
2025-09-24 01:15:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 01:15:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-24 01:15:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-24 01:15:17 | INFO     | core.story_engine:continue_story:211 - 故事继续生成成功
2025-09-24 01:15:17 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 01:16:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:16:46 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:16:46 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:16:46 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:16:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:16:46 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:16:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:16:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:16:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:16:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:16:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:16:47 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:16:47 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:16:47 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:16:47 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:16:47 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:16:52 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:16:54 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:16:54 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:16:54 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:16:54 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:16:54 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:16:54 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:16:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:16:54 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:16:54 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:16:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:16:55 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:16:55 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:16:55 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:16:55 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:16:55 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:17:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:17:05 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-your-new-api-key-here', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:17:05 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:17:05 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:17:05 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:17:05 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:17:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:17:05 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:17:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:06 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:17:06 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:17:06 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:17:06 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:17:06 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:17:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:17:13 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:17:13 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:17:13 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:17:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:17:13 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:17:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:17:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:17:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:17:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:17:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:17:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:17:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:17:18 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:17:19 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:17:19 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:17:19 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:17:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:17:19 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:17:19 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:19 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:17:19 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:17:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:17:20 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:17:20 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:17:20 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:17:20 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:17:20 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:26:33 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:26:34 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:26:34 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:26:34 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:26:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:26:34 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:26:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:26:35 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:26:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:26:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:26:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:26:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:26:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:26:38 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:26:39 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:26:39 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:26:39 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:26:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:26:39 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:26:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:39 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:26:39 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:26:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:40 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:26:40 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:26:40 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:26:40 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:26:40 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:26:47 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:26:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:52 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:26:52 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:26:52 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:26:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:26:52 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:26:52 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:52 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:26:52 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:26:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:26:52 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:26:52 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:26:52 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:26:52 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:26:52 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:27:06 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 01:27:06 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 01:27:06 | INFO     | database.crud:prune_story_after_node:231 - 节点 9 的所有后代节点 [89] 将被删除。
2025-09-24 01:27:06 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 01:27:56 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 01:27:56 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 01:27:56 | INFO     | database.crud:prune_story_after_node:235 - 节点 9 没有后代，无需删除。
2025-09-24 01:27:56 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 01:27:58 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 率八百骑直破汉军大阵
2025-09-24 01:27:58 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 率八百骑直破汉军大阵
2025-09-24 01:27:58 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001E15BEF2650>' -H 'OpenAI-Project: <openai.Omit object at 0x000001E15BEF2C50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 800, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。请根据下面的故事历史和用户刚刚做出的选择，继续撰写故事。\n\n故事要求：\n1. 新的故事情节应该是对用户选择的直接回应\n2. 将故事推向一个新的高潮、转折点或重要情节发展\n3. 文字要生动有趣，富有画面感，大约200-300字\n4. 保持故事的连贯性和逻辑性\n5. 创造足够的深度和复杂性，让故事能够持续发展\n\n---\n【重要规则 - 故事长度控制】\n- 除非故事已经经历了至少8-10个重要情节节点，否则绝对不要结束故事\n- 每个故事应该包含多个章节：初始设定→发展冲突→遇到挑战→解决问题→新的转折→高潮→解决→结局\n- 只有在故事真正达到了一个完整的故事弧线（包含完整的起承转合）时才能结束\n- 如果当前故事节点数少于8个，必须继续发展情节，提供2-3个行动选项\n- 优先创造新的冲突、挑战或转折点，而不是急于结束故事\n\n故事继续规则：\n- 大部分情况下，请提供2到3个清晰、有意义的行动选项来继续故事\n- 只有在故事经历了充分发展，主角完成了重大成长，主要冲突得到解决，且达到了自然的故事终点时，才可以将选项设置为空列表 `[]`\n---\n\n用户选择：\"率八百骑直破汉军大阵\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的新的故事文本，确保有足够的情节发展...\",\n  \"choices\": [\"继续选项A\", \"继续选项B\", \"继续选项C\"]\n}\n"}]}'
2025-09-24 01:28:09 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1461
2025-09-24 01:28:09 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=0 预览=''
2025-09-24 01:28:09 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=0 预览=''
2025-09-24 01:28:09 | WARNING  | core.story_engine:_extract_json:47 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-24 01:28:09 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=0 预览=''
2025-09-24 01:28:09 | WARNING  | core.story_engine:_parse_llm_response:87 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-24 01:28:09 | ERROR    | core.story_engine:_attempt_json_fix:123 - [JSON-FIX] 原始响应为空或太短，无法修复: ''
2025-09-24 01:28:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 27
2025-09-24 01:28:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 01:28:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-24 01:28:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-24 01:28:09 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 01:28:09 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 01:28:24 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 01:28:24 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 01:28:24 | INFO     | database.crud:prune_story_after_node:231 - 节点 9 的所有后代节点 [90] 将被删除。
2025-09-24 01:28:24 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 01:32:54 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:32:56 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:32:56 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:32:56 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:32:56 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:32:56 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:32:56 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:32:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:32:56 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:32:56 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:32:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:32:57 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:32:57 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:32:57 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:32:57 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:32:57 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:33:41 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:33:42 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:33:42 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:33:42 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:33:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:33:42 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:33:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:33:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:33:43 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:33:43 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:33:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:33:43 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:33:43 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:33:43 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:33:43 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:33:43 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:33:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:33:45 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:33:45 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:33:45 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:33:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:33:45 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:33:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:33:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:33:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:33:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:33:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:33:46 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:33:46 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:33:46 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:33:46 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:33:46 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:34:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:34:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:07 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:34:07 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:34:07 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:34:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:34:07 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:34:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:34:07 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:34:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:34:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:34:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:34:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:34:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:34:49 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 01:34:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:53 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 01:34:53 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:34:53 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 01:34:53 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 01:34:53 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 01:34:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:53 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 01:34:53 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 01:34:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 01:34:54 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 01:34:54 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 01:34:54 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 01:34:54 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 01:34:54 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 01:35:02 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 率八百骑直破汉军大阵
2025-09-24 01:35:02 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 率八百骑直破汉军大阵
2025-09-24 01:35:02 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001D511BFB690>' -H 'OpenAI-Project: <openai.Omit object at 0x000001D511A7B290>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的长篇故事大师，擅长构建曲折、多章节的冒险史诗。\n请根据下面的故事历史和用户的选择，继续撰写这个长篇故事。\n\n核心任务：\n1.  **自然地推进情节**：对用户的选择做出直接且富有创意的回应。\n2.  **创造悬念和深度**：引入新的冲突、谜团、盟友或敌人，让故事至少能发展8到15个章节。\n3.  **保持生动**：文字富有画面感，大约200-300字。\n\n【重要心法：如何创作一个伟大的长篇故事】\n*   **拒绝短视**：不要急于求成！一个好的故事需要铺垫和发展。过早的结局是对玩家的不尊重。\n*   **制造波澜**：一个选择不应该直接导致最终胜利或失败。它应该通往新的挑战或机遇。\n*   **给予有意义的选择**：在故事的结尾，你必须提供2到3个引导故事走向不同可能性的行动选项。\n\n【惩罚机制】\n如果故事在6个章节内就结束（即choices为空列表），这将被视为一次“失败”的创作，因为它剥夺了玩家的体验。请尽一切努力避免这种情况。\n\n---\n用户选择：\"率八百骑直破汉军大阵\"\n---\n\n请严格按照以下 JSON 格式输出你的回答：\n{\n  \"text\": \"这里是你生成的新的故事文本...\",\n  \"choices\": [\"选择A\", \"选择B\", \"选择C\"]\n}\n"}]}'
2025-09-24 01:35:19 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1964
2025-09-24 01:35:19 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=398 预览='{\n  "text": "“匹夫之勇！”项羽心中怒吼，那不是虞姬，只是幻象，是汉军的鬼蜮伎俩！但他宁愿相信这是虞姬最后的激励。他一把抓起霸王枪，冲出帐外，声如惊雷：“江东子弟，可愿随我作最后一战！”残存的八百骑兵眼中重燃死志，纷纷上马。没有战鼓，没有号角，只有八百颗赴死之心。项羽一马当先，如黑色闪电撕裂夜幕，直冲汉军最密集的中军大营。汉军阵脚大乱，楚骑所过之处，人仰马翻，血肉横飞。他们竟真的凿穿了第一道防线！然而，胜利的曙光并未出现。前方豁然开朗，却是一片被火把照亮的空旷谷地，两侧山壁上，无数弓弩手早已引弦待发。韩信的身影立于山巅，月光下，他的嘴角似乎挂着一丝冰冷的微笑。这并非突围，而是一场精'
2025-09-24 01:35:19 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=398 预览='{\n  "text": "“匹夫之勇！”项羽心中怒吼，那不是虞姬，只是幻象，是汉军的鬼蜮伎俩！但他宁愿相信这是虞姬最后的激励。他一把抓起霸王枪，冲出帐外，声如惊雷：“江东子弟，可愿随我作最后一战！”残存的八百骑兵眼中重燃死志，纷纷上马。没有战鼓，没有号角，只有八百颗赴死之心。项羽一马当先，如黑色闪电撕裂夜幕，直冲汉军最'
2025-09-24 01:35:19 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=398 预览='{\n  "text": "“匹夫之勇！”项羽心中怒吼，那不是虞姬，只是幻象，是汉军的鬼蜮伎俩！但他宁愿相信这是虞姬最后的激励。他一把抓起霸王枪，冲出帐外，声如惊雷：“江东子弟，可愿随我作最后一战！”残存的八百骑兵眼中重燃死志，纷纷上马。没有战鼓，没有号角，只有八百颗赴死之心。项羽一马当先，如黑色闪电撕裂夜幕，直冲汉军最'
2025-09-24 01:35:19 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=398 预览='{\n  "text": "“匹夫之勇！”项羽心中怒吼，那不是虞姬，只是幻象，是汉军的鬼蜮伎俩！但他宁愿相信这是虞姬最后的激励。他一把抓起霸王枪，冲出帐外，声如惊雷：“江东子弟，可愿随我作最后一战！”残存的八百骑兵眼中重燃死志，纷纷上马。没有战鼓，没有号角，只有八百颗赴死之心。项羽一马当先，如黑色闪电撕裂夜幕，直冲汉军最密集的中军大营。汉军阵脚大乱，楚骑所过之处，人仰马翻，血肉横飞。他们竟真的凿穿了'
2025-09-24 01:35:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 294
2025-09-24 01:35:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 01:35:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-24 01:35:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-24 01:35:19 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 01:35:19 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 13:33:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 13:33:12 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 13:33:12 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 13:33:12 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 13:33:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 13:33:12 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 13:33:12 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 13:33:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 13:33:12 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 13:33:12 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 13:33:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 13:33:13 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 13:33:13 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 13:33:13 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 13:33:13 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 13:33:13 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 13:34:41 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 13:34:41 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 13:34:41 | INFO     | database.crud:prune_story_after_node:231 - 节点 9 的所有后代节点 [91] 将被删除。
2025-09-24 13:34:41 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 13:34:55 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 8
2025-09-24 13:34:55 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 8 之后进行时空回溯...
2025-09-24 13:34:55 | INFO     | database.crud:prune_story_after_node:235 - 节点 8 没有后代，无需删除。
2025-09-24 13:34:55 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 8。
2025-09-24 13:34:56 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 启动家族禁术虚空防御
2025-09-24 13:34:56 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 启动家族禁术虚空防御
2025-09-24 13:34:56 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000002A3F823D590>' -H 'OpenAI-Project: <openai.Omit object at 0x000002A3F850E450>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "星陨魔法学院的礼堂穹顶缀满星辰符文，中央悬浮的召唤阵正发出濒死的暗红微光。艾拉指尖渗出冷汗，前世在此刻因魔力暴走撕裂空间，被永恒黑暗吞噬的剧痛仿佛还卡在喉间——她重生了，回到了毕业考核的最后三分钟。‘艾拉同学，你的元素共鸣已失控，放弃吧。’首席导师的声音像淬冰的长矛。她攥紧掌心的魔晶杖，杖身刻着的家族纹章正发烫——那是前世她偷偷刻下的求救印记，此刻却像个嘲讽的笑话。魔法阵突然剧烈震颤，一道黑影从阵眼裂缝中钻出，是她最恐惧的‘虚空残响’！艾拉的瞳孔骤然收缩，她必须在黑影吞噬前做出选择。"}, {"role": "user", "content": "\n你是一位富有想象力的长篇故事大师，擅长构建曲折、多章节的冒险史诗。\n请根据下面的故事历史和用户的选择，继续撰写这个长篇故事。\n\n核心任务：\n1.  **自然地推进情节**：对用户的选择做出直接且富有创意的回应。\n2.  **创造悬念和深度**：引入新的冲突、谜团、盟友或敌人，让故事至少能发展8到15个章节。\n3.  **保持生动**：文字富有画面感，大约200-300字。\n\n【重要心法：如何创作一个伟大的长篇故事】\n*   **拒绝短视**：不要急于求成！一个好的故事需要铺垫和发展。过早的结局是对玩家的不尊重。\n*   **制造波澜**：一个选择不应该直接导致最终胜利或失败。它应该通往新的挑战或机遇。\n*   **给予有意义的选择**：在故事的结尾，你必须提供2到3个引导故事走向不同可能性的行动选项。\n\n【惩罚机制】\n如果故事在6个章节内就结束（即choices为空列表），这将被视为一次“失败”的创作，因为它剥夺了玩家的体验。请尽一切努力避免这种情况。\n\n---\n用户选择：\"启动家族禁术虚空防御\"\n---\n\n请严格按照以下 JSON 格式输出你的回答：\n{\n  \"text\": \"这里是你生成的新的故事文本...\",\n  \"choices\": [\"选择A\", \"选择B\", \"选择C\"]\n}\n"}]}'
2025-09-24 13:35:11 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1822
2025-09-24 13:35:11 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=432 预览='{\n  "text": "没有丝毫犹豫，艾拉咬破指尖，将一滴殷红的鲜血抹在魔晶杖的家族纹章上。那不是求救的印记，而是禁术的钥匙！纹章没有发出预想中的圣光，反而爆发出一种吞噬光线的银灰色光芒，宛如一轮微缩的寂灭星辰。礼堂内的空气瞬间变得粘稠，虚空残响发出的尖啸被无形的力量扭曲、拉长，它漆黑的身体像是被投入了看不见的漩涡，寸寸分解，化作最纯粹的暗影粒子被吸入杖端的纹章之中。然而，这股力量远超艾拉的控制。魔晶杖发出一声哀鸣，裂开一道蛛网般的缝隙。被吸收的虚空能量并未消散，反而与她的血脉魔力激烈碰撞、融合，最终在杖顶凝结成一枚指甲盖大小、散发着银紫双色光晕的棱形水晶。首席导师惊骇地瞪大了眼睛，失声喊道'
2025-09-24 13:35:11 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=432 预览='{\n  "text": "没有丝毫犹豫，艾拉咬破指尖，将一滴殷红的鲜血抹在魔晶杖的家族纹章上。那不是求救的印记，而是禁术的钥匙！纹章没有发出预想中的圣光，反而爆发出一种吞噬光线的银灰色光芒，宛如一轮微缩的寂灭星辰。礼堂内的空气瞬间变得粘稠，虚空残响发出的尖啸被无形的力量扭曲、拉长，它漆黑的身体像是被投入了看不见的漩涡，'
2025-09-24 13:35:11 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=432 预览='{\n  "text": "没有丝毫犹豫，艾拉咬破指尖，将一滴殷红的鲜血抹在魔晶杖的家族纹章上。那不是求救的印记，而是禁术的钥匙！纹章没有发出预想中的圣光，反而爆发出一种吞噬光线的银灰色光芒，宛如一轮微缩的寂灭星辰。礼堂内的空气瞬间变得粘稠，虚空残响发出的尖啸被无形的力量扭曲、拉长，它漆黑的身体像是被投入了看不见的漩涡，'
2025-09-24 13:35:11 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=432 预览='{\n  "text": "没有丝毫犹豫，艾拉咬破指尖，将一滴殷红的鲜血抹在魔晶杖的家族纹章上。那不是求救的印记，而是禁术的钥匙！纹章没有发出预想中的圣光，反而爆发出一种吞噬光线的银灰色光芒，宛如一轮微缩的寂灭星辰。礼堂内的空气瞬间变得粘稠，虚空残响发出的尖啸被无形的力量扭曲、拉长，它漆黑的身体像是被投入了看不见的漩涡，寸寸分解，化作最纯粹的暗影粒子被吸入杖端的纹章之中。然而，这股力量远超艾拉的控制'
2025-09-24 13:35:11 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 330
2025-09-24 13:35:11 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 13:35:11 | INFO     | core.image_service:find_image_in_library:68 - 根据关键字 '没有丝毫犹豫，艾拉咬破指尖，将一滴殷红的...' 匹配到图片: magic_forest.jpg
2025-09-24 13:35:11 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-24 13:35:11 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 13:35:11 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 14:07:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:07:57 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 14:07:57 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:07:57 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 14:07:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 14:07:57 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 14:07:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:07:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:07:57 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 14:07:57 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 14:07:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:07:58 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 14:07:58 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 14:07:58 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 14:07:58 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:07:58 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 14:08:41 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 14:08:41 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 14:08:41 | INFO     | database.crud:prune_story_after_node:235 - 节点 9 没有后代，无需删除。
2025-09-24 14:08:41 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 14:28:57 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 14:28:59 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 14:28:59 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:28:59 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 14:28:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 14:28:59 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 14:28:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:28:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:28:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 14:28:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 14:29:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:29:00 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 14:29:00 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 14:29:00 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 14:29:00 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:29:00 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 14:40:02 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 14:40:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:40:07 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 14:40:07 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:40:07 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 14:40:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 14:40:07 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 14:40:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:40:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:40:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 14:40:07 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 14:40:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:40:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 14:40:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 14:40:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 14:40:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:40:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 14:40:46 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 9
2025-09-24 14:40:46 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 9 之后进行时空回溯...
2025-09-24 14:40:46 | INFO     | database.crud:prune_story_after_node:235 - 节点 9 没有后代，无需删除。
2025-09-24 14:40:46 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 9。
2025-09-24 14:40:49 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 率八百骑直破汉军大阵
2025-09-24 14:40:49 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 率八百骑直破汉军大阵
2025-09-24 14:40:49 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000024DF7B5EDD0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000024DF7923950>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "user", "content": "\n你是一位富有想象力的长篇故事大师，擅长构建曲折、多章节的冒险史诗。\n请根据下面的故事历史和用户的选择，继续撰写这个长篇故事。\n\n核心任务：\n1.  **自然地推进情节**：对用户的选择做出直接且富有创意的回应。\n2.  **创造悬念和深度**：引入新的冲突、谜团、盟友或敌人，让故事至少能发展8到15个章节。\n3.  **保持生动**：文字富有画面感，大约200-300字。\n\n【重要心法：如何创作一个伟大的长篇故事】\n*   **拒绝短视**：不要急于求成！一个好的故事需要铺垫和发展。过早的结局是对玩家的不尊重。\n*   **制造波澜**：一个选择不应该直接导致最终胜利或失败。它应该通往新的挑战或机遇。\n*   **给予有意义的选择**：在故事的结尾，你必须提供2到3个引导故事走向不同可能性的行动选项。\n\n【惩罚机制】\n如果故事在6个章节内就结束（即choices为空列表），这将被视为一次“失败”的创作，因为它剥夺了玩家的体验。请尽一切努力避免这种情况。\n\n---\n用户选择：\"率八百骑直破汉军大阵\"\n---\n\n请严格按照以下 JSON 格式输出你的回答：\n{\n  \"text\": \"这里是你生成的新的故事文本...\",\n  \"choices\": [\"选择A\", \"选择B\", \"选择C\"]\n}\n"}]}'
2025-09-24 14:41:08 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2151
2025-09-24 14:41:08 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=356 预览='{\n  "text": "霸王枪在手，乌骓马长嘶！项羽怒吼如雷，仅存的八百江东子弟热血沸腾，随他化作一柄撕裂黑夜的利剑，直插入汉军阵中。铁蹄雷动，枪出如龙，汉军前阵瞬间被凿穿一个血色窟窿。然而，这正是韩信的计策。汉军如潮水般向两侧退开，非但没有溃散，反而像一张巨网，迅速收口，将这八百骑兵死死困在核心。四面八方，火把亮如白昼，长戟如林。正前方，一员汉将策马而出，旗帜上一个斗大的“灌”字在火光下分外刺眼。此人正是刘邦麾下最擅追击的骑兵将领——灌婴。他横槊立马，冷笑道：“霸王，天数已尽，何不早降？”项羽的突围之路，被这最坚韧的锁链挡住了。",\n  "choices": [\n    "迎战汉将灌婴，斩'
2025-09-24 14:41:08 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=356 预览='{\n  "text": "霸王枪在手，乌骓马长嘶！项羽怒吼如雷，仅存的八百江东子弟热血沸腾，随他化作一柄撕裂黑夜的利剑，直插入汉军阵中。铁蹄雷动，枪出如龙，汉军前阵瞬间被凿穿一个血色窟窿。然而，这正是韩信的计策。汉军如潮水般向两侧退开，非但没有溃散，反而像一张巨网，迅速收口，将这八百骑兵死死困在核心。四面八方，火把亮如'
2025-09-24 14:41:08 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=356 预览='{\n  "text": "霸王枪在手，乌骓马长嘶！项羽怒吼如雷，仅存的八百江东子弟热血沸腾，随他化作一柄撕裂黑夜的利剑，直插入汉军阵中。铁蹄雷动，枪出如龙，汉军前阵瞬间被凿穿一个血色窟窿。然而，这正是韩信的计策。汉军如潮水般向两侧退开，非但没有溃散，反而像一张巨网，迅速收口，将这八百骑兵死死困在核心。四面八方，火把亮如'
2025-09-24 14:41:08 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=356 预览='{\n  "text": "霸王枪在手，乌骓马长嘶！项羽怒吼如雷，仅存的八百江东子弟热血沸腾，随他化作一柄撕裂黑夜的利剑，直插入汉军阵中。铁蹄雷动，枪出如龙，汉军前阵瞬间被凿穿一个血色窟窿。然而，这正是韩信的计策。汉军如潮水般向两侧退开，非但没有溃散，反而像一张巨网，迅速收口，将这八百骑兵死死困在核心。四面八方，火把亮如白昼，长戟如林。正前方，一员汉将策马而出，旗帜上一个斗大的“灌”字在火光下分外刺'
2025-09-24 14:41:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 256
2025-09-24 14:41:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 14:41:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-24 14:41:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-24 14:41:08 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 14:41:08 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 14:59:16 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 14:59:17 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 14:59:17 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:59:17 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 14:59:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 14:59:17 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 14:59:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:59:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:59:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 14:59:18 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 14:59:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 14:59:19 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 14:59:19 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 14:59:19 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 14:59:19 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 14:59:19 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 15:24:04 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 15:24:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:24:09 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 15:24:09 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 15:24:09 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 15:24:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 15:24:09 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 15:24:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:24:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:24:09 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 15:24:09 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 15:24:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:24:10 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 15:24:10 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 15:24:10 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 15:24:10 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 15:24:10 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 15:25:08 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 93
2025-09-24 15:25:08 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 93 之后进行时空回溯...
2025-09-24 15:25:08 | INFO     | database.crud:prune_story_after_node:235 - 节点 93 没有后代，无需删除。
2025-09-24 15:25:08 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 93。
2025-09-24 15:25:11 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 不与纠缠，转向南山，寻机突围
2025-09-24 15:25:11 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 不与纠缠，转向南山，寻机突围
2025-09-24 15:25:11 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000025D14BBD750>' -H 'OpenAI-Project: <openai.Omit object at 0x0000025D14C05490>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "assistant", "content": "霸王枪在手，乌骓马长嘶！项羽怒吼如雷，仅存的八百江东子弟热血沸腾，随他化作一柄撕裂黑夜的利剑，直插入汉军阵中。铁蹄雷动，枪出如龙，汉军前阵瞬间被凿穿一个血色窟窿。然而，这正是韩信的计策。汉军如潮水般向两侧退开，非但没有溃散，反而像一张巨网，迅速收口，将这八百骑兵死死困在核心。四面八方，火把亮如白昼，长戟如林。正前方，一员汉将策马而出，旗帜上一个斗大的“灌”字在火光下分外刺眼。此人正是刘邦麾下最擅追击的骑兵将领——灌婴。他横槊立马，冷笑道：“霸王，天数已尽，何不早降？”项羽的突围之路，被这最坚韧的锁链挡住了。"}, {"role": "user", "content": "我选择了：率八百骑直破汉军大阵"}, {"role": "user", "content": "\n你是一位富有想象力的长篇故事大师，擅长构建曲折、多章节的冒险史诗。\n请根据下面的故事历史和用户的选择，继续撰写这个长篇故事。\n\n核心任务：\n1.  **自然地推进情节**：对用户的选择做出直接且富有创意的回应。\n2.  **创造悬念和深度**：引入新的冲突、谜团、盟友或敌人，让故事至少能发展8到15个章节。\n3.  **保持生动**：文字富有画面感，大约200-300字。\n\n【重要心法：如何创作一个伟大的长篇故事】\n*   **拒绝短视**：不要急于求成！一个好的故事需要铺垫和发展。过早的结局是对玩家的不尊重。\n*   **制造波澜**：一个选择不应该直接导致最终胜利或失败。它应该通往新的挑战或机遇。\n*   **给予有意义的选择**：在故事的结尾，你必须提供2到3个引导故事走向不同可能性的行动选项。\n\n【惩罚机制】\n如果故事在6个章节内就结束（即choices为空列表），这将被视为一次“失败”的创作，因为它剥夺了玩家的体验。请尽一切努力避免这种情况。\n\n---\n用户选择：\"不与纠缠，转向南山，寻机突围\"\n---\n\n请严格按照以下 JSON 格式输出你的回答：\n{\n  \"text\": \"这里是你生成的新的故事文本...\",\n  \"choices\": [\"选择A\", \"选择B\", \"选择C\"]\n}\n"}]}'
2025-09-24 15:25:32 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2509
2025-09-24 15:25:32 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=390 预览='{\n  "text": "“天数？我项羽的数，由我自己定！”项羽眼中杀意暴涨，却并未理会灌婴的叫嚣。与一员汉将缠斗，只会耽误突围的最后时机。他猛地一勒乌骓马，长枪指向南方连绵的黑色山影，对仅存的江东子弟嘶吼道：“向南山，求生路，随我冲！”这支残兵败将组成的锥形阵，如一道逆流的血色闪电，猛然转向，硬生生从汉军阵列的薄弱处撕开一道缺口。灌婴大怒，亲率精骑在后紧追不舍，箭矢如蝗，不断有楚军骑士惨叫落马。血路铺展至南山脚下，一条被浓雾笼罩的崎岖小径出现在眼前。然而，就在道口，竟立着一个手提青铜灯笼的灰袍老者，他神色平静，仿佛已在此等候多时。灯火摇曳，照不清他的面容，只映出他脚下一道深深的剑痕。汉军的喊'
2025-09-24 15:25:32 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=390 预览='{\n  "text": "“天数？我项羽的数，由我自己定！”项羽眼中杀意暴涨，却并未理会灌婴的叫嚣。与一员汉将缠斗，只会耽误突围的最后时机。他猛地一勒乌骓马，长枪指向南方连绵的黑色山影，对仅存的江东子弟嘶吼道：“向南山，求生路，随我冲！”这支残兵败将组成的锥形阵，如一道逆流的血色闪电，猛然转向，硬生生从汉军阵列的薄弱处'
2025-09-24 15:25:32 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=390 预览='{\n  "text": "“天数？我项羽的数，由我自己定！”项羽眼中杀意暴涨，却并未理会灌婴的叫嚣。与一员汉将缠斗，只会耽误突围的最后时机。他猛地一勒乌骓马，长枪指向南方连绵的黑色山影，对仅存的江东子弟嘶吼道：“向南山，求生路，随我冲！”这支残兵败将组成的锥形阵，如一道逆流的血色闪电，猛然转向，硬生生从汉军阵列的薄弱处'
2025-09-24 15:25:32 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=390 预览='{\n  "text": "“天数？我项羽的数，由我自己定！”项羽眼中杀意暴涨，却并未理会灌婴的叫嚣。与一员汉将缠斗，只会耽误突围的最后时机。他猛地一勒乌骓马，长枪指向南方连绵的黑色山影，对仅存的江东子弟嘶吼道：“向南山，求生路，随我冲！”这支残兵败将组成的锥形阵，如一道逆流的血色闪电，猛然转向，硬生生从汉军阵列的薄弱处撕开一道缺口。灌婴大怒，亲率精骑在后紧追不舍，箭矢如蝗，不断有楚军骑士惨叫落马。'
2025-09-24 15:25:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 295
2025-09-24 15:25:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 15:25:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-24 15:25:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-24 15:25:32 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 15:25:32 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 15:41:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 15:41:08 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 15:41:08 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 15:41:08 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 15:41:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 15:41:09 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 15:41:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:41:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:41:09 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 15:41:09 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 15:41:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:41:10 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 15:41:10 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 15:41:10 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 15:41:10 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 15:41:10 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 15:42:11 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 15:42:13 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 15:42:13 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 15:42:13 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 15:42:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 15:42:14 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 15:42:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:42:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:42:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 15:42:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 15:42:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 15:42:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 15:42:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 15:42:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 15:42:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 15:42:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 16:25:19 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 16:25:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:25:28 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 16:25:28 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:25:28 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 16:25:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 16:25:28 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 16:25:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:25:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:25:29 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 16:25:29 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 16:25:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:25:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 16:25:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 16:25:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 16:25:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:25:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 16:25:58 | INFO     | api.story:retry_from_node:304 - 收到时空回溯请求，目标节点: 93
2025-09-24 16:25:58 | INFO     | database.crud:prune_story_after_node:220 - 正在从节点 93 之后进行时空回溯...
2025-09-24 16:25:58 | INFO     | database.crud:prune_story_after_node:231 - 节点 93 的所有后代节点 [94] 将被删除。
2025-09-24 16:25:58 | INFO     | database.crud:prune_story_after_node:242 - 已成功完成回溯，当前故事线的终点为节点 93。
2025-09-24 16:26:00 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 不与纠缠，转向南山，寻机突围
2025-09-24 16:26:00 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 不与纠缠，转向南山，寻机突围
2025-09-24 16:26:00 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x00000275A6A9A4D0>' -H 'OpenAI-Project: <openai.Omit object at 0x00000275A6C72D10>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "垓下寒夜浸着血，项羽猛地坐起。帐外楚歌四起，却不是楚人的歌——是汉军唱的《楚声》。他摸向腰间，霸王枪斜倚在帐角，枪尖凝着霜。胸口旧伤隐隐作痛，恍惚间又看见虞姬自刎时颈间的红。帐外亲兵哭嚎着溃散，楚军只剩不足三千，韩信的十面埋伏如网。他攥紧拳头，指甲掐进掌心：若再败，便是身死国灭！帐外火光骤起，虞姬的身影在火中晃动，手中长剑直指汉军旗帜。项羽瞳孔骤缩——这一次，他该……"}, {"role": "assistant", "content": "霸王枪在手，乌骓马长嘶！项羽怒吼如雷，仅存的八百江东子弟热血沸腾，随他化作一柄撕裂黑夜的利剑，直插入汉军阵中。铁蹄雷动，枪出如龙，汉军前阵瞬间被凿穿一个血色窟窿。然而，这正是韩信的计策。汉军如潮水般向两侧退开，非但没有溃散，反而像一张巨网，迅速收口，将这八百骑兵死死困在核心。四面八方，火把亮如白昼，长戟如林。正前方，一员汉将策马而出，旗帜上一个斗大的“灌”字在火光下分外刺眼。此人正是刘邦麾下最擅追击的骑兵将领——灌婴。他横槊立马，冷笑道：“霸王，天数已尽，何不早降？”项羽的突围之路，被这最坚韧的锁链挡住了。"}, {"role": "user", "content": "我选择了：率八百骑直破汉军大阵"}, {"role": "user", "content": "\n你是一位富有想象力的长篇故事大师，擅长构建曲折、多章节的冒险史诗。\n请根据下面的故事历史和用户的选择，继续撰写这个长篇故事。\n\n核心任务：\n1.  **自然地推进情节**：对用户的选择做出直接且富有创意的回应。\n2.  **创造悬念和深度**：引入新的冲突、谜团、盟友或敌人，让故事至少能发展8到15个章节。\n3.  **保持生动**：文字富有画面感，大约200-300字。\n\n【重要心法：如何创作一个伟大的长篇故事】\n*   **拒绝短视**：不要急于求成！一个好的故事需要铺垫和发展。过早的结局是对玩家的不尊重。\n*   **制造波澜**：一个选择不应该直接导致最终胜利或失败。它应该通往新的挑战或机遇。\n*   **给予有意义的选择**：在故事的结尾，你必须提供2到3个引导故事走向不同可能性的行动选项。\n\n【惩罚机制】\n如果故事在6个章节内就结束（即choices为空列表），这将被视为一次“失败”的创作，因为它剥夺了玩家的体验。请尽一切努力避免这种情况。\n\n---\n用户选择：\"不与纠缠，转向南山，寻机突围\"\n---\n\n请严格按照以下 JSON 格式输出你的回答：\n{\n  \"text\": \"这里是你生成的新的故事文本...\",\n  \"choices\": [\"选择A\", \"选择B\", \"选择C\"]\n}\n"}]}'
2025-09-24 16:26:17 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2146
2025-09-24 16:26:17 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=428 预览='{\n  "text": "“匹夫之勇！”项羽心中冷哼，并未理会灌婴的叫嚣。正面硬撼无异于以卵击石，他锐利的目光早已扫过整个战场，锁定了包围圈南侧的薄弱处——那里连接着连绵的阴陵山脉。他猛地一拨马头，霸王枪向南一指，怒吼道：“随我转南，入山突围！”八百骑兵令行禁止，如同一条巨蟒，瞬间调转方向，沿着包围圈的切线，向着那片漆黑的山影猛冲而去。灌婴见状大惊，他没想到项羽竟能在绝境中保持如此冷静的判断，立刻挥军追击。箭矢如蝗，从身后呼啸而来，不断有楚军骑士中箭落马。但剩下的人眼中没有恐惧，只有追随霸王的决绝。终于，他们一头扎进了山脚的密林，汉军的骑兵优势在此被大大削弱。然而，前方的山路崎岖难行，仅容数骑'
2025-09-24 16:26:17 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=428 预览='{\n  "text": "“匹夫之勇！”项羽心中冷哼，并未理会灌婴的叫嚣。正面硬撼无异于以卵击石，他锐利的目光早已扫过整个战场，锁定了包围圈南侧的薄弱处——那里连接着连绵的阴陵山脉。他猛地一拨马头，霸王枪向南一指，怒吼道：“随我转南，入山突围！”八百骑兵令行禁止，如同一条巨蟒，瞬间调转方向，沿着包围圈的切线，向着那片漆'
2025-09-24 16:26:17 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=428 预览='{\n  "text": "“匹夫之勇！”项羽心中冷哼，并未理会灌婴的叫嚣。正面硬撼无异于以卵击石，他锐利的目光早已扫过整个战场，锁定了包围圈南侧的薄弱处——那里连接着连绵的阴陵山脉。他猛地一拨马头，霸王枪向南一指，怒吼道：“随我转南，入山突围！”八百骑兵令行禁止，如同一条巨蟒，瞬间调转方向，沿着包围圈的切线，向着那片漆'
2025-09-24 16:26:17 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=428 预览='{\n  "text": "“匹夫之勇！”项羽心中冷哼，并未理会灌婴的叫嚣。正面硬撼无异于以卵击石，他锐利的目光早已扫过整个战场，锁定了包围圈南侧的薄弱处——那里连接着连绵的阴陵山脉。他猛地一拨马头，霸王枪向南一指，怒吼道：“随我转南，入山突围！”八百骑兵令行禁止，如同一条巨蟒，瞬间调转方向，沿着包围圈的切线，向着那片漆黑的山影猛冲而去。灌婴见状大惊，他没想到项羽竟能在绝境中保持如此冷静的判断，立刻'
2025-09-24 16:26:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 341
2025-09-24 16:26:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 16:26:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-24 16:26:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-24 16:26:17 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 16:26:17 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 16:27:56 | INFO     | api.user:logout_current_user:128 - 用户 690161230@qq.com 已登出，token_version -> 24
2025-09-24 16:28:07 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x00000275A6CBDD10>' -H 'OpenAI-Project: <openai.Omit object at 0x00000275A6CAEF10>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名优秀的游戏关卡设计师。请根据用户的重生愿望，为第一关生成结构化的关卡元信息。\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（100-150字），描述此关的时代、地点、主要冲突或氛围。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字）。\n\n用户重生愿望：\"习近平\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-24 16:28:27 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2269
2025-09-24 16:28:55 | INFO     | api.story:start_new_story:119 - 用户 4145a3a9-7b62-46d3-a15e-461775d5cfc7 收到新故事请求，愿望: 习近平
2025-09-24 16:28:55 | INFO     | core.story_engine:start_story:166 - 收到新的故事开始请求，愿望是: '习近平'
2025-09-24 16:28:55 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x00000275A6A53390>' -H 'OpenAI-Project: <openai.Omit object at 0x00000275A6CF7C90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力的故事大师。你的任务是根据用户的重生愿望，开启一段引人入胜的冒险故事。\n\n故事要求：\n1. 故事开头应该包含场景描述、主角的状态和一个即将面临的处境\n2. 文字要生动有趣，富有画面感，大约200-300字\n3. 在故事的结尾，你必须提供2到3个清晰、有意义的行动选项\n4. 选项要简洁明了，每个选项不超过15字\n5. 营造紧张感和期待感，让用户想要继续探索\n\n用户重生愿望：\"习近平\"\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"choices\": [\"选项A\", \"选项B\", \"选项C\"]\n}\n"}]}'
2025-09-24 16:29:14 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1933
2025-09-24 16:29:14 | INFO     | core.story_engine:start_story:173 - [LLM raw][start] 长度=459 预览='{\n  "text": "刺骨的寒风卷着黄沙，从窑洞的破旧窗棂中灌入，让你猛地打了个寒颤。你挣扎着从冰冷的土炕上坐起，环顾四周——土坯墙壁，昏暗的油灯，空气中弥漫着一股尘土与汗水的混合气味。记忆的碎片如潮水般涌来：这里是1969年的梁家河，一个黄土高原上贫瘠的村庄，而你，不再是21世纪的普通人，而是那个未来将要登上权力之巅的青年——习近平。\\n你的身体还残留着长途跋涉的疲惫，但更让你心惊的是脑海中未来的蓝图与眼前这绝望现实的巨大反差。就在这时，窑洞的门被“砰”地一声推开，村支书梁玉明那张饱经风霜的脸出现在门口。他眼神锐利，上下打量着你这个新来的‘知识青年’，沉声说道：“村里的蓄水池快要见底了，'
2025-09-24 16:29:14 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=459 预览='{\n  "text": "刺骨的寒风卷着黄沙，从窑洞的破旧窗棂中灌入，让你猛地打了个寒颤。你挣扎着从冰冷的土炕上坐起，环顾四周——土坯墙壁，昏暗的油灯，空气中弥漫着一股尘土与汗水的混合气味。记忆的碎片如潮水般涌来：这里是1969年的梁家河，一个黄土高原上贫瘠的村庄，而你，不再是21世纪的普通人，而是那个未来将要登上权力'
2025-09-24 16:29:14 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=459 预览='{\n  "text": "刺骨的寒风卷着黄沙，从窑洞的破旧窗棂中灌入，让你猛地打了个寒颤。你挣扎着从冰冷的土炕上坐起，环顾四周——土坯墙壁，昏暗的油灯，空气中弥漫着一股尘土与汗水的混合气味。记忆的碎片如潮水般涌来：这里是1969年的梁家河，一个黄土高原上贫瘠的村庄，而你，不再是21世纪的普通人，而是那个未来将要登上权力'
2025-09-24 16:29:14 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=459 预览='{\n  "text": "刺骨的寒风卷着黄沙，从窑洞的破旧窗棂中灌入，让你猛地打了个寒颤。你挣扎着从冰冷的土炕上坐起，环顾四周——土坯墙壁，昏暗的油灯，空气中弥漫着一股尘土与汗水的混合气味。记忆的碎片如潮水般涌来：这里是1969年的梁家河，一个黄土高原上贫瘠的村庄，而你，不再是21世纪的普通人，而是那个未来将要登上权力之巅的青年——习近平。\\n你的身体还残留着长途跋涉的疲惫，但更让你心惊的是脑海中'
2025-09-24 16:29:14 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 358
2025-09-24 16:29:14 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 16:29:14 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-24 16:29:14 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-24 16:29:14 | INFO     | core.story_engine:start_story:181 - 成功生成开篇故事，图片为: /static/space_station.jpg
2025-09-24 16:29:14 | INFO     | core.story_engine:start_story:197 - 新故事生成成功
2025-09-24 16:29:14 | INFO     | api.story:start_new_story:161 - 新故事生成成功
2025-09-24 16:29:24 | INFO     | api.story:continue_existing_story:181 - 收到故事继续请求，选择: 谦虚表示先向老乡们学习经验
2025-09-24 16:29:24 | INFO     | core.story_engine:continue_story:202 - 继续故事，用户选择: 谦虚表示先向老乡们学习经验
2025-09-24 16:29:24 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x00000275A6CCC350>' -H 'OpenAI-Project: <openai.Omit object at 0x00000275A6CF44D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "刺骨的寒风卷着黄沙，从窑洞的破旧窗棂中灌入，让你猛地打了个寒颤。你挣扎着从冰冷的土炕上坐起，环顾四周——土坯墙壁，昏暗的油灯，空气中弥漫着一股尘土与汗水的混合气味。记忆的碎片如潮水般涌来：这里是1969年的梁家河，一个黄土高原上贫瘠的村庄，而你，不再是21世纪的普通人，而是那个未来将要登上权力之巅的青年——习近平。\n你的身体还残留着长途跋涉的疲惫，但更让你心惊的是脑海中未来的蓝图与眼前这绝望现实的巨大反差。就在这时，窑洞的门被“砰”地一声推开，村支书梁玉明那张饱经风霜的脸出现在门口。他眼神锐利，上下打量着你这个新来的‘知识青年’，沉声说道：“村里的蓄水池快要见底了，再不想办法，秋收就全完了。你是北京来的，有文化，你说说，我们该怎么办？”全村人的目光似乎都透过梁书记，聚焦在你身上。这是一个考验，也是一个机会。"}, {"role": "user", "content": "\n你是一位富有想象力的长篇故事大师，擅长构建曲折、多章节的冒险史诗。\n请根据下面的故事历史和用户的选择，继续撰写这个长篇故事。\n\n核心任务：\n1.  **自然地推进情节**：对用户的选择做出直接且富有创意的回应。\n2.  **创造悬念和深度**：引入新的冲突、谜团、盟友或敌人，让故事至少能发展8到15个章节。\n3.  **保持生动**：文字富有画面感，大约200-300字。\n\n【重要心法：如何创作一个伟大的长篇故事】\n*   **拒绝短视**：不要急于求成！一个好的故事需要铺垫和发展。过早的结局是对玩家的不尊重。\n*   **制造波澜**：一个选择不应该直接导致最终胜利或失败。它应该通往新的挑战或机遇。\n*   **给予有意义的选择**：在故事的结尾，你必须提供2到3个引导故事走向不同可能性的行动选项。\n\n【惩罚机制】\n如果故事在6个章节内就结束（即choices为空列表），这将被视为一次“失败”的创作，因为它剥夺了玩家的体验。请尽一切努力避免这种情况。\n\n---\n用户选择：\"谦虚表示先向老乡们学习经验\"\n---\n\n请严格按照以下 JSON 格式输出你的回答：\n{\n  \"text\": \"这里是你生成的新的故事文本...\",\n  \"choices\": [\"选择A\", \"选择B\", \"选择C\"]\n}\n"}]}'
2025-09-24 16:29:42 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2146
2025-09-24 16:29:42 | INFO     | core.story_engine:continue_story:209 - [LLM raw][continue] 长度=455 预览='{\n  "text": "你压下心中的万千思绪，对着梁玉明黝黑的脸庞，诚恳地躬了躬身：“梁书记，各位乡亲，我刚来乍到，对村里的情况两眼一抹黑。北京的书本知识，哪比得上大伙儿在黄土地里刨食的真本事？这水是大家的命根子，我想先跟着老乡们多看看，多学学，弄明白这蓄水池的来龙去脉，再谈想法。”\\n\\n你的话音不高，但在这寂静的窑洞里却格外清晰。村民们脸上的怀疑并未完全褪去，但紧绷的气氛确实缓和了些许。梁玉明那双锐利的眼睛在你身上停留了片刻，闪过一丝不易察觉的审视。他吐掉嘴里的旱烟沫，沉声道：“学？好！村里最懂水脉的是住在村东头崖畔上的赵老蔫儿，他年轻时走南闯北，修过渠，打过井。不过他那脾气，比茅坑里的'
2025-09-24 16:29:42 | DEBUG    | core.story_engine:_extract_json:33 - [JSON] 原始长度=455 预览='{\n  "text": "你压下心中的万千思绪，对着梁玉明黝黑的脸庞，诚恳地躬了躬身：“梁书记，各位乡亲，我刚来乍到，对村里的情况两眼一抹黑。北京的书本知识，哪比得上大伙儿在黄土地里刨食的真本事？这水是大家的命根子，我想先跟着老乡们多看看，多学学，弄明白这蓄水池的来龙去脉，再谈想法。”\\n\\n你的话音不高，但在这寂静的'
2025-09-24 16:29:42 | DEBUG    | core.story_engine:_extract_json:76 - [JSON] 括号配对提取成功，长度=455 预览='{\n  "text": "你压下心中的万千思绪，对着梁玉明黝黑的脸庞，诚恳地躬了躬身：“梁书记，各位乡亲，我刚来乍到，对村里的情况两眼一抹黑。北京的书本知识，哪比得上大伙儿在黄土地里刨食的真本事？这水是大家的命根子，我想先跟着老乡们多看看，多学学，弄明白这蓄水池的来龙去脉，再谈想法。”\\n\\n你的话音不高，但在这寂静的'
2025-09-24 16:29:42 | INFO     | core.story_engine:_parse_llm_response:85 - [JSON] 提取后长度=455 预览='{\n  "text": "你压下心中的万千思绪，对着梁玉明黝黑的脸庞，诚恳地躬了躬身：“梁书记，各位乡亲，我刚来乍到，对村里的情况两眼一抹黑。北京的书本知识，哪比得上大伙儿在黄土地里刨食的真本事？这水是大家的命根子，我想先跟着老乡们多看看，多学学，弄明白这蓄水池的来龙去脉，再谈想法。”\\n\\n你的话音不高，但在这寂静的窑洞里却格外清晰。村民们脸上的怀疑并未完全褪去，但紧绷的气氛确实缓和了些许。梁玉'
2025-09-24 16:29:42 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 333
2025-09-24 16:29:42 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-24 16:29:42 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-24 16:29:42 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-24 16:29:42 | INFO     | core.story_engine:continue_story:233 - 故事继续生成成功
2025-09-24 16:29:42 | INFO     | api.story:continue_existing_story:283 - 故事继续生成成功
2025-09-24 16:53:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 16:53:05 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 16:53:05 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:53:05 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 16:53:05 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 16:53:05 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 16:53:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:53:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:53:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 16:53:05 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 16:53:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:53:06 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 16:53:06 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 16:53:06 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 16:53:06 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:53:06 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 16:57:36 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 16:57:37 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 16:57:37 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:57:37 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 16:57:37 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 16:57:37 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 16:57:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:57:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:57:38 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 16:57:38 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 16:57:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:57:38 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 16:57:38 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 16:57:38 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 16:57:38 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:57:38 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 16:58:25 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 16:58:27 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 16:58:27 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:58:27 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 16:58:27 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 16:58:27 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 16:58:27 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:58:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:58:27 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 16:58:27 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 16:58:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:58:28 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 16:58:28 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 16:58:28 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 16:58:28 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:58:28 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 16:59:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 16:59:45 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 16:59:45 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:59:45 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 16:59:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 16:59:45 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 16:59:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:59:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:59:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 16:59:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 16:59:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 16:59:46 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 16:59:46 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 16:59:46 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 16:59:46 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 16:59:46 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 17:00:18 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 17:00:20 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 17:00:20 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:00:20 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 17:00:20 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 17:00:20 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 17:00:20 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:00:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:00:20 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 17:00:20 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 17:00:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:00:21 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 17:00:21 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 17:00:21 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 17:00:21 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:00:21 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 17:01:16 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 17:01:17 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 17:01:17 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:01:17 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 17:01:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 17:01:17 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 17:01:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:01:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:01:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 17:01:18 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 17:01:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:01:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 17:01:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 17:01:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 17:01:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:01:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 17:08:00 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 17:08:02 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 17:08:02 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:08:02 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 17:08:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 17:08:02 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 17:08:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:08:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:08:02 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 17:08:02 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 17:08:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:08:03 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 17:08:03 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 17:08:03 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 17:08:03 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:08:03 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 17:08:33 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 17:08:35 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 17:08:35 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:08:35 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 17:08:35 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 17:08:35 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 17:08:35 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:08:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:08:35 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 17:08:35 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 17:08:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:08:36 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 17:08:36 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 17:08:36 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 17:08:36 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:08:36 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 17:10:26 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 17:10:28 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 17:10:28 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:10:28 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 17:10:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 17:10:28 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 17:10:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:10:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:10:28 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 17:10:28 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 17:10:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:10:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 17:10:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 17:10:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 17:10:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:10:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 17:10:54 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 17:10:56 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 17:10:56 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:10:56 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 17:10:56 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 17:10:56 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 17:10:56 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:10:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:10:56 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 17:10:56 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 17:10:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 17:10:57 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 17:10:57 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 17:10:57 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 17:10:57 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 17:10:57 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 20:34:27 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 20:34:30 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 20:34:30 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 20:34:30 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 20:34:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 20:34:30 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 20:34:30 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 20:34:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 20:34:30 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-24 20:34:30 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-24 20:34:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 20:34:31 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-24 20:34:31 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-24 20:34:31 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-24 20:34:31 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 20:34:31 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-24 20:35:33 | INFO     | backend.database.crud:create_user:33 - 创建新用户: 690161230@qq.com
2025-09-24 20:35:52 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001B99256E250>' -H 'OpenAI-Project: <openai.Omit object at 0x000001B992481710>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名优秀的游戏关卡设计师。请根据用户的重生愿望，为第一关生成结构化的关卡元信息。\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（100-150字），描述此关的时代、地点、主要冲突或氛围。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字）。\n\n用户重生愿望：\"项羽\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-24 20:36:03 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1263
2025-09-24 23:35:10 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-24 23:35:14 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:35:14 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:35:14 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:35:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:35:14 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:35:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:35:51 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:35:51 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:35:51 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:35:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:35:51 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:35:51 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:36:28 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:36:28 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:36:28 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:36:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:36:28 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:36:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:36:55 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:36:55 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:36:55 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:36:55 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:36:55 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:36:55 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:38:10 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:38:10 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:38:10 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:38:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:38:10 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:38:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:39:15 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:39:15 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:39:15 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:39:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:39:15 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:39:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:40:08 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:40:08 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:40:08 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:40:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:40:08 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:40:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:41:46 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:41:46 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:41:46 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:41:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:41:46 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:41:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:42:15 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:42:15 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:42:15 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:42:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:42:15 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:42:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:44:12 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:44:12 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:44:12 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:44:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:44:12 | INFO     | core.story_engine:__init__:21 - 故事引擎初始化完成
2025-09-24 23:44:12 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:47:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:47:18 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:47:18 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:47:18 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:47:18 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:47:18 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:47:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:47:53 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:47:53 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:47:53 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:47:53 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:47:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:52:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:52:59 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:52:59 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:52:59 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:52:59 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:52:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:54:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:54:26 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:54:26 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:54:26 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:54:26 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:54:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:56:20 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:56:21 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:56:21 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:56:21 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:56:21 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:56:21 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:58:01 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:58:01 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:58:01 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:58:01 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:58:01 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:58:01 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-24 23:59:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-24 23:59:17 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-24 23:59:17 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-24 23:59:17 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-24 23:59:17 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-24 23:59:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:00:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:00:34 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:00:34 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:00:34 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:00:34 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:00:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:01:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:01:46 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:01:46 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:01:46 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:01:46 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:01:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:02:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:02:03 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:02:03 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:02:03 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:02:03 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:02:03 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:04:37 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:04:37 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:04:37 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:04:37 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:04:37 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:04:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:21:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:21:58 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:21:58 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:21:58 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:21:58 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:21:58 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:23:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:23:25 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:23:25 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:23:25 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:23:25 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:23:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:24:21 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:24:21 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:24:21 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:24:21 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:24:21 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:24:21 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:24:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:24:43 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:24:43 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:24:43 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:24:43 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:24:43 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:25:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:25:18 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:25:18 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:25:18 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:25:18 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:25:18 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:26:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 00:26:04 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 00:26:04 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 00:26:04 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 00:26:04 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 00:26:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:50:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:54:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:54:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:55:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:59:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 00:59:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:04:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:05:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:06:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:11:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:13:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:14:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:15:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:15:27 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:15:27 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:15:27 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:15:27 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:15:27 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:15:27 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:15:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:15:27 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 01:15:27 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 01:15:27 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 01:15:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:15:28 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 01:15:28 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 01:15:28 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 01:15:28 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:15:28 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 01:15:52 | INFO     | backend.database.crud:create_user:36 - 创建新用户: 690161230@qq.com
2025-09-25 01:16:07 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x00000263BD727290>' -H 'OpenAI-Project: <openai.Omit object at 0x00000263BD9943D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名顶级的沉浸式关卡设计师。请根据用户的重生愿望与历史设定，生成第一关的结构化元信息。\n\n【背景设定参考】\n角色定位：刘邦\n所属时代：楚汉之争\n人物特质：汉高祖，善用人、善忍辱的草根帝王；外圆内方的政治老狐狸\n关键历史锚点：反秦起义；鸿门宴；韩信拜将；楚汉决战\n主要矛盾：如何整合各路义军；收服天下豪杰；与项羽的战略对抗\n推荐章节总数：至少 11 章\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（120-180字），融合时代氛围、主要人物关系、冲突前景。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字），明确玩家第一关的核心目标。\n\n用户重生愿望：\"刘邦\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-25 01:16:33 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2671
2025-09-25 01:17:34 | INFO     | api.story:start_new_story:193 - 用户 70cc8a35-71d5-47d1-9e04-7d004254ccc3 收到新故事请求，愿望: 刘邦
2025-09-25 01:17:34 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '刘邦'
2025-09-25 01:17:34 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x00000263BD9DB690>' -H 'OpenAI-Project: <openai.Omit object at 0x00000263BD9CFD10>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：刘邦\n所属时代：楚汉之争\n人物特质：汉高祖，善用人、善忍辱的草根帝王；外圆内方的政治老狐狸\n关键历史锚点：反秦起义；鸿门宴；韩信拜将；楚汉决战\n主要矛盾：如何整合各路义军；收服天下豪杰；与项羽的战略对抗\n推荐章节总数：至少 11 章\n\n【关键锚点事件（按需引用）】\n- 反秦起义\n- 鸿门宴\n- 韩信拜将\n- 楚汉决战\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 11 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:17:58 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2702
2025-09-25 01:17:58 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1091 预览='{\n  "text": "公元前209年，沛县的空气中弥漫着雨后泥土与紧张汗水的混合气息。大秦的铁腕，曾被认为坚不可摧，如今正在其自身的暴政下分崩离析。你，刘季，此刻被众人拥为“沛公”，站在县衙简陋的木台上，听着台下乡亲们的欢呼，那声音如同一首混乱的交响乐。县令的头颅，作为一份冷酷的战利品，还滚落在不远处。你已然渡过命运的卢比孔河。你那亭长的过去，那好酒吹嘘的岁月，皆已化为灰烬。你面前的不是精兵，而是农夫、屠户和吏员，他们眼中闪烁着被你点燃的、近乎绝望的希望。挚友萧何与曹参立于你身侧，神情中既有兴奋，亦有深切的忧虑。秦军绝不会对这次公然的挑衅坐视不理，天下各地的野心家也必将揭竿而起。这场初生的'
2025-09-25 01:17:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1091 预览='{\n  "text": "公元前209年，沛县的空气中弥漫着雨后泥土与紧张汗水的混合气息。大秦的铁腕，曾被认为坚不可摧，如今正在其自身的暴政下分崩离析。你，刘季，此刻被众人拥为“沛公”，站在县衙简陋的木台上，听着台下乡亲们的欢呼，那声音如同一首混乱的交响乐。县令的头颅，作为一份冷酷的战利品，还滚落在不远处。你已然渡过命'
2025-09-25 01:17:58 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1091 预览='{\n  "text": "公元前209年，沛县的空气中弥漫着雨后泥土与紧张汗水的混合气息。大秦的铁腕，曾被认为坚不可摧，如今正在其自身的暴政下分崩离析。你，刘季，此刻被众人拥为“沛公”，站在县衙简陋的木台上，听着台下乡亲们的欢呼，那声音如同一首混乱的交响乐。县令的头颅，作为一份冷酷的战利品，还滚落在不远处。你已然渡过命'
2025-09-25 01:17:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1091 预览='{\n  "text": "公元前209年，沛县的空气中弥漫着雨后泥土与紧张汗水的混合气息。大秦的铁腕，曾被认为坚不可摧，如今正在其自身的暴政下分崩离析。你，刘季，此刻被众人拥为“沛公”，站在县衙简陋的木台上，听着台下乡亲们的欢呼，那声音如同一首混乱的交响乐。县令的头颅，作为一份冷酷的战利品，还滚落在不远处。你已然渡过命运的卢比孔河。你那亭长的过去，那好酒吹嘘的岁月，皆已化为灰烬。你面前的不是精兵，'
2025-09-25 01:17:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 365
2025-09-25 01:17:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:17:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 01:17:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 01:17:58 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/rebirth_gate_placeholder.png
2025-09-25 01:17:58 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 01:17:58 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: 3 validation errors for StorySegment
choices.0
  Input should be a valid dictionary or instance of ChoiceOption [type=model_type, input_value=ChoiceOption(option='深...gs=['内政', '谋略']), input_type=ChoiceOption]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
choices.1
  Input should be a valid dictionary or instance of ChoiceOption [type=model_type, input_value=ChoiceOption(option='兵...gs=['战斗', '扩张']), input_type=ChoiceOption]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
choices.2
  Input should be a valid dictionary or instance of ChoiceOption [type=model_type, input_value=ChoiceOption(option='联...gs=['外交', '政治']), input_type=ChoiceOption]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-09-25 01:19:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 01:19:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:19:05 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:19:05 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:19:05 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:19:05 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:19:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:19:06 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:19:07 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:19:07 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:19:07 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:19:07 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:19:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:19:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:28:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:29:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-25 01:31:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-25 01:32:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-25 01:36:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-25 01:38:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-25 01:38:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:38:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:38:29 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:38:29 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:38:29 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:38:29 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:38:29 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:38:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:38:29 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 01:38:29 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 01:38:29 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 01:38:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:38:30 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 01:38:30 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 01:38:30 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 01:38:30 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:38:30 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 01:38:48 | INFO     | backend.database.crud:create_user:36 - 创建新用户: 690161230@qq.com
2025-09-25 01:38:54 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001AE97648150>' -H 'OpenAI-Project: <openai.Omit object at 0x000001AE976D7410>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名顶级的沉浸式关卡设计师。请根据用户的重生愿望与历史设定，生成第一关的结构化元信息。\n\n【背景设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（120-180字），融合时代氛围、主要人物关系、冲突前景。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字），明确玩家第一关的核心目标。\n\n用户重生愿望：\"项羽\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-25 01:39:13 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2049
2025-09-25 01:39:34 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 项羽
2025-09-25 01:39:34 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-25 01:39:34 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001AE97908350>' -H 'OpenAI-Project: <openai.Omit object at 0x000001AE97908050>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n【关键锚点事件（按需引用）】\n- 巨鹿之战\n- 鸿门宴\n- 西楚建国与制度\n- 垓下之围\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 10 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:40:21 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2939
2025-09-25 01:40:21 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1052 预览='{\n  "text": "乌江的寒水尚未浸透骨髓，巨鹿的血腥味却已扑面而来。你，项羽，再次立于这片熟悉而又陌生的土地。帐外，二十万秦军降卒的营地死寂如坟，他们的命运悬于你一念之间。你的指节因紧握‘天龙破城戟’而泛白，胜利的荣光与新生的迷惘在你胸中交织。亚父范增的急报就摊在案上，字字如刀：“沛公刘邦已入关中，据咸阳，欲王关中！” 这位泗水亭长，昔日的盟友，如今却成了第一个摘取胜利果实的硕鼠。帐内烛火摇曳，将你的影子投射在地图上，巨大如山，却也摇摆不定。是趁势挥师东进，将这胆大妄为的刘邦连同他那不切实际的野心一并碾碎，还是先稳固后方，处理这二十万可能成为心腹大患的降卒？你的决定，将重塑历史的走向。'
2025-09-25 01:40:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1052 预览='{\n  "text": "乌江的寒水尚未浸透骨髓，巨鹿的血腥味却已扑面而来。你，项羽，再次立于这片熟悉而又陌生的土地。帐外，二十万秦军降卒的营地死寂如坟，他们的命运悬于你一念之间。你的指节因紧握‘天龙破城戟’而泛白，胜利的荣光与新生的迷惘在你胸中交织。亚父范增的急报就摊在案上，字字如刀：“沛公刘邦已入关中，据咸阳，欲王'
2025-09-25 01:40:21 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1052 预览='{\n  "text": "乌江的寒水尚未浸透骨髓，巨鹿的血腥味却已扑面而来。你，项羽，再次立于这片熟悉而又陌生的土地。帐外，二十万秦军降卒的营地死寂如坟，他们的命运悬于你一念之间。你的指节因紧握‘天龙破城戟’而泛白，胜利的荣光与新生的迷惘在你胸中交织。亚父范增的急报就摊在案上，字字如刀：“沛公刘邦已入关中，据咸阳，欲王'
2025-09-25 01:40:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1052 预览='{\n  "text": "乌江的寒水尚未浸透骨髓，巨鹿的血腥味却已扑面而来。你，项羽，再次立于这片熟悉而又陌生的土地。帐外，二十万秦军降卒的营地死寂如坟，他们的命运悬于你一念之间。你的指节因紧握‘天龙破城戟’而泛白，胜利的荣光与新生的迷惘在你胸中交织。亚父范增的急报就摊在案上，字字如刀：“沛公刘邦已入关中，据咸阳，欲王关中！” 这位泗水亭长，昔日的盟友，如今却成了第一个摘取胜利果实的硕鼠。帐内烛火'
2025-09-25 01:40:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 287
2025-09-25 01:40:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:40:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 01:40:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 01:40:21 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/cyberpunk_city.jpg
2025-09-25 01:40:21 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 01:40:21 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: 3 validation errors for StorySegment
choices.0
  Input should be a valid dictionary or instance of ChoiceOption [type=model_type, input_value=ChoiceOption(option='挥...gs=['军事', '谋略']), input_type=ChoiceOption]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
choices.1
  Input should be a valid dictionary or instance of ChoiceOption [type=model_type, input_value=ChoiceOption(option='先...gs=['内政', '残暴']), input_type=ChoiceOption]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
choices.2
  Input should be a valid dictionary or instance of ChoiceOption [type=model_type, input_value=ChoiceOption(option='传...gs=['政治', '外交']), input_type=ChoiceOption]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-09-25 01:53:13 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 01:53:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:53:14 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:53:14 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:53:14 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:53:14 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:53:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:53:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:53:14 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 01:53:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 01:53:15 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 01:53:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:53:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 01:53:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 01:53:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 01:53:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:53:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 01:53:51 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 01:53:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:53:53 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:53:53 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:53:53 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:53:53 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:53:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:53:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:53:53 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 01:53:53 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 01:53:53 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 01:53:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:53:54 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 01:53:54 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 01:53:54 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 01:53:54 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:53:54 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 01:56:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 01:56:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:56:48 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 01:56:49 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 01:56:49 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:56:49 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 01:56:49 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 01:56:49 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:56:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:56:49 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 01:56:49 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 01:56:49 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 01:56:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 01:56:50 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 01:56:50 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 01:56:50 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 01:56:50 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 01:56:50 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 01:56:58 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 项羽
2025-09-25 01:56:58 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-25 01:56:58 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E718BE50>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E709A910>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n【关键锚点事件（按需引用）】\n- 巨鹿之战\n- 鸿门宴\n- 西楚建国与制度\n- 垓下之围\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 10 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:57:22 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2847
2025-09-25 01:57:22 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1132 预览='{\n  "text": "第一章：鸿门寒光\\n\\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\\n\\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\\n\\n你抬起头，帐外刘邦的使者张良仍在等候回音'
2025-09-25 01:57:22 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1132 预览='{\n  "text": "第一章：鸿门寒光\\n\\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚'
2025-09-25 01:57:22 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1132 预览='{\n  "text": "第一章：鸿门寒光\\n\\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚'
2025-09-25 01:57:22 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1132 预览='{\n  "text": "第一章：鸿门寒光\\n\\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门'
2025-09-25 01:57:22 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 362
2025-09-25 01:57:22 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:57:22 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 01:57:22 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 01:57:22 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/rebirth_gate_placeholder.png
2025-09-25 01:57:22 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 01:57:23 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 01:57:23 | DEBUG    | core.speculation:enqueue:40 - [Speculation] enqueue session=2 node=2 depth=3
2025-09-25 01:57:23 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 听从亚父，设宴必杀
2025-09-25 01:57:23 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7237290>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E7617210>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 2 章\n当前主线成功率：60%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“听从亚父，设宴必杀”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:57:40 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 当众折辱，收缴兵权
2025-09-25 01:57:40 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 当众折辱，收缴兵权
2025-09-25 01:57:40 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7627490>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E76262D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 2 章\n当前主线成功率：60%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“当众折辱，收缴兵权”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:57:43 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2697
2025-09-25 01:57:43 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1016 预览='{\n  "text": "第二章：玉玦与剑舞\\n\\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，此刻在你面前不过是砧板上的鱼肉。亚父范增坐立不安，频频举起玉玦，示意你下令动手。帐中刀斧手的呼吸声清晰可闻，只待你一声令下。然而，就在你准备发出信号的瞬间，你眼角的余光瞥见你的叔父项伯，竟向张良使了个隐晦的眼色。前世的记忆碎片如电光火石般闪过——正是项伯的告密，才让刘邦有了准备！'
2025-09-25 01:57:43 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1016 预览='{\n  "text": "第二章：玉玦与剑舞\\n\\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，'
2025-09-25 01:57:43 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1016 预览='{\n  "text": "第二章：玉玦与剑舞\\n\\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，'
2025-09-25 01:57:43 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1016 预览='{\n  "text": "第二章：玉玦与剑舞\\n\\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，此刻在你面前不过是砧板上的鱼肉。亚父范增坐立不安，频频举起玉玦，示意你下令动手。'
2025-09-25 01:57:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 323
2025-09-25 01:57:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:57:43 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 01:57:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 01:57:43 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:57:43 | DEBUG    | core.speculation:_speculate_recursive:125 - [Speculation] created speculative node=3 parent=2 choice='听从亚父，设宴必杀' depth=3
2025-09-25 01:57:43 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 无视项伯，直接下令项庄舞剑，意在沛公。
2025-09-25 01:57:43 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7633450>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E760DF90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦与剑舞\n\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，此刻在你面前不过是砧板上的鱼肉。亚父范增坐立不安，频频举起玉玦，示意你下令动手。帐中刀斧手的呼吸声清晰可闻，只待你一声令下。然而，就在你准备发出信号的瞬间，你眼角的余光瞥见你的叔父项伯，竟向张良使了个隐晦的眼色。前世的记忆碎片如电光火石般闪过——正是项伯的告密，才让刘邦有了准备！内鬼，就在你的至亲之中。这突如其来的发现，让你举起酒爵的手，在半空中凝滞了。"}, {"role": "user", "content": "我选择了：听从亚父，设宴必杀"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 3 章\n当前主线成功率：63%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“无视项伯，直接下令项庄舞剑，意在沛公。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:58:03 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3071
2025-09-25 01:58:03 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1024 预览='{\n  "text": "第三章：剑舞与盾卫\\n\\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转，都向刘邦逼近一分。刘邦的脸色已然煞白，握住酒杯的手指因用力而骨节发白。就在项庄的剑尖即将掠过刘邦脖颈的瞬间，项伯果然按捺不住，霍然起身拔剑，闯入场中，以身为盾，与项庄“对舞”，巧妙地格挡了所有致命的攻势。帐内气氛凝滞如冰。正在此时，一声雷霆般的怒吼震动营帐，樊哙撞开卫兵，手持铁'
2025-09-25 01:58:03 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1024 预览='{\n  "text": "第三章：剑舞与盾卫\\n\\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转'
2025-09-25 01:58:03 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1024 预览='{\n  "text": "第三章：剑舞与盾卫\\n\\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转'
2025-09-25 01:58:03 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1024 预览='{\n  "text": "第三章：剑舞与盾卫\\n\\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转，都向刘邦逼近一分。刘邦的脸色已然煞白，握住酒杯的手指因用力而骨节发白。就在项庄'
2025-09-25 01:58:03 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 331
2025-09-25 01:58:03 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:58:03 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 01:58:03 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 01:58:03 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:58:03 | DEBUG    | core.speculation:_speculate_recursive:125 - [Speculation] created speculative node=4 parent=3 choice='无视项伯，直接下令项庄舞剑，意在沛公。' depth=2
2025-09-25 01:58:03 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 喝止项伯，怒斥樊哙，强令项庄继续刺杀。
2025-09-25 01:58:03 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7633450>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E7645E50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦与剑舞\n\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，此刻在你面前不过是砧板上的鱼肉。亚父范增坐立不安，频频举起玉玦，示意你下令动手。帐中刀斧手的呼吸声清晰可闻，只待你一声令下。然而，就在你准备发出信号的瞬间，你眼角的余光瞥见你的叔父项伯，竟向张良使了个隐晦的眼色。前世的记忆碎片如电光火石般闪过——正是项伯的告密，才让刘邦有了准备！内鬼，就在你的至亲之中。这突如其来的发现，让你举起酒爵的手，在半空中凝滞了。"}, {"role": "user", "content": "我选择了：听从亚父，设宴必杀"}, {"role": "assistant", "content": "第三章：剑舞与盾卫\n\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转，都向刘邦逼近一分。刘邦的脸色已然煞白，握住酒杯的手指因用力而骨节发白。就在项庄的剑尖即将掠过刘邦脖颈的瞬间，项伯果然按捺不住，霍然起身拔剑，闯入场中，以身为盾，与项庄“对舞”，巧妙地格挡了所有致命的攻势。帐内气氛凝滞如冰。正在此时，一声雷霆般的怒吼震动营帐，樊哙撞开卫兵，手持铁盾闯入，怒目圆睁，直视着你，仿佛一头被激怒的猛兽。内有亲族掣肘，外有悍将闯帐，刺杀已然受阻。"}, {"role": "user", "content": "我选择了：无视项伯，直接下令项庄舞剑，意在沛公。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“喝止项伯，怒斥樊哙，强令项庄继续刺杀。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:58:04 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2985
2025-09-25 01:58:04 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1032 预览='{\n  "text": "第二章：玉玦无声\\n\\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！”刘邦面如死灰，汗如雨下，在你的逼视下，他只能屈辱地叩首谢恩，仿佛这是天大的恩赐。范增眼中闪过一丝赞许，但玉玦却未曾放下，他深知，放虎归山，终为大患。看着刘邦在张良搀扶下踉跄离去的背影，你明白，你并未斩草除根，只是将仇恨的种子埋得更深。关中的权力真空已经出现，而诸侯们的眼睛，正齐'
2025-09-25 01:58:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1032 预览='{\n  "text": "第二章：玉玦无声\\n\\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！'
2025-09-25 01:58:04 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1032 预览='{\n  "text": "第二章：玉玦无声\\n\\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！'
2025-09-25 01:58:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1032 预览='{\n  "text": "第二章：玉玦无声\\n\\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！”刘邦面如死灰，汗如雨下，在你的逼视下，他只能屈辱地叩首谢恩，仿佛这是天大的恩赐'
2025-09-25 01:58:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 303
2025-09-25 01:58:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:58:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 01:58:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 01:58:04 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:58:04 | INFO     | api.story:continue_existing_story:374 - 故事继续生成成功
2025-09-25 01:58:04 | DEBUG    | core.speculation:enqueue:40 - [Speculation] enqueue session=2 node=5 depth=3
2025-09-25 01:58:04 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 乘胜追击，派英布、蒲将军直取巴蜀汉中
2025-09-25 01:58:04 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7633450>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E76234D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦无声\n\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！”刘邦面如死灰，汗如雨下，在你的逼视下，他只能屈辱地叩首谢恩，仿佛这是天大的恩赐。范增眼中闪过一丝赞许，但玉玦却未曾放下，他深知，放虎归山，终为大患。看着刘邦在张良搀扶下踉跄离去的背影，你明白，你并未斩草除根，只是将仇恨的种子埋得更深。关中的权力真空已经出现，而诸侯们的眼睛，正齐刷刷地盯着你，看你如何落下下一步棋。"}, {"role": "user", "content": "我选择了：当众折辱，收缴兵权"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 3 章\n当前主线成功率：68%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“乘胜追击，派英布、蒲将军直取巴蜀汉中”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:58:31 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 4068
2025-09-25 01:58:31 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1144 预览='{\n  "text": "第四章：霸王之怒\\n\\n“项伯，退下！”你的怒吼如平地惊雷，声传帐外。项伯浑身一颤，面色惨白地后退，不敢再直视你的双眼。你冰冷的目光转向樊哙，这个闯帐的匹夫非但没有让你感到被冒犯，反而激起了你胸中那股睥睨天下的霸气。“壮士！赐酒！”你高声下令，亲兵端来一斗生酒。樊哙一饮而尽。你再喝：“赐彘肩！”他便将整只生猪肘置于盾上，拔剑割食。你冷笑着看着这一切，随即缓缓起身，帐内所有人的目光都聚焦在你身上。你踱步至场中，无视樊哙的虎视眈眈，也无视刘邦煞白的脸，只是对项庄下达了不容置疑的命令：“继续舞，直到沛公人头落地。”杀意不再掩饰，剑锋重起，这一次，是挟着霸王之令的雷霆万钧，项'
2025-09-25 01:58:31 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1144 预览='{\n  "text": "第四章：霸王之怒\\n\\n“项伯，退下！”你的怒吼如平地惊雷，声传帐外。项伯浑身一颤，面色惨白地后退，不敢再直视你的双眼。你冰冷的目光转向樊哙，这个闯帐的匹夫非但没有让你感到被冒犯，反而激起了你胸中那股睥睨天下的霸气。“壮士！赐酒！”你高声下令，亲兵端来一斗生酒。樊哙一饮而尽。你再喝：“赐彘肩！'
2025-09-25 01:58:31 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1144 预览='{\n  "text": "第四章：霸王之怒\\n\\n“项伯，退下！”你的怒吼如平地惊雷，声传帐外。项伯浑身一颤，面色惨白地后退，不敢再直视你的双眼。你冰冷的目光转向樊哙，这个闯帐的匹夫非但没有让你感到被冒犯，反而激起了你胸中那股睥睨天下的霸气。“壮士！赐酒！”你高声下令，亲兵端来一斗生酒。樊哙一饮而尽。你再喝：“赐彘肩！'
2025-09-25 01:58:31 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1144 预览='{\n  "text": "第四章：霸王之怒\\n\\n“项伯，退下！”你的怒吼如平地惊雷，声传帐外。项伯浑身一颤，面色惨白地后退，不敢再直视你的双眼。你冰冷的目光转向樊哙，这个闯帐的匹夫非但没有让你感到被冒犯，反而激起了你胸中那股睥睨天下的霸气。“壮士！赐酒！”你高声下令，亲兵端来一斗生酒。樊哙一饮而尽。你再喝：“赐彘肩！”他便将整只生猪肘置于盾上，拔剑割食。你冷笑着看着这一切，随即缓缓起身，帐内所有'
2025-09-25 01:58:31 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 332
2025-09-25 01:58:31 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:58:31 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 01:58:31 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 01:58:31 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:58:31 | DEBUG    | core.speculation:_speculate_recursive:125 - [Speculation] created speculative node=6 parent=4 choice='喝止项伯，怒斥樊哙，强令项庄继续刺杀。' depth=1
2025-09-25 01:58:31 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 赞赏樊哙之勇，赐酒压惊，暂时中止剑舞。
2025-09-25 01:58:31 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7614E10>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E760F650>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦与剑舞\n\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，此刻在你面前不过是砧板上的鱼肉。亚父范增坐立不安，频频举起玉玦，示意你下令动手。帐中刀斧手的呼吸声清晰可闻，只待你一声令下。然而，就在你准备发出信号的瞬间，你眼角的余光瞥见你的叔父项伯，竟向张良使了个隐晦的眼色。前世的记忆碎片如电光火石般闪过——正是项伯的告密，才让刘邦有了准备！内鬼，就在你的至亲之中。这突如其来的发现，让你举起酒爵的手，在半空中凝滞了。"}, {"role": "user", "content": "我选择了：听从亚父，设宴必杀"}, {"role": "assistant", "content": "第三章：剑舞与盾卫\n\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转，都向刘邦逼近一分。刘邦的脸色已然煞白，握住酒杯的手指因用力而骨节发白。就在项庄的剑尖即将掠过刘邦脖颈的瞬间，项伯果然按捺不住，霍然起身拔剑，闯入场中，以身为盾，与项庄“对舞”，巧妙地格挡了所有致命的攻势。帐内气氛凝滞如冰。正在此时，一声雷霆般的怒吼震动营帐，樊哙撞开卫兵，手持铁盾闯入，怒目圆睁，直视着你，仿佛一头被激怒的猛兽。内有亲族掣肘，外有悍将闯帐，刺杀已然受阻。"}, {"role": "user", "content": "我选择了：无视项伯，直接下令项庄舞剑，意在沛公。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“赞赏樊哙之勇，赐酒压惊，暂时中止剑舞。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:58:32 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3694
2025-09-25 01:58:32 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=974 预览='{\n  "text": "第三章：铁蹄西指\\n\\n军令如山！你一声令下，帐外早已整装待发的英布与蒲将军领数万精兵，如一条钢铁洪流，向西直扑巴蜀汉中。你这毫不留情、赶尽杀绝的姿态，彻底震慑了咸阳城内外所有观望的诸侯。他们曾以为鸿门宴上的屈辱已是终局，未曾想你连刘邦苟延残喘的机会都不给。一时间，诸侯们看向你的眼神，除了畏惧，更添了几分兔死狐悲的怨毒。\\n\\n亚父范增捻着胡须，眼中精光一闪而过：“霸王此举，断其根基，甚好！但追亡逐北只是其一。如今关中无主，天下诸侯齐聚于此，人心浮动。若不尽快定下分封之策，以名分锁住这群虎狼，恐怕齐、赵之地很快便会生出变数。”他的话音未落，帐外便传来齐国使者求见的消息'
2025-09-25 01:58:32 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=974 预览='{\n  "text": "第三章：铁蹄西指\\n\\n军令如山！你一声令下，帐外早已整装待发的英布与蒲将军领数万精兵，如一条钢铁洪流，向西直扑巴蜀汉中。你这毫不留情、赶尽杀绝的姿态，彻底震慑了咸阳城内外所有观望的诸侯。他们曾以为鸿门宴上的屈辱已是终局，未曾想你连刘邦苟延残喘的机会都不给。一时间，诸侯们看向你的眼神，除了畏惧'
2025-09-25 01:58:32 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=974 预览='{\n  "text": "第三章：铁蹄西指\\n\\n军令如山！你一声令下，帐外早已整装待发的英布与蒲将军领数万精兵，如一条钢铁洪流，向西直扑巴蜀汉中。你这毫不留情、赶尽杀绝的姿态，彻底震慑了咸阳城内外所有观望的诸侯。他们曾以为鸿门宴上的屈辱已是终局，未曾想你连刘邦苟延残喘的机会都不给。一时间，诸侯们看向你的眼神，除了畏惧'
2025-09-25 01:58:32 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=974 预览='{\n  "text": "第三章：铁蹄西指\\n\\n军令如山！你一声令下，帐外早已整装待发的英布与蒲将军领数万精兵，如一条钢铁洪流，向西直扑巴蜀汉中。你这毫不留情、赶尽杀绝的姿态，彻底震慑了咸阳城内外所有观望的诸侯。他们曾以为鸿门宴上的屈辱已是终局，未曾想你连刘邦苟延残喘的机会都不给。一时间，诸侯们看向你的眼神，除了畏惧，更添了几分兔死狐悲的怨毒。\\n\\n亚父范增捻着胡须，眼中精光一闪而过：“霸王此'
2025-09-25 01:58:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 301
2025-09-25 01:58:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:58:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 01:58:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 01:58:32 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:58:32 | DEBUG    | core.speculation:_speculate_recursive:125 - [Speculation] created speculative node=7 parent=5 choice='乘胜追击，派英布、蒲将军直取巴蜀汉中' depth=3
2025-09-25 01:58:32 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 依史分封，以武慑之
2025-09-25 01:58:32 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7633450>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E766D290>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦无声\n\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！”刘邦面如死灰，汗如雨下，在你的逼视下，他只能屈辱地叩首谢恩，仿佛这是天大的恩赐。范增眼中闪过一丝赞许，但玉玦却未曾放下，他深知，放虎归山，终为大患。看着刘邦在张良搀扶下踉跄离去的背影，你明白，你并未斩草除根，只是将仇恨的种子埋得更深。关中的权力真空已经出现，而诸侯们的眼睛，正齐刷刷地盯着你，看你如何落下下一步棋。"}, {"role": "user", "content": "我选择了：当众折辱，收缴兵权"}, {"role": "assistant", "content": "第三章：铁蹄西指\n\n军令如山！你一声令下，帐外早已整装待发的英布与蒲将军领数万精兵，如一条钢铁洪流，向西直扑巴蜀汉中。你这毫不留情、赶尽杀绝的姿态，彻底震慑了咸阳城内外所有观望的诸侯。他们曾以为鸿门宴上的屈辱已是终局，未曾想你连刘邦苟延残喘的机会都不给。一时间，诸侯们看向你的眼神，除了畏惧，更添了几分兔死狐悲的怨毒。\n\n亚父范增捻着胡须，眼中精光一闪而过：“霸王此举，断其根基，甚好！但追亡逐北只是其一。如今关中无主，天下诸侯齐聚于此，人心浮动。若不尽快定下分封之策，以名分锁住这群虎狼，恐怕齐、赵之地很快便会生出变数。”他的话音未落，帐外便传来齐国使者求见的消息，言语间满是对分封安排的探询与不安。"}, {"role": "user", "content": "我选择了：乘胜追击，派英布、蒲将军直取巴蜀汉中"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 4 章\n当前主线成功率：70%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“依史分封，以武慑之”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:58:57 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3658
2025-09-25 01:58:57 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1063 预览='{\n  "text": "第四章：壮士与说客\\n\\n“壮士！”你朗声大笑，声如洪钟，竟将帐内剑拔弩张的气氛压了下去。前世的你，或许会因这莽夫的冲撞而暴怒，但此刻，你看到的却是刘邦麾下那股凝聚不散的忠勇之气。你命人取来一斗卮酒，一块生彘肩，高声道：“赐壮士酒肉！”樊哙立饮卮酒，拔剑切肉而食，豪气干云。酒肉下肚，他借着酒意，对你慷慨陈词，历数刘邦入关之功，直斥你听信小人谗言，欲杀有功之臣。这番话，如一记重锤，敲在帐内所有人的心上。范增脸色铁青，项庄持剑的手也僵住了。你看着言辞凿凿的樊哙，再看看面露不安的刘邦，心中了然：刺杀的最好时机已过。樊哙的闯入，不仅是勇，更是谋，他将一场密谋刺杀，硬生生变成了'
2025-09-25 01:58:57 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1063 预览='{\n  "text": "第四章：壮士与说客\\n\\n“壮士！”你朗声大笑，声如洪钟，竟将帐内剑拔弩张的气氛压了下去。前世的你，或许会因这莽夫的冲撞而暴怒，但此刻，你看到的却是刘邦麾下那股凝聚不散的忠勇之气。你命人取来一斗卮酒，一块生彘肩，高声道：“赐壮士酒肉！”樊哙立饮卮酒，拔剑切肉而食，豪气干云。酒肉下肚，他借着酒意'
2025-09-25 01:58:57 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1063 预览='{\n  "text": "第四章：壮士与说客\\n\\n“壮士！”你朗声大笑，声如洪钟，竟将帐内剑拔弩张的气氛压了下去。前世的你，或许会因这莽夫的冲撞而暴怒，但此刻，你看到的却是刘邦麾下那股凝聚不散的忠勇之气。你命人取来一斗卮酒，一块生彘肩，高声道：“赐壮士酒肉！”樊哙立饮卮酒，拔剑切肉而食，豪气干云。酒肉下肚，他借着酒意'
2025-09-25 01:58:57 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1063 预览='{\n  "text": "第四章：壮士与说客\\n\\n“壮士！”你朗声大笑，声如洪钟，竟将帐内剑拔弩张的气氛压了下去。前世的你，或许会因这莽夫的冲撞而暴怒，但此刻，你看到的却是刘邦麾下那股凝聚不散的忠勇之气。你命人取来一斗卮酒，一块生彘肩，高声道：“赐壮士酒肉！”樊哙立饮卮酒，拔剑切肉而食，豪气干云。酒肉下肚，他借着酒意，对你慷慨陈词，历数刘邦入关之功，直斥你听信小人谗言，欲杀有功之臣。这番话，如一'
2025-09-25 01:58:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 310
2025-09-25 01:58:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:58:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 01:58:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 01:58:57 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:58:57 | DEBUG    | core.speculation:_speculate_recursive:125 - [Speculation] created speculative node=8 parent=4 choice='赞赏樊哙之勇，赐酒压惊，暂时中止剑舞。' depth=1
2025-09-25 01:58:57 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 借樊哙闯帐之机，将矛头转向刘邦管教不严，对其进行政治羞辱。
2025-09-25 01:58:57 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E7633450>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E76A83D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦与剑舞\n\n“准！”你沉声吐出一个字，帐外张良如释重负。杀意既定，你的心反而前所未有地平静。鸿门大帐之内，列鼎在前，诸将环伺，气氛却比战场更加肃杀。刘邦如约而至，身后仅随张良与樊哙，他卑躬屈膝，献上白璧与玉斗，言辞恳切地解释着“封锁函谷关”的误会。你冷眼看着他，这位未来的汉高祖，此刻在你面前不过是砧板上的鱼肉。亚父范增坐立不安，频频举起玉玦，示意你下令动手。帐中刀斧手的呼吸声清晰可闻，只待你一声令下。然而，就在你准备发出信号的瞬间，你眼角的余光瞥见你的叔父项伯，竟向张良使了个隐晦的眼色。前世的记忆碎片如电光火石般闪过——正是项伯的告密，才让刘邦有了准备！内鬼，就在你的至亲之中。这突如其来的发现，让你举起酒爵的手，在半空中凝滞了。"}, {"role": "user", "content": "我选择了：听从亚父，设宴必杀"}, {"role": "assistant", "content": "第三章：剑舞与盾卫\n\n背叛的刺痛化作了更为凛冽的杀意。你无视了项伯焦急的眼神，将手中青铜爵猛地顿在案上，发出“铛”的一声脆响，压过了帐内的丝竹之声。“此宴无以为乐，命项庄舞剑助兴！”话音未落，你的堂弟项庄应声而出，长剑出鞘，寒光在帐内烛火的映照下流转。剑锋起初从容，继而愈发迅疾，每一次旋转，都向刘邦逼近一分。刘邦的脸色已然煞白，握住酒杯的手指因用力而骨节发白。就在项庄的剑尖即将掠过刘邦脖颈的瞬间，项伯果然按捺不住，霍然起身拔剑，闯入场中，以身为盾，与项庄“对舞”，巧妙地格挡了所有致命的攻势。帐内气氛凝滞如冰。正在此时，一声雷霆般的怒吼震动营帐，樊哙撞开卫兵，手持铁盾闯入，怒目圆睁，直视着你，仿佛一头被激怒的猛兽。内有亲族掣肘，外有悍将闯帐，刺杀已然受阻。"}, {"role": "user", "content": "我选择了：无视项伯，直接下令项庄舞剑，意在沛公。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“借樊哙闯帐之机，将矛头转向刘邦管教不严，对其进行政治羞辱。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 01:59:01 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 4085
2025-09-25 01:59:01 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1162 预览='{\n  "text": "第四章：虎狼环伺\\n\\n英布与蒲将军的铁蹄踏碎了关中最后的宁静，也踏碎了诸侯们最后一丝幻想。捷报雪片般飞来，刘邦残部望风而逃，根本无力组织起有效抵抗，巴蜀汉中已是囊中之物。然而，你帅帐内的气氛却比帐外的寒风还要凝重。诸侯们的使者往来不绝，言辞从最初的恭敬探询，逐渐变为夹枪带棒的催促与不满。尤其是齐地的田荣，他拒不接受任何来自你的指令，并公然收容反楚势力，俨然已成东方的一颗毒瘤。\\n\\n范增将一卷竹简重重拍在案上，上面满是各地诸侯私下联络的密报。“霸王！追击刘邦是剪除枝叶，分封诸侯才是稳固树根！如今根基不稳，枝叶剪得再干净又有何用？若让田荣之流连成气候，楚军将陷入两线作'
2025-09-25 01:59:01 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1162 预览='{\n  "text": "第四章：虎狼环伺\\n\\n英布与蒲将军的铁蹄踏碎了关中最后的宁静，也踏碎了诸侯们最后一丝幻想。捷报雪片般飞来，刘邦残部望风而逃，根本无力组织起有效抵抗，巴蜀汉中已是囊中之物。然而，你帅帐内的气氛却比帐外的寒风还要凝重。诸侯们的使者往来不绝，言辞从最初的恭敬探询，逐渐变为夹枪带棒的催促与不满。尤其'
2025-09-25 01:59:01 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1162 预览='{\n  "text": "第四章：虎狼环伺\\n\\n英布与蒲将军的铁蹄踏碎了关中最后的宁静，也踏碎了诸侯们最后一丝幻想。捷报雪片般飞来，刘邦残部望风而逃，根本无力组织起有效抵抗，巴蜀汉中已是囊中之物。然而，你帅帐内的气氛却比帐外的寒风还要凝重。诸侯们的使者往来不绝，言辞从最初的恭敬探询，逐渐变为夹枪带棒的催促与不满。尤其'
2025-09-25 01:59:01 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1162 预览='{\n  "text": "第四章：虎狼环伺\\n\\n英布与蒲将军的铁蹄踏碎了关中最后的宁静，也踏碎了诸侯们最后一丝幻想。捷报雪片般飞来，刘邦残部望风而逃，根本无力组织起有效抵抗，巴蜀汉中已是囊中之物。然而，你帅帐内的气氛却比帐外的寒风还要凝重。诸侯们的使者往来不绝，言辞从最初的恭敬探询，逐渐变为夹枪带棒的催促与不满。尤其是齐地的田荣，他拒不接受任何来自你的指令，并公然收容反楚势力，俨然已成东方的一颗'
2025-09-25 01:59:01 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 351
2025-09-25 01:59:01 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 01:59:01 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 01:59:01 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 01:59:01 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 01:59:01 | DEBUG    | core.speculation:_speculate_recursive:125 - [Speculation] created speculative node=9 parent=7 choice='依史分封，以武慑之' depth=2
2025-09-25 01:59:01 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 依史分封，以武慑之。将诸侯分封至偏远之地，以亲信扼守关中与膏腴之地。
2025-09-25 01:59:01 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001A2E76234D0>' -H 'OpenAI-Project: <openai.Omit object at 0x000001A2E76AB610>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：鸿门寒光\n\n帐外，朔风如刀，卷起漫天沙尘，拍打着中军大帐的厚重牛皮。帐内，青铜酒爵中的烈酒倒映着你——西楚霸王项羽——布满血丝的双眼。巨鹿的血腥味尚未散尽，四十万楚军的赫赫军威正笼罩着整个关中。然而，此刻你的指尖却在微微颤抖。这不是畏惧，而是来自魂魄深处的记忆烙印——乌江畔的四面楚歌，虞姬诀别的凄美剑舞，以及那匹踏水悲鸣的乌骓。你重生了，回到了这决定命运的鸿门宴前夜。\n\n亚父范增焦灼的目光如芒在背，他手中的玉玦早已被摩挲得温热：“霸王，刘邦小儿窃取咸阳，野心昭然若揭！明日宴上，若不除此獠，必为心腹大患！”\n\n你抬起头，帐外刘邦的使者张良仍在等候回音。你知道，历史的车轮正碾至第一个岔路口。这一次，你不再是那个刚愎自用的屠夫，而是背负着一世败局的复仇者。如何落下这第一枚棋子，将决定楚汉的未来，以及你自己的命运。"}, {"role": "assistant", "content": "第二章：玉玦无声\n\n鸿门宴上，酒过三巡，杀机毕现。你猛然掷杯于地，清脆的碎裂声让乐舞戛然而止。你没有给项庄任何机会，而是亲自走到刘邦面前，如山岳般的阴影将他完全笼罩。“沛公入关，劳苦功高，”你语带讥讽，声音却如寒冰，“然麾下兵马，骄横无状，不识尊卑。为免祸乱，这十万兵卒，本王便代为收编了！”刘邦面如死灰，汗如雨下，在你的逼视下，他只能屈辱地叩首谢恩，仿佛这是天大的恩赐。范增眼中闪过一丝赞许，但玉玦却未曾放下，他深知，放虎归山，终为大患。看着刘邦在张良搀扶下踉跄离去的背影，你明白，你并未斩草除根，只是将仇恨的种子埋得更深。关中的权力真空已经出现，而诸侯们的眼睛，正齐刷刷地盯着你，看你如何落下下一步棋。"}, {"role": "user", "content": "我选择了：当众折辱，收缴兵权"}, {"role": "assistant", "content": "第三章：铁蹄西指\n\n军令如山！你一声令下，帐外早已整装待发的英布与蒲将军领数万精兵，如一条钢铁洪流，向西直扑巴蜀汉中。你这毫不留情、赶尽杀绝的姿态，彻底震慑了咸阳城内外所有观望的诸侯。他们曾以为鸿门宴上的屈辱已是终局，未曾想你连刘邦苟延残喘的机会都不给。一时间，诸侯们看向你的眼神，除了畏惧，更添了几分兔死狐悲的怨毒。\n\n亚父范增捻着胡须，眼中精光一闪而过：“霸王此举，断其根基，甚好！但追亡逐北只是其一。如今关中无主，天下诸侯齐聚于此，人心浮动。若不尽快定下分封之策，以名分锁住这群虎狼，恐怕齐、赵之地很快便会生出变数。”他的话音未落，帐外便传来齐国使者求见的消息，言语间满是对分封安排的探询与不安。"}, {"role": "user", "content": "我选择了：乘胜追击，派英布、蒲将军直取巴蜀汉中"}, {"role": "assistant", "content": "第四章：虎狼环伺\n\n英布与蒲将军的铁蹄踏碎了关中最后的宁静，也踏碎了诸侯们最后一丝幻想。捷报雪片般飞来，刘邦残部望风而逃，根本无力组织起有效抵抗，巴蜀汉中已是囊中之物。然而，你帅帐内的气氛却比帐外的寒风还要凝重。诸侯们的使者往来不绝，言辞从最初的恭敬探询，逐渐变为夹枪带棒的催促与不满。尤其是齐地的田荣，他拒不接受任何来自你的指令，并公然收容反楚势力，俨然已成东方的一颗毒瘤。\n\n范增将一卷竹简重重拍在案上，上面满是各地诸侯私下联络的密报。“霸王！追击刘邦是剪除枝叶，分封诸侯才是稳固树根！如今根基不稳，枝叶剪得再干净又有何用？若让田荣之流连成气候，楚军将陷入两线作战的泥潭，重蹈秦朝覆灭之覆辙啊！”他的声音嘶哑，眼神中满是忧虑。你明白，在你专注于西边的“狼”时，东边的“虎”与“豹”已经开始磨砺爪牙。"}, {"role": "user", "content": "我选择了：依史分封，以武慑之"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：项羽\n所属时代：楚汉之争\n人物特质：西楚霸王，力拔山兮气盖世；悍勇无双却多疑的统帅\n关键历史锚点：巨鹿之战；鸿门宴；西楚建国与制度；垓下之围\n主要矛盾：如何稳固西楚政权；与刘邦之间的权谋博弈；军心士气和战略抉择\n推荐章节总数：至少 10 章\n\n当前章节：第 5 章\n当前主线成功率：68%\n目标总章节数：至少 10 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“依史分封，以武慑之。将诸侯分封至偏远之地，以亲信扼守关中与膏腴之地。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 20:51:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 20:51:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 20:51:14 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 20:51:14 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 20:51:14 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 20:51:14 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 20:51:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 20:51:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 20:51:14 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 20:51:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 20:51:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 20:51:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 20:51:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 20:51:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 20:51:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 20:51:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 20:51:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 20:55:59 | INFO     | api.story:retry_from_node:396 - 收到时空回溯请求，目标节点: 2
2025-09-25 20:55:59 | INFO     | database.crud:prune_story_after_node:290 - 正在从节点 2 之后进行时空回溯...
2025-09-25 20:55:59 | INFO     | database.crud:prune_story_after_node:301 - 节点 2 的所有后代节点 [5, 7, 9, 3, 4, 6, 8] 将被删除。
2025-09-25 20:55:59 | INFO     | database.crud:prune_story_after_node:312 - 已成功完成回溯，当前故事线的终点为节点 2。
2025-09-25 20:56:08 | INFO     | api.user:logout_current_user:128 - 用户 690161230@qq.com 已登出，token_version -> 3
2025-09-25 20:56:28 | CRITICAL | core.llm_clients:generate:98 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000001B6C1EF8CD0>' -H 'OpenAI-Project: <openai.Omit object at 0x000001B6C207F7D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名顶级的沉浸式关卡设计师。请根据用户的重生愿望与历史设定，生成第一关的结构化元信息。\n\n【背景设定参考】\n角色定位：狄仁杰\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（120-180字），融合时代氛围、主要人物关系、冲突前景。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字），明确玩家第一关的核心目标。\n\n用户重生愿望：\"狄仁杰\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-25 20:56:51 | INFO     | core.llm_clients:generate:131 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2570
2025-09-25 21:02:43 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 21:02:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 21:02:45 | CRITICAL | core.llm_clients:__init__:47 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 21:02:45 | INFO     | core.llm_clients:__init__:50 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:02:45 | INFO     | core.llm_clients:__init__:51 - API地址: https://new.wuxuai.com/v1
2025-09-25 21:02:45 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 21:02:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:02:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:02:45 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 21:02:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 21:02:45 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 21:02:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:02:46 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 21:02:46 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 21:02:46 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 21:02:46 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:02:46 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 21:04:56 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 21:04:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 21:04:57 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 21:04:57 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:04:57 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 21:04:57 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 21:04:58 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:04:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:04:58 | INFO     | core.speculation:__init__:27 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 21:04:58 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 21:04:58 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 21:04:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:04:59 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 21:04:59 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 21:04:59 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 21:04:59 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:04:59 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 21:06:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 21:06:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 21:06:09 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 21:06:09 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:06:09 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 21:06:09 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 21:06:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:06:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:06:09 | INFO     | core.speculation:__init__:28 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 21:06:09 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 21:06:09 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 21:06:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:06:10 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 21:06:10 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 21:06:10 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 21:06:10 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:06:10 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 21:06:56 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 21:06:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 21:06:57 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 21:06:57 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:06:57 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 21:06:57 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 21:06:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:06:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:06:58 | INFO     | core.speculation:__init__:28 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 21:06:58 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 21:06:58 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 21:06:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:06:59 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 21:06:59 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 21:06:59 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 21:06:59 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:06:59 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 21:08:37 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 21:08:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 21:08:39 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 21:08:39 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:08:39 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 21:08:39 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 21:08:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:08:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:08:39 | INFO     | core.speculation:__init__:28 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 21:08:39 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 21:08:39 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 21:08:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 21:08:40 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 21:08:40 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 21:08:40 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 21:08:40 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 21:08:40 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 22:23:14 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 22:23:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:23:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 22:23:19 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 22:23:19 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:23:19 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 22:23:19 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 22:23:19 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:23:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:23:19 | INFO     | core.speculation:__init__:28 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 22:23:19 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 22:23:19 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 22:23:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:23:20 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 22:23:20 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 22:23:20 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 22:23:20 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:23:20 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 22:24:02 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5D36E90>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC5D37F50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名顶级的沉浸式关卡设计师。请根据用户的重生愿望与历史设定，生成第一关的结构化元信息。\n\n【背景设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（120-180字），融合时代氛围、主要人物关系、冲突前景。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字），明确玩家第一关的核心目标。\n\n用户重生愿望：\"张飞\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-25 22:24:20 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1459
2025-09-25 22:24:45 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 张飞
2025-09-25 22:24:45 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '张飞'
2025-09-25 22:24:45 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5ADBF90>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC5D4B790>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n【关键锚点事件（按需引用）】\n- 寻找该人物或时代的经典事件\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 9 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:25:41 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2756
2025-09-25 22:25:41 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1049 预览='{\n  "text": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。",\n  '
2025-09-25 22:25:41 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1049 预览='{\n  "text": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家'
2025-09-25 22:25:41 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1049 预览='{\n  "text": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家'
2025-09-25 22:25:41 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1049 预览='{\n  "text": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着'
2025-09-25 22:25:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 282
2025-09-25 22:25:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:25:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:25:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:25:41 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-25 22:25:41 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 22:25:41 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 22:25:41 | DEBUG    | core.speculation:enqueue:55 - [Speculation] enqueue session=35 node=35 depth=3
2025-09-25 22:25:41 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！
2025-09-25 22:25:41 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5C08B50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC610EB90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 2 章\n当前主线成功率：50%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:26:38 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3163
2025-09-25 22:26:38 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=949 预览='{\n  "text": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。",\n  "success_rate": 40,\n  "choices": [\n  '
2025-09-25 22:26:38 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=949 预览='{\n  "text": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。'
2025-09-25 22:26:38 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=949 预览='{\n  "text": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。'
2025-09-25 22:26:38 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=949 预览='{\n  "text": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白'
2025-09-25 22:26:38 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 245
2025-09-25 22:26:38 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:26:38 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:26:38 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:26:38 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:26:38 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=36 parent=35 choice='怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！' depth=3
2025-09-25 22:26:38 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 强攻东门，佯装主力，暗中派一小队精锐从水路奇袭南门。
2025-09-25 22:26:38 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6137910>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC6137890>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：40%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“强攻东门，佯装主力，暗中派一小队精锐从水路奇袭南门。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:27:06 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3245
2025-09-25 22:27:06 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1152 预览='{\n  "text": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部攻势最烈、吸引了几乎所有城防军目光之时，一名斥候浑身插着箭矢，疯了般冲到我马前：“将军！南门水路外围，有……有张辽的巡江营！我们的小队行踪恐怕已经暴露！”这个名字如一盆冰水浇下，张辽，吕布麾下最难缠的将领之一！奇袭计划已在暴露的边缘，东门的佯攻部队也伤亡惨重，再拖下去，便会是全军'
2025-09-25 22:27:06 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1152 预览='{\n  "text": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部'
2025-09-25 22:27:06 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1152 预览='{\n  "text": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部'
2025-09-25 22:27:06 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1152 预览='{\n  "text": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部攻势最烈、吸引了几乎所有城防军目光之时，一名斥候浑身插着箭矢，疯了般冲到我马前：'
2025-09-25 22:27:06 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 310
2025-09-25 22:27:06 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:27:06 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:27:06 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:27:06 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:27:06 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=37 parent=36 choice='强攻东门，佯装主力，暗中派一小队精锐从水路奇袭南门。' depth=2
2025-09-25 22:27:06 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 传令水路小队，不惜一切代价按原计划夺门！我亲自擂鼓，东门再掀猛攻，为他们争取时间！
2025-09-25 22:27:06 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5D4BA10>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC613B410>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部攻势最烈、吸引了几乎所有城防军目光之时，一名斥候浑身插着箭矢，疯了般冲到我马前：“将军！南门水路外围，有……有张辽的巡江营！我们的小队行踪恐怕已经暴露！”这个名字如一盆冰水浇下，张辽，吕布麾下最难缠的将领之一！奇袭计划已在暴露的边缘，东门的佯攻部队也伤亡惨重，再拖下去，便会是全军覆没的结局。我的大脑在轰鸣，必须立刻做出决断。"}, {"role": "user", "content": "我选择了：强攻东门，佯装主力，暗中派一小队精锐从水路奇袭南门。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：45%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“传令水路小队，不惜一切代价按原计划夺门！我亲自擂鼓，东门再掀猛攻，为他们争取时间！”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:27:28 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3166
2025-09-25 22:27:28 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1139 预览='{\n  "text": "“传令下去！计划不变，死战夺门！”我将传令兵推向黑暗，自己则一把夺过亲卫手中的巨槌，翻身跃上战鼓高台。“咚！咚咚！”鼓声如雷，压过了战场上所有的嘶吼与哀嚎。残存的弟兄们仿佛被注入了最后的疯狂，以血肉之躯撞向东门那坚不可摧的壁垒。火光映照下，我能清晰看到高顺嘴角泛起的一丝冷笑。他看穿了我的意图！就在我心头一沉之际，南门方向火光冲天，隐约传来厮杀之声！然而，那火光与喊杀声仅仅持续了不到一炷香的功夫，便迅速被黑暗吞噬，再无声息。张辽……他果然名不虚传！奇袭失败了。东门的猛攻也成了强弩之末，弟兄们被箭雨和滚石逼得节节败退，士气已然崩溃。冰冷的绝望扼住了我的咽喉，我们已是瓮中之'
2025-09-25 22:27:28 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1139 预览='{\n  "text": "“传令下去！计划不变，死战夺门！”我将传令兵推向黑暗，自己则一把夺过亲卫手中的巨槌，翻身跃上战鼓高台。“咚！咚咚！”鼓声如雷，压过了战场上所有的嘶吼与哀嚎。残存的弟兄们仿佛被注入了最后的疯狂，以血肉之躯撞向东门那坚不可摧的壁垒。火光映照下，我能清晰看到高顺嘴角泛起的一丝冷笑。他看穿了我的意图！'
2025-09-25 22:27:28 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1139 预览='{\n  "text": "“传令下去！计划不变，死战夺门！”我将传令兵推向黑暗，自己则一把夺过亲卫手中的巨槌，翻身跃上战鼓高台。“咚！咚咚！”鼓声如雷，压过了战场上所有的嘶吼与哀嚎。残存的弟兄们仿佛被注入了最后的疯狂，以血肉之躯撞向东门那坚不可摧的壁垒。火光映照下，我能清晰看到高顺嘴角泛起的一丝冷笑。他看穿了我的意图！'
2025-09-25 22:27:28 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1139 预览='{\n  "text": "“传令下去！计划不变，死战夺门！”我将传令兵推向黑暗，自己则一把夺过亲卫手中的巨槌，翻身跃上战鼓高台。“咚！咚咚！”鼓声如雷，压过了战场上所有的嘶吼与哀嚎。残存的弟兄们仿佛被注入了最后的疯狂，以血肉之躯撞向东门那坚不可摧的壁垒。火光映照下，我能清晰看到高顺嘴角泛起的一丝冷笑。他看穿了我的意图！就在我心头一沉之际，南门方向火光冲天，隐约传来厮杀之声！然而，那火光与喊杀声仅仅'
2025-09-25 22:27:28 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 355
2025-09-25 22:27:28 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:27:28 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:27:28 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:27:28 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:27:28 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=38 parent=37 choice='传令水路小队，不惜一切代价按原计划夺门！我亲自擂鼓，东门再掀猛攻，为他们争取时间！' depth=1
2025-09-25 22:27:28 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 密令水路小队暂停攻门，先行设伏，务必歼灭或重创张辽的巡逻队，扫清障碍！
2025-09-25 22:27:28 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6136290>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC6134D50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部攻势最烈、吸引了几乎所有城防军目光之时，一名斥候浑身插着箭矢，疯了般冲到我马前：“将军！南门水路外围，有……有张辽的巡江营！我们的小队行踪恐怕已经暴露！”这个名字如一盆冰水浇下，张辽，吕布麾下最难缠的将领之一！奇袭计划已在暴露的边缘，东门的佯攻部队也伤亡惨重，再拖下去，便会是全军覆没的结局。我的大脑在轰鸣，必须立刻做出决断。"}, {"role": "user", "content": "我选择了：强攻东门，佯装主力，暗中派一小队精锐从水路奇袭南门。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：45%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“密令水路小队暂停攻门，先行设伏，务必歼灭或重创张辽的巡逻队，扫清障碍！”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:27:58 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6154F10>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC6156410>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名顶级的沉浸式关卡设计师。请根据用户的重生愿望与历史设定，生成第一关的结构化元信息。\n\n【背景设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（120-180字），融合时代氛围、主要人物关系、冲突前景。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字），明确玩家第一关的核心目标。\n\n用户重生愿望：\"张飞\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-25 22:28:12 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1543
2025-09-25 22:28:15 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 张飞
2025-09-25 22:28:15 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '张飞'
2025-09-25 22:28:15 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5D4B110>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC5D66990>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n【关键锚点事件（按需引用）】\n- 寻找该人物或时代的经典事件\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 9 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:28:25 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3722
2025-09-25 22:28:25 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1197 预览='{\n  "text": "军令如山，一道隐秘的手势划破夜空，传向了水路。泗水支流的芦苇荡中，我那百余名心腹精锐瞬间化作了潜伏的死神。他们将小筏沉入水中，仅露出呼吸的管子，屏息等待着猎物。不久，张辽的巡江船队果然出现了，船头灯笼的光晕扫过水面，船上士兵谈笑风生，显然未料到此处暗藏杀机。就在船队进入伏击圈核心的刹那，信号发出！数十支淬毒的弩箭破水而出，船上的士卒应声而倒。紧接着，我的弟兄们如水中蛟龙般扑上敌船，展开了一场无声而血腥的绞杀。然而，张辽的反应远超常人，他竟在第一时间斩断绳索，放弃了大部分船只，亲率数艘战船突围。混战中，我方虽重创其部，但张辽本人却带着残兵逃向南门，凄厉的号角声随之响彻夜'
2025-09-25 22:28:25 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1197 预览='{\n  "text": "军令如山，一道隐秘的手势划破夜空，传向了水路。泗水支流的芦苇荡中，我那百余名心腹精锐瞬间化作了潜伏的死神。他们将小筏沉入水中，仅露出呼吸的管子，屏息等待着猎物。不久，张辽的巡江船队果然出现了，船头灯笼的光晕扫过水面，船上士兵谈笑风生，显然未料到此处暗藏杀机。就在船队进入伏击圈核心的刹那，信号发'
2025-09-25 22:28:25 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1197 预览='{\n  "text": "军令如山，一道隐秘的手势划破夜空，传向了水路。泗水支流的芦苇荡中，我那百余名心腹精锐瞬间化作了潜伏的死神。他们将小筏沉入水中，仅露出呼吸的管子，屏息等待着猎物。不久，张辽的巡江船队果然出现了，船头灯笼的光晕扫过水面，船上士兵谈笑风生，显然未料到此处暗藏杀机。就在船队进入伏击圈核心的刹那，信号发'
2025-09-25 22:28:25 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1197 预览='{\n  "text": "军令如山，一道隐秘的手势划破夜空，传向了水路。泗水支流的芦苇荡中，我那百余名心腹精锐瞬间化作了潜伏的死神。他们将小筏沉入水中，仅露出呼吸的管子，屏息等待着猎物。不久，张辽的巡江船队果然出现了，船头灯笼的光晕扫过水面，船上士兵谈笑风生，显然未料到此处暗藏杀机。就在船队进入伏击圈核心的刹那，信号发出！数十支淬毒的弩箭破水而出，船上的士卒应声而倒。紧接着，我的弟兄们如水中蛟龙般'
2025-09-25 22:28:25 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 352
2025-09-25 22:28:25 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:28:25 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:28:25 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:28:25 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:28:25 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=39 parent=37 choice='密令水路小队暂停攻门，先行设伏，务必歼灭或重创张辽的巡逻队，扫清障碍！' depth=1
2025-09-25 22:28:25 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 鸣金收兵！令东门佯攻部队交替掩护撤退。同时命水路小队放弃夺门，转为潜入，首要任务是探明主公家眷下落。
2025-09-25 22:28:25 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5A8FC50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC612F250>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "“分兵！”我的咆哮在火光中回荡。我亲率主力，如疯虎般猛撞徐州东门，丈八蛇矛卷起血肉风暴，故意将声势造得惊天动地，死死吸引着城头高顺的注意。箭矢如蝗，不断有弟兄在我身边倒下，但我不能退，一步都不能！与此同时，我最心腹的百余名精锐已悄然抬着数艘小筏，顺着泗水支流，摸向防备空虚的南门。然而，就在我部攻势最烈、吸引了几乎所有城防军目光之时，一名斥候浑身插着箭矢，疯了般冲到我马前：“将军！南门水路外围，有……有张辽的巡江营！我们的小队行踪恐怕已经暴露！”这个名字如一盆冰水浇下，张辽，吕布麾下最难缠的将领之一！奇袭计划已在暴露的边缘，东门的佯攻部队也伤亡惨重，再拖下去，便会是全军覆没的结局。我的大脑在轰鸣，必须立刻做出决断。"}, {"role": "user", "content": "我选择了：强攻东门，佯装主力，暗中派一小队精锐从水路奇袭南门。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：45%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“鸣金收兵！令东门佯攻部队交替掩护撤退。同时命水路小队放弃夺门，转为潜入，首要任务是探明主公家眷下落。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:28:43 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2748
2025-09-25 22:28:43 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1191 预览='{\n  "text": "第一章：桃园非昨，血誓今朝\\n\\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着自己那粗犷的嗓音与他们一同念出誓词：“不求同年同月同日生，但求同年同月同日死！”这誓言如雷，震得桃花簌簌而落，也震得你灵魂深处的记忆翻涌不休。你知道这滚烫的誓言背后，是关羽的败走麦城，是刘备的白帝城托孤，也是你自己，在伐吴前夕被帐下小人刺杀的屈辱结局。黄巾之乱的烽火已在不远处燃起'
2025-09-25 22:28:43 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1191 预览='{\n  "text": "第一章：桃园非昨，血誓今朝\\n\\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着'
2025-09-25 22:28:43 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1191 预览='{\n  "text": "第一章：桃园非昨，血誓今朝\\n\\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着'
2025-09-25 22:28:43 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1191 预览='{\n  "text": "第一章：桃园非昨，血誓今朝\\n\\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着自己那粗犷的嗓音与他们一同念出誓词：“不求同年同月同日生，但求同年同月同日死！”'
2025-09-25 22:28:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 360
2025-09-25 22:28:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:28:43 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:28:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:28:43 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/background1.jpg
2025-09-25 22:28:43 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 22:28:43 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 22:28:43 | DEBUG    | core.speculation:enqueue:55 - [Speculation] enqueue session=36 node=40 depth=3
2025-09-25 22:28:43 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 依史而行，提议投奔校尉邹靖，参与镇压黄巾军的官方行动。
2025-09-25 22:28:43 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC612C1D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC612D510>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：桃园非昨，血誓今朝\n\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着自己那粗犷的嗓音与他们一同念出誓词：“不求同年同月同日生，但求同年同月同日死！”这誓言如雷，震得桃花簌簌而落，也震得你灵魂深处的记忆翻涌不休。你知道这滚烫的誓言背后，是关羽的败走麦城，是刘备的白帝城托孤，也是你自己，在伐吴前夕被帐下小人刺杀的屈辱结局。黄巾之乱的烽火已在不远处燃起，这是你们兄弟三人扬名立万的起点，却也通向那早已注定的悲剧。此刻，酒碗已空，誓言已立，大哥刘备正望着你们，目光灼灼，等待着你这位“三弟”的下一步行动。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 2 章\n当前主线成功率：50%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“依史而行，提议投奔校尉邹靖，参与镇压黄巾军的官方行动。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:28:54 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3542
2025-09-25 22:28:54 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1133 预览='{\n  "text": "“鸣金！撤退！”当这个屈辱的命令从我喉咙里挤出时，心脏仿佛被狠狠攥住。残存的兵士们如蒙大赦，相互搀扶着，在“陷阵营”冰冷的注视和零星的箭雨下狼狈地退回泗水南岸。清点下来，出征的近千弟兄，已折损三成，士气跌至谷底。我强压下再战的冲动，通过密令，让已经潜近南门的水路小队中止了夺门计划，转为蛰伏，他们的任务从攻城利刃，变成了刺探情报的匕首——必须不惜一切代价，查明大嫂们的安危。就在我军营帐一片死寂，人人包扎伤口，气氛凝重之时，一名亲兵领着一个商人打扮的男子匆匆入帐。他自称是徐州糜家的心腹，冒死前来送信。信中，糜竺言明：主公家眷暂时无虞，被吕布软禁于府衙后院，由张辽亲自看管。'
2025-09-25 22:28:54 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1133 预览='{\n  "text": "“鸣金！撤退！”当这个屈辱的命令从我喉咙里挤出时，心脏仿佛被狠狠攥住。残存的兵士们如蒙大赦，相互搀扶着，在“陷阵营”冰冷的注视和零星的箭雨下狼狈地退回泗水南岸。清点下来，出征的近千弟兄，已折损三成，士气跌至谷底。我强压下再战的冲动，通过密令，让已经潜近南门的水路小队中止了夺门计划，转为蛰伏，他'
2025-09-25 22:28:54 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1133 预览='{\n  "text": "“鸣金！撤退！”当这个屈辱的命令从我喉咙里挤出时，心脏仿佛被狠狠攥住。残存的兵士们如蒙大赦，相互搀扶着，在“陷阵营”冰冷的注视和零星的箭雨下狼狈地退回泗水南岸。清点下来，出征的近千弟兄，已折损三成，士气跌至谷底。我强压下再战的冲动，通过密令，让已经潜近南门的水路小队中止了夺门计划，转为蛰伏，他'
2025-09-25 22:28:54 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1133 预览='{\n  "text": "“鸣金！撤退！”当这个屈辱的命令从我喉咙里挤出时，心脏仿佛被狠狠攥住。残存的兵士们如蒙大赦，相互搀扶着，在“陷阵营”冰冷的注视和零星的箭雨下狼狈地退回泗水南岸。清点下来，出征的近千弟兄，已折损三成，士气跌至谷底。我强压下再战的冲动，通过密令，让已经潜近南门的水路小队中止了夺门计划，转为蛰伏，他们的任务从攻城利刃，变成了刺探情报的匕首——必须不惜一切代价，查明大嫂们的安危。'
2025-09-25 22:28:54 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 360
2025-09-25 22:28:54 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:28:54 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:28:54 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:28:54 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:28:54 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=41 parent=37 choice='鸣金收兵！令东门佯攻部队交替掩护撤退。同时命水路小队放弃夺门，转为潜入，首要任务是探明主公家眷下落。' depth=1
2025-09-25 22:28:54 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 收拢部队，立即撤往广陵，寻求陈登的帮助并暂作休整。
2025-09-25 22:28:54 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6161450>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC6163CD0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：40%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“收拢部队，立即撤往广陵，寻求陈登的帮助并暂作休整。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:29:19 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3227
2025-09-25 22:29:19 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1110 预览='{\n  "text": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然而，在他的书房内，当屏退左右，他那张温和的面孔便显露出几分疏离与审视。“翼德将军，”他缓缓开口，“吕布骁勇，如今又得徐州，势不可挡。广陵兵微将寡，恐非其敌手。”他的话语如同一盆冷水，浇灭了我心中刚刚燃起的复仇火焰。我明白，他是在告诉我，我这只丧家之犬，别指望他会为了我而与如日中天'
2025-09-25 22:29:19 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1110 预览='{\n  "text": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然'
2025-09-25 22:29:19 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1110 预览='{\n  "text": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然'
2025-09-25 22:29:19 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1110 预览='{\n  "text": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然而，在他的书房内，当屏退左右，他那张温和的面孔便显露出几分疏离与审视。“翼德将军'
2025-09-25 22:29:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 342
2025-09-25 22:29:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:29:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:29:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:29:19 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:29:19 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=42 parent=36 choice='收拢部队，立即撤往广陵，寻求陈登的帮助并暂作休整。' depth=2
2025-09-25 22:29:19 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 放下身段，诚恳向陈登请教破吕布之策，并透露可联络曹操为外援，展现自己的战略价值。
2025-09-25 22:29:19 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6144A50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC6144D10>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然而，在他的书房内，当屏退左右，他那张温和的面孔便显露出几分疏离与审视。“翼德将军，”他缓缓开口，“吕布骁勇，如今又得徐州，势不可挡。广陵兵微将寡，恐非其敌手。”他的话语如同一盆冷水，浇灭了我心中刚刚燃起的复仇火焰。我明白，他是在告诉我，我这只丧家之犬，别指望他会为了我而与如日中天的吕布为敌。我手中的残兵，既是唯一的筹码，也是烫手的山芋。如何说服他，将决定我们是就此沉沦，还是觅得一线生机。"}, {"role": "user", "content": "我选择了：收拢部队，立即撤往广陵，寻求陈登的帮助并暂作休整。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：35%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“放下身段，诚恳向陈登请教破吕布之策，并透露可联络曹操为外援，展现自己的战略价值。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:30:16 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3686
2025-09-25 22:30:16 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1178 预览='{\n  "text": "我深吸一口气，压下胸中翻腾的猛虎，对着眼前这位文士，郑重地躬身一揖到底。“元龙先生，”我用一种自己都未曾想过的诚恳语气说道，“飞一勇之夫，有眼无珠，致使徐州陷落，使兄长与家眷生死未卜。今悔之晚矣！先生乃徐州栋梁，智谋深远，恳请先生教我，如何才能雪此奇耻，夺回徐州？”\\n陈登眼中闪过一丝讶异，显然没料到传闻中暴烈无谋的张飞会如此。他扶起我，沉吟片刻，目光锐利地审视着我。“吕布虽勇，然无远虑，性多猜忌，其部将亦非同心。此其可破之机。”他顿了顿，话锋一转，“然将军兵少，广陵亦弱，正面对抗无异于以卵击石。”\\n“我有一策！”我抓住时机，将脑中那个成熟的想法和盘托出，“可遣使北'
2025-09-25 22:30:16 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1178 预览='{\n  "text": "我深吸一口气，压下胸中翻腾的猛虎，对着眼前这位文士，郑重地躬身一揖到底。“元龙先生，”我用一种自己都未曾想过的诚恳语气说道，“飞一勇之夫，有眼无珠，致使徐州陷落，使兄长与家眷生死未卜。今悔之晚矣！先生乃徐州栋梁，智谋深远，恳请先生教我，如何才能雪此奇耻，夺回徐州？”\\n陈登眼中闪过一丝讶异，显'
2025-09-25 22:30:16 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1178 预览='{\n  "text": "我深吸一口气，压下胸中翻腾的猛虎，对着眼前这位文士，郑重地躬身一揖到底。“元龙先生，”我用一种自己都未曾想过的诚恳语气说道，“飞一勇之夫，有眼无珠，致使徐州陷落，使兄长与家眷生死未卜。今悔之晚矣！先生乃徐州栋梁，智谋深远，恳请先生教我，如何才能雪此奇耻，夺回徐州？”\\n陈登眼中闪过一丝讶异，显'
2025-09-25 22:30:16 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1178 预览='{\n  "text": "我深吸一口气，压下胸中翻腾的猛虎，对着眼前这位文士，郑重地躬身一揖到底。“元龙先生，”我用一种自己都未曾想过的诚恳语气说道，“飞一勇之夫，有眼无珠，致使徐州陷落，使兄长与家眷生死未卜。今悔之晚矣！先生乃徐州栋梁，智谋深远，恳请先生教我，如何才能雪此奇耻，夺回徐州？”\\n陈登眼中闪过一丝讶异，显然没料到传闻中暴烈无谋的张飞会如此。他扶起我，沉吟片刻，目光锐利地审视着我。“吕'
2025-09-25 22:30:16 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 400
2025-09-25 22:30:16 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:30:16 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:30:16 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:30:16 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:30:16 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=43 parent=42 choice='放下身段，诚恳向陈登请教破吕布之策，并透露可联络曹操为外援，展现自己的战略价值。' depth=1
2025-09-25 22:30:16 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 质问陈登，要求他立即出兵，以大义相逼，共击吕布。
2025-09-25 22:30:16 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6145610>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC614FC90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然而，在他的书房内，当屏退左右，他那张温和的面孔便显露出几分疏离与审视。“翼德将军，”他缓缓开口，“吕布骁勇，如今又得徐州，势不可挡。广陵兵微将寡，恐非其敌手。”他的话语如同一盆冷水，浇灭了我心中刚刚燃起的复仇火焰。我明白，他是在告诉我，我这只丧家之犬，别指望他会为了我而与如日中天的吕布为敌。我手中的残兵，既是唯一的筹码，也是烫手的山芋。如何说服他，将决定我们是就此沉沦，还是觅得一线生机。"}, {"role": "user", "content": "我选择了：收拢部队，立即撤往广陵，寻求陈登的帮助并暂作休整。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：35%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“质问陈登，要求他立即出兵，以大义相逼，共击吕布。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:30:40 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3430
2025-09-25 22:30:40 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1165 预览='{\n  "text": "“大义？！” 我怒火中烧，一掌拍在案几上，震得杯盏作响。“吕布背信弃义，夺我兄长基业，囚我兄长家眷，此等国贼，人人得而诛之！你陈元龙身为汉臣，坐拥广陵，难道要坐视此等逆贼猖獗，置大义于不顾吗？！” 我的咆哮在书房中回荡，双目赤红，死死地盯着他。陈登却未动怒，只是缓缓摇头，眼神中带着一丝怜悯：“翼德将军，匹夫之勇，难成大事。吕布帐下有高顺、张辽之辈，皆是万人敌。你如今兵不满千，怒而兴兵，无异于以卵击石，非但救不了玄德公家眷，连将军自己与这千百弟兄也要白白葬送。我收留将军，是敬玄德公仁德，非是畏将军之武勇。” 他的话语冷静而尖锐，像一根根钢针，刺穿了我虚张声势的愤怒，只剩'
2025-09-25 22:30:40 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1165 预览='{\n  "text": "“大义？！” 我怒火中烧，一掌拍在案几上，震得杯盏作响。“吕布背信弃义，夺我兄长基业，囚我兄长家眷，此等国贼，人人得而诛之！你陈元龙身为汉臣，坐拥广陵，难道要坐视此等逆贼猖獗，置大义于不顾吗？！” 我的咆哮在书房中回荡，双目赤红，死死地盯着他。陈登却未动怒，只是缓缓摇头，眼神中带着一丝怜悯：“'
2025-09-25 22:30:40 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1165 预览='{\n  "text": "“大义？！” 我怒火中烧，一掌拍在案几上，震得杯盏作响。“吕布背信弃义，夺我兄长基业，囚我兄长家眷，此等国贼，人人得而诛之！你陈元龙身为汉臣，坐拥广陵，难道要坐视此等逆贼猖獗，置大义于不顾吗？！” 我的咆哮在书房中回荡，双目赤红，死死地盯着他。陈登却未动怒，只是缓缓摇头，眼神中带着一丝怜悯：“'
2025-09-25 22:30:40 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1165 预览='{\n  "text": "“大义？！” 我怒火中烧，一掌拍在案几上，震得杯盏作响。“吕布背信弃义，夺我兄长基业，囚我兄长家眷，此等国贼，人人得而诛之！你陈元龙身为汉臣，坐拥广陵，难道要坐视此等逆贼猖獗，置大义于不顾吗？！” 我的咆哮在书房中回荡，双目赤红，死死地盯着他。陈登却未动怒，只是缓缓摇头，眼神中带着一丝怜悯：“翼德将军，匹夫之勇，难成大事。吕布帐下有高顺、张辽之辈，皆是万人敌。你如今兵不满'
2025-09-25 22:30:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 332
2025-09-25 22:30:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:30:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:30:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:30:40 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:30:40 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=44 parent=42 choice='质问陈登，要求他立即出兵，以大义相逼，共击吕布。' depth=1
2025-09-25 22:30:40 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 暂避锋芒，请求陈登收留部队，并立即派人四处寻找大哥刘备的下落，以汇合为首要目标。
2025-09-25 22:30:40 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5A88110>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC5A78410>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "撤往广陵的道路，每一步都像是踩在烧红的烙铁上，灼烧着我的五脏六腑。身后是徐州城的火光，耳边是弟兄们的哀嚎，而心中，是对大哥刘备及其家眷的无尽愧疚。当我带着这支不足千人的残兵败将抵达广陵城下时，迎接我们的是陈登——这位徐州的名士，广陵的太守。他将我们迎入城中，提供了粮草与营地，言语间满是慰问。然而，在他的书房内，当屏退左右，他那张温和的面孔便显露出几分疏离与审视。“翼德将军，”他缓缓开口，“吕布骁勇，如今又得徐州，势不可挡。广陵兵微将寡，恐非其敌手。”他的话语如同一盆冷水，浇灭了我心中刚刚燃起的复仇火焰。我明白，他是在告诉我，我这只丧家之犬，别指望他会为了我而与如日中天的吕布为敌。我手中的残兵，既是唯一的筹码，也是烫手的山芋。如何说服他，将决定我们是就此沉沦，还是觅得一线生机。"}, {"role": "user", "content": "我选择了：收拢部队，立即撤往广陵，寻求陈登的帮助并暂作休整。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：35%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“暂避锋芒，请求陈登收留部队，并立即派人四处寻找大哥刘备的下落，以汇合为首要目标。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:31:04 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3218
2025-09-25 22:31:04 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1155 预览='{\n  "text": "在陈登的书房内，烛火摇曳，映照着他深邃而审视的目光。我压下心头的万千思绪，将那份来自异世的记忆与此刻的屈辱尽数咽下。我，张飞，不能再凭一时意气行事。我收起丈八蛇矛，对着陈登深深一揖，动作笨拙却满含诚意。“元龙先生，”我的声音沙哑，却异常清晰，“徐州之失，皆在我一人之过。如今我只求一事，请先生收留我这几百名弟兄，并助我打探兄长下落。只要能与兄长汇合，飞必有重报！”陈登眼中闪过一丝讶异，似乎没想到传说中暴烈的张飞会如此折节。他沉默片刻，终于缓缓点头：“翼德将军能以大局为重，登亦非不识时务之人。将军与部下可暂驻城外，粮草我当尽力供应。至于玄德公，我已派人探听，闻其可能已南下'
2025-09-25 22:31:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1155 预览='{\n  "text": "在陈登的书房内，烛火摇曳，映照着他深邃而审视的目光。我压下心头的万千思绪，将那份来自异世的记忆与此刻的屈辱尽数咽下。我，张飞，不能再凭一时意气行事。我收起丈八蛇矛，对着陈登深深一揖，动作笨拙却满含诚意。“元龙先生，”我的声音沙哑，却异常清晰，“徐州之失，皆在我一人之过。如今我只求一事，请先生收'
2025-09-25 22:31:04 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1155 预览='{\n  "text": "在陈登的书房内，烛火摇曳，映照着他深邃而审视的目光。我压下心头的万千思绪，将那份来自异世的记忆与此刻的屈辱尽数咽下。我，张飞，不能再凭一时意气行事。我收起丈八蛇矛，对着陈登深深一揖，动作笨拙却满含诚意。“元龙先生，”我的声音沙哑，却异常清晰，“徐州之失，皆在我一人之过。如今我只求一事，请先生收'
2025-09-25 22:31:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1155 预览='{\n  "text": "在陈登的书房内，烛火摇曳，映照着他深邃而审视的目光。我压下心头的万千思绪，将那份来自异世的记忆与此刻的屈辱尽数咽下。我，张飞，不能再凭一时意气行事。我收起丈八蛇矛，对着陈登深深一揖，动作笨拙却满含诚意。“元龙先生，”我的声音沙哑，却异常清晰，“徐州之失，皆在我一人之过。如今我只求一事，请先生收留我这几百名弟兄，并助我打探兄长下落。只要能与兄长汇合，飞必有重报！”陈登眼中闪'
2025-09-25 22:31:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 358
2025-09-25 22:31:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:31:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:31:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:31:04 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:31:04 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=45 parent=42 choice='暂避锋芒，请求陈登收留部队，并立即派人四处寻找大哥刘备的下落，以汇合为首要目标。' depth=1
2025-09-25 22:31:04 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 就地转入山林，化整为零，袭扰吕布的粮道与巡逻队。
2025-09-25 22:31:04 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5A78410>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC611E250>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：40%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“就地转入山林，化整为零，袭扰吕布的粮道与巡逻队。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:31:10 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2651
2025-09-25 22:31:10 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1125 预览='{\n  "text": "第二章：初入军旅，锋芒乍现\\n\\n你的提议正合刘备与关羽之心。三人变卖家产，招募了五百乡勇，随即投奔校尉邹靖。军营之中，官兵往来，旌旗杂乱，一股肃杀之气混杂着马粪与汗水的味道扑面而来。邹靖见你们仪表不凡，又带来一支人马，颇为欣喜，将你们编入前部。然而，营中多是官宦子弟与老兵油子，他们看着你们这群“庄稼汉”，眼神里满是轻蔑与不屑。很快，战报传来，黄巾将领程远志率五万大军进犯涿郡。邹靖召集众将议事，面有忧色，帐内气氛凝重。此时，刘备上前一步，沉声道：“备愿领麾下五百义军，前去破敌！”邹靖闻言，既惊又疑，目光扫过你们三人，最终落在了你的丈八蛇矛上。他需要有人去挫敌锐气，但又'
2025-09-25 22:31:10 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1125 预览='{\n  "text": "第二章：初入军旅，锋芒乍现\\n\\n你的提议正合刘备与关羽之心。三人变卖家产，招募了五百乡勇，随即投奔校尉邹靖。军营之中，官兵往来，旌旗杂乱，一股肃杀之气混杂着马粪与汗水的味道扑面而来。邹靖见你们仪表不凡，又带来一支人马，颇为欣喜，将你们编入前部。然而，营中多是官宦子弟与老兵油子，他们看着你们这'
2025-09-25 22:31:10 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1125 预览='{\n  "text": "第二章：初入军旅，锋芒乍现\\n\\n你的提议正合刘备与关羽之心。三人变卖家产，招募了五百乡勇，随即投奔校尉邹靖。军营之中，官兵往来，旌旗杂乱，一股肃杀之气混杂着马粪与汗水的味道扑面而来。邹靖见你们仪表不凡，又带来一支人马，颇为欣喜，将你们编入前部。然而，营中多是官宦子弟与老兵油子，他们看着你们这'
2025-09-25 22:31:10 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1125 预览='{\n  "text": "第二章：初入军旅，锋芒乍现\\n\\n你的提议正合刘备与关羽之心。三人变卖家产，招募了五百乡勇，随即投奔校尉邹靖。军营之中，官兵往来，旌旗杂乱，一股肃杀之气混杂着马粪与汗水的味道扑面而来。邹靖见你们仪表不凡，又带来一支人马，颇为欣喜，将你们编入前部。然而，营中多是官宦子弟与老兵油子，他们看着你们这群“庄稼汉”，眼神里满是轻蔑与不屑。很快，战报传来，黄巾将领程远志率五万大军进犯'
2025-09-25 22:31:10 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 312
2025-09-25 22:31:10 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:31:10 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:31:10 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:31:10 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:31:10 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=46 parent=40 choice='依史而行，提议投奔校尉邹靖，参与镇压黄巾军的官方行动。' depth=3
2025-09-25 22:31:10 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 请为先锋，阵前斗将，直取程远志首级。
2025-09-25 22:31:10 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC6145790>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC5A5EDD0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：桃园非昨，血誓今朝\n\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着自己那粗犷的嗓音与他们一同念出誓词：“不求同年同月同日生，但求同年同月同日死！”这誓言如雷，震得桃花簌簌而落，也震得你灵魂深处的记忆翻涌不休。你知道这滚烫的誓言背后，是关羽的败走麦城，是刘备的白帝城托孤，也是你自己，在伐吴前夕被帐下小人刺杀的屈辱结局。黄巾之乱的烽火已在不远处燃起，这是你们兄弟三人扬名立万的起点，却也通向那早已注定的悲剧。此刻，酒碗已空，誓言已立，大哥刘备正望着你们，目光灼灼，等待着你这位“三弟”的下一步行动。"}, {"role": "assistant", "content": "第二章：初入军旅，锋芒乍现\n\n你的提议正合刘备与关羽之心。三人变卖家产，招募了五百乡勇，随即投奔校尉邹靖。军营之中，官兵往来，旌旗杂乱，一股肃杀之气混杂着马粪与汗水的味道扑面而来。邹靖见你们仪表不凡，又带来一支人马，颇为欣喜，将你们编入前部。然而，营中多是官宦子弟与老兵油子，他们看着你们这群“庄稼汉”，眼神里满是轻蔑与不屑。很快，战报传来，黄巾将领程远志率五万大军进犯涿郡。邹靖召集众将议事，面有忧色，帐内气氛凝重。此时，刘备上前一步，沉声道：“备愿领麾下五百义军，前去破敌！”邹靖闻言，既惊又疑，目光扫过你们三人，最终落在了你的丈八蛇矛上。他需要有人去挫敌锐气，但又不想折损自己的嫡系。这，既是你们的机会，也是一场豪赌。"}, {"role": "user", "content": "我选择了：依史而行，提议投奔校尉邹靖，参与镇压黄巾军的官方行动。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：58%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“请为先锋，阵前斗将，直取程远志首级。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:31:31 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3294
2025-09-25 22:31:31 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1121 预览='{\n  "text": "箭雨之下，弟兄们的哀嚎与怒骂刺痛着我的耳膜。现实给了我这具身体最惨痛的一课：仅凭匹夫之勇，不过是带着兄弟们去送死。我睚眦欲裂，却不得不下达撤退的命令。残兵败将，不足五百人，我们狼狈地退入徐州东面的山林之中。冰冷的雨水混着血水和泥浆，浇熄了最后的怒火，只剩下刺骨的悔恨与寒意。夜里，派出的探子带回了两个关键消息：其一，大哥并未在城中，他征讨袁术未归，主力尚在广陵一带；其二，吕布占领下邳后，并未伤害两位嫂嫂，反而派人前往广陵，似乎是想与大哥议和。这个消息让我错愕不已，吕布这反复无常的豺狼，葫芦里卖的什么药？是真心议和，还是想麻痹大哥，以图一举歼灭我军？大哥远在广陵，尚不知家'
2025-09-25 22:31:31 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1121 预览='{\n  "text": "箭雨之下，弟兄们的哀嚎与怒骂刺痛着我的耳膜。现实给了我这具身体最惨痛的一课：仅凭匹夫之勇，不过是带着兄弟们去送死。我睚眦欲裂，却不得不下达撤退的命令。残兵败将，不足五百人，我们狼狈地退入徐州东面的山林之中。冰冷的雨水混着血水和泥浆，浇熄了最后的怒火，只剩下刺骨的悔恨与寒意。夜里，派出的探子带回'
2025-09-25 22:31:31 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1121 预览='{\n  "text": "箭雨之下，弟兄们的哀嚎与怒骂刺痛着我的耳膜。现实给了我这具身体最惨痛的一课：仅凭匹夫之勇，不过是带着兄弟们去送死。我睚眦欲裂，却不得不下达撤退的命令。残兵败将，不足五百人，我们狼狈地退入徐州东面的山林之中。冰冷的雨水混着血水和泥浆，浇熄了最后的怒火，只剩下刺骨的悔恨与寒意。夜里，派出的探子带回'
2025-09-25 22:31:31 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1121 预览='{\n  "text": "箭雨之下，弟兄们的哀嚎与怒骂刺痛着我的耳膜。现实给了我这具身体最惨痛的一课：仅凭匹夫之勇，不过是带着兄弟们去送死。我睚眦欲裂，却不得不下达撤退的命令。残兵败将，不足五百人，我们狼狈地退入徐州东面的山林之中。冰冷的雨水混着血水和泥浆，浇熄了最后的怒火，只剩下刺骨的悔恨与寒意。夜里，派出的探子带回了两个关键消息：其一，大哥并未在城中，他征讨袁术未归，主力尚在广陵一带；其二，吕'
2025-09-25 22:31:31 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 326
2025-09-25 22:31:31 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:31:31 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:31:31 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:31:31 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:31:31 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=47 parent=36 choice='就地转入山林，化整为零，袭扰吕布的粮道与巡逻队。' depth=2
2025-09-25 22:31:31 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 率残部前往广陵，与大哥刘备汇合，负荆请罪。
2025-09-25 22:31:31 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC5AA40D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC60EA8D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "宿醉的剧痛如铁锥般凿击着我的头颅，浓烈的酒气混杂着营帐外的血腥味，让我一阵反胃。我猛然睁眼，映入眼帘的不是熟悉的桃园，而是一片狼藉的军帐。我是谁？我是张飞……但脑海中却翻涌着另一个世界的记忆。这份记忆告诉我，今夜，是公元196年，我因酗酒鞭打曹豹，导致他献城投降，大哥刘备的基业徐州，以及他的家眷，尽数落入了吕布之手！帐外，吕布军士的嚣叫声和兵刃碰撞声此起彼伏，仿佛在嘲笑着我的无能。悔恨与怒火交织，几乎要将我的胸膛撑裂。历史的车轮已然滚到我脚下，是重蹈覆辙，还是奋力一搏，将这该死的命运扭转？我紧握着冰冷的丈八蛇矛，指节因用力而发白，前路就在此刻，必须做出抉择。"}, {"role": "assistant", "content": "“杀回去！夺回徐州！”怒吼声撕裂喉咙，我提着丈八蛇矛，点起身边不足千人的残兵，如一头受伤的猛虎，疯了般冲向徐州城。然而，迎接我们的并非敞开的城门，而是箭如雨下！吕布早已布防，高顺的“陷阵营”如铁壁般屹立城头，冰冷的箭簇不断收割着我方士卒的性命。弟兄们的惨叫声如冷水浇头，让我沸腾的血液瞬间冰冷。这是一场屠杀，而非战斗。我们被死死地挡在城外，进退两难。眼看兵士锐气尽丧，我明白，仅凭一腔血勇，无法挽回败局。大哥的基业与家眷，正因我的鲁莽而陷入更深的绝境。我必须冷静下来，在全军覆没前做出决断。"}, {"role": "user", "content": "我选择了：怒火攻心，立即召集残部杀回徐州，从吕布手中夺回一切！"}, {"role": "assistant", "content": "箭雨之下，弟兄们的哀嚎与怒骂刺痛着我的耳膜。现实给了我这具身体最惨痛的一课：仅凭匹夫之勇，不过是带着兄弟们去送死。我睚眦欲裂，却不得不下达撤退的命令。残兵败将，不足五百人，我们狼狈地退入徐州东面的山林之中。冰冷的雨水混着血水和泥浆，浇熄了最后的怒火，只剩下刺骨的悔恨与寒意。夜里，派出的探子带回了两个关键消息：其一，大哥并未在城中，他征讨袁术未归，主力尚在广陵一带；其二，吕布占领下邳后，并未伤害两位嫂嫂，反而派人前往广陵，似乎是想与大哥议和。这个消息让我错愕不已，吕布这反复无常的豺狼，葫芦里卖的什么药？是真心议和，还是想麻痹大哥，以图一举歼灭我军？大哥远在广陵，尚不知家眷安危，而我这支残兵，是眼下唯一能对吕布造成威胁的力量。前路再次变得扑朔迷离。"}, {"role": "user", "content": "我选择了：就地转入山林，化整为零，袭扰吕布的粮道与巡逻队。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：25%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“率残部前往广陵，与大哥刘备汇合，负荆请罪。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:31:32 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3111
2025-09-25 22:31:32 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1111 预览='{\n  "text": "第三章：长坂坡前，丈八蛇矛\\n\\n“好！三弟既有此胆魄，我等便做你的后盾！”刘备眼中精光一闪，向邹靖力荐。邹靖半信半疑，允你为先锋。大兴山下，黄巾军如蚁附膻，黑压一片，军容不整却声势浩大。贼将程远志出马，头裹黄巾，身披铁铠，手持铁朔，厉声喝骂。你一拍马背，如黑旋风般冲出阵前，手中丈八蛇矛直指敌将，声若巨雷：“环眼贼在此！谁敢与我决一死战！”程远志见你单枪匹马，狞笑一声，催马迎战。双马交错，寒光一闪，他手中的铁朔尚未举起，你的蛇矛已如毒龙出洞，瞬间贯穿其咽喉！程远志双目圆睁，满脸的不可置信，轰然坠马。黄巾军见主帅阵前被斩，顿时大乱，士气崩溃。刘备与关羽趁势率军掩杀，五百'
2025-09-25 22:31:32 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1111 预览='{\n  "text": "第三章：长坂坡前，丈八蛇矛\\n\\n“好！三弟既有此胆魄，我等便做你的后盾！”刘备眼中精光一闪，向邹靖力荐。邹靖半信半疑，允你为先锋。大兴山下，黄巾军如蚁附膻，黑压一片，军容不整却声势浩大。贼将程远志出马，头裹黄巾，身披铁铠，手持铁朔，厉声喝骂。你一拍马背，如黑旋风般冲出阵前，手中丈八蛇矛直指敌'
2025-09-25 22:31:32 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1111 预览='{\n  "text": "第三章：长坂坡前，丈八蛇矛\\n\\n“好！三弟既有此胆魄，我等便做你的后盾！”刘备眼中精光一闪，向邹靖力荐。邹靖半信半疑，允你为先锋。大兴山下，黄巾军如蚁附膻，黑压一片，军容不整却声势浩大。贼将程远志出马，头裹黄巾，身披铁铠，手持铁朔，厉声喝骂。你一拍马背，如黑旋风般冲出阵前，手中丈八蛇矛直指敌'
2025-09-25 22:31:32 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1111 预览='{\n  "text": "第三章：长坂坡前，丈八蛇矛\\n\\n“好！三弟既有此胆魄，我等便做你的后盾！”刘备眼中精光一闪，向邹靖力荐。邹靖半信半疑，允你为先锋。大兴山下，黄巾军如蚁附膻，黑压一片，军容不整却声势浩大。贼将程远志出马，头裹黄巾，身披铁铠，手持铁朔，厉声喝骂。你一拍马背，如黑旋风般冲出阵前，手中丈八蛇矛直指敌将，声若巨雷：“环眼贼在此！谁敢与我决一死战！”程远志见你单枪匹马，狞笑一声，催'
2025-09-25 22:31:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 351
2025-09-25 22:31:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:31:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:31:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:31:32 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:31:32 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=48 parent=46 choice='请为先锋，阵前斗将，直取程远志首级。' depth=2
2025-09-25 22:31:32 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 乘胜追击，立即挥师驰援青州，解邓茂之围。
2025-09-25 22:31:32 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC619D0D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC61A3250>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "第一章：桃园非昨，血誓今朝\n\n幽州涿郡，三月的天气乍暖还寒，但张家庄园后的那片桃林却已是烂漫如火，灼灼其华。你，或者说，现在的你——张飞，正跪在这片嫣红的花雨中。空气里弥漫着桃花的甜香、劣酒的辛辣和牛马祭品的血腥气。身旁，是面如冠玉、双耳垂肩的刘备，以及那位凤眼蚕眉、面若重枣的关羽。你听着自己那粗犷的嗓音与他们一同念出誓词：“不求同年同月同日生，但求同年同月同日死！”这誓言如雷，震得桃花簌簌而落，也震得你灵魂深处的记忆翻涌不休。你知道这滚烫的誓言背后，是关羽的败走麦城，是刘备的白帝城托孤，也是你自己，在伐吴前夕被帐下小人刺杀的屈辱结局。黄巾之乱的烽火已在不远处燃起，这是你们兄弟三人扬名立万的起点，却也通向那早已注定的悲剧。此刻，酒碗已空，誓言已立，大哥刘备正望着你们，目光灼灼，等待着你这位“三弟”的下一步行动。"}, {"role": "assistant", "content": "第二章：初入军旅，锋芒乍现\n\n你的提议正合刘备与关羽之心。三人变卖家产，招募了五百乡勇，随即投奔校尉邹靖。军营之中，官兵往来，旌旗杂乱，一股肃杀之气混杂着马粪与汗水的味道扑面而来。邹靖见你们仪表不凡，又带来一支人马，颇为欣喜，将你们编入前部。然而，营中多是官宦子弟与老兵油子，他们看着你们这群“庄稼汉”，眼神里满是轻蔑与不屑。很快，战报传来，黄巾将领程远志率五万大军进犯涿郡。邹靖召集众将议事，面有忧色，帐内气氛凝重。此时，刘备上前一步，沉声道：“备愿领麾下五百义军，前去破敌！”邹靖闻言，既惊又疑，目光扫过你们三人，最终落在了你的丈八蛇矛上。他需要有人去挫敌锐气，但又不想折损自己的嫡系。这，既是你们的机会，也是一场豪赌。"}, {"role": "user", "content": "我选择了：依史而行，提议投奔校尉邹靖，参与镇压黄巾军的官方行动。"}, {"role": "assistant", "content": "第三章：长坂坡前，丈八蛇矛\n\n“好！三弟既有此胆魄，我等便做你的后盾！”刘备眼中精光一闪，向邹靖力荐。邹靖半信半疑，允你为先锋。大兴山下，黄巾军如蚁附膻，黑压一片，军容不整却声势浩大。贼将程远志出马，头裹黄巾，身披铁铠，手持铁朔，厉声喝骂。你一拍马背，如黑旋风般冲出阵前，手中丈八蛇矛直指敌将，声若巨雷：“环眼贼在此！谁敢与我决一死战！”程远志见你单枪匹马，狞笑一声，催马迎战。双马交错，寒光一闪，他手中的铁朔尚未举起，你的蛇矛已如毒龙出洞，瞬间贯穿其咽喉！程远志双目圆睁，满脸的不可置信，轰然坠马。黄巾军见主帅阵前被斩，顿时大乱，士气崩溃。刘备与关羽趁势率军掩杀，五百乡勇气势如虹，杀得贼寇丢盔弃甲，血流成河。首战大捷，你威名初显，但捷报刚至，便有探子来报：黄巾另一将领邓茂正率军围攻青州，形势危急。"}, {"role": "user", "content": "我选择了：请为先锋，阵前斗将，直取程远志首级。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“乘胜追击，立即挥师驰援青州，解邓茂之围。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:31:41 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 张飞
2025-09-25 22:31:41 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '张飞'
2025-09-25 22:31:41 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000028BC61863D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000028BC6190650>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：张飞\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n【关键锚点事件（按需引用）】\n- 寻找该人物或时代的经典事件\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 9 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:32:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:32:03 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 22:32:04 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 22:32:04 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:32:04 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 22:32:04 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 22:32:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:32:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:32:04 | INFO     | core.speculation:__init__:28 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 22:32:04 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 22:32:04 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 22:32:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:32:05 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 22:32:05 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 22:32:05 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 22:32:05 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:32:05 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 22:32:19 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000002607266FF50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072651450>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一名顶级的沉浸式关卡设计师。请根据用户的重生愿望与历史设定，生成第一关的结构化元信息。\n\n【背景设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n请严格遵守以下要求：\n1. 生成一个简洁有力且符合愿望主题的【关卡标题】（不超过20字）。\n2. 生成【关卡背景设定】（120-180字），融合时代氛围、主要人物关系、冲突前景。\n3. 生成清晰可执行的【主线任务】（1句话，不超过30字），明确玩家第一关的核心目标。\n\n用户重生愿望：\"刘备\"\n\n请严格输出以下 JSON 格式，且：\n- 不要输出任何多余文字（包括解释、前后缀、自然语言）；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）；\n- 仅输出纯 JSON 字符串：\n{\n  \"level_title\": \"标题\",\n  \"background\": \"背景设定\",\n  \"main_quest\": \"主线任务\"\n}\n"}]}'
2025-09-25 22:32:38 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1599
2025-09-25 22:32:56 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 刘备
2025-09-25 22:32:56 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-25 22:32:56 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072652F50>' -H 'OpenAI-Project: <openai.Omit object at 0x000002607291EC90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "user", "content": "\n你是一位富有想象力且尊重史实的史诗叙事大师。你的任务是根据用户的重生愿望，开启一段漫长而跌宕的重生冒险。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n【关键锚点事件（按需引用）】\n- 寻找该人物或时代的经典事件\n\n故事要求：\n1. 第一章必须包含场景描绘、主角初始状态、迫在眉睫的矛盾或机会。\n2. 文字需生动、具备画面感，长度控制在 220-320 字之间。\n3. 结合历史锚点，引导剧情朝着真实历史或合理虚构方向发展，不能立即结束故事。\n4. 你必须在结尾给出 **3 个** 明确且彼此差异化的行动选项。\n5. 每个选项附带剧情走向概要、对主线成功率的增减值（-20 至 +20），以及风险等级（low / medium / high）。\n6. 故事总章节数目标至少 9 章，禁止在第 1 章结束故事。\n\n请严格按照以下 JSON 格式输出你的回答，并遵守：\n- 仅输出纯 JSON 字符串，不要包含任何多余文字；\n- 不要使用 Markdown 代码块或围栏（例如 ``` 或 ```json）：\n{\n  \"text\": \"这里是你生成的故事文本...\",\n  \"success_rate\": 72,\n  \"choices\": [\n    {\n      \"option\": \"选项A\",\n      \"summary\": \"该选择立即引发的剧情发展\",\n      \"success_rate_delta\": 10,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"政治\", \"谋略\"]\n    },\n    {\n      \"option\": \"选项B\",\n      \"summary\": \"另一条可能的剧情线路\",\n      \"success_rate_delta\": -5,\n      \"risk_level\": \"high\",\n      \"tags\": [\"战斗\", \"冒险\"]\n    },\n    {\n      \"option\": \"选项C\",\n      \"summary\": \"第三条路线的概述\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"外交\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:33:16 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1997
2025-09-25 22:33:16 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1041 预览='{\n  "text": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，'
2025-09-25 22:33:16 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1041 预览='{\n  "text": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。'
2025-09-25 22:33:16 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1041 预览='{\n  "text": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。'
2025-09-25 22:33:16 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1041 预览='{\n  "text": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂'
2025-09-25 22:33:16 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 306
2025-09-25 22:33:16 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:33:16 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:33:16 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:33:16 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/cyberpunk_city.jpg
2025-09-25 22:33:16 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 22:33:16 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 22:33:16 | DEBUG    | core.speculation:enqueue:55 - [Speculation] enqueue session=37 node=49 depth=3
2025-09-25 22:33:16 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 桃园结义，响应官府
2025-09-25 22:33:16 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072CFE690>' -H 'OpenAI-Project: <openai.Omit object at 0x000002607292AD50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 2 章\n当前主线成功率：50%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“桃园结义，响应官府”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:35:12 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2833
2025-09-25 22:35:12 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=925 预览='{\n  "text": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。",\n  "success_rate": 60,\n  "choices": [\n    {\n      "option": "主动请缨，奇袭敌军前锋。",\n      "'
2025-09-25 22:35:12 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=925 预览='{\n  "text": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震'
2025-09-25 22:35:12 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=925 预览='{\n  "text": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震'
2025-09-25 22:35:12 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=925 预览='{\n  "text": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万'
2025-09-25 22:35:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 202
2025-09-25 22:35:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:35:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:35:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:35:12 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:35:12 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=50 parent=49 choice='桃园结义，响应官府' depth=3
2025-09-25 22:35:12 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 主动请缨，奇袭敌军前锋。
2025-09-25 22:35:12 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D5CE90>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072CF7E90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：60%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“主动请缨，奇袭敌军前锋。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:35:34 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3028
2025-09-25 22:35:34 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=956 预览='{\n  "text": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中。山风呼啸，林中光影斑驳，前方不远处便是黄巾军的营地，人声鼎沸，火光冲天。敌军先锋邓茂正耀武扬威，浑然不知死神已近。这是决定命运的时刻，你的战术将直接决定此战的生死成败。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "op'
2025-09-25 22:35:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=956 预览='{\n  "text": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中'
2025-09-25 22:35:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=956 预览='{\n  "text": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中'
2025-09-25 22:35:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=956 预览='{\n  "text": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中。山风呼啸，林中光影斑驳，前方不远处便是黄巾军的营地，人声鼎沸，火光冲天。敌军先'
2025-09-25 22:35:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 232
2025-09-25 22:35:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:35:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:35:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:35:34 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:35:34 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=51 parent=50 choice='主动请缨，奇袭敌军前锋。' depth=2
2025-09-25 22:35:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 令关张各率一部，埋伏于山道两侧，我自引兵诱敌深入。
2025-09-25 22:35:34 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D71850>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D72410>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中。山风呼啸，林中光影斑驳，前方不远处便是黄巾军的营地，人声鼎沸，火光冲天。敌军先锋邓茂正耀武扬威，浑然不知死神已近。这是决定命运的时刻，你的战术将直接决定此战的生死成败。"}, {"role": "user", "content": "我选择了：主动请缨，奇袭敌军前锋。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“令关张各率一部，埋伏于山道两侧，我自引兵诱敌深入。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:36:02 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3558
2025-09-25 22:36:02 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=999 预览='{\n  "text": "你一声令下，自引数十骑兵，虚张声势，直冲敌阵。黄巾前锋邓茂见你兵少，果然大怒，拍马舞刀，率军追来。你佯装不敌，且战且退，将其引入山谷隘口。眼看追兵已入埋伏，你猛地勒马回身，举起双股剑，高喝：“贼寇休走！” 话音未落，山道两侧铜锣齐鸣，鼓声大作！左有云长青龙偃月，右有翼德丈八蛇矛，如天神下凡，率领伏兵骤然杀出！黄巾军顿时阵脚大乱，人马自相践踏。邓茂心胆俱裂，来不及反应，便被关羽一刀斩于马下。先锋军群龙无首，顷刻间土崩瓦解，或降或逃。一场酣畅淋漓的大胜，让你在官军与乡勇中的声望大振，但程远志的五万主力仍在不远处虎视眈眈，真正的考验尚未结束。",\n  "success_ra'
2025-09-25 22:36:02 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=999 预览='{\n  "text": "你一声令下，自引数十骑兵，虚张声势，直冲敌阵。黄巾前锋邓茂见你兵少，果然大怒，拍马舞刀，率军追来。你佯装不敌，且战且退，将其引入山谷隘口。眼看追兵已入埋伏，你猛地勒马回身，举起双股剑，高喝：“贼寇休走！” 话音未落，山道两侧铜锣齐鸣，鼓声大作！左有云长青龙偃月，右有翼德丈八蛇矛，如天神下凡，率'
2025-09-25 22:36:02 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=999 预览='{\n  "text": "你一声令下，自引数十骑兵，虚张声势，直冲敌阵。黄巾前锋邓茂见你兵少，果然大怒，拍马舞刀，率军追来。你佯装不敌，且战且退，将其引入山谷隘口。眼看追兵已入埋伏，你猛地勒马回身，举起双股剑，高喝：“贼寇休走！” 话音未落，山道两侧铜锣齐鸣，鼓声大作！左有云长青龙偃月，右有翼德丈八蛇矛，如天神下凡，率'
2025-09-25 22:36:02 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=999 预览='{\n  "text": "你一声令下，自引数十骑兵，虚张声势，直冲敌阵。黄巾前锋邓茂见你兵少，果然大怒，拍马舞刀，率军追来。你佯装不敌，且战且退，将其引入山谷隘口。眼看追兵已入埋伏，你猛地勒马回身，举起双股剑，高喝：“贼寇休走！” 话音未落，山道两侧铜锣齐鸣，鼓声大作！左有云长青龙偃月，右有翼德丈八蛇矛，如天神下凡，率领伏兵骤然杀出！黄巾军顿时阵脚大乱，人马自相践踏。邓茂心胆俱裂，来不及反应，便被'
2025-09-25 22:36:02 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 271
2025-09-25 22:36:02 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:36:02 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:36:02 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:36:02 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:36:02 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=52 parent=51 choice='令关张各率一部，埋伏于山道两侧，我自引兵诱敌深入。' depth=1
2025-09-25 22:36:02 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 我为中军，云长翼左，翼德翼右，借林木掩护，直冲敌阵！
2025-09-25 22:36:02 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D674D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D727D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中。山风呼啸，林中光影斑驳，前方不远处便是黄巾军的营地，人声鼎沸，火光冲天。敌军先锋邓茂正耀武扬威，浑然不知死神已近。这是决定命运的时刻，你的战术将直接决定此战的生死成败。"}, {"role": "user", "content": "我选择了：主动请缨，奇袭敌军前锋。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“我为中军，云长翼左，翼德翼右，借林木掩护，直冲敌阵！”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:36:25 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3427
2025-09-25 22:36:25 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=964 预览='{\n  "text": "“诺！”关张二人轰然应喏。你一声令下，三百乡勇如猛虎下山，随着你从密林中骤然杀出！你居中策马，双股剑开路；左翼关羽青龙偃月刀寒光凛冽，所过之处血肉横飞；右翼张飞丈八蛇矛怒吼如雷，直捣黄龙。黄巾军阵脚大乱，先锋邓茂未及反应，便被关羽一刀斩于马下，贼众更是胆寒。初战告捷，乡勇士气大振！然而，未等你扩大战果，敌军后方大旗一动，主将程远志已然发现此处的变故，亲率数千精锐如潮水般反扑而来，瞬间便将你这三百人围在垓心。初胜的喜悦被四面楚歌的危机感所替代，敌众我寡，形势急转直下。",\n  "success_rate": 68,\n  "choices": [\n    {\n      '
2025-09-25 22:36:25 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=964 预览='{\n  "text": "“诺！”关张二人轰然应喏。你一声令下，三百乡勇如猛虎下山，随着你从密林中骤然杀出！你居中策马，双股剑开路；左翼关羽青龙偃月刀寒光凛冽，所过之处血肉横飞；右翼张飞丈八蛇矛怒吼如雷，直捣黄龙。黄巾军阵脚大乱，先锋邓茂未及反应，便被关羽一刀斩于马下，贼众更是胆寒。初战告捷，乡勇士气大振！然而，未等你'
2025-09-25 22:36:25 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=964 预览='{\n  "text": "“诺！”关张二人轰然应喏。你一声令下，三百乡勇如猛虎下山，随着你从密林中骤然杀出！你居中策马，双股剑开路；左翼关羽青龙偃月刀寒光凛冽，所过之处血肉横飞；右翼张飞丈八蛇矛怒吼如雷，直捣黄龙。黄巾军阵脚大乱，先锋邓茂未及反应，便被关羽一刀斩于马下，贼众更是胆寒。初战告捷，乡勇士气大振！然而，未等你'
2025-09-25 22:36:25 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=964 预览='{\n  "text": "“诺！”关张二人轰然应喏。你一声令下，三百乡勇如猛虎下山，随着你从密林中骤然杀出！你居中策马，双股剑开路；左翼关羽青龙偃月刀寒光凛冽，所过之处血肉横飞；右翼张飞丈八蛇矛怒吼如雷，直捣黄龙。黄巾军阵脚大乱，先锋邓茂未及反应，便被关羽一刀斩于马下，贼众更是胆寒。初战告捷，乡勇士气大振！然而，未等你扩大战果，敌军后方大旗一动，主将程远志已然发现此处的变故，亲率数千精锐如潮水般反'
2025-09-25 22:36:25 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 235
2025-09-25 22:36:25 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:36:25 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:36:25 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:36:25 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:36:25 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=53 parent=51 choice='我为中军，云长翼左，翼德翼右，借林木掩护，直冲敌阵！' depth=1
2025-09-25 22:36:25 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 敌众我寡，不可硬拼。先探明敌将程远志所在，再行斩首之策。
2025-09-25 22:36:25 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000002607292A5D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072CEBBD0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "“将军稍待，” 你向邹靖拱手，“贼人远来疲惫，初至大兴山下，立足未稳。备愿引本部人马，借山势掩护，绕至其后，出其不意，攻其不备。若能一战挫其锐气，则涿郡之围可解。” 邹靖见你气度不凡，身后关张二人更是威猛，略一思忖便点头应允。你立刻率领三百乡勇，悄然出城，如一柄无声的利刃，潜入大兴山的密林之中。山风呼啸，林中光影斑驳，前方不远处便是黄巾军的营地，人声鼎沸，火光冲天。敌军先锋邓茂正耀武扬威，浑然不知死神已近。这是决定命运的时刻，你的战术将直接决定此战的生死成败。"}, {"role": "user", "content": "我选择了：主动请缨，奇袭敌军前锋。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“敌众我寡，不可硬拼。先探明敌将程远志所在，再行斩首之策。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:37:21 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3451
2025-09-25 22:37:21 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1034 预览='{\n  "text": "“军师之策，正合我意。” 你压低声音，对身后的关张二人说道，“蛇无头不行，鸟无翅不飞。程远志一死，贼众必乱。” 你按住性子急躁的张飞，示意众人隐蔽。夜色渐深，黄巾军的营地灯火通明，如同匍匐在大地上的火龙。营中巡逻队往来不绝，岗哨林立，要在这数万人的大营中找出程远志的帅帐，无异于大海捞针。远处，一队黄巾兵正押着几名乡夫砍伐树木，用作栅栏。乡夫们衣衫褴褛，神情麻木，稍有怠慢便是一顿鞭打。张飞看得怒火中烧，握紧了丈八蛇矛，关节咔咔作响。关羽则凝神观察着营地中几座明显比其他营帐更为华丽、守卫也更森严的大帐，若有所思。时间紧迫，邹靖的主力仍在城中等待消息，你的决断将决定奇袭的成'
2025-09-25 22:37:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1034 预览='{\n  "text": "“军师之策，正合我意。” 你压低声音，对身后的关张二人说道，“蛇无头不行，鸟无翅不飞。程远志一死，贼众必乱。” 你按住性子急躁的张飞，示意众人隐蔽。夜色渐深，黄巾军的营地灯火通明，如同匍匐在大地上的火龙。营中巡逻队往来不绝，岗哨林立，要在这数万人的大营中找出程远志的帅帐，无异于大海捞针。远处，'
2025-09-25 22:37:21 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1034 预览='{\n  "text": "“军师之策，正合我意。” 你压低声音，对身后的关张二人说道，“蛇无头不行，鸟无翅不飞。程远志一死，贼众必乱。” 你按住性子急躁的张飞，示意众人隐蔽。夜色渐深，黄巾军的营地灯火通明，如同匍匐在大地上的火龙。营中巡逻队往来不绝，岗哨林立，要在这数万人的大营中找出程远志的帅帐，无异于大海捞针。远处，'
2025-09-25 22:37:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1034 预览='{\n  "text": "“军师之策，正合我意。” 你压低声音，对身后的关张二人说道，“蛇无头不行，鸟无翅不飞。程远志一死，贼众必乱。” 你按住性子急躁的张飞，示意众人隐蔽。夜色渐深，黄巾军的营地灯火通明，如同匍匐在大地上的火龙。营中巡逻队往来不绝，岗哨林立，要在这数万人的大营中找出程远志的帅帐，无异于大海捞针。远处，一队黄巾兵正押着几名乡夫砍伐树木，用作栅栏。乡夫们衣衫褴褛，神情麻木，稍有怠慢便'
2025-09-25 22:37:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 289
2025-09-25 22:37:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:37:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 22:37:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 22:37:21 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:37:21 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=54 parent=51 choice='敌众我寡，不可硬拼。先探明敌将程远志所在，再行斩首之策。' depth=1
2025-09-25 22:37:21 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 向邹靖献策，于山林狭道设下埋伏。
2025-09-25 22:37:21 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072919B50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072CFED90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：60%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“向邹靖献策，于山林狭道设下埋伏。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:37:42 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2773
2025-09-25 22:37:42 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1071 预览='{\n  "text": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推下滚木擂石，弓箭齐发。贼众顿时人仰马翻，阵脚大乱。关羽舞动青龙偃月刀，如猛虎下山，直取敌将程远志，只一合便将其斩于马下。张飞挺起丈八蛇矛，吼声如雷，冲入敌阵，所到之处，无人能挡。黄巾军失了主帅，四散奔逃。然而，副将邓茂却颇有几分悍勇，他收拢了数千残兵，在远处重新结阵，与你军遥遥对'
2025-09-25 22:37:42 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1071 预览='{\n  "text": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推'
2025-09-25 22:37:42 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1071 预览='{\n  "text": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推'
2025-09-25 22:37:42 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1071 预览='{\n  "text": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推下滚木擂石，弓箭齐发。贼众顿时人仰马翻，阵脚大乱。关羽舞动青龙偃月刀，如猛虎下山'
2025-09-25 22:37:42 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 313
2025-09-25 22:37:42 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:37:42 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 22:37:42 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 22:37:42 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:37:42 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=55 parent=50 choice='向邹靖献策，于山林狭道设下埋伏。' depth=2
2025-09-25 22:37:42 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 命令全军乘胜追击，务求全歼邓茂残部。
2025-09-25 22:37:42 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D72210>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D73590>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推下滚木擂石，弓箭齐发。贼众顿时人仰马翻，阵脚大乱。关羽舞动青龙偃月刀，如猛虎下山，直取敌将程远志，只一合便将其斩于马下。张飞挺起丈八蛇矛，吼声如雷，冲入敌阵，所到之处，无人能挡。黄巾军失了主帅，四散奔逃。然而，副将邓茂却颇有几分悍勇，他收拢了数千残兵，在远处重新结阵，与你军遥遥对峙，显然不甘就此败退。初战告捷，但危机并未完全解除。"}, {"role": "user", "content": "我选择了：向邹靖献策，于山林狭道设下埋伏。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“命令全军乘胜追击，务求全歼邓茂残部。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:38:09 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2909
2025-09-25 22:38:09 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=999 预览='{\n  "text": "你一声令下，三百乡勇气势如虹，随你与关张二人掩杀过去。邓茂残部本已是惊弓之鸟，被你一冲，更是溃不成军，丢盔弃甲，沿路奔逃。你军紧追不舍，斩获颇丰。然而，邓茂亦是悍勇之辈，见逃脱无望，竟在前方一处小山坡上收拢了数百死忠，据高而守。他们背靠山石，手持兵刃，目露凶光，摆出了一副困兽犹斗的架势。你的乡勇追击已久，气力有所不济，且对方占据地利，强攻恐伤亡惨重。天色渐晚，山风渐起，吹动着黄巾军的残破旗帜，也吹凉了初胜的热血。一场速决战，已然演变成了棘手的攻坚。三百人对数百人，一场硬仗迫在眉睫。",\n  "success_rate": 65,\n  "choices": [\n    '
2025-09-25 22:38:09 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=999 预览='{\n  "text": "你一声令下，三百乡勇气势如虹，随你与关张二人掩杀过去。邓茂残部本已是惊弓之鸟，被你一冲，更是溃不成军，丢盔弃甲，沿路奔逃。你军紧追不舍，斩获颇丰。然而，邓茂亦是悍勇之辈，见逃脱无望，竟在前方一处小山坡上收拢了数百死忠，据高而守。他们背靠山石，手持兵刃，目露凶光，摆出了一副困兽犹斗的架势。你的乡'
2025-09-25 22:38:09 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=999 预览='{\n  "text": "你一声令下，三百乡勇气势如虹，随你与关张二人掩杀过去。邓茂残部本已是惊弓之鸟，被你一冲，更是溃不成军，丢盔弃甲，沿路奔逃。你军紧追不舍，斩获颇丰。然而，邓茂亦是悍勇之辈，见逃脱无望，竟在前方一处小山坡上收拢了数百死忠，据高而守。他们背靠山石，手持兵刃，目露凶光，摆出了一副困兽犹斗的架势。你的乡'
2025-09-25 22:38:09 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=999 预览='{\n  "text": "你一声令下，三百乡勇气势如虹，随你与关张二人掩杀过去。邓茂残部本已是惊弓之鸟，被你一冲，更是溃不成军，丢盔弃甲，沿路奔逃。你军紧追不舍，斩获颇丰。然而，邓茂亦是悍勇之辈，见逃脱无望，竟在前方一处小山坡上收拢了数百死忠，据高而守。他们背靠山石，手持兵刃，目露凶光，摆出了一副困兽犹斗的架势。你的乡勇追击已久，气力有所不济，且对方占据地利，强攻恐伤亡惨重。天色渐晚，山风渐起，吹'
2025-09-25 22:38:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 243
2025-09-25 22:38:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:38:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:38:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:38:09 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:38:09 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=56 parent=55 choice='命令全军乘胜追击，务求全歼邓茂残部。' depth=1
2025-09-25 22:38:09 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 稳固阵线，打扫战场，收拢俘虏与战果，暂不追击。
2025-09-25 22:38:09 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072CDC8D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D76910>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推下滚木擂石，弓箭齐发。贼众顿时人仰马翻，阵脚大乱。关羽舞动青龙偃月刀，如猛虎下山，直取敌将程远志，只一合便将其斩于马下。张飞挺起丈八蛇矛，吼声如雷，冲入敌阵，所到之处，无人能挡。黄巾军失了主帅，四散奔逃。然而，副将邓茂却颇有几分悍勇，他收拢了数千残兵，在远处重新结阵，与你军遥遥对峙，显然不甘就此败退。初战告捷，但危机并未完全解除。"}, {"role": "user", "content": "我选择了：向邹靖献策，于山林狭道设下埋伏。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“稳固阵线，打扫战场，收拢俘虏与战果，暂不追击。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:38:33 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3188
2025-09-25 22:38:33 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1082 预览='{\n  "text": "你的命令被迅速执行。乡勇们打扫战场，收敛兵甲，并将数百名惊魂未定的黄巾降卒看押起来。你深知穷寇莫追的道理，邓茂虽败，但困兽犹斗，贸然追击恐遭不测。不久，校尉邹靖率主力赶到，见黄巾军尸横遍野，程远志首级高悬，不禁对你刮目相看，连声称赞。然而，喜悦是短暂的。审问俘虏后，你得到了一个惊人消息：此次进犯涿郡的只是黄巾军的偏师，其主力正由张角之弟张宝、张梁率领，攻打青州。更危急的是，另一支黄巾精锐正绕道直扑幽州治所，意图围困州牧刘焉！军情如火，邹靖脸色凝重，他虽是此地主将，却也一时没了主意。他看向你，这位初阵便立下奇功的织席客，目光中带着探寻与倚重：“玄德，依你之见，我军当如何'
2025-09-25 22:38:33 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1082 预览='{\n  "text": "你的命令被迅速执行。乡勇们打扫战场，收敛兵甲，并将数百名惊魂未定的黄巾降卒看押起来。你深知穷寇莫追的道理，邓茂虽败，但困兽犹斗，贸然追击恐遭不测。不久，校尉邹靖率主力赶到，见黄巾军尸横遍野，程远志首级高悬，不禁对你刮目相看，连声称赞。然而，喜悦是短暂的。审问俘虏后，你得到了一个惊人消息：此次进'
2025-09-25 22:38:33 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1082 预览='{\n  "text": "你的命令被迅速执行。乡勇们打扫战场，收敛兵甲，并将数百名惊魂未定的黄巾降卒看押起来。你深知穷寇莫追的道理，邓茂虽败，但困兽犹斗，贸然追击恐遭不测。不久，校尉邹靖率主力赶到，见黄巾军尸横遍野，程远志首级高悬，不禁对你刮目相看，连声称赞。然而，喜悦是短暂的。审问俘虏后，你得到了一个惊人消息：此次进'
2025-09-25 22:38:33 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1082 预览='{\n  "text": "你的命令被迅速执行。乡勇们打扫战场，收敛兵甲，并将数百名惊魂未定的黄巾降卒看押起来。你深知穷寇莫追的道理，邓茂虽败，但困兽犹斗，贸然追击恐遭不测。不久，校尉邹靖率主力赶到，见黄巾军尸横遍野，程远志首级高悬，不禁对你刮目相看，连声称赞。然而，喜悦是短暂的。审问俘虏后，你得到了一个惊人消息：此次进犯涿郡的只是黄巾军的偏师，其主力正由张角之弟张宝、张梁率领，攻打青州。更危急的是'
2025-09-25 22:38:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 291
2025-09-25 22:38:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:38:33 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:38:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:38:33 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:38:33 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=57 parent=55 choice='稳固阵线，打扫战场，收拢俘虏与战果，暂不追击。' depth=1
2025-09-25 22:38:33 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 派关羽、张飞率精锐从侧翼袭扰，主力正面缓进，以最小代价迫使敌军后撤。
2025-09-25 22:38:33 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D67450>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D67410>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "你向邹靖进言：“贼众我寡，明攻不利。大兴山下林木繁多，道路狭窄，可伏兵于此，待敌军半渡，出奇兵击之，必可大胜。”邹靖虽疑你一介白身，但见你言辞恳切，关张二人气度不凡，便允你率本部乡勇先行。你三人遂引兵埋伏于山谷两侧。不久，黄巾军果然大摇大摆进入伏击圈。你见时机已到，一声令下，鼓声大作，乡勇们推下滚木擂石，弓箭齐发。贼众顿时人仰马翻，阵脚大乱。关羽舞动青龙偃月刀，如猛虎下山，直取敌将程远志，只一合便将其斩于马下。张飞挺起丈八蛇矛，吼声如雷，冲入敌阵，所到之处，无人能挡。黄巾军失了主帅，四散奔逃。然而，副将邓茂却颇有几分悍勇，他收拢了数千残兵，在远处重新结阵，与你军遥遥对峙，显然不甘就此败退。初战告捷，但危机并未完全解除。"}, {"role": "user", "content": "我选择了：向邹靖献策，于山林狭道设下埋伏。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“派关羽、张飞率精锐从侧翼袭扰，主力正面缓进，以最小代价迫使敌军后撤。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:38:59 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3473
2025-09-25 22:38:59 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=998 预览='{\n  "text": "你的指令精准而有效。关羽与张飞各引一支精锐，如两柄尖刀从侧翼插入敌阵。邓茂收拢的残兵本就士气低落，侧后方突如其来的喊杀声与猛烈冲击，瞬间击溃了他们最后的心理防线。阵型大乱，兵士各自奔逃。你亲率主力正面缓进，如同一堵不断迫近的墙壁，彻底压垮了敌军的斗志。邓茂见大势已去，不敢恋战，拨马便逃。此役以极小的伤亡，换来了一场酣畅淋漓的完胜。正当你率军追击，意图扩大战果之时，远方烟尘大起，一支装备精良的官军骑兵出现在地平线上，为首一员白马银枪的将军，正是你的旧识，北平太守公孙瓒。他亦是前来讨贼，恰逢其会。“玄德，多年未见，不想你已立下如此功勋！”公孙瓒大笑着与你相见，并顺势掩杀了'
2025-09-25 22:38:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=998 预览='{\n  "text": "你的指令精准而有效。关羽与张飞各引一支精锐，如两柄尖刀从侧翼插入敌阵。邓茂收拢的残兵本就士气低落，侧后方突如其来的喊杀声与猛烈冲击，瞬间击溃了他们最后的心理防线。阵型大乱，兵士各自奔逃。你亲率主力正面缓进，如同一堵不断迫近的墙壁，彻底压垮了敌军的斗志。邓茂见大势已去，不敢恋战，拨马便逃。此役以'
2025-09-25 22:38:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=998 预览='{\n  "text": "你的指令精准而有效。关羽与张飞各引一支精锐，如两柄尖刀从侧翼插入敌阵。邓茂收拢的残兵本就士气低落，侧后方突如其来的喊杀声与猛烈冲击，瞬间击溃了他们最后的心理防线。阵型大乱，兵士各自奔逃。你亲率主力正面缓进，如同一堵不断迫近的墙壁，彻底压垮了敌军的斗志。邓茂见大势已去，不敢恋战，拨马便逃。此役以'
2025-09-25 22:38:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=998 预览='{\n  "text": "你的指令精准而有效。关羽与张飞各引一支精锐，如两柄尖刀从侧翼插入敌阵。邓茂收拢的残兵本就士气低落，侧后方突如其来的喊杀声与猛烈冲击，瞬间击溃了他们最后的心理防线。阵型大乱，兵士各自奔逃。你亲率主力正面缓进，如同一堵不断迫近的墙壁，彻底压垮了敌军的斗志。邓茂见大势已去，不敢恋战，拨马便逃。此役以极小的伤亡，换来了一场酣畅淋漓的完胜。正当你率军追击，意图扩大战果之时，远方烟尘'
2025-09-25 22:38:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 315
2025-09-25 22:38:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:38:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:38:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:38:59 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:38:59 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=58 parent=55 choice='派关羽、张飞率精锐从侧翼袭扰，主力正面缓进，以最小代价迫使敌军后撤。' depth=1
2025-09-25 22:38:59 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 先行侦察，摸清敌军虚实再做定夺。
2025-09-25 22:38:59 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072919B50>' -H 'OpenAI-Project: <openai.Omit object at 0x00000260727AD190>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：60%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“先行侦察，摸清敌军虚实再做定夺。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:39:50 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2870
2025-09-25 22:39:50 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1073 预览='{\n  "text": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在眼里。你心中一动，不仅探得了敌将的狂妄，更发现其营寨西南角依山而建，地势险要，看似牢固，实则若有小股部队从后山攀援而下，便可直捣黄龙。情报到手，夜色渐深，是时候做出下一步的决断了。",\n  "success_rate": 68,\n  "choices": [\n    {\n    '
2025-09-25 22:39:50 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1073 预览='{\n  "text": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在'
2025-09-25 22:39:50 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1073 预览='{\n  "text": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在'
2025-09-25 22:39:50 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1073 预览='{\n  "text": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在眼里。你心中一动，不仅探得了敌将的狂妄，更发现其营寨西南角依山而建，地势险要，看'
2025-09-25 22:39:50 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 237
2025-09-25 22:39:50 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:39:50 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:39:50 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:39:50 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:39:50 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=59 parent=50 choice='先行侦察，摸清敌军虚实再做定夺。' depth=2
2025-09-25 22:39:50 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 趁夜色掩护，亲率精锐奇袭程远志中军大帐，擒贼先擒王。
2025-09-25 22:39:50 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D71310>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DB5A50>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在眼里。你心中一动，不仅探得了敌将的狂妄，更发现其营寨西南角依山而建，地势险要，看似牢固，实则若有小股部队从后山攀援而下，便可直捣黄龙。情报到手，夜色渐深，是时候做出下一步的决断了。"}, {"role": "user", "content": "我选择了：先行侦察，摸清敌军虚实再做定夺。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“趁夜色掩护，亲率精锐奇袭程远志中军大帐，擒贼先擒王。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:40:16 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3579
2025-09-25 22:40:16 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1041 预览='{\n  "text": "你的决断如利箭离弦。你亲选五十名最矫健的乡勇，由关、张二人为先锋，如一把尖刀，借着夜色与山林的掩护，直插敌军心脏。黄巾军果然毫无防备，营中醉倒者十之八九。关羽的青龙偃月刀寒光一闪，便斩断了帐门，张飞的丈八蛇矛如怒龙出洞，直取上座的程远志。那程远志尚在醉梦之中，便已人头落地！其副将邓茂惊怒交加，挥刀来战，却被张飞一矛刺穿。中军帐内血流成河，擒王之计已成大半。然而，帐外的喊杀声却如潮水般涌来，四面八方都是被惊醒的黄巾乱兵。火把将你们的退路照得通明，数万之众已将此地围得水泄不通。你们虽斩了敌首，却也成了瓮中之鳖。邹靖的大军尚在数里之外，远水难救近火。身边的乡勇已开始出现伤亡'
2025-09-25 22:40:16 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1041 预览='{\n  "text": "你的决断如利箭离弦。你亲选五十名最矫健的乡勇，由关、张二人为先锋，如一把尖刀，借着夜色与山林的掩护，直插敌军心脏。黄巾军果然毫无防备，营中醉倒者十之八九。关羽的青龙偃月刀寒光一闪，便斩断了帐门，张飞的丈八蛇矛如怒龙出洞，直取上座的程远志。那程远志尚在醉梦之中，便已人头落地！其副将邓茂惊怒交加，'
2025-09-25 22:40:16 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1041 预览='{\n  "text": "你的决断如利箭离弦。你亲选五十名最矫健的乡勇，由关、张二人为先锋，如一把尖刀，借着夜色与山林的掩护，直插敌军心脏。黄巾军果然毫无防备，营中醉倒者十之八九。关羽的青龙偃月刀寒光一闪，便斩断了帐门，张飞的丈八蛇矛如怒龙出洞，直取上座的程远志。那程远志尚在醉梦之中，便已人头落地！其副将邓茂惊怒交加，'
2025-09-25 22:40:16 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1041 预览='{\n  "text": "你的决断如利箭离弦。你亲选五十名最矫健的乡勇，由关、张二人为先锋，如一把尖刀，借着夜色与山林的掩护，直插敌军心脏。黄巾军果然毫无防备，营中醉倒者十之八九。关羽的青龙偃月刀寒光一闪，便斩断了帐门，张飞的丈八蛇矛如怒龙出洞，直取上座的程远志。那程远志尚在醉梦之中，便已人头落地！其副将邓茂惊怒交加，挥刀来战，却被张飞一矛刺穿。中军帐内血流成河，擒王之计已成大半。然而，帐外的喊杀'
2025-09-25 22:40:16 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 311
2025-09-25 22:40:16 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:40:16 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:40:16 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:40:16 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:40:16 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=60 parent=59 choice='趁夜色掩护，亲率精锐奇袭程远志中军大帐，擒贼先擒王。' depth=1
2025-09-25 22:40:16 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 利用地形设伏，命关张各率一队人马，待敌军进入狭窄山道时，三面夹击，一举击溃其先锋。
2025-09-25 22:40:16 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D71D10>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072CE8990>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在眼里。你心中一动，不仅探得了敌将的狂妄，更发现其营寨西南角依山而建，地势险要，看似牢固，实则若有小股部队从后山攀援而下，便可直捣黄龙。情报到手，夜色渐深，是时候做出下一步的决断了。"}, {"role": "user", "content": "我选择了：先行侦察，摸清敌军虚实再做定夺。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“利用地形设伏，命关张各率一队人马，待敌军进入狭窄山道时，三面夹击，一举击溃其先锋。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:40:41 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3426
2025-09-25 22:40:41 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1082 预览='{\n  "text": "计策已定，你当机立断。你亲率一百弓手于山道正面高处埋伏，令关羽、张飞各引一百刀盾手分从左右两侧山林悄然包抄。时至正午，黄巾军副将邓茂果然率其骄兵悍将，毫无戒备地进入了伏击圈。你眼中寒光一闪，手臂猛然挥下！霎时间，擂石滚木从天而降，箭矢如蝗，瞬间便将敌军阵型撕裂。未等黄巾军反应过来，只听一声“贼将休走！”关羽的青龙偃月刀已如电光石火般掠过，邓茂的头颅冲天而起。另一侧，张飞的丈八蛇矛更是如入无人之境，杀得贼兵鬼哭狼嚎，四散奔逃。先锋军大溃，你初战告捷。但山道尽头，尘土大起，程远志亲率的主力大军已被惊动，正排山倒海般压来。胜利的喜悦转瞬即逝，真正的考验才刚刚开始。",\n  '
2025-09-25 22:40:41 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1082 预览='{\n  "text": "计策已定，你当机立断。你亲率一百弓手于山道正面高处埋伏，令关羽、张飞各引一百刀盾手分从左右两侧山林悄然包抄。时至正午，黄巾军副将邓茂果然率其骄兵悍将，毫无戒备地进入了伏击圈。你眼中寒光一闪，手臂猛然挥下！霎时间，擂石滚木从天而降，箭矢如蝗，瞬间便将敌军阵型撕裂。未等黄巾军反应过来，只听一声“贼'
2025-09-25 22:40:41 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1082 预览='{\n  "text": "计策已定，你当机立断。你亲率一百弓手于山道正面高处埋伏，令关羽、张飞各引一百刀盾手分从左右两侧山林悄然包抄。时至正午，黄巾军副将邓茂果然率其骄兵悍将，毫无戒备地进入了伏击圈。你眼中寒光一闪，手臂猛然挥下！霎时间，擂石滚木从天而降，箭矢如蝗，瞬间便将敌军阵型撕裂。未等黄巾军反应过来，只听一声“贼'
2025-09-25 22:40:41 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1082 预览='{\n  "text": "计策已定，你当机立断。你亲率一百弓手于山道正面高处埋伏，令关羽、张飞各引一百刀盾手分从左右两侧山林悄然包抄。时至正午，黄巾军副将邓茂果然率其骄兵悍将，毫无戒备地进入了伏击圈。你眼中寒光一闪，手臂猛然挥下！霎时间，擂石滚木从天而降，箭矢如蝗，瞬间便将敌军阵型撕裂。未等黄巾军反应过来，只听一声“贼将休走！”关羽的青龙偃月刀已如电光石火般掠过，邓茂的头颅冲天而起。另一侧，张飞的'
2025-09-25 22:40:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 282
2025-09-25 22:40:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:40:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 22:40:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 22:40:41 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:40:41 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=61 parent=59 choice='利用地形设伏，命关张各率一队人马，待敌军进入狭窄山道时，三面夹击，一举击溃其先锋。' depth=1
2025-09-25 22:40:41 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 速回邹靖处，将敌军部署与营地弱点和盘托出，建议其主力部队如何进攻。
2025-09-25 22:40:41 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D46CD0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D23050>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "次日，于张飞庄后桃园，你三人焚香再拜，祭告天地，结为异姓兄弟。你不求同年同月同日生，只愿同年同月同日死。誓毕，聚乡中勇士三百，打造兵器，响应官府号召，投于校尉邹靖麾下。军情紧急，黄巾将领程远志率五万贼众进犯涿郡。邹靖正欲出兵，你三人率乡勇军先行。敌军势大，先锋部队已至大兴山下，旌旗遍野，杀声震天。这是你的初阵，关张二人立于你身后，目光如炬，只待你一声令下。三百乡勇对阵数万大军，一步踏错，便是万劫不复。"}, {"role": "user", "content": "我选择了：桃园结义，响应官府"}, {"role": "assistant", "content": "你采纳了稳健的策略。你与关、张二人换上夜行衣，借着月色与山林的掩护，悄然潜近黄巾军的营寨。大兴山下的敌营连绵数里，火光冲天，人声嘈杂，但细看之下，岗哨稀疏，巡逻的士卒也多有懈怠。你们轻易绕过外围，抵近中军。只听帐内传来狂放的笑声，黄巾将领程远志与其副将邓茂正大摆筵席，痛饮作乐，完全不将官军放在眼里。你心中一动，不仅探得了敌将的狂妄，更发现其营寨西南角依山而建，地势险要，看似牢固，实则若有小股部队从后山攀援而下，便可直捣黄龙。情报到手，夜色渐深，是时候做出下一步的决断了。"}, {"role": "user", "content": "我选择了：先行侦察，摸清敌军虚实再做定夺。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“速回邹靖处，将敌军部署与营地弱点和盘托出，建议其主力部队如何进攻。”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:41:05 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3377
2025-09-25 22:41:05 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1125 预览='{\n  "text": "你星夜兼程，赶回邹靖大营。中军帐内，邹靖听完你的禀报，面露惊疑之色。他本以为黄巾军不过是一群乌合之众，却未料其势如此浩大；更没想到你这名不见经传的义勇，竟有如此胆识，敢于深入敌后。他踱步片刻，指着地图上的大兴山，沉声道：“依你所言，程远志狂妄轻敌，营寨西南确有破绽。但后山险峻，夜间奇袭，风险极大。若被发觉，奇兵将陷入重围，万劫不复。玄德，你虽有洞察，但此计过于凶险，我不能拿全军将士的性命作赌注。” 他的话语中既有赞许也有犹豫，目光锐利地审视着你，似乎在考验你的决心与智慧。帐外风声呼啸，战机稍纵即逝，整个大营的命运，此刻都压在了你的下一个回答之上。",\n  "succe'
2025-09-25 22:41:05 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1125 预览='{\n  "text": "你星夜兼程，赶回邹靖大营。中军帐内，邹靖听完你的禀报，面露惊疑之色。他本以为黄巾军不过是一群乌合之众，却未料其势如此浩大；更没想到你这名不见经传的义勇，竟有如此胆识，敢于深入敌后。他踱步片刻，指着地图上的大兴山，沉声道：“依你所言，程远志狂妄轻敌，营寨西南确有破绽。但后山险峻，夜间奇袭，风险极'
2025-09-25 22:41:05 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1125 预览='{\n  "text": "你星夜兼程，赶回邹靖大营。中军帐内，邹靖听完你的禀报，面露惊疑之色。他本以为黄巾军不过是一群乌合之众，却未料其势如此浩大；更没想到你这名不见经传的义勇，竟有如此胆识，敢于深入敌后。他踱步片刻，指着地图上的大兴山，沉声道：“依你所言，程远志狂妄轻敌，营寨西南确有破绽。但后山险峻，夜间奇袭，风险极'
2025-09-25 22:41:05 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1125 预览='{\n  "text": "你星夜兼程，赶回邹靖大营。中军帐内，邹靖听完你的禀报，面露惊疑之色。他本以为黄巾军不过是一群乌合之众，却未料其势如此浩大；更没想到你这名不见经传的义勇，竟有如此胆识，敢于深入敌后。他踱步片刻，指着地图上的大兴山，沉声道：“依你所言，程远志狂妄轻敌，营寨西南确有破绽。但后山险峻，夜间奇袭，风险极大。若被发觉，奇兵将陷入重围，万劫不复。玄德，你虽有洞察，但此计过于凶险，我不能'
2025-09-25 22:41:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 276
2025-09-25 22:41:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:41:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:41:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:41:05 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:41:05 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=62 parent=59 choice='速回邹靖处，将敌军部署与营地弱点和盘托出，建议其主力部队如何进攻。' depth=1
2025-09-25 22:41:05 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 智取豪强，占山为基
2025-09-25 22:41:05 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x000002607291BC50>' -H 'OpenAI-Project: <openai.Omit object at 0x000002607291AAD0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 2 章\n当前主线成功率：50%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“智取豪强，占山为基”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:41:34 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3089
2025-09-25 22:41:34 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1001 预览='{\n  "text": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验'
2025-09-25 22:41:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1001 预览='{\n  "text": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财'
2025-09-25 22:41:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1001 预览='{\n  "text": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财'
2025-09-25 22:41:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1001 预览='{\n  "text": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“'
2025-09-25 22:41:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 288
2025-09-25 22:41:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:41:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:41:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:41:34 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:41:34 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=63 parent=49 choice='智取豪强，占山为基' depth=3
2025-09-25 22:41:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 主动请降，献上罪证
2025-09-25 22:41:34 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072DD4F10>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DD4D10>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：60%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“主动请降，献上罪证”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:42:33 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3309
2025-09-25 22:42:33 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=953 预览='{\n  "text": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为欣赏。他当即决定，不仅不追究，反而将你这支义军收编，共同讨贼。他也带来了紧急军情：黄巾渠帅程远志正率五万大军进犯涿郡，前锋已至城外大兴山。危机并未解除，而是升级成了真正的战争。",\n  "success_rate": 68,\n  "choices": [\n    {\n      '
2025-09-25 22:42:33 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=953 预览='{\n  "text": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为'
2025-09-25 22:42:33 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=953 预览='{\n  "text": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为'
2025-09-25 22:42:33 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=953 预览='{\n  "text": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为欣赏。他当即决定，不仅不追究，反而将你这支义军收编，共同讨贼。他也带来了紧急军情'
2025-09-25 22:42:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 235
2025-09-25 22:42:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:42:33 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 22:42:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 22:42:33 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:42:33 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=64 parent=63 choice='主动请降，献上罪证' depth=2
2025-09-25 22:42:33 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 请为先锋，直取敌将
2025-09-25 22:42:33 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D77690>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DB6AD0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "assistant", "content": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为欣赏。他当即决定，不仅不追究，反而将你这支义军收编，共同讨贼。他也带来了紧急军情：黄巾渠帅程远志正率五万大军进犯涿郡，前锋已至城外大兴山。危机并未解除，而是升级成了真正的战争。"}, {"role": "user", "content": "我选择了：主动请降，献上罪证"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“请为先锋，直取敌将”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:42:57 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3087
2025-09-25 22:42:57 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=983 预览='{\n  "text": "你的请战正合邹靖之意，他急需一支悍不畏死的部队来挫动黄巾军的锐气。于是，你率领着五百乡勇，迎着漫山遍野的黄巾旗帜，立于大兴山下。敌将程远志傲慢轻敌，只派了副将邓茂领五千兵马前来。黑压压的敌军如潮水般涌来，口中呼喊着“苍天已死，黄天当立”的口号，声势震天。你身旁的张飞早已按捺不住，丈八蛇矛在手中嗡嗡作响；关羽则丹凤眼微眯，抚着长髯，青龙偃月刀的寒光映着他凝重的脸。五百对五千，这是一场实力悬殊的对决。官军主力在后方观望，这一战不仅关乎生死，更关乎你们兄弟三人的声名与未来。你深吸一口气，知道这一战必须打出威风，打出名堂。如何以寡敌众，破敌于阵前，是你作为主帅的首要考量。",'
2025-09-25 22:42:57 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=983 预览='{\n  "text": "你的请战正合邹靖之意，他急需一支悍不畏死的部队来挫动黄巾军的锐气。于是，你率领着五百乡勇，迎着漫山遍野的黄巾旗帜，立于大兴山下。敌将程远志傲慢轻敌，只派了副将邓茂领五千兵马前来。黑压压的敌军如潮水般涌来，口中呼喊着“苍天已死，黄天当立”的口号，声势震天。你身旁的张飞早已按捺不住，丈八蛇矛在手中'
2025-09-25 22:42:57 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=983 预览='{\n  "text": "你的请战正合邹靖之意，他急需一支悍不畏死的部队来挫动黄巾军的锐气。于是，你率领着五百乡勇，迎着漫山遍野的黄巾旗帜，立于大兴山下。敌将程远志傲慢轻敌，只派了副将邓茂领五千兵马前来。黑压压的敌军如潮水般涌来，口中呼喊着“苍天已死，黄天当立”的口号，声势震天。你身旁的张飞早已按捺不住，丈八蛇矛在手中'
2025-09-25 22:42:57 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=983 预览='{\n  "text": "你的请战正合邹靖之意，他急需一支悍不畏死的部队来挫动黄巾军的锐气。于是，你率领着五百乡勇，迎着漫山遍野的黄巾旗帜，立于大兴山下。敌将程远志傲慢轻敌，只派了副将邓茂领五千兵马前来。黑压压的敌军如潮水般涌来，口中呼喊着“苍天已死，黄天当立”的口号，声势震天。你身旁的张飞早已按捺不住，丈八蛇矛在手中嗡嗡作响；关羽则丹凤眼微眯，抚着长髯，青龙偃月刀的寒光映着他凝重的脸。五百对五千'
2025-09-25 22:42:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 285
2025-09-25 22:42:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:42:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:42:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:42:57 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:42:57 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=65 parent=64 choice='请为先锋，直取敌将' depth=1
2025-09-25 22:42:57 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 建议分兵，设伏于山谷
2025-09-25 22:42:57 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D92D50>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072CCF5D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "assistant", "content": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为欣赏。他当即决定，不仅不追究，反而将你这支义军收编，共同讨贼。他也带来了紧急军情：黄巾渠帅程远志正率五万大军进犯涿郡，前锋已至城外大兴山。危机并未解除，而是升级成了真正的战争。"}, {"role": "user", "content": "我选择了：主动请降，献上罪证"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“建议分兵，设伏于山谷”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:43:20 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3380
2025-09-25 22:43:20 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=916 预览='{\n  "text": "你的计策大胆而周密，邹靖虽有些疑虑，但在你详尽的分析下，最终点头应允。他拨给你一千官兵，命你率本部五百人马为先锋，前去诱敌。你则将计就计，将这一千五百人一分为三。你亲率五百人正面迎敌，佯装不敌，将敌军引入山谷；关羽、张飞各率五百精兵，埋伏于山谷两侧的密林之中，只待号令。大兴山下，黄巾军的先锋大将邓茂，正率领着数万兵马，旗帜如林，气焰嚣张。他们久闻官军羸弱，见你区区数百人竟敢出城迎战，更是狂笑不止，催军猛进。一场决定生死的伏击战，即将拉开序幕。你紧握双股剑，手心微汗，成败在此一举。",\n  "success_rate": 75,\n  "choices": [\n    {'
2025-09-25 22:43:20 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=916 预览='{\n  "text": "你的计策大胆而周密，邹靖虽有些疑虑，但在你详尽的分析下，最终点头应允。他拨给你一千官兵，命你率本部五百人马为先锋，前去诱敌。你则将计就计，将这一千五百人一分为三。你亲率五百人正面迎敌，佯装不敌，将敌军引入山谷；关羽、张飞各率五百精兵，埋伏于山谷两侧的密林之中，只待号令。大兴山下，黄巾军的先锋大'
2025-09-25 22:43:20 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=916 预览='{\n  "text": "你的计策大胆而周密，邹靖虽有些疑虑，但在你详尽的分析下，最终点头应允。他拨给你一千官兵，命你率本部五百人马为先锋，前去诱敌。你则将计就计，将这一千五百人一分为三。你亲率五百人正面迎敌，佯装不敌，将敌军引入山谷；关羽、张飞各率五百精兵，埋伏于山谷两侧的密林之中，只待号令。大兴山下，黄巾军的先锋大'
2025-09-25 22:43:20 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=916 预览='{\n  "text": "你的计策大胆而周密，邹靖虽有些疑虑，但在你详尽的分析下，最终点头应允。他拨给你一千官兵，命你率本部五百人马为先锋，前去诱敌。你则将计就计，将这一千五百人一分为三。你亲率五百人正面迎敌，佯装不敌，将敌军引入山谷；关羽、张飞各率五百精兵，埋伏于山谷两侧的密林之中，只待号令。大兴山下，黄巾军的先锋大将邓茂，正率领着数万兵马，旗帜如林，气焰嚣张。他们久闻官军羸弱，见你区区数百人竟'
2025-09-25 22:43:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 242
2025-09-25 22:43:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:43:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 22:43:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 22:43:20 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:43:20 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=66 parent=64 choice='建议分兵，设伏于山谷' depth=1
2025-09-25 22:43:20 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 派人潜入敌营，动摇军心
2025-09-25 22:43:20 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072CED350>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D66DD0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "assistant", "content": "面对压境的官军，张飞怒目圆睁，欲要死战。你却按住他的肩膀，摇了摇头。你深知以卵击石，绝非智举。你选择单人匹马，手捧李虎罪证，迎向邹靖的军阵。邹靖本以为是场硬仗，见你如此，不禁勒马停驻。你呈上密信，不卑不亢地陈述了诛杀李虎乃是为国除害。邹靖审视着你，又看了看信中与黄巾贼的勾结铁证，疑虑渐消，转为欣赏。他当即决定，不仅不追究，反而将你这支义军收编，共同讨贼。他也带来了紧急军情：黄巾渠帅程远志正率五万大军进犯涿郡，前锋已至城外大兴山。危机并未解除，而是升级成了真正的战争。"}, {"role": "user", "content": "我选择了：主动请降，献上罪证"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“派人潜入敌营，动摇军心”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:43:43 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3603
2025-09-25 22:43:43 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1081 预览='{\n  "text": "你的明智之举不仅化解了与官府的冲突，更让你这支乡勇一跃成为讨贼的官军一部，名正言顺。军帐之内，气氛凝重。校尉邹靖面带忧色，指着地图：“贼势浩大，程远志有五万之众，其副将邓茂骁勇，已在大兴山下寨。我军兵力不足，强攻无异于以卵击石。” 帐内诸将皆默然，唯有张飞按捺不住，声如洪钟：“怕他作甚！待我明日出战，直取那程远志首级！” 你伸手拦下翼德，转向邹靖，沉声道：“将军勿忧。贼军虽众，却多是乌合之众，令出多门，利则聚，不利则散。我有一计，或可破之。” 你提议由官军主力在正面摆开阵势，牵制敌军。而你则亲率关、张二弟及五百乡勇，绕至山后，待两军交战正酣，便从后方发动奇袭，直捣黄巾'
2025-09-25 22:43:43 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1081 预览='{\n  "text": "你的明智之举不仅化解了与官府的冲突，更让你这支乡勇一跃成为讨贼的官军一部，名正言顺。军帐之内，气氛凝重。校尉邹靖面带忧色，指着地图：“贼势浩大，程远志有五万之众，其副将邓茂骁勇，已在大兴山下寨。我军兵力不足，强攻无异于以卵击石。” 帐内诸将皆默然，唯有张飞按捺不住，声如洪钟：“怕他作甚！待我明'
2025-09-25 22:43:43 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1081 预览='{\n  "text": "你的明智之举不仅化解了与官府的冲突，更让你这支乡勇一跃成为讨贼的官军一部，名正言顺。军帐之内，气氛凝重。校尉邹靖面带忧色，指着地图：“贼势浩大，程远志有五万之众，其副将邓茂骁勇，已在大兴山下寨。我军兵力不足，强攻无异于以卵击石。” 帐内诸将皆默然，唯有张飞按捺不住，声如洪钟：“怕他作甚！待我明'
2025-09-25 22:43:43 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1081 预览='{\n  "text": "你的明智之举不仅化解了与官府的冲突，更让你这支乡勇一跃成为讨贼的官军一部，名正言顺。军帐之内，气氛凝重。校尉邹靖面带忧色，指着地图：“贼势浩大，程远志有五万之众，其副将邓茂骁勇，已在大兴山下寨。我军兵力不足，强攻无异于以卵击石。” 帐内诸将皆默然，唯有张飞按捺不住，声如洪钟：“怕他作甚！待我明日出战，直取那程远志首级！” 你伸手拦下翼德，转向邹靖，沉声道：“将军勿忧。贼军'
2025-09-25 22:43:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 377
2025-09-25 22:43:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:43:43 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 22:43:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 22:43:43 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:43:43 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=67 parent=64 choice='派人潜入敌营，动摇军心' depth=1
2025-09-25 22:43:43 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 据山而守，力抗官军
2025-09-25 22:43:43 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072DC3FD0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DC3790>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：60%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“据山而守，力抗官军”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:44:09 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3187
2025-09-25 22:44:09 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=951 预览='{\n  "text": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅关乎生死存亡，更决定了这支队伍的未来。是凭借一腔血勇硬撼强敌，还是另寻他法，化解危局？你必须立刻做出决断。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "正面迎敌，死战退敌",\n      "summa'
2025-09-25 22:44:09 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=951 预览='{\n  "text": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅'
2025-09-25 22:44:09 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=951 预览='{\n  "text": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅'
2025-09-25 22:44:09 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=951 预览='{\n  "text": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅关乎生死存亡，更决定了这支队伍的未来。是凭借一腔血勇硬撼强敌，还是另寻他法，化解'
2025-09-25 22:44:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 200
2025-09-25 22:44:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:44:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 22:44:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 22:44:09 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:44:09 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=68 parent=63 choice='据山而守，力抗官军' depth=2
2025-09-25 22:44:09 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 正面迎敌，死战退敌
2025-09-25 22:44:09 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D5D110>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072CFED90>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "assistant", "content": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅关乎生死存亡，更决定了这支队伍的未来。是凭借一腔血勇硬撼强敌，还是另寻他法，化解危局？你必须立刻做出决断。"}, {"role": "user", "content": "我选择了：据山而守，力抗官军"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“正面迎敌，死战退敌”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:44:32 | INFO     | core.llm_clients:generate:151 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3394
2025-09-25 22:44:32 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=974 预览='{\n  "text": "你的决定点燃了乡勇们的血性。“死战不退！”的吼声响彻山谷。邹靖显然没料到这群“乱民”竟有如此胆魄，下令全军强攻。一时间，箭如飞蝗，官兵如蚁附般涌向山寨。张飞立于寨门，丈八蛇矛翻飞，无人能近其身三尺之内；关羽则守住侧翼险道，青龙偃月刀寒光凛冽，每一次挥舞都带走数条性命。你坐镇中央，不断调兵补防，鼓舞士气。然而，官军数量终究占优，轮番冲击之下，乡勇们伤亡渐增，疲态尽显。激战一日，虽暂退官军，但山寨已被围得水泄不通。夜幕降临，山下火把连营，断绝了所有通路。粮草还能支撑三日，军心却已在动摇。困守死地，如何破局？",\n  "success_rate": 68,\n  "choic'
2025-09-25 22:44:32 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=974 预览='{\n  "text": "你的决定点燃了乡勇们的血性。“死战不退！”的吼声响彻山谷。邹靖显然没料到这群“乱民”竟有如此胆魄，下令全军强攻。一时间，箭如飞蝗，官兵如蚁附般涌向山寨。张飞立于寨门，丈八蛇矛翻飞，无人能近其身三尺之内；关羽则守住侧翼险道，青龙偃月刀寒光凛冽，每一次挥舞都带走数条性命。你坐镇中央，不断调兵补防，'
2025-09-25 22:44:32 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=974 预览='{\n  "text": "你的决定点燃了乡勇们的血性。“死战不退！”的吼声响彻山谷。邹靖显然没料到这群“乱民”竟有如此胆魄，下令全军强攻。一时间，箭如飞蝗，官兵如蚁附般涌向山寨。张飞立于寨门，丈八蛇矛翻飞，无人能近其身三尺之内；关羽则守住侧翼险道，青龙偃月刀寒光凛冽，每一次挥舞都带走数条性命。你坐镇中央，不断调兵补防，'
2025-09-25 22:44:32 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=974 预览='{\n  "text": "你的决定点燃了乡勇们的血性。“死战不退！”的吼声响彻山谷。邹靖显然没料到这群“乱民”竟有如此胆魄，下令全军强攻。一时间，箭如飞蝗，官兵如蚁附般涌向山寨。张飞立于寨门，丈八蛇矛翻飞，无人能近其身三尺之内；关羽则守住侧翼险道，青龙偃月刀寒光凛冽，每一次挥舞都带走数条性命。你坐镇中央，不断调兵补防，鼓舞士气。然而，官军数量终究占优，轮番冲击之下，乡勇们伤亡渐增，疲态尽显。激战一'
2025-09-25 22:44:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 254
2025-09-25 22:44:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 22:44:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 22:44:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 22:44:32 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 22:44:32 | DEBUG    | core.speculation:_speculate_recursive:185 - [Speculation] created speculative node=69 parent=68 choice='正面迎敌，死战退敌' depth=1
2025-09-25 22:44:32 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 呈上密信，晓以利害
2025-09-25 22:44:32 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D233D0>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DC6910>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "assistant", "content": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅关乎生死存亡，更决定了这支队伍的未来。是凭借一腔血勇硬撼强敌，还是另寻他法，化解危局？你必须立刻做出决断。"}, {"role": "user", "content": "我选择了：据山而守，力抗官军"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“呈上密信，晓以利害”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:44:34 | WARNING  | core.speculation:_speculate_recursive:167 - [Speculation] generation failed session=37 node=68 choice='呈上密信，晓以利害': Error code: 403 - {'error': {'message': 'token quota is not enough, token remain quota: ＄4.000000, need quota: ＄5.000000 (request id: 20250925224433866326120odTcAysY)', 'type': 'new_api_error', 'param': '', 'code': 'pre_consume_token_quota_failed'}}
2025-09-25 22:44:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 诱敌深入，设伏奇袭
2025-09-25 22:44:34 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D69A90>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072D9A6D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "assistant", "content": "李虎的庄园依山而建，易守难攻，此刻成了你们唯一的屏障。山下，邹靖的千人部队已列开阵势，甲胄鲜明，旗帜招展，肃杀之气扑面而来。张飞手持丈八蛇矛，怒目圆睁，恨不得立刻冲杀下去；关羽则抚着长髯，丹凤眼微眯，审视着敌军的阵型。五百乡勇初经战阵，虽士气高昂，但面对正规官军，难免心生畏惧。你深知，此战不仅关乎生死存亡，更决定了这支队伍的未来。是凭借一腔血勇硬撼强敌，还是另寻他法，化解危局？你必须立刻做出决断。"}, {"role": "user", "content": "我选择了：据山而守，力抗官军"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 4 章\n当前主线成功率：68%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“诱敌深入，设伏奇袭”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:44:35 | WARNING  | core.speculation:_speculate_recursive:167 - [Speculation] generation failed session=37 node=68 choice='诱敌深入，设伏奇袭': Error code: 403 - {'error': {'message': 'token quota is not enough, token remain quota: ＄4.000000, need quota: ＄5.000000 (request id: 202509252244357155837436lTJ3ABW)', 'type': 'new_api_error', 'param': '', 'code': 'pre_consume_token_quota_failed'}}
2025-09-25 22:44:35 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 避其锋芒，暗中转移
2025-09-25 22:44:35 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072DD5F90>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DD7850>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "assistant", "content": "你的提议正合关、张心意。张飞倾尽家财，购置良马，打造兵刃；你则凭借仁德之名，迅速招募了五百乡中子弟。目标，正是城外恶名昭彰的豪强李虎。此人囤积粮草，鱼肉乡里，正是一块完美的踏脚石。夜色如墨，关羽率百人断其后路，张飞如猛虎下山，直冲正门，你则居中调度，安抚庄内家仆。战斗毫无悬念。打开粮仓，金银财帛之外，更有李虎与黄巾贼暗通款曲的密信！你将大部分粮食分发给贫苦乡民，一时间，“刘玄德”的仁义之名传遍涿县。然而，根基未稳，麻烦已至。你们的行动惊动了官府，校尉邹靖亲率一千官兵前来“清剿”。此刻，斥候来报，官军已在十里之外，旌旗蔽日，杀气腾腾。这支初生的队伍，迎来了第一场生死考验。"}, {"role": "user", "content": "我选择了：智取豪强，占山为基"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 3 章\n当前主线成功率：60%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“避其锋芒，暗中转移”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:44:38 | WARNING  | core.speculation:_speculate_recursive:167 - [Speculation] generation failed session=37 node=63 choice='避其锋芒，暗中转移': Error code: 403 - {'error': {'message': 'token quota is not enough, token remain quota: ＄4.000000, need quota: ＄5.000000 (request id: 202509252244377796542399PmCfITw)', 'type': 'new_api_error', 'param': '', 'code': 'pre_consume_token_quota_failed'}}
2025-09-25 22:44:38 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 结交商贾，暗蓄力量
2025-09-25 22:44:38 | CRITICAL | core.llm_clients:generate:111 - [CURL COMMAND] curl --location https://new.wuxuai.com/v1/chat/completions -H 'Accept: */*' -H 'Content-Type: application/json' -H 'User-Agent: PostmanRuntime/7.47.1' -H 'X-Stainless-Lang: python' -H 'X-Stainless-Package-Version: 1.65.5' -H 'X-Stainless-OS: Windows' -H 'X-Stainless-Arch: other:amd64' -H 'X-Stainless-Runtime: CPython' -H 'X-Stainless-Runtime-Version: 3.11.3' -H 'Authorization: Bearer sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE' -H 'Cache-Control: no-cache' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H 'X-Stainless-Async: false' -H 'OpenAI-Organization: <openai.Omit object at 0x0000026072D9BF10>' -H 'OpenAI-Project: <openai.Omit object at 0x0000026072DB36D0>' --data-raw '{"model": "[渠道3]满血gemini-2.5-pro-preview-03-25", "max_tokens": 5000, "temperature": 0.6, "response_format": {"type": "json_object"}, "messages": [{"role": "system", "content": "你是一名严格的JSON生成器。所有回答必须严格为一个JSON对象，且仅输出JSON本体，不得包含任何多余文本、Markdown代码块或前后缀。JSON对象必须包含键 '"'"'text'"'"'（字符串）和 '"'"'choices'"'"'（字符串数组）。当无法继续时，将 '"'"'choices'"'"' 设为 []。"}, {"role": "assistant", "content": "汉室倾颓，黄巾蜂起。你，刘备，此刻正站在涿县尘土飞扬的街头，耳边是流民的哀嚎与官府募兵的锣声。你虽是中山靖王之后，此刻却只是一介织席贩履之夫，空有一腔匡扶社稷的热血。告示榜文前，你一声长叹，身后却传来一声暴喝：“大丈夫不与国家出力，何故长叹？” 你转身，见一人豹头环眼，燕颔虎须，正是屠户张飞。不久，一位推着小车的红脸大汉也被吸引过来，他身长九尺，髯长二尺，面若重枣，唇若涂脂，丹凤眼，卧蚕眉，相貌堂堂，威风凛凛——关羽。三人入市井酒家，相谈甚欢，皆有报国之志。酒过三巡，张飞拍案而起：“我颇有资财，当招募乡勇，与公同举大事，如何？” 这是一个时代的岔路口，你的每一个决定，都将改变这三兄弟，乃至整个天下的命运。"}, {"role": "user", "content": "\n你是一位擅长构建长篇历史冒险的故事大师。请参考历史设定与当前进度，延续玩家的重生旅程。\n\n【历史设定参考】\n角色定位：刘备\n所属时代：历史长河\n人物特质：历史长河中的关键角色\n关键历史锚点：寻找该人物或时代的经典事件\n主要矛盾：如何改变已知的历史节点\n推荐章节总数：至少 9 章\n\n当前章节：第 2 章\n当前主线成功率：50%\n目标总章节数：至少 9 章\n\n请根据“故事历史（消息上下文）”与用户的最新选择“结交商贾，暗蓄力量”继续撰写下一章。\n\n核心任务：\n1. 对玩家选择做出直接回应，推动剧情进入新的阶段。\n2. 引入新的冲突、线索或盟友，为后续章节埋下伏笔。\n3. 文字长度 220-320 字，保持张力与画面感。\n4. 输出 **3 个** 彼此差异化的行动选项，每个选项都要包含剧情后果概要、成功率增减值、风险等级以及相关标签。\n5. 在章节数未达到目标前，禁止让故事结束或输出空的 `choices`。\n\n输出严格遵循以下 JSON 结构：\n{\n  \"text\": \"新的章节文本...\",\n  \"success_rate\": 68,\n  \"choices\": [\n    {\n      \"option\": \"后续选择1\",\n      \"summary\": \"该选择的即时剧情走向\",\n      \"success_rate_delta\": -10,\n      \"risk_level\": \"high\",\n      \"tags\": [\"军事\", \"决断\"]\n    },\n    {\n      \"option\": \"后续选择2\",\n      \"summary\": \"另一条支线的概述\",\n      \"success_rate_delta\": 5,\n      \"risk_level\": \"medium\",\n      \"tags\": [\"外交\", \"谋略\"]\n    },\n    {\n      \"option\": \"后续选择3\",\n      \"summary\": \"第三种可能带来的发展\",\n      \"success_rate_delta\": 0,\n      \"risk_level\": \"low\",\n      \"tags\": [\"情感\", \"同盟\"]\n    }\n  ]\n}\n"}]}'
2025-09-25 22:44:40 | WARNING  | core.speculation:_speculate_recursive:167 - [Speculation] generation failed session=37 node=49 choice='结交商贾，暗蓄力量': Error code: 403 - {'error': {'message': 'token quota is not enough, token remain quota: ＄4.000000, need quota: ＄5.000000 (request id: 20250925224440311568154MMULnDVC)', 'type': 'new_api_error', 'param': '', 'code': 'pre_consume_token_quota_failed'}}
2025-09-25 22:53:59 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 22:54:01 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 22:54:02 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 22:54:02 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:54:02 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 22:54:02 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 22:54:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:54:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:54:03 | INFO     | core.speculation:__init__:28 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 22:54:03 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 22:54:03 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 22:54:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:54:04 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 22:54:04 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 22:54:04 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 22:54:04 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:54:04 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 22:56:04 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 22:56:05 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 22:56:06 | CRITICAL | core.llm_clients:__init__:50 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 22:56:06 | INFO     | core.llm_clients:__init__:53 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:56:06 | INFO     | core.llm_clients:__init__:54 - API地址: https://new.wuxuai.com/v1
2025-09-25 22:56:06 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 22:56:06 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:56:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:56:06 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 22:56:06 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 22:56:06 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 22:56:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:56:07 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 22:56:07 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 22:56:07 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 22:56:07 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:56:07 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 22:57:25 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 22:57:26 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 22:57:27 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 22:57:27 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:57:27 | INFO     | core.llm_clients:__init__:56 - API地址: https://new.wuxuai.com/v1
2025-09-25 22:57:27 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 22:57:27 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:57:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:57:27 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 22:57:27 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 22:57:27 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 22:57:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 22:57:28 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 22:57:28 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 22:57:28 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 22:57:28 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 22:57:28 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 23:04:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:05:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:05:06 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:05:07 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': 'sk-Jq7ZEnSWlIBOAt2yXKXPiP5yx2Bx4l4mqkI5kZ9GzsWIrplE', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:05:07 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:05:07 | INFO     | core.llm_clients:__init__:56 - API地址: https://new.wuxuai.com/v1
2025-09-25 23:05:07 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:05:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:05:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:05:07 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:05:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:05:07 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:05:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:05:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:05:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:05:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:05:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:05:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 23:07:12 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Error code: 403 - {'error': {'message': 'token quota is not enough, token remain quota: ＄4.000000, need quota: ＄5.000000 (request id: 20250925230712276766979pXtl6sAh)', 'type': 'new_api_error', 'param': '', 'code': 'pre_consume_token_quota_failed'}}
2025-09-25 23:14:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:14:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:14:13 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:14:13 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:14:13 | INFO     | core.llm_clients:__init__:56 - API地址: https://new.wuxuai.com/v1
2025-09-25 23:14:13 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:14:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:14:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:14:14 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:14:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:14:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:14:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:14:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:14:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:14:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:14:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:14:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 23:14:14 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:14:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:14:16 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:14:16 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:14:16 | INFO     | core.llm_clients:__init__:56 - API地址: https://new.wuxuai.com/v1
2025-09-25 23:14:16 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:14:16 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:14:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:14:16 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:14:16 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:14:16 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:14:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:14:17 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:14:17 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:14:17 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:14:17 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:14:17 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 23:14:33 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1861
2025-09-25 23:15:36 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 关羽
2025-09-25 23:15:36 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-25 23:16:00 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2515
2025-09-25 23:16:00 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1123 预览='{\n  "text": "建安二十四年，秋。荆州城头的风，裹挟着刺骨的寒意与连绵的雨水，让你不由得握紧了青龙偃月刀的刀柄。江水暴涨，淹没了曹魏的七路大军，于禁授首，庞德被斩，你的威名震动华夏，连曹操都动了迁都的念头。这是你一生荣耀的顶点，然而，烙印在灵魂深处的记忆却发出凄厉的警报——麦城、残兵、白衣渡江……那不该是你的结局！此刻，你不再是那个被胜利冲昏头脑的关羽，而是一个带着未来记忆的重生者。一名亲兵匆匆入帐，脸上带着狂喜与一丝困惑，他呈上两份情报：一份是樊城大捷的详报，另一份，则是来自东吴陆口守将吕蒙的亲笔信。信中，吕蒙言辞恳切，称自己病入膏肓，已向孙权举荐名不见经传的陆逊接替自己。这拙劣的'
2025-09-25 23:16:00 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1123 预览='{\n  "text": "建安二十四年，秋。荆州城头的风，裹挟着刺骨的寒意与连绵的雨水，让你不由得握紧了青龙偃月刀的刀柄。江水暴涨，淹没了曹魏的七路大军，于禁授首，庞德被斩，你的威名震动华夏，连曹操都动了迁都的念头。这是你一生荣耀的顶点，然而，烙印在灵魂深处的记忆却发出凄厉的警报——麦城、残兵、白衣渡江……那不该是你的'
2025-09-25 23:16:00 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1123 预览='{\n  "text": "建安二十四年，秋。荆州城头的风，裹挟着刺骨的寒意与连绵的雨水，让你不由得握紧了青龙偃月刀的刀柄。江水暴涨，淹没了曹魏的七路大军，于禁授首，庞德被斩，你的威名震动华夏，连曹操都动了迁都的念头。这是你一生荣耀的顶点，然而，烙印在灵魂深处的记忆却发出凄厉的警报——麦城、残兵、白衣渡江……那不该是你的'
2025-09-25 23:16:00 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1123 预览='{\n  "text": "建安二十四年，秋。荆州城头的风，裹挟着刺骨的寒意与连绵的雨水，让你不由得握紧了青龙偃月刀的刀柄。江水暴涨，淹没了曹魏的七路大军，于禁授首，庞德被斩，你的威名震动华夏，连曹操都动了迁都的念头。这是你一生荣耀的顶点，然而，烙印在灵魂深处的记忆却发出凄厉的警报——麦城、残兵、白衣渡江……那不该是你的结局！此刻，你不再是那个被胜利冲昏头脑的关羽，而是一个带着未来记忆的重生者。一名'
2025-09-25 23:16:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 342
2025-09-25 23:16:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:16:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:16:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:16:00 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/space_station.jpg
2025-09-25 23:16:00 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 23:16:00 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 23:16:00 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=38 node=70 depth=3
2025-09-25 23:16:00 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 将计就计，引蛇出洞
2025-09-25 23:16:22 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 将计就计，引蛇出洞
2025-09-25 23:16:22 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 将计就计，引蛇出洞
2025-09-25 23:16:27 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3070
2025-09-25 23:16:27 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=952 预览='{\n  "text": "冷笑一声，你将吕蒙的信笺掷入火盆，灰烬随风而散。既然东吴想看一出好戏，你便亲自为他们搭好舞台。你当众下令，抽调部分防备东吴的守军北上，增援樊城前线，做出全力攻曹、后方空虚的假象。此令一出，帐下诸将虽未明言，但脸上忧色尽显。尤其是南郡太守糜芳与将军士仁，他们的防区首当其冲，焦虑与不满几乎写在脸上。你深知，这二人便是那千里之堤上的蚁穴。蛇已诱之，但巢穴未固，任何疏忽都可能导致全盘崩溃。你必须在东吴的利刃抵达前，做出下一步应对。",\n  "success_rate": 65,\n  "choices": [\n    {\n      "option": "密令马良，暗中监察南郡'
2025-09-25 23:16:27 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=952 预览='{\n  "text": "冷笑一声，你将吕蒙的信笺掷入火盆，灰烬随风而散。既然东吴想看一出好戏，你便亲自为他们搭好舞台。你当众下令，抽调部分防备东吴的守军北上，增援樊城前线，做出全力攻曹、后方空虚的假象。此令一出，帐下诸将虽未明言，但脸上忧色尽显。尤其是南郡太守糜芳与将军士仁，他们的防区首当其冲，焦虑与不满几乎写在脸上'
2025-09-25 23:16:27 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=952 预览='{\n  "text": "冷笑一声，你将吕蒙的信笺掷入火盆，灰烬随风而散。既然东吴想看一出好戏，你便亲自为他们搭好舞台。你当众下令，抽调部分防备东吴的守军北上，增援樊城前线，做出全力攻曹、后方空虚的假象。此令一出，帐下诸将虽未明言，但脸上忧色尽显。尤其是南郡太守糜芳与将军士仁，他们的防区首当其冲，焦虑与不满几乎写在脸上'
2025-09-25 23:16:27 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=952 预览='{\n  "text": "冷笑一声，你将吕蒙的信笺掷入火盆，灰烬随风而散。既然东吴想看一出好戏，你便亲自为他们搭好舞台。你当众下令，抽调部分防备东吴的守军北上，增援樊城前线，做出全力攻曹、后方空虚的假象。此令一出，帐下诸将虽未明言，但脸上忧色尽显。尤其是南郡太守糜芳与将军士仁，他们的防区首当其冲，焦虑与不满几乎写在脸上。你深知，这二人便是那千里之堤上的蚁穴。蛇已诱之，但巢穴未固，任何疏忽都可能导致'
2025-09-25 23:16:27 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 213
2025-09-25 23:16:27 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:16:27 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:16:27 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:16:27 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:16:27 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=71 parent=70 choice='将计就计，引蛇出洞' rem=3
2025-09-25 23:16:27 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 放弃北伐，回防荆州
2025-09-25 23:16:50 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3075
2025-09-25 23:16:50 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=966 预览='{\n  "text": "你力排众议，毅然下达了从樊城前线后撤、主力回防江陵的命令。将士们虽有不解，但你军令如山，大军开始井然有序地南撤。“君侯，水淹七军，威震华夏，正该乘胜追击，为何……”你的义子关平忍不住策马跟上，话语中满是困惑。你没有解释，只是将那份吕蒙的亲笔信递给他，目光深邃如渊。回到江陵城，你立刻着手布防，但一种强烈的不安感依旧萦绕心头。仅仅依靠坚固的城墙被动防守，无异于坐以待毙。东吴的獠牙已经显露，你必须做出更主动的部署，才能彻底扭转乾坤。夜深人静，你摊开荆州地图，烛火摇曳，映照出你凝重的脸庞。",\n  "success_rate": 65,\n  "choices": [\n    '
2025-09-25 23:16:50 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=966 预览='{\n  "text": "你力排众议，毅然下达了从樊城前线后撤、主力回防江陵的命令。将士们虽有不解，但你军令如山，大军开始井然有序地南撤。“君侯，水淹七军，威震华夏，正该乘胜追击，为何……”你的义子关平忍不住策马跟上，话语中满是困惑。你没有解释，只是将那份吕蒙的亲笔信递给他，目光深邃如渊。回到江陵城，你立刻着手布防，但'
2025-09-25 23:16:50 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=966 预览='{\n  "text": "你力排众议，毅然下达了从樊城前线后撤、主力回防江陵的命令。将士们虽有不解，但你军令如山，大军开始井然有序地南撤。“君侯，水淹七军，威震华夏，正该乘胜追击，为何……”你的义子关平忍不住策马跟上，话语中满是困惑。你没有解释，只是将那份吕蒙的亲笔信递给他，目光深邃如渊。回到江陵城，你立刻着手布防，但'
2025-09-25 23:16:50 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=966 预览='{\n  "text": "你力排众议，毅然下达了从樊城前线后撤、主力回防江陵的命令。将士们虽有不解，但你军令如山，大军开始井然有序地南撤。“君侯，水淹七军，威震华夏，正该乘胜追击，为何……”你的义子关平忍不住策马跟上，话语中满是困惑。你没有解释，只是将那份吕蒙的亲笔信递给他，目光深邃如渊。回到江陵城，你立刻着手布防，但一种强烈的不安感依旧萦绕心头。仅仅依靠坚固的城墙被动防守，无异于坐以待毙。东吴的'
2025-09-25 23:16:50 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 243
2025-09-25 23:16:50 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:16:50 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:16:50 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:16:50 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:16:50 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=72 parent=70 choice='放弃北伐，回防荆州' rem=3
2025-09-25 23:16:50 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 遣使赴吴，外交破局
2025-09-25 23:16:51 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3523
2025-09-25 23:16:51 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=899 预览='{\n  "text": "“将计就计，引蛇出洞。” 你冷笑着将吕蒙的信笺掷入火盆，跳动的火焰映照着你眼中的杀意。历史的轨迹在你心中清晰无比，东吴的背刺，才是倾覆荆州的致命一击。你当即回信一封，言辞间对陆逊大加轻蔑，并公开宣称要将防备东吴的兵马悉数北调，汇集于樊城前线。消息传出，军中将士无不振奋，以为大功将成。然而，当你回到中军大帐，面对沙盘上孤悬在外的南郡与公安二城时，一丝寒意再次涌上心头。糜芳、傅士仁……这两个名字如同梦魇。你清楚，真正的蛇，不仅在江东，也可能盘踞在自己的身后。如何布置这盘棋，才能既钓出江东的狼，又防住家中的犬？",\n  "success_rate": 65,\n  "choi'
2025-09-25 23:16:51 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=899 预览='{\n  "text": "“将计就计，引蛇出洞。” 你冷笑着将吕蒙的信笺掷入火盆，跳动的火焰映照着你眼中的杀意。历史的轨迹在你心中清晰无比，东吴的背刺，才是倾覆荆州的致命一击。你当即回信一封，言辞间对陆逊大加轻蔑，并公开宣称要将防备东吴的兵马悉数北调，汇集于樊城前线。消息传出，军中将士无不振奋，以为大功将成。然而，当你'
2025-09-25 23:16:51 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=899 预览='{\n  "text": "“将计就计，引蛇出洞。” 你冷笑着将吕蒙的信笺掷入火盆，跳动的火焰映照着你眼中的杀意。历史的轨迹在你心中清晰无比，东吴的背刺，才是倾覆荆州的致命一击。你当即回信一封，言辞间对陆逊大加轻蔑，并公开宣称要将防备东吴的兵马悉数北调，汇集于樊城前线。消息传出，军中将士无不振奋，以为大功将成。然而，当你'
2025-09-25 23:16:51 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=899 预览='{\n  "text": "“将计就计，引蛇出洞。” 你冷笑着将吕蒙的信笺掷入火盆，跳动的火焰映照着你眼中的杀意。历史的轨迹在你心中清晰无比，东吴的背刺，才是倾覆荆州的致命一击。你当即回信一封，言辞间对陆逊大加轻蔑，并公开宣称要将防备东吴的兵马悉数北调，汇集于樊城前线。消息传出，军中将士无不振奋，以为大功将成。然而，当你回到中军大帐，面对沙盘上孤悬在外的南郡与公安二城时，一丝寒意再次涌上心头。糜芳、'
2025-09-25 23:16:51 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 255
2025-09-25 23:16:51 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:16:51 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:16:51 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:16:51 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:16:51 | INFO     | api.story:continue_existing_story:374 - 故事继续生成成功
2025-09-25 23:16:51 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=38 node=71 depth=3
2025-09-25 23:16:51 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 密令马良，暗中监察南郡、公安，并安抚糜、傅二人。
2025-09-25 23:16:54 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:17:15 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3431
2025-09-25 23:17:15 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1058 预览='{\n  "text": "夜深人静，你独坐帐中，烛火摇曳，映照着地图上荆襄九郡的每一个角落。马良的密信如期而至，信中寥寥数语，却字字千钧。糜、傅二人果然心怀怨望，私下多有往来，虽无通敌实证，但言语间对你的军令颇有微词，且与东吴商队暗中接触频繁。这印证了你的记忆，后方之患已然发酵。正当你思索如何处置这内患之时，帐外传来急促的脚步声。一名斥候满身泥泞，带来了樊城前线的紧急军情：曹仁得徐晃援军，守备愈发顽固，甚至开始小股出城反扑，我军攻势受阻，士气略有浮动。内有蚁穴将溃，外有强敌环伺，你必须立刻做出决断。",\n  "success_rate": 68,\n  "choices": [\n    {\n  '
2025-09-25 23:17:15 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1058 预览='{\n  "text": "夜深人静，你独坐帐中，烛火摇曳，映照着地图上荆襄九郡的每一个角落。马良的密信如期而至，信中寥寥数语，却字字千钧。糜、傅二人果然心怀怨望，私下多有往来，虽无通敌实证，但言语间对你的军令颇有微词，且与东吴商队暗中接触频繁。这印证了你的记忆，后方之患已然发酵。正当你思索如何处置这内患之时，帐外传来急'
2025-09-25 23:17:15 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1058 预览='{\n  "text": "夜深人静，你独坐帐中，烛火摇曳，映照着地图上荆襄九郡的每一个角落。马良的密信如期而至，信中寥寥数语，却字字千钧。糜、傅二人果然心怀怨望，私下多有往来，虽无通敌实证，但言语间对你的军令颇有微词，且与东吴商队暗中接触频繁。这印证了你的记忆，后方之患已然发酵。正当你思索如何处置这内患之时，帐外传来急'
2025-09-25 23:17:15 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1058 预览='{\n  "text": "夜深人静，你独坐帐中，烛火摇曳，映照着地图上荆襄九郡的每一个角落。马良的密信如期而至，信中寥寥数语，却字字千钧。糜、傅二人果然心怀怨望，私下多有往来，虽无通敌实证，但言语间对你的军令颇有微词，且与东吴商队暗中接触频繁。这印证了你的记忆，后方之患已然发酵。正当你思索如何处置这内患之时，帐外传来急促的脚步声。一名斥候满身泥泞，带来了樊城前线的紧急军情：曹仁得徐晃援军，守备愈发'
2025-09-25 23:17:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 239
2025-09-25 23:17:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:17:15 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:17:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:17:15 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:17:15 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=73 parent=71 choice='密令马良，暗中监察南郡、公安，并安抚糜、傅二人。' rem=3
2025-09-25 23:17:15 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 调遣精锐设下伏兵于江陵要道，同时向成都上表，请求援军以为后应。
2025-09-25 23:17:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:17:26 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:17:26 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:17:26 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:17:26 | INFO     | core.llm_clients:__init__:56 - API地址: https://new.wuxuai.com/v1
2025-09-25 23:17:26 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:17:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:17:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:17:27 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:17:27 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:17:27 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:17:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:17:27 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:17:27 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:17:27 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:17:27 | INFO     | backend.main:startup_event:109 - 当前使用模型: [渠道3]满血gemini-2.5-pro-preview-03-25
2025-09-25 23:17:27 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-25 23:18:14 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 1679
2025-09-25 23:18:37 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 赵云
2025-09-25 23:18:37 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '赵云'
2025-09-25 23:19:06 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2961
2025-09-25 23:19:06 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1014 预览='{\n  "text": "幽州的风，凛冽如刀，刮过界桥的残垣断壁，卷起公孙瓒军中那面褪色的“白马”大旗。我，赵云，字子龙，紧握着手中冰冷的龙胆亮银枪，心中却是一片茫然。本为匡扶汉室，救万民于水火，才投奔这位素有威名的“白马将军”。然而，连年的征伐只为与袁绍争夺河北之地，百姓流离失所，仁义之说早已沦为空谈。我一身武艺，却在这里虚耗光阴，看不到希望。就在此时，一封家书传来，兄长病故。这既是噩耗，也是一个契机。远在徐州的刘备，那位曾与我有过一面之缘、言谈间满是仁德的皇室后裔，正在招募义兵。是继续留在这潭泥沼，还是借奔丧之名，去寻找那渺茫却真实的希望？我的心，在战鼓与寒风中，做着艰难的抉择。",\n  '
2025-09-25 23:19:06 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1014 预览='{\n  "text": "幽州的风，凛冽如刀，刮过界桥的残垣断壁，卷起公孙瓒军中那面褪色的“白马”大旗。我，赵云，字子龙，紧握着手中冰冷的龙胆亮银枪，心中却是一片茫然。本为匡扶汉室，救万民于水火，才投奔这位素有威名的“白马将军”。然而，连年的征伐只为与袁绍争夺河北之地，百姓流离失所，仁义之说早已沦为空谈。我一身武艺，却'
2025-09-25 23:19:06 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1014 预览='{\n  "text": "幽州的风，凛冽如刀，刮过界桥的残垣断壁，卷起公孙瓒军中那面褪色的“白马”大旗。我，赵云，字子龙，紧握着手中冰冷的龙胆亮银枪，心中却是一片茫然。本为匡扶汉室，救万民于水火，才投奔这位素有威名的“白马将军”。然而，连年的征伐只为与袁绍争夺河北之地，百姓流离失所，仁义之说早已沦为空谈。我一身武艺，却'
2025-09-25 23:19:06 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1014 预览='{\n  "text": "幽州的风，凛冽如刀，刮过界桥的残垣断壁，卷起公孙瓒军中那面褪色的“白马”大旗。我，赵云，字子龙，紧握着手中冰冷的龙胆亮银枪，心中却是一片茫然。本为匡扶汉室，救万民于水火，才投奔这位素有威名的“白马将军”。然而，连年的征伐只为与袁绍争夺河北之地，百姓流离失所，仁义之说早已沦为空谈。我一身武艺，却在这里虚耗光阴，看不到希望。就在此时，一封家书传来，兄长病故。这既是噩耗，也是一'
2025-09-25 23:19:06 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 282
2025-09-25 23:19:06 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:19:06 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:19:06 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:19:06 | INFO     | core.story_engine:start_story:239 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-25 23:19:06 | INFO     | core.story_engine:start_story:262 - 新故事生成成功
2025-09-25 23:19:06 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 23:19:06 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=39 node=74 depth=3
2025-09-25 23:19:06 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 借奔丧之名，毅然脱离公孙瓒，星夜兼程前往徐州投奔刘备。
2025-09-25 23:21:37 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3286
2025-09-25 23:21:37 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1047 预览='{\n  "text": "辞别公孙瓒，我单人独骑，一路向南。风餐露宿，晓行夜奔，昔日袍泽的面容与幽州的寒风一同被我抛在身后。然而，越是靠近徐州，空气中弥漫的血腥与焦糊味便越是浓重。行至一处名为“白杨集”的村落时，眼前的景象让我勒住了马缰——断壁残垣，处处焦土，妇孺的哭嚎声撕心裂肺。一位幸存的老者告诉我，此地刚遭曹操大军洗劫，只因徐州牧陶谦部下杀了曹操之父。曹军前锋大将夏侯惇正率虎豹之师在左近清剿残余，封锁了前往徐州主城的各处要道。仁德之师尚未得见，屠戮之军已然挡道。前路被阴影笼罩，我紧了紧手中的龙胆枪，枪尖映出我坚毅却也凝重的脸庞。",\n  "success_rate": 68,\n  "cho'
2025-09-25 23:21:37 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1047 预览='{\n  "text": "辞别公孙瓒，我单人独骑，一路向南。风餐露宿，晓行夜奔，昔日袍泽的面容与幽州的寒风一同被我抛在身后。然而，越是靠近徐州，空气中弥漫的血腥与焦糊味便越是浓重。行至一处名为“白杨集”的村落时，眼前的景象让我勒住了马缰——断壁残垣，处处焦土，妇孺的哭嚎声撕心裂肺。一位幸存的老者告诉我，此地刚遭曹操大军'
2025-09-25 23:21:37 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1047 预览='{\n  "text": "辞别公孙瓒，我单人独骑，一路向南。风餐露宿，晓行夜奔，昔日袍泽的面容与幽州的寒风一同被我抛在身后。然而，越是靠近徐州，空气中弥漫的血腥与焦糊味便越是浓重。行至一处名为“白杨集”的村落时，眼前的景象让我勒住了马缰——断壁残垣，处处焦土，妇孺的哭嚎声撕心裂肺。一位幸存的老者告诉我，此地刚遭曹操大军'
2025-09-25 23:21:37 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1047 预览='{\n  "text": "辞别公孙瓒，我单人独骑，一路向南。风餐露宿，晓行夜奔，昔日袍泽的面容与幽州的寒风一同被我抛在身后。然而，越是靠近徐州，空气中弥漫的血腥与焦糊味便越是浓重。行至一处名为“白杨集”的村落时，眼前的景象让我勒住了马缰——断壁残垣，处处焦土，妇孺的哭嚎声撕心裂肺。一位幸存的老者告诉我，此地刚遭曹操大军洗劫，只因徐州牧陶谦部下杀了曹操之父。曹军前锋大将夏侯惇正率虎豹之师在左近清剿残'
2025-09-25 23:21:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 256
2025-09-25 23:21:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:21:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:21:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:21:37 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:21:37 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=75 parent=74 choice='借奔丧之名，毅然脱离公孙瓒，星夜兼程前往徐州投奔刘备。' rem=3
2025-09-25 23:21:37 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 暂且压下心思，利用奔丧假期返回常山真定，暗中派人打探刘备的虚实与声望。
2025-09-25 23:21:50 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 借奔丧之名，毅然脱离公孙瓒，星夜兼程前往徐州投奔刘备。
2025-09-25 23:22:05 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3301
2025-09-25 23:22:05 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1054 预览='{\n  "text": "向公孙瓒告假后，我星夜兼程返回了常山真定。兄长的丧事办得简朴而肃穆，家族的悲戚与乱世的萧条，更坚定了我寻找明主的决心。安顿好家中事务，我立刻联络了昔日的乡中旧友、如今已在县中担任吏员的夏侯兰。通过他的渠道，我开始暗中收集关于刘备的消息。徐州传来的风评竟出奇地一致：刘玄德仁德爱民，礼贤下士，陶谦三让徐州，皆因其德行感召。这让我心中那份投效的念头愈发炽热。然而，就在此时，乡间的混乱打断了我的计划。一伙自称“黑山军”的流寇正在四处劫掠，官府兵力不足，无力清剿，乡亲们人心惶惶，日夜惊恐。我的故乡，竟也成了乱世的缩影。墙角的龙胆亮银枪，似乎在渴望着正义的鲜血。",\n  "suc'
2025-09-25 23:22:05 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1054 预览='{\n  "text": "向公孙瓒告假后，我星夜兼程返回了常山真定。兄长的丧事办得简朴而肃穆，家族的悲戚与乱世的萧条，更坚定了我寻找明主的决心。安顿好家中事务，我立刻联络了昔日的乡中旧友、如今已在县中担任吏员的夏侯兰。通过他的渠道，我开始暗中收集关于刘备的消息。徐州传来的风评竟出奇地一致：刘玄德仁德爱民，礼贤下士，陶谦'
2025-09-25 23:22:05 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1054 预览='{\n  "text": "向公孙瓒告假后，我星夜兼程返回了常山真定。兄长的丧事办得简朴而肃穆，家族的悲戚与乱世的萧条，更坚定了我寻找明主的决心。安顿好家中事务，我立刻联络了昔日的乡中旧友、如今已在县中担任吏员的夏侯兰。通过他的渠道，我开始暗中收集关于刘备的消息。徐州传来的风评竟出奇地一致：刘玄德仁德爱民，礼贤下士，陶谦'
2025-09-25 23:22:05 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1054 预览='{\n  "text": "向公孙瓒告假后，我星夜兼程返回了常山真定。兄长的丧事办得简朴而肃穆，家族的悲戚与乱世的萧条，更坚定了我寻找明主的决心。安顿好家中事务，我立刻联络了昔日的乡中旧友、如今已在县中担任吏员的夏侯兰。通过他的渠道，我开始暗中收集关于刘备的消息。徐州传来的风评竟出奇地一致：刘玄德仁德爱民，礼贤下士，陶谦三让徐州，皆因其德行感召。这让我心中那份投效的念头愈发炽热。然而，就在此时，乡间'
2025-09-25 23:22:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 278
2025-09-25 23:22:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:22:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:22:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:22:05 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:22:05 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=76 parent=74 choice='暂且压下心思，利用奔丧假期返回常山真定，暗中派人打探刘备的虚实与声望。' rem=3
2025-09-25 23:22:05 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 面见公孙瓒，以仁义之道进谏，劝其休兵养民，联合天下仁义之师共讨国贼。
2025-09-25 23:22:34 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3159
2025-09-25 23:22:34 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1138 预览='{\n  "text": "帅帐之内，气氛凝如寒冰。公孙瓒身披铁铠，正对着地图上与袁绍交错的势力范围出神，听到我的进言，他缓缓转过身，鹰隼般的目光中没有丝毫赞许，反而充满了审视与不耐。“子龙，仁义能当饭吃吗？能挡住袁本初的十万大军吗？”他的声音嘶哑而冰冷，“我公孙瓒能有今日，靠的是手中的刀，胯下的马，不是那虚无缥缈的仁义！国贼？天下最大的国贼，就是那些割据一方，阻碍我一统河北的所谓英雄！”他猛地一拍桌案，震得令箭作响。“你兄长病故，我准你假。但休兵养民之说，再勿复言！否则，休怪我无情！”我默默退出大帐，帐外的朔风比将军的话语还要刺骨。我明白了，道不同，不相为谋。公孙瓒的霸业，已容不下一颗仁义之心'
2025-09-25 23:22:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1138 预览='{\n  "text": "帅帐之内，气氛凝如寒冰。公孙瓒身披铁铠，正对着地图上与袁绍交错的势力范围出神，听到我的进言，他缓缓转过身，鹰隼般的目光中没有丝毫赞许，反而充满了审视与不耐。“子龙，仁义能当饭吃吗？能挡住袁本初的十万大军吗？”他的声音嘶哑而冰冷，“我公孙瓒能有今日，靠的是手中的刀，胯下的马，不是那虚无缥缈的仁义'
2025-09-25 23:22:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1138 预览='{\n  "text": "帅帐之内，气氛凝如寒冰。公孙瓒身披铁铠，正对着地图上与袁绍交错的势力范围出神，听到我的进言，他缓缓转过身，鹰隼般的目光中没有丝毫赞许，反而充满了审视与不耐。“子龙，仁义能当饭吃吗？能挡住袁本初的十万大军吗？”他的声音嘶哑而冰冷，“我公孙瓒能有今日，靠的是手中的刀，胯下的马，不是那虚无缥缈的仁义'
2025-09-25 23:22:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1138 预览='{\n  "text": "帅帐之内，气氛凝如寒冰。公孙瓒身披铁铠，正对着地图上与袁绍交错的势力范围出神，听到我的进言，他缓缓转过身，鹰隼般的目光中没有丝毫赞许，反而充满了审视与不耐。“子龙，仁义能当饭吃吗？能挡住袁本初的十万大军吗？”他的声音嘶哑而冰冷，“我公孙瓒能有今日，靠的是手中的刀，胯下的马，不是那虚无缥缈的仁义！国贼？天下最大的国贼，就是那些割据一方，阻碍我一统河北的所谓英雄！”他猛地一拍'
2025-09-25 23:22:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 309
2025-09-25 23:22:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:22:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:22:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:22:34 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:22:34 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=77 parent=74 choice='面见公孙瓒，以仁义之道进谏，劝其休兵养民，联合天下仁义之师共讨国贼。' rem=3
2025-09-25 23:22:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 单骑闯阵，直奔徐州城。以武力突破曹军封锁，尽快与刘备会合。
2025-09-25 23:22:59 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3319
2025-09-25 23:22:59 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1039 预览='{\n  "text": "决定已下，便再无犹豫！我双腿猛然一夹马腹，坐下白马如一道离弦之箭，人马合一，化作一道银色闪电，直冲曹军阵列。枪出如龙，寒光凛冽，所过之处，曹军士卒人仰马翻。我一眼瞥见阵中那面斗大的“夏侯”旗帜，心知此乃敌军主将所在。与其陷入缠斗，不如直捣中军，撕开一道缺口！龙胆枪舞动如风，荡开层层阻碍，硬生生在密不透风的阵型中杀出一条血路。夏侯惇显然也注意到了我这不速之客，怒吼着调兵遣将前来围堵。虽已突破前军，但身后追兵如蝗，前方徐州城郭在望，我却已感到气力消耗甚巨，座下马匹亦在喘着粗气。",\n  "success_rate": 65,\n  "choices": [\n    {\n  '
2025-09-25 23:22:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1039 预览='{\n  "text": "决定已下，便再无犹豫！我双腿猛然一夹马腹，坐下白马如一道离弦之箭，人马合一，化作一道银色闪电，直冲曹军阵列。枪出如龙，寒光凛冽，所过之处，曹军士卒人仰马翻。我一眼瞥见阵中那面斗大的“夏侯”旗帜，心知此乃敌军主将所在。与其陷入缠斗，不如直捣中军，撕开一道缺口！龙胆枪舞动如风，荡开层层阻碍，硬生生'
2025-09-25 23:22:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1039 预览='{\n  "text": "决定已下，便再无犹豫！我双腿猛然一夹马腹，坐下白马如一道离弦之箭，人马合一，化作一道银色闪电，直冲曹军阵列。枪出如龙，寒光凛冽，所过之处，曹军士卒人仰马翻。我一眼瞥见阵中那面斗大的“夏侯”旗帜，心知此乃敌军主将所在。与其陷入缠斗，不如直捣中军，撕开一道缺口！龙胆枪舞动如风，荡开层层阻碍，硬生生'
2025-09-25 23:22:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1039 预览='{\n  "text": "决定已下，便再无犹豫！我双腿猛然一夹马腹，坐下白马如一道离弦之箭，人马合一，化作一道银色闪电，直冲曹军阵列。枪出如龙，寒光凛冽，所过之处，曹军士卒人仰马翻。我一眼瞥见阵中那面斗大的“夏侯”旗帜，心知此乃敌军主将所在。与其陷入缠斗，不如直捣中军，撕开一道缺口！龙胆枪舞动如风，荡开层层阻碍，硬生生在密不透风的阵型中杀出一条血路。夏侯惇显然也注意到了我这不速之客，怒吼着调兵遣将'
2025-09-25 23:22:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 239
2025-09-25 23:22:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:22:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:22:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:22:59 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:22:59 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=78 parent=75 choice='单骑闯阵，直奔徐州城。以武力突破曹军封锁，尽快与刘备会合。' rem=2
2025-09-25 23:22:59 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 在附近乡野打探情报，联络当地反抗曹军的义勇。与他们一同行动，寻找机会进入徐州。
2025-09-25 23:23:54 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2894
2025-09-25 23:23:54 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1203 预览='{\n  "text": "与其坐困愁城，不如主动出击。我将坐骑藏于密林，换上一身布衣，深入乡野。曹军的暴行令乡民们噤若寒蝉，但也点燃了复仇的怒火。在一处破败的祠堂，我终于联系上了一支由当地豪族陈登暗中资助的义勇。为首的是一名唤作“李二”的猎户，双目赤红，家小皆丧于曹军屠刀之下。他们人虽不多，却个个怀着必死之心。然而，他们的计划却近乎自尽——正面冲击曹军设在渡口的关卡。我深知此举无异于以卵击石。当我指出其计划的疏漏时，李二和他的弟兄们投来了怀疑的目光。在这乱世，一个来历不明的外乡人，空有一身武艺，难以轻易获取信任。他们告诉我，除非我能证明自己的价值与忠诚，否则休想让他们这群亡命徒听从号令。夜色渐'
2025-09-25 23:23:54 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1203 预览='{\n  "text": "与其坐困愁城，不如主动出击。我将坐骑藏于密林，换上一身布衣，深入乡野。曹军的暴行令乡民们噤若寒蝉，但也点燃了复仇的怒火。在一处破败的祠堂，我终于联系上了一支由当地豪族陈登暗中资助的义勇。为首的是一名唤作“李二”的猎户，双目赤红，家小皆丧于曹军屠刀之下。他们人虽不多，却个个怀着必死之心。然而，他'
2025-09-25 23:23:54 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1203 预览='{\n  "text": "与其坐困愁城，不如主动出击。我将坐骑藏于密林，换上一身布衣，深入乡野。曹军的暴行令乡民们噤若寒蝉，但也点燃了复仇的怒火。在一处破败的祠堂，我终于联系上了一支由当地豪族陈登暗中资助的义勇。为首的是一名唤作“李二”的猎户，双目赤红，家小皆丧于曹军屠刀之下。他们人虽不多，却个个怀着必死之心。然而，他'
2025-09-25 23:23:54 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1203 预览='{\n  "text": "与其坐困愁城，不如主动出击。我将坐骑藏于密林，换上一身布衣，深入乡野。曹军的暴行令乡民们噤若寒蝉，但也点燃了复仇的怒火。在一处破败的祠堂，我终于联系上了一支由当地豪族陈登暗中资助的义勇。为首的是一名唤作“李二”的猎户，双目赤红，家小皆丧于曹军屠刀之下。他们人虽不多，却个个怀着必死之心。然而，他们的计划却近乎自尽——正面冲击曹军设在渡口的关卡。我深知此举无异于以卵击石。当我'
2025-09-25 23:23:54 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 331
2025-09-25 23:23:54 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:23:54 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:23:54 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:23:54 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:23:54 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=79 parent=75 choice='在附近乡野打探情报，联络当地反抗曹军的义勇。与他们一同行动，寻找机会进入徐州。' rem=2
2025-09-25 23:23:54 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 绕道向东，沿泰山山脉南下。避开曹军主力，寻找小路潜入徐州。
2025-09-25 23:24:54 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3483
2025-09-25 23:24:54 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1044 预览='{\n  "text": "泰山山脉，崎岖难行，林深蔽日。我牵着“夜照玉狮子”，小心翼翼地在山间小径穿行。此举虽避开了夏侯惇的大军，却也意味着孤立无援。行至一处名为“青石峪”的山谷，前方忽然箭矢破空，数名手持兵刃的壮汉从林中跃出，将我团团围住。为首之人身材魁梧，面带戒备：“阁下是何人？曹军的探子，还是公孙瓒的逃兵？”他们衣衫褴褛，却是乡勇打扮，眼中燃烧着保卫家园的怒火。看来，曹军的暴行已激起了此地民众的殊死抵抗。他们封锁了通往徐州的最后几条山路，不信任任何外来者。我的解释苍白无力，唯有行动才能证明我的立场。",\n  "success_rate": 68,\n  "choices": [\n    {'
2025-09-25 23:24:54 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1044 预览='{\n  "text": "泰山山脉，崎岖难行，林深蔽日。我牵着“夜照玉狮子”，小心翼翼地在山间小径穿行。此举虽避开了夏侯惇的大军，却也意味着孤立无援。行至一处名为“青石峪”的山谷，前方忽然箭矢破空，数名手持兵刃的壮汉从林中跃出，将我团团围住。为首之人身材魁梧，面带戒备：“阁下是何人？曹军的探子，还是公孙瓒的逃兵？”他们'
2025-09-25 23:24:54 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1044 预览='{\n  "text": "泰山山脉，崎岖难行，林深蔽日。我牵着“夜照玉狮子”，小心翼翼地在山间小径穿行。此举虽避开了夏侯惇的大军，却也意味着孤立无援。行至一处名为“青石峪”的山谷，前方忽然箭矢破空，数名手持兵刃的壮汉从林中跃出，将我团团围住。为首之人身材魁梧，面带戒备：“阁下是何人？曹军的探子，还是公孙瓒的逃兵？”他们'
2025-09-25 23:24:54 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1044 预览='{\n  "text": "泰山山脉，崎岖难行，林深蔽日。我牵着“夜照玉狮子”，小心翼翼地在山间小径穿行。此举虽避开了夏侯惇的大军，却也意味着孤立无援。行至一处名为“青石峪”的山谷，前方忽然箭矢破空，数名手持兵刃的壮汉从林中跃出，将我团团围住。为首之人身材魁梧，面带戒备：“阁下是何人？曹军的探子，还是公孙瓒的逃兵？”他们衣衫褴褛，却是乡勇打扮，眼中燃烧着保卫家园的怒火。看来，曹军的暴行已激起了此地民'
2025-09-25 23:24:54 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 242
2025-09-25 23:24:54 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:24:54 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:24:54 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:24:54 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:24:54 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=80 parent=75 choice='绕道向东，沿泰山山脉南下。避开曹军主力，寻找小路潜入徐州。' rem=2
2025-09-25 23:24:54 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 单枪匹马，夜袭匪巢，以雷霆手段震慑贼寇，为乡里除害。
2025-09-25 23:25:18 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 2782
2025-09-25 23:25:18 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1078 预览='{\n  "text": "与其坐困愁城，不如以杀止杀！月黑风高，正是我龙胆枪饮血之时。我未惊动任何乡人，仅着一身劲装，单人独骑，如鬼魅般潜入黑山军盘踞的废弃军寨。寨中匪寇醉酒狂欢，浑然不觉死神已至。我如猛虎下山，长枪到处，血肉横飞，惨叫声被狂风吞噬。不过半个时辰，寨内已是尸横遍地，残余的匪寇被我的神威吓破了胆，跪地求饶。我并未赶尽杀绝，只斩了为首的几个渠帅，将他们的头颅高悬于寨门之上，随即飘然而去。次日，常山震动，“赵子龙单骑破贼”的消息不胫而走，乡亲们视我为神明，而县令裴元绍也派人送来拜帖，言辞恳切，邀我赴宴。我的威名在乡里达到了顶峰，但也让我暴露在了各方势力的视野之中。这雷霆一击，是为自己'
2025-09-25 23:25:18 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1078 预览='{\n  "text": "与其坐困愁城，不如以杀止杀！月黑风高，正是我龙胆枪饮血之时。我未惊动任何乡人，仅着一身劲装，单人独骑，如鬼魅般潜入黑山军盘踞的废弃军寨。寨中匪寇醉酒狂欢，浑然不觉死神已至。我如猛虎下山，长枪到处，血肉横飞，惨叫声被狂风吞噬。不过半个时辰，寨内已是尸横遍地，残余的匪寇被我的神威吓破了胆，跪地求饶'
2025-09-25 23:25:18 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1078 预览='{\n  "text": "与其坐困愁城，不如以杀止杀！月黑风高，正是我龙胆枪饮血之时。我未惊动任何乡人，仅着一身劲装，单人独骑，如鬼魅般潜入黑山军盘踞的废弃军寨。寨中匪寇醉酒狂欢，浑然不觉死神已至。我如猛虎下山，长枪到处，血肉横飞，惨叫声被狂风吞噬。不过半个时辰，寨内已是尸横遍地，残余的匪寇被我的神威吓破了胆，跪地求饶'
2025-09-25 23:25:18 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1078 预览='{\n  "text": "与其坐困愁城，不如以杀止杀！月黑风高，正是我龙胆枪饮血之时。我未惊动任何乡人，仅着一身劲装，单人独骑，如鬼魅般潜入黑山军盘踞的废弃军寨。寨中匪寇醉酒狂欢，浑然不觉死神已至。我如猛虎下山，长枪到处，血肉横飞，惨叫声被狂风吞噬。不过半个时辰，寨内已是尸横遍地，残余的匪寇被我的神威吓破了胆，跪地求饶。我并未赶尽杀绝，只斩了为首的几个渠帅，将他们的头颅高悬于寨门之上，随即飘然而去'
2025-09-25 23:25:18 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 304
2025-09-25 23:25:18 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:25:18 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:25:18 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:25:18 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:25:18 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=81 parent=76 choice='单枪匹马，夜袭匪巢，以雷霆手段震慑贼寇，为乡里除害。' rem=2
2025-09-25 23:25:18 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 联络乡中豪杰与县中兵丁，组织义军，设下埋伏，智取贼寇。
2025-09-25 23:25:48 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3644
2025-09-25 23:25:48 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1069 预览='{\n  "text": "国之不存，何以为家？我压下远赴徐州的心思，决心先平乡里之患。通过夏侯兰的奔走，常山郡中尚有血性的豪杰子弟与一些心怀正义的县中兵士纷纷响应。我们很快聚集起一支数百人的义军，虽装备简陋，士气却异常高昂。黑山军行踪不定，强攻非上策。我勘察了附近地形，决定在他们惯于劫掠的必经之路——青石峪设伏。此地两山夹一谷，地势险要，是绝佳的伏击点。然而，计划却遇到了阻碍。县令担忧此举会激怒黑山军主力，招来更大的报复，更害怕得罪袁绍治下“不得私自募兵”的禁令，迟迟不肯拨付粮草器械。义军军心浮动，埋伏之计，已是箭在弦上，却缺了最关键的东风。",\n  "success_rate": 72,\n '
2025-09-25 23:25:48 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1069 预览='{\n  "text": "国之不存，何以为家？我压下远赴徐州的心思，决心先平乡里之患。通过夏侯兰的奔走，常山郡中尚有血性的豪杰子弟与一些心怀正义的县中兵士纷纷响应。我们很快聚集起一支数百人的义军，虽装备简陋，士气却异常高昂。黑山军行踪不定，强攻非上策。我勘察了附近地形，决定在他们惯于劫掠的必经之路——青石峪设伏。此地两'
2025-09-25 23:25:48 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1069 预览='{\n  "text": "国之不存，何以为家？我压下远赴徐州的心思，决心先平乡里之患。通过夏侯兰的奔走，常山郡中尚有血性的豪杰子弟与一些心怀正义的县中兵士纷纷响应。我们很快聚集起一支数百人的义军，虽装备简陋，士气却异常高昂。黑山军行踪不定，强攻非上策。我勘察了附近地形，决定在他们惯于劫掠的必经之路——青石峪设伏。此地两'
2025-09-25 23:25:48 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1069 预览='{\n  "text": "国之不存，何以为家？我压下远赴徐州的心思，决心先平乡里之患。通过夏侯兰的奔走，常山郡中尚有血性的豪杰子弟与一些心怀正义的县中兵士纷纷响应。我们很快聚集起一支数百人的义军，虽装备简陋，士气却异常高昂。黑山军行踪不定，强攻非上策。我勘察了附近地形，决定在他们惯于劫掠的必经之路——青石峪设伏。此地两山夹一谷，地势险要，是绝佳的伏击点。然而，计划却遇到了阻碍。县令担忧此举会激怒黑'
2025-09-25 23:25:48 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 261
2025-09-25 23:25:48 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:25:48 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:25:48 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:25:48 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:25:48 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=82 parent=76 choice='联络乡中豪杰与县中兵丁，组织义军，设下埋伏，智取贼寇。' rem=2
2025-09-25 23:25:48 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 保持低调，优先护卫自家宗族，同时继续详查黑山军的底细与刘备的动向，静待良机。
2025-09-25 23:26:18 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3763
2025-09-25 23:26:18 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1093 预览='{\n  "text": "我随即召集族中青壮，凭借昔日在军中习得的阵法与武艺，将赵家坞堡修缮得固若金汤。夜间亲自带人巡逻，白日则教授族人武艺，一时间，坞堡内外秩序井然，人心稍定。然而，树欲静而风不止。黑山军的斥候如同苍蝇般出现在坞堡周围，其头目‘飞燕’张燕更是派人送来最后通牒：三日内献出粮草半数与铁器百件，否则屠堡。与此同时，夏侯兰带来的消息也让我心头一紧——袁绍与公孙瓒在界桥决战，公孙瓒大败，元气大伤。而刘备，此刻正奉公孙瓒之命，与田楷一同屯兵齐国，对抗袁绍。他离我，竟是如此之近，却又因眼前的危机而遥不可及。",\n  "success_rate": 68,\n  "choices": [\n  '
2025-09-25 23:26:18 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1093 预览='{\n  "text": "我随即召集族中青壮，凭借昔日在军中习得的阵法与武艺，将赵家坞堡修缮得固若金汤。夜间亲自带人巡逻，白日则教授族人武艺，一时间，坞堡内外秩序井然，人心稍定。然而，树欲静而风不止。黑山军的斥候如同苍蝇般出现在坞堡周围，其头目‘飞燕’张燕更是派人送来最后通牒：三日内献出粮草半数与铁器百件，否则屠堡。与'
2025-09-25 23:26:18 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1093 预览='{\n  "text": "我随即召集族中青壮，凭借昔日在军中习得的阵法与武艺，将赵家坞堡修缮得固若金汤。夜间亲自带人巡逻，白日则教授族人武艺，一时间，坞堡内外秩序井然，人心稍定。然而，树欲静而风不止。黑山军的斥候如同苍蝇般出现在坞堡周围，其头目‘飞燕’张燕更是派人送来最后通牒：三日内献出粮草半数与铁器百件，否则屠堡。与'
2025-09-25 23:26:18 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1093 预览='{\n  "text": "我随即召集族中青壮，凭借昔日在军中习得的阵法与武艺，将赵家坞堡修缮得固若金汤。夜间亲自带人巡逻，白日则教授族人武艺，一时间，坞堡内外秩序井然，人心稍定。然而，树欲静而风不止。黑山军的斥候如同苍蝇般出现在坞堡周围，其头目‘飞燕’张燕更是派人送来最后通牒：三日内献出粮草半数与铁器百件，否则屠堡。与此同时，夏侯兰带来的消息也让我心头一紧——袁绍与公孙瓒在界桥决战，公孙瓒大败，元'
2025-09-25 23:26:18 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 245
2025-09-25 23:26:18 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:26:18 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:26:18 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:26:18 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:26:18 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=83 parent=76 choice='保持低调，优先护卫自家宗族，同时继续详查黑山军的底细与刘备的动向，静待良机。' rem=2
2025-09-25 23:26:18 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 暂且隐忍，接受公孙瓒的安排，同时暗中联络旧部，准备借奔丧之名，带亲信悄然离开界桥，投奔徐州刘备。
2025-09-25 23:26:46 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3539
2025-09-25 23:26:46 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1129 预览='{\n  "text": "寒风灌入领口，却不及心中半分冰冷。公孙瓒的决绝，彻底斩断了我最后的幻想。此地非久留之所，徐州的仁德之光，是我唯一的目标。回到营帐，我开始默默收拾行装——那杆跟随我多年的龙胆亮银枪，还有那副虽已陈旧却依旧光亮的铠甲。兄长之丧是最好的借口，但如何才能在多疑的公孙瓒眼皮底下，带走愿意追随我的数十名白马义从，却是个难题。正在我思索之际，帐帘一挑，一人闪身而入，竟是我的同乡旧友，现任军中司马的夏侯兰。他面带忧色，压低声音道：‘子龙，我见你从主公帐中出来，面色不善，可是发生了何事？如今将军刚愎自用，与袁绍连年血战，我等名为义兵，实为私兵，早已背离初衷。’他顿了顿，眼中闪过一丝决然'
2025-09-25 23:26:46 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1129 预览='{\n  "text": "寒风灌入领口，却不及心中半分冰冷。公孙瓒的决绝，彻底斩断了我最后的幻想。此地非久留之所，徐州的仁德之光，是我唯一的目标。回到营帐，我开始默默收拾行装——那杆跟随我多年的龙胆亮银枪，还有那副虽已陈旧却依旧光亮的铠甲。兄长之丧是最好的借口，但如何才能在多疑的公孙瓒眼皮底下，带走愿意追随我的数十名白'
2025-09-25 23:26:46 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1129 预览='{\n  "text": "寒风灌入领口，却不及心中半分冰冷。公孙瓒的决绝，彻底斩断了我最后的幻想。此地非久留之所，徐州的仁德之光，是我唯一的目标。回到营帐，我开始默默收拾行装——那杆跟随我多年的龙胆亮银枪，还有那副虽已陈旧却依旧光亮的铠甲。兄长之丧是最好的借口，但如何才能在多疑的公孙瓒眼皮底下，带走愿意追随我的数十名白'
2025-09-25 23:26:46 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1129 预览='{\n  "text": "寒风灌入领口，却不及心中半分冰冷。公孙瓒的决绝，彻底斩断了我最后的幻想。此地非久留之所，徐州的仁德之光，是我唯一的目标。回到营帐，我开始默默收拾行装——那杆跟随我多年的龙胆亮银枪，还有那副虽已陈旧却依旧光亮的铠甲。兄长之丧是最好的借口，但如何才能在多疑的公孙瓒眼皮底下，带走愿意追随我的数十名白马义从，却是个难题。正在我思索之际，帐帘一挑，一人闪身而入，竟是我的同乡旧友，现'
2025-09-25 23:26:46 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 302
2025-09-25 23:26:46 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:26:46 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:26:46 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:26:46 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:26:46 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=84 parent=77 choice='暂且隐忍，接受公孙瓒的安排，同时暗中联络旧部，准备借奔丧之名，带亲信悄然离开界桥，投奔徐州刘备。' rem=2
2025-09-25 23:26:46 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 公然违抗军令，联络军中同样心怀不满的将校，准备强行脱离公孙瓒阵营。
2025-09-25 23:27:12 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3491
2025-09-25 23:27:12 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1017 预览='{\n  "text": "公孙瓒的冷酷言语，如同一盆冰水，彻底浇灭了我心中最后一丝幻想。道不同，不相为谋。与其在此助纣为虐，不如舍身求仁。是夜，我借巡营之名，秘密召集了数名与我志同道合、同样对公孙瓒穷兵黩武心生不满的军侯。帐内烛火摇曳，映着众人凝重的脸。我将弃暗投明、另投明主的想法和盘托出。有人慷慨激昂，愿舍命相随；亦有人面露忧色，畏惧公孙瓒的雷霆手段。正当众人议论之际，帐外忽然传来一阵急促的脚步声与甲胄摩擦之音！“将军，是田楷的亲兵巡逻队！”一名亲卫压低声音急报。我们，暴露了？帐内瞬间死寂，每个人的手都下意识地握住了腰间的刀柄。",\n  "success_rate": 55,\n  "choi'
2025-09-25 23:27:12 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1017 预览='{\n  "text": "公孙瓒的冷酷言语，如同一盆冰水，彻底浇灭了我心中最后一丝幻想。道不同，不相为谋。与其在此助纣为虐，不如舍身求仁。是夜，我借巡营之名，秘密召集了数名与我志同道合、同样对公孙瓒穷兵黩武心生不满的军侯。帐内烛火摇曳，映着众人凝重的脸。我将弃暗投明、另投明主的想法和盘托出。有人慷慨激昂，愿舍命相随；亦'
2025-09-25 23:27:12 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1017 预览='{\n  "text": "公孙瓒的冷酷言语，如同一盆冰水，彻底浇灭了我心中最后一丝幻想。道不同，不相为谋。与其在此助纣为虐，不如舍身求仁。是夜，我借巡营之名，秘密召集了数名与我志同道合、同样对公孙瓒穷兵黩武心生不满的军侯。帐内烛火摇曳，映着众人凝重的脸。我将弃暗投明、另投明主的想法和盘托出。有人慷慨激昂，愿舍命相随；亦'
2025-09-25 23:27:12 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1017 预览='{\n  "text": "公孙瓒的冷酷言语，如同一盆冰水，彻底浇灭了我心中最后一丝幻想。道不同，不相为谋。与其在此助纣为虐，不如舍身求仁。是夜，我借巡营之名，秘密召集了数名与我志同道合、同样对公孙瓒穷兵黩武心生不满的军侯。帐内烛火摇曳，映着众人凝重的脸。我将弃暗投明、另投明主的想法和盘托出。有人慷慨激昂，愿舍命相随；亦有人面露忧色，畏惧公孙瓒的雷霆手段。正当众人议论之际，帐外忽然传来一阵急促的脚步'
2025-09-25 23:27:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 255
2025-09-25 23:27:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:27:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:27:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:27:12 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:27:12 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=85 parent=77 choice='公然违抗军令，联络军中同样心怀不满的将校，准备强行脱离公孙瓒阵营。' rem=2
2025-09-25 23:27:12 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 借口兄丧，告假暂离军营，但不立即远行。在附近州县停留，观察公孙瓒与袁绍的战局，并试图寻找与刘备联络的密使。
2025-09-25 23:27:42 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3616
2025-09-25 23:27:42 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1087 预览='{\n  "text": "告别公孙瓒后，我并未立刻远赴常山，而是选择在冀州边陲的一座小县城落脚。此地因地处公孙瓒与袁绍势力的交界，鱼龙混杂，流言四起，正是观察时局的最佳地点。我换上布衣，将龙胆枪用厚布包裹，扮作一名寻常的游侠。连日来，我流连于市井茶肆，听到的多是界桥之战的惨烈与双方僵持的近况，却始终未曾发现任何与刘备相关的线索。一日午后，我在城南驿站歇脚，忽闻一阵喧哗。几名衣甲不整的溃兵，正围着一队风尘仆仆的商旅强索钱财。为首的商人虽衣着简朴，面对威逼却不卑不亢，沉声道：“我等乃徐州糜氏商队，并非无名之辈，还请军爷行个方便。” 糜氏？我心中一动，那不正是传闻中倾力资助刘备的徐州富商吗？这队人马'
2025-09-25 23:27:42 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1087 预览='{\n  "text": "告别公孙瓒后，我并未立刻远赴常山，而是选择在冀州边陲的一座小县城落脚。此地因地处公孙瓒与袁绍势力的交界，鱼龙混杂，流言四起，正是观察时局的最佳地点。我换上布衣，将龙胆枪用厚布包裹，扮作一名寻常的游侠。连日来，我流连于市井茶肆，听到的多是界桥之战的惨烈与双方僵持的近况，却始终未曾发现任何与刘备相'
2025-09-25 23:27:42 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1087 预览='{\n  "text": "告别公孙瓒后，我并未立刻远赴常山，而是选择在冀州边陲的一座小县城落脚。此地因地处公孙瓒与袁绍势力的交界，鱼龙混杂，流言四起，正是观察时局的最佳地点。我换上布衣，将龙胆枪用厚布包裹，扮作一名寻常的游侠。连日来，我流连于市井茶肆，听到的多是界桥之战的惨烈与双方僵持的近况，却始终未曾发现任何与刘备相'
2025-09-25 23:27:42 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1087 预览='{\n  "text": "告别公孙瓒后，我并未立刻远赴常山，而是选择在冀州边陲的一座小县城落脚。此地因地处公孙瓒与袁绍势力的交界，鱼龙混杂，流言四起，正是观察时局的最佳地点。我换上布衣，将龙胆枪用厚布包裹，扮作一名寻常的游侠。连日来，我流连于市井茶肆，听到的多是界桥之战的惨烈与双方僵持的近况，却始终未曾发现任何与刘备相关的线索。一日午后，我在城南驿站歇脚，忽闻一阵喧哗。几名衣甲不整的溃兵，正围着一'
2025-09-25 23:27:42 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 314
2025-09-25 23:27:42 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:27:42 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:27:42 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:27:42 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:27:42 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L2] created node=86 parent=77 choice='借口兄丧，告假暂离军营，但不立即远行。在附近州县停留，观察公孙瓒与袁绍的战局，并试图寻找与刘备联络的密使。' rem=2
2025-09-25 23:27:42 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 不与敌将纠缠，利用突破的缺口，甩开追兵，全速奔向徐州城下，先与刘备会合为上。
2025-09-25 23:28:08 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3649
2025-09-25 23:28:08 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1179 预览='{\n  "text": "夏侯惇的怒吼被我远远甩在身后，身后烟尘滚滚，追兵的马蹄声逐渐稀疏。我不敢有丝毫懈怠，伏在马背上，人马合一，只顾催马狂奔。终于，徐州那巍峨的城郭出现在地平线上，城头之上，“刘”字大旗与“陶”字旗帜并列，猎猎作响。然而，城外曹军营寨连绵，围得如铁桶一般，投石车与攻城器械蓄势待发，空气中充满了大战一触即发的紧张气息。我勒马于护城河外，城墙上的守军早已发现了我这个单枪匹马的不速之客，一排排弓箭手引弓待发，箭矢的寒芒如林，直指我的咽喉。城楼上传来一声厉喝：“来者何人！曹营鼠辈，安敢在此窥探！”喊话者声如洪钟，身形魁梧，手持一把丈八蛇矛，豹头环眼，正是那闻名天下的张飞张翼德。他显'
2025-09-25 23:28:08 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1179 预览='{\n  "text": "夏侯惇的怒吼被我远远甩在身后，身后烟尘滚滚，追兵的马蹄声逐渐稀疏。我不敢有丝毫懈怠，伏在马背上，人马合一，只顾催马狂奔。终于，徐州那巍峨的城郭出现在地平线上，城头之上，“刘”字大旗与“陶”字旗帜并列，猎猎作响。然而，城外曹军营寨连绵，围得如铁桶一般，投石车与攻城器械蓄势待发，空气中充满了大战一'
2025-09-25 23:28:08 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1179 预览='{\n  "text": "夏侯惇的怒吼被我远远甩在身后，身后烟尘滚滚，追兵的马蹄声逐渐稀疏。我不敢有丝毫懈怠，伏在马背上，人马合一，只顾催马狂奔。终于，徐州那巍峨的城郭出现在地平线上，城头之上，“刘”字大旗与“陶”字旗帜并列，猎猎作响。然而，城外曹军营寨连绵，围得如铁桶一般，投石车与攻城器械蓄势待发，空气中充满了大战一'
2025-09-25 23:28:08 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1179 预览='{\n  "text": "夏侯惇的怒吼被我远远甩在身后，身后烟尘滚滚，追兵的马蹄声逐渐稀疏。我不敢有丝毫懈怠，伏在马背上，人马合一，只顾催马狂奔。终于，徐州那巍峨的城郭出现在地平线上，城头之上，“刘”字大旗与“陶”字旗帜并列，猎猎作响。然而，城外曹军营寨连绵，围得如铁桶一般，投石车与攻城器械蓄势待发，空气中充满了大战一触即发的紧张气息。我勒马于护城河外，城墙上的守军早已发现了我这个单枪匹马的不速之'
2025-09-25 23:28:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 344
2025-09-25 23:28:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:28:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:28:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:28:08 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:28:08 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=87 parent=78 choice='不与敌将纠缠，利用突破的缺口，甩开追兵，全速奔向徐州城下，先与刘备会合为上。' rem=1
2025-09-25 23:28:08 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 趁势回马，挑战夏侯惇，斩将夺旗，以震慑曹军，扬名于徐州。
2025-09-25 23:28:34 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3315
2025-09-25 23:28:34 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1075 预览='{\n  "text": "与其狼狈奔逃，不如一战扬名！心念电转间，我猛地一勒缰绳，坐下白马人立而起，发出一声长嘶，竟硬生生止住了前冲之势。在曹军惊愕的目光中，我调转马头，银枪平举，如一道逆流的闪电，再次杀了回去！目标，正是那面“夏侯”大旗！“独眼匹夫，可识常山赵子龙！”一声暴喝响彻战场。夏侯惇见我竟敢回马，先是错愕，随即勃然大怒，挥舞大刀迎了上来。枪与刀在半空中激烈碰撞，迸射出耀眼的火花，金铁交鸣之声不绝于耳。我二人战马交错，转瞬已斗过十余回合，竟是难分高下。我的勇悍震慑了围拢的曹军，他们一时不敢上前。而远处徐州城头之上，几道身影正手搭凉棚，神情凝重地注视着这场阵前斗将，似乎在评判着什么。",'
2025-09-25 23:28:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1075 预览='{\n  "text": "与其狼狈奔逃，不如一战扬名！心念电转间，我猛地一勒缰绳，坐下白马人立而起，发出一声长嘶，竟硬生生止住了前冲之势。在曹军惊愕的目光中，我调转马头，银枪平举，如一道逆流的闪电，再次杀了回去！目标，正是那面“夏侯”大旗！“独眼匹夫，可识常山赵子龙！”一声暴喝响彻战场。夏侯惇见我竟敢回马，先是错愕，随'
2025-09-25 23:28:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1075 预览='{\n  "text": "与其狼狈奔逃，不如一战扬名！心念电转间，我猛地一勒缰绳，坐下白马人立而起，发出一声长嘶，竟硬生生止住了前冲之势。在曹军惊愕的目光中，我调转马头，银枪平举，如一道逆流的闪电，再次杀了回去！目标，正是那面“夏侯”大旗！“独眼匹夫，可识常山赵子龙！”一声暴喝响彻战场。夏侯惇见我竟敢回马，先是错愕，随'
2025-09-25 23:28:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1075 预览='{\n  "text": "与其狼狈奔逃，不如一战扬名！心念电转间，我猛地一勒缰绳，坐下白马人立而起，发出一声长嘶，竟硬生生止住了前冲之势。在曹军惊愕的目光中，我调转马头，银枪平举，如一道逆流的闪电，再次杀了回去！目标，正是那面“夏侯”大旗！“独眼匹夫，可识常山赵子龙！”一声暴喝响彻战场。夏侯惇见我竟敢回马，先是错愕，随即勃然大怒，挥舞大刀迎了上来。枪与刀在半空中激烈碰撞，迸射出耀眼的火花，金铁交鸣'
2025-09-25 23:28:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 285
2025-09-25 23:28:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:28:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:28:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:28:34 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:28:34 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=88 parent=78 choice='趁势回马，挑战夏侯惇，斩将夺旗，以震慑曹军，扬名于徐州。' rem=1
2025-09-25 23:28:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 虚晃一枪，暂避锋芒，绕道潜入附近山林，寻找当地义军或斥候，探明城防虚实再做打算。
2025-09-25 23:29:34 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3764
2025-09-25 23:29:34 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1120 预览='{\n  "text": "人马皆疲，然徐州城楼已在望，希望就在眼前！我一咬舌尖，强行压下翻涌的气血，催动战马做最后的冲刺。然而，一声暴喝如平地惊雷，一员独眼大将拍马横刀，如山岳般拦住我的去路。“吾乃沛国夏侯惇！来将何人，安敢闯我大阵！”其声如洪钟，煞气逼人。我心知此人必是曹军主将，此时若被他缠住，待身后追兵合围，必死无疑。唯有雷霆一击，方有一线生机！不再多言，我将全身残存的气力悉数贯于枪尖，人马合一，化作一道银色流星，直刺夏侯惇胸前要害。龙胆枪破空，发出尖锐的呼啸，夏侯惇亦是悍不畏死，手中大刀卷起一阵狂风，迎着枪尖猛劈而来！只听“铛”的一声巨响，金铁交鸣，火星四溅，巨大的反震之力让我双臂发麻，'
2025-09-25 23:29:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1120 预览='{\n  "text": "人马皆疲，然徐州城楼已在望，希望就在眼前！我一咬舌尖，强行压下翻涌的气血，催动战马做最后的冲刺。然而，一声暴喝如平地惊雷，一员独眼大将拍马横刀，如山岳般拦住我的去路。“吾乃沛国夏侯惇！来将何人，安敢闯我大阵！”其声如洪钟，煞气逼人。我心知此人必是曹军主将，此时若被他缠住，待身后追兵合围，必死无'
2025-09-25 23:29:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1120 预览='{\n  "text": "人马皆疲，然徐州城楼已在望，希望就在眼前！我一咬舌尖，强行压下翻涌的气血，催动战马做最后的冲刺。然而，一声暴喝如平地惊雷，一员独眼大将拍马横刀，如山岳般拦住我的去路。“吾乃沛国夏侯惇！来将何人，安敢闯我大阵！”其声如洪钟，煞气逼人。我心知此人必是曹军主将，此时若被他缠住，待身后追兵合围，必死无'
2025-09-25 23:29:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1120 预览='{\n  "text": "人马皆疲，然徐州城楼已在望，希望就在眼前！我一咬舌尖，强行压下翻涌的气血，催动战马做最后的冲刺。然而，一声暴喝如平地惊雷，一员独眼大将拍马横刀，如山岳般拦住我的去路。“吾乃沛国夏侯惇！来将何人，安敢闯我大阵！”其声如洪钟，煞气逼人。我心知此人必是曹军主将，此时若被他缠住，待身后追兵合围，必死无疑。唯有雷霆一击，方有一线生机！不再多言，我将全身残存的气力悉数贯于枪尖，人马合'
2025-09-25 23:29:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 302
2025-09-25 23:29:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:29:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:29:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:29:34 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:29:34 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=89 parent=78 choice='虚晃一枪，暂避锋芒，绕道潜入附近山林，寻找当地义军或斥候，探明城防虚实再做打算。' rem=1
2025-09-25 23:29:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 身先士卒，展露绝技，带领义勇奇袭曹军的粮草辎重队，以战功换取信任与通路。
2025-09-25 23:29:59 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3607
2025-09-25 23:29:59 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1178 预览='{\n  "text": "言语万千，不如一枪在手。我向李二详述了我的计划：夜袭曹军一支小规模的粮草辎重队。这既能夺取补给，又能试探敌军虚实，最重要的是，能让这群血性汉子亲眼见证我的能力。月黑风高，我一马当先，如鬼魅般潜近曹军宿营地。龙胆枪在月下泛着冷光，未等哨兵发出警报，枪尖已悄无声息地穿透了他的咽喉。我回身一招“回龙探爪”，将另一名惊觉的敌兵挑落马下，整个过程行云流水，寂静无声。李二等人看得目瞪口呆，随即热血上涌，随我一声低喝，如猛虎下山般冲入营中。混乱中，我枪出如龙，直取敌军押粮校尉。一番激战，我们成功截获了数车粮草，更意外的是，在一辆囚车中，我们发现了一名被俘的信使。他自称是刘备的亲兵，'
2025-09-25 23:29:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1178 预览='{\n  "text": "言语万千，不如一枪在手。我向李二详述了我的计划：夜袭曹军一支小规模的粮草辎重队。这既能夺取补给，又能试探敌军虚实，最重要的是，能让这群血性汉子亲眼见证我的能力。月黑风高，我一马当先，如鬼魅般潜近曹军宿营地。龙胆枪在月下泛着冷光，未等哨兵发出警报，枪尖已悄无声息地穿透了他的咽喉。我回身一招“回龙'
2025-09-25 23:29:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1178 预览='{\n  "text": "言语万千，不如一枪在手。我向李二详述了我的计划：夜袭曹军一支小规模的粮草辎重队。这既能夺取补给，又能试探敌军虚实，最重要的是，能让这群血性汉子亲眼见证我的能力。月黑风高，我一马当先，如鬼魅般潜近曹军宿营地。龙胆枪在月下泛着冷光，未等哨兵发出警报，枪尖已悄无声息地穿透了他的咽喉。我回身一招“回龙'
2025-09-25 23:29:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1178 预览='{\n  "text": "言语万千，不如一枪在手。我向李二详述了我的计划：夜袭曹军一支小规模的粮草辎重队。这既能夺取补给，又能试探敌军虚实，最重要的是，能让这群血性汉子亲眼见证我的能力。月黑风高，我一马当先，如鬼魅般潜近曹军宿营地。龙胆枪在月下泛着冷光，未等哨兵发出警报，枪尖已悄无声息地穿透了他的咽喉。我回身一招“回龙探爪”，将另一名惊觉的敌兵挑落马下，整个过程行云流水，寂静无声。李二等人看得目瞪'
2025-09-25 23:29:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 348
2025-09-25 23:29:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:29:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:29:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:29:59 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:29:59 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=90 parent=79 choice='身先士卒，展露绝技，带领义勇奇袭曹军的粮草辎重队，以战功换取信任与通路。' rem=1
2025-09-25 23:29:59 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 利用自己高超的武艺与胆识，单人独骑潜入曹军前哨，刺探夏侯惇的兵力部署与巡逻规律，为义勇提供关键情报。
2025-09-25 23:30:28 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3955
2025-09-25 23:30:28 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1244 预览='{\n  "text": "言语万千，不如一行动。我向李二等人颔首，未发一言，只将龙胆枪用布条裹好，负于背上，如一缕青烟没入沉沉夜色。曹军的前哨营地依河而设，灯火通明，防备森严。我伏于草丛，身形与黑暗融为一体，静待巡逻队的空隙。凭借在白马义从中练就的潜行之术，我悄然绕过外围的暗哨，如狸猫般翻入营寨。主帐内，几名军官正围着沙盘激烈讨论，我屏息凝神，从帐篷缝隙中窥探。墙上悬挂的军事地图详尽地标注了夏侯惇主力大营的布防，更令我心头一震的是，我听到他们提及一支运送攻城器械与粮草的辎重队，将于两日后经由“白杨渡”抵达。这正是他们的软肋！我将关键信息牢记于心，正欲悄然退去，一名巡夜的校尉却恰好行至帐前。我心'
2025-09-25 23:30:28 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1244 预览='{\n  "text": "言语万千，不如一行动。我向李二等人颔首，未发一言，只将龙胆枪用布条裹好，负于背上，如一缕青烟没入沉沉夜色。曹军的前哨营地依河而设，灯火通明，防备森严。我伏于草丛，身形与黑暗融为一体，静待巡逻队的空隙。凭借在白马义从中练就的潜行之术，我悄然绕过外围的暗哨，如狸猫般翻入营寨。主帐内，几名军官正围着'
2025-09-25 23:30:28 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1244 预览='{\n  "text": "言语万千，不如一行动。我向李二等人颔首，未发一言，只将龙胆枪用布条裹好，负于背上，如一缕青烟没入沉沉夜色。曹军的前哨营地依河而设，灯火通明，防备森严。我伏于草丛，身形与黑暗融为一体，静待巡逻队的空隙。凭借在白马义从中练就的潜行之术，我悄然绕过外围的暗哨，如狸猫般翻入营寨。主帐内，几名军官正围着'
2025-09-25 23:30:28 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1244 预览='{\n  "text": "言语万千，不如一行动。我向李二等人颔首，未发一言，只将龙胆枪用布条裹好，负于背上，如一缕青烟没入沉沉夜色。曹军的前哨营地依河而设，灯火通明，防备森严。我伏于草丛，身形与黑暗融为一体，静待巡逻队的空隙。凭借在白马义从中练就的潜行之术，我悄然绕过外围的暗哨，如狸猫般翻入营寨。主帐内，几名军官正围着沙盘激烈讨论，我屏息凝神，从帐篷缝隙中窥探。墙上悬挂的军事地图详尽地标注了夏侯惇'
2025-09-25 23:30:28 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 361
2025-09-25 23:30:28 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:30:28 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:30:28 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:30:28 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:30:28 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=91 parent=79 choice='利用自己高超的武艺与胆识，单人独骑潜入曹军前哨，刺探夏侯惇的兵力部署与巡逻规律，为义勇提供关键情报。' rem=1
2025-09-25 23:30:28 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 暂缓军事行动，转而凭借自己的名声与言辞，游说附近其他村落的抵抗力量，将零散的义勇整合起来，形成一股更强大的合力。
2025-09-25 23:31:43 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:32:26 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3685
2025-09-25 23:32:26 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1096 预览='{\n  "text": "我深知匹夫之勇难成大事。告别李二众人，我开始在徐州乡野间奔走。曹军的暴行固然激起了同仇敌忾，但也让各村寨的义勇如同惊弓之鸟，各自为战，互不信任。我的‘常山赵子龙’之名虽有一些分量，但在这血与火的土地上，言语终究显得苍白。在郯县附近，我听闻徐州富商糜氏兄弟正在组织力量，他们的船队控制着泗水的水路，囤积了大量粮草。然而，当我找到其弟糜芳驻守的坞堡时，却被拒之门外。糜芳生性多疑，将我视作袁绍或曹操派来的奸细。他言辞激烈，称除非我能拿出足以让他信服的‘投名状’，否则休想让他交出一粒粮食、一个兵丁。",\n  "success_rate": 68,\n  "choices": [\n'
2025-09-25 23:32:26 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1096 预览='{\n  "text": "我深知匹夫之勇难成大事。告别李二众人，我开始在徐州乡野间奔走。曹军的暴行固然激起了同仇敌忾，但也让各村寨的义勇如同惊弓之鸟，各自为战，互不信任。我的‘常山赵子龙’之名虽有一些分量，但在这血与火的土地上，言语终究显得苍白。在郯县附近，我听闻徐州富商糜氏兄弟正在组织力量，他们的船队控制着泗水的水路'
2025-09-25 23:32:26 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1096 预览='{\n  "text": "我深知匹夫之勇难成大事。告别李二众人，我开始在徐州乡野间奔走。曹军的暴行固然激起了同仇敌忾，但也让各村寨的义勇如同惊弓之鸟，各自为战，互不信任。我的‘常山赵子龙’之名虽有一些分量，但在这血与火的土地上，言语终究显得苍白。在郯县附近，我听闻徐州富商糜氏兄弟正在组织力量，他们的船队控制着泗水的水路'
2025-09-25 23:32:26 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1096 预览='{\n  "text": "我深知匹夫之勇难成大事。告别李二众人，我开始在徐州乡野间奔走。曹军的暴行固然激起了同仇敌忾，但也让各村寨的义勇如同惊弓之鸟，各自为战，互不信任。我的‘常山赵子龙’之名虽有一些分量，但在这血与火的土地上，言语终究显得苍白。在郯县附近，我听闻徐州富商糜氏兄弟正在组织力量，他们的船队控制着泗水的水路，囤积了大量粮草。然而，当我找到其弟糜芳驻守的坞堡时，却被拒之门外。糜芳生性多疑'
2025-09-25 23:32:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 247
2025-09-25 23:32:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:32:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:32:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:32:26 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:32:26 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=92 parent=79 choice='暂缓军事行动，转而凭借自己的名声与言辞，游说附近其他村落的抵抗力量，将零散的义勇整合起来，形成一股更强大的合力。' rem=1
2025-09-25 23:32:26 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 亮出武艺，强行闯关。以雷霆之势震慑对方，证明自己并非鼠辈，也非曹军鹰犬。
2025-09-25 23:32:54 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3664
2025-09-25 23:32:54 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1107 预览='{\n  "text": "言语无益，唯枪可证我心！我不再多言，龙胆枪一抖，化作一道银色闪电，直刺为首大汉。他横刀格挡，却只觉一股巨力从刀身传来，虎口剧震，长刀险些脱手。我枪尖一转，并未伤他，而是顺势一带，枪杆已贴上他胸口，只需寸进便可取其性命。其余乡勇见状蜂拥而上，我长枪舞动，如游龙穿梭，只听“叮当”之声不绝于耳，不过数息之间，他们手中的兵刃便尽数被我挑飞，散落一地。我收枪而立，并未伤一人。那为首的壮汉满脸惊骇，随即化为敬佩，他扔下长刀，抱拳道：“壮士好身手！且有此仁心，绝非曹贼鹰犬！在下陈到，率乡人在此阻击曹军，多有得罪，还望恕罪！”他告知我，前方通往郯城的必经之路琅琊关，由曹将吕虔率数百人'
2025-09-25 23:32:54 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1107 预览='{\n  "text": "言语无益，唯枪可证我心！我不再多言，龙胆枪一抖，化作一道银色闪电，直刺为首大汉。他横刀格挡，却只觉一股巨力从刀身传来，虎口剧震，长刀险些脱手。我枪尖一转，并未伤他，而是顺势一带，枪杆已贴上他胸口，只需寸进便可取其性命。其余乡勇见状蜂拥而上，我长枪舞动，如游龙穿梭，只听“叮当”之声不绝于耳，不过'
2025-09-25 23:32:54 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1107 预览='{\n  "text": "言语无益，唯枪可证我心！我不再多言，龙胆枪一抖，化作一道银色闪电，直刺为首大汉。他横刀格挡，却只觉一股巨力从刀身传来，虎口剧震，长刀险些脱手。我枪尖一转，并未伤他，而是顺势一带，枪杆已贴上他胸口，只需寸进便可取其性命。其余乡勇见状蜂拥而上，我长枪舞动，如游龙穿梭，只听“叮当”之声不绝于耳，不过'
2025-09-25 23:32:54 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1107 预览='{\n  "text": "言语无益，唯枪可证我心！我不再多言，龙胆枪一抖，化作一道银色闪电，直刺为首大汉。他横刀格挡，却只觉一股巨力从刀身传来，虎口剧震，长刀险些脱手。我枪尖一转，并未伤他，而是顺势一带，枪杆已贴上他胸口，只需寸进便可取其性命。其余乡勇见状蜂拥而上，我长枪舞动，如游龙穿梭，只听“叮当”之声不绝于耳，不过数息之间，他们手中的兵刃便尽数被我挑飞，散落一地。我收枪而立，并未伤一人。那为首'
2025-09-25 23:32:54 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 332
2025-09-25 23:32:54 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:32:54 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:32:54 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:32:54 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:32:54 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=93 parent=80 choice='亮出武艺，强行闯关。以雷霆之势震慑对方，证明自己并非鼠辈，也非曹军鹰犬。' rem=1
2025-09-25 23:32:54 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 冷静交涉，探查其困境。主动提出帮助他们侦察附近曹军的动向，以此作为交换，换取通行的信任。
2025-09-25 23:33:22 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3726
2025-09-25 23:33:22 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1152 预览='{\n  "text": "我缓缓将龙胆枪的枪尖垂下，枪尾顿地，发出沉闷的响声，示意自己并无敌意。“各位壮士，在下常山赵云。”我抱拳朗声道，“此行并非投曹，亦非背公孙，只为奔丧路过此地，欲往徐州投奔刘豫州，共抗曹贼。”那魁梧首领，自称陈大牛，将信将疑地打量着我与我的良驹。“口说无凭，谁知你不是曹军派来赚开山门的奸细？”我坦然迎向他的目光：“将军之疑，在情理之中。曹军暴行，人神共愤。赵云愿为诸位做一事，以证我心。我可代为前出侦察，探明前方曹军夏侯惇部的虚实，特别是其粮道所在。若能断其补给，必能解此地之围。”陈大牛与身边的乡勇们交换了一下眼神，眼中的敌意稍减。他指向东南方的一处山隘：“五里外的黑风口'
2025-09-25 23:33:22 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1152 预览='{\n  "text": "我缓缓将龙胆枪的枪尖垂下，枪尾顿地，发出沉闷的响声，示意自己并无敌意。“各位壮士，在下常山赵云。”我抱拳朗声道，“此行并非投曹，亦非背公孙，只为奔丧路过此地，欲往徐州投奔刘豫州，共抗曹贼。”那魁梧首领，自称陈大牛，将信将疑地打量着我与我的良驹。“口说无凭，谁知你不是曹军派来赚开山门的奸细？”我'
2025-09-25 23:33:22 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1152 预览='{\n  "text": "我缓缓将龙胆枪的枪尖垂下，枪尾顿地，发出沉闷的响声，示意自己并无敌意。“各位壮士，在下常山赵云。”我抱拳朗声道，“此行并非投曹，亦非背公孙，只为奔丧路过此地，欲往徐州投奔刘豫州，共抗曹贼。”那魁梧首领，自称陈大牛，将信将疑地打量着我与我的良驹。“口说无凭，谁知你不是曹军派来赚开山门的奸细？”我'
2025-09-25 23:33:22 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1152 预览='{\n  "text": "我缓缓将龙胆枪的枪尖垂下，枪尾顿地，发出沉闷的响声，示意自己并无敌意。“各位壮士，在下常山赵云。”我抱拳朗声道，“此行并非投曹，亦非背公孙，只为奔丧路过此地，欲往徐州投奔刘豫州，共抗曹贼。”那魁梧首领，自称陈大牛，将信将疑地打量着我与我的良驹。“口说无凭，谁知你不是曹军派来赚开山门的奸细？”我坦然迎向他的目光：“将军之疑，在情理之中。曹军暴行，人神共愤。赵云愿为诸位做一事'
2025-09-25 23:33:22 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 337
2025-09-25 23:33:22 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:33:22 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:33:22 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:33:22 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:33:22 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=94 parent=80 choice='冷静交涉，探查其困境。主动提出帮助他们侦察附近曹军的动向，以此作为交换，换取通行的信任。' rem=1
2025-09-25 23:33:22 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 暂时后撤，在附近隐蔽观察。等待时机，或寻找其他无人防守的小路，避免与这股地方武装发生任何接触。
2025-09-25 23:33:49 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3773
2025-09-25 23:33:49 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1135 预览='{\n  "text": "我依言向东折转，沿着泰山山脉的南麓继续前行。山路愈发崎岖，夜色渐浓，林中不时传来野兽的低吼，为这趟孤寂的旅程更添几分凶险。行至一处背风的山坳，远方微弱的火光引起了我的警觉。我悄然下马，将“夜照玉狮子”藏于密林深处，随后屏息凝神，如狸猫般向火光处摸去。拨开最后一丛灌木，只见一小队约莫十人的曹军士卒正围着篝火休整。他们甲胄精良，兵刃锋利，坐姿沉稳，警惕地观察着四周，绝非寻常兵痞，倒像是传说中曹操的精锐“虎豹骑”。其中一名小校正摊开一张羊皮地图，与身边几人低声讨论着什么，手指在地图上划过几条隐秘的山道。那地图，无疑是我此刻最需要的东西。但同时，这支小队的精悍也意味着一旦动手'
2025-09-25 23:33:49 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1135 预览='{\n  "text": "我依言向东折转，沿着泰山山脉的南麓继续前行。山路愈发崎岖，夜色渐浓，林中不时传来野兽的低吼，为这趟孤寂的旅程更添几分凶险。行至一处背风的山坳，远方微弱的火光引起了我的警觉。我悄然下马，将“夜照玉狮子”藏于密林深处，随后屏息凝神，如狸猫般向火光处摸去。拨开最后一丛灌木，只见一小队约莫十人的曹军士'
2025-09-25 23:33:49 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1135 预览='{\n  "text": "我依言向东折转，沿着泰山山脉的南麓继续前行。山路愈发崎岖，夜色渐浓，林中不时传来野兽的低吼，为这趟孤寂的旅程更添几分凶险。行至一处背风的山坳，远方微弱的火光引起了我的警觉。我悄然下马，将“夜照玉狮子”藏于密林深处，随后屏息凝神，如狸猫般向火光处摸去。拨开最后一丛灌木，只见一小队约莫十人的曹军士'
2025-09-25 23:33:49 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1135 预览='{\n  "text": "我依言向东折转，沿着泰山山脉的南麓继续前行。山路愈发崎岖，夜色渐浓，林中不时传来野兽的低吼，为这趟孤寂的旅程更添几分凶险。行至一处背风的山坳，远方微弱的火光引起了我的警觉。我悄然下马，将“夜照玉狮子”藏于密林深处，随后屏息凝神，如狸猫般向火光处摸去。拨开最后一丛灌木，只见一小队约莫十人的曹军士卒正围着篝火休整。他们甲胄精良，兵刃锋利，坐姿沉稳，警惕地观察着四周，绝非寻常兵'
2025-09-25 23:33:49 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 323
2025-09-25 23:33:49 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:33:49 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:33:49 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:33:49 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:33:49 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=95 parent=80 choice='暂时后撤，在附近隐蔽观察。等待时机，或寻找其他无人防守的小路，避免与这股地方武装发生任何接触。' rem=1
2025-09-25 23:33:49 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 接受县令裴元绍的宴请，利用官方身份整合力量，建立地方武装，徐图后计。
2025-09-25 23:34:10 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3228
2025-09-25 23:34:10 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1049 预览='{\n  "text": "县衙的宴席，远比我想象中要复杂。县令裴元绍并非庸碌之辈，他言谈间对我推崇备至，却又句句不离河北的袁绍大军，暗示常山郡已是其囊中之物。酒过三巡，他终于图穷匕见，当众取出一纸委任状，要任命我为真定县的乡勇都头，统领三百乡勇，负责清剿周边贼寇。这看似是知人善任的提拔，但我从他眼底深处看到了一丝算计。这乡勇都头，是保境安民的利器，还是将我绑上袁绍战车的枷锁？堂下，是他安排的亲信武官，目光灼灼；堂外，是闻讯而来的乡绅名流，翘首以盼。这一杯酒，接与不接，都重如千斤。",\n  "success_rate": 75,\n  "choices": [\n    {\n      "optio'
2025-09-25 23:34:10 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1049 预览='{\n  "text": "县衙的宴席，远比我想象中要复杂。县令裴元绍并非庸碌之辈，他言谈间对我推崇备至，却又句句不离河北的袁绍大军，暗示常山郡已是其囊中之物。酒过三巡，他终于图穷匕见，当众取出一纸委任状，要任命我为真定县的乡勇都头，统领三百乡勇，负责清剿周边贼寇。这看似是知人善任的提拔，但我从他眼底深处看到了一丝算计。'
2025-09-25 23:34:10 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1049 预览='{\n  "text": "县衙的宴席，远比我想象中要复杂。县令裴元绍并非庸碌之辈，他言谈间对我推崇备至，却又句句不离河北的袁绍大军，暗示常山郡已是其囊中之物。酒过三巡，他终于图穷匕见，当众取出一纸委任状，要任命我为真定县的乡勇都头，统领三百乡勇，负责清剿周边贼寇。这看似是知人善任的提拔，但我从他眼底深处看到了一丝算计。'
2025-09-25 23:34:10 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1049 预览='{\n  "text": "县衙的宴席，远比我想象中要复杂。县令裴元绍并非庸碌之辈，他言谈间对我推崇备至，却又句句不离河北的袁绍大军，暗示常山郡已是其囊中之物。酒过三巡，他终于图穷匕见，当众取出一纸委任状，要任命我为真定县的乡勇都头，统领三百乡勇，负责清剿周边贼寇。这看似是知人善任的提拔，但我从他眼底深处看到了一丝算计。这乡勇都头，是保境安民的利器，还是将我绑上袁绍战车的枷锁？堂下，是他安排的亲信武'
2025-09-25 23:34:10 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 229
2025-09-25 23:34:10 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:34:10 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:34:10 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:34:10 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:34:10 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=96 parent=81 choice='接受县令裴元绍的宴请，利用官方身份整合力量，建立地方武装，徐图后计。' rem=1
2025-09-25 23:34:10 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 乘胜追击，联络乡勇，主动清剿逃窜的匪首及其残部，永绝后患。
2025-09-25 23:34:34 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3493
2025-09-25 23:34:34 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1182 预览='{\n  "text": "我的名声如同燎原之火，迅速传遍了常山四野。乡中热血青年纷纷前来投效，不过三日，我便聚集起一支五百余人的乡勇队伍。士气可用，我不再迟疑，立刻根据从俘虏口中问出的线索，对逃窜的黑山军残部展开追剿。我们沿着滹沱河一路向东，连破三处贼寇藏身的林中暗寨，斩其首领，余者皆降。然而，就在我们于一处山谷休整，准备收兵回乡之时，我敏锐地察觉到了窥探的目光。几名斥候打扮的士卒在远处的山脊上一闪而过，他们盔甲的样式，绝非寻常流寇，而是袁绍麾下的精锐。我心中一凛，此地已是冀州与幽州的边界，我们的行动显然已经惊动了这位河北霸主。斩草除根的快意迅速被一股寒意取代，我虽为乡里除害，但在袁绍眼中，一'
2025-09-25 23:34:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1182 预览='{\n  "text": "我的名声如同燎原之火，迅速传遍了常山四野。乡中热血青年纷纷前来投效，不过三日，我便聚集起一支五百余人的乡勇队伍。士气可用，我不再迟疑，立刻根据从俘虏口中问出的线索，对逃窜的黑山军残部展开追剿。我们沿着滹沱河一路向东，连破三处贼寇藏身的林中暗寨，斩其首领，余者皆降。然而，就在我们于一处山谷休整，'
2025-09-25 23:34:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1182 预览='{\n  "text": "我的名声如同燎原之火，迅速传遍了常山四野。乡中热血青年纷纷前来投效，不过三日，我便聚集起一支五百余人的乡勇队伍。士气可用，我不再迟疑，立刻根据从俘虏口中问出的线索，对逃窜的黑山军残部展开追剿。我们沿着滹沱河一路向东，连破三处贼寇藏身的林中暗寨，斩其首领，余者皆降。然而，就在我们于一处山谷休整，'
2025-09-25 23:34:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1182 预览='{\n  "text": "我的名声如同燎原之火，迅速传遍了常山四野。乡中热血青年纷纷前来投效，不过三日，我便聚集起一支五百余人的乡勇队伍。士气可用，我不再迟疑，立刻根据从俘虏口中问出的线索，对逃窜的黑山军残部展开追剿。我们沿着滹沱河一路向东，连破三处贼寇藏身的林中暗寨，斩其首领，余者皆降。然而，就在我们于一处山谷休整，准备收兵回乡之时，我敏锐地察觉到了窥探的目光。几名斥候打扮的士卒在远处的山脊上一'
2025-09-25 23:34:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 341
2025-09-25 23:34:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:34:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:34:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:34:34 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:34:34 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=97 parent=81 choice='乘胜追击，联络乡勇，主动清剿逃窜的匪首及其残部，永绝后患。' rem=1
2025-09-25 23:34:34 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 利用威望，组织乡里青壮，修筑坞堡，结寨自保，稳固根基。
2025-09-25 23:35:00 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3383
2025-09-25 23:35:00 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1141 预览='{\n  "text": "单骑破贼的威名，如同投入湖中的巨石，在常山乃至整个冀州都激起了层层涟漪。我趁势而为，振臂一呼，乡中青壮云集响应。我们伐木为栅，掘土为墙，不出半月，一座坚固的坞堡便在真定城外拔地而起。我将家传枪法倾囊相授，日夜操练乡勇，一支数百人的精锐民团初具雏形，乡里人心大定。然而，树大招风。这番动静终究没能瞒过河北之主袁绍的耳目。一日，一队甲胄精良的兵马护送着一名使者来到坞堡前，来者自称是袁绍麾下别驾田丰，奉主公之命，特来征辟我为“别部司马”，并赐金百两，绢百匹。田丰言辞间虽客气，但眼神中的审视与不容置疑，却透露出袁绍的真实意图：要么归顺，要么……被剿灭。坞堡内刚刚安定的民心，瞬间'
2025-09-25 23:35:00 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1141 预览='{\n  "text": "单骑破贼的威名，如同投入湖中的巨石，在常山乃至整个冀州都激起了层层涟漪。我趁势而为，振臂一呼，乡中青壮云集响应。我们伐木为栅，掘土为墙，不出半月，一座坚固的坞堡便在真定城外拔地而起。我将家传枪法倾囊相授，日夜操练乡勇，一支数百人的精锐民团初具雏形，乡里人心大定。然而，树大招风。这番动静终究没能'
2025-09-25 23:35:00 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1141 预览='{\n  "text": "单骑破贼的威名，如同投入湖中的巨石，在常山乃至整个冀州都激起了层层涟漪。我趁势而为，振臂一呼，乡中青壮云集响应。我们伐木为栅，掘土为墙，不出半月，一座坚固的坞堡便在真定城外拔地而起。我将家传枪法倾囊相授，日夜操练乡勇，一支数百人的精锐民团初具雏形，乡里人心大定。然而，树大招风。这番动静终究没能'
2025-09-25 23:35:00 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1141 预览='{\n  "text": "单骑破贼的威名，如同投入湖中的巨石，在常山乃至整个冀州都激起了层层涟漪。我趁势而为，振臂一呼，乡中青壮云集响应。我们伐木为栅，掘土为墙，不出半月，一座坚固的坞堡便在真定城外拔地而起。我将家传枪法倾囊相授，日夜操练乡勇，一支数百人的精锐民团初具雏形，乡里人心大定。然而，树大招风。这番动静终究没能瞒过河北之主袁绍的耳目。一日，一队甲胄精良的兵马护送着一名使者来到坞堡前，来者自'
2025-09-25 23:35:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 308
2025-09-25 23:35:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:35:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:35:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:35:00 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:35:00 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=98 parent=81 choice='利用威望，组织乡里青壮，修筑坞堡，结寨自保，稳固根基。' rem=1
2025-09-25 23:35:00 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 亲自担任诱饵，引蛇出洞，将黑山军主力引入青石峪包围圈，毕其功于一役。
2025-09-25 23:35:24 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3418
2025-09-25 23:35:24 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=988 预览='{\n  "text": "县令的犹豫动摇不了我的决心。与其坐等粮草，不如主动出击，以战养战！我决定亲自担任诱饵，带领百名精骑，手持缴获的官军旗帜，伪装成押送粮草的队伍，大摇大摆地向青石峪行进。不出所料，潜伏在山林中的黑山军斥候发现了我们。半日后，尘土飞扬，一支数倍于我的敌军从谷口涌出，为首的渠帅面带刺青，手持开山大斧，正是黑山悍将杜长。他见我方人少，装备“精良”，眼中满是贪婪。“留下粮草和兵器，饶尔等不死！”杜长高声喝道。我冷笑一声，将龙胆枪猛地一顿，枪尖直指苍穹。这便是信号！霎时间，埋伏在两侧山坡上的义军擂鼓呐喊，无数滚石檑木倾泻而下，黑山军顿时阵脚大乱。包围圈，已然形成！",\n  "suc'
2025-09-25 23:35:24 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=988 预览='{\n  "text": "县令的犹豫动摇不了我的决心。与其坐等粮草，不如主动出击，以战养战！我决定亲自担任诱饵，带领百名精骑，手持缴获的官军旗帜，伪装成押送粮草的队伍，大摇大摆地向青石峪行进。不出所料，潜伏在山林中的黑山军斥候发现了我们。半日后，尘土飞扬，一支数倍于我的敌军从谷口涌出，为首的渠帅面带刺青，手持开山大斧，'
2025-09-25 23:35:24 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=988 预览='{\n  "text": "县令的犹豫动摇不了我的决心。与其坐等粮草，不如主动出击，以战养战！我决定亲自担任诱饵，带领百名精骑，手持缴获的官军旗帜，伪装成押送粮草的队伍，大摇大摆地向青石峪行进。不出所料，潜伏在山林中的黑山军斥候发现了我们。半日后，尘土飞扬，一支数倍于我的敌军从谷口涌出，为首的渠帅面带刺青，手持开山大斧，'
2025-09-25 23:35:24 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=988 预览='{\n  "text": "县令的犹豫动摇不了我的决心。与其坐等粮草，不如主动出击，以战养战！我决定亲自担任诱饵，带领百名精骑，手持缴获的官军旗帜，伪装成押送粮草的队伍，大摇大摆地向青石峪行进。不出所料，潜伏在山林中的黑山军斥候发现了我们。半日后，尘土飞扬，一支数倍于我的敌军从谷口涌出，为首的渠帅面带刺青，手持开山大斧，正是黑山悍将杜长。他见我方人少，装备“精良”，眼中满是贪婪。“留下粮草和兵器，饶'
2025-09-25 23:35:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 278
2025-09-25 23:35:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:35:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:35:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:35:24 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:35:24 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=99 parent=82 choice='亲自担任诱饵，引蛇出洞，将黑山军主力引入青石峪包围圈，毕其功于一役。' rem=1
2025-09-25 23:35:24 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 分兵骚扰，断其粮道，同时派夏侯兰去说服县令，以乡绅名义施压，争取官方支持，稳扎稳打。
2025-09-25 23:35:53 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3917
2025-09-25 23:35:53 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1108 预览='{\n  "text": "计划如齿轮般精准咬合。我亲率五十精骑，如鬼魅般穿行于常山的山林之间。黑山军的斥候和粮队在我们神出鬼没的袭扰下疲于奔命，数日之内，他们便陷入了补给匮乏的窘境。一次夜袭中，我们截获了一支重要的辎重队。然而，在缴获的物资中，我发现了一卷密封的竹简，上面的火漆印记并非寻常山匪所能拥有。展开一看，竟是与冀州某位大族家宰的书信，信中不仅提及粮草资助，更许诺事成之后给予‘校尉’之职！这伙流寇背后，竟有袁绍麾下的势力在暗中操盘，意图搅乱公孙瓒的后方。与此同时，夏侯兰也传来消息，县令在乡绅的压力下态度有所松动，但看到这封密信的抄本后，却又变得惊恐万状，唯恐引火烧身。局势瞬间变得复杂，这'
2025-09-25 23:35:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1108 预览='{\n  "text": "计划如齿轮般精准咬合。我亲率五十精骑，如鬼魅般穿行于常山的山林之间。黑山军的斥候和粮队在我们神出鬼没的袭扰下疲于奔命，数日之内，他们便陷入了补给匮乏的窘境。一次夜袭中，我们截获了一支重要的辎重队。然而，在缴获的物资中，我发现了一卷密封的竹简，上面的火漆印记并非寻常山匪所能拥有。展开一看，竟是与'
2025-09-25 23:35:53 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1108 预览='{\n  "text": "计划如齿轮般精准咬合。我亲率五十精骑，如鬼魅般穿行于常山的山林之间。黑山军的斥候和粮队在我们神出鬼没的袭扰下疲于奔命，数日之内，他们便陷入了补给匮乏的窘境。一次夜袭中，我们截获了一支重要的辎重队。然而，在缴获的物资中，我发现了一卷密封的竹简，上面的火漆印记并非寻常山匪所能拥有。展开一看，竟是与'
2025-09-25 23:35:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1108 预览='{\n  "text": "计划如齿轮般精准咬合。我亲率五十精骑，如鬼魅般穿行于常山的山林之间。黑山军的斥候和粮队在我们神出鬼没的袭扰下疲于奔命，数日之内，他们便陷入了补给匮乏的窘境。一次夜袭中，我们截获了一支重要的辎重队。然而，在缴获的物资中，我发现了一卷密封的竹简，上面的火漆印记并非寻常山匪所能拥有。展开一看，竟是与冀州某位大族家宰的书信，信中不仅提及粮草资助，更许诺事成之后给予‘校尉’之职！这'
2025-09-25 23:35:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 312
2025-09-25 23:35:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:35:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:35:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:35:53 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:35:53 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=100 parent=82 choice='分兵骚扰，断其粮道，同时派夏侯兰去说服县令，以乡绅名义施压，争取官方支持，稳扎稳打。' rem=1
2025-09-25 23:35:53 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 绕开县令，直接联络乡中大户筹集粮草，然后以小股部队袭扰贼寇侧翼，不求歼敌，只求将其惊走。
2025-09-25 23:36:53 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 4044
2025-09-25 23:36:53 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1082 预览='{\n  "text": "县令畏首畏尾，我便不再指望。真定乡中多有忠义之士，听闻我欲讨贼保境，纷纷解囊相助，粮草军械很快便筹措齐备。我挑选百余精骑，效仿昔日白马义从之术，不与贼寇主力纠缠，只在其粮道、侧翼忽进忽退，昼夜袭扰。贼寇不堪其扰，数日后便拔营西去，乡里暂得安宁。然而，‘赵子龙’之名不胫而走，却也引来了意想不到的注视。冀州牧袁绍的使者竟带着其外甥、并州刺史高干的亲笔信寻上门来。信中对我颇多赞誉，并许以军中司马之职，邀我前往晋阳共谋大事。袁氏四世三公，门生故吏遍布天下，此刻的声势远非刘备可比。这份突如其来的招揽，让我的内心再次泛起波澜。",\n  "success_rate": 68,\n  '
2025-09-25 23:36:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1082 预览='{\n  "text": "县令畏首畏尾，我便不再指望。真定乡中多有忠义之士，听闻我欲讨贼保境，纷纷解囊相助，粮草军械很快便筹措齐备。我挑选百余精骑，效仿昔日白马义从之术，不与贼寇主力纠缠，只在其粮道、侧翼忽进忽退，昼夜袭扰。贼寇不堪其扰，数日后便拔营西去，乡里暂得安宁。然而，‘赵子龙’之名不胫而走，却也引来了意想不到的'
2025-09-25 23:36:53 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1082 预览='{\n  "text": "县令畏首畏尾，我便不再指望。真定乡中多有忠义之士，听闻我欲讨贼保境，纷纷解囊相助，粮草军械很快便筹措齐备。我挑选百余精骑，效仿昔日白马义从之术，不与贼寇主力纠缠，只在其粮道、侧翼忽进忽退，昼夜袭扰。贼寇不堪其扰，数日后便拔营西去，乡里暂得安宁。然而，‘赵子龙’之名不胫而走，却也引来了意想不到的'
2025-09-25 23:36:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1082 预览='{\n  "text": "县令畏首畏尾，我便不再指望。真定乡中多有忠义之士，听闻我欲讨贼保境，纷纷解囊相助，粮草军械很快便筹措齐备。我挑选百余精骑，效仿昔日白马义从之术，不与贼寇主力纠缠，只在其粮道、侧翼忽进忽退，昼夜袭扰。贼寇不堪其扰，数日后便拔营西去，乡里暂得安宁。然而，‘赵子龙’之名不胫而走，却也引来了意想不到的注视。冀州牧袁绍的使者竟带着其外甥、并州刺史高干的亲笔信寻上门来。信中对我颇多赞'
2025-09-25 23:36:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 260
2025-09-25 23:36:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:36:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:36:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:36:53 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:36:53 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=101 parent=82 choice='绕开县令，直接联络乡中大户筹集粮草，然后以小股部队袭扰贼寇侧翼，不求歼敌，只求将其惊走。' rem=1
2025-09-25 23:36:53 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 主动出击，夜袭黑山军营寨，擒贼先擒王，以雷霆手段瓦解其攻势。
2025-09-25 23:37:20 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3799
2025-09-25 23:37:20 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=974 预览='{\n  "text": "是夜，月黑风高。我亲率五十名精锐乡勇，如鬼魅般潜入黑山军的营寨。龙胆枪寒光一闪，哨兵应声而倒。火矢射入粮草堆，瞬间燃起熊熊大火，营中大乱。我直扑中军大帐，一脚踹开帐门，却只见一名副将惊慌失措，主帅张燕早已不见踪影。然而，在副将身旁的兵器架上，我赫然发现数柄制式长戟，戟身上竟烙着袁绍麾下大将麴义的私印！这伙流寇，绝非乌合之众，背后竟有河北霸主的影子。乱军之中，我生擒了那名副将，缴获了一封密信，趁着夜色迅速撤回坞堡。",\n  "success_rate": 70,\n  "choices": [\n    {\n      "option": "审问副将，解读密信，优先弄清麴义'
2025-09-25 23:37:20 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=974 预览='{\n  "text": "是夜，月黑风高。我亲率五十名精锐乡勇，如鬼魅般潜入黑山军的营寨。龙胆枪寒光一闪，哨兵应声而倒。火矢射入粮草堆，瞬间燃起熊熊大火，营中大乱。我直扑中军大帐，一脚踹开帐门，却只见一名副将惊慌失措，主帅张燕早已不见踪影。然而，在副将身旁的兵器架上，我赫然发现数柄制式长戟，戟身上竟烙着袁绍麾下大将麴义'
2025-09-25 23:37:20 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=974 预览='{\n  "text": "是夜，月黑风高。我亲率五十名精锐乡勇，如鬼魅般潜入黑山军的营寨。龙胆枪寒光一闪，哨兵应声而倒。火矢射入粮草堆，瞬间燃起熊熊大火，营中大乱。我直扑中军大帐，一脚踹开帐门，却只见一名副将惊慌失措，主帅张燕早已不见踪影。然而，在副将身旁的兵器架上，我赫然发现数柄制式长戟，戟身上竟烙着袁绍麾下大将麴义'
2025-09-25 23:37:20 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=974 预览='{\n  "text": "是夜，月黑风高。我亲率五十名精锐乡勇，如鬼魅般潜入黑山军的营寨。龙胆枪寒光一闪，哨兵应声而倒。火矢射入粮草堆，瞬间燃起熊熊大火，营中大乱。我直扑中军大帐，一脚踹开帐门，却只见一名副将惊慌失措，主帅张燕早已不见踪影。然而，在副将身旁的兵器架上，我赫然发现数柄制式长戟，戟身上竟烙着袁绍麾下大将麴义的私印！这伙流寇，绝非乌合之众，背后竟有河北霸主的影子。乱军之中，我生擒了那名副'
2025-09-25 23:37:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 208
2025-09-25 23:37:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:37:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:37:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:37:20 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:37:20 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=102 parent=83 choice='主动出击，夜袭黑山军营寨，擒贼先擒王，以雷霆手段瓦解其攻势。' rem=1
2025-09-25 23:37:20 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 坚守坞堡，凭借地利消耗敌军锐气，同时派遣信使向常山郡府求援，寄望于官军介入。
2025-09-25 23:37:44 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3285
2025-09-25 23:37:44 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1109 预览='{\n  "text": "坞堡的木门在黑山军的叫嚣声中微微颤抖，三日期限已至。张燕并未立即攻打，而是采取了更为阴险的围困之策，断我水源，扰我心神。堡内人心浮动，存粮虽足，但饮水日渐短缺。夏侯兰趁夜色潜回，带来了两条关键情报：其一，围困我部的黑山军头目并非张燕本人，而是其麾下悍将杨凤，此人勇猛但贪财，与张燕素有不睦；其二，常山郡守畏惧黑山军势大，已下令各县坚壁清野，所谓的“官军”断无来援的可能。希望彻底断绝，绝境之中，我抚摸着冰冷的枪杆，知道必须在敌人耐心耗尽前，为全族杀出一条生路。窗外，火把连天，将黑夜映成一片血色，杨凤的最后通牒已在门外喊响：明日午时，不降则屠。",\n  "success_r'
2025-09-25 23:37:44 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1109 预览='{\n  "text": "坞堡的木门在黑山军的叫嚣声中微微颤抖，三日期限已至。张燕并未立即攻打，而是采取了更为阴险的围困之策，断我水源，扰我心神。堡内人心浮动，存粮虽足，但饮水日渐短缺。夏侯兰趁夜色潜回，带来了两条关键情报：其一，围困我部的黑山军头目并非张燕本人，而是其麾下悍将杨凤，此人勇猛但贪财，与张燕素有不睦；其二'
2025-09-25 23:37:44 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1109 预览='{\n  "text": "坞堡的木门在黑山军的叫嚣声中微微颤抖，三日期限已至。张燕并未立即攻打，而是采取了更为阴险的围困之策，断我水源，扰我心神。堡内人心浮动，存粮虽足，但饮水日渐短缺。夏侯兰趁夜色潜回，带来了两条关键情报：其一，围困我部的黑山军头目并非张燕本人，而是其麾下悍将杨凤，此人勇猛但贪财，与张燕素有不睦；其二'
2025-09-25 23:37:44 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1109 预览='{\n  "text": "坞堡的木门在黑山军的叫嚣声中微微颤抖，三日期限已至。张燕并未立即攻打，而是采取了更为阴险的围困之策，断我水源，扰我心神。堡内人心浮动，存粮虽足，但饮水日渐短缺。夏侯兰趁夜色潜回，带来了两条关键情报：其一，围困我部的黑山军头目并非张燕本人，而是其麾下悍将杨凤，此人勇猛但贪财，与张燕素有不睦；其二，常山郡守畏惧黑山军势大，已下令各县坚壁清野，所谓的“官军”断无来援的可能。希望'
2025-09-25 23:37:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 272
2025-09-25 23:37:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:37:44 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:37:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:37:44 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:37:44 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=103 parent=83 choice='坚守坞堡，凭借地利消耗敌军锐气，同时派遣信使向常山郡府求援，寄望于官军介入。' rem=1
2025-09-25 23:37:44 | INFO     | core.story_engine:continue_story:275 - 继续故事，用户选择: 虚与委蛇，假意答应黑山军的要求以拖延时间，暗中联络附近同样受其威胁的村寨大户，试图结成联盟共击之。
2025-09-25 23:38:12 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: [渠道3]满血gemini-2.5-pro-preview-03-25, tokens使用: 3788
2025-09-25 23:38:12 | INFO     | core.story_engine:continue_story:293 - [LLM raw][continue] 长度=1136 预览='{\n  "text": "我一面遣人携带薄礼前往黑山军营地，言辞恳切地表示粮草铁器正在筹措，但乡中凋敝，恳请张燕将军宽限时日；另一面则亲笔修书数封，交由夏侯兰的可靠渠道，分送至周边同样深受其害的几个大户坞堡。然而，事情的发展比我预想的更为棘手。数日后，前往黑山军营的使者带回了张燕的回复：可以再宽限五日，但必须将我兄长留下的独子赵风送去作为人质，以示诚意。几乎同时，实力最强的常山李氏也派人送来了回信，言辞颇为倨傲，他们虽承认黑山军是心腹大患，却不愿轻易出头，除非我能先展现出足以与张燕抗衡的实力。内有强敌逼迫，外无援军响应，我握着那封索要侄儿的书信，手背上青筋暴起。",\n  "success_ra'
2025-09-25 23:38:12 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1136 预览='{\n  "text": "我一面遣人携带薄礼前往黑山军营地，言辞恳切地表示粮草铁器正在筹措，但乡中凋敝，恳请张燕将军宽限时日；另一面则亲笔修书数封，交由夏侯兰的可靠渠道，分送至周边同样深受其害的几个大户坞堡。然而，事情的发展比我预想的更为棘手。数日后，前往黑山军营的使者带回了张燕的回复：可以再宽限五日，但必须将我兄长留'
2025-09-25 23:38:12 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1136 预览='{\n  "text": "我一面遣人携带薄礼前往黑山军营地，言辞恳切地表示粮草铁器正在筹措，但乡中凋敝，恳请张燕将军宽限时日；另一面则亲笔修书数封，交由夏侯兰的可靠渠道，分送至周边同样深受其害的几个大户坞堡。然而，事情的发展比我预想的更为棘手。数日后，前往黑山军营的使者带回了张燕的回复：可以再宽限五日，但必须将我兄长留'
2025-09-25 23:38:12 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1136 预览='{\n  "text": "我一面遣人携带薄礼前往黑山军营地，言辞恳切地表示粮草铁器正在筹措，但乡中凋敝，恳请张燕将军宽限时日；另一面则亲笔修书数封，交由夏侯兰的可靠渠道，分送至周边同样深受其害的几个大户坞堡。然而，事情的发展比我预想的更为棘手。数日后，前往黑山军营的使者带回了张燕的回复：可以再宽限五日，但必须将我兄长留下的独子赵风送去作为人质，以示诚意。几乎同时，实力最强的常山李氏也派人送来了回信'
2025-09-25 23:38:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 271
2025-09-25 23:38:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:38:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:38:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:38:12 | INFO     | core.story_engine:continue_story:324 - 故事继续生成成功
2025-09-25 23:38:12 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L3] created node=104 parent=83 choice='虚与委蛇，假意答应黑山军的要求以拖延时间，暗中联络附近同样受其威胁的村寨大户，试图结成联盟共击之。' rem=1
2025-09-25 23:38:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:38:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:41:06 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:41:07 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': '3fbb5f47-1c92-491b-a75b-e3cbda62a708', 'base_url': 'https://ark.cn-beijing.volces.com/api/v3', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:41:07 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-25 23:41:07 | INFO     | core.llm_clients:__init__:56 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:41:07 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:41:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:41:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:41:07 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:41:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:41:07 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:41:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:41:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:41:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:41:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:41:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-25 23:41:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:41:08 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:41:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:41:09 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': '3fbb5f47-1c92-491b-a75b-e3cbda62a708', 'base_url': 'https://ark.cn-beijing.volces.com/api/v3', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:41:09 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-25 23:41:09 | INFO     | core.llm_clients:__init__:56 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:41:09 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:41:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:41:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:41:10 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:41:10 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:41:10 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:41:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:41:10 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:41:10 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:41:10 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:41:10 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-25 23:41:10 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:41:52 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1837
2025-09-25 23:41:59 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 刘备
2025-09-25 23:41:59 | INFO     | core.story_engine:start_story:216 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-25 23:43:27 | INFO     | core.llm_clients:generate:154 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2457
2025-09-25 23:43:27 | INFO     | core.story_engine:start_story:231 - [LLM raw][start] 长度=1095 预览='{\n  "text": "残阳如血，染红了涿郡西市的尘土。刘备攥着刚领到的乡勇名册，指节因用力而发白——名册上‘刘’字墨迹未干，却像烧红的烙铁烫着他的心。三天前，他还在白帝城的病榻上望着永安宫的铜铃，听着诸葛亮泣血的‘汉祚不绝’。此刻，他却站在这个熟悉又陌生的黄昏，怀中揣着那枚被战火熏黑的‘汉左将军’印绶——这是他四十岁才得到的尊荣，却在重生后回到了二十岁，回到了涿郡招募乡勇的那个清晨。\\n\\n‘备哥！’张飞的暴喝打断了思绪，他提着丈八蛇矛，身后跟着个红脸长髯的大汉，‘这告示贴了三日，竟无人响应！黄巾贼寇已破幽州，咱们再不拉起队伍，这涿郡百姓就要遭殃了！’\\n\\n刘备抬头，看见关羽丹凤眼微挑，'
2025-09-25 23:43:27 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1095 预览='{\n  "text": "残阳如血，染红了涿郡西市的尘土。刘备攥着刚领到的乡勇名册，指节因用力而发白——名册上‘刘’字墨迹未干，却像烧红的烙铁烫着他的心。三天前，他还在白帝城的病榻上望着永安宫的铜铃，听着诸葛亮泣血的‘汉祚不绝’。此刻，他却站在这个熟悉又陌生的黄昏，怀中揣着那枚被战火熏黑的‘汉左将军’印绶——这是他四十'
2025-09-25 23:43:27 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1095 预览='{\n  "text": "残阳如血，染红了涿郡西市的尘土。刘备攥着刚领到的乡勇名册，指节因用力而发白——名册上‘刘’字墨迹未干，却像烧红的烙铁烫着他的心。三天前，他还在白帝城的病榻上望着永安宫的铜铃，听着诸葛亮泣血的‘汉祚不绝’。此刻，他却站在这个熟悉又陌生的黄昏，怀中揣着那枚被战火熏黑的‘汉左将军’印绶——这是他四十'
2025-09-25 23:43:27 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1095 预览='{\n  "text": "残阳如血，染红了涿郡西市的尘土。刘备攥着刚领到的乡勇名册，指节因用力而发白——名册上‘刘’字墨迹未干，却像烧红的烙铁烫着他的心。三天前，他还在白帝城的病榻上望着永安宫的铜铃，听着诸葛亮泣血的‘汉祚不绝’。此刻，他却站在这个熟悉又陌生的黄昏，怀中揣着那枚被战火熏黑的‘汉左将军’印绶——这是他四十岁才得到的尊荣，却在重生后回到了二十岁，回到了涿郡招募乡勇的那个清晨。\\n\\n‘'
2025-09-25 23:43:27 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: 响应缺少 success_rate 字段
2025-09-25 23:45:24 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:45:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:45:26 | DEBUG    | core.llm_clients:__init__:52 - [CLIENT PARAMS] {'api_key': '3fbb5f47-1c92-491b-a75b-e3cbda62a708', 'base_url': 'https://ark.cn-beijing.volces.com/api/v3', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:45:26 | INFO     | core.llm_clients:__init__:55 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-25 23:45:26 | INFO     | core.llm_clients:__init__:56 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:45:26 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:45:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:45:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:45:26 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:45:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:45:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:45:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:45:27 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:45:27 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:45:27 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:45:27 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-25 23:45:27 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:45:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:45:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:45:46 | DEBUG    | core.llm_clients:__init__:63 - [CLIENT PARAMS] {'api_key': '3fbb5f47-1c92-491b-a75b-e3cbda62a708', 'base_url': 'https://ark.cn-beijing.volces.com/api/v3', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-25 23:45:46 | INFO     | core.llm_clients:__init__:66 - LLM客户端初始化成功 - 模型: doubao-seed-1-6-flash-250828
2025-09-25 23:45:46 | INFO     | core.llm_clients:__init__:67 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:45:46 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:45:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:45:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:45:46 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:45:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:45:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:45:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:45:47 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:45:47 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:45:47 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:45:47 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-25 23:45:47 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:46:04 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 刘备
2025-09-25 23:46:04 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-25 23:47:28 | INFO     | core.llm_clients:generate:165 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2275
2025-09-25 23:47:28 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=877 预览='{\n  "text": "残灯如豆，雨打帐篷的帆布发出呜咽般的声响。刘备猛地睁开眼，胸口剧痛让他蜷缩起来——这不是长坂坡的泥泞，而是徐州城外的败军帐。掌心还残留着糜夫人投井时的冰冷触感，耳畔却响起亲兵慌张的呼喊：“将军！吕布已破小沛，正向徐州杀来！”他挣扎起身，帐外火光映着“汉”字大旗的残破边角。前世记忆如潮水涌来：陶谦三让徐州却因自己无能，最终被吕布夺城，关张失散，糜氏惨死……冷汗浸透粗布衣衫，他攥紧腰间佩剑，指节发白。帐外传来急促马蹄声，是陈宫派来的信使吗？还是曹操的追兵？“主公！”陈宫的声音带着喘息，掀开帐帘踏雨而入，“陈登已率广陵兵驰援，可吕布先锋已至城下！”",\n  "success'
2025-09-25 23:47:28 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=877 预览='{\n  "text": "残灯如豆，雨打帐篷的帆布发出呜咽般的声响。刘备猛地睁开眼，胸口剧痛让他蜷缩起来——这不是长坂坡的泥泞，而是徐州城外的败军帐。掌心还残留着糜夫人投井时的冰冷触感，耳畔却响起亲兵慌张的呼喊：“将军！吕布已破小沛，正向徐州杀来！”他挣扎起身，帐外火光映着“汉”字大旗的残破边角。前世记忆如潮水涌来：陶'
2025-09-25 23:47:28 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=877 预览='{\n  "text": "残灯如豆，雨打帐篷的帆布发出呜咽般的声响。刘备猛地睁开眼，胸口剧痛让他蜷缩起来——这不是长坂坡的泥泞，而是徐州城外的败军帐。掌心还残留着糜夫人投井时的冰冷触感，耳畔却响起亲兵慌张的呼喊：“将军！吕布已破小沛，正向徐州杀来！”他挣扎起身，帐外火光映着“汉”字大旗的残破边角。前世记忆如潮水涌来：陶'
2025-09-25 23:47:28 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=877 预览='{\n  "text": "残灯如豆，雨打帐篷的帆布发出呜咽般的声响。刘备猛地睁开眼，胸口剧痛让他蜷缩起来——这不是长坂坡的泥泞，而是徐州城外的败军帐。掌心还残留着糜夫人投井时的冰冷触感，耳畔却响起亲兵慌张的呼喊：“将军！吕布已破小沛，正向徐州杀来！”他挣扎起身，帐外火光映着“汉”字大旗的残破边角。前世记忆如潮水涌来：陶谦三让徐州却因自己无能，最终被吕布夺城，关张失散，糜氏惨死……冷汗浸透粗布衣衫，'
2025-09-25 23:47:28 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 274
2025-09-25 23:47:28 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:47:28 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:47:28 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:47:28 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/cyberpunk_city.jpg
2025-09-25 23:47:28 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-25 23:47:29 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 23:47:29 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=40 node=105 depth=3
2025-09-25 23:47:29 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 固守下邳，遣使求援
2025-09-25 23:48:56 | INFO     | core.llm_clients:generate:165 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2860
2025-09-25 23:48:56 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1015 预览='{\n  "text": "陈登的声音混着雨声砸在帐内：\'下邳城墙虽厚，守军却不足五千，若吕布以铁骑攻城，不出三日必破！\'刘备攥着佩剑的手青筋暴起，目光扫过帐下诸将——关羽、张飞皆不在侧，唯有简雍、糜竺等文臣。\'速备三封急信！\'他掷出令箭，\'简雍持一封往青州寻田楷，糜竺带二封分送袁绍与孔融，孙乾……\'他顿住，想起前世曹操曾因刘备求援而犹豫，\'孙乾，你带亲兵三百，星夜南下许昌，告诉曹操：吕布窃据徐州，乃汉贼行径，若公能讨之，徐州牧之位，备愿让贤！\'孙乾脸色煞白：\'主公，曹操多疑，恐……\'\'无妨！\'刘备打断他，\'若他迟疑，便说我愿以徐州半数粮草为质，只求他遣夏侯惇一军为援！\'帐外，吕布先锋已在城下架'
2025-09-25 23:48:56 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1015 预览='{\n  "text": "陈登的声音混着雨声砸在帐内：\'下邳城墙虽厚，守军却不足五千，若吕布以铁骑攻城，不出三日必破！\'刘备攥着佩剑的手青筋暴起，目光扫过帐下诸将——关羽、张飞皆不在侧，唯有简雍、糜竺等文臣。\'速备三封急信！\'他掷出令箭，\'简雍持一封往青州寻田楷，糜竺带二封分送袁绍与孔融，孙乾……\'他顿住，想起前世曹操'
2025-09-25 23:48:56 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1015 预览='{\n  "text": "陈登的声音混着雨声砸在帐内：\'下邳城墙虽厚，守军却不足五千，若吕布以铁骑攻城，不出三日必破！\'刘备攥着佩剑的手青筋暴起，目光扫过帐下诸将——关羽、张飞皆不在侧，唯有简雍、糜竺等文臣。\'速备三封急信！\'他掷出令箭，\'简雍持一封往青州寻田楷，糜竺带二封分送袁绍与孔融，孙乾……\'他顿住，想起前世曹操'
2025-09-25 23:48:56 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1015 预览='{\n  "text": "陈登的声音混着雨声砸在帐内：\'下邳城墙虽厚，守军却不足五千，若吕布以铁骑攻城，不出三日必破！\'刘备攥着佩剑的手青筋暴起，目光扫过帐下诸将——关羽、张飞皆不在侧，唯有简雍、糜竺等文臣。\'速备三封急信！\'他掷出令箭，\'简雍持一封往青州寻田楷，糜竺带二封分送袁绍与孔融，孙乾……\'他顿住，想起前世曹操曾因刘备求援而犹豫，\'孙乾，你带亲兵三百，星夜南下许昌，告诉曹操：吕布窃据徐州，'
2025-09-25 23:48:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 304
2025-09-25 23:48:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:48:56 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:48:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:48:56 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:48:56 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=106 parent=105 choice='固守下邳，遣使求援' rem=3
2025-09-25 23:48:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率精锐夜袭敌营
2025-09-25 23:49:46 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-25 23:51:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:51:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-25 23:51:44 | INFO     | core.llm_clients:__init__:56 - LLM客户端初始化成功 - 提供商: 豆包 (原生SDK)
2025-09-25 23:51:44 | INFO     | core.llm_clients:__init__:88 - 模型: doubao-seed-1-6-flash-250828
2025-09-25 23:51:44 | INFO     | core.llm_clients:__init__:89 - API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:51:44 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-25 23:51:44 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:51:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:51:45 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-25 23:51:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-25 23:51:45 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-25 23:51:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-25 23:51:45 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-25 23:51:45 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-25 23:51:45 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-25 23:51:45 | INFO     | backend.main:startup_event:109 - 当前使用模型: doubao-seed-1-6-flash-250828
2025-09-25 23:51:45 | INFO     | backend.main:startup_event:110 - 模型API地址: https://ark.cn-beijing.volces.com/api/v3
2025-09-25 23:52:00 | INFO     | core.llm_clients:generate:165 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2738
2025-09-25 23:52:00 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=864 预览='{\n  "text": "三更雨幕中，刘备玄甲染血立于高顺阵前。五百死士已斩开寨门，却见陷阵营重甲兵如潮水涌来——高顺银枪挑着陈到的断矛，冷笑：\'玄德公以为夜袭能破我阵？\'陈登率广陵兵在侧营厮杀，箭矢误中刘备左臂。他攥紧滴血的剑鞘，忽闻左翼传来熟悉的\'丈八蛇矛\'破空声，张飞竟率二十骑绕至敌军后营，火把点燃了粮车。\'主公！\'陈宫突然纵马奔来，却见高顺身后转出吕布亲卫，\'将军！此乃诱敌之计！\'刘备突然勒马，雨水冲刷着他掌心的糜夫人玉佩：\'烧尽粮车，全军回撤！\'"\n  ,\n  "success_rate": 52,\n  "choices": [\n    {\n      "option": "率残兵反'
2025-09-25 23:52:00 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=864 预览='{\n  "text": "三更雨幕中，刘备玄甲染血立于高顺阵前。五百死士已斩开寨门，却见陷阵营重甲兵如潮水涌来——高顺银枪挑着陈到的断矛，冷笑：\'玄德公以为夜袭能破我阵？\'陈登率广陵兵在侧营厮杀，箭矢误中刘备左臂。他攥紧滴血的剑鞘，忽闻左翼传来熟悉的\'丈八蛇矛\'破空声，张飞竟率二十骑绕至敌军后营，火把点燃了粮车。\'主公'
2025-09-25 23:52:00 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=864 预览='{\n  "text": "三更雨幕中，刘备玄甲染血立于高顺阵前。五百死士已斩开寨门，却见陷阵营重甲兵如潮水涌来——高顺银枪挑着陈到的断矛，冷笑：\'玄德公以为夜袭能破我阵？\'陈登率广陵兵在侧营厮杀，箭矢误中刘备左臂。他攥紧滴血的剑鞘，忽闻左翼传来熟悉的\'丈八蛇矛\'破空声，张飞竟率二十骑绕至敌军后营，火把点燃了粮车。\'主公'
2025-09-25 23:52:00 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=864 预览='{\n  "text": "三更雨幕中，刘备玄甲染血立于高顺阵前。五百死士已斩开寨门，却见陷阵营重甲兵如潮水涌来——高顺银枪挑着陈到的断矛，冷笑：\'玄德公以为夜袭能破我阵？\'陈登率广陵兵在侧营厮杀，箭矢误中刘备左臂。他攥紧滴血的剑鞘，忽闻左翼传来熟悉的\'丈八蛇矛\'破空声，张飞竟率二十骑绕至敌军后营，火把点燃了粮车。\'主公！\'陈宫突然纵马奔来，却见高顺身后转出吕布亲卫，\'将军！此乃诱敌之计！\'刘备突然'
2025-09-25 23:52:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 217
2025-09-25 23:52:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:52:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:52:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:52:00 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:52:00 | DEBUG    | core.speculation:_speculate_bfs:214 - [Speculation][L1] created node=107 parent=105 choice='亲率精锐夜袭敌营' rem=3
2025-09-25 23:52:00 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 弃城突围，暂投广陵
2025-09-25 23:52:27 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1474
2025-09-25 23:52:49 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 项羽
2025-09-25 23:52:49 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-25 23:53:15 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3724
2025-09-25 23:53:15 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=958 预览='{\n  "text": "汉元年十月，戏下楚军大营的烛火映着帐外呜咽的寒风。项羽立于案前，指节因紧握佩剑而泛白——那柄随他破釜沉舟的霸王枪，此刻枪尖却凝着霜气。帐内堆积的军报上，‘汉王刘邦’四字被他朱笔划得深浅不一，墨迹洇透了‘还军霸上’的字样。三日前，陈平持节叩营，献上白玉璧一双，言说刘邦愿‘闭关守函谷，待大王处置’。项羽想起前世此刻，自己正立于鸿门宴帐外，听着范增三次举玦，却终究因一念之仁放虎归山。垓下的四面楚歌犹在耳畔，虞姬自刎的血色染红了乌江……‘大王，刘邦使者已在帐外候命。’帐外传来英布低沉的声音。项羽猛地转身，甲胄碰撞声在寂静中格外刺耳。他望着案上那枚范增遗落的玉玦，前世的悔恨与今'
2025-09-25 23:53:15 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=958 预览='{\n  "text": "汉元年十月，戏下楚军大营的烛火映着帐外呜咽的寒风。项羽立于案前，指节因紧握佩剑而泛白——那柄随他破釜沉舟的霸王枪，此刻枪尖却凝着霜气。帐内堆积的军报上，‘汉王刘邦’四字被他朱笔划得深浅不一，墨迹洇透了‘还军霸上’的字样。三日前，陈平持节叩营，献上白玉璧一双，言说刘邦愿‘闭关守函谷，待大王处置’'
2025-09-25 23:53:15 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=958 预览='{\n  "text": "汉元年十月，戏下楚军大营的烛火映着帐外呜咽的寒风。项羽立于案前，指节因紧握佩剑而泛白——那柄随他破釜沉舟的霸王枪，此刻枪尖却凝着霜气。帐内堆积的军报上，‘汉王刘邦’四字被他朱笔划得深浅不一，墨迹洇透了‘还军霸上’的字样。三日前，陈平持节叩营，献上白玉璧一双，言说刘邦愿‘闭关守函谷，待大王处置’'
2025-09-25 23:53:15 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=958 预览='{\n  "text": "汉元年十月，戏下楚军大营的烛火映着帐外呜咽的寒风。项羽立于案前，指节因紧握佩剑而泛白——那柄随他破釜沉舟的霸王枪，此刻枪尖却凝着霜气。帐内堆积的军报上，‘汉王刘邦’四字被他朱笔划得深浅不一，墨迹洇透了‘还军霸上’的字样。三日前，陈平持节叩营，献上白玉璧一双，言说刘邦愿‘闭关守函谷，待大王处置’。项羽想起前世此刻，自己正立于鸿门宴帐外，听着范增三次举玦，却终究因一念之仁放虎'
2025-09-25 23:53:15 | WARNING  | core.story_engine:_parse_llm_response:157 - [JSON] 响应中缺少 'success_rate' 字段，将使用默认值 50
2025-09-25 23:53:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 319
2025-09-25 23:53:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:53:15 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:53:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:53:15 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/space_station.jpg
2025-09-25 23:53:15 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-25 23:53:15 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-25 23:53:15 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=41 node=108 depth=3
2025-09-25 23:53:15 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 选项A：雷霆鸿门宴
2025-09-25 23:53:15 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 选项B：诸侯会盟削权
2025-09-25 23:53:15 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 选项C：假盟暗袭
2025-09-25 23:53:30 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2451
2025-09-25 23:53:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=985 预览='{\n  "text": "戏下会盟大帐内，烛火将项羽的侧影拉得颀长。他将霸王枪拄在青铜鼎旁，甲胄上的兽面纹在火光下狰狞如活物。帐外传来诸侯甲胄碰撞的窸窣声，英布的黥面在火把映照下泛着油光，彭越的酒囊却已空了大半。项羽冷笑一声，将范增遗落的玉玦掷向案上的诸侯名册——刘邦的名字被红笔圈出，墨迹里渗出暗红的血痕。\'诸位，\'他的声线如裂帛，\'汉王刘邦窃据巴蜀，却暗通三秦旧部，今日便要在这戏下，将他的野心碾碎！\'章邯突然叩首：\'大王，刘邦麾下韩信已暗度陈仓，若诸侯离心，恐成大患！\'项羽却瞥见帐角阴影里，英布的手正悄悄摸向腰间的佩剑。",\n  "success_rate": 55,\n  "choices"'
2025-09-25 23:53:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=985 预览='{\n  "text": "戏下会盟大帐内，烛火将项羽的侧影拉得颀长。他将霸王枪拄在青铜鼎旁，甲胄上的兽面纹在火光下狰狞如活物。帐外传来诸侯甲胄碰撞的窸窣声，英布的黥面在火把映照下泛着油光，彭越的酒囊却已空了大半。项羽冷笑一声，将范增遗落的玉玦掷向案上的诸侯名册——刘邦的名字被红笔圈出，墨迹里渗出暗红的血痕。\'诸位，\'他'
2025-09-25 23:53:30 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=985 预览='{\n  "text": "戏下会盟大帐内，烛火将项羽的侧影拉得颀长。他将霸王枪拄在青铜鼎旁，甲胄上的兽面纹在火光下狰狞如活物。帐外传来诸侯甲胄碰撞的窸窣声，英布的黥面在火把映照下泛着油光，彭越的酒囊却已空了大半。项羽冷笑一声，将范增遗落的玉玦掷向案上的诸侯名册——刘邦的名字被红笔圈出，墨迹里渗出暗红的血痕。\'诸位，\'他'
2025-09-25 23:53:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=985 预览='{\n  "text": "戏下会盟大帐内，烛火将项羽的侧影拉得颀长。他将霸王枪拄在青铜鼎旁，甲胄上的兽面纹在火光下狰狞如活物。帐外传来诸侯甲胄碰撞的窸窣声，英布的黥面在火把映照下泛着油光，彭越的酒囊却已空了大半。项羽冷笑一声，将范增遗落的玉玦掷向案上的诸侯名册——刘邦的名字被红笔圈出，墨迹里渗出暗红的血痕。\'诸位，\'他的声线如裂帛，\'汉王刘邦窃据巴蜀，却暗通三秦旧部，今日便要在这戏下，将他的野心碾'
2025-09-25 23:53:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 251
2025-09-25 23:53:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:53:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:53:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:53:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:53:30 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=109 parent=108 choice='选项B：诸侯会盟削权'
2025-09-25 23:53:41 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3553
2025-09-25 23:53:41 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1148 预览='{\n  "text": "项羽指尖叩着案上的白玉璧，玉璧温润的触感竟让他想起虞姬腕间的暖玉。‘传陈平。’他沉声下令，帐外寒风裹挟着甲胄摩擦声涌入。陈平踉跄入帐，见项羽背对着他，霸王枪斜倚案边，枪缨垂落如泣血的红绸。‘大王，刘邦愿割地百里，只求暂借函谷关防务。’陈平声音发颤，将刘邦密信呈上。项羽展开信纸，‘闭关守函谷’四字被刘邦的朱砂印泥洇出褶皱——这是鸿门宴后他设下的陷阱，如今却成了刘邦的缓兵之计。‘传龙且、英布。’项羽突然转身，甲胄铁环碰撞出决绝的声响，‘假盟暗袭，今夜三更，直捣霸上！’帐外传来急促的脚步声，龙且的铜锤甲胄声震得烛火摇曳。‘大王！刘邦在霸上布防严密，若强行突袭恐损我精锐！’龙'
2025-09-25 23:53:41 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1148 预览='{\n  "text": "项羽指尖叩着案上的白玉璧，玉璧温润的触感竟让他想起虞姬腕间的暖玉。‘传陈平。’他沉声下令，帐外寒风裹挟着甲胄摩擦声涌入。陈平踉跄入帐，见项羽背对着他，霸王枪斜倚案边，枪缨垂落如泣血的红绸。‘大王，刘邦愿割地百里，只求暂借函谷关防务。’陈平声音发颤，将刘邦密信呈上。项羽展开信纸，‘闭关守函谷’四'
2025-09-25 23:53:41 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1148 预览='{\n  "text": "项羽指尖叩着案上的白玉璧，玉璧温润的触感竟让他想起虞姬腕间的暖玉。‘传陈平。’他沉声下令，帐外寒风裹挟着甲胄摩擦声涌入。陈平踉跄入帐，见项羽背对着他，霸王枪斜倚案边，枪缨垂落如泣血的红绸。‘大王，刘邦愿割地百里，只求暂借函谷关防务。’陈平声音发颤，将刘邦密信呈上。项羽展开信纸，‘闭关守函谷’四'
2025-09-25 23:53:41 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1148 预览='{\n  "text": "项羽指尖叩着案上的白玉璧，玉璧温润的触感竟让他想起虞姬腕间的暖玉。‘传陈平。’他沉声下令，帐外寒风裹挟着甲胄摩擦声涌入。陈平踉跄入帐，见项羽背对着他，霸王枪斜倚案边，枪缨垂落如泣血的红绸。‘大王，刘邦愿割地百里，只求暂借函谷关防务。’陈平声音发颤，将刘邦密信呈上。项羽展开信纸，‘闭关守函谷’四字被刘邦的朱砂印泥洇出褶皱——这是鸿门宴后他设下的陷阱，如今却成了刘邦的缓兵之计'
2025-09-25 23:53:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 419
2025-09-25 23:53:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:53:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:53:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:53:41 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:53:41 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=110 parent=108 choice='选项C：假盟暗袭'
2025-09-25 23:54:14 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3850
2025-09-25 23:54:14 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=993 预览='{\n  "text": "鸿门宴的觥筹声尚未消散，帐内烛火却已被项羽的怒火点燃。他将陈平献上的白玉璧掷于案上，玉碎声惊得帐外寒鸦扑棱棱飞起。“刘邦敢诈称闭关，却暗遣樊哙持盾闯营！”项羽一脚踹翻案几，酒盏碎裂的脆响中，他瞥见范增藏在袖中的铁尺——那是当年鸿门宴上未能掷出的杀器。帐外突然传来甲胄摩擦声，英布带着刘邦的降将季布闯入，跪地呈上刘邦的印绶：“大王，刘邦已被我囚于后帐，只待您发落！”项羽攥紧霸王枪枪柄，枪缨因急怒而颤抖：“烹杀！”范增却突然挡在帐前，枯瘦的手指死死按住枪尖：“大王！杀刘邦易，失天下难！”他指向帐外瑟瑟发抖的张良，“此乃张良缓兵之计，若杀刘邦，诸侯必以我等为暴主！”项羽的目光'
2025-09-25 23:54:14 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=993 预览='{\n  "text": "鸿门宴的觥筹声尚未消散，帐内烛火却已被项羽的怒火点燃。他将陈平献上的白玉璧掷于案上，玉碎声惊得帐外寒鸦扑棱棱飞起。“刘邦敢诈称闭关，却暗遣樊哙持盾闯营！”项羽一脚踹翻案几，酒盏碎裂的脆响中，他瞥见范增藏在袖中的铁尺——那是当年鸿门宴上未能掷出的杀器。帐外突然传来甲胄摩擦声，英布带着刘邦的降将季'
2025-09-25 23:54:14 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=993 预览='{\n  "text": "鸿门宴的觥筹声尚未消散，帐内烛火却已被项羽的怒火点燃。他将陈平献上的白玉璧掷于案上，玉碎声惊得帐外寒鸦扑棱棱飞起。“刘邦敢诈称闭关，却暗遣樊哙持盾闯营！”项羽一脚踹翻案几，酒盏碎裂的脆响中，他瞥见范增藏在袖中的铁尺——那是当年鸿门宴上未能掷出的杀器。帐外突然传来甲胄摩擦声，英布带着刘邦的降将季'
2025-09-25 23:54:14 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=993 预览='{\n  "text": "鸿门宴的觥筹声尚未消散，帐内烛火却已被项羽的怒火点燃。他将陈平献上的白玉璧掷于案上，玉碎声惊得帐外寒鸦扑棱棱飞起。“刘邦敢诈称闭关，却暗遣樊哙持盾闯营！”项羽一脚踹翻案几，酒盏碎裂的脆响中，他瞥见范增藏在袖中的铁尺——那是当年鸿门宴上未能掷出的杀器。帐外突然传来甲胄摩擦声，英布带着刘邦的降将季布闯入，跪地呈上刘邦的印绶：“大王，刘邦已被我囚于后帐，只待您发落！”项羽攥紧霸'
2025-09-25 23:54:14 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 364
2025-09-25 23:54:14 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:14 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:54:14 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:54:14 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:14 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=111 parent=108 choice='选项A：雷霆鸿门宴'
2025-09-25 23:54:14 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以霸王枪立威：当众斩杀刘邦使者，震慑诸侯
2025-09-25 23:54:14 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 借刀杀人：封彭越为梁王后，令其监视刘邦
2025-09-25 23:54:14 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以楚制安诸侯：立楚怀王为义帝，诸侯共主
2025-09-25 23:54:22 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 选项A：雷霆鸿门宴
2025-09-25 23:54:30 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2814
2025-09-25 23:54:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=894 预览='{\n  "text": "戏下大帐的血腥味尚未散尽，项羽将刘邦使者的头颅掷在青铜鼎前，鲜血顺着鼎耳蜿蜒成河。诸侯们的甲胄在烛火下泛着冷光，英布的黥面因紧张而抽搐。范增枯瘦的手指叩着案上的玉玦——那是鸿门宴上未送出的信物，此刻正映着项羽猩红的眼。\'汉中粮仓已空，刘邦必遣韩信奇袭三秦！\'章邯突然掀翻案几，竹简散落如雨。项羽冷笑收枪，枪尖挑着使者的断腕：\'传令英布，今夜拔营，踏平汉中！\'帐外突然传来急促的马蹄声，斥候举着染血的战报闯入：\'大王！刘邦已在陈仓筑城，韩信率三万锐士直逼废丘！\'",\n  "success_rate": 60,\n  "choices": [\n    {\n      "opti'
2025-09-25 23:54:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=894 预览='{\n  "text": "戏下大帐的血腥味尚未散尽，项羽将刘邦使者的头颅掷在青铜鼎前，鲜血顺着鼎耳蜿蜒成河。诸侯们的甲胄在烛火下泛着冷光，英布的黥面因紧张而抽搐。范增枯瘦的手指叩着案上的玉玦——那是鸿门宴上未送出的信物，此刻正映着项羽猩红的眼。\'汉中粮仓已空，刘邦必遣韩信奇袭三秦！\'章邯突然掀翻案几，竹简散落如雨。项羽'
2025-09-25 23:54:30 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=894 预览='{\n  "text": "戏下大帐的血腥味尚未散尽，项羽将刘邦使者的头颅掷在青铜鼎前，鲜血顺着鼎耳蜿蜒成河。诸侯们的甲胄在烛火下泛着冷光，英布的黥面因紧张而抽搐。范增枯瘦的手指叩着案上的玉玦——那是鸿门宴上未送出的信物，此刻正映着项羽猩红的眼。\'汉中粮仓已空，刘邦必遣韩信奇袭三秦！\'章邯突然掀翻案几，竹简散落如雨。项羽'
2025-09-25 23:54:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=894 预览='{\n  "text": "戏下大帐的血腥味尚未散尽，项羽将刘邦使者的头颅掷在青铜鼎前，鲜血顺着鼎耳蜿蜒成河。诸侯们的甲胄在烛火下泛着冷光，英布的黥面因紧张而抽搐。范增枯瘦的手指叩着案上的玉玦——那是鸿门宴上未送出的信物，此刻正映着项羽猩红的眼。\'汉中粮仓已空，刘邦必遣韩信奇袭三秦！\'章邯突然掀翻案几，竹简散落如雨。项羽冷笑收枪，枪尖挑着使者的断腕：\'传令英布，今夜拔营，踏平汉中！\'帐外突然传来急促'
2025-09-25 23:54:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 230
2025-09-25 23:54:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:54:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:54:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:30 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=112 parent=109 choice='以霸王枪立威：当众斩杀刘邦使者，震慑诸侯'
2025-09-25 23:54:32 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 雷霆诛杀刘邦
2025-09-25 23:54:32 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 雷霆诛杀刘邦
2025-09-25 23:54:34 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3092
2025-09-25 23:54:34 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=929 预览='{\n  "text": "彭城宫的青铜鼎里，新煮的椒浆还冒着热气，却暖不透项羽眼底的寒意。他将义帝的印绶掷在案上，玉质印纽在烛火下泛着冷光——这是他重生后最得意的一笔：以楚之名，行霸王之权。\'怀王虽为义帝，却仍是天下共主。\'项羽的声线压过殿内窃窃私语，英布的黥面在火光下更显狰狞，\'即日起，诸侯皆需朝义帝述职，违者，霸王枪下无活口！\'范增突然咳嗽起来，枯瘦的手指掐着案上的诸侯名册，刘邦的名字被他指得发亮。帐外突然传来急促的马蹄声，斥候的青铜箭镞在月光下闪着寒光——刘邦已在汉中筑坛拜将，韩信的将印正被他攥得发烫。",\n  "success_rate": 68,\n  "choices": [\n   '
2025-09-25 23:54:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=929 预览='{\n  "text": "彭城宫的青铜鼎里，新煮的椒浆还冒着热气，却暖不透项羽眼底的寒意。他将义帝的印绶掷在案上，玉质印纽在烛火下泛着冷光——这是他重生后最得意的一笔：以楚之名，行霸王之权。\'怀王虽为义帝，却仍是天下共主。\'项羽的声线压过殿内窃窃私语，英布的黥面在火光下更显狰狞，\'即日起，诸侯皆需朝义帝述职，违者，霸王'
2025-09-25 23:54:34 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=929 预览='{\n  "text": "彭城宫的青铜鼎里，新煮的椒浆还冒着热气，却暖不透项羽眼底的寒意。他将义帝的印绶掷在案上，玉质印纽在烛火下泛着冷光——这是他重生后最得意的一笔：以楚之名，行霸王之权。\'怀王虽为义帝，却仍是天下共主。\'项羽的声线压过殿内窃窃私语，英布的黥面在火光下更显狰狞，\'即日起，诸侯皆需朝义帝述职，违者，霸王'
2025-09-25 23:54:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=929 预览='{\n  "text": "彭城宫的青铜鼎里，新煮的椒浆还冒着热气，却暖不透项羽眼底的寒意。他将义帝的印绶掷在案上，玉质印纽在烛火下泛着冷光——这是他重生后最得意的一笔：以楚之名，行霸王之权。\'怀王虽为义帝，却仍是天下共主。\'项羽的声线压过殿内窃窃私语，英布的黥面在火光下更显狰狞，\'即日起，诸侯皆需朝义帝述职，违者，霸王枪下无活口！\'范增突然咳嗽起来，枯瘦的手指掐着案上的诸侯名册，刘邦的名字被他指得'
2025-09-25 23:54:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 244
2025-09-25 23:54:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:54:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:54:34 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:34 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=113 parent=109 choice='以楚制安诸侯：立楚怀王为义帝，诸侯共主'
2025-09-25 23:54:37 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3424
2025-09-25 23:54:37 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=956 预览='{\n  "text": "戏下大营的烛火映着彭越黥面下的汗珠，他双手接过印绶时，指节因用力而发白。\'大王，臣愿以梁地为楔，钉死刘邦西进之路。\'项羽冷笑，青铜酒爵在案上磕出闷响：\'但记住，彭越——\'他突然攥住对方手腕，甲胄上的龙纹刺得人皮肤发烫，\'若敢与刘邦暗通款曲，霸王枪下，无活口。\'帐外突然传来急促的马蹄声，英布的黥面在火把中泛着油光：\'大王，刘邦已在汉中凿通褒斜栈道，韩信亲率三万锐士星夜兼程！\'项羽猛地掀翻案几，玉玦碎裂的脆响里，他看见彭越瞳孔骤缩——这个刚刚受封的梁王，此刻正悄悄摸向腰间的匕首。",\n  "success_rate": 68,\n  "choices": [\n    {\n '
2025-09-25 23:54:37 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=956 预览='{\n  "text": "戏下大营的烛火映着彭越黥面下的汗珠，他双手接过印绶时，指节因用力而发白。\'大王，臣愿以梁地为楔，钉死刘邦西进之路。\'项羽冷笑，青铜酒爵在案上磕出闷响：\'但记住，彭越——\'他突然攥住对方手腕，甲胄上的龙纹刺得人皮肤发烫，\'若敢与刘邦暗通款曲，霸王枪下，无活口。\'帐外突然传来急促的马蹄声，英布的黥'
2025-09-25 23:54:37 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=956 预览='{\n  "text": "戏下大营的烛火映着彭越黥面下的汗珠，他双手接过印绶时，指节因用力而发白。\'大王，臣愿以梁地为楔，钉死刘邦西进之路。\'项羽冷笑，青铜酒爵在案上磕出闷响：\'但记住，彭越——\'他突然攥住对方手腕，甲胄上的龙纹刺得人皮肤发烫，\'若敢与刘邦暗通款曲，霸王枪下，无活口。\'帐外突然传来急促的马蹄声，英布的黥'
2025-09-25 23:54:37 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=956 预览='{\n  "text": "戏下大营的烛火映着彭越黥面下的汗珠，他双手接过印绶时，指节因用力而发白。\'大王，臣愿以梁地为楔，钉死刘邦西进之路。\'项羽冷笑，青铜酒爵在案上磕出闷响：\'但记住，彭越——\'他突然攥住对方手腕，甲胄上的龙纹刺得人皮肤发烫，\'若敢与刘邦暗通款曲，霸王枪下，无活口。\'帐外突然传来急促的马蹄声，英布的黥面在火把中泛着油光：\'大王，刘邦已在汉中凿通褒斜栈道，韩信亲率三万锐士星夜兼程！'
2025-09-25 23:54:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 240
2025-09-25 23:54:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:54:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:54:37 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:37 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=114 parent=109 choice='借刀杀人：封彭越为梁王后，令其监视刘邦'
2025-09-25 23:54:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力夜袭霸上
2025-09-25 23:54:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派陈平持假盟约书刺探虚实
2025-09-25 23:54:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与范增彻夜议事并承诺战后分封
2025-09-25 23:54:53 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3022
2025-09-25 23:54:53 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=951 预览='{\n  "text": "烛火将项羽的影子投在帐壁上，如一尊怒目圆睁的战神。范增枯瘦的手指划过舆图上密密麻麻的诸侯封地，‘大王，六国遗民心向旧主，若战后不裂土分封，恐陈涉之变复现。’项羽猛地攥紧案上酒盏，琥珀色的酒液溅在‘刘邦’二字上，‘那老匹夫若敢违约，我便将他挫骨扬灰！’范增冷笑一声，将一枚刻着‘霸王’的玉印推到案前：‘此印可暂代分封权，先稳住英布、彭越等异姓王。’帐外突然传来急促的马蹄声，龙且的铜甲在月光下泛着冷光——他带来了刘邦暗度陈仓的密报。项羽瞳孔骤缩，酒盏砰然落地，玉印滚向范增的手，‘老将军，这天下，终究是要靠刀剑说话的！’",\n  "success_rate": 68,\n  "'
2025-09-25 23:54:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=951 预览='{\n  "text": "烛火将项羽的影子投在帐壁上，如一尊怒目圆睁的战神。范增枯瘦的手指划过舆图上密密麻麻的诸侯封地，‘大王，六国遗民心向旧主，若战后不裂土分封，恐陈涉之变复现。’项羽猛地攥紧案上酒盏，琥珀色的酒液溅在‘刘邦’二字上，‘那老匹夫若敢违约，我便将他挫骨扬灰！’范增冷笑一声，将一枚刻着‘霸王’的玉印推到案'
2025-09-25 23:54:53 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=951 预览='{\n  "text": "烛火将项羽的影子投在帐壁上，如一尊怒目圆睁的战神。范增枯瘦的手指划过舆图上密密麻麻的诸侯封地，‘大王，六国遗民心向旧主，若战后不裂土分封，恐陈涉之变复现。’项羽猛地攥紧案上酒盏，琥珀色的酒液溅在‘刘邦’二字上，‘那老匹夫若敢违约，我便将他挫骨扬灰！’范增冷笑一声，将一枚刻着‘霸王’的玉印推到案'
2025-09-25 23:54:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=951 预览='{\n  "text": "烛火将项羽的影子投在帐壁上，如一尊怒目圆睁的战神。范增枯瘦的手指划过舆图上密密麻麻的诸侯封地，‘大王，六国遗民心向旧主，若战后不裂土分封，恐陈涉之变复现。’项羽猛地攥紧案上酒盏，琥珀色的酒液溅在‘刘邦’二字上，‘那老匹夫若敢违约，我便将他挫骨扬灰！’范增冷笑一声，将一枚刻着‘霸王’的玉印推到案前：‘此印可暂代分封权，先稳住英布、彭越等异姓王。’帐外突然传来急促的马蹄声，龙'
2025-09-25 23:54:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 259
2025-09-25 23:54:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:54:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:54:53 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:53 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=115 parent=110 choice='与范增彻夜议事并承诺战后分封'
2025-09-25 23:54:54 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3016
2025-09-25 23:54:54 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=890 预览='{\n  "text": "汉元年十月，寒星坠如铁雨。项羽亲率三万玄甲铁骑衔枚疾行，马蹄踏碎霸上的薄霜。刘邦的守军本以为‘闭关守函谷’是缓兵之计，却未料霸王枪已抵喉间——楚军如黑潮般冲破营垒时，刘邦正与张良在中军帐内摔碎玉杯，‘韩信援军已至陈仓道，今夜必反！’话音未落，帐外传来英布怒吼：‘项羽亲至！’项羽银枪挑开帐帘，刘邦仓皇逃窜时遗落的兵符上，‘韩信’二字被血渍晕染。楚军追至渭水畔，却见韩信亲率的背嵬军列阵如林，十面埋伏的杀气顺着渭水漫过项羽的靴尖。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "率楚军正面强攻，速破'
2025-09-25 23:54:54 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=890 预览='{\n  "text": "汉元年十月，寒星坠如铁雨。项羽亲率三万玄甲铁骑衔枚疾行，马蹄踏碎霸上的薄霜。刘邦的守军本以为‘闭关守函谷’是缓兵之计，却未料霸王枪已抵喉间——楚军如黑潮般冲破营垒时，刘邦正与张良在中军帐内摔碎玉杯，‘韩信援军已至陈仓道，今夜必反！’话音未落，帐外传来英布怒吼：‘项羽亲至！’项羽银枪挑开帐帘，刘'
2025-09-25 23:54:54 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=890 预览='{\n  "text": "汉元年十月，寒星坠如铁雨。项羽亲率三万玄甲铁骑衔枚疾行，马蹄踏碎霸上的薄霜。刘邦的守军本以为‘闭关守函谷’是缓兵之计，却未料霸王枪已抵喉间——楚军如黑潮般冲破营垒时，刘邦正与张良在中军帐内摔碎玉杯，‘韩信援军已至陈仓道，今夜必反！’话音未落，帐外传来英布怒吼：‘项羽亲至！’项羽银枪挑开帐帘，刘'
2025-09-25 23:54:54 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=890 预览='{\n  "text": "汉元年十月，寒星坠如铁雨。项羽亲率三万玄甲铁骑衔枚疾行，马蹄踏碎霸上的薄霜。刘邦的守军本以为‘闭关守函谷’是缓兵之计，却未料霸王枪已抵喉间——楚军如黑潮般冲破营垒时，刘邦正与张良在中军帐内摔碎玉杯，‘韩信援军已至陈仓道，今夜必反！’话音未落，帐外传来英布怒吼：‘项羽亲至！’项羽银枪挑开帐帘，刘邦仓皇逃窜时遗落的兵符上，‘韩信’二字被血渍晕染。楚军追至渭水畔，却见韩信亲率的'
2025-09-25 23:54:54 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 214
2025-09-25 23:54:54 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:54 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:54:54 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:54:54 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:54 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=116 parent=110 choice='亲率主力夜袭霸上'
2025-09-25 23:54:56 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3779
2025-09-25 23:54:56 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=984 预览='{\n  "text": "烛火在帐内投下刀光剑影，项羽将刘邦的印绶掷在炭火盆中，火星溅上他的玄甲。“烹杀前，先让他看看楚人的雷霆手段。”他转身踹开囚室木门，刘邦蜷缩在稻草堆里，囚服上的血痕与草屑纠缠。帐外突然传来钟离眜急报：“大王！田荣已联合彭越反于齐地，英布将军正率楚军西进......”项羽攥紧霸王枪枪杆，枪尖在刘邦脸上划出一道血痕：“刘邦，你可知罪？”刘邦突然冷笑：“项大王杀我易，却难阻天下人心向汉！”项羽的瞳孔骤然收缩——帐外突然传来甲胄铿锵，竟是范增带着一队死士闯入，枯瘦的手指死死按住他的枪柄：“大王！诸侯联军已至函谷关外！”",\n  "success_rate": 60,\n  "ch'
2025-09-25 23:54:56 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=984 预览='{\n  "text": "烛火在帐内投下刀光剑影，项羽将刘邦的印绶掷在炭火盆中，火星溅上他的玄甲。“烹杀前，先让他看看楚人的雷霆手段。”他转身踹开囚室木门，刘邦蜷缩在稻草堆里，囚服上的血痕与草屑纠缠。帐外突然传来钟离眜急报：“大王！田荣已联合彭越反于齐地，英布将军正率楚军西进......”项羽攥紧霸王枪枪杆，枪尖在刘邦'
2025-09-25 23:54:56 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=984 预览='{\n  "text": "烛火在帐内投下刀光剑影，项羽将刘邦的印绶掷在炭火盆中，火星溅上他的玄甲。“烹杀前，先让他看看楚人的雷霆手段。”他转身踹开囚室木门，刘邦蜷缩在稻草堆里，囚服上的血痕与草屑纠缠。帐外突然传来钟离眜急报：“大王！田荣已联合彭越反于齐地，英布将军正率楚军西进......”项羽攥紧霸王枪枪杆，枪尖在刘邦'
2025-09-25 23:54:56 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=984 预览='{\n  "text": "烛火在帐内投下刀光剑影，项羽将刘邦的印绶掷在炭火盆中，火星溅上他的玄甲。“烹杀前，先让他看看楚人的雷霆手段。”他转身踹开囚室木门，刘邦蜷缩在稻草堆里，囚服上的血痕与草屑纠缠。帐外突然传来钟离眜急报：“大王！田荣已联合彭越反于齐地，英布将军正率楚军西进......”项羽攥紧霸王枪枪杆，枪尖在刘邦脸上划出一道血痕：“刘邦，你可知罪？”刘邦突然冷笑：“项大王杀我易，却难阻天下人'
2025-09-25 23:54:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 257
2025-09-25 23:54:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:54:56 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:54:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:54:56 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:54:56 | INFO     | api.story:continue_existing_story:374 - 故事继续生成成功
2025-09-25 23:54:56 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=41 node=117 depth=3
2025-09-25 23:54:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 雷霆镇压齐地叛乱
2025-09-25 23:54:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 缓兵安抚诸侯联盟
2025-09-25 23:54:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 离间刘邦旧部阵营
2025-09-25 23:55:03 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 雷霆镇压齐地叛乱
2025-09-25 23:55:03 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 雷霆镇压齐地叛乱
2025-09-25 23:55:04 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4294
2025-09-25 23:55:04 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1100 预览='{\n  "text": "汉元年十月末，楚军大营的斥候营火已连成蜿蜒的火龙。陈平将假盟约书揣入怀中，腰间的青铜虎符在月光下泛着冷光——这是项羽昨夜亲手授予的信物，虎符上‘霸王’二字被摩挲得发亮。‘若刘邦有异动，即刻举烽火为号。’项羽的声音在帐外寒夜里碎成冰碴，陈平叩首时，瞥见霸王枪枪尖凝结的霜花正顺着枪缨滴落，在青砖上洇出暗红的痕迹。三日后，陈平的身影出现在楚军斥候营。他带回的羊皮卷上，刘邦的朱砂印泥被雨水洇得模糊，却仍能辨认出‘愿献咸阳宫室，永为西楚屏障’的字样。然而，斥候营火旁，英布的铜锤甲胄突然发出刺耳的碰撞声：‘大王！刘邦昨夜已遣韩信率三万锐士奇袭武关！’帐内烛火骤然熄灭，项羽伸手摸向'
2025-09-25 23:55:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1100 预览='{\n  "text": "汉元年十月末，楚军大营的斥候营火已连成蜿蜒的火龙。陈平将假盟约书揣入怀中，腰间的青铜虎符在月光下泛着冷光——这是项羽昨夜亲手授予的信物，虎符上‘霸王’二字被摩挲得发亮。‘若刘邦有异动，即刻举烽火为号。’项羽的声音在帐外寒夜里碎成冰碴，陈平叩首时，瞥见霸王枪枪尖凝结的霜花正顺着枪缨滴落，在青砖上'
2025-09-25 23:55:04 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1100 预览='{\n  "text": "汉元年十月末，楚军大营的斥候营火已连成蜿蜒的火龙。陈平将假盟约书揣入怀中，腰间的青铜虎符在月光下泛着冷光——这是项羽昨夜亲手授予的信物，虎符上‘霸王’二字被摩挲得发亮。‘若刘邦有异动，即刻举烽火为号。’项羽的声音在帐外寒夜里碎成冰碴，陈平叩首时，瞥见霸王枪枪尖凝结的霜花正顺着枪缨滴落，在青砖上'
2025-09-25 23:55:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1100 预览='{\n  "text": "汉元年十月末，楚军大营的斥候营火已连成蜿蜒的火龙。陈平将假盟约书揣入怀中，腰间的青铜虎符在月光下泛着冷光——这是项羽昨夜亲手授予的信物，虎符上‘霸王’二字被摩挲得发亮。‘若刘邦有异动，即刻举烽火为号。’项羽的声音在帐外寒夜里碎成冰碴，陈平叩首时，瞥见霸王枪枪尖凝结的霜花正顺着枪缨滴落，在青砖上洇出暗红的痕迹。三日后，陈平的身影出现在楚军斥候营。他带回的羊皮卷上，刘邦的朱砂'
2025-09-25 23:55:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 433
2025-09-25 23:55:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:55:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:55:04 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:04 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=118 parent=110 choice='派陈平持假盟约书刺探虚实'
2025-09-25 23:55:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 软禁刘邦为人质
2025-09-25 23:55:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 借英布追杀刘邦
2025-09-25 23:55:16 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3557
2025-09-25 23:55:16 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=952 预览='{\n  "text": "帐内烛火将项羽的影子拉得颀长，他指尖摩挲着霸王枪枪缨，枪尖的霜气映出军报上‘韩信拥兵齐地’的朱批。‘刘邦旧部中，唯有韩信最是桀骜。’项羽突然冷笑，将案上密信掷向陈平，‘你去齐地，把这封“韩信私通楚军”的伪信交给他副将。’陈平瞳孔骤缩，枯瘦的手指攥紧密信：‘大王，此计若败露……’‘败露？’项羽拔剑劈开案上酒坛，酒液溅在密信上晕开墨痕，‘本王要的不是败露，是让刘邦自己猜忌韩信！’帐外突然传来甲胄声，英布带着一队楚军冲入，跪地呈上竹简：‘大王，彭越在梁地散布谣言，说刘邦欲夺其兵权！’项羽剑眉倒竖，枪尖直指帐外：‘那就让他亲眼看看，什么叫西楚的雷霆！’",\n  "succes'
2025-09-25 23:55:16 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=952 预览='{\n  "text": "帐内烛火将项羽的影子拉得颀长，他指尖摩挲着霸王枪枪缨，枪尖的霜气映出军报上‘韩信拥兵齐地’的朱批。‘刘邦旧部中，唯有韩信最是桀骜。’项羽突然冷笑，将案上密信掷向陈平，‘你去齐地，把这封“韩信私通楚军”的伪信交给他副将。’陈平瞳孔骤缩，枯瘦的手指攥紧密信：‘大王，此计若败露……’‘败露？’项羽拔'
2025-09-25 23:55:16 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=952 预览='{\n  "text": "帐内烛火将项羽的影子拉得颀长，他指尖摩挲着霸王枪枪缨，枪尖的霜气映出军报上‘韩信拥兵齐地’的朱批。‘刘邦旧部中，唯有韩信最是桀骜。’项羽突然冷笑，将案上密信掷向陈平，‘你去齐地，把这封“韩信私通楚军”的伪信交给他副将。’陈平瞳孔骤缩，枯瘦的手指攥紧密信：‘大王，此计若败露……’‘败露？’项羽拔'
2025-09-25 23:55:16 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=952 预览='{\n  "text": "帐内烛火将项羽的影子拉得颀长，他指尖摩挲着霸王枪枪缨，枪尖的霜气映出军报上‘韩信拥兵齐地’的朱批。‘刘邦旧部中，唯有韩信最是桀骜。’项羽突然冷笑，将案上密信掷向陈平，‘你去齐地，把这封“韩信私通楚军”的伪信交给他副将。’陈平瞳孔骤缩，枯瘦的手指攥紧密信：‘大王，此计若败露……’‘败露？’项羽拔剑劈开案上酒坛，酒液溅在密信上晕开墨痕，‘本王要的不是败露，是让刘邦自己猜忌韩信'
2025-09-25 23:55:16 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 275
2025-09-25 23:55:16 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:16 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:55:16 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:55:16 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:16 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=119 parent=117 choice='离间刘邦旧部阵营'
2025-09-25 23:55:21 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3362
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=952 预览='{\n  "text": "汉元年冬，齐地烽烟卷着雪粒扑向彭城。项羽立于临淄城外的望台上，霸王枪斜指被战火焚毁的稷门，甲胄上的血珠正顺着玄纹滴落。田荣的残兵在巷战中举着残破的楚旗负隅顽抗，而彭越的游击军已绕至济西，截断楚军粮道。帐内，英布捧着密信跪地：“大王，刘邦遣韩信暗渡陈仓，关中已失三城！”项羽猛地掷碎酒盏，琥珀色酒液溅上钟离眜的脸：“分兵！”范增枯瘦的手指突然按住他的枪柄：“大王，齐地乃西楚左膀，若弃之，天下将以我为暴主！”帐外突然传来甲胄铿锵——季布带着一队降卒持剑闯入，剑刃映着雪光：“大王！田氏余孽藏于泰山密道！”项羽瞳孔骤缩，枪尖直指帐外：“今日，我要让齐地知道，霸王的雷霆，从无虚发'
2025-09-25 23:55:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=952 预览='{\n  "text": "汉元年冬，齐地烽烟卷着雪粒扑向彭城。项羽立于临淄城外的望台上，霸王枪斜指被战火焚毁的稷门，甲胄上的血珠正顺着玄纹滴落。田荣的残兵在巷战中举着残破的楚旗负隅顽抗，而彭越的游击军已绕至济西，截断楚军粮道。帐内，英布捧着密信跪地：“大王，刘邦遣韩信暗渡陈仓，关中已失三城！”项羽猛地掷碎酒盏，琥珀色酒'
2025-09-25 23:55:21 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=952 预览='{\n  "text": "汉元年冬，齐地烽烟卷着雪粒扑向彭城。项羽立于临淄城外的望台上，霸王枪斜指被战火焚毁的稷门，甲胄上的血珠正顺着玄纹滴落。田荣的残兵在巷战中举着残破的楚旗负隅顽抗，而彭越的游击军已绕至济西，截断楚军粮道。帐内，英布捧着密信跪地：“大王，刘邦遣韩信暗渡陈仓，关中已失三城！”项羽猛地掷碎酒盏，琥珀色酒'
2025-09-25 23:55:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=952 预览='{\n  "text": "汉元年冬，齐地烽烟卷着雪粒扑向彭城。项羽立于临淄城外的望台上，霸王枪斜指被战火焚毁的稷门，甲胄上的血珠正顺着玄纹滴落。田荣的残兵在巷战中举着残破的楚旗负隅顽抗，而彭越的游击军已绕至济西，截断楚军粮道。帐内，英布捧着密信跪地：“大王，刘邦遣韩信暗渡陈仓，关中已失三城！”项羽猛地掷碎酒盏，琥珀色酒液溅上钟离眜的脸：“分兵！”范增枯瘦的手指突然按住他的枪柄：“大王，齐地乃西楚左'
2025-09-25 23:55:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 289
2025-09-25 23:55:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:55:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:21 | INFO     | api.story:continue_existing_story:374 - 故事继续生成成功
2025-09-25 23:55:21 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=41 node=120 depth=3
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力荡平齐地
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 留英布镇齐，自率轻骑突袭济西
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 遣陈平持金帛游说田荣旧部
2025-09-25 23:55:21 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4239
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1079 预览='{\n  "text": "戏下楚军大营的烛火映着案上诸侯盟约的残卷，项羽将田荣的反书掷在范增面前，墨迹在烛火中洇开如血。“英布说刘邦已暗通彭越，田荣又在齐地竖起反旗——”他突然攥碎手中玉玦，“你们要的安抚，就是让这些人以为我项羽手软？”范增枯瘦的手指按住案上刘邦的降表，“大王忘了巨鹿之盟？诸侯信的是霸王之威，不是缓兵之仁！”帐外突然传来钟离眜急报：“田荣已封彭越为相国，正率三万甲士逼近济水！”项羽猛地转身，霸王枪枪尖挑开案上的诸侯印绶：“那就让他们看看，我项羽的安抚，是要他们——”他突然顿住，瞥见范增袖中那枚鸿门宴上的铁尺，前世垓下的四面楚歌仿佛又在耳畔响起。“先派随何带黄金百斤去齐地，告诉田'
2025-09-25 23:55:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1079 预览='{\n  "text": "戏下楚军大营的烛火映着案上诸侯盟约的残卷，项羽将田荣的反书掷在范增面前，墨迹在烛火中洇开如血。“英布说刘邦已暗通彭越，田荣又在齐地竖起反旗——”他突然攥碎手中玉玦，“你们要的安抚，就是让这些人以为我项羽手软？”范增枯瘦的手指按住案上刘邦的降表，“大王忘了巨鹿之盟？诸侯信的是霸王之威，不是缓兵之'
2025-09-25 23:55:21 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1079 预览='{\n  "text": "戏下楚军大营的烛火映着案上诸侯盟约的残卷，项羽将田荣的反书掷在范增面前，墨迹在烛火中洇开如血。“英布说刘邦已暗通彭越，田荣又在齐地竖起反旗——”他突然攥碎手中玉玦，“你们要的安抚，就是让这些人以为我项羽手软？”范增枯瘦的手指按住案上刘邦的降表，“大王忘了巨鹿之盟？诸侯信的是霸王之威，不是缓兵之'
2025-09-25 23:55:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1079 预览='{\n  "text": "戏下楚军大营的烛火映着案上诸侯盟约的残卷，项羽将田荣的反书掷在范增面前，墨迹在烛火中洇开如血。“英布说刘邦已暗通彭越，田荣又在齐地竖起反旗——”他突然攥碎手中玉玦，“你们要的安抚，就是让这些人以为我项羽手软？”范增枯瘦的手指按住案上刘邦的降表，“大王忘了巨鹿之盟？诸侯信的是霸王之威，不是缓兵之仁！”帐外突然传来钟离眜急报：“田荣已封彭越为相国，正率三万甲士逼近济水！”项羽'
2025-09-25 23:55:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 444
2025-09-25 23:55:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:55:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:55:21 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:21 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=121 parent=117 choice='缓兵安抚诸侯联盟'
2025-09-25 23:55:23 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4350
2025-09-25 23:55:23 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之战？齐地田氏世代为齐人所敬，若不先平其乱，诸侯必以为我西楚弃齐！”项羽突然拔剑劈开案几，酒盏碎裂声中，他指节因用力而发白：“传令龙且，率三万精兵即刻东进，孤亲率主力断田荣后路！”帐外，英布望着霸王离去的背影，嘴角勾起一抹冷笑，悄然将一枚刻着“汉”字的木符塞进靴筒。",\n  "su'
2025-09-25 23:55:23 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之'
2025-09-25 23:55:23 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之'
2025-09-25 23:55:23 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之战？齐地田氏世代为齐人所敬，若不先平其乱，诸侯必以为我西楚弃齐！”项羽突然拔剑劈'
2025-09-25 23:55:23 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting value: line 15 column 29 (char 721); json_str预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之战？齐地田氏世代为齐人所敬，若不先平其乱，诸侯必以为我西楚弃齐！”项羽突然拔剑劈'
2025-09-25 23:55:30 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3845
2025-09-25 23:55:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1054 预览='{\n  "text": "项羽将刘邦的印绶掷于火盆，火星溅上案上的军报，‘还军霸上’四字竟真的烧出焦痕。他转身对英布道：“你带五千精骑，沿子午道追去。若刘邦敢回头，便斩下他的首级来见！”英布叩首时，项伯突然从帐外踉跄闯入，手中竟捧着刘邦的亲笔信：“大王！刘邦愿以巴蜀之地为质，只求暂缓兵戈——”项羽拔剑劈开信纸，刘邦的字迹却化作血字：“霸王若信，当知天下非一人之天下。”帐外突然传来急促的马蹄声，斥候举着染血的令旗奔入：“大王！英布将军的先锋营遇袭！”项羽瞳孔骤缩，他想起前世乌江亭长的那句“天之亡我，非战之罪”，猛地将霸王枪掷向帐外：“传我将令——”",\n  "success_rate": 65,'
2025-09-25 23:55:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1054 预览='{\n  "text": "项羽将刘邦的印绶掷于火盆，火星溅上案上的军报，‘还军霸上’四字竟真的烧出焦痕。他转身对英布道：“你带五千精骑，沿子午道追去。若刘邦敢回头，便斩下他的首级来见！”英布叩首时，项伯突然从帐外踉跄闯入，手中竟捧着刘邦的亲笔信：“大王！刘邦愿以巴蜀之地为质，只求暂缓兵戈——”项羽拔剑劈开信纸，刘邦的字'
2025-09-25 23:55:30 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1054 预览='{\n  "text": "项羽将刘邦的印绶掷于火盆，火星溅上案上的军报，‘还军霸上’四字竟真的烧出焦痕。他转身对英布道：“你带五千精骑，沿子午道追去。若刘邦敢回头，便斩下他的首级来见！”英布叩首时，项伯突然从帐外踉跄闯入，手中竟捧着刘邦的亲笔信：“大王！刘邦愿以巴蜀之地为质，只求暂缓兵戈——”项羽拔剑劈开信纸，刘邦的字'
2025-09-25 23:55:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1054 预览='{\n  "text": "项羽将刘邦的印绶掷于火盆，火星溅上案上的军报，‘还军霸上’四字竟真的烧出焦痕。他转身对英布道：“你带五千精骑，沿子午道追去。若刘邦敢回头，便斩下他的首级来见！”英布叩首时，项伯突然从帐外踉跄闯入，手中竟捧着刘邦的亲笔信：“大王！刘邦愿以巴蜀之地为质，只求暂缓兵戈——”项羽拔剑劈开信纸，刘邦的字迹却化作血字：“霸王若信，当知天下非一人之天下。”帐外突然传来急促的马蹄声，斥候'
2025-09-25 23:55:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 263
2025-09-25 23:55:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:55:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:55:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:30 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=122 parent=111 choice='借英布追杀刘邦'
2025-09-25 23:55:37 | INFO     | api.story:continue_existing_story:262 - 收到故事继续请求，选择: 亲率主力荡平齐地
2025-09-25 23:55:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力荡平齐地
2025-09-25 23:55:38 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2794
2025-09-25 23:55:38 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之战？齐地田氏世代为齐人所敬，若不先平其乱，诸侯必以为我西楚弃齐！”项羽突然拔剑劈'
2025-09-25 23:55:38 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之'
2025-09-25 23:55:38 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1022 预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之'
2025-09-25 23:55:38 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 15 column 29 (char 721); 原始预览='{\n  "text": "临淄城头的烽火已烧了三日，田荣的黑旗插在齐国故都的角楼，彭越的游兵却像毒蛇般缠上楚军粮道。项羽将钟离眜的急报拍在案上，霸王枪枪尖在地图上划出狰狞血痕——齐地若乱，楚军将成首尾难顾之势。帐内，英布按剑冷笑：“大王何不先破汉中？刘邦小儿新败，正是斩草除根之时！”龙且却怒目圆睁：“英布将军忘了巨鹿之战？齐地田氏世代为齐人所敬，若不先平其乱，诸侯必以为我西楚弃齐！”项羽突然拔剑劈'
2025-09-25 23:55:38 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=117 choice='雷霆镇压齐地叛乱': Expecting value: line 15 column 29 (char 721)
2025-09-25 23:55:38 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率楚军突袭刘邦旧部营地
2025-09-25 23:55:38 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派英布游说彭越，许以梁地王爵
2025-09-25 23:55:38 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暗中散布张良与韩信不和的谣言
2025-09-25 23:55:40 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3611
2025-09-25 23:55:40 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=913 预览='{\n  "text": "汉元年冬，临淄城外的雪已积至马膝。项羽立于望台，霸王枪斜指稷门残垣，枪尖挑着田荣首级的血绳在寒风中晃荡。彭越的游击军已被钟离眜截杀于济西，却有密探来报——刘邦正遣韩信暗渡陈仓，关中三城已失。帐内，英布捧着烧焦的粮袋跪地：“大王，济西粮仓被彭越诈降的楚军烧了！”项羽突然掀翻案几，酒盏碎裂的脆响中，范增枯瘦的手指按住他的枪柄：“大王，齐地民心未附，若分兵西进，刘邦必趁虚而入！”帐外突然传来甲胄铿锵，是虞姬带着楚军家眷跪在雪地里：“大王，田氏遗孤藏于泰山密道......”项羽的瞳孔骤然收缩，枪尖直指帐外：“今日，我要让齐地知道——”",\n  "success_rate": '
2025-09-25 23:55:40 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=913 预览='{\n  "text": "汉元年冬，临淄城外的雪已积至马膝。项羽立于望台，霸王枪斜指稷门残垣，枪尖挑着田荣首级的血绳在寒风中晃荡。彭越的游击军已被钟离眜截杀于济西，却有密探来报——刘邦正遣韩信暗渡陈仓，关中三城已失。帐内，英布捧着烧焦的粮袋跪地：“大王，济西粮仓被彭越诈降的楚军烧了！”项羽突然掀翻案几，酒盏碎裂的脆响中'
2025-09-25 23:55:40 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=913 预览='{\n  "text": "汉元年冬，临淄城外的雪已积至马膝。项羽立于望台，霸王枪斜指稷门残垣，枪尖挑着田荣首级的血绳在寒风中晃荡。彭越的游击军已被钟离眜截杀于济西，却有密探来报——刘邦正遣韩信暗渡陈仓，关中三城已失。帐内，英布捧着烧焦的粮袋跪地：“大王，济西粮仓被彭越诈降的楚军烧了！”项羽突然掀翻案几，酒盏碎裂的脆响中'
2025-09-25 23:55:40 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=913 预览='{\n  "text": "汉元年冬，临淄城外的雪已积至马膝。项羽立于望台，霸王枪斜指稷门残垣，枪尖挑着田荣首级的血绳在寒风中晃荡。彭越的游击军已被钟离眜截杀于济西，却有密探来报——刘邦正遣韩信暗渡陈仓，关中三城已失。帐内，英布捧着烧焦的粮袋跪地：“大王，济西粮仓被彭越诈降的楚军烧了！”项羽突然掀翻案几，酒盏碎裂的脆响中，范增枯瘦的手指按住他的枪柄：“大王，齐地民心未附，若分兵西进，刘邦必趁虚而入！'
2025-09-25 23:55:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 266
2025-09-25 23:55:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:55:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:55:40 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:40 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=123 parent=120 choice='亲率主力荡平齐地'
2025-09-25 23:55:41 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3725
2025-09-25 23:55:41 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1052 预览='{\n  "text": "彭城帅帐的烛火将陈平的影子拉得极长，他捧着鎏金帛书躬身退下时，腰间的青铜剑鞘突然磕在案角。项羽望着帐外飘落的雪片，想起田荣头颅悬于城门时，那些齐地遗民眼中的死寂。\'陈平，\'他突然开口，声音比帐外寒风更冷，\'你若敢假传王命，我会让你尝尝鼎镬之刑。\'陈平脊背一僵，却仍保持着恭敬：\'臣以项氏为天，愿以项氏之血，换齐地百年安宁。\'范增突然掀帘而入，枯瘦的手指死死按住陈平手中的金印：\'大王！此人乃刘邦旧部，昔日鸿门宴上献过假降书！\'项羽却冷笑一声，从案下抽出霸王枪：\'我要的不是忠心，是齐地的粮食和民心。\'陈平的身影消失在风雪中时，帐外突然传来钟离眜急报：\'大王！韩信已破临济，兵'
2025-09-25 23:55:41 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1052 预览='{\n  "text": "彭城帅帐的烛火将陈平的影子拉得极长，他捧着鎏金帛书躬身退下时，腰间的青铜剑鞘突然磕在案角。项羽望着帐外飘落的雪片，想起田荣头颅悬于城门时，那些齐地遗民眼中的死寂。\'陈平，\'他突然开口，声音比帐外寒风更冷，\'你若敢假传王命，我会让你尝尝鼎镬之刑。\'陈平脊背一僵，却仍保持着恭敬：\'臣以项氏为天，愿'
2025-09-25 23:55:41 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1052 预览='{\n  "text": "彭城帅帐的烛火将陈平的影子拉得极长，他捧着鎏金帛书躬身退下时，腰间的青铜剑鞘突然磕在案角。项羽望着帐外飘落的雪片，想起田荣头颅悬于城门时，那些齐地遗民眼中的死寂。\'陈平，\'他突然开口，声音比帐外寒风更冷，\'你若敢假传王命，我会让你尝尝鼎镬之刑。\'陈平脊背一僵，却仍保持着恭敬：\'臣以项氏为天，愿'
2025-09-25 23:55:41 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1052 预览='{\n  "text": "彭城帅帐的烛火将陈平的影子拉得极长，他捧着鎏金帛书躬身退下时，腰间的青铜剑鞘突然磕在案角。项羽望着帐外飘落的雪片，想起田荣头颅悬于城门时，那些齐地遗民眼中的死寂。\'陈平，\'他突然开口，声音比帐外寒风更冷，\'你若敢假传王命，我会让你尝尝鼎镬之刑。\'陈平脊背一僵，却仍保持着恭敬：\'臣以项氏为天，愿以项氏之血，换齐地百年安宁。\'范增突然掀帘而入，枯瘦的手指死死按住陈平手中的金印'
2025-09-25 23:55:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 294
2025-09-25 23:55:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:55:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:55:41 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:41 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=124 parent=120 choice='遣陈平持金帛游说田荣旧部'
2025-09-25 23:55:43 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3980
2025-09-25 23:55:43 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=969 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。\\n\\n“大王！英布将军率主力西撤！”副将季布的嘶吼刺破风雪，项羽猛地旋身，霸王枪横扫出半轮寒月，将射向咽喉的箭矢劈成两段。他望着帐外呼啸的北风，突然想起范增临终前攥着他衣袖的枯手：“齐地不稳，英布必反……”\\n\\n帐外传来钟离眜急促的马蹄声，彭越军主力已绕至楚军后方，而齐地田氏余孽正举着“复齐”大旗攻向临淄。项羽'
2025-09-25 23:55:43 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=969 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。\\n\\n“大王！英布将军率主力西撤！'
2025-09-25 23:55:43 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=969 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。\\n\\n“大王！英布将军率主力西撤！'
2025-09-25 23:55:43 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=969 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。\\n\\n“大王！英布将军率主力西撤！”副将季布的嘶吼刺破风雪，项羽猛地旋身，霸王枪横扫出半轮寒月，将射向咽喉的箭矢劈'
2025-09-25 23:55:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 313
2025-09-25 23:55:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:43 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:55:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:55:43 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:43 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=125 parent=120 choice='留英布镇齐，自率轻骑突袭济西'
2025-09-25 23:55:43 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率重甲营夜袭济西粮仓
2025-09-25 23:55:43 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 遣使招降田氏遗孤
2025-09-25 23:55:43 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 召回虞姬安抚军心
2025-09-25 23:55:59 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3378
2025-09-25 23:55:59 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1002 预览='{\n  "text": "临淄城头的残阳将霸王枪染成血色，项羽拄枪立于断壁上，脚下是齐民举着残破戈矛自焚的焦土。田氏余孽藏于泰山密道的消息刚传至，斥候又报：“汉王刘邦亲率韩信、张良出陈仓，已破雍城，直指咸阳！”帐内，英布的玄甲上还沾着齐地的雪沫，他将密信拍在案上：“大王，刘邦军中有三万锐士，樊哙正率偏师袭扰济水！”项羽突然冷笑，枪尖挑飞案上的“楚地归降图”：“齐地要乱，便让它乱得彻底！”他转身望向帐外风雪，范增枯瘦的手指正攥着半块冻硬的麦饼——那是昨夜士兵分食的军粮。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "回'
2025-09-25 23:55:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1002 预览='{\n  "text": "临淄城头的残阳将霸王枪染成血色，项羽拄枪立于断壁上，脚下是齐民举着残破戈矛自焚的焦土。田氏余孽藏于泰山密道的消息刚传至，斥候又报：“汉王刘邦亲率韩信、张良出陈仓，已破雍城，直指咸阳！”帐内，英布的玄甲上还沾着齐地的雪沫，他将密信拍在案上：“大王，刘邦军中有三万锐士，樊哙正率偏师袭扰济水！”项羽'
2025-09-25 23:55:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1002 预览='{\n  "text": "临淄城头的残阳将霸王枪染成血色，项羽拄枪立于断壁上，脚下是齐民举着残破戈矛自焚的焦土。田氏余孽藏于泰山密道的消息刚传至，斥候又报：“汉王刘邦亲率韩信、张良出陈仓，已破雍城，直指咸阳！”帐内，英布的玄甲上还沾着齐地的雪沫，他将密信拍在案上：“大王，刘邦军中有三万锐士，樊哙正率偏师袭扰济水！”项羽'
2025-09-25 23:55:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1002 预览='{\n  "text": "临淄城头的残阳将霸王枪染成血色，项羽拄枪立于断壁上，脚下是齐民举着残破戈矛自焚的焦土。田氏余孽藏于泰山密道的消息刚传至，斥候又报：“汉王刘邦亲率韩信、张良出陈仓，已破雍城，直指咸阳！”帐内，英布的玄甲上还沾着齐地的雪沫，他将密信拍在案上：“大王，刘邦军中有三万锐士，樊哙正率偏师袭扰济水！”项羽突然冷笑，枪尖挑飞案上的“楚地归降图”：“齐地要乱，便让它乱得彻底！”他转身望向'
2025-09-25 23:55:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 223
2025-09-25 23:55:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:55:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:55:59 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:59 | INFO     | api.story:continue_existing_story:374 - 故事继续生成成功
2025-09-25 23:55:59 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=41 node=123 depth=3
2025-09-25 23:55:59 | INFO     | core.speculation:_run:83 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=41 node=123
2025-09-25 23:55:59 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3582
2025-09-25 23:55:59 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=843 预览='{\n  "text": "楚营的号角划破寒夜，项羽玄甲上的兽面纹在火把下泛着冷光。他亲率八千江东锐士踏破刘邦旧部樊哙的前营，霸王枪挑开帐帘时，正撞见副将周勃举剑自刎。“刘邦的走狗，今日便是你的死期！”项羽枪尖横扫，将七名顽抗的甲士钉在帐柱上。清点俘虏时，钟离眜突然呈上一封密信——“樊将军”血书竟与韩信麾下副将的印鉴盖在一起，墨迹未干的“暗渡陈仓”四字刺得项羽瞳孔生疼。“大王！韩信主力已在城外十里结阵！”英布的吼声撕裂帐内死寂，项羽望着帐外被火光染红的半边天，突然将密信掷向篝火：“传我将令——”",\n  "success_rate": 68,\n  "choices": [\n    {\n     '
2025-09-25 23:55:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=843 预览='{\n  "text": "楚营的号角划破寒夜，项羽玄甲上的兽面纹在火把下泛着冷光。他亲率八千江东锐士踏破刘邦旧部樊哙的前营，霸王枪挑开帐帘时，正撞见副将周勃举剑自刎。“刘邦的走狗，今日便是你的死期！”项羽枪尖横扫，将七名顽抗的甲士钉在帐柱上。清点俘虏时，钟离眜突然呈上一封密信——“樊将军”血书竟与韩信麾下副将的印鉴盖在'
2025-09-25 23:55:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=843 预览='{\n  "text": "楚营的号角划破寒夜，项羽玄甲上的兽面纹在火把下泛着冷光。他亲率八千江东锐士踏破刘邦旧部樊哙的前营，霸王枪挑开帐帘时，正撞见副将周勃举剑自刎。“刘邦的走狗，今日便是你的死期！”项羽枪尖横扫，将七名顽抗的甲士钉在帐柱上。清点俘虏时，钟离眜突然呈上一封密信——“樊将军”血书竟与韩信麾下副将的印鉴盖在'
2025-09-25 23:55:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=843 预览='{\n  "text": "楚营的号角划破寒夜，项羽玄甲上的兽面纹在火把下泛着冷光。他亲率八千江东锐士踏破刘邦旧部樊哙的前营，霸王枪挑开帐帘时，正撞见副将周勃举剑自刎。“刘邦的走狗，今日便是你的死期！”项羽枪尖横扫，将七名顽抗的甲士钉在帐柱上。清点俘虏时，钟离眜突然呈上一封密信——“樊将军”血书竟与韩信麾下副将的印鉴盖在一起，墨迹未干的“暗渡陈仓”四字刺得项羽瞳孔生疼。“大王！韩信主力已在城外十里结'
2025-09-25 23:55:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 236
2025-09-25 23:55:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:55:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:55:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:55:59 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:55:59 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=126 parent=119 choice='亲率楚军突袭刘邦旧部营地'
2025-09-25 23:56:01 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3650
2025-09-25 23:56:01 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=876 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖突然指向帐外密报：‘刘邦已破陈仓，灌婴正率三万骑兵西进！’他攥紧枪柄，指节泛白：‘传我军令——’",\n  "success_rate": 68,\n  "choices": [\n    {\n      '
2025-09-25 23:56:01 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=876 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地'
2025-09-25 23:56:01 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=876 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地'
2025-09-25 23:56:01 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=876 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖'
2025-09-25 23:56:01 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 235
2025-09-25 23:56:01 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:01 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:56:01 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:56:01 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:01 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=127 parent=123 choice='遣使招降田氏遗孤'
2025-09-25 23:56:04 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3820
2025-09-25 23:56:04 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=876 预览='{\n  "text": "戏下大营的铜漏滴答作响，项羽将刘邦的降表掷在案上，墨迹洇开如血。范增枯瘦的手指在‘愿为西楚王屏藩’的字句上划了道深痕：‘大王若留此獠，他日必成心腹大患！’项伯却挡在帐前，手中握着项羽早年赠予的玉珏：‘兄长曾言，暴秦不除，天下何安？刘邦虽诈，却可暂作人质。’帐外突然传来斥候急报：‘汉王旧部樊哙率千人抵函谷关，扬言要迎主还都！’项羽猛地拔剑劈向案上铜灯，火星溅在刘邦印绶上，映得‘汉’字猩红刺眼。他转身看向英布、钟离眜：‘三日内，我要知道——是让这颗棋子彻底失效，还是让它成为刺向诸侯的利刃！’",\n  "success_rate": 60,\n  "choices": [\n '
2025-09-25 23:56:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=876 预览='{\n  "text": "戏下大营的铜漏滴答作响，项羽将刘邦的降表掷在案上，墨迹洇开如血。范增枯瘦的手指在‘愿为西楚王屏藩’的字句上划了道深痕：‘大王若留此獠，他日必成心腹大患！’项伯却挡在帐前，手中握着项羽早年赠予的玉珏：‘兄长曾言，暴秦不除，天下何安？刘邦虽诈，却可暂作人质。’帐外突然传来斥候急报：‘汉王旧部樊哙率'
2025-09-25 23:56:04 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=876 预览='{\n  "text": "戏下大营的铜漏滴答作响，项羽将刘邦的降表掷在案上，墨迹洇开如血。范增枯瘦的手指在‘愿为西楚王屏藩’的字句上划了道深痕：‘大王若留此獠，他日必成心腹大患！’项伯却挡在帐前，手中握着项羽早年赠予的玉珏：‘兄长曾言，暴秦不除，天下何安？刘邦虽诈，却可暂作人质。’帐外突然传来斥候急报：‘汉王旧部樊哙率'
2025-09-25 23:56:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=876 预览='{\n  "text": "戏下大营的铜漏滴答作响，项羽将刘邦的降表掷在案上，墨迹洇开如血。范增枯瘦的手指在‘愿为西楚王屏藩’的字句上划了道深痕：‘大王若留此獠，他日必成心腹大患！’项伯却挡在帐前，手中握着项羽早年赠予的玉珏：‘兄长曾言，暴秦不除，天下何安？刘邦虽诈，却可暂作人质。’帐外突然传来斥候急报：‘汉王旧部樊哙率千人抵函谷关，扬言要迎主还都！’项羽猛地拔剑劈向案上铜灯，火星溅在刘邦印绶上，映'
2025-09-25 23:56:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 246
2025-09-25 23:56:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:56:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:56:04 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:04 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=128 parent=111 choice='软禁刘邦为人质'
2025-09-25 23:56:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 直捣汉中：亲率楚军突袭刘邦封地
2025-09-25 23:56:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 诸侯会盟：以鸿门宴旧怨为由削夺刘邦麾下诸侯兵权
2025-09-25 23:56:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 安抚诸侯：以霸王私库珍宝赏赐英布、彭越等异姓王
2025-09-25 23:56:05 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4382
2025-09-25 23:56:05 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=980 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是英布截获的韩信密信，墨迹未干的“张良掣肘”四字被朱砂圈出；右首是钟离眜快马送来的急报，言张良亲率三万锐士星夜北上，在齐楚边境安营扎寨。项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上的“反”字，突然冷笑：“韩信这匹狼崽子，果然上钩了。”范增枯瘦的手指按住密信：“大王，张良素有‘运筹帷幄’之名，若韩信真反，必是张良设局。”项羽剑眉倒竖，枪尖在案上划出火星：“那就让他们演一场戏给天下看！”帐外突然传来甲胄铿锵，英布带着一队楚军冲入，跪地呈上竹简：“大王！刘邦旧部雍齿在南阳散布谣言，说您欲杀尽六国贵族！”项羽瞳孔骤缩，霸王枪枪'
2025-09-25 23:56:05 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=980 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是英布截获的韩信密信，墨迹未干的“张良掣肘”四字被朱砂圈出；右首是钟离眜快马送来的急报，言张良亲率三万锐士星夜北上，在齐楚边境安营扎寨。项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上的“反”字，突然冷笑：“韩信这匹狼崽子，果然上钩了。”范增枯瘦的'
2025-09-25 23:56:05 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=980 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是英布截获的韩信密信，墨迹未干的“张良掣肘”四字被朱砂圈出；右首是钟离眜快马送来的急报，言张良亲率三万锐士星夜北上，在齐楚边境安营扎寨。项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上的“反”字，突然冷笑：“韩信这匹狼崽子，果然上钩了。”范增枯瘦的'
2025-09-25 23:56:05 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=980 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是英布截获的韩信密信，墨迹未干的“张良掣肘”四字被朱砂圈出；右首是钟离眜快马送来的急报，言张良亲率三万锐士星夜北上，在齐楚边境安营扎寨。项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上的“反”字，突然冷笑：“韩信这匹狼崽子，果然上钩了。”范增枯瘦的手指按住密信：“大王，张良素有‘运筹帷幄’之名，若韩信真反，必是张良设局。”项羽'
2025-09-25 23:56:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 309
2025-09-25 23:56:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:56:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:56:05 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:05 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=129 parent=119 choice='暗中散布张良与韩信不和的谣言'
2025-09-25 23:56:08 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4410
2025-09-25 23:56:08 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=873 预览='{\n  "text": "汉元年冬，临淄城外的雪粒如铁砂砸在霸王甲胄上。项羽将钟离眜的急报掷在案上，‘韩信破陈仓’四字被血指抠出深深的凹痕。帐外突然传来虞姬的环佩叮当——她竟从彭城偷跑而来，玄色披风上还沾着齐地的雪。‘大王，’虞姬跪在帐前，声音发颤却目光清亮，‘英布昨夜密会刘邦使者，楚军西道已断！’项羽攥紧枪柄，枪缨扫过案上范增的密信：‘他说刘邦愿以三万户换英布投诚。’虞姬突然抓住他的手腕，掌心的朱砂痣烫得他生疼：‘大王忘了鸿门宴上，范增三次举玦吗？’帐外突然传来甲胄铿锵，是季布带着一队死士闯入，剑刃映着雪光：‘大王！田氏余孽藏于泰山密道！’项羽瞳孔骤缩，枪尖直指帐外：‘今日，我要让齐地知道—'
2025-09-25 23:56:08 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=873 预览='{\n  "text": "汉元年冬，临淄城外的雪粒如铁砂砸在霸王甲胄上。项羽将钟离眜的急报掷在案上，‘韩信破陈仓’四字被血指抠出深深的凹痕。帐外突然传来虞姬的环佩叮当——她竟从彭城偷跑而来，玄色披风上还沾着齐地的雪。‘大王，’虞姬跪在帐前，声音发颤却目光清亮，‘英布昨夜密会刘邦使者，楚军西道已断！’项羽攥紧枪柄，枪缨扫'
2025-09-25 23:56:08 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=873 预览='{\n  "text": "汉元年冬，临淄城外的雪粒如铁砂砸在霸王甲胄上。项羽将钟离眜的急报掷在案上，‘韩信破陈仓’四字被血指抠出深深的凹痕。帐外突然传来虞姬的环佩叮当——她竟从彭城偷跑而来，玄色披风上还沾着齐地的雪。‘大王，’虞姬跪在帐前，声音发颤却目光清亮，‘英布昨夜密会刘邦使者，楚军西道已断！’项羽攥紧枪柄，枪缨扫'
2025-09-25 23:56:08 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=873 预览='{\n  "text": "汉元年冬，临淄城外的雪粒如铁砂砸在霸王甲胄上。项羽将钟离眜的急报掷在案上，‘韩信破陈仓’四字被血指抠出深深的凹痕。帐外突然传来虞姬的环佩叮当——她竟从彭城偷跑而来，玄色披风上还沾着齐地的雪。‘大王，’虞姬跪在帐前，声音发颤却目光清亮，‘英布昨夜密会刘邦使者，楚军西道已断！’项羽攥紧枪柄，枪缨扫过案上范增的密信：‘他说刘邦愿以三万户换英布投诚。’虞姬突然抓住他的手腕，掌心的'
2025-09-25 23:56:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 289
2025-09-25 23:56:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:56:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:56:08 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:08 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=130 parent=123 choice='召回虞姬安抚军心'
2025-09-25 23:56:12 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4886
2025-09-25 23:56:12 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=938 预览='{\n  "text": "汉元年冬，济西雪原的寒星映着重甲营的铁蹄声。项羽率八百玄甲士衔枚疾行，霸王枪挑着的狼火在雪幕中划出猩红弧线——粮仓外的楚军斥候已被彭越的死士割喉，喉管里涌出的血在雪地上凝成暗红冰花。“点火！”项羽低喝，玄甲上的兽面纹在火光中狰狞。粮仓木门轰然碎裂时，彭越的伏兵突然从粮囤后涌出，箭矢如蝗。项羽枪尖横扫，挑飞三枚火箭，却见粮囤里滚出的不是粮草，而是刘邦的虎符印匣！“大王！”英布的怒吼从侧翼传来，他正率人围剿彭越主力，却被齐地田氏的暗箭射穿肩胛。项羽瞳孔骤缩，虎符上的“汉”字在火光中泛着冷光——这不是陷阱，而是彭越故意留下的诱饵！",\n  "success_rate": 6'
2025-09-25 23:56:12 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=938 预览='{\n  "text": "汉元年冬，济西雪原的寒星映着重甲营的铁蹄声。项羽率八百玄甲士衔枚疾行，霸王枪挑着的狼火在雪幕中划出猩红弧线——粮仓外的楚军斥候已被彭越的死士割喉，喉管里涌出的血在雪地上凝成暗红冰花。“点火！”项羽低喝，玄甲上的兽面纹在火光中狰狞。粮仓木门轰然碎裂时，彭越的伏兵突然从粮囤后涌出，箭矢如蝗。项羽枪'
2025-09-25 23:56:12 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=938 预览='{\n  "text": "汉元年冬，济西雪原的寒星映着重甲营的铁蹄声。项羽率八百玄甲士衔枚疾行，霸王枪挑着的狼火在雪幕中划出猩红弧线——粮仓外的楚军斥候已被彭越的死士割喉，喉管里涌出的血在雪地上凝成暗红冰花。“点火！”项羽低喝，玄甲上的兽面纹在火光中狰狞。粮仓木门轰然碎裂时，彭越的伏兵突然从粮囤后涌出，箭矢如蝗。项羽枪'
2025-09-25 23:56:12 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=938 预览='{\n  "text": "汉元年冬，济西雪原的寒星映着重甲营的铁蹄声。项羽率八百玄甲士衔枚疾行，霸王枪挑着的狼火在雪幕中划出猩红弧线——粮仓外的楚军斥候已被彭越的死士割喉，喉管里涌出的血在雪地上凝成暗红冰花。“点火！”项羽低喝，玄甲上的兽面纹在火光中狰狞。粮仓木门轰然碎裂时，彭越的伏兵突然从粮囤后涌出，箭矢如蝗。项羽枪尖横扫，挑飞三枚火箭，却见粮囤里滚出的不是粮草，而是刘邦的虎符印匣！“大王！”英'
2025-09-25 23:56:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 265
2025-09-25 23:56:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:56:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:56:12 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:12 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=131 parent=123 choice='亲率重甲营夜袭济西粮仓'
2025-09-25 23:56:12 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派英布率三万楚军精锐护送陈平入齐
2025-09-25 23:56:12 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 令陈平孤身前往齐地，暗中联络田荣旧部中的中立派
2025-09-25 23:56:12 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 项羽亲率主力威慑临淄，同时派陈平暗中游说田荣旧部
2025-09-25 23:56:23 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3221
2025-09-25 23:56:23 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整军，若诸侯离心，恐成大患！”项羽转身，霸王枪挑落案上的诸侯名册——刘邦的名字被红笔圈出，墨迹里渗出暗红的血痕。帐外突然传来急促的马蹄声，斥候举着染血的战报闯入：“大王！刘邦已在陈仓筑城，韩信率三万锐士直逼废丘！”项羽猛地攥紧枪杆，枪尖迸出火星：“传令英布，今夜拔营！”",\n  "'
2025-09-25 23:56:23 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整'
2025-09-25 23:56:23 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整'
2025-09-25 23:56:23 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整军，若诸侯离心，恐成大患！”项羽转身，霸王枪挑落案上的诸侯名册——刘邦的名字被红'
2025-09-25 23:56:23 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting value: line 15 column 29 (char 686); json_str预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整军，若诸侯离心，恐成大患！”项羽转身，霸王枪挑落案上的诸侯名册——刘邦的名字被红'
2025-09-25 23:56:24 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3373
2025-09-25 23:56:24 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=876 预览='{\n  "text": "楚军的铁蹄踏碎褒斜道的晨霜时，刘邦的斥候还在秦岭深处醉卧。项羽勒马于陈仓古道，霸王枪挑着刘邦布防图，枪尖血珠坠在“韩信”二字上——昨夜英布密报，韩信已率三万锐士绕出子午谷。“全军加速！”项羽声如裂帛，身后楚军却突然骚动。英布的黥面在火把下泛着油光：“大王，章邯旧部在废丘哗变，若分兵平叛，汉中必失！”项羽冷笑收枪，枪尖挑飞帐外送来的降书——那是刘邦昨夜写的“愿献巴蜀三郡”，墨迹未干。",\n  "success_rate": 65,\n  "choices": [\n    {\n      "option": "直取汉中，留英布断后",\n      "summary": "项'
2025-09-25 23:56:24 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=876 预览='{\n  "text": "楚军的铁蹄踏碎褒斜道的晨霜时，刘邦的斥候还在秦岭深处醉卧。项羽勒马于陈仓古道，霸王枪挑着刘邦布防图，枪尖血珠坠在“韩信”二字上——昨夜英布密报，韩信已率三万锐士绕出子午谷。“全军加速！”项羽声如裂帛，身后楚军却突然骚动。英布的黥面在火把下泛着油光：“大王，章邯旧部在废丘哗变，若分兵平叛，汉中必'
2025-09-25 23:56:24 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=876 预览='{\n  "text": "楚军的铁蹄踏碎褒斜道的晨霜时，刘邦的斥候还在秦岭深处醉卧。项羽勒马于陈仓古道，霸王枪挑着刘邦布防图，枪尖血珠坠在“韩信”二字上——昨夜英布密报，韩信已率三万锐士绕出子午谷。“全军加速！”项羽声如裂帛，身后楚军却突然骚动。英布的黥面在火把下泛着油光：“大王，章邯旧部在废丘哗变，若分兵平叛，汉中必'
2025-09-25 23:56:24 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=876 预览='{\n  "text": "楚军的铁蹄踏碎褒斜道的晨霜时，刘邦的斥候还在秦岭深处醉卧。项羽勒马于陈仓古道，霸王枪挑着刘邦布防图，枪尖血珠坠在“韩信”二字上——昨夜英布密报，韩信已率三万锐士绕出子午谷。“全军加速！”项羽声如裂帛，身后楚军却突然骚动。英布的黥面在火把下泛着油光：“大王，章邯旧部在废丘哗变，若分兵平叛，汉中必失！”项羽冷笑收枪，枪尖挑飞帐外送来的降书——那是刘邦昨夜写的“愿献巴蜀三郡”，'
2025-09-25 23:56:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 192
2025-09-25 23:56:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:56:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:56:24 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:24 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=132 parent=112 choice='直捣汉中：亲率楚军突袭刘邦封地'
2025-09-25 23:56:29 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3421
2025-09-25 23:56:29 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=987 预览='{\n  "text": "临淄城头的残旗在寒风中抖得更凶，项羽的霸王枪斜挑着田荣首级悬于城门，血珠顺着枪尖滴在雪地里，融成暗红的花。陈平捧着密信跪地时，腰间青铜剑鞘突然磕在案角——那是刘邦旧部季布昨夜送来的密信，言韩信已破临济，兵锋直指平原。项羽冷笑一声将密信掷入火盆，火星溅上陈平沾着齐地泥土的靴底：\'田荣旧部已降？\'陈平额角青筋暴起：\'是，臣以范增旧印为信物，说服田氏遗孤田横率五千甲士归降。\'帐外突然传来钟离眜急报：\'大王！英布将军率楚军西进，却在济水遇刘邦伏兵！\'项羽攥紧枪杆，枪缨因急怒而颤抖，他望向帐外飘落的雪片，想起垓下之围时虞姬自刎的血色——这一次，他要让天下人知道，西楚霸王的刀，从'
2025-09-25 23:56:29 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=987 预览='{\n  "text": "临淄城头的残旗在寒风中抖得更凶，项羽的霸王枪斜挑着田荣首级悬于城门，血珠顺着枪尖滴在雪地里，融成暗红的花。陈平捧着密信跪地时，腰间青铜剑鞘突然磕在案角——那是刘邦旧部季布昨夜送来的密信，言韩信已破临济，兵锋直指平原。项羽冷笑一声将密信掷入火盆，火星溅上陈平沾着齐地泥土的靴底：\'田荣旧部已降？\''
2025-09-25 23:56:29 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=987 预览='{\n  "text": "临淄城头的残旗在寒风中抖得更凶，项羽的霸王枪斜挑着田荣首级悬于城门，血珠顺着枪尖滴在雪地里，融成暗红的花。陈平捧着密信跪地时，腰间青铜剑鞘突然磕在案角——那是刘邦旧部季布昨夜送来的密信，言韩信已破临济，兵锋直指平原。项羽冷笑一声将密信掷入火盆，火星溅上陈平沾着齐地泥土的靴底：\'田荣旧部已降？\''
2025-09-25 23:56:29 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=987 预览='{\n  "text": "临淄城头的残旗在寒风中抖得更凶，项羽的霸王枪斜挑着田荣首级悬于城门，血珠顺着枪尖滴在雪地里，融成暗红的花。陈平捧着密信跪地时，腰间青铜剑鞘突然磕在案角——那是刘邦旧部季布昨夜送来的密信，言韩信已破临济，兵锋直指平原。项羽冷笑一声将密信掷入火盆，火星溅上陈平沾着齐地泥土的靴底：\'田荣旧部已降？\'陈平额角青筋暴起：\'是，臣以范增旧印为信物，说服田氏遗孤田横率五千甲士归降。\'帐'
2025-09-25 23:56:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 291
2025-09-25 23:56:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:56:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:56:29 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:29 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=133 parent=124 choice='项羽亲率主力威慑临淄，同时派陈平暗中游说田荣旧部'
2025-09-25 23:56:29 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3955
2025-09-25 23:56:29 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=943 预览='{\n  "text": "戏下会盟的余温尚未散尽，项羽私库的金珠却已在英布、彭越的甲胄上染开金辉。帐外传来诸侯们的欢呼，而范增枯瘦的手指正摩挲着案上的《兵法》残卷——那是他从鸿门宴带出的孤本。\'大王，\'英布突然单膝跪地，黥面在火把下泛着油光，\'彭越已率三万越甲暗渡济水，愿为先锋直捣汉中！\'项羽冷笑掷杯，琥珀酒液溅在范增的玉玦上：\'刘邦的密使昨夜已潜入咸阳，章邯将军的降卒营中，有楚歌四起。\'他突然拔出霸王枪，枪尖挑着一枚染血的帛书——正是刘邦写给英布的密信。范增突然咳嗽起来，咳出的血沫染红了玉玦：\'大王，赏银可买一时安稳，却买不了天下人心。\'",\n  "success_rate": 65,\n  '
2025-09-25 23:56:29 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=943 预览='{\n  "text": "戏下会盟的余温尚未散尽，项羽私库的金珠却已在英布、彭越的甲胄上染开金辉。帐外传来诸侯们的欢呼，而范增枯瘦的手指正摩挲着案上的《兵法》残卷——那是他从鸿门宴带出的孤本。\'大王，\'英布突然单膝跪地，黥面在火把下泛着油光，\'彭越已率三万越甲暗渡济水，愿为先锋直捣汉中！\'项羽冷笑掷杯，琥珀酒液溅在范增'
2025-09-25 23:56:29 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=943 预览='{\n  "text": "戏下会盟的余温尚未散尽，项羽私库的金珠却已在英布、彭越的甲胄上染开金辉。帐外传来诸侯们的欢呼，而范增枯瘦的手指正摩挲着案上的《兵法》残卷——那是他从鸿门宴带出的孤本。\'大王，\'英布突然单膝跪地，黥面在火把下泛着油光，\'彭越已率三万越甲暗渡济水，愿为先锋直捣汉中！\'项羽冷笑掷杯，琥珀酒液溅在范增'
2025-09-25 23:56:29 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=943 预览='{\n  "text": "戏下会盟的余温尚未散尽，项羽私库的金珠却已在英布、彭越的甲胄上染开金辉。帐外传来诸侯们的欢呼，而范增枯瘦的手指正摩挲着案上的《兵法》残卷——那是他从鸿门宴带出的孤本。\'大王，\'英布突然单膝跪地，黥面在火把下泛着油光，\'彭越已率三万越甲暗渡济水，愿为先锋直捣汉中！\'项羽冷笑掷杯，琥珀酒液溅在范增的玉玦上：\'刘邦的密使昨夜已潜入咸阳，章邯将军的降卒营中，有楚歌四起。\'他突然拔'
2025-09-25 23:56:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 260
2025-09-25 23:56:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:56:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:56:29 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:29 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=134 parent=112 choice='安抚诸侯：以霸王私库珍宝赏赐英布、彭越等异姓王'
2025-09-25 23:56:29 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3778
2025-09-25 23:56:29 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1045 预览='{\n  "text": "汉元年冬，雪落彭城三日未歇。项羽立于戏马台箭楼上，看着英布的玄甲军阵如潮水般涌出北门，三万楚军精锐的铁蹄踏碎积雪，在青石板上留下深深蹄印。陈平捧着鎏金印符立于马前，腰间玉佩随寒风轻响：“大王，臣此去必以项氏之血，换齐地归心。”英布勒马回头，猩红披风扫过雪地：“陈平先生，若齐人负约，末将的霸王枪会先斩了他的头颅！”项羽突然掷下腰间佩剑，剑鞘撞在箭楼栏杆上发出闷响：“英布，你若敢私吞田荣旧部的粮草，我会让你尝尝‘五马分尸’的滋味！”雪幕中，陈平的身影渐渐远去。项羽转身时，瞥见范增枯瘦的手指正掐着掌心——这位七十岁的老者昨夜咳血不止，却仍在帅案上画着齐地舆图，“韩信”二字被'
2025-09-25 23:56:29 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1045 预览='{\n  "text": "汉元年冬，雪落彭城三日未歇。项羽立于戏马台箭楼上，看着英布的玄甲军阵如潮水般涌出北门，三万楚军精锐的铁蹄踏碎积雪，在青石板上留下深深蹄印。陈平捧着鎏金印符立于马前，腰间玉佩随寒风轻响：“大王，臣此去必以项氏之血，换齐地归心。”英布勒马回头，猩红披风扫过雪地：“陈平先生，若齐人负约，末将的霸王枪'
2025-09-25 23:56:29 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1045 预览='{\n  "text": "汉元年冬，雪落彭城三日未歇。项羽立于戏马台箭楼上，看着英布的玄甲军阵如潮水般涌出北门，三万楚军精锐的铁蹄踏碎积雪，在青石板上留下深深蹄印。陈平捧着鎏金印符立于马前，腰间玉佩随寒风轻响：“大王，臣此去必以项氏之血，换齐地归心。”英布勒马回头，猩红披风扫过雪地：“陈平先生，若齐人负约，末将的霸王枪'
2025-09-25 23:56:29 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1045 预览='{\n  "text": "汉元年冬，雪落彭城三日未歇。项羽立于戏马台箭楼上，看着英布的玄甲军阵如潮水般涌出北门，三万楚军精锐的铁蹄踏碎积雪，在青石板上留下深深蹄印。陈平捧着鎏金印符立于马前，腰间玉佩随寒风轻响：“大王，臣此去必以项氏之血，换齐地归心。”英布勒马回头，猩红披风扫过雪地：“陈平先生，若齐人负约，末将的霸王枪会先斩了他的头颅！”项羽突然掷下腰间佩剑，剑鞘撞在箭楼栏杆上发出闷响：“英布，你'
2025-09-25 23:56:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 400
2025-09-25 23:56:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:56:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:56:29 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:29 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=135 parent=124 choice='派英布率三万楚军精锐护送陈平入齐'
2025-09-25 23:56:30 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3702
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1008 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将半块雕龙玉佩掷给英布，玉坠上‘霸王’二字被炭火烤得发烫：‘彭越狼子野心，你带三百亲卫去梁地，告诉他——要么做楚地王，要么让他的头颅滚回彭城祭旗。’英布接过玉佩时，指节因用力而泛白，腰间霸王枪的枪缨扫过案上‘韩信拥齐’的军报，枪尖挑起的火星在雪光里划出弧线。三日后，英布的玄甲部队刚过鸿沟，彭越的使者已在楚军前营递上密信：‘梁王愿降，只求见霸王一面，面陈梁地十万甲士归楚之策。’项羽摩挲着玉佩上的裂纹，突然冷笑：‘他想见我？’帐外突然传来急促的甲胄声，钟离眜带着一队死士闯入，跪地呈上一卷血书：‘大王！彭越昨夜与刘邦密会于'
2025-09-25 23:56:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1008 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将半块雕龙玉佩掷给英布，玉坠上‘霸王’二字被炭火烤得发烫：‘彭越狼子野心，你带三百亲卫去梁地，告诉他——要么做楚地王，要么让他的头颅滚回彭城祭旗。’英布接过玉佩时，指节因用力而泛白，腰间霸王枪的枪缨扫过案上‘韩信拥齐’的军报，枪尖挑起的火星在'
2025-09-25 23:56:30 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1008 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将半块雕龙玉佩掷给英布，玉坠上‘霸王’二字被炭火烤得发烫：‘彭越狼子野心，你带三百亲卫去梁地，告诉他——要么做楚地王，要么让他的头颅滚回彭城祭旗。’英布接过玉佩时，指节因用力而泛白，腰间霸王枪的枪缨扫过案上‘韩信拥齐’的军报，枪尖挑起的火星在'
2025-09-25 23:56:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1008 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将半块雕龙玉佩掷给英布，玉坠上‘霸王’二字被炭火烤得发烫：‘彭越狼子野心，你带三百亲卫去梁地，告诉他——要么做楚地王，要么让他的头颅滚回彭城祭旗。’英布接过玉佩时，指节因用力而泛白，腰间霸王枪的枪缨扫过案上‘韩信拥齐’的军报，枪尖挑起的火星在雪光里划出弧线。三日后，英布的玄甲部队刚过鸿沟，彭越的使者已在楚军前营递上密信：'
2025-09-25 23:56:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 302
2025-09-25 23:56:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:56:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:30 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=136 parent=119 choice='派英布游说彭越，许以梁地王爵'
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率楚军精锐突袭齐地
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 册封田荣为齐王并划地
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以虞姬遗物玉簪安抚英布
2025-09-25 23:56:30 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3642
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=873 预览='{\n  "text": "彭城帅帐的铜漏已过三更，项羽将陈平带回的密信揉得粉碎。\'田横说，中立派愿归楚，但需霸王亲至临淄盟誓。\'英布的声音在帐内回荡，甲胄上的血污与酒气混在一起。范增突然掀帘而入，枯瘦的手指指向案上的军报：\'大王！韩信已破历下，兵锋直指平原！\'项羽猛地攥碎酒盏，琥珀色酒液在案上洇出血色：\'传我将令——\'他突然停住，目光扫过帐内沉默的钟离眜与季布，\'陈平若敢欺瞒，我要让齐地血流成河！\'",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "亲率楚军主力驰援齐地",\n      "summary": "项羽亲征临'
2025-09-25 23:56:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=873 预览='{\n  "text": "彭城帅帐的铜漏已过三更，项羽将陈平带回的密信揉得粉碎。\'田横说，中立派愿归楚，但需霸王亲至临淄盟誓。\'英布的声音在帐内回荡，甲胄上的血污与酒气混在一起。范增突然掀帘而入，枯瘦的手指指向案上的军报：\'大王！韩信已破历下，兵锋直指平原！\'项羽猛地攥碎酒盏，琥珀色酒液在案上洇出血色：\'传我将令——\''
2025-09-25 23:56:30 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=873 预览='{\n  "text": "彭城帅帐的铜漏已过三更，项羽将陈平带回的密信揉得粉碎。\'田横说，中立派愿归楚，但需霸王亲至临淄盟誓。\'英布的声音在帐内回荡，甲胄上的血污与酒气混在一起。范增突然掀帘而入，枯瘦的手指指向案上的军报：\'大王！韩信已破历下，兵锋直指平原！\'项羽猛地攥碎酒盏，琥珀色酒液在案上洇出血色：\'传我将令——\''
2025-09-25 23:56:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=873 预览='{\n  "text": "彭城帅帐的铜漏已过三更，项羽将陈平带回的密信揉得粉碎。\'田横说，中立派愿归楚，但需霸王亲至临淄盟誓。\'英布的声音在帐内回荡，甲胄上的血污与酒气混在一起。范增突然掀帘而入，枯瘦的手指指向案上的军报：\'大王！韩信已破历下，兵锋直指平原！\'项羽猛地攥碎酒盏，琥珀色酒液在案上洇出血色：\'传我将令——\'他突然停住，目光扫过帐内沉默的钟离眜与季布，\'陈平若敢欺瞒，我要让齐地血流成河！'
2025-09-25 23:56:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 188
2025-09-25 23:56:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:56:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:30 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=137 parent=124 choice='令陈平孤身前往齐地，暗中联络田荣旧部中的中立派'
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 直捣彭越中军
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 遣使安抚英布
2025-09-25 23:56:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 回师稳定齐地
2025-09-25 23:56:36 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=105 choice='弃城突围，暂投广陵': Request timed out.
2025-09-25 23:56:36 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派孙乾星夜南下许昌，以'让徐州'为诱饵求曹操出兵
2025-09-25 23:56:41 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 2919
2025-09-25 23:56:41 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整军，若诸侯离心，恐成大患！”项羽转身，霸王枪挑落案上的诸侯名册——刘邦的名字被红'
2025-09-25 23:56:41 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整'
2025-09-25 23:56:41 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=977 预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整'
2025-09-25 23:56:41 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 15 column 29 (char 686); 原始预览='{\n  "text": "戏下会盟的玉案上，项羽将刻着“鸿门宴”的青铜令牌重重砸下，玉碎声震得烛火乱颤。“刘邦伪称‘闭关守函谷’，实则暗通三秦，今日便要削其麾下诸侯兵权！”他的声浪撞得帐壁上的诸侯甲胄叮当作响。英布的黥面泛起冷笑：“末将愿率五千精骑，踏平殷王司马卬的封地！”章邯却突然叩首：“大王，刘邦麾下韩信已在陈仓整军，若诸侯离心，恐成大患！”项羽转身，霸王枪挑落案上的诸侯名册——刘邦的名字被红'
2025-09-25 23:56:41 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=112 choice='诸侯会盟：以鸿门宴旧怨为由削夺刘邦麾下诸侯兵权': Expecting value: line 15 column 29 (char 686)
2025-09-25 23:56:41 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 将义帝迁往郴县，遣英布部监视
2025-09-25 23:56:41 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 保留义帝在彭城，封刘邦为汉王，划汉中封地
2025-09-25 23:56:41 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 尊义帝为'楚之共主'，设'楚制'盟誓，以项氏宗亲为诸侯相
2025-09-25 23:56:47 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3558
2025-09-25 23:56:47 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1022 预览='{\n  "text": "汉元年十月，齐地晨雾未散，项羽的玄甲已染霜华。他将霸王枪斜倚案前，枪尖挑着田荣的反旗——三日前田荣以‘楚不王六国’为名竖起反旗，此刻正率三万甲士围困济水。‘钟离眜率五千轻骑为先锋，季布带左翼！’项羽突然拔剑劈开舆图，剑刃划破‘济水’二字，‘本王亲率中军，今夜踏平临淄！’帐外传来甲胄摩擦声，范增枯瘦的手指死死按住舆图：‘大王！刘邦已在武关集结十万甲士！’项羽冷笑一声，枪尖挑开范增的手：‘他敢动，就让他尝尝霸王的雷霆！’楚军铁骑踏破晨雾时，济水两岸芦苇丛中突然杀出两千弩兵，箭矢如蝗。项羽横枪立马于阵前，霸王枪卷起漫天血雨，枪尖挑落田荣亲卫的青铜面具。‘传我令——’话音未落'
2025-09-25 23:56:47 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1022 预览='{\n  "text": "汉元年十月，齐地晨雾未散，项羽的玄甲已染霜华。他将霸王枪斜倚案前，枪尖挑着田荣的反旗——三日前田荣以‘楚不王六国’为名竖起反旗，此刻正率三万甲士围困济水。‘钟离眜率五千轻骑为先锋，季布带左翼！’项羽突然拔剑劈开舆图，剑刃划破‘济水’二字，‘本王亲率中军，今夜踏平临淄！’帐外传来甲胄摩擦声，范增'
2025-09-25 23:56:47 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1022 预览='{\n  "text": "汉元年十月，齐地晨雾未散，项羽的玄甲已染霜华。他将霸王枪斜倚案前，枪尖挑着田荣的反旗——三日前田荣以‘楚不王六国’为名竖起反旗，此刻正率三万甲士围困济水。‘钟离眜率五千轻骑为先锋，季布带左翼！’项羽突然拔剑劈开舆图，剑刃划破‘济水’二字，‘本王亲率中军，今夜踏平临淄！’帐外传来甲胄摩擦声，范增'
2025-09-25 23:56:47 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1022 预览='{\n  "text": "汉元年十月，齐地晨雾未散，项羽的玄甲已染霜华。他将霸王枪斜倚案前，枪尖挑着田荣的反旗——三日前田荣以‘楚不王六国’为名竖起反旗，此刻正率三万甲士围困济水。‘钟离眜率五千轻骑为先锋，季布带左翼！’项羽突然拔剑劈开舆图，剑刃划破‘济水’二字，‘本王亲率中军，今夜踏平临淄！’帐外传来甲胄摩擦声，范增枯瘦的手指死死按住舆图：‘大王！刘邦已在武关集结十万甲士！’项羽冷笑一声，枪尖挑'
2025-09-25 23:56:47 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 335
2025-09-25 23:56:47 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:47 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:56:47 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:56:47 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:47 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=138 parent=121 choice='亲率楚军精锐突袭齐地'
2025-09-25 23:56:47 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3679
2025-09-25 23:56:47 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=952 预览='{\n  "text": "戏下大营的烛火将项羽的影子拉得很长，他摩挲着虞姬遗物玉簪——温润的玉质上还留着垓下残雪的凉意。英布跪在帐前，玄甲上的血痕在火光下泛着暗红：“大王若信英布，愿率五千死士夜袭刘邦中军。”项羽突然攥紧玉簪，簪尖刺破掌心，血珠滴在英布肩头的“楚”字战旗上：“你可知，田荣已在齐地立刘邦为齐王？”帐外突然传来钟离眜急报：“大王！刘邦暗通彭越，正率十万联军逼近成皋！”英布猛地抬头，甲胄碰撞声震落帐外冰凌：“大王既信英布，为何还要与刘邦虚与委蛇？”项羽望着帐外寒鸦惊飞，突然将玉簪掷向英布：“这是虞姬留给我的念想，也是你英布的护身符——”他转身抽出霸王枪，枪尖直指帐外：“今夜，你我共守'
2025-09-25 23:56:47 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=952 预览='{\n  "text": "戏下大营的烛火将项羽的影子拉得很长，他摩挲着虞姬遗物玉簪——温润的玉质上还留着垓下残雪的凉意。英布跪在帐前，玄甲上的血痕在火光下泛着暗红：“大王若信英布，愿率五千死士夜袭刘邦中军。”项羽突然攥紧玉簪，簪尖刺破掌心，血珠滴在英布肩头的“楚”字战旗上：“你可知，田荣已在齐地立刘邦为齐王？”帐外突然'
2025-09-25 23:56:47 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=952 预览='{\n  "text": "戏下大营的烛火将项羽的影子拉得很长，他摩挲着虞姬遗物玉簪——温润的玉质上还留着垓下残雪的凉意。英布跪在帐前，玄甲上的血痕在火光下泛着暗红：“大王若信英布，愿率五千死士夜袭刘邦中军。”项羽突然攥紧玉簪，簪尖刺破掌心，血珠滴在英布肩头的“楚”字战旗上：“你可知，田荣已在齐地立刘邦为齐王？”帐外突然'
2025-09-25 23:56:47 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=952 预览='{\n  "text": "戏下大营的烛火将项羽的影子拉得很长，他摩挲着虞姬遗物玉簪——温润的玉质上还留着垓下残雪的凉意。英布跪在帐前，玄甲上的血痕在火光下泛着暗红：“大王若信英布，愿率五千死士夜袭刘邦中军。”项羽突然攥紧玉簪，簪尖刺破掌心，血珠滴在英布肩头的“楚”字战旗上：“你可知，田荣已在齐地立刘邦为齐王？”帐外突然传来钟离眜急报：“大王！刘邦暗通彭越，正率十万联军逼近成皋！”英布猛地抬头，甲胄'
2025-09-25 23:56:47 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 295
2025-09-25 23:56:47 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:47 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:56:47 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:56:47 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:47 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=139 parent=121 choice='以虞姬遗物玉簪安抚英布'
2025-09-25 23:56:47 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3713
2025-09-25 23:56:47 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1015 预览='{\n  "text": "汉元年冬，济西的残雪在马蹄下碾成碎玉。项羽勒住乌骓马缰绳，玄甲上的血痕已被寒风吹透——三日前轻骑突袭彭越得手，却在临淄城外收到钟离眜密报：英布将军于六日前率三万楚军西撤，兵锋直指彭城。军帐内，陈平捧着英布的密信跪地：“大王，九江王言‘齐地不稳，非十万兵不可镇’，暗地却与田氏余孽互遣使者。”项羽冷笑，霸王枪枪尖在案上划出火星：“当年你随我破釜沉舟，如今却学彭越反骨？”他掷出范增遗下的铁尺，“即刻派季布持我亲笔信去九江，就说‘若英布敢反，霸王枪必刺穿其心’！”帐外突然传来急报：刘邦已在陈仓立营，韩信正率偏师攻陇西。项羽攥紧枪柄，枪缨在烛火中抖得发白——安抚英布的刀，终究要'
2025-09-25 23:56:47 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1015 预览='{\n  "text": "汉元年冬，济西的残雪在马蹄下碾成碎玉。项羽勒住乌骓马缰绳，玄甲上的血痕已被寒风吹透——三日前轻骑突袭彭越得手，却在临淄城外收到钟离眜密报：英布将军于六日前率三万楚军西撤，兵锋直指彭城。军帐内，陈平捧着英布的密信跪地：“大王，九江王言‘齐地不稳，非十万兵不可镇’，暗地却与田氏余孽互遣使者。”项羽'
2025-09-25 23:56:47 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1015 预览='{\n  "text": "汉元年冬，济西的残雪在马蹄下碾成碎玉。项羽勒住乌骓马缰绳，玄甲上的血痕已被寒风吹透——三日前轻骑突袭彭越得手，却在临淄城外收到钟离眜密报：英布将军于六日前率三万楚军西撤，兵锋直指彭城。军帐内，陈平捧着英布的密信跪地：“大王，九江王言‘齐地不稳，非十万兵不可镇’，暗地却与田氏余孽互遣使者。”项羽'
2025-09-25 23:56:47 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1015 预览='{\n  "text": "汉元年冬，济西的残雪在马蹄下碾成碎玉。项羽勒住乌骓马缰绳，玄甲上的血痕已被寒风吹透——三日前轻骑突袭彭越得手，却在临淄城外收到钟离眜密报：英布将军于六日前率三万楚军西撤，兵锋直指彭城。军帐内，陈平捧着英布的密信跪地：“大王，九江王言‘齐地不稳，非十万兵不可镇’，暗地却与田氏余孽互遣使者。”项羽冷笑，霸王枪枪尖在案上划出火星：“当年你随我破釜沉舟，如今却学彭越反骨？”他掷出'
2025-09-25 23:56:47 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 299
2025-09-25 23:56:47 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:47 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:56:47 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:56:47 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:47 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=140 parent=125 choice='遣使安抚英布'
2025-09-25 23:56:48 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3885
2025-09-25 23:56:48 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=904 预览='{\n  "text": "济西烽火未熄，项羽已率轻骑折返齐地。临淄城头的楚旗被田氏余孽染血撕裂，他勒住乌骓马，枪尖挑着田儋头颅悬于城门——那是三日前彭越弃尸而逃的‘战利品’。帐内，英布果然未按军令驰援，副将送来密信：‘田荣旧部以复齐为名煽动军心，英布愿暂代齐王。’项羽冷笑，枪缨扫过‘齐王’二字，墨迹洇开如血。帐外突然传来钟离眜急报：‘大王！韩信破临晋关，关中三城尽失！’他攥紧枪柄，枪尖在案上划出火星——回师齐地，却让刘邦坐大，是雷霆之怒，还是养虎为患？",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "血洗临淄，震慑田氏'
2025-09-25 23:56:48 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=904 预览='{\n  "text": "济西烽火未熄，项羽已率轻骑折返齐地。临淄城头的楚旗被田氏余孽染血撕裂，他勒住乌骓马，枪尖挑着田儋头颅悬于城门——那是三日前彭越弃尸而逃的‘战利品’。帐内，英布果然未按军令驰援，副将送来密信：‘田荣旧部以复齐为名煽动军心，英布愿暂代齐王。’项羽冷笑，枪缨扫过‘齐王’二字，墨迹洇开如血。帐外突然传'
2025-09-25 23:56:48 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=904 预览='{\n  "text": "济西烽火未熄，项羽已率轻骑折返齐地。临淄城头的楚旗被田氏余孽染血撕裂，他勒住乌骓马，枪尖挑着田儋头颅悬于城门——那是三日前彭越弃尸而逃的‘战利品’。帐内，英布果然未按军令驰援，副将送来密信：‘田荣旧部以复齐为名煽动军心，英布愿暂代齐王。’项羽冷笑，枪缨扫过‘齐王’二字，墨迹洇开如血。帐外突然传'
2025-09-25 23:56:48 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=904 预览='{\n  "text": "济西烽火未熄，项羽已率轻骑折返齐地。临淄城头的楚旗被田氏余孽染血撕裂，他勒住乌骓马，枪尖挑着田儋头颅悬于城门——那是三日前彭越弃尸而逃的‘战利品’。帐内，英布果然未按军令驰援，副将送来密信：‘田荣旧部以复齐为名煽动军心，英布愿暂代齐王。’项羽冷笑，枪缨扫过‘齐王’二字，墨迹洇开如血。帐外突然传来钟离眜急报：‘大王！韩信破临晋关，关中三城尽失！’他攥紧枪柄，枪尖在案上划出火'
2025-09-25 23:56:48 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 215
2025-09-25 23:56:48 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:48 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:56:48 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:56:48 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:48 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=141 parent=125 choice='回师稳定齐地'
2025-09-25 23:56:49 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3698
2025-09-25 23:56:49 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=978 预览='{\n  "text": "戏下楚军大营的铜漏滴答着亥时，项羽将田荣送来的降表掷在案上，墨迹未干的“齐王”二字刺得他眼疼。范增枯瘦的手指突然按住案上的虎符：“大王忘了巨鹿城头的誓言？田荣若得齐地，必成第二个章邯！”帐外突然传来钟离眜的急报：“汉王刘邦已拜韩信为大将，正于汉中凿山开道！”项羽猛地掀翻案几，霸王枪枪尖挑着田荣送来的玉璧：“好一个‘划地安齐’！”他突然转身抽出佩剑劈向帐外的火把，火星溅上英布的脸：“你带五千骑兵去九江，告诉英布——”他顿住，瞥见范增藏在袖中的铁尺，前世垓下的四面楚歌仿佛又在耳畔响起。",\n  "success_rate": 68,\n  "choices": [\n    '
2025-09-25 23:56:49 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=978 预览='{\n  "text": "戏下楚军大营的铜漏滴答着亥时，项羽将田荣送来的降表掷在案上，墨迹未干的“齐王”二字刺得他眼疼。范增枯瘦的手指突然按住案上的虎符：“大王忘了巨鹿城头的誓言？田荣若得齐地，必成第二个章邯！”帐外突然传来钟离眜的急报：“汉王刘邦已拜韩信为大将，正于汉中凿山开道！”项羽猛地掀翻案几，霸王枪枪尖挑着田荣'
2025-09-25 23:56:49 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=978 预览='{\n  "text": "戏下楚军大营的铜漏滴答着亥时，项羽将田荣送来的降表掷在案上，墨迹未干的“齐王”二字刺得他眼疼。范增枯瘦的手指突然按住案上的虎符：“大王忘了巨鹿城头的誓言？田荣若得齐地，必成第二个章邯！”帐外突然传来钟离眜的急报：“汉王刘邦已拜韩信为大将，正于汉中凿山开道！”项羽猛地掀翻案几，霸王枪枪尖挑着田荣'
2025-09-25 23:56:49 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=978 预览='{\n  "text": "戏下楚军大营的铜漏滴答着亥时，项羽将田荣送来的降表掷在案上，墨迹未干的“齐王”二字刺得他眼疼。范增枯瘦的手指突然按住案上的虎符：“大王忘了巨鹿城头的誓言？田荣若得齐地，必成第二个章邯！”帐外突然传来钟离眜的急报：“汉王刘邦已拜韩信为大将，正于汉中凿山开道！”项羽猛地掀翻案几，霸王枪枪尖挑着田荣送来的玉璧：“好一个‘划地安齐’！”他突然转身抽出佩剑劈向帐外的火把，火星溅上英'
2025-09-25 23:56:49 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 243
2025-09-25 23:56:49 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:49 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:56:49 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:56:49 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:49 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=142 parent=121 choice='册封田荣为齐王并划地'
2025-09-25 23:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 直捣韩信中军
2025-09-25 23:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 回师彭城整军
2025-09-25 23:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 释放降将施离间
2025-09-25 23:56:57 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3010
2025-09-25 23:56:57 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=876 预览='{\n  "text": "彭城宫的烛火将范增的白发映得透亮，老人枯瘦的手指在分封诏书上划出深深的沟壑。\'大王！巴蜀栈道千里，刘邦若烧绝粮道，汉中便是死局！\'项羽将霸王枪重重顿在青铜案上，枪尖在\'汉王\'二字上挑出火星：\'怀王之约，先入关中者为王。刘邦既入咸阳，我岂能食言？\'帐外突然传来急促的脚步声，英布掀帘而入，黥面在火光下泛着油光：\'大王！刘邦已在汉中筑坛拜将，韩信持将印叩关，说要……\'项羽猛地攥碎案上的玉玦，血珠溅在\'义帝\'二字上。这一次，他要亲手斩断历史的锁链——",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "派'
2025-09-25 23:56:57 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=876 预览='{\n  "text": "彭城宫的烛火将范增的白发映得透亮，老人枯瘦的手指在分封诏书上划出深深的沟壑。\'大王！巴蜀栈道千里，刘邦若烧绝粮道，汉中便是死局！\'项羽将霸王枪重重顿在青铜案上，枪尖在\'汉王\'二字上挑出火星：\'怀王之约，先入关中者为王。刘邦既入咸阳，我岂能食言？\'帐外突然传来急促的脚步声，英布掀帘而入，黥面在火'
2025-09-25 23:56:57 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=876 预览='{\n  "text": "彭城宫的烛火将范增的白发映得透亮，老人枯瘦的手指在分封诏书上划出深深的沟壑。\'大王！巴蜀栈道千里，刘邦若烧绝粮道，汉中便是死局！\'项羽将霸王枪重重顿在青铜案上，枪尖在\'汉王\'二字上挑出火星：\'怀王之约，先入关中者为王。刘邦既入咸阳，我岂能食言？\'帐外突然传来急促的脚步声，英布掀帘而入，黥面在火'
2025-09-25 23:56:57 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=876 预览='{\n  "text": "彭城宫的烛火将范增的白发映得透亮，老人枯瘦的手指在分封诏书上划出深深的沟壑。\'大王！巴蜀栈道千里，刘邦若烧绝粮道，汉中便是死局！\'项羽将霸王枪重重顿在青铜案上，枪尖在\'汉王\'二字上挑出火星：\'怀王之约，先入关中者为王。刘邦既入咸阳，我岂能食言？\'帐外突然传来急促的脚步声，英布掀帘而入，黥面在火光下泛着油光：\'大王！刘邦已在汉中筑坛拜将，韩信持将印叩关，说要……\'项羽猛地攥'
2025-09-25 23:56:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 223
2025-09-25 23:56:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:56:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:56:57 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:57 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=143 parent=113 choice='保留义帝在彭城，封刘邦为汉王，划汉中封地'
2025-09-25 23:56:58 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 5131
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1091 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。“大王！英布将军率主力西撤！”副将季布的嘶吼刺破风雪，项羽猛地旋身，霸王枪横扫出半轮寒月，将射向咽喉的箭矢劈成两段。他望着帐外呼啸的北风，突然想起范增临终前攥着他衣袖的枯手：“齐地不稳，英布必反……”帐外传来钟离眜急促的马蹄声，彭越军主力已绕至楚军后方，而齐地田氏余孽正举着“复齐”大旗攻向临淄。项羽突然冷笑，枪尖直'
2025-09-25 23:56:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1091 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。“大王！英布将军率主力西撤！”副将季'
2025-09-25 23:56:58 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1091 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。“大王！英布将军率主力西撤！”副将季'
2025-09-25 23:56:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1091 预览='{\n  "text": "汉元年冬，济西平原的寒雾裹着刀风卷向楚军先锋。项羽勒住乌骓马缰绳，玄甲上的冰棱簌簌坠落——三日前留英布镇守齐地的军令墨迹未干，此刻济西却已燃起烽火。彭越的游击军如鬼魅般从芦苇荡中杀出，箭矢擦着项羽耳畔钉入树干，裂帛般的破空声里，他瞥见远处齐地方向腾起的狼烟。“大王！英布将军率主力西撤！”副将季布的嘶吼刺破风雪，项羽猛地旋身，霸王枪横扫出半轮寒月，将射向咽喉的箭矢劈成两段。'
2025-09-25 23:56:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 455
2025-09-25 23:56:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-25 23:56:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:58 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=144 parent=125 choice='直捣彭越中军'
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派范增亲赴泰山密道劝降
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暂缓招降，亲率主力回援关中
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 设鸿门宴诱杀田氏遗孤
2025-09-25 23:56:58 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3188
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=974 预览='{\n  "text": "戏下会盟的硝烟尚未散尽，彭城宫的青铜灯盏已将义帝的诏书映得透亮。项羽斜倚在虎皮榻上，指尖摩挲着诏书里‘徙义帝于郴’的墨迹——这是义帝昨夜派来的密使带来的‘楚制’补充条款，字里行间竟隐隐透着对‘霸王权柄’的忌惮。帐外传来项伯急促的脚步声，这位叔父的佩剑鞘上，还沾着昨夜汉中方向的尘土。‘大王，刘邦已在南郑筑坛拜将，韩信的将印据说刻着“汉”字。’项伯的声音压得极低，黥面在烛火下泛着油光。项羽突然将诏书掷向案上的青铜鼎，鼎中椒浆溅起的火星映亮他眼底的寒芒——楚制盟誓的墨迹未干，这天下，竟又要乱了？",\n  "success_rate": 68,\n  "choices": [\n'
2025-09-25 23:56:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=974 预览='{\n  "text": "戏下会盟的硝烟尚未散尽，彭城宫的青铜灯盏已将义帝的诏书映得透亮。项羽斜倚在虎皮榻上，指尖摩挲着诏书里‘徙义帝于郴’的墨迹——这是义帝昨夜派来的密使带来的‘楚制’补充条款，字里行间竟隐隐透着对‘霸王权柄’的忌惮。帐外传来项伯急促的脚步声，这位叔父的佩剑鞘上，还沾着昨夜汉中方向的尘土。‘大王，刘邦'
2025-09-25 23:56:58 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=974 预览='{\n  "text": "戏下会盟的硝烟尚未散尽，彭城宫的青铜灯盏已将义帝的诏书映得透亮。项羽斜倚在虎皮榻上，指尖摩挲着诏书里‘徙义帝于郴’的墨迹——这是义帝昨夜派来的密使带来的‘楚制’补充条款，字里行间竟隐隐透着对‘霸王权柄’的忌惮。帐外传来项伯急促的脚步声，这位叔父的佩剑鞘上，还沾着昨夜汉中方向的尘土。‘大王，刘邦'
2025-09-25 23:56:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=974 预览='{\n  "text": "戏下会盟的硝烟尚未散尽，彭城宫的青铜灯盏已将义帝的诏书映得透亮。项羽斜倚在虎皮榻上，指尖摩挲着诏书里‘徙义帝于郴’的墨迹——这是义帝昨夜派来的密使带来的‘楚制’补充条款，字里行间竟隐隐透着对‘霸王权柄’的忌惮。帐外传来项伯急促的脚步声，这位叔父的佩剑鞘上，还沾着昨夜汉中方向的尘土。‘大王，刘邦已在南郑筑坛拜将，韩信的将印据说刻着“汉”字。’项伯的声音压得极低，黥面在烛火下'
2025-09-25 23:56:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 247
2025-09-25 23:56:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:56:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:56:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:56:58 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:56:58 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=145 parent=113 choice='尊义帝为'楚之共主'，设'楚制'盟誓，以项氏宗亲为诸侯相'
2025-09-25 23:57:00 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3359
2025-09-25 23:57:00 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=907 预览='{\n  "text": "郴县的残阳将义帝的冕旒染成暗红，他枯瘦的手指攥着残破的竹简，上面是刘邦密使昨夜送来的血书——\'大王若不除项，天下苍生何辜\'。英布的黥面在暮色里泛着油光，甲胄上的锁链叮当作响：\'义帝说要给天下写檄文，属下已将他软禁在章台宫。\'项羽将霸王枪重重顿在彭城殿阶前，青铜柱上的饕餮纹因震动而簌簌掉灰。\'刘邦又在演哪出戏？\'他冷笑，帐外突然滚入一枚羽箭，箭羽上刻着\'田荣反楚\'四个血字。范增枯槁的手指掐着诸侯动向图，齐地的红点正连成燎原之势。\'大王，\'龙且踏碎殿角的冰碴，\'韩信已在汉中拜将，军报说汉军已出陈仓！\'项羽望着烛火中晃动的义帝印绶，突然想起垓下的楚歌——这一次，他绝不会让\''
2025-09-25 23:57:00 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=907 预览='{\n  "text": "郴县的残阳将义帝的冕旒染成暗红，他枯瘦的手指攥着残破的竹简，上面是刘邦密使昨夜送来的血书——\'大王若不除项，天下苍生何辜\'。英布的黥面在暮色里泛着油光，甲胄上的锁链叮当作响：\'义帝说要给天下写檄文，属下已将他软禁在章台宫。\'项羽将霸王枪重重顿在彭城殿阶前，青铜柱上的饕餮纹因震动而簌簌掉灰。\'刘'
2025-09-25 23:57:00 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=907 预览='{\n  "text": "郴县的残阳将义帝的冕旒染成暗红，他枯瘦的手指攥着残破的竹简，上面是刘邦密使昨夜送来的血书——\'大王若不除项，天下苍生何辜\'。英布的黥面在暮色里泛着油光，甲胄上的锁链叮当作响：\'义帝说要给天下写檄文，属下已将他软禁在章台宫。\'项羽将霸王枪重重顿在彭城殿阶前，青铜柱上的饕餮纹因震动而簌簌掉灰。\'刘'
2025-09-25 23:57:00 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=907 预览='{\n  "text": "郴县的残阳将义帝的冕旒染成暗红，他枯瘦的手指攥着残破的竹简，上面是刘邦密使昨夜送来的血书——\'大王若不除项，天下苍生何辜\'。英布的黥面在暮色里泛着油光，甲胄上的锁链叮当作响：\'义帝说要给天下写檄文，属下已将他软禁在章台宫。\'项羽将霸王枪重重顿在彭城殿阶前，青铜柱上的饕餮纹因震动而簌簌掉灰。\'刘邦又在演哪出戏？\'他冷笑，帐外突然滚入一枚羽箭，箭羽上刻着\'田荣反楚\'四个血字。'
2025-09-25 23:57:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 293
2025-09-25 23:57:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:57:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:57:00 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:00 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=146 parent=113 choice='将义帝迁往郴县，遣英布部监视'
2025-09-25 23:57:00 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 增兵三秦，直逼汉中
2025-09-25 23:57:00 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 重贿英布，共围刘邦
2025-09-25 23:57:00 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 安抚范增，整饬内政
2025-09-25 23:57:03 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3220
2025-09-25 23:57:03 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=905 预览='{\n  "text": "彭城的烽火台在暮色中燃着残火，项羽勒住乌骓马的缰绳，甲胄上的血污与征尘混作一片。军帐内，范增将一份染血的军报拍在案上：‘刘邦已在栎阳筑坛拜韩信为大将，关中流民十日内投汉者逾三万！’项羽攥紧霸王枪枪杆，枪缨上的红绸已被汗水浸透。帐外突然传来钟离眜的怒吼：‘军粮官克扣粮草！士兵已在营外哗变！’他转身踹开帐帘，正撞见军粮官跪地呈上的账本——墨迹未干的‘周殷’二字刺得他目眦欲裂。当务之急，是整肃军心，还是先破刘邦的关中攻势？",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "严惩克扣军粮的周殷",\n  '
2025-09-25 23:57:03 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=905 预览='{\n  "text": "彭城的烽火台在暮色中燃着残火，项羽勒住乌骓马的缰绳，甲胄上的血污与征尘混作一片。军帐内，范增将一份染血的军报拍在案上：‘刘邦已在栎阳筑坛拜韩信为大将，关中流民十日内投汉者逾三万！’项羽攥紧霸王枪枪杆，枪缨上的红绸已被汗水浸透。帐外突然传来钟离眜的怒吼：‘军粮官克扣粮草！士兵已在营外哗变！’他转'
2025-09-25 23:57:03 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=905 预览='{\n  "text": "彭城的烽火台在暮色中燃着残火，项羽勒住乌骓马的缰绳，甲胄上的血污与征尘混作一片。军帐内，范增将一份染血的军报拍在案上：‘刘邦已在栎阳筑坛拜韩信为大将，关中流民十日内投汉者逾三万！’项羽攥紧霸王枪枪杆，枪缨上的红绸已被汗水浸透。帐外突然传来钟离眜的怒吼：‘军粮官克扣粮草！士兵已在营外哗变！’他转'
2025-09-25 23:57:03 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=905 预览='{\n  "text": "彭城的烽火台在暮色中燃着残火，项羽勒住乌骓马的缰绳，甲胄上的血污与征尘混作一片。军帐内，范增将一份染血的军报拍在案上：‘刘邦已在栎阳筑坛拜韩信为大将，关中流民十日内投汉者逾三万！’项羽攥紧霸王枪枪杆，枪缨上的红绸已被汗水浸透。帐外突然传来钟离眜的怒吼：‘军粮官克扣粮草！士兵已在营外哗变！’他转身踹开帐帘，正撞见军粮官跪地呈上的账本——墨迹未干的‘周殷’二字刺得他目眦欲裂。'
2025-09-25 23:57:03 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 210
2025-09-25 23:57:03 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:03 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:57:03 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:57:03 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:03 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=147 parent=126 choice='回师彭城整军'
2025-09-25 23:57:05 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3672
2025-09-25 23:57:05 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=844 预览='{\n  "text": "霸王枪在寒夜中划出银弧，项羽率楚军如决堤洪水般冲破齐地联营。韩信中军的帅帐外，二十面‘汉’字大旗被楚军铁骑连根拔起，帐前的青铜鼎中仍煮着未凉的‘刘邦印绶’。‘韩信不在！’亲兵掀开帐帘，帐内空无一人，唯有案上摊着的舆图被墨汁浸透——‘彭城布防图’四个大字旁，插着一枚刻着‘霸王’的虎符。项羽冷笑一声，枪尖挑起虎符：‘韩信这是调虎离山！’突然，帐外传来密集的箭雨破空声，钟离眜的吼声如惊雷炸响：‘大王！左路楚军遇伏！’",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "亲率重甲营正面强攻",\n     '
2025-09-25 23:57:05 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=844 预览='{\n  "text": "霸王枪在寒夜中划出银弧，项羽率楚军如决堤洪水般冲破齐地联营。韩信中军的帅帐外，二十面‘汉’字大旗被楚军铁骑连根拔起，帐前的青铜鼎中仍煮着未凉的‘刘邦印绶’。‘韩信不在！’亲兵掀开帐帘，帐内空无一人，唯有案上摊着的舆图被墨汁浸透——‘彭城布防图’四个大字旁，插着一枚刻着‘霸王’的虎符。项羽冷笑一'
2025-09-25 23:57:05 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=844 预览='{\n  "text": "霸王枪在寒夜中划出银弧，项羽率楚军如决堤洪水般冲破齐地联营。韩信中军的帅帐外，二十面‘汉’字大旗被楚军铁骑连根拔起，帐前的青铜鼎中仍煮着未凉的‘刘邦印绶’。‘韩信不在！’亲兵掀开帐帘，帐内空无一人，唯有案上摊着的舆图被墨汁浸透——‘彭城布防图’四个大字旁，插着一枚刻着‘霸王’的虎符。项羽冷笑一'
2025-09-25 23:57:05 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=844 预览='{\n  "text": "霸王枪在寒夜中划出银弧，项羽率楚军如决堤洪水般冲破齐地联营。韩信中军的帅帐外，二十面‘汉’字大旗被楚军铁骑连根拔起，帐前的青铜鼎中仍煮着未凉的‘刘邦印绶’。‘韩信不在！’亲兵掀开帐帘，帐内空无一人，唯有案上摊着的舆图被墨汁浸透——‘彭城布防图’四个大字旁，插着一枚刻着‘霸王’的虎符。项羽冷笑一声，枪尖挑起虎符：‘韩信这是调虎离山！’突然，帐外传来密集的箭雨破空声，钟离眜的'
2025-09-25 23:57:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 207
2025-09-25 23:57:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:57:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:57:05 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:05 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=148 parent=126 choice='直捣韩信中军'
2025-09-25 23:57:06 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3709
2025-09-25 23:57:06 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=928 预览='{\n  "text": "项羽立于楚营高台，望着降将远去的背影，玄甲上的兽纹在暮色中泛着冷光。他攥紧腰间虎符，指节因用力而发白——方才释放的刘邦旧部陈武，腰间竟藏着半块刻着“汉”字的虎符。“钟离眜！”项羽突然转身，霸王枪在掌心划出寒光，“传我将令，全军拔营！”帐外传来甲胄铿锵，却见英布带着一队楚军跪在帐前，手中高举一封密信：“大王！韩信已在临淄城外结阵，田荣许诺助其夹击！”项羽瞳孔骤缩，枪尖直指陈武离去的方向，突然冷笑：“放虎归山，不如……”他将虎符掷向篝火，火星溅上密信上“暗渡陈仓”四字，“传令英布，率五千锐士截杀陈武！”帐外风声鹤唳，楚军的马蹄声已踏碎了残阳。",\n  "success_r'
2025-09-25 23:57:06 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=928 预览='{\n  "text": "项羽立于楚营高台，望着降将远去的背影，玄甲上的兽纹在暮色中泛着冷光。他攥紧腰间虎符，指节因用力而发白——方才释放的刘邦旧部陈武，腰间竟藏着半块刻着“汉”字的虎符。“钟离眜！”项羽突然转身，霸王枪在掌心划出寒光，“传我将令，全军拔营！”帐外传来甲胄铿锵，却见英布带着一队楚军跪在帐前，手中高举一封'
2025-09-25 23:57:06 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=928 预览='{\n  "text": "项羽立于楚营高台，望着降将远去的背影，玄甲上的兽纹在暮色中泛着冷光。他攥紧腰间虎符，指节因用力而发白——方才释放的刘邦旧部陈武，腰间竟藏着半块刻着“汉”字的虎符。“钟离眜！”项羽突然转身，霸王枪在掌心划出寒光，“传我将令，全军拔营！”帐外传来甲胄铿锵，却见英布带着一队楚军跪在帐前，手中高举一封'
2025-09-25 23:57:06 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=928 预览='{\n  "text": "项羽立于楚营高台，望着降将远去的背影，玄甲上的兽纹在暮色中泛着冷光。他攥紧腰间虎符，指节因用力而发白——方才释放的刘邦旧部陈武，腰间竟藏着半块刻着“汉”字的虎符。“钟离眜！”项羽突然转身，霸王枪在掌心划出寒光，“传我将令，全军拔营！”帐外传来甲胄铿锵，却见英布带着一队楚军跪在帐前，手中高举一封密信：“大王！韩信已在临淄城外结阵，田荣许诺助其夹击！”项羽瞳孔骤缩，枪尖直指陈'
2025-09-25 23:57:06 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 272
2025-09-25 23:57:06 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:06 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:57:06 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:57:06 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:06 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=149 parent=126 choice='释放降将施离间'
2025-09-25 23:57:06 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 增兵齐地，趁韩信与张良火并之际一举灭之
2025-09-25 23:57:06 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派陈平持重金游说韩信旧部，许以裂土封侯
2025-09-25 23:57:06 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲赴齐地安抚英布，承诺战后分其封地
2025-09-25 23:57:12 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3597
2025-09-25 23:57:12 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=878 预览='{\n  "text": "汉元年冬，泰山密道的雪粒在火把下泛着冰蓝光。范增持玉节立于帐外，枯瘦的手指摩挲着节杖上的蟠螭纹——这是当年鸿门宴上未能掷出的铁尺所化。项羽突然掀翻案几，霸王枪枪尖挑着钟离眜的密报钉在帐柱上：“刘邦已破陈仓，灌婴正率三万骑兵西进！”范增突然转身，玉节撞在帐壁上发出脆响：“大王，田氏若降，齐地可定！”项羽攥紧枪柄，甲胄上的血珠滴在密道地图上，晕开田横“诈降”二字。帐外传来虞姬的哭声：“大王，田氏遗孤说愿以全族性命换您不屠临淄......”",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "亲率楚军主'
2025-09-25 23:57:12 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=878 预览='{\n  "text": "汉元年冬，泰山密道的雪粒在火把下泛着冰蓝光。范增持玉节立于帐外，枯瘦的手指摩挲着节杖上的蟠螭纹——这是当年鸿门宴上未能掷出的铁尺所化。项羽突然掀翻案几，霸王枪枪尖挑着钟离眜的密报钉在帐柱上：“刘邦已破陈仓，灌婴正率三万骑兵西进！”范增突然转身，玉节撞在帐壁上发出脆响：“大王，田氏若降，齐地可定'
2025-09-25 23:57:12 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=878 预览='{\n  "text": "汉元年冬，泰山密道的雪粒在火把下泛着冰蓝光。范增持玉节立于帐外，枯瘦的手指摩挲着节杖上的蟠螭纹——这是当年鸿门宴上未能掷出的铁尺所化。项羽突然掀翻案几，霸王枪枪尖挑着钟离眜的密报钉在帐柱上：“刘邦已破陈仓，灌婴正率三万骑兵西进！”范增突然转身，玉节撞在帐壁上发出脆响：“大王，田氏若降，齐地可定'
2025-09-25 23:57:12 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=878 预览='{\n  "text": "汉元年冬，泰山密道的雪粒在火把下泛着冰蓝光。范增持玉节立于帐外，枯瘦的手指摩挲着节杖上的蟠螭纹——这是当年鸿门宴上未能掷出的铁尺所化。项羽突然掀翻案几，霸王枪枪尖挑着钟离眜的密报钉在帐柱上：“刘邦已破陈仓，灌婴正率三万骑兵西进！”范增突然转身，玉节撞在帐壁上发出脆响：“大王，田氏若降，齐地可定！”项羽攥紧枪柄，甲胄上的血珠滴在密道地图上，晕开田横“诈降”二字。帐外传来虞姬'
2025-09-25 23:57:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 219
2025-09-25 23:57:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:57:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:57:12 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:12 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=150 parent=127 choice='派范增亲赴泰山密道劝降'
2025-09-25 23:57:17 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4145
2025-09-25 23:57:17 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖突然指向帐外密报：‘刘邦已破陈仓，灌婴正率三万骑兵西进！’他攥紧枪柄，指节泛白：‘传我军令——’\n\n项羽将霸王枪拄在雪地里，枪缨扫过冻裂的地面。‘全军拔营，回师函谷！’他转身时，范增枯瘦的手指死死按住'
2025-09-25 23:57:17 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地'
2025-09-25 23:57:17 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地'
2025-09-25 23:57:17 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖'
2025-09-25 23:57:17 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Invalid control character at: line 2 column 247 (char 248); json_str预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖'
2025-09-25 23:57:17 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3211
2025-09-25 23:57:17 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=916 预览='{\n  "text": "戏下大营的铜漏滴答着亥时三刻，项羽将三秦地图拍在案上，墨玉镇纸压出深深的凹痕。章邯的降书墨迹未干，却在‘还军霸上’四字旁洇开暗红血渍——那是他昨夜杀了三名私通刘邦的三秦斥候。‘龙且！’他突然掀帐而出，霸王枪拖曳地面，火星溅在雪地上，‘点三万锐士，明晨卯时，直逼子午谷！’帐外传来英布的闷响：‘大王，三秦新附，章邯未必真心……’项羽冷笑转身，甲胄上的龙纹在火把下扭曲如活物：‘真心？本王的霸王枪，就是他们的真心！’他掷出虎符，青铜兽首咬碎帐外积雪，‘刘邦若敢出汉中，便让他尝尝三秦铁蹄的滋味！’",\n  "success_rate": 68,\n  "choices": [\n '
2025-09-25 23:57:17 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=916 预览='{\n  "text": "戏下大营的铜漏滴答着亥时三刻，项羽将三秦地图拍在案上，墨玉镇纸压出深深的凹痕。章邯的降书墨迹未干，却在‘还军霸上’四字旁洇开暗红血渍——那是他昨夜杀了三名私通刘邦的三秦斥候。‘龙且！’他突然掀帐而出，霸王枪拖曳地面，火星溅在雪地上，‘点三万锐士，明晨卯时，直逼子午谷！’帐外传来英布的闷响：‘大'
2025-09-25 23:57:17 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=916 预览='{\n  "text": "戏下大营的铜漏滴答着亥时三刻，项羽将三秦地图拍在案上，墨玉镇纸压出深深的凹痕。章邯的降书墨迹未干，却在‘还军霸上’四字旁洇开暗红血渍——那是他昨夜杀了三名私通刘邦的三秦斥候。‘龙且！’他突然掀帐而出，霸王枪拖曳地面，火星溅在雪地上，‘点三万锐士，明晨卯时，直逼子午谷！’帐外传来英布的闷响：‘大'
2025-09-25 23:57:17 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=916 预览='{\n  "text": "戏下大营的铜漏滴答着亥时三刻，项羽将三秦地图拍在案上，墨玉镇纸压出深深的凹痕。章邯的降书墨迹未干，却在‘还军霸上’四字旁洇开暗红血渍——那是他昨夜杀了三名私通刘邦的三秦斥候。‘龙且！’他突然掀帐而出，霸王枪拖曳地面，火星溅在雪地上，‘点三万锐士，明晨卯时，直逼子午谷！’帐外传来英布的闷响：‘大王，三秦新附，章邯未必真心……’项羽冷笑转身，甲胄上的龙纹在火把下扭曲如活物：‘'
2025-09-25 23:57:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 246
2025-09-25 23:57:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:57:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:57:17 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:17 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=151 parent=114 choice='增兵三秦，直逼汉中'
2025-09-25 23:57:19 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4205
2025-09-25 23:57:19 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=927 预览='{\n  "text": "汉元年冬，临淄帅帐的烛火映着田儋腰间的青铜匕首。项羽执玉杯立于帐中，霸王枪斜倚在案几旁，枪缨上的红绸被寒风卷得猎猎作响。“田将军可知，今日这鸿门宴，是你齐地最后的活路。”项羽冷笑，目光扫过帐内伏兵——三百死士正从帐外涌入，为首的田儋突然掀翻案几，青铜匕首直刺项羽咽喉！帐外火油骤然泼上，烈焰瞬间吞噬帅帐，齐地旧部的喊杀声从四面八方涌来。“大王！”钟离眜持剑护在项羽身前，却见田儋临死前将密信塞进他怀中，“刘邦已破陈仓，韩信正率三万甲士渡黄河！”项羽瞳孔骤缩，枪尖挑飞田儋的头颅，血珠溅上他染血的玄甲：“传我军令——”",\n  "success_rate": 68,\n  "c'
2025-09-25 23:57:19 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=927 预览='{\n  "text": "汉元年冬，临淄帅帐的烛火映着田儋腰间的青铜匕首。项羽执玉杯立于帐中，霸王枪斜倚在案几旁，枪缨上的红绸被寒风卷得猎猎作响。“田将军可知，今日这鸿门宴，是你齐地最后的活路。”项羽冷笑，目光扫过帐内伏兵——三百死士正从帐外涌入，为首的田儋突然掀翻案几，青铜匕首直刺项羽咽喉！帐外火油骤然泼上，烈焰瞬间'
2025-09-25 23:57:19 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=927 预览='{\n  "text": "汉元年冬，临淄帅帐的烛火映着田儋腰间的青铜匕首。项羽执玉杯立于帐中，霸王枪斜倚在案几旁，枪缨上的红绸被寒风卷得猎猎作响。“田将军可知，今日这鸿门宴，是你齐地最后的活路。”项羽冷笑，目光扫过帐内伏兵——三百死士正从帐外涌入，为首的田儋突然掀翻案几，青铜匕首直刺项羽咽喉！帐外火油骤然泼上，烈焰瞬间'
2025-09-25 23:57:19 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=927 预览='{\n  "text": "汉元年冬，临淄帅帐的烛火映着田儋腰间的青铜匕首。项羽执玉杯立于帐中，霸王枪斜倚在案几旁，枪缨上的红绸被寒风卷得猎猎作响。“田将军可知，今日这鸿门宴，是你齐地最后的活路。”项羽冷笑，目光扫过帐内伏兵——三百死士正从帐外涌入，为首的田儋突然掀翻案几，青铜匕首直刺项羽咽喉！帐外火油骤然泼上，烈焰瞬间吞噬帅帐，齐地旧部的喊杀声从四面八方涌来。“大王！”钟离眜持剑护在项羽身前，却见'
2025-09-25 23:57:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 258
2025-09-25 23:57:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-25 23:57:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-25 23:57:19 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:19 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=152 parent=127 choice='设鸿门宴诱杀田氏遗孤'
2025-09-25 23:57:19 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3681
2025-09-25 23:57:19 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=926 预览='{\n  "text": "戏下大营的烛火突然剧烈摇曳，项羽将鎏金锦盒重重砸在案上——里面滚出的夜明珠在黑暗中泛着幽光，映得英布黥面下的汗珠格外刺眼。\\"九江王，\\"项羽的声线压得极低，\\"这是巴蜀三郡的印绶，还有钟离眜私藏的黄金百斤。\\"英布突然叩首，铁镣在地面拖出刺耳声响：\\"大王待臣如手足，臣愿以项氏为天！\\"帐外突然传来急促的脚步声，陈平的信使竟跪在了帐外——刘邦已在汉中掘通陈仓道，韩信亲率十万甲士直指武关！项羽瞳孔骤缩，瞥见英布垂首时，左手正悄悄摸向腰间的佩剑。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "'
2025-09-25 23:57:19 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=926 预览='{\n  "text": "戏下大营的烛火突然剧烈摇曳，项羽将鎏金锦盒重重砸在案上——里面滚出的夜明珠在黑暗中泛着幽光，映得英布黥面下的汗珠格外刺眼。\\"九江王，\\"项羽的声线压得极低，\\"这是巴蜀三郡的印绶，还有钟离眜私藏的黄金百斤。\\"英布突然叩首，铁镣在地面拖出刺耳声响：\\"大王待臣如手足，臣愿以项氏为天！\\"帐外'
2025-09-25 23:57:19 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=926 预览='{\n  "text": "戏下大营的烛火突然剧烈摇曳，项羽将鎏金锦盒重重砸在案上——里面滚出的夜明珠在黑暗中泛着幽光，映得英布黥面下的汗珠格外刺眼。\\"九江王，\\"项羽的声线压得极低，\\"这是巴蜀三郡的印绶，还有钟离眜私藏的黄金百斤。\\"英布突然叩首，铁镣在地面拖出刺耳声响：\\"大王待臣如手足，臣愿以项氏为天！\\"帐外'
2025-09-25 23:57:19 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=926 预览='{\n  "text": "戏下大营的烛火突然剧烈摇曳，项羽将鎏金锦盒重重砸在案上——里面滚出的夜明珠在黑暗中泛着幽光，映得英布黥面下的汗珠格外刺眼。\\"九江王，\\"项羽的声线压得极低，\\"这是巴蜀三郡的印绶，还有钟离眜私藏的黄金百斤。\\"英布突然叩首，铁镣在地面拖出刺耳声响：\\"大王待臣如手足，臣愿以项氏为天！\\"帐外突然传来急促的脚步声，陈平的信使竟跪在了帐外——刘邦已在汉中掘通陈仓道，韩信亲率'
2025-09-25 23:57:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 218
2025-09-25 23:57:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:57:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:57:19 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:19 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=153 parent=114 choice='重贿英布，共围刘邦'
2025-09-25 23:57:21 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3887
2025-09-25 23:57:21 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然亮了：\'是刘邦的细作混进了敖仓？\'项羽却突然攥住他手腕，霸王枪枪尖在烛火下泛着冷光：\'不，是我们自己人。\'帐外突然传来急促的马蹄声，英布的黥面在火把中泛着油光——这个刚刚被封为九江王的男人，此刻正带着一队亲兵守在帐外，腰间佩剑的剑穗正随着他的呼吸微微颤动。",\n  "succes'
2025-09-25 23:57:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然'
2025-09-25 23:57:21 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然'
2025-09-25 23:57:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然亮了：\'是刘邦的细作混进了敖仓？\'项羽却突然攥住他手腕，霸王枪枪尖在烛火下泛着冷'
2025-09-25 23:57:21 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting value: line 15 column 29 (char 667); json_str预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然亮了：\'是刘邦的细作混进了敖仓？\'项羽却突然攥住他手腕，霸王枪枪尖在烛火下泛着冷'
2025-09-25 23:57:22 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3848
2025-09-25 23:57:22 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=888 预览='{\n  "text": "汉元年冬，齐地的寒风卷着雪沫扑打在楚军先锋的甲胄上。项羽勒住乌骓马缰绳，望着远处英布营寨的狼烟，枪尖在雪地里划出一道深深的沟壑。‘英布敢拥兵自重，’他冷笑一声，玄甲上的冰棱簌簌坠落，‘本王倒要看看，他是想做淮阴侯，还是想做乌江鬼！’帐外突然传来钟离眜的急报：‘大王，刘邦密使已潜入齐境，正以黄金百斤拉拢英布旧部！’项羽剑眉倒竖，霸王枪重重顿在雪地里，积雪飞溅：‘传令全军，明日卯时拔营，本王要亲自去会会这位九江王！’",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "亲率楚军主力直抵英布大营，以雷霆'
2025-09-25 23:57:22 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=888 预览='{\n  "text": "汉元年冬，齐地的寒风卷着雪沫扑打在楚军先锋的甲胄上。项羽勒住乌骓马缰绳，望着远处英布营寨的狼烟，枪尖在雪地里划出一道深深的沟壑。‘英布敢拥兵自重，’他冷笑一声，玄甲上的冰棱簌簌坠落，‘本王倒要看看，他是想做淮阴侯，还是想做乌江鬼！’帐外突然传来钟离眜的急报：‘大王，刘邦密使已潜入齐境，正以黄金'
2025-09-25 23:57:22 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=888 预览='{\n  "text": "汉元年冬，齐地的寒风卷着雪沫扑打在楚军先锋的甲胄上。项羽勒住乌骓马缰绳，望着远处英布营寨的狼烟，枪尖在雪地里划出一道深深的沟壑。‘英布敢拥兵自重，’他冷笑一声，玄甲上的冰棱簌簌坠落，‘本王倒要看看，他是想做淮阴侯，还是想做乌江鬼！’帐外突然传来钟离眜的急报：‘大王，刘邦密使已潜入齐境，正以黄金'
2025-09-25 23:57:22 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=888 预览='{\n  "text": "汉元年冬，齐地的寒风卷着雪沫扑打在楚军先锋的甲胄上。项羽勒住乌骓马缰绳，望着远处英布营寨的狼烟，枪尖在雪地里划出一道深深的沟壑。‘英布敢拥兵自重，’他冷笑一声，玄甲上的冰棱簌簌坠落，‘本王倒要看看，他是想做淮阴侯，还是想做乌江鬼！’帐外突然传来钟离眜的急报：‘大王，刘邦密使已潜入齐境，正以黄金百斤拉拢英布旧部！’项羽剑眉倒竖，霸王枪重重顿在雪地里，积雪飞溅：‘传令全军，明'
2025-09-25 23:57:22 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 208
2025-09-25 23:57:22 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:22 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-25 23:57:22 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-25 23:57:22 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:22 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=154 parent=129 choice='亲赴齐地安抚英布，承诺战后分其封地'
2025-09-25 23:57:26 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4418
2025-09-25 23:57:26 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1004 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是钟离眜快马送来的急报：“韩信于临淄城外筑坛拜将，张良却以‘军粮未足’为由滞留，帐下谋士皆言二人暗生嫌隙。”右首是英布截获的韩信私函，“愿以齐地半数粮草换张良兵权”八字被朱砂圈出。项羽将霸王枪重重顿在案上，枪尖火星迸裂：“增兵三万，命龙且为主将，明日卯时拔营！”范增枯瘦的手指按住密信：“大王，韩信素有‘兵仙’之称，龙且虽勇，却少谋略，恐中其诱敌之计！”项羽冷笑：“趁其内乱，正是一举灭之良机！”帐外突然传来甲胄铿锵，英布带着一队楚军冲入，跪地呈上竹简：“大王！齐地田荣残部已联合韩信旧部，在济水设下伏兵！”项羽瞳孔骤缩'
2025-09-25 23:57:26 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1004 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是钟离眜快马送来的急报：“韩信于临淄城外筑坛拜将，张良却以‘军粮未足’为由滞留，帐下谋士皆言二人暗生嫌隙。”右首是英布截获的韩信私函，“愿以齐地半数粮草换张良兵权”八字被朱砂圈出。项羽将霸王枪重重顿在案上，枪尖火星迸裂：“增兵三万，命龙且为'
2025-09-25 23:57:26 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1004 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是钟离眜快马送来的急报：“韩信于临淄城外筑坛拜将，张良却以‘军粮未足’为由滞留，帐下谋士皆言二人暗生嫌隙。”右首是英布截获的韩信私函，“愿以齐地半数粮草换张良兵权”八字被朱砂圈出。项羽将霸王枪重重顿在案上，枪尖火星迸裂：“增兵三万，命龙且为'
2025-09-25 23:57:26 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1004 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着项羽案上两份密报。左首是钟离眜快马送来的急报：“韩信于临淄城外筑坛拜将，张良却以‘军粮未足’为由滞留，帐下谋士皆言二人暗生嫌隙。”右首是英布截获的韩信私函，“愿以齐地半数粮草换张良兵权”八字被朱砂圈出。项羽将霸王枪重重顿在案上，枪尖火星迸裂：“增兵三万，命龙且为主将，明日卯时拔营！”范增枯瘦的手指按住密信：“大王，韩信素有‘兵仙’之称，龙且'
2025-09-25 23:57:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 310
2025-09-25 23:57:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:57:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:57:26 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:26 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=155 parent=129 choice='增兵齐地，趁韩信与张良火并之际一举灭之'
2025-09-25 23:57:28 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4345
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=901 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着陈平苍白的脸。他跪在项羽面前，双手捧着一封密信，墨迹未干的朱砂印泥在烛火下泛着暗红。“大王，”陈平声音发颤，“韩信帐下裨将曹参已受金印，愿率五千锐士倒戈，只待楚军西进攻齐。”项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上“裂土封侯”四字，突然冷笑：“刘邦旧部果然贪利。”帐外突然传来甲胄铿锵，英布带着一队楚军冲入，跪地呈上竹简：“大王！韩信亲率三万甲士封锁齐地要道，曹参已被其枭首示众！”项羽瞳孔骤缩，霸王枪枪尖在案上划出火星：“陈平！你可知罪？”",\n  "success_rate": 58,\n  "choices": [\n    {\n    '
2025-09-25 23:57:28 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=901 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着陈平苍白的脸。他跪在项羽面前，双手捧着一封密信，墨迹未干的朱砂印泥在烛火下泛着暗红。“大王，”陈平声音发颤，“韩信帐下裨将曹参已受金印，愿率五千锐士倒戈，只待楚军西进攻齐。”项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上“裂土封侯”四字，突然冷笑：“刘邦旧部果然贪利。'
2025-09-25 23:57:28 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=901 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着陈平苍白的脸。他跪在项羽面前，双手捧着一封密信，墨迹未干的朱砂印泥在烛火下泛着暗红。“大王，”陈平声音发颤，“韩信帐下裨将曹参已受金印，愿率五千锐士倒戈，只待楚军西进攻齐。”项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上“裂土封侯”四字，突然冷笑：“刘邦旧部果然贪利。'
2025-09-25 23:57:28 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=901 预览='{\n  "text": "汉元年冬，戏下楚军大营的烛火映着陈平苍白的脸。他跪在项羽面前，双手捧着一封密信，墨迹未干的朱砂印泥在烛火下泛着暗红。“大王，”陈平声音发颤，“韩信帐下裨将曹参已受金印，愿率五千锐士倒戈，只待楚军西进攻齐。”项羽指尖摩挲着霸王枪枪缨，枪尖挑着密信上“裂土封侯”四字，突然冷笑：“刘邦旧部果然贪利。”帐外突然传来甲胄铿锵，英布带着一队楚军冲入，跪地呈上竹简：“大王！韩信亲率三万'
2025-09-25 23:57:28 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 237
2025-09-25 23:57:28 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:28 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:57:28 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:28 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=156 parent=129 choice='派陈平持重金游说韩信旧部，许以裂土封侯'
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲自赴梁地，以雷霆手段震慑彭越
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派范增持霸王印前往梁地，封彭越为梁王后再行试探
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 密令钟离眜截杀英布，以绝后患
2025-09-25 23:57:28 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 1897
2025-09-25 23:57:28 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然亮了：\'是刘邦的细作混进了敖仓？\'项羽却突然攥住他手腕，霸王枪枪尖在烛火下泛着冷'
2025-09-25 23:57:28 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然'
2025-09-25 23:57:28 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=940 预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然'
2025-09-25 23:57:28 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 15 column 29 (char 667); 原始预览='{\n  "text": "戏下大营的烛火将范增的白发照得透亮，他枯瘦的手指正摩挲着鸿门宴上未竟的玉玦。项羽推门而入时，甲胄碰撞声惊飞了帐外寒鸦——这位亚父总爱把军报藏在锦盒最底层，像藏着未说出口的预言。\'亚父，\'项羽将鎏金酒盏重重搁在案上，琥珀色酒液溅出几滴，\'昨日军库清点，发现关中粮草竟亏空三成。\'范增浑浊的眼睛突然亮了：\'是刘邦的细作混进了敖仓？\'项羽却突然攥住他手腕，霸王枪枪尖在烛火下泛着冷'
2025-09-25 23:57:28 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=114 choice='安抚范增，整饬内政': Expecting value: line 15 column 29 (char 667)
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率楚军突袭刘邦
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派陈平游说六国旧贵族
2025-09-25 23:57:28 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以虞姬遗愿安抚英布
2025-09-25 23:57:36 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3419
2025-09-25 23:57:36 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖'
2025-09-25 23:57:36 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地'
2025-09-25 23:57:36 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1244 预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地'
2025-09-25 23:57:36 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Invalid control character at: line 2 column 247 (char 248); 原始预览='{\n  "text": "汉元年冬，临淄城外的帅帐积着未化的雪。项羽将田氏遗孤的降书掷在案上，朱砂印泥的红痕刺得他眼疼——那是田横旧部伪造的印信。‘钟离眜！’他突然掀翻案几，霸王枪枪尖挑着降书钉在帐柱上，‘派五千重甲兵随季布去泰山密道，若田氏敢耍诈，我要让齐地血流成河！’帐外传来虞姬的哭声，她捧着田氏遗孤的玉佩跪在雪地里：‘大王，田氏说愿以全族性命换您不屠临淄......’项羽的瞳孔骤然收缩，枪尖'
2025-09-25 23:57:36 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=127 choice='暂缓招降，亲率主力回援关中': Invalid control character at: line 2 column 247 (char 248)
2025-09-25 23:57:36 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 血洗英布营中
2025-09-25 23:57:36 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与刘邦划鸿沟为界
2025-09-25 23:57:36 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 立田氏遗孤为齐王
2025-09-25 23:57:38 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=115 choice='派陈平游说六国旧贵族': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158583485dcba022c3658c0b88949863a8ee5a4b68f9d5', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235738gjQVrVGl7EIW10QO3UvG
2025-09-25 23:57:38 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=115 choice='以虞姬遗愿安抚英布': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158585195dcba022c3658c0b88949863a8ee5a4b6b2b91', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235738yiGv1Ved6b9N52p02VNe
2025-09-25 23:57:40 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3261
2025-09-25 23:57:40 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=908 预览='{\n  "text": "烛火将密令上‘斩’字映得猩红，项羽指尖划过钟离眜玄甲上的雪粒——三日前英布带回的彭越密信墨迹未干，此刻却成了刺向自己的利刃。‘龙且率重甲营即刻出发，’项羽将密令掷向案前，‘你去告诉英布，就说梁地王爵已封，让他速带亲卫入彭城述职。’钟离眜叩首时，腰间虎符坠子突然断裂，碎玉在青砖上迸出火星。三日后，英布的亲卫在梁地驿站截获密信，玄甲上的血痕与密令上的朱砂竟如出一辙。项羽立于帐外，听着钟离眜率死士突袭的喊杀声，突然攥碎了手中的霸王枪枪缨——枪尖滴落的血珠，正落在‘垓下’二字的军报上。",\n  "success_rate": 68,\n  "choices": [\n    {\n'
2025-09-25 23:57:40 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=908 预览='{\n  "text": "烛火将密令上‘斩’字映得猩红，项羽指尖划过钟离眜玄甲上的雪粒——三日前英布带回的彭越密信墨迹未干，此刻却成了刺向自己的利刃。‘龙且率重甲营即刻出发，’项羽将密令掷向案前，‘你去告诉英布，就说梁地王爵已封，让他速带亲卫入彭城述职。’钟离眜叩首时，腰间虎符坠子突然断裂，碎玉在青砖上迸出火星。三日后'
2025-09-25 23:57:40 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=908 预览='{\n  "text": "烛火将密令上‘斩’字映得猩红，项羽指尖划过钟离眜玄甲上的雪粒——三日前英布带回的彭越密信墨迹未干，此刻却成了刺向自己的利刃。‘龙且率重甲营即刻出发，’项羽将密令掷向案前，‘你去告诉英布，就说梁地王爵已封，让他速带亲卫入彭城述职。’钟离眜叩首时，腰间虎符坠子突然断裂，碎玉在青砖上迸出火星。三日后'
2025-09-25 23:57:40 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=908 预览='{\n  "text": "烛火将密令上‘斩’字映得猩红，项羽指尖划过钟离眜玄甲上的雪粒——三日前英布带回的彭越密信墨迹未干，此刻却成了刺向自己的利刃。‘龙且率重甲营即刻出发，’项羽将密令掷向案前，‘你去告诉英布，就说梁地王爵已封，让他速带亲卫入彭城述职。’钟离眜叩首时，腰间虎符坠子突然断裂，碎玉在青砖上迸出火星。三日后，英布的亲卫在梁地驿站截获密信，玄甲上的血痕与密令上的朱砂竟如出一辙。项羽立于帐'
2025-09-25 23:57:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 241
2025-09-25 23:57:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:57:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:57:40 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:40 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=157 parent=136 choice='密令钟离眜截杀英布，以绝后患'
2025-09-25 23:57:44 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3706
2025-09-25 23:57:44 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=872 预览='{\n  "text": "汉元年冬，济水冰裂声中，项羽的霸王枪劈开风雪。他亲率三万重甲军踏过鸿沟，玄甲上的冰棱在日光下折射出冷芒——三日前钟离眜送来的血书仍在怀中发烫：‘彭越已暗通刘邦，济西十万甲士皆受其调遣。’帐前突然传来彭越冷笑：‘霸王亲来，是想借梁地王爵收买人心？’项羽剑眉倒竖，枪尖挑起雪地里的断剑——那是彭越部将昨夜自刎的遗物。‘彭越，要么降楚，要么让你梁地血流成河！’他突然勒马转身，霸王枪枪缨扫过亲卫甲胄：‘全军听令，先破济西营垒！’",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "强渡济水，直捣彭越老巢",'
2025-09-25 23:57:44 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=872 预览='{\n  "text": "汉元年冬，济水冰裂声中，项羽的霸王枪劈开风雪。他亲率三万重甲军踏过鸿沟，玄甲上的冰棱在日光下折射出冷芒——三日前钟离眜送来的血书仍在怀中发烫：‘彭越已暗通刘邦，济西十万甲士皆受其调遣。’帐前突然传来彭越冷笑：‘霸王亲来，是想借梁地王爵收买人心？’项羽剑眉倒竖，枪尖挑起雪地里的断剑——那是彭越部'
2025-09-25 23:57:44 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=872 预览='{\n  "text": "汉元年冬，济水冰裂声中，项羽的霸王枪劈开风雪。他亲率三万重甲军踏过鸿沟，玄甲上的冰棱在日光下折射出冷芒——三日前钟离眜送来的血书仍在怀中发烫：‘彭越已暗通刘邦，济西十万甲士皆受其调遣。’帐前突然传来彭越冷笑：‘霸王亲来，是想借梁地王爵收买人心？’项羽剑眉倒竖，枪尖挑起雪地里的断剑——那是彭越部'
2025-09-25 23:57:44 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=872 预览='{\n  "text": "汉元年冬，济水冰裂声中，项羽的霸王枪劈开风雪。他亲率三万重甲军踏过鸿沟，玄甲上的冰棱在日光下折射出冷芒——三日前钟离眜送来的血书仍在怀中发烫：‘彭越已暗通刘邦，济西十万甲士皆受其调遣。’帐前突然传来彭越冷笑：‘霸王亲来，是想借梁地王爵收买人心？’项羽剑眉倒竖，枪尖挑起雪地里的断剑——那是彭越部将昨夜自刎的遗物。‘彭越，要么降楚，要么让你梁地血流成河！’他突然勒马转身，霸王'
2025-09-25 23:57:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 211
2025-09-25 23:57:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:44 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:57:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:57:44 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:44 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=158 parent=136 choice='亲自赴梁地，以雷霆手段震慑彭越'
2025-09-25 23:57:45 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=130 choice='与刘邦划鸿沟为界': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158654399fc4dc47d27ebf7239e22958e08dac0b99b34f', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235745MBYVhBnNM7fgpOQH3DCv
2025-09-25 23:57:45 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=130 choice='血洗英布营中': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158655225dcba022c3658c0b88949863a8ee5a4bcdb6ec', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235745Oeucs48UiS7Rv2U21ByP
2025-09-25 23:57:46 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=130 choice='立田氏遗孤为齐王': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158660329fc4dc47d27ebf7239e22958e08dac0bb818c3', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235746bSZ2KS83Xkh9axGj4evU
2025-09-25 23:57:46 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率重甲营追击彭越残部
2025-09-25 23:57:46 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 回师彭城防备刘邦
2025-09-25 23:57:46 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 安抚英布并调查粮仓守卫
2025-09-25 23:57:47 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4023
2025-09-25 23:57:47 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=933 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将霸王印拍在案上，青铜印纽的棱角在烛火下泛着冷光——范增昨夜叩营时，枯瘦的手指正死死按住印匣：‘大王，彭越反复无常，唯有霸王印能镇住他。’项羽冷笑：‘镇不住，就杀。’范增转身时，玄色披风扫过帐外的雪堆，留下一道清晰的血痕——他靴底藏着的匕首，是当年鸿门宴上未送出的铁尺。三日后，范增的车驾刚过黄河，彭越的降书已至楚营：‘愿以梁地十万甲士归楚，只求霸王印为信物。’项羽摩挲着印匣上的‘西楚霸王’四字，突然将密信掷向英布：‘去查！范增是否与彭越私通？’帐外突然传来甲胄铿锵，钟离眜带着一队死士闯入，跪地呈上一卷血书：‘大王！范'
2025-09-25 23:57:47 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=933 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将霸王印拍在案上，青铜印纽的棱角在烛火下泛着冷光——范增昨夜叩营时，枯瘦的手指正死死按住印匣：‘大王，彭越反复无常，唯有霸王印能镇住他。’项羽冷笑：‘镇不住，就杀。’范增转身时，玄色披风扫过帐外的雪堆，留下一道清晰的血痕——他靴底藏着的匕首，'
2025-09-25 23:57:47 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=933 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将霸王印拍在案上，青铜印纽的棱角在烛火下泛着冷光——范增昨夜叩营时，枯瘦的手指正死死按住印匣：‘大王，彭越反复无常，唯有霸王印能镇住他。’项羽冷笑：‘镇不住，就杀。’范增转身时，玄色披风扫过帐外的雪堆，留下一道清晰的血痕——他靴底藏着的匕首，'
2025-09-25 23:57:47 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=933 预览='{\n  "text": "汉元年冬，戏下大营的雪粒子敲打着中军帐的兽皮帘。项羽将霸王印拍在案上，青铜印纽的棱角在烛火下泛着冷光——范增昨夜叩营时，枯瘦的手指正死死按住印匣：‘大王，彭越反复无常，唯有霸王印能镇住他。’项羽冷笑：‘镇不住，就杀。’范增转身时，玄色披风扫过帐外的雪堆，留下一道清晰的血痕——他靴底藏着的匕首，是当年鸿门宴上未送出的铁尺。三日后，范增的车驾刚过黄河，彭越的降书已至楚营：‘愿'
2025-09-25 23:57:47 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 312
2025-09-25 23:57:47 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:47 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-25 23:57:47 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-25 23:57:47 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:47 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=159 parent=136 choice='派范增持霸王印前往梁地，封彭越为梁王后再行试探'
2025-09-25 23:57:47 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 硬闯齐地纵深，直取临淄
2025-09-25 23:57:47 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暂缓齐地战事，回师平叛英布
2025-09-25 23:57:47 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派使者离间田荣与彭越
2025-09-25 23:57:55 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=131 choice='率重甲营追击彭越残部': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158756595dcba022c3658c0b88949863a8ee5a4b1da70f', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235755kD0NRFnI1LHiqjDlCYcV
2025-09-25 23:57:55 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=131 choice='回师彭城防备刘邦': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815875752fef43cebbc3e07dc7d6c1a6386599cfedfad2e', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235755m6x0jeHOQlqNFxskIfAr
2025-09-25 23:57:56 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=131 choice='安抚英布并调查粮仓守卫': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158760929fc4dc47d27ebf7239e22958e08dac0b8c605b', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235756MWVVgL7bSxAxnCYEg4rL
2025-09-25 23:57:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力驰援济水
2025-09-25 23:57:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派英布继续西进，自领一军清剿临淄
2025-09-25 23:57:56 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以田横为诱饵，诱韩信出兵平原
2025-09-25 23:57:57 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=138 choice='暂缓齐地战事，回师平叛英布': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158773339fc4dc47d27ebf7239e22958e08dac0b2fee91', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235757r0kPPMG8wJtTCh9iXvsW
2025-09-25 23:57:57 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=138 choice='硬闯齐地纵深，直取临淄': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158774619fc4dc47d27ebf7239e22958e08dac0b182a09', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235757hzxpkWXiQF2eYtUiqV2u
2025-09-25 23:57:57 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=138 choice='派使者离间田荣与彭越': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815877504d5bbc3e631479c4deb362d20ba806f78158311', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235757ndlEPZU7zxlIRAyZbIW3
2025-09-25 23:57:57 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 立即挥师西进，直捣刘邦中军
2025-09-25 23:57:57 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派随何持玉簪信物游说彭越
2025-09-25 23:57:57 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暂缓军事行动，以玉簪安抚龙且等嫡系将领
2025-09-25 23:57:58 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 3906
2025-09-25 23:57:58 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1024 预览='{\n  "text": "夜色如墨，楚军大营灯火骤然熄灭。项羽亲率八千精锐，马蹄踏碎晨霜。他勒住乌骓马，望着霸上方向燃起的烽火——刘邦竟在函谷关外布下三道火寨，火光映得甲胄兽面纹狰狞可怖。‘全军加速！’霸王枪划破夜空，‘刘邦小儿若敢负我，魂魄无归！’楚军冲破第二道火寨时，却见寨后涌出两千汉兵，为首者竟是韩信旧部！‘霸王休走！’汉将挺枪迎上，项羽冷笑挑旗：‘韩信的兵？今日便让你尝尝霸王枪！’正欲挥枪，龙且急呼：‘大王！左翼发现刘邦主力！’回头时，刘邦亲率三万甲士从密林中杀出，樊哙的刀光已至眼前。项羽瞳孔骤缩——他中了调虎离山计！英布的黑甲军迟迟未动，彭越的楚军已牵制其兵力。此刻身边只剩五千亲兵，'
2025-09-25 23:57:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1024 预览='{\n  "text": "夜色如墨，楚军大营灯火骤然熄灭。项羽亲率八千精锐，马蹄踏碎晨霜。他勒住乌骓马，望着霸上方向燃起的烽火——刘邦竟在函谷关外布下三道火寨，火光映得甲胄兽面纹狰狞可怖。‘全军加速！’霸王枪划破夜空，‘刘邦小儿若敢负我，魂魄无归！’楚军冲破第二道火寨时，却见寨后涌出两千汉兵，为首者竟是韩信旧部！‘霸王'
2025-09-25 23:57:58 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1024 预览='{\n  "text": "夜色如墨，楚军大营灯火骤然熄灭。项羽亲率八千精锐，马蹄踏碎晨霜。他勒住乌骓马，望着霸上方向燃起的烽火——刘邦竟在函谷关外布下三道火寨，火光映得甲胄兽面纹狰狞可怖。‘全军加速！’霸王枪划破夜空，‘刘邦小儿若敢负我，魂魄无归！’楚军冲破第二道火寨时，却见寨后涌出两千汉兵，为首者竟是韩信旧部！‘霸王'
2025-09-25 23:57:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1024 预览='{\n  "text": "夜色如墨，楚军大营灯火骤然熄灭。项羽亲率八千精锐，马蹄踏碎晨霜。他勒住乌骓马，望着霸上方向燃起的烽火——刘邦竟在函谷关外布下三道火寨，火光映得甲胄兽面纹狰狞可怖。‘全军加速！’霸王枪划破夜空，‘刘邦小儿若敢负我，魂魄无归！’楚军冲破第二道火寨时，却见寨后涌出两千汉兵，为首者竟是韩信旧部！‘霸王休走！’汉将挺枪迎上，项羽冷笑挑旗：‘韩信的兵？今日便让你尝尝霸王枪！’正欲挥枪'
2025-09-25 23:57:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 331
2025-09-25 23:57:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:57:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-25 23:57:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-25 23:57:58 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:57:58 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=160 parent=115 choice='亲率楚军突袭刘邦'
2025-09-25 23:57:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率楚军正面强攻，速破韩信军阵
2025-09-25 23:57:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 分兵三路，封锁渭水渡口，断韩信粮道
2025-09-25 23:57:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 回师彭城，以霸王威名震慑诸侯
2025-09-25 23:58:05 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=133 choice='亲率主力驰援济水': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815885482d5bbc3e631479c4deb362d20ba806f7867c675', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235805HJU9qfD5Sc67phEXaDw8
2025-09-25 23:58:06 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=133 choice='以田横为诱饵，诱韩信出兵平原': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158862729fc4dc47d27ebf7239e22958e08dac0b888ac8', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235806e6fk83LnjTTQ0LwQGaqj
2025-09-25 23:58:06 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=133 choice='派英布继续西进，自领一军清剿临淄': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158866349fc4dc47d27ebf7239e22958e08dac0b71b3e5', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235806jxrihyanLyEH20kvXgHR
2025-09-25 23:58:06 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率楚军主力驰援齐地
2025-09-25 23:58:06 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派钟离眜率轻骑监视英布动向
2025-09-25 23:58:06 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 设宴犒劳英布部众，赠予黄金百斤
2025-09-25 23:58:07 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=139 choice='暂缓军事行动，以玉簪安抚龙且等嫡系将领': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158874709fc4dc47d27ebf7239e22958e08dac0bc3c5e3', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235807eDfizEwMyHoHmMZief63
2025-09-25 23:58:07 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=139 choice='派随何持玉簪信物游说彭越': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815887654d5bbc3e631479c4deb362d20ba806f78ba9b4f', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235807h3KII0KqHb97l0EwT2GR
2025-09-25 23:58:07 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=116 choice='回师彭城，以霸王威名震慑诸侯': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158876735dcba022c3658c0b88949863a8ee5a4bd7e311', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235807qtcQiKQQBBoy7OzIcPxn
2025-09-25 23:58:08 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=116 choice='率楚军正面强攻，速破韩信军阵': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158880659fc4dc47d27ebf7239e22958e08dac0b402d5e', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358084KQu4y8LONSVzIRh8yQc
2025-09-25 23:58:08 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=139 choice='立即挥师西进，直捣刘邦中军': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158884439fc4dc47d27ebf7239e22958e08dac0b19af75', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235808VY8N9vTeuNXr3pvPDdLR
2025-09-25 23:58:08 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力突袭汉中
2025-09-25 23:58:08 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派陈平持节安抚田荣
2025-09-25 23:58:08 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以裂土封侯拉拢英布
2025-09-25 23:58:12 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=106 choice='派孙乾星夜南下许昌，以'让徐州'为诱饵求曹操出兵': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815892667bd9c19bb55201b5e3b0a85ccbcb54b53ce0636', 'param': '', 'type': 'TooManyRequests'}}
2025-09-25 23:58:12 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派陈登联络广陵水军，以淮河天险牵制吕布粮道
2025-09-25 23:58:16 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=135 choice='设宴犒劳英布部众，赠予黄金百斤': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158960459fc4dc47d27ebf7239e22958e08dac0b751312', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235816Xccb5N9lhpSKIRv8RCq6
2025-09-25 23:58:16 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=135 choice='亲率楚军主力驰援齐地': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158963439fc4dc47d27ebf7239e22958e08dac0ba5bad8', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358166jeHzYyr3dix0oQEmSRf
2025-09-25 23:58:16 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=135 choice='派钟离眜率轻骑监视英布动向': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158968919fc4dc47d27ebf7239e22958e08dac0b59d7f1', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235816tssQ81fNcVUIjADqyWtc
2025-09-25 23:58:16 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率楚军主力驰援齐地
2025-09-25 23:58:16 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 命英布、钟离眜分兵合击
2025-09-25 23:58:16 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 令陈平持霸王印信安抚田横
2025-09-25 23:58:18 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=142 choice='以裂土封侯拉拢英布': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158980119fc4dc47d27ebf7239e22958e08dac0bc51517', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235818wzEYLjLrBFLcp2RJR8AI
2025-09-25 23:58:18 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=142 choice='亲率主力突袭汉中': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815898020d5bbc3e631479c4deb362d20ba806f7814199d', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235818zhaam9kUhSr6sUbWBU46
2025-09-25 23:58:18 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=142 choice='派陈平持节安抚田荣': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588158980939fc4dc47d27ebf7239e22958e08dac0bac34e0', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235818aoxuTyrttE8HT9xbZ3F0
2025-09-25 23:58:18 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=106 choice='派陈登联络广陵水军，以淮河天险牵制吕布粮道': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815898188bd9c19bb55201b5e3b0a85ccbcb54b53e6acf3', 'param': '', 'type': 'TooManyRequests'}}
2025-09-25 23:58:18 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 刘备亲自巡视下邳城防，分发私藏粮草鼓舞士气
2025-09-25 23:58:24 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=106 choice='刘备亲自巡视下邳城防，分发私藏粮草鼓舞士气': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815904020bd9c19bb55201b5e3b0a85ccbcb54b53903c57', 'param': '', 'type': 'TooManyRequests'}}
2025-09-25 23:58:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率残兵反袭高顺中军
2025-09-25 23:58:24 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: doubao-seed-1-6-flash-250828, tokens使用: 4261
2025-09-25 23:58:24 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=985 预览='{\n  "text": "渭水寒雾裹着楚军的呐喊漫过三津渡。项羽立于西岸高台，银枪拄地，甲胄上凝结的霜花簌簌坠落——三路封锁令已下：英布扼上游，龙且堵下游，钟离眜守中津。他望着河对岸芦苇丛中若隐若现的汉军粮船，忽然想起范增临终前攥着的那枚玉玦：‘霸王多疑，终困乌江。’\\n\\n‘大王，英布昨夜私会刘邦使者！’斥候的急报撞碎了帐内寂静。项羽指尖掐进枪杆，血珠顺着指缝渗进甲胄缝隙。他想起垓下时，正是英布的背叛撕开了楚军防线。此刻若英布倒戈，三路封锁将成泡影。\\n\\n‘传钟离眜！’项羽突然转身，霸王枪枪尖直指帐外，‘若英布有异心，斩其首级示众！’帐外寒风卷着马蹄声骤起，钟离眜的铁靴踏碎薄冰，却在帐口停'
2025-09-25 23:58:24 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=985 预览='{\n  "text": "渭水寒雾裹着楚军的呐喊漫过三津渡。项羽立于西岸高台，银枪拄地，甲胄上凝结的霜花簌簌坠落——三路封锁令已下：英布扼上游，龙且堵下游，钟离眜守中津。他望着河对岸芦苇丛中若隐若现的汉军粮船，忽然想起范增临终前攥着的那枚玉玦：‘霸王多疑，终困乌江。’\\n\\n‘大王，英布昨夜私会刘邦使者！’斥候的急报撞'
2025-09-25 23:58:24 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=985 预览='{\n  "text": "渭水寒雾裹着楚军的呐喊漫过三津渡。项羽立于西岸高台，银枪拄地，甲胄上凝结的霜花簌簌坠落——三路封锁令已下：英布扼上游，龙且堵下游，钟离眜守中津。他望着河对岸芦苇丛中若隐若现的汉军粮船，忽然想起范增临终前攥着的那枚玉玦：‘霸王多疑，终困乌江。’\\n\\n‘大王，英布昨夜私会刘邦使者！’斥候的急报撞'
2025-09-25 23:58:24 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=985 预览='{\n  "text": "渭水寒雾裹着楚军的呐喊漫过三津渡。项羽立于西岸高台，银枪拄地，甲胄上凝结的霜花簌簌坠落——三路封锁令已下：英布扼上游，龙且堵下游，钟离眜守中津。他望着河对岸芦苇丛中若隐若现的汉军粮船，忽然想起范增临终前攥着的那枚玉玦：‘霸王多疑，终困乌江。’\\n\\n‘大王，英布昨夜私会刘邦使者！’斥候的急报撞碎了帐内寂静。项羽指尖掐进枪杆，血珠顺着指缝渗进甲胄缝隙。他想起垓下时，正是英布'
2025-09-25 23:58:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 316
2025-09-25 23:58:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-25 23:58:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-25 23:58:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-25 23:58:24 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-25 23:58:24 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=161 parent=116 choice='分兵三路，封锁渭水渡口，断韩信粮道'
2025-09-25 23:58:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力直捣武关
2025-09-25 23:58:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派龙且持真盟约书假意求和
2025-09-25 23:58:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 召集诸将立誓破汉
2025-09-25 23:58:26 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=137 choice='亲率楚军主力驰援齐地': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159062779fc4dc47d27ebf7239e22958e08dac0bf5dac1', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358265sDnJLmeDlEGlS1sJsfg
2025-09-25 23:58:26 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=137 choice='令陈平持霸王印信安抚田横': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159067919fc4dc47d27ebf7239e22958e08dac0bc3e2e3', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235826U6Z8GaWzcuroY3toLcco
2025-09-25 23:58:27 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=137 choice='命英布、钟离眜分兵合击': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159076379fc4dc47d27ebf7239e22958e08dac0b2bd7d0', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235827gi9QxHIaHYIOsLT6U6Ix
2025-09-25 23:58:27 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力回师九江
2025-09-25 23:58:27 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 裂土封侯拉拢英布
2025-09-25 23:58:27 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 单骑会盟九江军帐
2025-09-25 23:58:30 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=107 choice='率残兵反袭高顺中军': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815910207bd9c19bb55201b5e3b0a85ccbcb54b531de2a0', 'param': '', 'type': 'TooManyRequests'}}
2025-09-25 23:58:30 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 遣陈宫修书曹操求援
2025-09-25 23:58:33 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=118 choice='派龙且持真盟约书假意求和': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159130219fc4dc47d27ebf7239e22958e08dac0b3d6ef5', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235833YZNOIqnLxYR7znWTWNiC
2025-09-25 23:58:33 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=118 choice='召集诸将立誓破汉': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815913875d5bbc3e631479c4deb362d20ba806f78bfaf8a', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358333VoW6gAPfXLFp8iCDv8f
2025-09-25 23:58:34 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=118 choice='亲率主力直捣武关': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159141579fc4dc47d27ebf7239e22958e08dac0b894e73', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235834OhcgLzNwGv3UkkwOzRI6
2025-09-25 23:58:34 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲率主力追击刘邦
2025-09-25 23:58:34 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派钟离眜与龙且分兵夹击
2025-09-25 23:58:34 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 安抚英布并拉拢诸侯
2025-09-25 23:58:35 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=107 choice='遣陈宫修书曹操求援': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815915505bd9c19bb55201b5e3b0a85ccbcb54b536cbbfb', 'param': '', 'type': 'TooManyRequests'}}
2025-09-25 23:58:35 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 收合残兵固守下邳
2025-09-25 23:58:37 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=140 choice='裂土封侯拉拢英布': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815916984d5bbc3e631479c4deb362d20ba806f788984ca', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235837xPs816gg4J8EDKM2avk1
2025-09-25 23:58:37 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=140 choice='单骑会盟九江军帐': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815916999727172d4b0156b3bd207c1a99dc67750d9b936', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235837vhJtmwfwM5Belr0KKQxF
2025-09-25 23:58:37 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=140 choice='亲率主力回师九江': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815917686727172d4b0156b3bd207c1a99dc6775076dd40', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235837kbpdBLFkkTAAe3DX7T7v
2025-09-25 23:58:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 血洗临淄，震慑田氏余孽
2025-09-25 23:58:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 遣使册封英布为齐王，分化田氏势力
2025-09-25 23:58:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 亲赴济西，问责英布
2025-09-25 23:58:41 | WARNING  | core.speculation:_speculate_bfs:195 - [Speculation] generation failed session=40 node=107 choice='收合残兵固守下邳': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815921016bd9c19bb55201b5e3b0a85ccbcb54b5334cee8', 'param': '', 'type': 'TooManyRequests'}}
2025-09-25 23:58:43 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=122 choice='亲率主力追击刘邦': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159234859fc4dc47d27ebf7239e22958e08dac0bbf7f17', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358431zY44w7slKkj5sexrgsL
2025-09-25 23:58:43 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=122 choice='派钟离眜与龙且分兵夹击': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159237459fc4dc47d27ebf7239e22958e08dac0b806b26', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235843xdSv1YVwpHCBnpjZIJcD
2025-09-25 23:58:44 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=122 choice='安抚英布并拉拢诸侯': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815924646d5bbc3e631479c4deb362d20ba806f7843fb29', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235844lFVtRGyVMgqjl08eZtof
2025-09-25 23:58:44 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 雷霆处置：令英布率亲兵囚杀刘邦
2025-09-25 23:58:44 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 诸侯要挟：遣陈平持刘邦印绶游说诸侯
2025-09-25 23:58:44 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 缓兵羁縻：令项伯持项羽手谕劝降刘邦
2025-09-25 23:58:47 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=141 choice='遣使册封英布为齐王，分化田氏势力': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815927660d5bbc3e631479c4deb362d20ba806f7881c8ac', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235847g8cXtWUDXoTUY9oQEQDU
2025-09-25 23:58:47 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=141 choice='血洗临淄，震慑田氏余孽': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159276529fc4dc47d27ebf7239e22958e08dac0b7a4784', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358475oVqJg4wGg4gAd5VWdJT
2025-09-25 23:58:48 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=141 choice='亲赴济西，问责英布': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 021758815928226d5bbc3e631479c4deb362d20ba806f782918a4', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235848sYZJoSWh1SQpHkaEPf1s
2025-09-25 23:58:48 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率轻骑强攻中军
2025-09-25 23:58:48 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 分兵三路夹击
2025-09-25 23:58:48 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 安抚军心坚守待援
2025-09-25 23:58:54 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=128 choice='诸侯要挟：遣陈平持刘邦印绶游说诸侯': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159343869fc4dc47d27ebf7239e22958e08dac0beb8289', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235854op84JlFhmKQqlCqjTok5
2025-09-25 23:58:54 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=128 choice='缓兵羁縻：令项伯持项羽手谕劝降刘邦': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159346439fc4dc47d27ebf7239e22958e08dac0ba8629d', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235854sJ7hC4RcFSCJFXcWusjd
2025-09-25 23:58:55 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=128 choice='雷霆处置：令英布率亲兵囚杀刘邦': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159349199fc4dc47d27ebf7239e22958e08dac0b53ece0', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235854zDXGQTmrim6XoYgFbc0P
2025-09-25 23:58:57 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=144 choice='率轻骑强攻中军': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159376659fc4dc47d27ebf7239e22958e08dac0b604a1a', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235857NGxlohkJnQzIr4XPSw3H
2025-09-25 23:58:58 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=144 choice='安抚军心坚守待援': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159379999fc4dc47d27ebf7239e22958e08dac0bd8a61d', 'param': '', 'type': 'TooManyRequests'}}, request_id: 20250925235858fLcgPAsrYFwzNemc0Oag
2025-09-25 23:58:58 | WARNING  | core.speculation:_generate_child_node:132 - [Speculation] generation failed for parent=144 choice='分兵三路夹击': Error code: 429 - {'error': {'code': 'SetLimitExceeded', 'message': 'Your account [2104671706] has reached the set inference limit for the [doubao-seed-1-6-flash] model, and the model service has been paused. To continue using this model, please visit the Model Activation page to adjust or close the "Safe Experience Mode". Request id: 0217588159380569fc4dc47d27ebf7239e22958e08dac0bb17101', 'param': '', 'type': 'TooManyRequests'}}, request_id: 202509252358586CXPloQ2ow7oEZPJxd7k
2025-09-26 00:04:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:04:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:05:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:05:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:05:20 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:05:37 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:05:38 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:05:38 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:05:38 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:05:38 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:05:38 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:05:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:05:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:05:38 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-26 00:05:38 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:05:38 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:05:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:05:39 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:05:39 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:05:39 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:05:39 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:05:39 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:06:15 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1844
2025-09-26 00:11:00 | INFO     | api.story:start_new_story:193 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 武则天
2025-09-26 00:11:00 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '武则天'
2025-09-26 00:11:59 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3017
2025-09-26 00:11:59 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=987 预览='{\n  "text": "大唐贞观年间，洛阳武氏宅邸深处，庭院中腊梅傲雪。十二岁的武媚娘，身着素雅襦裙，指尖轻触冰冷的琴弦，却无心拨弄。前世的记忆如潮水般涌来，那些金戈铁马、权谋诡计、帝王之座的沉重，让她此刻的稚嫩身躯显得格外单薄。一道宫廷旨意，如同一纸冰冷的命运判决，打破了武家的宁静。太宗皇帝诏选秀女，武媚娘赫然在列，将以‘才人’之位入宫。她深知，这并非荣耀，而是踏入吃人深渊的第一步。前世的她，曾从这里一步步走向权力的巅峰，也曾感受过深宫的无情与冰冷。如今，重生的她手握预知未来的利刃，是顺应宿命，再次攀登？还是另辟蹊径，改变那注定血腥的轨迹？宫门已开，宿命的钟声在耳边回响，她必须做出选择，她'
2025-09-26 00:11:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=987 预览='{\n  "text": "大唐贞观年间，洛阳武氏宅邸深处，庭院中腊梅傲雪。十二岁的武媚娘，身着素雅襦裙，指尖轻触冰冷的琴弦，却无心拨弄。前世的记忆如潮水般涌来，那些金戈铁马、权谋诡计、帝王之座的沉重，让她此刻的稚嫩身躯显得格外单薄。一道宫廷旨意，如同一纸冰冷的命运判决，打破了武家的宁静。太宗皇帝诏选秀女，武媚娘赫然在列'
2025-09-26 00:11:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=987 预览='{\n  "text": "大唐贞观年间，洛阳武氏宅邸深处，庭院中腊梅傲雪。十二岁的武媚娘，身着素雅襦裙，指尖轻触冰冷的琴弦，却无心拨弄。前世的记忆如潮水般涌来，那些金戈铁马、权谋诡计、帝王之座的沉重，让她此刻的稚嫩身躯显得格外单薄。一道宫廷旨意，如同一纸冰冷的命运判决，打破了武家的宁静。太宗皇帝诏选秀女，武媚娘赫然在列'
2025-09-26 00:11:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=987 预览='{\n  "text": "大唐贞观年间，洛阳武氏宅邸深处，庭院中腊梅傲雪。十二岁的武媚娘，身着素雅襦裙，指尖轻触冰冷的琴弦，却无心拨弄。前世的记忆如潮水般涌来，那些金戈铁马、权谋诡计、帝王之座的沉重，让她此刻的稚嫩身躯显得格外单薄。一道宫廷旨意，如同一纸冰冷的命运判决，打破了武家的宁静。太宗皇帝诏选秀女，武媚娘赫然在列，将以‘才人’之位入宫。她深知，这并非荣耀，而是踏入吃人深渊的第一步。前世的她，'
2025-09-26 00:11:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 298
2025-09-26 00:11:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:11:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 00:11:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 00:11:59 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-26 00:11:59 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 00:11:59 | INFO     | api.story:start_new_story:241 - 新故事生成成功
2025-09-26 00:11:59 | DEBUG    | core.speculation:enqueue:57 - [Speculation] enqueue session=42 node=162 depth=3
2025-09-26 00:11:59 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 依旨入宫，顺应历史洪流
2025-09-26 00:11:59 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 设法抗旨，逃离宫廷束缚
2025-09-26 00:11:59 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 表面应允，暗中筹谋布局
2025-09-26 00:12:26 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3321
2025-09-26 00:12:26 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1021 预览='```json\n{\n  "text": "武媚娘的指尖紧扣着冰冷的琴弦，那道入宫的旨意如同一把悬在头顶的利剑。她不能再踏入那座噬人的牢笼，更不能重蹈覆辙。抗旨是死罪，但她有前世的记忆，知道如何巧妙周旋。她迅速在脑海中勾勒出逃离武府的路线，夜深人静之时，是她唯一的机会。她开始秘密准备，将一些细软藏于衣物之中，并暗中观察府邸的守卫。然而，武家的门庭森严，加之宫廷选秀在即，府内外的监视骤然收紧。她甚至感到，母亲杨氏的目光也变得异常敏锐，似乎察觉到了她内心的波澜。一个不慎，便是万劫不复。她知道，她需要一个完美的计划，或者一个意想不到的盟友。逃离，不仅仅是离开这个家，更是要避开整个大唐的追捕。",\n  '
2025-09-26 00:12:26 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1021 预览='```json\n{\n  "text": "武媚娘的指尖紧扣着冰冷的琴弦，那道入宫的旨意如同一把悬在头顶的利剑。她不能再踏入那座噬人的牢笼，更不能重蹈覆辙。抗旨是死罪，但她有前世的记忆，知道如何巧妙周旋。她迅速在脑海中勾勒出逃离武府的路线，夜深人静之时，是她唯一的机会。她开始秘密准备，将一些细软藏于衣物之中，并暗中观察府'
2025-09-26 00:12:26 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=1009 预览='{\n  "text": "武媚娘的指尖紧扣着冰冷的琴弦，那道入宫的旨意如同一把悬在头顶的利剑。她不能再踏入那座噬人的牢笼，更不能重蹈覆辙。抗旨是死罪，但她有前世的记忆，知道如何巧妙周旋。她迅速在脑海中勾勒出逃离武府的路线，夜深人静之时，是她唯一的机会。她开始秘密准备，将一些细软藏于衣物之中，并暗中观察府邸的守卫。然而，'
2025-09-26 00:12:26 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1009 预览='{\n  "text": "武媚娘的指尖紧扣着冰冷的琴弦，那道入宫的旨意如同一把悬在头顶的利剑。她不能再踏入那座噬人的牢笼，更不能重蹈覆辙。抗旨是死罪，但她有前世的记忆，知道如何巧妙周旋。她迅速在脑海中勾勒出逃离武府的路线，夜深人静之时，是她唯一的机会。她开始秘密准备，将一些细软藏于衣物之中，并暗中观察府邸的守卫。然而，武家的门庭森严，加之宫廷选秀在即，府内外的监视骤然收紧。她甚至感到，母亲杨氏的目'
2025-09-26 00:12:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 274
2025-09-26 00:12:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:12:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 00:12:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 00:12:26 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:12:26 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=163 parent=162 choice='设法抗旨，逃离宫廷束缚'
2025-09-26 00:12:53 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2841
2025-09-26 00:12:53 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=937 预览='```json\n{\n  "text": "武媚娘表面应允入宫，却将这短暂的离家时光视作最后的机会。她深知宫廷是权力的绞肉机，而她目前的稚嫩身躯和身份，是她最大的弱点，也是最好的伪装。她开始仔细观察家中仆役，寻找可信赖的耳目，并暗中翻阅父亲书房中被尘封的典籍，尤其是那些关于前朝旧事和朝堂秘闻的记载。夜深人静时，她会在烛火下默写记忆中的诗词歌赋，既是温习，也是掩饰。同时，她注意到母亲神色中的一丝忧虑，似乎隐藏着某种不为人知的秘密。入宫的日期日益临近，她必须在踏入那朱红宫门前，尽可能地为自己编织一张无形的网。",\n  "success_rate": 68,\n  "choices": [\n    {\n'
2025-09-26 00:12:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=937 预览='```json\n{\n  "text": "武媚娘表面应允入宫，却将这短暂的离家时光视作最后的机会。她深知宫廷是权力的绞肉机，而她目前的稚嫩身躯和身份，是她最大的弱点，也是最好的伪装。她开始仔细观察家中仆役，寻找可信赖的耳目，并暗中翻阅父亲书房中被尘封的典籍，尤其是那些关于前朝旧事和朝堂秘闻的记载。夜深人静时，她会在烛火'
2025-09-26 00:12:53 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=925 预览='{\n  "text": "武媚娘表面应允入宫，却将这短暂的离家时光视作最后的机会。她深知宫廷是权力的绞肉机，而她目前的稚嫩身躯和身份，是她最大的弱点，也是最好的伪装。她开始仔细观察家中仆役，寻找可信赖的耳目，并暗中翻阅父亲书房中被尘封的典籍，尤其是那些关于前朝旧事和朝堂秘闻的记载。夜深人静时，她会在烛火下默写记忆中的诗'
2025-09-26 00:12:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=925 预览='{\n  "text": "武媚娘表面应允入宫，却将这短暂的离家时光视作最后的机会。她深知宫廷是权力的绞肉机，而她目前的稚嫩身躯和身份，是她最大的弱点，也是最好的伪装。她开始仔细观察家中仆役，寻找可信赖的耳目，并暗中翻阅父亲书房中被尘封的典籍，尤其是那些关于前朝旧事和朝堂秘闻的记载。夜深人静时，她会在烛火下默写记忆中的诗词歌赋，既是温习，也是掩饰。同时，她注意到母亲神色中的一丝忧虑，似乎隐藏着某种不'
2025-09-26 00:12:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 233
2025-09-26 00:12:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:12:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 00:12:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 00:12:53 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:12:53 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=164 parent=162 choice='表面应允，暗中筹谋布局'
2025-09-26 00:12:55 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3350
2025-09-26 00:12:55 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=989 预览='```json\n{\n  "text": "“依旨入宫，顺应历史洪流。”武媚娘轻叹一声，踏入了那朱红色的宫门。厚重的宫墙隔绝了外界的喧嚣，也隔绝了她曾经的自由。她被分配到掖庭，与其他新入宫的才人、采女一同学习宫规礼仪。眼前是望不到头的深宫院落，耳畔是嬷嬷们严苛的训斥与宫女们窃窃私语的嘲讽。她不再是武家那个受宠的小姐，而只是千百个渴望帝王垂青的女子之一。一日，在御花园中随众采摘花卉时，她偶然瞥见太宗皇帝在远处与几位宠妃谈笑风生，其中一位明艳动人，正是徐惠妃。徐惠妃的温婉与才情，在宫中素有贤名，深得帝心。武媚娘心中警醒，她知道，若想在这宫中立足，仅仅依靠美貌远远不够。她必须展现出超越常人的智慧与胆识'
2025-09-26 00:12:55 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=989 预览='```json\n{\n  "text": "“依旨入宫，顺应历史洪流。”武媚娘轻叹一声，踏入了那朱红色的宫门。厚重的宫墙隔绝了外界的喧嚣，也隔绝了她曾经的自由。她被分配到掖庭，与其他新入宫的才人、采女一同学习宫规礼仪。眼前是望不到头的深宫院落，耳畔是嬷嬷们严苛的训斥与宫女们窃窃私语的嘲讽。她不再是武家那个受宠的小姐，而只'
2025-09-26 00:12:55 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=977 预览='{\n  "text": "“依旨入宫，顺应历史洪流。”武媚娘轻叹一声，踏入了那朱红色的宫门。厚重的宫墙隔绝了外界的喧嚣，也隔绝了她曾经的自由。她被分配到掖庭，与其他新入宫的才人、采女一同学习宫规礼仪。眼前是望不到头的深宫院落，耳畔是嬷嬷们严苛的训斥与宫女们窃窃私语的嘲讽。她不再是武家那个受宠的小姐，而只是千百个渴望帝王'
2025-09-26 00:12:55 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=977 预览='{\n  "text": "“依旨入宫，顺应历史洪流。”武媚娘轻叹一声，踏入了那朱红色的宫门。厚重的宫墙隔绝了外界的喧嚣，也隔绝了她曾经的自由。她被分配到掖庭，与其他新入宫的才人、采女一同学习宫规礼仪。眼前是望不到头的深宫院落，耳畔是嬷嬷们严苛的训斥与宫女们窃窃私语的嘲讽。她不再是武家那个受宠的小姐，而只是千百个渴望帝王垂青的女子之一。一日，在御花园中随众采摘花卉时，她偶然瞥见太宗皇帝在远处与几位宠'
2025-09-26 00:12:55 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 353
2025-09-26 00:12:55 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:12:55 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 00:12:55 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 00:12:55 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:12:55 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=165 parent=162 choice='依旨入宫，顺应历史洪流'
2025-09-26 00:12:55 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 独自冒险，趁夜色从武府后门潜逃
2025-09-26 00:12:55 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 寻求母亲杨氏的帮助，伪造病症以推迟入宫
2025-09-26 00:12:55 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暂时顺应旨意入宫，再伺机寻找逃脱或改变命运的机会
2025-09-26 00:13:23 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3343
2025-09-26 00:13:23 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1017 预览='```json\n{\n  "text": "武媚娘深吸一口气，在夜深人静时敲响了母亲杨氏的房门。她将入宫的恐惧与前世的零星记忆，巧妙地编织成一个关于“心悸不宁、夜不能寐”的梦魇，恳求母亲设法推迟入宫。杨氏初闻此言，秀眉紧蹙，既有对女儿身体的担忧，更有一丝对“抗旨”可能带来灭顶之灾的恐惧。她深知宫廷旨意不容违抗，但看到女儿眼中那份前所未有的决绝与哀求，心头不禁动摇。一番挣扎后，杨氏最终决定冒险一试。她召集府中心腹老仆，开始密谋如何伪造一场足以瞒过宫廷查验的“风寒重症”。然而，伪病并非易事，稍有不慎，便会引来宫中严查，届时武家将面临欺君之罪。更何况，太宗皇帝的选秀使者并非等闲之辈，其背后更有无数双眼'
2025-09-26 00:13:23 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1017 预览='```json\n{\n  "text": "武媚娘深吸一口气，在夜深人静时敲响了母亲杨氏的房门。她将入宫的恐惧与前世的零星记忆，巧妙地编织成一个关于“心悸不宁、夜不能寐”的梦魇，恳求母亲设法推迟入宫。杨氏初闻此言，秀眉紧蹙，既有对女儿身体的担忧，更有一丝对“抗旨”可能带来灭顶之灾的恐惧。她深知宫廷旨意不容违抗，但看到女儿'
2025-09-26 00:13:23 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=1005 预览='{\n  "text": "武媚娘深吸一口气，在夜深人静时敲响了母亲杨氏的房门。她将入宫的恐惧与前世的零星记忆，巧妙地编织成一个关于“心悸不宁、夜不能寐”的梦魇，恳求母亲设法推迟入宫。杨氏初闻此言，秀眉紧蹙，既有对女儿身体的担忧，更有一丝对“抗旨”可能带来灭顶之灾的恐惧。她深知宫廷旨意不容违抗，但看到女儿眼中那份前所未有'
2025-09-26 00:13:23 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1005 预览='{\n  "text": "武媚娘深吸一口气，在夜深人静时敲响了母亲杨氏的房门。她将入宫的恐惧与前世的零星记忆，巧妙地编织成一个关于“心悸不宁、夜不能寐”的梦魇，恳求母亲设法推迟入宫。杨氏初闻此言，秀眉紧蹙，既有对女儿身体的担忧，更有一丝对“抗旨”可能带来灭顶之灾的恐惧。她深知宫廷旨意不容违抗，但看到女儿眼中那份前所未有的决绝与哀求，心头不禁动摇。一番挣扎后，杨氏最终决定冒险一试。她召集府中心腹老仆'
2025-09-26 00:13:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 284
2025-09-26 00:13:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:13:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 00:13:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 00:13:23 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:13:23 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=166 parent=163 choice='寻求母亲杨氏的帮助，伪造病症以推迟入宫'
2025-09-26 00:13:23 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3509
2025-09-26 00:13:23 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=867 预览='```json\n{\n  "text": "夜幕低垂，武府内灯火渐稀。武媚娘屏住呼吸，轻手轻脚地避开巡逻的家丁，凭借前世对府邸布局的记忆，悄然摸向后门。她用一枚精心准备的铜片，费力地拨弄着门闩。一声轻微的“咔哒”声，门开了。寒风裹挟着湿气扑面而来，她顾不得多想，闪身而出。然而，还没等她松一口气，一道黑影从巷口闪过，紧接着，冰冷的刀刃抵住了她的脖颈。一个沙哑的声音在她耳边低语：“小丫头，深更半夜，往哪儿跑啊？”她心头一凛，知道自己被盯上了，这绝非偶然的劫匪。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "奋力反抗，寻找脱'
2025-09-26 00:13:23 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=867 预览='```json\n{\n  "text": "夜幕低垂，武府内灯火渐稀。武媚娘屏住呼吸，轻手轻脚地避开巡逻的家丁，凭借前世对府邸布局的记忆，悄然摸向后门。她用一枚精心准备的铜片，费力地拨弄着门闩。一声轻微的“咔哒”声，门开了。寒风裹挟着湿气扑面而来，她顾不得多想，闪身而出。然而，还没等她松一口气，一道黑影从巷口闪过，紧接着'
2025-09-26 00:13:23 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=855 预览='{\n  "text": "夜幕低垂，武府内灯火渐稀。武媚娘屏住呼吸，轻手轻脚地避开巡逻的家丁，凭借前世对府邸布局的记忆，悄然摸向后门。她用一枚精心准备的铜片，费力地拨弄着门闩。一声轻微的“咔哒”声，门开了。寒风裹挟着湿气扑面而来，她顾不得多想，闪身而出。然而，还没等她松一口气，一道黑影从巷口闪过，紧接着，冰冷的刀刃抵住'
2025-09-26 00:13:23 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=855 预览='{\n  "text": "夜幕低垂，武府内灯火渐稀。武媚娘屏住呼吸，轻手轻脚地避开巡逻的家丁，凭借前世对府邸布局的记忆，悄然摸向后门。她用一枚精心准备的铜片，费力地拨弄着门闩。一声轻微的“咔哒”声，门开了。寒风裹挟着湿气扑面而来，她顾不得多想，闪身而出。然而，还没等她松一口气，一道黑影从巷口闪过，紧接着，冰冷的刀刃抵住了她的脖颈。一个沙哑的声音在她耳边低语：“小丫头，深更半夜，往哪儿跑啊？”她心头'
2025-09-26 00:13:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 208
2025-09-26 00:13:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:13:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 00:13:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 00:13:23 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:13:23 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=167 parent=163 choice='独自冒险，趁夜色从武府后门潜逃'
2025-09-26 00:13:53 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3518
2025-09-26 00:13:53 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=996 预览='```json\n{\n  "text": "武媚娘深吸一口气，压下了心头所有的不甘与恐惧。既然无法抗旨，那便暂时顺应。她随同其他秀女一同入宫，高大的宫墙隔绝了外面的世界，也隔绝了她所有的退路。太液池畔，亭台楼阁，金碧辉煌，却也处处透着森严与冷酷。她被分派到掖庭宫，与其他才人共居一室。这里等级森严，明争暗斗从不曾停歇。她观察着周围的秀女们，有的天真烂漫，有的野心勃勃，有的则已学会了深藏不露。前世的记忆让她对这一切了然于心，但今生，她不再是那个懵懂的少女。她知道，这宫中每一个人都可能是棋子，也可能是对手。她必须小心翼翼，同时寻找着改变命运的契机。然而，她很快发现，宫中的耳目众多，一举一动皆在监视之下'
2025-09-26 00:13:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=996 预览='```json\n{\n  "text": "武媚娘深吸一口气，压下了心头所有的不甘与恐惧。既然无法抗旨，那便暂时顺应。她随同其他秀女一同入宫，高大的宫墙隔绝了外面的世界，也隔绝了她所有的退路。太液池畔，亭台楼阁，金碧辉煌，却也处处透着森严与冷酷。她被分派到掖庭宫，与其他才人共居一室。这里等级森严，明争暗斗从不曾停歇。她观'
2025-09-26 00:13:53 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=984 预览='{\n  "text": "武媚娘深吸一口气，压下了心头所有的不甘与恐惧。既然无法抗旨，那便暂时顺应。她随同其他秀女一同入宫，高大的宫墙隔绝了外面的世界，也隔绝了她所有的退路。太液池畔，亭台楼阁，金碧辉煌，却也处处透着森严与冷酷。她被分派到掖庭宫，与其他才人共居一室。这里等级森严，明争暗斗从不曾停歇。她观察着周围的秀女们'
2025-09-26 00:13:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=984 预览='{\n  "text": "武媚娘深吸一口气，压下了心头所有的不甘与恐惧。既然无法抗旨，那便暂时顺应。她随同其他秀女一同入宫，高大的宫墙隔绝了外面的世界，也隔绝了她所有的退路。太液池畔，亭台楼阁，金碧辉煌，却也处处透着森严与冷酷。她被分派到掖庭宫，与其他才人共居一室。这里等级森严，明争暗斗从不曾停歇。她观察着周围的秀女们，有的天真烂漫，有的野心勃勃，有的则已学会了深藏不露。前世的记忆让她对这一切了然'
2025-09-26 00:13:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 304
2025-09-26 00:13:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:13:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 00:13:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 00:13:53 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:13:53 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=168 parent=163 choice='暂时顺应旨意入宫，再伺机寻找逃脱或改变命运的机会'
2025-09-26 00:13:53 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 探寻母亲的秘密，或尝试拉拢家中某位忠仆。
2025-09-26 00:13:53 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 加紧学习宫廷礼仪、诗词歌赋，同时研究兵法或权谋之术。
2025-09-26 00:13:53 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 借机与洛阳城中某位有声望的儒士或官员家眷建立联系。
2025-09-26 00:14:17 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2866
2025-09-26 00:14:17 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1031 预览='```json\n{\n  "text": "武媚娘将入宫前的最后时光化作一场无声的谍战。她首先将目光投向了母亲杨氏。几番有意无意的试探，她发现母亲在提及父亲当年的一些旧部或洛阳城中的某些官员时，眼神中总会闪过一丝不易察觉的慌乱与疲惫。那并非普通的担忧，更像是一种深藏多年的恐惧或秘密。杨氏总是巧妙地避开话题，或以“小儿女莫要过问朝堂之事”搪塞。这让武媚娘更加确信，母亲身上藏着一个与武家命运息息相关的秘密。\\n\\n与此同时，她也在家中仆役中物色人选。老管家武忠，年迈而沉稳，对武家忠心耿耿，但过于谨慎，难以轻易突破。反倒是贴身侍女小翠，虽年纪尚轻，却心思细腻，对武媚娘敬畏有加，且常在不经意间流露出对宫'
2025-09-26 00:14:17 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1031 预览='```json\n{\n  "text": "武媚娘将入宫前的最后时光化作一场无声的谍战。她首先将目光投向了母亲杨氏。几番有意无意的试探，她发现母亲在提及父亲当年的一些旧部或洛阳城中的某些官员时，眼神中总会闪过一丝不易察觉的慌乱与疲惫。那并非普通的担忧，更像是一种深藏多年的恐惧或秘密。杨氏总是巧妙地避开话题，或以“小儿女莫'
2025-09-26 00:14:17 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=1019 预览='{\n  "text": "武媚娘将入宫前的最后时光化作一场无声的谍战。她首先将目光投向了母亲杨氏。几番有意无意的试探，她发现母亲在提及父亲当年的一些旧部或洛阳城中的某些官员时，眼神中总会闪过一丝不易察觉的慌乱与疲惫。那并非普通的担忧，更像是一种深藏多年的恐惧或秘密。杨氏总是巧妙地避开话题，或以“小儿女莫要过问朝堂之事”'
2025-09-26 00:14:17 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1019 预览='{\n  "text": "武媚娘将入宫前的最后时光化作一场无声的谍战。她首先将目光投向了母亲杨氏。几番有意无意的试探，她发现母亲在提及父亲当年的一些旧部或洛阳城中的某些官员时，眼神中总会闪过一丝不易察觉的慌乱与疲惫。那并非普通的担忧，更像是一种深藏多年的恐惧或秘密。杨氏总是巧妙地避开话题，或以“小儿女莫要过问朝堂之事”搪塞。这让武媚娘更加确信，母亲身上藏着一个与武家命运息息相关的秘密。\\n\\n与此'
2025-09-26 00:14:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 360
2025-09-26 00:14:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:14:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 00:14:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 00:14:17 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:14:17 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=169 parent=164 choice='探寻母亲的秘密，或尝试拉拢家中某位忠仆。'
2025-09-26 00:14:21 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3456
2025-09-26 00:14:21 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1099 预览='```json\n{\n  "text": "武媚娘表面应允入宫，但她的心思早已飞向了洛阳城中的权贵府邸。她巧妙地向母亲杨氏打听城中声望卓著的家族，最终将目光锁定在太常博士崔玄暐的夫人身上。崔夫人素以贤德和对诗书的鉴赏力闻名，其府邸常有雅集。武媚娘借口想在入宫前多学些宫廷礼仪和诗词，说服母亲带她拜访。在崔府的雅集上，武媚娘收敛锋芒，表现得谦逊有礼，却又在不经意间展露了过人的才情。她对崔夫人提及的一首古诗的独特见解，以及对洛阳风物的细致描绘，让崔夫人眼前一亮。崔夫人对这位即将入宫的武家小姐产生了浓厚的兴趣，不仅亲自指点她一些宫廷规矩，还提及了宫中一些不成文的规矩和派系，以及朝中几位重臣的性情。虽然只'
2025-09-26 00:14:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1099 预览='```json\n{\n  "text": "武媚娘表面应允入宫，但她的心思早已飞向了洛阳城中的权贵府邸。她巧妙地向母亲杨氏打听城中声望卓著的家族，最终将目光锁定在太常博士崔玄暐的夫人身上。崔夫人素以贤德和对诗书的鉴赏力闻名，其府邸常有雅集。武媚娘借口想在入宫前多学些宫廷礼仪和诗词，说服母亲带她拜访。在崔府的雅集上，武媚娘'
2025-09-26 00:14:21 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=1087 预览='{\n  "text": "武媚娘表面应允入宫，但她的心思早已飞向了洛阳城中的权贵府邸。她巧妙地向母亲杨氏打听城中声望卓著的家族，最终将目光锁定在太常博士崔玄暐的夫人身上。崔夫人素以贤德和对诗书的鉴赏力闻名，其府邸常有雅集。武媚娘借口想在入宫前多学些宫廷礼仪和诗词，说服母亲带她拜访。在崔府的雅集上，武媚娘收敛锋芒，表现得'
2025-09-26 00:14:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1087 预览='{\n  "text": "武媚娘表面应允入宫，但她的心思早已飞向了洛阳城中的权贵府邸。她巧妙地向母亲杨氏打听城中声望卓著的家族，最终将目光锁定在太常博士崔玄暐的夫人身上。崔夫人素以贤德和对诗书的鉴赏力闻名，其府邸常有雅集。武媚娘借口想在入宫前多学些宫廷礼仪和诗词，说服母亲带她拜访。在崔府的雅集上，武媚娘收敛锋芒，表现得谦逊有礼，却又在不经意间展露了过人的才情。她对崔夫人提及的一首古诗的独特见解，以'
2025-09-26 00:14:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 338
2025-09-26 00:14:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:14:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 00:14:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 00:14:21 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:14:21 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=170 parent=164 choice='借机与洛阳城中某位有声望的儒士或官员家眷建立联系。'
2025-09-26 00:15:24 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 4201
2025-09-26 00:15:24 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1063 预览='```json\n{\n  "text": "武媚娘将入宫前的日子过得如履薄冰，又如饥似渴。白日里，她依着母亲的教导，加紧学习宫廷礼仪，一颦一笑、一举一动都力求完美无瑕，诗词歌赋更是信手拈来，只为掩盖那份深藏的锋芒。夜深人静时，烛火摇曳，她则偷偷翻阅父亲书房的兵法与权谋之术，那些关于帝王心术、朝堂争斗的记载，在她前世的记忆中得到了印证，也让她对即将踏入的深宫有了更清晰的认知。她的进步神速，令母亲既欣慰又担忧。一日，母亲唤她至内室，眼神复杂，欲言又止，似是想提醒什么，又似有难言之隐。就在此时，家中一位年迈的嬷嬷，曾是前朝宫女，无意间瞥见媚娘在书房中研读兵书的场景，眼中闪过一丝不易察觉的惊异与了然。入'
2025-09-26 00:15:24 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1063 预览='```json\n{\n  "text": "武媚娘将入宫前的日子过得如履薄冰，又如饥似渴。白日里，她依着母亲的教导，加紧学习宫廷礼仪，一颦一笑、一举一动都力求完美无瑕，诗词歌赋更是信手拈来，只为掩盖那份深藏的锋芒。夜深人静时，烛火摇曳，她则偷偷翻阅父亲书房的兵法与权谋之术，那些关于帝王心术、朝堂争斗的记载，在她前世的记忆'
2025-09-26 00:15:24 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=1051 预览='{\n  "text": "武媚娘将入宫前的日子过得如履薄冰，又如饥似渴。白日里，她依着母亲的教导，加紧学习宫廷礼仪，一颦一笑、一举一动都力求完美无瑕，诗词歌赋更是信手拈来，只为掩盖那份深藏的锋芒。夜深人静时，烛火摇曳，她则偷偷翻阅父亲书房的兵法与权谋之术，那些关于帝王心术、朝堂争斗的记载，在她前世的记忆中得到了印证，也'
2025-09-26 00:15:24 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1051 预览='{\n  "text": "武媚娘将入宫前的日子过得如履薄冰，又如饥似渴。白日里，她依着母亲的教导，加紧学习宫廷礼仪，一颦一笑、一举一动都力求完美无瑕，诗词歌赋更是信手拈来，只为掩盖那份深藏的锋芒。夜深人静时，烛火摇曳，她则偷偷翻阅父亲书房的兵法与权谋之术，那些关于帝王心术、朝堂争斗的记载，在她前世的记忆中得到了印证，也让她对即将踏入的深宫有了更清晰的认知。她的进步神速，令母亲既欣慰又担忧。一日，母'
2025-09-26 00:15:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 338
2025-09-26 00:15:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:15:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 00:15:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 00:15:24 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:15:24 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=171 parent=164 choice='加紧学习宫廷礼仪、诗词歌赋，同时研究兵法或权谋之术。'
2025-09-26 00:15:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 低调行事，暗中观察
2025-09-26 00:15:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 寻求宫中助力
2025-09-26 00:15:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 找机会展现才华
2025-09-26 00:15:28 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:15:50 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3954
2025-09-26 00:15:50 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1038 预览='```json\n{\n  "text": "武媚娘深知低调的重要性，入宫后她谨守宫规，不争不抢，却将耳目放开。她细心观察着宫中每一个角落：从掌事宫女的脸色，到各宫妃嫔的言行，甚至太监们私下的议论，都成了她了解这座深宫的线索。她发现，太宗皇帝虽宠爱美貌，却更钟情于才情与胆识。徐惠妃的温婉贤淑固然得宠，但偶尔流露出的对政事的独特见解，亦能引起帝王侧目。一日，她在掖庭值守，无意中听到几位老宫女谈论起太宗皇帝近日对《贞观政要》中某些篇章的批注，以及他对边疆战事的忧虑。她们还提到，皇帝对一位新进才人所献的《兰亭集序》摹本颇为赞赏，只是那才人胆怯，未能进一步呈上自己的才华。武媚娘心中一动，这或许是一个机会，'
2025-09-26 00:15:50 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1038 预览='```json\n{\n  "text": "武媚娘深知低调的重要性，入宫后她谨守宫规，不争不抢，却将耳目放开。她细心观察着宫中每一个角落：从掌事宫女的脸色，到各宫妃嫔的言行，甚至太监们私下的议论，都成了她了解这座深宫的线索。她发现，太宗皇帝虽宠爱美貌，却更钟情于才情与胆识。徐惠妃的温婉贤淑固然得宠，但偶尔流露出的对政事的'
2025-09-26 00:15:50 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=1026 预览='{\n  "text": "武媚娘深知低调的重要性，入宫后她谨守宫规，不争不抢，却将耳目放开。她细心观察着宫中每一个角落：从掌事宫女的脸色，到各宫妃嫔的言行，甚至太监们私下的议论，都成了她了解这座深宫的线索。她发现，太宗皇帝虽宠爱美貌，却更钟情于才情与胆识。徐惠妃的温婉贤淑固然得宠，但偶尔流露出的对政事的独特见解，亦能引'
2025-09-26 00:15:50 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1026 预览='{\n  "text": "武媚娘深知低调的重要性，入宫后她谨守宫规，不争不抢，却将耳目放开。她细心观察着宫中每一个角落：从掌事宫女的脸色，到各宫妃嫔的言行，甚至太监们私下的议论，都成了她了解这座深宫的线索。她发现，太宗皇帝虽宠爱美貌，却更钟情于才情与胆识。徐惠妃的温婉贤淑固然得宠，但偶尔流露出的对政事的独特见解，亦能引起帝王侧目。一日，她在掖庭值守，无意中听到几位老宫女谈论起太宗皇帝近日对《贞观政'
2025-09-26 00:15:50 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 341
2025-09-26 00:15:50 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:15:50 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 00:15:50 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 00:15:50 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:15:50 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=172 parent=165 choice='低调行事，暗中观察'
2025-09-26 00:15:52 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2933
2025-09-26 00:15:52 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=957 预览='```json\n{\n  "text": "武媚娘将入宫的指令视为顺应历史洪流的第一步，深知此刻的锋芒毕露只会引火烧身。她每日谨守宫规，与其他才人无异，暗中却细心观察宫廷的运作与太宗皇帝的喜好。她发现太宗虽醉心于徐惠妃的温婉才情，却也欣赏真正的胆识与见解。一日，内侍省奉旨整理御书房，一批珍贵典籍因年久失修而受损。众宫女和才人们手忙脚乱，唯恐惹怒圣上。武媚娘不动声色地观察，发现其中修复方式有误，若强行修补反而会造成二次损坏。这是一个机会，既能展现才华又不至于过于突兀。然而，直接指出错误，可能会被视为僭越，引来妒忌。她必须找到一个巧妙的方式，在这无声的宫廷斗争中，为自己争取一席之地。",\n  "su'
2025-09-26 00:15:52 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=957 预览='```json\n{\n  "text": "武媚娘将入宫的指令视为顺应历史洪流的第一步，深知此刻的锋芒毕露只会引火烧身。她每日谨守宫规，与其他才人无异，暗中却细心观察宫廷的运作与太宗皇帝的喜好。她发现太宗虽醉心于徐惠妃的温婉才情，却也欣赏真正的胆识与见解。一日，内侍省奉旨整理御书房，一批珍贵典籍因年久失修而受损。众宫女和'
2025-09-26 00:15:52 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=945 预览='{\n  "text": "武媚娘将入宫的指令视为顺应历史洪流的第一步，深知此刻的锋芒毕露只会引火烧身。她每日谨守宫规，与其他才人无异，暗中却细心观察宫廷的运作与太宗皇帝的喜好。她发现太宗虽醉心于徐惠妃的温婉才情，却也欣赏真正的胆识与见解。一日，内侍省奉旨整理御书房，一批珍贵典籍因年久失修而受损。众宫女和才人们手忙脚乱，'
2025-09-26 00:15:52 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=945 预览='{\n  "text": "武媚娘将入宫的指令视为顺应历史洪流的第一步，深知此刻的锋芒毕露只会引火烧身。她每日谨守宫规，与其他才人无异，暗中却细心观察宫廷的运作与太宗皇帝的喜好。她发现太宗虽醉心于徐惠妃的温婉才情，却也欣赏真正的胆识与见解。一日，内侍省奉旨整理御书房，一批珍贵典籍因年久失修而受损。众宫女和才人们手忙脚乱，唯恐惹怒圣上。武媚娘不动声色地观察，发现其中修复方式有误，若强行修补反而会造成二'
2025-09-26 00:15:52 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 271
2025-09-26 00:15:52 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:15:52 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 00:15:52 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 00:15:52 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:15:52 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=173 parent=165 choice='找机会展现才华'
2025-09-26 00:16:56 | INFO     | core.llm_clients:generate:192 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 4233
2025-09-26 00:16:56 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1038 预览='{\n  "text": "武媚娘深知，孤身一人在这深宫之中，犹如无根浮萍，随时可能被风浪吞噬。前世的经验清晰地告诉她，若想在这步步杀机的环境中立足，必须寻求助力。她将目光投向了掖庭中那些看似不起眼，实则掌握着宫中脉络的宫女和宦官。他们是宫廷的耳目，也是信息流通的关键，更是她未来可能借力的对象。她开始暗中观察，哪些人看似忠厚可靠，值得拉拢；哪些人又精明世故，或许能成为传递消息的渠道。\\n\\n她注意到，负责掖庭日常事务的尚宫局女官中，有一位姓柳的嬷嬷，虽然面相严厉，但偶尔会在无人时对犯错的小宫女表现出不易察觉的怜悯。而那些负责洒扫、传递消息的小宫女们，平日里也常有抱怨，她们是底层，也是最容易被收买'
2025-09-26 00:16:56 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1038 预览='{\n  "text": "武媚娘深知，孤身一人在这深宫之中，犹如无根浮萍，随时可能被风浪吞噬。前世的经验清晰地告诉她，若想在这步步杀机的环境中立足，必须寻求助力。她将目光投向了掖庭中那些看似不起眼，实则掌握着宫中脉络的宫女和宦官。他们是宫廷的耳目，也是信息流通的关键，更是她未来可能借力的对象。她开始暗中观察，哪些人看似'
2025-09-26 00:16:56 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1038 预览='{\n  "text": "武媚娘深知，孤身一人在这深宫之中，犹如无根浮萍，随时可能被风浪吞噬。前世的经验清晰地告诉她，若想在这步步杀机的环境中立足，必须寻求助力。她将目光投向了掖庭中那些看似不起眼，实则掌握着宫中脉络的宫女和宦官。他们是宫廷的耳目，也是信息流通的关键，更是她未来可能借力的对象。她开始暗中观察，哪些人看似'
2025-09-26 00:16:56 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1038 预览='{\n  "text": "武媚娘深知，孤身一人在这深宫之中，犹如无根浮萍，随时可能被风浪吞噬。前世的经验清晰地告诉她，若想在这步步杀机的环境中立足，必须寻求助力。她将目光投向了掖庭中那些看似不起眼，实则掌握着宫中脉络的宫女和宦官。他们是宫廷的耳目，也是信息流通的关键，更是她未来可能借力的对象。她开始暗中观察，哪些人看似忠厚可靠，值得拉拢；哪些人又精明世故，或许能成为传递消息的渠道。\\n\\n她注意到'
2025-09-26 00:16:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 414
2025-09-26 00:16:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:16:56 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 00:16:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 00:16:56 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:16:56 | DEBUG    | core.speculation:_generate_child_node:148 - [Speculation] created node=174 parent=165 choice='寻求宫中助力'
2025-09-26 00:16:56 | ERROR    | core.speculation:_run:91 - [Speculation] failed session=42 node=162 depth=3: cannot schedule new futures after interpreter shutdown
2025-09-26 00:16:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:16:58 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:16:58 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:16:58 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:16:58 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:16:58 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:16:58 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:16:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:16:59 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-26 00:16:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:16:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:16:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:16:59 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:16:59 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:16:59 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:16:59 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:16:59 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:16:59 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:17:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:17:01 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:17:01 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:17:01 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:17:01 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:17:01 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:17:01 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:17:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:17:01 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=3 workers=4 expiry=30min
2025-09-26 00:17:01 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:17:01 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:17:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:17:02 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:17:02 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:17:02 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:17:02 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:17:02 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:18:06 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:18:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:18:08 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:18:08 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:18:08 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:18:08 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:18:08 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:18:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:18:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:18:08 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:18:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:18:08 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:18:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:18:09 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:18:09 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:18:09 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:18:09 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:18:09 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:18:49 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:18:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:18:52 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:18:52 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:18:52 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:18:52 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:18:52 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:18:52 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:18:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:18:52 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:18:52 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:18:52 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:18:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:18:53 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:18:53 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:18:53 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:18:53 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:18:53 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:19:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:19:31 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:19:32 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:19:32 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:19:32 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:19:32 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:19:32 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:19:32 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:19:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:19:32 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:19:32 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:19:32 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:19:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:19:34 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:19:34 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:19:34 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:19:34 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:19:34 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:26:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:26:18 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:26:19 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:26:19 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:26:19 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:26:19 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:26:19 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:26:19 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:26:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:26:19 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:26:19 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:26:19 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:26:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:26:20 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:26:20 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:26:20 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:26:20 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:26:20 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:26:37 | INFO     | api.story:prepare_start_level:94 - 开始生成故事概要，愿望：狄仁杰...
2025-09-26 00:26:55 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1942
2025-09-26 00:27:35 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:27:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:28:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:28:00 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:28:01 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:28:01 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:28:01 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:28:01 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:28:01 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:28:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:28:01 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:28:01 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:28:01 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:28:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:28:02 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:28:02 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:28:02 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:28:02 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:28:02 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:28:28 | INFO     | api.story:prepare_start_level:94 - 开始生成故事概要，愿望：刘备...
2025-09-26 00:28:48 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1865
2025-09-26 00:30:11 | INFO     | api.story:start_new_story:170 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 刘备
2025-09-26 00:30:11 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-26 00:31:04 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2818
2025-09-26 00:31:04 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=814 预览='{"text":"幽州涿郡，初春料峭，寒意未尽。茅庐外，市井喧嚣与黄巾贼乱的流言交织成一片嗡鸣。我，刘备，一个贩履织席的寒门之后，猛然从一场漫长而模糊的梦境中惊醒。那梦境，是铁蹄踏碎河山，是桃园结义的誓言，是白帝城托孤的悲凉……一切都如此真实，又如此虚幻。我分明记得自己已是蜀汉昭烈皇帝，却又回到了这双耳垂肩、双手过膝的青年躯壳里。窗外，官府的征募告示被风吹得猎猎作响，字里行间透着绝望与号召。黄巾贼势如燎原，天下将倾。我胸中涌动着前所未有的激荡，这不是我所熟知的历史开端，或者说，我有了改变它的机会。那些未竟的宏图，那些失散的兄弟，那些错过的遗憾，此刻如同烈火般灼烧着我的心。我望向简陋的床榻，一个'
2025-09-26 00:31:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=814 预览='{"text":"幽州涿郡，初春料峭，寒意未尽。茅庐外，市井喧嚣与黄巾贼乱的流言交织成一片嗡鸣。我，刘备，一个贩履织席的寒门之后，猛然从一场漫长而模糊的梦境中惊醒。那梦境，是铁蹄踏碎河山，是桃园结义的誓言，是白帝城托孤的悲凉……一切都如此真实，又如此虚幻。我分明记得自己已是蜀汉昭烈皇帝，却又回到了这双耳垂肩、双手过膝的'
2025-09-26 00:31:04 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=814 预览='{"text":"幽州涿郡，初春料峭，寒意未尽。茅庐外，市井喧嚣与黄巾贼乱的流言交织成一片嗡鸣。我，刘备，一个贩履织席的寒门之后，猛然从一场漫长而模糊的梦境中惊醒。那梦境，是铁蹄踏碎河山，是桃园结义的誓言，是白帝城托孤的悲凉……一切都如此真实，又如此虚幻。我分明记得自己已是蜀汉昭烈皇帝，却又回到了这双耳垂肩、双手过膝的'
2025-09-26 00:31:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=814 预览='{"text":"幽州涿郡，初春料峭，寒意未尽。茅庐外，市井喧嚣与黄巾贼乱的流言交织成一片嗡鸣。我，刘备，一个贩履织席的寒门之后，猛然从一场漫长而模糊的梦境中惊醒。那梦境，是铁蹄踏碎河山，是桃园结义的誓言，是白帝城托孤的悲凉……一切都如此真实，又如此虚幻。我分明记得自己已是蜀汉昭烈皇帝，却又回到了这双耳垂肩、双手过膝的青年躯壳里。窗外，官府的征募告示被风吹得猎猎作响，字里行间透着绝望与号召。黄巾贼'
2025-09-26 00:31:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 305
2025-09-26 00:31:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:31:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 00:31:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 00:31:04 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/fantasy_castle.jpg
2025-09-26 00:31:04 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 00:31:04 | INFO     | api.story:start_new_story:218 - 新故事生成成功
2025-09-26 00:31:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=43 node=175 depth=3
2025-09-26 00:31:04 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=175
2025-09-26 00:31:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 响应募兵，寻求桃园旧识
2025-09-26 00:31:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暂不应募，暗访豪族，储备资源
2025-09-26 00:31:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 避开战乱，前往偏远之地，隐忍发展
2025-09-26 00:31:31 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3022
2025-09-26 00:31:31 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=732 预览='{"text":"刘备， esche弃了立刻投军的念头，转而将目光投向了涿郡的乡里豪强。他深知，乱世之中，资源与人脉方是立足之本。几日来，他乔装打扮，穿梭于市井酒肆，旁敲侧击地打探着当地大户的背景与倾向。张世平、苏双等马商巨贾的名字不时传入耳中，他们的财富足以支撑一支军队。然而，这些豪族对一个贩履织席的寒门青年，多半不屑一顾。如何在不暴露来历的情况下，让他们看到自己的价值，并为己所用，成了刘备当前最大的难题。他感到一股无形的压力，时间不等人，黄巾之乱的火焰已在远处隐隐燃烧。","success_rate":68,"choices":[{"option":"直接拜访张世平或苏双，陈述利害，寻求资'
2025-09-26 00:31:31 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=732 预览='{"text":"刘备， esche弃了立刻投军的念头，转而将目光投向了涿郡的乡里豪强。他深知，乱世之中，资源与人脉方是立足之本。几日来，他乔装打扮，穿梭于市井酒肆，旁敲侧击地打探着当地大户的背景与倾向。张世平、苏双等马商巨贾的名字不时传入耳中，他们的财富足以支撑一支军队。然而，这些豪族对一个贩履织席的寒门青年，多半不'
2025-09-26 00:31:31 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=732 预览='{"text":"刘备， esche弃了立刻投军的念头，转而将目光投向了涿郡的乡里豪强。他深知，乱世之中，资源与人脉方是立足之本。几日来，他乔装打扮，穿梭于市井酒肆，旁敲侧击地打探着当地大户的背景与倾向。张世平、苏双等马商巨贾的名字不时传入耳中，他们的财富足以支撑一支军队。然而，这些豪族对一个贩履织席的寒门青年，多半不'
2025-09-26 00:31:31 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=732 预览='{"text":"刘备， esche弃了立刻投军的念头，转而将目光投向了涿郡的乡里豪强。他深知，乱世之中，资源与人脉方是立足之本。几日来，他乔装打扮，穿梭于市井酒肆，旁敲侧击地打探着当地大户的背景与倾向。张世平、苏双等马商巨贾的名字不时传入耳中，他们的财富足以支撑一支军队。然而，这些豪族对一个贩履织席的寒门青年，多半不屑一顾。如何在不暴露来历的情况下，让他们看到自己的价值，并为己所用，成了刘备当前'
2025-09-26 00:31:31 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 230
2025-09-26 00:31:31 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:31:31 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 00:31:31 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 00:31:31 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:31:31 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=176 parent=175 choice='暂不应募，暗访豪族，储备资源'
2025-09-26 00:31:31 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=43 node=176 depth=2
2025-09-26 00:31:31 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=176 completed, triggered next level depth=2
2025-09-26 00:31:31 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=176
2025-09-26 00:31:31 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 直接拜访张世平或苏双，陈述利害，寻求资助
2025-09-26 00:31:31 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 结交当地游侠或底层官吏，通过他们引荐豪族
2025-09-26 00:31:31 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暂缓接触豪族，先利用自身优势，在市井中建立声望
2025-09-26 00:31:53 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3207
2025-09-26 00:31:53 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=698 预览='{"text":"刘备深知，民心所向，方是成事之基。他并未急于求见豪族，而是继续在市井中贩履织席，却不再仅仅是谋生。他以更敏锐的洞察力倾听百姓疾苦，以温和而坚定的言辞排解邻里纠纷。他的摊位前，渐渐聚拢了更多人，他们不只是买卖，更来寻求建议与慰藉。一日，市集上突发争执，一队官差欲强征民女，百姓敢怒不敢言。刘备见状，心头火起，这正是他展现仁德与担当的机会。他明白，此刻的抉择，将决定他在百姓心中的分量，也可能引来意想不到的盟友或敌人。","success_rate":70,"choices":[{"option":"直接出面，喝止官差暴行","summary":"冒着得罪官府的风险，正面阻止官差的恶'
2025-09-26 00:31:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=698 预览='{"text":"刘备深知，民心所向，方是成事之基。他并未急于求见豪族，而是继续在市井中贩履织席，却不再仅仅是谋生。他以更敏锐的洞察力倾听百姓疾苦，以温和而坚定的言辞排解邻里纠纷。他的摊位前，渐渐聚拢了更多人，他们不只是买卖，更来寻求建议与慰藉。一日，市集上突发争执，一队官差欲强征民女，百姓敢怒不敢言。刘备见状，心头火'
2025-09-26 00:31:53 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=698 预览='{"text":"刘备深知，民心所向，方是成事之基。他并未急于求见豪族，而是继续在市井中贩履织席，却不再仅仅是谋生。他以更敏锐的洞察力倾听百姓疾苦，以温和而坚定的言辞排解邻里纠纷。他的摊位前，渐渐聚拢了更多人，他们不只是买卖，更来寻求建议与慰藉。一日，市集上突发争执，一队官差欲强征民女，百姓敢怒不敢言。刘备见状，心头火'
2025-09-26 00:31:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=698 预览='{"text":"刘备深知，民心所向，方是成事之基。他并未急于求见豪族，而是继续在市井中贩履织席，却不再仅仅是谋生。他以更敏锐的洞察力倾听百姓疾苦，以温和而坚定的言辞排解邻里纠纷。他的摊位前，渐渐聚拢了更多人，他们不只是买卖，更来寻求建议与慰藉。一日，市集上突发争执，一队官差欲强征民女，百姓敢怒不敢言。刘备见状，心头火起，这正是他展现仁德与担当的机会。他明白，此刻的抉择，将决定他在百姓心中的分量，'
2025-09-26 00:31:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 207
2025-09-26 00:31:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:31:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 00:31:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 00:31:53 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:31:53 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=177 parent=176 choice='暂缓接触豪族，先利用自身优势，在市井中建立声望'
2025-09-26 00:31:53 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=43 node=177 depth=1
2025-09-26 00:31:53 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=177 completed, triggered next level depth=1
2025-09-26 00:31:58 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2854
2025-09-26 00:31:58 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=746 预览='{"text":"刘备深知，直接拜访豪族无异于自取其辱。他改变策略，将目光投向了那些活跃于市井、却又与官府或豪强有所瓜葛的人物。他以贩履织席的身份为掩护，在茶馆酒肆中细心观察，不时出手帮助弱小，或以精湛的编织技艺赢得些许好感。数日后，他结识了一位名叫简雍的故交，此人虽非显赫，却心怀抱负，对时局多有不满，且与县中几位底层官吏有旧。简雍对刘备的谈吐与气度颇感惊异，隐约觉得他并非寻常贩夫。在一次深夜长谈后，简雍决定引荐刘备去见一位在涿郡颇有声望的游侠——关羽。","success_rate":68,"choices":[{"option":"寻求关羽引荐更多武勇之士，立刻组建初期武装。","summ'
2025-09-26 00:31:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=746 预览='{"text":"刘备深知，直接拜访豪族无异于自取其辱。他改变策略，将目光投向了那些活跃于市井、却又与官府或豪强有所瓜葛的人物。他以贩履织席的身份为掩护，在茶馆酒肆中细心观察，不时出手帮助弱小，或以精湛的编织技艺赢得些许好感。数日后，他结识了一位名叫简雍的故交，此人虽非显赫，却心怀抱负，对时局多有不满，且与县中几位底层'
2025-09-26 00:31:58 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=746 预览='{"text":"刘备深知，直接拜访豪族无异于自取其辱。他改变策略，将目光投向了那些活跃于市井、却又与官府或豪强有所瓜葛的人物。他以贩履织席的身份为掩护，在茶馆酒肆中细心观察，不时出手帮助弱小，或以精湛的编织技艺赢得些许好感。数日后，他结识了一位名叫简雍的故交，此人虽非显赫，却心怀抱负，对时局多有不满，且与县中几位底层'
2025-09-26 00:31:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=746 预览='{"text":"刘备深知，直接拜访豪族无异于自取其辱。他改变策略，将目光投向了那些活跃于市井、却又与官府或豪强有所瓜葛的人物。他以贩履织席的身份为掩护，在茶馆酒肆中细心观察，不时出手帮助弱小，或以精湛的编织技艺赢得些许好感。数日后，他结识了一位名叫简雍的故交，此人虽非显赫，却心怀抱负，对时局多有不满，且与县中几位底层官吏有旧。简雍对刘备的谈吐与气度颇感惊异，隐约觉得他并非寻常贩夫。在一次深夜长谈'
2025-09-26 00:31:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 220
2025-09-26 00:31:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:31:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 00:31:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 00:31:58 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:31:58 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=178 parent=176 choice='结交当地游侠或底层官吏，通过他们引荐豪族'
2025-09-26 00:31:58 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=43 node=178 depth=1
2025-09-26 00:31:58 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=178 completed, triggered next level depth=1
2025-09-26 00:31:59 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3665
2025-09-26 00:31:59 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=789 预览='{"text":"刘备选择了马商张世平，深知其财力雄厚。他着装虽朴素却整洁，来到张府门前，向看门人表明来意。守卫见他并非富贵之人，眼神中带着不屑，将他晾在侧门良久。直到日暮时分，刘备才得以进入偏厅，见到端坐上首的张世平。这位商人短须精明，手中把玩着一块玉佩，神色淡漠地问：“足下何人？有何要事？”刘备不卑不亢，将胸中对黄巾之乱的预判、朝廷的无力、以及涿郡未来可能面临的危局，条理清晰地陈述。他没有提及任何超凡之事，只着重强调了乱世之中，唯有自募义勇、储备粮草，方能保全家业与一方百姓的道理。他描绘了一幅若能早做准备，便可化危为机，成就大业的宏图。张世平听罢，眼中闪过一丝精光，却未置可否，只是轻啜一口'
2025-09-26 00:31:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=789 预览='{"text":"刘备选择了马商张世平，深知其财力雄厚。他着装虽朴素却整洁，来到张府门前，向看门人表明来意。守卫见他并非富贵之人，眼神中带着不屑，将他晾在侧门良久。直到日暮时分，刘备才得以进入偏厅，见到端坐上首的张世平。这位商人短须精明，手中把玩着一块玉佩，神色淡漠地问：“足下何人？有何要事？”刘备不卑不亢，将胸中对黄'
2025-09-26 00:31:59 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=789 预览='{"text":"刘备选择了马商张世平，深知其财力雄厚。他着装虽朴素却整洁，来到张府门前，向看门人表明来意。守卫见他并非富贵之人，眼神中带着不屑，将他晾在侧门良久。直到日暮时分，刘备才得以进入偏厅，见到端坐上首的张世平。这位商人短须精明，手中把玩着一块玉佩，神色淡漠地问：“足下何人？有何要事？”刘备不卑不亢，将胸中对黄'
2025-09-26 00:31:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=789 预览='{"text":"刘备选择了马商张世平，深知其财力雄厚。他着装虽朴素却整洁，来到张府门前，向看门人表明来意。守卫见他并非富贵之人，眼神中带着不屑，将他晾在侧门良久。直到日暮时分，刘备才得以进入偏厅，见到端坐上首的张世平。这位商人短须精明，手中把玩着一块玉佩，神色淡漠地问：“足下何人？有何要事？”刘备不卑不亢，将胸中对黄巾之乱的预判、朝廷的无力、以及涿郡未来可能面临的危局，条理清晰地陈述。他没有提及'
2025-09-26 00:31:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 310
2025-09-26 00:31:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:31:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 00:31:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 00:31:59 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:31:59 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=179 parent=176 choice='直接拜访张世平或苏双，陈述利害，寻求资助'
2025-09-26 00:31:59 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=43 node=179 depth=1
2025-09-26 00:31:59 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=179 completed, triggered next level depth=1
2025-09-26 00:32:01 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:32:05 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3090
2025-09-26 00:32:05 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=816 预览='{"text":"刘备深吸一口气，心中已然有了计较。他没有选择应募，也没有立即投身战火，而是收拾起简陋的行囊，告别了涿郡的喧嚣与乱象。他决定南下，避开这风暴的中心，寻找一处偏远之地，隐忍发展。一路上，他目睹了黄巾贼的肆虐，也看到了官府的无力。流民遍野，饿殍载途，昔日繁华的村落如今十室九空。他乔装成普通商贩，沿途贩卖些草鞋布匹，耳闻目睹着天下大势的剧变。最终，他抵达了荆州南阳郡与益州交界处的一处偏僻山村——桃源村。这里地势险要，易守难攻，民风淳朴，暂时未受战火波及。刘备决定在此落脚，以织席贩履为生，暗中观察局势，等待时机。然而，平静的日子并未持续太久，村中近日来了一伙不明身份的流民，他们身强体壮'
2025-09-26 00:32:05 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=816 预览='{"text":"刘备深吸一口气，心中已然有了计较。他没有选择应募，也没有立即投身战火，而是收拾起简陋的行囊，告别了涿郡的喧嚣与乱象。他决定南下，避开这风暴的中心，寻找一处偏远之地，隐忍发展。一路上，他目睹了黄巾贼的肆虐，也看到了官府的无力。流民遍野，饿殍载途，昔日繁华的村落如今十室九空。他乔装成普通商贩，沿途贩卖些草'
2025-09-26 00:32:05 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=816 预览='{"text":"刘备深吸一口气，心中已然有了计较。他没有选择应募，也没有立即投身战火，而是收拾起简陋的行囊，告别了涿郡的喧嚣与乱象。他决定南下，避开这风暴的中心，寻找一处偏远之地，隐忍发展。一路上，他目睹了黄巾贼的肆虐，也看到了官府的无力。流民遍野，饿殍载途，昔日繁华的村落如今十室九空。他乔装成普通商贩，沿途贩卖些草'
2025-09-26 00:32:05 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=816 预览='{"text":"刘备深吸一口气，心中已然有了计较。他没有选择应募，也没有立即投身战火，而是收拾起简陋的行囊，告别了涿郡的喧嚣与乱象。他决定南下，避开这风暴的中心，寻找一处偏远之地，隐忍发展。一路上，他目睹了黄巾贼的肆虐，也看到了官府的无力。流民遍野，饿殍载途，昔日繁华的村落如今十室九空。他乔装成普通商贩，沿途贩卖些草鞋布匹，耳闻目睹着天下大势的剧变。最终，他抵达了荆州南阳郡与益州交界处的一处偏僻'
2025-09-26 00:32:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 312
2025-09-26 00:32:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 00:32:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 00:32:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 00:32:05 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 00:32:05 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=180 parent=175 choice='避开战乱，前往偏远之地，隐忍发展'
2025-09-26 00:32:05 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=43 node=180 depth=2
2025-09-26 00:32:05 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '避开战乱，前往偏远之地，隐忍发展': cannot schedule new futures after shutdown
2025-09-26 00:33:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:33:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:33:14 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:33:14 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:33:14 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:33:14 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:33:14 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:33:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:33:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:33:14 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:33:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:33:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:33:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:33:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:33:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:33:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:33:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:33:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:33:38 | INFO     | api.story:prepare_start_level:94 - 开始生成故事概要，愿望：张飞...
2025-09-26 00:33:56 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2246
2025-09-26 00:33:56 | INFO     | api.story:prepare_start_level:141 - 故事概要生成完成，愿望：张飞...
2025-09-26 00:35:15 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:35:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:35:17 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:35:17 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:35:17 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:35:17 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:35:17 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:35:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:35:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:35:18 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:35:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:35:18 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:35:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:35:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:35:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:35:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:35:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:35:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:35:49 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:35:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:35:52 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:35:52 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:35:52 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:35:52 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:35:52 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:35:52 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:35:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:35:52 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:35:52 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:35:52 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:35:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:35:53 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:35:53 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:35:53 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:35:53 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:35:53 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:36:08 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:36:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:36:10 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:36:10 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:36:10 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:36:10 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:36:10 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:36:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:36:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:36:10 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:36:10 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:36:10 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:36:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:36:11 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:36:11 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:36:11 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:36:11 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:36:11 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:37:38 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:37:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:37:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:37:43 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:37:43 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:37:43 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:37:43 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:37:43 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:37:43 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:37:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:37:43 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:37:43 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:37:43 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:37:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:37:44 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:37:44 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:37:44 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:37:44 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:37:44 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:38:10 | INFO     | api.story:prepare_start_level:94 - 开始生成故事概要，愿望：狄仁杰...
2025-09-26 00:38:27 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1936
2025-09-26 00:38:27 | INFO     | api.story:prepare_start_level:140 - 故事概要生成完成，立即启动后台预生成，愿望：狄仁杰...
2025-09-26 00:38:27 | INFO     | core.pregeneration:__init__:22 - [PreGeneration] 后台预生成服务已启动
2025-09-26 00:38:27 | INFO     | core.pregeneration:start_story_generation:42 - [PreGeneration] 启动后台生成第一节故事: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=狄仁杰...
2025-09-26 00:38:27 | DEBUG    | core.pregeneration:_generate_first_story_worker:48 - [PreGeneration] 开始生成第一节故事: user_49ca3f6d-ae3c-44f5-9471-9d51d56ac473_wish_3042723166258253004
2025-09-26 00:38:27 | ERROR    | core.pregeneration:_generate_first_story_worker:67 - [PreGeneration] 第一节故事生成失败: user_49ca3f6d-ae3c-44f5-9471-9d51d56ac473_wish_3042723166258253004, error: StoryEngine.start_story() got an unexpected keyword argument 'historical_context'
2025-09-26 00:40:05 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:40:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:40:08 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:40:08 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:40:08 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:40:08 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:40:08 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:40:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:40:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:40:08 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:40:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:40:08 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:40:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:40:09 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:40:09 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:40:09 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:40:09 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:40:09 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:50:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:50:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:50:15 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:50:15 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:50:15 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:50:15 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:50:15 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:50:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:50:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:50:15 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:50:15 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:50:15 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:50:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:50:16 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:50:16 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:50:16 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:50:16 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:50:16 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:52:30 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 00:52:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:52:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 00:52:35 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 00:52:35 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 00:52:35 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:52:35 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 00:52:35 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 00:52:35 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:52:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:52:35 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 00:52:35 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 00:52:35 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 00:52:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 00:52:36 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 00:52:36 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 00:52:36 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 00:52:36 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 00:52:36 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 00:59:56 | INFO     | api.story:prepare_start_level:133 - 开始生成故事概要，愿望：关羽...
2025-09-26 01:00:24 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2818
2025-09-26 01:00:24 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-26 01:00:24 | INFO     | api.story:prepare_start_level:186 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=关羽...
2025-09-26 01:02:00 | INFO     | api.story:start_new_story:223 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 关羽
2025-09-26 01:02:00 | INFO     | api.story:start_new_story:246 - [pregen] 未命中缓存，现场生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 01:02:00 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-26 01:02:58 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3425
2025-09-26 01:02:58 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=907 预览='{\n  "text": "麦城，残破的城墙在冬日寒风中摇摇欲坠，血迹斑斑的旌旗无力地垂下。关羽，这位曾纵横沙场的武圣，此刻却身披重创，立于城头，目光如炬却又带着一丝不解的迷茫。他清晰地记得，自己本应已命丧临沮，魂归九泉。然而，一股磅礴的力量却将他拉回了这片熟悉的绝境。城外吴军的鼓点如催命符般响起，吕蒙的旗号在风中猎猎作响。昔日誓死追随的将士们，如今只剩寥寥数百，饥寒交迫。背叛的阴影笼罩着荆州，糜芳、傅士仁的倒戈如同利刃刺穿了他的胸膛。他感到一种前所未有的清醒，仿佛能预见未来的每一步棋。这一次，他绝不能让历史重演，荆州绝不能失！但如何破局？",\n  "success_rate": 70,\n  "'
2025-09-26 01:02:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=907 预览='{\n  "text": "麦城，残破的城墙在冬日寒风中摇摇欲坠，血迹斑斑的旌旗无力地垂下。关羽，这位曾纵横沙场的武圣，此刻却身披重创，立于城头，目光如炬却又带着一丝不解的迷茫。他清晰地记得，自己本应已命丧临沮，魂归九泉。然而，一股磅礴的力量却将他拉回了这片熟悉的绝境。城外吴军的鼓点如催命符般响起，吕蒙的旗号在风中猎猎作'
2025-09-26 01:02:58 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=907 预览='{\n  "text": "麦城，残破的城墙在冬日寒风中摇摇欲坠，血迹斑斑的旌旗无力地垂下。关羽，这位曾纵横沙场的武圣，此刻却身披重创，立于城头，目光如炬却又带着一丝不解的迷茫。他清晰地记得，自己本应已命丧临沮，魂归九泉。然而，一股磅礴的力量却将他拉回了这片熟悉的绝境。城外吴军的鼓点如催命符般响起，吕蒙的旗号在风中猎猎作'
2025-09-26 01:02:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=907 预览='{\n  "text": "麦城，残破的城墙在冬日寒风中摇摇欲坠，血迹斑斑的旌旗无力地垂下。关羽，这位曾纵横沙场的武圣，此刻却身披重创，立于城头，目光如炬却又带着一丝不解的迷茫。他清晰地记得，自己本应已命丧临沮，魂归九泉。然而，一股磅礴的力量却将他拉回了这片熟悉的绝境。城外吴军的鼓点如催命符般响起，吕蒙的旗号在风中猎猎作响。昔日誓死追随的将士们，如今只剩寥寥数百，饥寒交迫。背叛的阴影笼罩着荆州，糜芳'
2025-09-26 01:02:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 259
2025-09-26 01:02:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:02:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:02:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:02:58 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/rebirth_gate_placeholder.png
2025-09-26 01:02:58 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 01:02:58 | INFO     | api.story:start_new_story:279 - 新故事生成成功
2025-09-26 01:02:58 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=44 node=181 depth=3
2025-09-26 01:02:58 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=181
2025-09-26 01:02:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 突围而出，寻求援兵
2025-09-26 01:02:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 虚张声势，拖延时间
2025-09-26 01:02:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 坚守待援，反击内奸
2025-09-26 01:03:24 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3399
2025-09-26 01:03:24 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=1168 预览='关羽目光如电，扫过城头残存的将士，心中已然有了决断。他召集周仓、王甫等忠勇之士，沉声下令：“传我军令，即刻清点城中粮草兵械，严防宵小趁乱作祟！糜芳、傅士仁之辈，已是丧家之犬，然其叛逆之心，或已渗透城内。吾等当先稳固军心，再图反击！”他亲自巡视城防，发现粮草已所剩无几，士卒们面有菜色。城外吴军的攻势越发猛烈，而刘封、孟达的援军却迟迟不见踪影。关羽深知，仅仅坚守是远远不够的，必须主动出击，打破这死局。他站在城楼之上，望着远方，一股不甘与怒火在胸中激荡。他必须在援军到来之前，为自己争取到一线生机，并清除一切潜在的威胁。\n\n{\n  "text": "关羽目光如电，扫过城头残存的将士，心中已然有了决断。'
2025-09-26 01:03:24 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1168 预览='关羽目光如电，扫过城头残存的将士，心中已然有了决断。他召集周仓、王甫等忠勇之士，沉声下令：“传我军令，即刻清点城中粮草兵械，严防宵小趁乱作祟！糜芳、傅士仁之辈，已是丧家之犬，然其叛逆之心，或已渗透城内。吾等当先稳固军心，再图反击！”他亲自巡视城防，发现粮草已所剩无几，士卒们面有菜色。城外吴军的攻势越发猛烈，而刘封、孟达'
2025-09-26 01:03:24 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=907 预览='{\n  "text": "关羽目光如电，扫过城头残存的将士，心中已然有了决断。他召集周仓、王甫等忠勇之士，沉声下令：“传我军令，即刻清点城中粮草兵械，严防宵小趁乱作祟！糜芳、傅士仁之辈，已是丧家之犬，然其叛逆之心，或已渗透城内。吾等当先稳固军心，再图反击！”他亲自巡视城防，发现粮草已所剩无几，士卒们面有菜色。城外吴军的'
2025-09-26 01:03:24 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=907 预览='{\n  "text": "关羽目光如电，扫过城头残存的将士，心中已然有了决断。他召集周仓、王甫等忠勇之士，沉声下令：“传我军令，即刻清点城中粮草兵械，严防宵小趁乱作祟！糜芳、傅士仁之辈，已是丧家之犬，然其叛逆之心，或已渗透城内。吾等当先稳固军心，再图反击！”他亲自巡视城防，发现粮草已所剩无几，士卒们面有菜色。城外吴军的攻势越发猛烈，而刘封、孟达的援军却迟迟不见踪影。关羽深知，仅仅坚守是远远不够的，'
2025-09-26 01:03:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 259
2025-09-26 01:03:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:03:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:03:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:03:24 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:03:24 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=182 parent=181 choice='坚守待援，反击内奸'
2025-09-26 01:03:24 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=44 node=182 depth=2
2025-09-26 01:03:24 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=182 completed, triggered next level depth=2
2025-09-26 01:03:24 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=182
2025-09-26 01:03:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 组织精锐突围，北上与刘封会合
2025-09-26 01:03:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派遣死士潜入吴营，散布离间之计
2025-09-26 01:03:24 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 登高演说，激励军民同仇敌忾，加固城防
2025-09-26 01:03:51 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 4024
2025-09-26 01:03:51 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=818 预览='{"text":"关羽采纳了坚守待援、反击内奸的策略。他立即召集周仓、王甫，严令死守城门，将士们轮番上阵，以残破的器械和不屈的意志抵挡着吴军的猛攻。城内，他亲自巡查，发现几名与糜芳、傅士仁过从甚密的校尉暗中串联，试图煽动士卒开城投降。关羽雷厉风行，当夜便将这些内奸及其党羽秘密拿下，斩首示众，震慑了蠢蠢欲动的宵小。此举虽稳固了军心，却也让城内气氛更加凝重。粮草日益见底，援军渺无音讯，吴军的攻势却丝毫未减。吕蒙似乎察觉到城内异动，攻城器械层出不穷，日夜不停。关羽站在城头，望着麾下疲惫却眼神坚毅的将士们，心中清楚，仅仅依靠坚守，终究是饮鸩止渴。他必须找到一个破局之法，一个能彻底扭转乾坤的契机。","'
2025-09-26 01:03:52 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=818 预览='{"text":"关羽采纳了坚守待援、反击内奸的策略。他立即召集周仓、王甫，严令死守城门，将士们轮番上阵，以残破的器械和不屈的意志抵挡着吴军的猛攻。城内，他亲自巡查，发现几名与糜芳、傅士仁过从甚密的校尉暗中串联，试图煽动士卒开城投降。关羽雷厉风行，当夜便将这些内奸及其党羽秘密拿下，斩首示众，震慑了蠢蠢欲动的宵小。此举虽'
2025-09-26 01:03:52 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=818 预览='{"text":"关羽采纳了坚守待援、反击内奸的策略。他立即召集周仓、王甫，严令死守城门，将士们轮番上阵，以残破的器械和不屈的意志抵挡着吴军的猛攻。城内，他亲自巡查，发现几名与糜芳、傅士仁过从甚密的校尉暗中串联，试图煽动士卒开城投降。关羽雷厉风行，当夜便将这些内奸及其党羽秘密拿下，斩首示众，震慑了蠢蠢欲动的宵小。此举虽'
2025-09-26 01:03:52 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=818 预览='{"text":"关羽采纳了坚守待援、反击内奸的策略。他立即召集周仓、王甫，严令死守城门，将士们轮番上阵，以残破的器械和不屈的意志抵挡着吴军的猛攻。城内，他亲自巡查，发现几名与糜芳、傅士仁过从甚密的校尉暗中串联，试图煽动士卒开城投降。关羽雷厉风行，当夜便将这些内奸及其党羽秘密拿下，斩首示众，震慑了蠢蠢欲动的宵小。此举虽稳固了军心，却也让城内气氛更加凝重。粮草日益见底，援军渺无音讯，吴军的攻势却丝毫'
2025-09-26 01:03:52 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 288
2025-09-26 01:03:52 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:03:52 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:03:52 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:03:52 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:03:52 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=183 parent=182 choice='派遣死士潜入吴营，散布离间之计'
2025-09-26 01:03:52 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=44 node=183 depth=1
2025-09-26 01:03:52 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=183 completed, triggered next level depth=1
2025-09-26 01:04:13 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2332
2025-09-26 01:04:13 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=780 预览='{"text":"关羽毅然决然地选择了突围，北上与刘封会合。夜幕降临，麦城内外一片死寂，只有寒风呼啸。他召集周仓、王甫等心腹，低声部署：“吴军围城，南面重兵，北面相对薄弱。今夜，吾等弃辎重，轻装简行，趁夜色掩护，强行突围！”精锐之士三百余人，个个面色凝重，却又眼中闪烁着重生的希望。关羽身先士卒，手持青龙偃月刀，身披血染战袍，如同一尊铁塔。他们从城北一处看似不起眼的偏门悄然出城，然而，吴军并非毫无察觉。一支巡逻队恰好经过，火把的光芒瞬间打破了夜的宁静。箭矢如雨般袭来，吴军的号角声划破长空，预示着一场血战在所难免。关羽怒吼一声，刀光如练，瞬间斩杀数名吴兵，为突围部队撕开了一道血口。然而，吴军的援兵'
2025-09-26 01:04:13 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=780 预览='{"text":"关羽毅然决然地选择了突围，北上与刘封会合。夜幕降临，麦城内外一片死寂，只有寒风呼啸。他召集周仓、王甫等心腹，低声部署：“吴军围城，南面重兵，北面相对薄弱。今夜，吾等弃辎重，轻装简行，趁夜色掩护，强行突围！”精锐之士三百余人，个个面色凝重，却又眼中闪烁着重生的希望。关羽身先士卒，手持青龙偃月刀，身披血染'
2025-09-26 01:04:13 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=780 预览='{"text":"关羽毅然决然地选择了突围，北上与刘封会合。夜幕降临，麦城内外一片死寂，只有寒风呼啸。他召集周仓、王甫等心腹，低声部署：“吴军围城，南面重兵，北面相对薄弱。今夜，吾等弃辎重，轻装简行，趁夜色掩护，强行突围！”精锐之士三百余人，个个面色凝重，却又眼中闪烁着重生的希望。关羽身先士卒，手持青龙偃月刀，身披血染'
2025-09-26 01:04:13 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=780 预览='{"text":"关羽毅然决然地选择了突围，北上与刘封会合。夜幕降临，麦城内外一片死寂，只有寒风呼啸。他召集周仓、王甫等心腹，低声部署：“吴军围城，南面重兵，北面相对薄弱。今夜，吾等弃辎重，轻装简行，趁夜色掩护，强行突围！”精锐之士三百余人，个个面色凝重，却又眼中闪烁着重生的希望。关羽身先士卒，手持青龙偃月刀，身披血染战袍，如同一尊铁塔。他们从城北一处看似不起眼的偏门悄然出城，然而，吴军并非毫无察'
2025-09-26 01:04:13 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 312
2025-09-26 01:04:13 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:04:13 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:04:13 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:04:13 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:04:13 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=184 parent=182 choice='组织精锐突围，北上与刘封会合'
2025-09-26 01:04:13 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=44 node=184 depth=1
2025-09-26 01:04:13 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=184 completed, triggered next level depth=1
2025-09-26 01:04:15 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3190
2025-09-26 01:04:15 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=842 预览='{"text":"关羽身披染血的绿袍，手持青龙偃月刀，登上麦城最高的箭楼。凛冽寒风中，他洪亮的声音如同惊雷般穿透了吴军的鼓点，响彻城内外：“吾乃汉寿亭侯关羽！昔日桃园结义，誓与刘皇叔共扶汉室！如今奸贼吕蒙围城，欲断我汉家血脉！然，吾等岂是贪生怕死之辈？荆州男儿，当誓死卫国！今日之战，非为我关羽一人，乃为天下黎民，为大汉基业！尔等若愿随我死战，他日必将名垂青史！”他的话语掷地有声，激荡着每个人的心弦。原本死气沉沉的城池，瞬间被点燃了斗志。士卒们齐声呐喊，百姓们也自发搬运石木，加固城防。然而，就在这股激昂的士气中，周仓却悄悄找到关羽，低声禀报：“将军，方才清点粮草，发现数处粮仓有被动过手脚的痕迹，'
2025-09-26 01:04:15 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=842 预览='{"text":"关羽身披染血的绿袍，手持青龙偃月刀，登上麦城最高的箭楼。凛冽寒风中，他洪亮的声音如同惊雷般穿透了吴军的鼓点，响彻城内外：“吾乃汉寿亭侯关羽！昔日桃园结义，誓与刘皇叔共扶汉室！如今奸贼吕蒙围城，欲断我汉家血脉！然，吾等岂是贪生怕死之辈？荆州男儿，当誓死卫国！今日之战，非为我关羽一人，乃为天下黎民，为大汉'
2025-09-26 01:04:15 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=842 预览='{"text":"关羽身披染血的绿袍，手持青龙偃月刀，登上麦城最高的箭楼。凛冽寒风中，他洪亮的声音如同惊雷般穿透了吴军的鼓点，响彻城内外：“吾乃汉寿亭侯关羽！昔日桃园结义，誓与刘皇叔共扶汉室！如今奸贼吕蒙围城，欲断我汉家血脉！然，吾等岂是贪生怕死之辈？荆州男儿，当誓死卫国！今日之战，非为我关羽一人，乃为天下黎民，为大汉'
2025-09-26 01:04:15 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=842 预览='{"text":"关羽身披染血的绿袍，手持青龙偃月刀，登上麦城最高的箭楼。凛冽寒风中，他洪亮的声音如同惊雷般穿透了吴军的鼓点，响彻城内外：“吾乃汉寿亭侯关羽！昔日桃园结义，誓与刘皇叔共扶汉室！如今奸贼吕蒙围城，欲断我汉家血脉！然，吾等岂是贪生怕死之辈？荆州男儿，当誓死卫国！今日之战，非为我关羽一人，乃为天下黎民，为大汉基业！尔等若愿随我死战，他日必将名垂青史！”他的话语掷地有声，激荡着每个人的心弦'
2025-09-26 01:04:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 362
2025-09-26 01:04:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:04:15 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:04:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:04:15 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:04:15 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=185 parent=182 choice='登高演说，激励军民同仇敌忾，加固城防'
2025-09-26 01:04:15 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=44 node=185 depth=1
2025-09-26 01:04:15 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=185 completed, triggered next level depth=1
2025-09-26 01:04:15 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1261
2025-09-26 01:04:15 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:15 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:15 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:04:15 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:15 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:04:17 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1259
2025-09-26 01:04:17 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:17 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:17 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:04:17 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:17 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:04:17 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:04:18 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 955
2025-09-26 01:04:18 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:18 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:18 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:04:19 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:19 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:04:41 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:04:41 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:41 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:41 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:04:41 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:41 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=181 choice='突围而出，寻求援兵': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:04:42 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:04:42 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:42 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:42 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:04:42 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:42 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=181 choice='虚张声势，拖延时间': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:04:44 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:04:44 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:44 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:44 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:04:44 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:04:44 | ERROR    | api.story:_background_pregen_first_story:73 - [pregen] 第一节故事预生成失败 user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 wish=关羽...: Expecting value: line 1 column 1 (char 0)
2025-09-26 01:04:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:04:46 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:04:46 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:04:46 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 01:04:46 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 01:04:46 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:04:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:04:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:04:47 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:04:47 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:04:47 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:04:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:04:48 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:04:48 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:04:48 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:04:48 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 01:04:48 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 01:05:20 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:05:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:05:23 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:05:23 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:05:23 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 01:05:23 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 01:05:23 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:05:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:05:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:05:23 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:05:23 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:05:23 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:05:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:05:24 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:05:24 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:05:24 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:05:24 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 01:05:24 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 01:12:35 | INFO     | api.story:prepare_start_level:152 - 开始生成故事概要，愿望：吕布...
2025-09-26 01:12:56 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 2325
2025-09-26 01:12:56 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '吕布'
2025-09-26 01:12:56 | INFO     | api.story:prepare_start_level:206 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=吕布...
2025-09-26 01:14:26 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3861
2025-09-26 01:14:26 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=1040 预览='{\n  "text": "寒风呼啸，卷起长安城中弥漫的血腥与奢靡。吕布，字奉先，立于未央宫高耸的城楼之上，赤兔马的嘶鸣仿佛仍在耳畔，手中的方天画戟沉重如山，戟尖反射着冬日惨淡的阳光。他望着脚下被董卓铁蹄践踏的土地，百姓的哀嚎与士族的谄媚交织成一曲令人作呕的乐章。前世的记忆如潮水般涌来：丁原的头颅，王允的连环计，虎牢关下的三英战吕布，以及最终白门楼上的绝望与悔恨。如今，他重回这乱世，却发现自己身处董卓帐下，身披锦甲，威风凛凛，实则不过是那肥猪董卓手中最锋利的刀。\\n\\n昨日，董卓又在城中设宴，席间残忍处决了数名异己，血污溅染了丝绸华服。吕布亲眼目睹，心底的厌恶与日俱增。一股强烈的冲动在他胸中激荡'
2025-09-26 01:14:26 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=1040 预览='{\n  "text": "寒风呼啸，卷起长安城中弥漫的血腥与奢靡。吕布，字奉先，立于未央宫高耸的城楼之上，赤兔马的嘶鸣仿佛仍在耳畔，手中的方天画戟沉重如山，戟尖反射着冬日惨淡的阳光。他望着脚下被董卓铁蹄践踏的土地，百姓的哀嚎与士族的谄媚交织成一曲令人作呕的乐章。前世的记忆如潮水般涌来：丁原的头颅，王允的连环计，虎牢关下'
2025-09-26 01:14:26 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=1040 预览='{\n  "text": "寒风呼啸，卷起长安城中弥漫的血腥与奢靡。吕布，字奉先，立于未央宫高耸的城楼之上，赤兔马的嘶鸣仿佛仍在耳畔，手中的方天画戟沉重如山，戟尖反射着冬日惨淡的阳光。他望着脚下被董卓铁蹄践踏的土地，百姓的哀嚎与士族的谄媚交织成一曲令人作呕的乐章。前世的记忆如潮水般涌来：丁原的头颅，王允的连环计，虎牢关下'
2025-09-26 01:14:26 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=1040 预览='{\n  "text": "寒风呼啸，卷起长安城中弥漫的血腥与奢靡。吕布，字奉先，立于未央宫高耸的城楼之上，赤兔马的嘶鸣仿佛仍在耳畔，手中的方天画戟沉重如山，戟尖反射着冬日惨淡的阳光。他望着脚下被董卓铁蹄践踏的土地，百姓的哀嚎与士族的谄媚交织成一曲令人作呕的乐章。前世的记忆如潮水般涌来：丁原的头颅，王允的连环计，虎牢关下的三英战吕布，以及最终白门楼上的绝望与悔恨。如今，他重回这乱世，却发现自己身处董'
2025-09-26 01:14:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 407
2025-09-26 01:14:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:14:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:14:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:14:26 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-26 01:14:26 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 01:14:26 | INFO     | api.story:_background_pregen_first_story:73 - [pregen] 第一节故事预生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=吕布...
2025-09-26 01:14:42 | INFO     | api.story:start_new_story:243 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 吕布
2025-09-26 01:14:42 | INFO     | api.story:start_new_story:264 - [pregen] 命中缓存，第一节故事秒出: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 01:14:42 | INFO     | api.story:start_new_story:299 - 新故事生成成功
2025-09-26 01:14:42 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=186 depth=3
2025-09-26 01:14:42 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=186
2025-09-26 01:14:42 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 隐忍待发，暗中布局
2025-09-26 01:14:42 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 联络外援，共谋董卓
2025-09-26 01:14:42 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 趁乱而起，自立门户
2025-09-26 01:15:03 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3036
2025-09-26 01:15:03 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=698 预览='{"text":"吕布的目光从城楼远眺，长安城外，黄土漫漫，仿佛隔绝了所有希望。联络外援的念头一旦生根，便如野草般疯长。他深知，董卓的爪牙遍布，任何异动都可能引来杀身之祸。谁能信任？袁绍？曹操？那些远在关东的诸侯，此刻是敌是友尚难定论，更遑论如何传递消息。他必须寻找一个可靠的信使，一个能穿透董卓密不透风的监视网，将自己的意图安全送达的人。他想起曾有一位旧部，名为张辽，忠勇机敏，如今仍在并州，但距离太远。眼前，他必须在长安城内寻找突破口，或许是某个被董卓压迫的士族，亦或是某个心怀异志的将领。","success_rate":68,"choices":[{"option":"秘密接触城中士族","'
2025-09-26 01:15:03 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=698 预览='{"text":"吕布的目光从城楼远眺，长安城外，黄土漫漫，仿佛隔绝了所有希望。联络外援的念头一旦生根，便如野草般疯长。他深知，董卓的爪牙遍布，任何异动都可能引来杀身之祸。谁能信任？袁绍？曹操？那些远在关东的诸侯，此刻是敌是友尚难定论，更遑论如何传递消息。他必须寻找一个可靠的信使，一个能穿透董卓密不透风的监视网，将自己'
2025-09-26 01:15:03 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=698 预览='{"text":"吕布的目光从城楼远眺，长安城外，黄土漫漫，仿佛隔绝了所有希望。联络外援的念头一旦生根，便如野草般疯长。他深知，董卓的爪牙遍布，任何异动都可能引来杀身之祸。谁能信任？袁绍？曹操？那些远在关东的诸侯，此刻是敌是友尚难定论，更遑论如何传递消息。他必须寻找一个可靠的信使，一个能穿透董卓密不透风的监视网，将自己'
2025-09-26 01:15:03 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=698 预览='{"text":"吕布的目光从城楼远眺，长安城外，黄土漫漫，仿佛隔绝了所有希望。联络外援的念头一旦生根，便如野草般疯长。他深知，董卓的爪牙遍布，任何异动都可能引来杀身之祸。谁能信任？袁绍？曹操？那些远在关东的诸侯，此刻是敌是友尚难定论，更遑论如何传递消息。他必须寻找一个可靠的信使，一个能穿透董卓密不透风的监视网，将自己的意图安全送达的人。他想起曾有一位旧部，名为张辽，忠勇机敏，如今仍在并州，但距离'
2025-09-26 01:15:03 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 238
2025-09-26 01:15:03 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:15:03 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:15:03 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:15:03 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:15:03 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=187 parent=186 choice='联络外援，共谋董卓'
2025-09-26 01:15:03 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=187 depth=2
2025-09-26 01:15:03 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=187 completed, triggered next level depth=2
2025-09-26 01:15:03 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=187
2025-09-26 01:15:03 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 秘密接触城中士族
2025-09-26 01:15:03 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派可靠旧部出城送信
2025-09-26 01:15:03 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 策反董卓麾下将领
2025-09-26 01:15:05 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3006
2025-09-26 01:15:05 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=698 预览='{"text":"吕布选择了隐忍待发，暗中布局。他开始更细致地观察董卓的朝堂，将目光投向那些表面顺从、实则心怀怨怼的汉室大臣。他巧妙地周旋于各方势力之间，假意逢迎，实则搜罗着一切可利用的破绽。他发现，董卓虽凶残，却也并非滴水不漏。其义子李傕、郭汜等人虽忠心，却也贪婪跋扈，与朝中大臣矛盾日益尖锐。更重要的是，吕布注意到司徒王允，这位老臣眼中时常闪过一丝不易察觉的寒光。他心知，这长安城中，并非只有他一人怀揣着反董卓之心。他需要一个切入点，一个能撬动这腐朽帝国的支点，方能扭转乾坤。","success_rate":78,"choices":[{"option":"秘密接触司徒王允","summary'
2025-09-26 01:15:05 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=698 预览='{"text":"吕布选择了隐忍待发，暗中布局。他开始更细致地观察董卓的朝堂，将目光投向那些表面顺从、实则心怀怨怼的汉室大臣。他巧妙地周旋于各方势力之间，假意逢迎，实则搜罗着一切可利用的破绽。他发现，董卓虽凶残，却也并非滴水不漏。其义子李傕、郭汜等人虽忠心，却也贪婪跋扈，与朝中大臣矛盾日益尖锐。更重要的是，吕布注意到司'
2025-09-26 01:15:05 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=698 预览='{"text":"吕布选择了隐忍待发，暗中布局。他开始更细致地观察董卓的朝堂，将目光投向那些表面顺从、实则心怀怨怼的汉室大臣。他巧妙地周旋于各方势力之间，假意逢迎，实则搜罗着一切可利用的破绽。他发现，董卓虽凶残，却也并非滴水不漏。其义子李傕、郭汜等人虽忠心，却也贪婪跋扈，与朝中大臣矛盾日益尖锐。更重要的是，吕布注意到司'
2025-09-26 01:15:05 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=698 预览='{"text":"吕布选择了隐忍待发，暗中布局。他开始更细致地观察董卓的朝堂，将目光投向那些表面顺从、实则心怀怨怼的汉室大臣。他巧妙地周旋于各方势力之间，假意逢迎，实则搜罗着一切可利用的破绽。他发现，董卓虽凶残，却也并非滴水不漏。其义子李傕、郭汜等人虽忠心，却也贪婪跋扈，与朝中大臣矛盾日益尖锐。更重要的是，吕布注意到司徒王允，这位老臣眼中时常闪过一丝不易察觉的寒光。他心知，这长安城中，并非只有他一'
2025-09-26 01:15:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 231
2025-09-26 01:15:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:15:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:15:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:15:05 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:15:05 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=188 parent=186 choice='隐忍待发，暗中布局'
2025-09-26 01:15:05 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=188 depth=2
2025-09-26 01:15:05 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=188 completed, triggered next level depth=2
2025-09-26 01:15:05 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=188
2025-09-26 01:15:05 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 秘密接触司徒王允
2025-09-26 01:15:05 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 暗中结交西凉将领
2025-09-26 01:15:05 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 专注于自身实力提升
2025-09-26 01:15:07 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3426
2025-09-26 01:15:07 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=853 预览='{"text":"吕布的目光骤然锐利，他不再迟疑，心中已然有了决断。趁乱而起，自立门户！这念头一旦生根，便如野火般燎原。他深知董卓残暴，其行径已激起朝野内外无数怨恨，这正是他可趁之“乱”。然而，董卓麾下西凉铁骑精锐，羽翼丰满，想要夺权，绝非易事。他需要一个契机，一个能让董卓众叛亲离，或者至少能让他吕布师出有名的契机。\\n\\n他开始暗中观察董卓军中将领，寻找那些对董卓心怀不满，却又慑于其淫威而不敢发声之人。同时，他也开始秘密接触城中与董卓有隙的士族，试图编织一张看不见的网。然而，董卓的义子身份，既是他的优势，也是他最大的桎梏。一旦反叛，他将背负弑父之名，天下人如何看待？而更紧迫的是，董卓近日似乎'
2025-09-26 01:15:07 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=853 预览='{"text":"吕布的目光骤然锐利，他不再迟疑，心中已然有了决断。趁乱而起，自立门户！这念头一旦生根，便如野火般燎原。他深知董卓残暴，其行径已激起朝野内外无数怨恨，这正是他可趁之“乱”。然而，董卓麾下西凉铁骑精锐，羽翼丰满，想要夺权，绝非易事。他需要一个契机，一个能让董卓众叛亲离，或者至少能让他吕布师出有名的契机。\\'
2025-09-26 01:15:07 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=853 预览='{"text":"吕布的目光骤然锐利，他不再迟疑，心中已然有了决断。趁乱而起，自立门户！这念头一旦生根，便如野火般燎原。他深知董卓残暴，其行径已激起朝野内外无数怨恨，这正是他可趁之“乱”。然而，董卓麾下西凉铁骑精锐，羽翼丰满，想要夺权，绝非易事。他需要一个契机，一个能让董卓众叛亲离，或者至少能让他吕布师出有名的契机。\\'
2025-09-26 01:15:07 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=853 预览='{"text":"吕布的目光骤然锐利，他不再迟疑，心中已然有了决断。趁乱而起，自立门户！这念头一旦生根，便如野火般燎原。他深知董卓残暴，其行径已激起朝野内外无数怨恨，这正是他可趁之“乱”。然而，董卓麾下西凉铁骑精锐，羽翼丰满，想要夺权，绝非易事。他需要一个契机，一个能让董卓众叛亲离，或者至少能让他吕布师出有名的契机。\\n\\n他开始暗中观察董卓军中将领，寻找那些对董卓心怀不满，却又慑于其淫威而不敢发'
2025-09-26 01:15:07 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 351
2025-09-26 01:15:07 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:15:07 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:15:07 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:15:07 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:15:07 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=189 parent=186 choice='趁乱而起，自立门户'
2025-09-26 01:15:07 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=189 depth=2
2025-09-26 01:15:07 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=189 completed, triggered next level depth=2
2025-09-26 01:15:07 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=189
2025-09-26 01:15:07 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 联合王允，设计诛杀董卓
2025-09-26 01:15:07 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 秘密联络军中旧部，策反部分西凉军
2025-09-26 01:15:07 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 派人出城，联络关东诸侯，内外夹击
2025-09-26 01:15:26 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 隐忍待发，暗中布局
2025-09-26 01:15:30 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3831
2025-09-26 01:15:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=775 预览='{"text":"吕布在夜色的掩护下，秘密潜入了司徒王允的府邸。老臣王允，面容清癯，眼中却透着一股不屈的锐利。当吕布表明来意，道出对董卓的深恶痛绝与匡扶汉室的决心时，王允先是震惊，继而审视，最终眼中燃起了希望的火光。他缓缓起身，踱步至窗前，低声叹道：“奉先，老夫苦等之人，竟是你！”他将吕布引至密室，屏退左右，压低声音道出胸中酝酿已久的连环计。王允的计划，以他府中的歌姬貂蝉为引，离间董卓与吕布父子，借吕布之手诛除国贼。吕布闻言，心头巨震。这正是他前世经历的悲剧开端，如今却成了摆在他面前的“救汉”之策。他深知此计凶险万分，稍有不慎便将万劫不复，但若能成功，董卓必死，而他吕布，或许能真正摆脱宿命的枷'
2025-09-26 01:15:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=775 预览='{"text":"吕布在夜色的掩护下，秘密潜入了司徒王允的府邸。老臣王允，面容清癯，眼中却透着一股不屈的锐利。当吕布表明来意，道出对董卓的深恶痛绝与匡扶汉室的决心时，王允先是震惊，继而审视，最终眼中燃起了希望的火光。他缓缓起身，踱步至窗前，低声叹道：“奉先，老夫苦等之人，竟是你！”他将吕布引至密室，屏退左右，压低声音道'
2025-09-26 01:15:30 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=775 预览='{"text":"吕布在夜色的掩护下，秘密潜入了司徒王允的府邸。老臣王允，面容清癯，眼中却透着一股不屈的锐利。当吕布表明来意，道出对董卓的深恶痛绝与匡扶汉室的决心时，王允先是震惊，继而审视，最终眼中燃起了希望的火光。他缓缓起身，踱步至窗前，低声叹道：“奉先，老夫苦等之人，竟是你！”他将吕布引至密室，屏退左右，压低声音道'
2025-09-26 01:15:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=775 预览='{"text":"吕布在夜色的掩护下，秘密潜入了司徒王允的府邸。老臣王允，面容清癯，眼中却透着一股不屈的锐利。当吕布表明来意，道出对董卓的深恶痛绝与匡扶汉室的决心时，王允先是震惊，继而审视，最终眼中燃起了希望的火光。他缓缓起身，踱步至窗前，低声叹道：“奉先，老夫苦等之人，竟是你！”他将吕布引至密室，屏退左右，压低声音道出胸中酝酿已久的连环计。王允的计划，以他府中的歌姬貂蝉为引，离间董卓与吕布父子，'
2025-09-26 01:15:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 293
2025-09-26 01:15:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:15:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:15:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:15:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:15:30 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=190 parent=188 choice='秘密接触司徒王允'
2025-09-26 01:15:30 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=190 depth=1
2025-09-26 01:15:30 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=190 completed, triggered next level depth=1
2025-09-26 01:15:30 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=45 node=190
2025-09-26 01:15:31 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 4195
2025-09-26 01:15:31 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=845 预览='{\n  "text": "吕布的决心已定。他深知，要改变历史，必须先摆脱董卓的掌控。联络外援，是唯一的出路。然而，长安城如同一个巨大的囚笼，董卓的密探无孔不入，西凉军更是将城池围得水泄不通。贸然行动，只会引火烧身。他需要一个可靠的突破口。是那些被董卓压迫已久的士族？还是那些表面顺从，实则心怀异志的将领？吕布的目光如鹰隼般扫过宫城内外，脑海中盘算着每一个可能的人选和每一种传递消息的途径。时间紧迫，稍有不慎，便是万劫不复。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "暗中接触董卓麾下，寻找心怀不满的将领。",\n    '
2025-09-26 01:15:31 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=845 预览='{\n  "text": "吕布的决心已定。他深知，要改变历史，必须先摆脱董卓的掌控。联络外援，是唯一的出路。然而，长安城如同一个巨大的囚笼，董卓的密探无孔不入，西凉军更是将城池围得水泄不通。贸然行动，只会引火烧身。他需要一个可靠的突破口。是那些被董卓压迫已久的士族？还是那些表面顺从，实则心怀异志的将领？吕布的目光如鹰隼'
2025-09-26 01:15:31 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=845 预览='{\n  "text": "吕布的决心已定。他深知，要改变历史，必须先摆脱董卓的掌控。联络外援，是唯一的出路。然而，长安城如同一个巨大的囚笼，董卓的密探无孔不入，西凉军更是将城池围得水泄不通。贸然行动，只会引火烧身。他需要一个可靠的突破口。是那些被董卓压迫已久的士族？还是那些表面顺从，实则心怀异志的将领？吕布的目光如鹰隼'
2025-09-26 01:15:31 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=845 预览='{\n  "text": "吕布的决心已定。他深知，要改变历史，必须先摆脱董卓的掌控。联络外援，是唯一的出路。然而，长安城如同一个巨大的囚笼，董卓的密探无孔不入，西凉军更是将城池围得水泄不通。贸然行动，只会引火烧身。他需要一个可靠的突破口。是那些被董卓压迫已久的士族？还是那些表面顺从，实则心怀异志的将领？吕布的目光如鹰隼般扫过宫城内外，脑海中盘算着每一个可能的人选和每一种传递消息的途径。时间紧迫，稍'
2025-09-26 01:15:31 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-26 01:15:31 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:15:31 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:15:31 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:15:31 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:15:31 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=191 parent=187 choice='策反董卓麾下将领'
2025-09-26 01:15:31 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=191 depth=1
2025-09-26 01:15:31 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=191 completed, triggered next level depth=1
2025-09-26 01:15:56 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1981
2025-09-26 01:15:56 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:15:56 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:15:56 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:15:56 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:15:56 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:16:02 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3854
2025-09-26 01:16:02 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=724 预览='{"text":"吕布深知，要联络外援，长安城内首选便是司徒王允。这位汉室老臣，素来厌恶董卓暴行，心怀匡扶社稷之志。然而，王允府邸戒备森严，董卓的密探如影随形，直接接触无异于自投罗网。吕布利用巡城之便，暗中观察王允府邸的动向，并留意那些在董卓宴席上表现出不满，却又不敢言语的士族。他脑海中浮现出几个可能的人选：或是王允府中那位长袖善舞的歌姬，或是某个被董卓夺去家产的落魄士人，亦或是军中那些表面顺从实则心怀怨恨的将领。联络外援如同走钢丝，每一步都必须小心翼翼，否则自己将再次成为历史的尘埃。","success_rate":68,"choices":[{"option":"秘密接触王允府中的关键人物'
2025-09-26 01:16:02 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=724 预览='{"text":"吕布深知，要联络外援，长安城内首选便是司徒王允。这位汉室老臣，素来厌恶董卓暴行，心怀匡扶社稷之志。然而，王允府邸戒备森严，董卓的密探如影随形，直接接触无异于自投罗网。吕布利用巡城之便，暗中观察王允府邸的动向，并留意那些在董卓宴席上表现出不满，却又不敢言语的士族。他脑海中浮现出几个可能的人选：或是王允府'
2025-09-26 01:16:02 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=724 预览='{"text":"吕布深知，要联络外援，长安城内首选便是司徒王允。这位汉室老臣，素来厌恶董卓暴行，心怀匡扶社稷之志。然而，王允府邸戒备森严，董卓的密探如影随形，直接接触无异于自投罗网。吕布利用巡城之便，暗中观察王允府邸的动向，并留意那些在董卓宴席上表现出不满，却又不敢言语的士族。他脑海中浮现出几个可能的人选：或是王允府'
2025-09-26 01:16:02 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=724 预览='{"text":"吕布深知，要联络外援，长安城内首选便是司徒王允。这位汉室老臣，素来厌恶董卓暴行，心怀匡扶社稷之志。然而，王允府邸戒备森严，董卓的密探如影随形，直接接触无异于自投罗网。吕布利用巡城之便，暗中观察王允府邸的动向，并留意那些在董卓宴席上表现出不满，却又不敢言语的士族。他脑海中浮现出几个可能的人选：或是王允府中那位长袖善舞的歌姬，或是某个被董卓夺去家产的落魄士人，亦或是军中那些表面顺从实'
2025-09-26 01:16:02 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 236
2025-09-26 01:16:02 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:16:02 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:16:02 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:16:02 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:16:02 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=192 parent=187 choice='秘密接触城中士族'
2025-09-26 01:16:02 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=192 depth=1
2025-09-26 01:16:02 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=192 completed, triggered next level depth=1
2025-09-26 01:16:06 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 3145
2025-09-26 01:16:06 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=681 预览='{"text":"吕布暗中行动，利用昔日情谊与个人威望，秘密联络军中旧部。他深知西凉军忠诚难撼，但董卓的暴行已让不少士兵心生怨怼。他挑选那些眼神中带着疲惫与不满的士卒，低声耳语，描绘一个没有董卓压迫的未来。数日后，有几名校尉暗中回应，表示愿追随将军。然而，也有人面露惊恐，避之不及。更有一位平日与吕布交好的都尉，在一次私下谈话中，委婉地提醒他，董卓的眼线无处不在，尤其对吕布的动向更是格外关注。一股无形的压力笼罩着吕布，他必须加快步伐，否则恐有不测。","success_rate":68,"choices":[{"option":"趁董卓设宴之际，发动突袭将其刺杀","summary":"孤注一掷'
2025-09-26 01:16:06 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=681 预览='{"text":"吕布暗中行动，利用昔日情谊与个人威望，秘密联络军中旧部。他深知西凉军忠诚难撼，但董卓的暴行已让不少士兵心生怨怼。他挑选那些眼神中带着疲惫与不满的士卒，低声耳语，描绘一个没有董卓压迫的未来。数日后，有几名校尉暗中回应，表示愿追随将军。然而，也有人面露惊恐，避之不及。更有一位平日与吕布交好的都尉，在一次私'
2025-09-26 01:16:06 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=681 预览='{"text":"吕布暗中行动，利用昔日情谊与个人威望，秘密联络军中旧部。他深知西凉军忠诚难撼，但董卓的暴行已让不少士兵心生怨怼。他挑选那些眼神中带着疲惫与不满的士卒，低声耳语，描绘一个没有董卓压迫的未来。数日后，有几名校尉暗中回应，表示愿追随将军。然而，也有人面露惊恐，避之不及。更有一位平日与吕布交好的都尉，在一次私'
2025-09-26 01:16:06 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=681 预览='{"text":"吕布暗中行动，利用昔日情谊与个人威望，秘密联络军中旧部。他深知西凉军忠诚难撼，但董卓的暴行已让不少士兵心生怨怼。他挑选那些眼神中带着疲惫与不满的士卒，低声耳语，描绘一个没有董卓压迫的未来。数日后，有几名校尉暗中回应，表示愿追随将军。然而，也有人面露惊恐，避之不及。更有一位平日与吕布交好的都尉，在一次私下谈话中，委婉地提醒他，董卓的眼线无处不在，尤其对吕布的动向更是格外关注。一股无'
2025-09-26 01:16:06 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 216
2025-09-26 01:16:06 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:16:06 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:16:06 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:16:06 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:16:06 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=193 parent=189 choice='秘密联络军中旧部，策反部分西凉军'
2025-09-26 01:16:06 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=45 node=193 depth=1
2025-09-26 01:16:06 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=193 completed, triggered next level depth=1
2025-09-26 01:16:18 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:16:18 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:18 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:18 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:16:18 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:18 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=189 choice='派人出城，联络关东诸侯，内外夹击': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:16:34 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1821
2025-09-26 01:16:34 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:34 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:16:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:34 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:16:36 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1813
2025-09-26 01:16:36 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:36 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:36 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:16:36 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:36 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:16:37 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1814
2025-09-26 01:16:37 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:37 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:37 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:16:37 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:37 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:16:38 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 1978
2025-09-26 01:16:38 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:38 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:38 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:16:38 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:16:38 | WARNING  | core.story_engine:_parse_llm_response:140 - [JSON] 首次提取得到的内容为空或非JSON对象，尝试回退修复
2025-09-26 01:17:03 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:17:03 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:03 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:03 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:17:03 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:03 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=188 choice='专注于自身实力提升': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:17:03 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:17:03 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:03 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:03 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:17:03 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:03 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=188 choice='暗中结交西凉将领': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:17:04 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:17:04 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:04 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:17:04 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:04 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=189 choice='联合王允，设计诛杀董卓': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:17:15 | INFO     | core.llm_clients:generate:205 - 模型生成成功 - 模型: [自营]gemini-2.5-flash-preview-05-20, tokens使用: 393
2025-09-26 01:17:15 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:15 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=24 预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:15 | WARNING  | core.story_engine:_extract_json:50 - [JSON] 未发现 '{' 起始符，可能非JSON输出
2025-09-26 01:17:15 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting value: line 1 column 1 (char 0); 原始预览='所有API密钥均请求失败\n具体错误请查看轮询日志'
2025-09-26 01:17:15 | WARNING  | core.speculation:_generate_child_node:229 - [Speculation] generation failed for parent=187 choice='派可靠旧部出城送信': Expecting value: line 1 column 1 (char 0)
2025-09-26 01:20:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:20:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:21:00 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-wS5OgHlkuSl7DzRQ1UbuWp6acm2vmKxEp5uceO8oGP4ChdtC', 'base_url': 'https://new.wuxuai.com/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:21:00 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:21:00 | INFO     | core.llm_clients:__init__:88 - 模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 01:21:00 | INFO     | core.llm_clients:__init__:89 - API地址: https://new.wuxuai.com/v1
2025-09-26 01:21:00 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:21:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:21:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:21:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:21:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:21:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:21:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:21:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:21:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:21:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:21:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: [自营]gemini-2.5-flash-preview-05-20
2025-09-26 01:21:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://new.wuxuai.com/v1
2025-09-26 01:29:01 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:29:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:29:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:29:16 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:29:16 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:29:16 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:29:16 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:29:16 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:29:16 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:29:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:29:16 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:29:16 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:29:16 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:29:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:29:17 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:29:17 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:29:17 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:29:17 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:29:17 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:30:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:30:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:30:55 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:30:56 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:30:56 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:30:56 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:30:56 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:30:56 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:30:56 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:30:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:30:56 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:30:56 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:30:56 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:30:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:30:57 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:30:57 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:30:57 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:30:57 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:30:57 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:31:15 | INFO     | api.story:prepare_start_level:152 - 开始生成故事概要，愿望：刘备...
2025-09-26 01:31:17 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Completions.create() got an unexpected keyword argument 'enable_thinking'
2025-09-26 01:36:34 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:36:35 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:36:36 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:36:36 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:36:36 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:36:36 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:36:36 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:36:36 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:36:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:36:37 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:36:37 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:36:37 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:36:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:36:38 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:36:38 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:36:38 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:36:38 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:36:38 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:37:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:37:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:37:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:37:08 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:37:08 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:37:08 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:37:08 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:37:08 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:37:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:37:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:37:08 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:37:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:37:08 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:37:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:37:09 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:37:09 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:37:09 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:37:09 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:37:09 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:37:16 | INFO     | api.story:prepare_start_level:152 - 开始生成故事概要，愿望：刘备...
2025-09-26 01:37:16 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:37:28 | INFO     | core.llm_clients:generate:208 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1140
2025-09-26 01:37:28 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-26 01:37:28 | INFO     | api.story:prepare_start_level:206 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=刘备...
2025-09-26 01:37:28 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:37:29 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:37:29 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:37:30 | ERROR    | api.story:_background_pregen_first_story:75 - [pregen] 第一节故事预生成失败 user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 wish=刘备...: Error code: 400 - {'code': 20015, 'message': 'Value error, current model does not support parameter `enable_thinking`.', 'data': None}
2025-09-26 01:38:01 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:38:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:38:03 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:38:03 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:38:03 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:38:03 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:38:03 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:38:03 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:38:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:38:04 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:38:04 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:38:04 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:38:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:38:04 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:38:04 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:38:04 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:38:04 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:38:04 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:39:05 | INFO     | api.story:prepare_start_level:152 - 开始生成故事概要，愿望：项羽...
2025-09-26 01:39:05 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:39:11 | INFO     | core.llm_clients:generate:208 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 958
2025-09-26 01:39:11 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 01:39:11 | INFO     | api.story:prepare_start_level:206 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=项羽...
2025-09-26 01:39:11 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:39:26 | INFO     | core.llm_clients:generate:208 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1843
2025-09-26 01:39:26 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=581 预览='\n\n{"text":"残阳如血，巨鹿战场的焦土上蒸腾着铁锈味。项羽解下染血的披风，青铜铠甲在暮色中泛着冷光。远处尸山间偶尔传来垂死战马的哀鸣，八千江东子弟的旌旗在风中猎猎作响。中军帐内，范增捧着青铜酒爵疾步而来：\'大王，刘邦已破关中，遣使言愿称臣献地。\'项羽凝视案上未干的《西楚律》初稿，指尖划过竹简上\'分封\'二字。帐外忽有急报：汉军精骑昨夜突袭楚使车队，三十七名将士殒命褒斜道。","success_rate":72,"choices":[{"option":"召开诸侯会议，重申分封制度","summary":"联合齐赵韩魏君主，以楚盟主之威震慑刘邦","success_rate_delta":'
2025-09-26 01:39:26 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=579 预览='{"text":"残阳如血，巨鹿战场的焦土上蒸腾着铁锈味。项羽解下染血的披风，青铜铠甲在暮色中泛着冷光。远处尸山间偶尔传来垂死战马的哀鸣，八千江东子弟的旌旗在风中猎猎作响。中军帐内，范增捧着青铜酒爵疾步而来：\'大王，刘邦已破关中，遣使言愿称臣献地。\'项羽凝视案上未干的《西楚律》初稿，指尖划过竹简上\'分封\'二字。帐外忽有'
2025-09-26 01:39:26 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=579 预览='{"text":"残阳如血，巨鹿战场的焦土上蒸腾着铁锈味。项羽解下染血的披风，青铜铠甲在暮色中泛着冷光。远处尸山间偶尔传来垂死战马的哀鸣，八千江东子弟的旌旗在风中猎猎作响。中军帐内，范增捧着青铜酒爵疾步而来：\'大王，刘邦已破关中，遣使言愿称臣献地。\'项羽凝视案上未干的《西楚律》初稿，指尖划过竹简上\'分封\'二字。帐外忽有'
2025-09-26 01:39:26 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=579 预览='{"text":"残阳如血，巨鹿战场的焦土上蒸腾着铁锈味。项羽解下染血的披风，青铜铠甲在暮色中泛着冷光。远处尸山间偶尔传来垂死战马的哀鸣，八千江东子弟的旌旗在风中猎猎作响。中军帐内，范增捧着青铜酒爵疾步而来：\'大王，刘邦已破关中，遣使言愿称臣献地。\'项羽凝视案上未干的《西楚律》初稿，指尖划过竹简上\'分封\'二字。帐外忽有急报：汉军精骑昨夜突袭楚使车队，三十七名将士殒命褒斜道。","success_r'
2025-09-26 01:39:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 179
2025-09-26 01:39:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:39:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:39:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:39:26 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/fantasy_castle.jpg
2025-09-26 01:39:26 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 01:39:26 | INFO     | api.story:_background_pregen_first_story:73 - [pregen] 第一节故事预生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=项羽...
2025-09-26 01:39:41 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:39:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:39:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:39:47 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:39:47 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:39:47 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:39:47 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:39:47 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:39:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:39:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:39:47 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:39:47 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:39:47 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:39:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:39:47 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:39:47 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:39:47 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:39:47 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:39:47 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:40:03 | INFO     | api.story:prepare_start_level:152 - 开始生成故事概要，愿望：刘备...
2025-09-26 01:40:03 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:40:10 | INFO     | core.llm_clients:generate:208 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 922
2025-09-26 01:40:10 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-26 01:40:10 | INFO     | api.story:prepare_start_level:206 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=刘备...
2025-09-26 01:40:10 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:40:22 | INFO     | core.llm_clients:generate:208 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1549
2025-09-26 01:40:22 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=553 预览='\n\n{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥，黄巾余孽就在三十里外...\'","success_rate":68,"choices":[{"option":"召集流民组建义军","summary":"以仁义之名收编饥民，与黄巾军争夺民心","success_rate_delta":15,"risk_level":"me'
2025-09-26 01:40:22 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=551 预览='{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥'
2025-09-26 01:40:22 | DEBUG    | core.story_engine:_extract_json:82 - [JSON] 未找到完整闭合，返回起始到末尾片段，长度=551 预览='{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥'
2025-09-26 01:40:22 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=551 预览='{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥，黄巾余孽就在三十里外...\'","success_rate":68,"choi'
2025-09-26 01:40:22 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting ',' delimiter: line 1 column 552 (char 551); json_str预览='{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥，黄巾余孽就在三十里外...\'","success_rate":68,"choi'
2025-09-26 01:40:22 | WARNING  | core.llm_clients:generate:195 - 代理可能不支持 response_format，正在移除该参数后重试（同一次尝试内）…
2025-09-26 01:40:42 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:40:45 | INFO     | core.llm_clients:generate:208 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1417
2025-09-26 01:40:45 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=552 预览='\n\n{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥，黄巾余孽就在三十里外...\',\'success_rate":68,"cho'
2025-09-26 01:40:45 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=550 预览='{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥'
2025-09-26 01:40:45 | DEBUG    | core.story_engine:_extract_json:82 - [JSON] 未找到完整闭合，返回起始到末尾片段，长度=550 预览='{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥'
2025-09-26 01:40:45 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting ',' delimiter: line 1 column 191 (char 190); 原始预览='\n\n{"text":"建安元年冬，涿郡城外风雪呼啸。你裹紧单薄的布袍，望着城门处逃难的百姓。昔日织席贩履的商贩如今腰悬断剑，身后跟着关羽、张飞二人，他们眼中的炽热与迷茫交织。城内新野流民暴动，太守害怕引发更大动荡，欲将三千饥民驱逐城外。你攥紧《春秋》残卷，远处传来叛军与官军交战的喊杀声，而关羽已按住青龙偃月刀低声道：\'大哥，黄巾余孽就在三十里外...\'","success_rate":68,"ch'
2025-09-26 01:40:45 | ERROR    | api.story:_background_pregen_first_story:75 - [pregen] 第一节故事预生成失败 user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 wish=刘备...: Expecting ',' delimiter: line 1 column 191 (char 190)
2025-09-26 01:40:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:40:47 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:40:47 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:40:47 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:40:47 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:40:47 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:40:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:40:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:40:47 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:40:47 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:40:47 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:40:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:40:48 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:40:48 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:40:48 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:40:48 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:40:48 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:41:09 | INFO     | api.story:start_new_story:243 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 刘备
2025-09-26 01:41:09 | INFO     | api.story:start_new_story:266 - [pregen] 未命中缓存，现场生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 01:41:09 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-26 01:41:25 | INFO     | core.llm_clients:generate:209 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1846
2025-09-26 01:41:25 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=556 预览='\n\n{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失崛起良机。暮色中，一封来自曹操的密信正躺在驿馆案头，火漆上印着‘白马之盟’的暗记。","success_rate":75,"choices":[{"option":"收编黄巾军","summary":"整合流民武装，建立独立军力","success_rate_delta":1'
2025-09-26 01:41:25 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=554 预览='{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失'
2025-09-26 01:41:25 | DEBUG    | core.story_engine:_extract_json:82 - [JSON] 未找到完整闭合，返回起始到末尾片段，长度=554 预览='{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失'
2025-09-26 01:41:25 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=554 预览='{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失崛起良机。暮色中，一封来自曹操的密信正躺在驿馆案头，火漆上印着‘白马之盟’的暗记'
2025-09-26 01:41:25 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting ',' delimiter: line 1 column 555 (char 554); json_str预览='{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失崛起良机。暮色中，一封来自曹操的密信正躺在驿馆案头，火漆上印着‘白马之盟’的暗记'
2025-09-26 01:41:54 | INFO     | core.llm_clients:generate:209 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1481
2025-09-26 01:41:54 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=556 预览='\n\n{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失崛起良机。暮色中，一封来自曹操的密信正躺在驿馆案头，火漆上印着‘白马之盟’的'
2025-09-26 01:41:54 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=554 预览='{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失'
2025-09-26 01:41:54 | DEBUG    | core.story_engine:_extract_json:82 - [JSON] 未找到完整闭合，返回起始到末尾片段，长度=554 预览='{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失'
2025-09-26 01:41:54 | ERROR    | core.story_engine:_attempt_json_fix:214 - [JSON-FIX] 修复失败: Expecting ',' delimiter: line 1 column 555 (char 554); 原始预览='\n\n{"text":"建安元年冬，涿郡城外的桃园覆雪如银，刘备手扶青釭剑立于寒风中。远处传来流民冻馁的哭号，城墙上‘讨伐董卓’的残旗在风中撕裂。他望着关羽新赠的赤兔马与张飞新铸的丈八蛇矛，衣襟间还藏着袁绍使者密送的兵符。此刻恰逢青州黄巾余部蠢蠢欲动，若选择收编可得五千乌合之众，但需冒与朝廷决裂的风险；若按兵不动，则可能错失崛起良机。暮色中，一封来自曹操的密信正躺在驿馆案头，火漆上印着‘白马之盟’的'
2025-09-26 01:41:54 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: Expecting ',' delimiter: line 1 column 555 (char 554)
2025-09-26 01:43:13 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:43:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:43:15 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:43:15 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:43:15 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:43:15 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:43:15 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:43:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:43:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:43:15 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:43:15 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:43:15 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:43:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:43:16 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:43:16 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:43:16 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:43:16 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:43:16 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:43:31 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:43:32 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:43:33 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:43:33 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:43:33 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:43:33 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:43:33 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:43:33 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:43:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:43:33 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:43:33 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:43:33 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:43:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:43:34 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:43:34 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:43:34 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:43:34 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:43:34 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:43:59 | INFO     | api.story:start_new_story:243 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 刘备
2025-09-26 01:43:59 | INFO     | api.story:start_new_story:266 - [pregen] 未命中缓存，现场生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 01:43:59 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-26 01:44:22 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1962
2025-09-26 01:44:22 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=734 预览='\n\n{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。",\n  "success_rate": 45,\n  "choices": [\n    {\n      "option": "率残部死守城西粮仓",\n      "summary": "以仁义凝聚民心，但粮仓易守难攻的地理优势可能被曹操火攻破解",\n      "succes'
2025-09-26 01:44:22 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=732 预览='{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。'
2025-09-26 01:44:22 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=732 预览='{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。'
2025-09-26 01:44:22 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=732 预览='{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。",\n  "success_rate": 45,\n  "choices": [\n'
2025-09-26 01:44:22 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting value: line 15 column 29 (char 490); json_str预览='{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。",\n  "success_rate": 45,\n  "choices": [\n'
2025-09-26 01:44:48 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1789
2025-09-26 01:44:48 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=733 预览='\n\n{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。",\n  "success_rate": 45,\n  "choices": '
2025-09-26 01:44:48 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=731 预览='{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。'
2025-09-26 01:44:48 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=731 预览='{\n  "text": "建安五年冬夜，徐州城外的芦苇荡在朔风中翻涌如血。你裹着破旧大氅，掌心攥着父亲临终所赠的玉珪，身后仅剩三百残兵。追兵的火把已在五里外连成赤链，而前方官道岔口处，徐州百姓举着火把哭喊着\'刘使君救我\'。你突然意识到这是重生后的第七日——此刻若不做出抉择，明日徐州便会重蹈历史覆辙，被曹操铁骑踏为焦土。'
2025-09-26 01:44:48 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 147
2025-09-26 01:44:48 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:44:48 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:44:48 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:44:48 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/cyberpunk_city.jpg
2025-09-26 01:44:48 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 01:44:48 | INFO     | api.story:start_new_story:299 - 新故事生成成功
2025-09-26 01:44:48 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=46 node=194 depth=3
2025-09-26 01:44:48 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=194
2025-09-26 01:44:48 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率残部死守城西粮仓
2025-09-26 01:44:48 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 佯装撤退诱敌深入沼泽
2025-09-26 01:44:48 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 带领百姓突围投奔东海贼
2025-09-26 01:45:04 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1960
2025-09-26 01:45:04 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=693 预览='\n\n```json\n{\n  "text": "芦苇荡深处传来战马陷蹄的闷响，你望着深及腰际的泥潭中挣扎的曹军铁骑，手中玉珪映出百姓们举着火把围拢的剪影。忽然东南方林木暴动，一队玄甲骑兵竟绕过沼泽直扑徐州城门——原来夏侯惇早已分兵包抄。三百残兵中响起此起彼伏的咳嗽声，有人摸向腰间空荡荡的箭囊。",\n  "success_rate": 55,\n  "choices": [\n    {\n      "option": "强攻沼泽出口",\n      "summary": "率精锐突破曹军包围，赌上最后的骑兵兵力",\n      "success_rate_delta": -15,\n      "ri'
2025-09-26 01:45:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=691 预览='```json\n{\n  "text": "芦苇荡深处传来战马陷蹄的闷响，你望着深及腰际的泥潭中挣扎的曹军铁骑，手中玉珪映出百姓们举着火把围拢的剪影。忽然东南方林木暴动，一队玄甲骑兵竟绕过沼泽直扑徐州城门——原来夏侯惇早已分兵包抄。三百残兵中响起此起彼伏的咳嗽声，有人摸向腰间空荡荡的箭囊。",\n  "success_ra'
2025-09-26 01:45:04 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=679 预览='{\n  "text": "芦苇荡深处传来战马陷蹄的闷响，你望着深及腰际的泥潭中挣扎的曹军铁骑，手中玉珪映出百姓们举着火把围拢的剪影。忽然东南方林木暴动，一队玄甲骑兵竟绕过沼泽直扑徐州城门——原来夏侯惇早已分兵包抄。三百残兵中响起此起彼伏的咳嗽声，有人摸向腰间空荡荡的箭囊。",\n  "success_rate": 55,'
2025-09-26 01:45:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=679 预览='{\n  "text": "芦苇荡深处传来战马陷蹄的闷响，你望着深及腰际的泥潭中挣扎的曹军铁骑，手中玉珪映出百姓们举着火把围拢的剪影。忽然东南方林木暴动，一队玄甲骑兵竟绕过沼泽直扑徐州城门——原来夏侯惇早已分兵包抄。三百残兵中响起此起彼伏的咳嗽声，有人摸向腰间空荡荡的箭囊。",\n  "success_rate": 55,\n  "choices": [\n    {\n      "option": "强'
2025-09-26 01:45:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 123
2025-09-26 01:45:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:45:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:45:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:45:04 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:45:04 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=195 parent=194 choice='佯装撤退诱敌深入沼泽'
2025-09-26 01:45:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=46 node=195 depth=2
2025-09-26 01:45:04 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=195 completed, triggered next level depth=2
2025-09-26 01:45:04 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=195
2025-09-26 01:45:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 强攻沼泽出口
2025-09-26 01:45:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与山贼暂结盟约
2025-09-26 01:45:04 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 组织百姓为军
2025-09-26 01:45:20 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2070
2025-09-26 01:45:20 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=718 预览='\n\n```json\n{\n  "text": "泥沼深处传来曹军铁骑的哀嚎，你勒马回望，三百残兵正将最后三十支箭矢分发给新编入伍的百姓。东南方尘烟骤起，一队打着\'袁\'字旗号的骑兵竟与夏侯惇残部会合，袁术的私兵竟已渗透至徐州郊野。忽然，你腰间玉珪发出异响——那本该是父亲陪葬的信物，此刻竟映出半幅模糊的藏宝图纹路，指向城西三十里废弃的陶谦旧宅。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "夜袭袁军粮仓",\n      "summary": "利用沼泽地形突袭，可能获得补给但暴露行踪",\n      "success_ra'
2025-09-26 01:45:20 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=716 预览='```json\n{\n  "text": "泥沼深处传来曹军铁骑的哀嚎，你勒马回望，三百残兵正将最后三十支箭矢分发给新编入伍的百姓。东南方尘烟骤起，一队打着\'袁\'字旗号的骑兵竟与夏侯惇残部会合，袁术的私兵竟已渗透至徐州郊野。忽然，你腰间玉珪发出异响——那本该是父亲陪葬的信物，此刻竟映出半幅模糊的藏宝图纹路，指向城西三十里'
2025-09-26 01:45:20 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=704 预览='{\n  "text": "泥沼深处传来曹军铁骑的哀嚎，你勒马回望，三百残兵正将最后三十支箭矢分发给新编入伍的百姓。东南方尘烟骤起，一队打着\'袁\'字旗号的骑兵竟与夏侯惇残部会合，袁术的私兵竟已渗透至徐州郊野。忽然，你腰间玉珪发出异响——那本该是父亲陪葬的信物，此刻竟映出半幅模糊的藏宝图纹路，指向城西三十里废弃的陶谦旧宅。'
2025-09-26 01:45:20 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=704 预览='{\n  "text": "泥沼深处传来曹军铁骑的哀嚎，你勒马回望，三百残兵正将最后三十支箭矢分发给新编入伍的百姓。东南方尘烟骤起，一队打着\'袁\'字旗号的骑兵竟与夏侯惇残部会合，袁术的私兵竟已渗透至徐州郊野。忽然，你腰间玉珪发出异响——那本该是父亲陪葬的信物，此刻竟映出半幅模糊的藏宝图纹路，指向城西三十里废弃的陶谦旧宅。",\n  "success_rate": 68,\n  "choices": [\n'
2025-09-26 01:45:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 147
2025-09-26 01:45:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:45:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:45:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:45:20 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:45:20 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=196 parent=195 choice='组织百姓为军'
2025-09-26 01:45:20 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=46 node=196 depth=1
2025-09-26 01:45:20 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=196 completed, triggered next level depth=1
2025-09-26 01:45:23 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2461
2025-09-26 01:45:23 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=753 预览='\n\n```json\n{\n  "text": "山贼大当家张燕的营火在断崖下燃起，他布满刀疤的脸在火光中忽明忽暗。\'刘使君要我三千儿郎断后，却拿不出粮草？\'铁碗砸在青石上，酒液溅湿你脚边的玉珪。三百残兵在芦苇丛中按剑而立，山贼们腰间的断矛却已抵住他们后心。东南方林木暴动的异响未歇，斥候突然飞马来报：\'夏侯惇主力已绕过沼泽，三日可达徐州城！\'你攥紧玉珪，父亲临终的嘱托与山贼刀锋间的抉择，此刻都化作喉头腥甜的血气。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "献出徐州城西粮仓",\n      "summary": "换取'
2025-09-26 01:45:23 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=751 预览='```json\n{\n  "text": "山贼大当家张燕的营火在断崖下燃起，他布满刀疤的脸在火光中忽明忽暗。\'刘使君要我三千儿郎断后，却拿不出粮草？\'铁碗砸在青石上，酒液溅湿你脚边的玉珪。三百残兵在芦苇丛中按剑而立，山贼们腰间的断矛却已抵住他们后心。东南方林木暴动的异响未歇，斥候突然飞马来报：\'夏侯惇主力已绕过沼泽，三'
2025-09-26 01:45:23 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=739 预览='{\n  "text": "山贼大当家张燕的营火在断崖下燃起，他布满刀疤的脸在火光中忽明忽暗。\'刘使君要我三千儿郎断后，却拿不出粮草？\'铁碗砸在青石上，酒液溅湿你脚边的玉珪。三百残兵在芦苇丛中按剑而立，山贼们腰间的断矛却已抵住他们后心。东南方林木暴动的异响未歇，斥候突然飞马来报：\'夏侯惇主力已绕过沼泽，三日可达徐州城！\''
2025-09-26 01:45:23 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=739 预览='{\n  "text": "山贼大当家张燕的营火在断崖下燃起，他布满刀疤的脸在火光中忽明忽暗。\'刘使君要我三千儿郎断后，却拿不出粮草？\'铁碗砸在青石上，酒液溅湿你脚边的玉珪。三百残兵在芦苇丛中按剑而立，山贼们腰间的断矛却已抵住他们后心。东南方林木暴动的异响未歇，斥候突然飞马来报：\'夏侯惇主力已绕过沼泽，三日可达徐州城！\'你攥紧玉珪，父亲临终的嘱托与山贼刀锋间的抉择，此刻都化作喉头腥甜的血气。",\n '
2025-09-26 01:45:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 01:45:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:45:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:45:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:45:23 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:45:23 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=197 parent=195 choice='与山贼暂结盟约'
2025-09-26 01:45:23 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=46 node=197 depth=1
2025-09-26 01:45:23 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=197 completed, triggered next level depth=1
2025-09-26 01:45:32 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2278
2025-09-26 01:45:32 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=743 预览='\n\n```json\n{\n  "text": "泥潭中曹军铁骑的嘶吼渐弱，你挥动断矛指向东南方城门：\'关、张二弟，带百人佯攻城楼，引夏侯惇回援！\'残兵分作三路冲入芦苇荡时，忽见沼泽对岸有数十黑旗骑兵策马疾驰——竟是早已失散的徐州旧部！他们身后追来数百青州铁骑，马鬃上绑着的正是昨日失踪的徐州县令首级。\'刘使君！\'旧部主将拍马冲至你身侧，\'北岸三十里有座废弃的铁矿，地底暗河直通云梦泽......\'",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "强攻沼泽出口",\n      "summary": "趁青州骑兵未合围前突围，直'
2025-09-26 01:45:32 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=741 预览='```json\n{\n  "text": "泥潭中曹军铁骑的嘶吼渐弱，你挥动断矛指向东南方城门：\'关、张二弟，带百人佯攻城楼，引夏侯惇回援！\'残兵分作三路冲入芦苇荡时，忽见沼泽对岸有数十黑旗骑兵策马疾驰——竟是早已失散的徐州旧部！他们身后追来数百青州铁骑，马鬃上绑着的正是昨日失踪的徐州县令首级。\'刘使君！\'旧部主将拍马冲'
2025-09-26 01:45:32 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=729 预览='{\n  "text": "泥潭中曹军铁骑的嘶吼渐弱，你挥动断矛指向东南方城门：\'关、张二弟，带百人佯攻城楼，引夏侯惇回援！\'残兵分作三路冲入芦苇荡时，忽见沼泽对岸有数十黑旗骑兵策马疾驰——竟是早已失散的徐州旧部！他们身后追来数百青州铁骑，马鬃上绑着的正是昨日失踪的徐州县令首级。\'刘使君！\'旧部主将拍马冲至你身侧，\'北岸'
2025-09-26 01:45:32 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=729 预览='{\n  "text": "泥潭中曹军铁骑的嘶吼渐弱，你挥动断矛指向东南方城门：\'关、张二弟，带百人佯攻城楼，引夏侯惇回援！\'残兵分作三路冲入芦苇荡时，忽见沼泽对岸有数十黑旗骑兵策马疾驰——竟是早已失散的徐州旧部！他们身后追来数百青州铁骑，马鬃上绑着的正是昨日失踪的徐州县令首级。\'刘使君！\'旧部主将拍马冲至你身侧，\'北岸三十里有座废弃的铁矿，地底暗河直通云梦泽......\'",\n  "success'
2025-09-26 01:45:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 174
2025-09-26 01:45:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:45:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:45:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:45:32 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:45:32 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=198 parent=195 choice='强攻沼泽出口'
2025-09-26 01:45:32 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=46 node=198 depth=1
2025-09-26 01:45:32 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=198 completed, triggered next level depth=1
2025-09-26 01:46:00 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:46:36 | INFO     | core.llm_clients:generate:238 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2128
2025-09-26 01:46:36 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=770 预览='\n\n```json\n{\n  "text": "东海贼的营地在礁石嶙峋的海湾若隐若现，盐腥海风裹挟着腐木气息。你勒马立于潮线之上，三千流民在身后瑟缩成黑点。海盗头目周仓突然将长矛抵住你咽喉，身后喽啰们发出嗜血的哄笑——他们要的不是庇护费，而是用徐州百姓祭海神。远处海平线上，曹军楼船正破开晨雾逼近，桅杆上飘动的‘曹’字旗刺痛你眼帘。百姓中忽然传来婴儿啼哭，那声音像根钢针扎进你心口——若此刻选择错，这哭声将永远湮灭在浪涛与刀光里。",\n  "success_rate": 45,\n  "choices": [\n    {\n      "option": "点燃火药库逼退海盗",\n      "summ'
2025-09-26 01:46:36 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=768 预览='```json\n{\n  "text": "东海贼的营地在礁石嶙峋的海湾若隐若现，盐腥海风裹挟着腐木气息。你勒马立于潮线之上，三千流民在身后瑟缩成黑点。海盗头目周仓突然将长矛抵住你咽喉，身后喽啰们发出嗜血的哄笑——他们要的不是庇护费，而是用徐州百姓祭海神。远处海平线上，曹军楼船正破开晨雾逼近，桅杆上飘动的‘曹’字旗刺痛你'
2025-09-26 01:46:36 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=756 预览='{\n  "text": "东海贼的营地在礁石嶙峋的海湾若隐若现，盐腥海风裹挟着腐木气息。你勒马立于潮线之上，三千流民在身后瑟缩成黑点。海盗头目周仓突然将长矛抵住你咽喉，身后喽啰们发出嗜血的哄笑——他们要的不是庇护费，而是用徐州百姓祭海神。远处海平线上，曹军楼船正破开晨雾逼近，桅杆上飘动的‘曹’字旗刺痛你眼帘。百姓中忽然'
2025-09-26 01:46:36 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=756 预览='{\n  "text": "东海贼的营地在礁石嶙峋的海湾若隐若现，盐腥海风裹挟着腐木气息。你勒马立于潮线之上，三千流民在身后瑟缩成黑点。海盗头目周仓突然将长矛抵住你咽喉，身后喽啰们发出嗜血的哄笑——他们要的不是庇护费，而是用徐州百姓祭海神。远处海平线上，曹军楼船正破开晨雾逼近，桅杆上飘动的‘曹’字旗刺痛你眼帘。百姓中忽然传来婴儿啼哭，那声音像根钢针扎进你心口——若此刻选择错，这哭声将永远湮灭在浪涛与'
2025-09-26 01:46:36 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 01:46:36 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:46:36 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:46:36 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:46:36 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:46:36 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=199 parent=194 choice='带领百姓突围投奔东海贼'
2025-09-26 01:46:36 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=46 node=199 depth=2
2025-09-26 01:46:36 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '带领百姓突围投奔东海贼': cannot schedule new futures after shutdown
2025-09-26 01:46:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:46:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:46:59 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:46:59 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:46:59 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:46:59 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:46:59 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:46:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:46:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:46:59 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:46:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:46:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:47:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:47:00 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:47:00 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:47:00 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:47:00 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:47:00 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:47:14 | INFO     | api.story:prepare_start_level:152 - 开始生成故事概要，愿望：项羽...
2025-09-26 01:47:23 | INFO     | core.llm_clients:generate:246 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 01:47:23 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1291
2025-09-26 01:47:23 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 01:47:23 | INFO     | api.story:prepare_start_level:206 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=项羽...
2025-09-26 01:47:54 | INFO     | api.story:start_new_story:243 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 项羽
2025-09-26 01:47:54 | INFO     | api.story:start_new_story:266 - [pregen] 未命中缓存，现场生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 01:47:54 | INFO     | core.story_engine:start_story:219 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 01:48:10 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1980
2025-09-26 01:48:10 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=755 预览='\n\n{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意识到那些被你分封的旧六国贵族正在暗中串联，而彭城的粮仓空虚得连战马都开始啃食草根。",\n  "success_rate": 72,\n  "choices": [\n    {\n      "option": "立即分封旧贵族巩固同盟",\n      "summary": "用六'
2025-09-26 01:48:10 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=753 预览='{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意'
2025-09-26 01:48:10 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=753 预览='{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意'
2025-09-26 01:48:10 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=753 预览='{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意识到那些被你分封的旧六国贵族正在暗中串联，而彭城的粮仓空虚得连战马都开始啃食草根'
2025-09-26 01:48:10 | ERROR    | core.story_engine:_parse_llm_response:146 - [JSON] 直接解析失败: Expecting value: line 15 column 29 (char 519); json_str预览='{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意识到那些被你分封的旧六国贵族正在暗中串联，而彭城的粮仓空虚得连战马都开始啃食草根'
2025-09-26 01:48:46 | INFO     | core.llm_clients:generate:246 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 01:48:46 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2338
2025-09-26 01:48:46 | INFO     | core.story_engine:start_story:234 - [LLM raw][start] 长度=443 预览='{"text": "公元前206年冬，鸿门大帐内烛火摇曳。项羽赤着上身，青铜剑穗在肩头垂落，指节叩击着咸阳地图。副将范增急促叩帐：\'刘邦已破函谷关，献玉玺于咸阳！\'帐外北风裹挟着巨鹿之战的硝烟余味，而此刻咸阳城头飘扬的汉军旌旗正刺痛着他的脊梁。八千江东子弟的欢呼犹在耳畔，可这\'西楚霸王\'的名号，竟要被沛县匹夫轻易撼动？", "success_rate": 65, "choices": [{"option": "立即率精锐夜袭咸阳", "summary": "以雷霆之势截断刘邦退路，但可能引发诸侯猜忌", "success_rate_delta": -15}, {"option": "设宴邀请刘'
2025-09-26 01:48:46 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=443 预览='{"text": "公元前206年冬，鸿门大帐内烛火摇曳。项羽赤着上身，青铜剑穗在肩头垂落，指节叩击着咸阳地图。副将范增急促叩帐：\'刘邦已破函谷关，献玉玺于咸阳！\'帐外北风裹挟着巨鹿之战的硝烟余味，而此刻咸阳城头飘扬的汉军旌旗正刺痛着他的脊梁。八千江东子弟的欢呼犹在耳畔，可这\'西楚霸王\'的名号，竟要被沛县匹夫轻易撼动？'
2025-09-26 01:48:46 | DEBUG    | core.story_engine:_extract_json:79 - [JSON] 括号配对提取成功，长度=443 预览='{"text": "公元前206年冬，鸿门大帐内烛火摇曳。项羽赤着上身，青铜剑穗在肩头垂落，指节叩击着咸阳地图。副将范增急促叩帐：\'刘邦已破函谷关，献玉玺于咸阳！\'帐外北风裹挟着巨鹿之战的硝烟余味，而此刻咸阳城头飘扬的汉军旌旗正刺痛着他的脊梁。八千江东子弟的欢呼犹在耳畔，可这\'西楚霸王\'的名号，竟要被沛县匹夫轻易撼动？'
2025-09-26 01:48:46 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=443 预览='{"text": "公元前206年冬，鸿门大帐内烛火摇曳。项羽赤着上身，青铜剑穗在肩头垂落，指节叩击着咸阳地图。副将范增急促叩帐：\'刘邦已破函谷关，献玉玺于咸阳！\'帐外北风裹挟着巨鹿之战的硝烟余味，而此刻咸阳城头飘扬的汉军旌旗正刺痛着他的脊梁。八千江东子弟的欢呼犹在耳畔，可这\'西楚霸王\'的名号，竟要被沛县匹夫轻易撼动？", "success_rate": 65, "choices": [{"opt'
2025-09-26 01:48:46 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 150
2025-09-26 01:48:46 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:48:46 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:48:46 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:48:46 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/background1.jpg
2025-09-26 01:48:46 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 01:48:47 | INFO     | api.story:start_new_story:299 - 新故事生成成功
2025-09-26 01:48:47 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=200 depth=3
2025-09-26 01:48:47 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=200
2025-09-26 01:48:47 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 立即率精锐夜袭咸阳
2025-09-26 01:48:47 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 设宴邀请刘邦赴鸿门
2025-09-26 01:48:47 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 整顿军备暂观其变
2025-09-26 01:48:59 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1910
2025-09-26 01:48:59 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=694 预览='\n\n```json\n{\n  "text": "鸿门帐内酒香与剑气交织，刘邦伏案谢罪的背影在烛火中佝偻如枯枝。范增三次举玉玦示意，你却始终沉默。项庄的剑锋在酒宴间游走，剑穗与咸阳地图上的关中要塞重叠。帐外传来沛军斥候的马蹄声，而你突然按住剑柄——那匹随你攻入函谷的乌骓马，此刻正在马厩中焦躁地踏响蹄铁。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "当场击杀刘邦",\n      "summary": "以雷霆之势断绝隐患，但可能引发诸侯哗变",\n      "success_rate_delta": -15,\n     '
2025-09-26 01:48:59 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=692 预览='```json\n{\n  "text": "鸿门帐内酒香与剑气交织，刘邦伏案谢罪的背影在烛火中佝偻如枯枝。范增三次举玉玦示意，你却始终沉默。项庄的剑锋在酒宴间游走，剑穗与咸阳地图上的关中要塞重叠。帐外传来沛军斥候的马蹄声，而你突然按住剑柄——那匹随你攻入函谷的乌骓马，此刻正在马厩中焦躁地踏响蹄铁。",\n  "succes'
2025-09-26 01:48:59 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=680 预览='{\n  "text": "鸿门帐内酒香与剑气交织，刘邦伏案谢罪的背影在烛火中佝偻如枯枝。范增三次举玉玦示意，你却始终沉默。项庄的剑锋在酒宴间游走，剑穗与咸阳地图上的关中要塞重叠。帐外传来沛军斥候的马蹄声，而你突然按住剑柄——那匹随你攻入函谷的乌骓马，此刻正在马厩中焦躁地踏响蹄铁。",\n  "success_rate":'
2025-09-26 01:48:59 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=680 预览='{\n  "text": "鸿门帐内酒香与剑气交织，刘邦伏案谢罪的背影在烛火中佝偻如枯枝。范增三次举玉玦示意，你却始终沉默。项庄的剑锋在酒宴间游走，剑穗与咸阳地图上的关中要塞重叠。帐外传来沛军斥候的马蹄声，而你突然按住剑柄——那匹随你攻入函谷的乌骓马，此刻正在马厩中焦躁地踏响蹄铁。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option"'
2025-09-26 01:48:59 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 127
2025-09-26 01:48:59 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:48:59 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:48:59 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:48:59 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:48:59 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=201 parent=200 choice='设宴邀请刘邦赴鸿门'
2025-09-26 01:48:59 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=201 depth=2
2025-09-26 01:48:59 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=201 completed, triggered next level depth=2
2025-09-26 01:48:59 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=201
2025-09-26 01:48:59 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 当场击杀刘邦
2025-09-26 01:48:59 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 表面宽纵放行
2025-09-26 01:48:59 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 假意结盟设誓
2025-09-26 01:49:01 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1972
2025-09-26 01:49:01 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=759 预览='\n\n```json\n{\n  "text": "铁蹄踏碎咸阳郊外的薄冰，你的精锐骑士团在月色下如黑潮涌动。然而当先锋营撞开城门时，却发现宫阙空寂如坟冢——刘邦早已携玉玺南逃。城头突然炸响火炮，韩信的轻骑从咸阳东市杀出，箭雨中你瞥见他战旗上新绣的\'汉\'字刺目如血。更糟的是，斥候回报彭城方向尘烟蔽日，章邯的秦军残部竟在半路倒戈，截断了归途。八千江东健儿的战马不安地刨动蹄子，而范增正用杖尖在沙盘上勾画着新的死局。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁咸阳粮仓断敌归路",\n      "summary": "以焦'
2025-09-26 01:49:01 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=757 预览='```json\n{\n  "text": "铁蹄踏碎咸阳郊外的薄冰，你的精锐骑士团在月色下如黑潮涌动。然而当先锋营撞开城门时，却发现宫阙空寂如坟冢——刘邦早已携玉玺南逃。城头突然炸响火炮，韩信的轻骑从咸阳东市杀出，箭雨中你瞥见他战旗上新绣的\'汉\'字刺目如血。更糟的是，斥候回报彭城方向尘烟蔽日，章邯的秦军残部竟在半路倒戈，'
2025-09-26 01:49:01 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=745 预览='{\n  "text": "铁蹄踏碎咸阳郊外的薄冰，你的精锐骑士团在月色下如黑潮涌动。然而当先锋营撞开城门时，却发现宫阙空寂如坟冢——刘邦早已携玉玺南逃。城头突然炸响火炮，韩信的轻骑从咸阳东市杀出，箭雨中你瞥见他战旗上新绣的\'汉\'字刺目如血。更糟的是，斥候回报彭城方向尘烟蔽日，章邯的秦军残部竟在半路倒戈，截断了归途。八千'
2025-09-26 01:49:01 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=745 预览='{\n  "text": "铁蹄踏碎咸阳郊外的薄冰，你的精锐骑士团在月色下如黑潮涌动。然而当先锋营撞开城门时，却发现宫阙空寂如坟冢——刘邦早已携玉玺南逃。城头突然炸响火炮，韩信的轻骑从咸阳东市杀出，箭雨中你瞥见他战旗上新绣的\'汉\'字刺目如血。更糟的是，斥候回报彭城方向尘烟蔽日，章邯的秦军残部竟在半路倒戈，截断了归途。八千江东健儿的战马不安地刨动蹄子，而范增正用杖尖在沙盘上勾画着新的死局。",\n  "'
2025-09-26 01:49:01 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 181
2025-09-26 01:49:01 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:01 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:49:01 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:49:01 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:01 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=202 parent=200 choice='立即率精锐夜袭咸阳'
2025-09-26 01:49:01 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=202 depth=2
2025-09-26 01:49:01 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=202 completed, triggered next level depth=2
2025-09-26 01:49:01 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=202
2025-09-26 01:49:01 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 焚毁咸阳粮仓断敌归路
2025-09-26 01:49:01 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与章邯议和分秦旧地
2025-09-26 01:49:01 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 释放二十名秦宫乐师回城
2025-09-26 01:49:10 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2035
2025-09-26 01:49:10 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=727 预览='\n\n```json\n{\n  "text": "青铜剑锋划破刘邦咽喉的瞬间，帐内酒樽齐裂。范增的玉玦坠地碎成三瓣，项庄的剑尖仍在滴血。你攥着染血的剑穗登上高台，八千江东健儿的欢呼如潮水般涌来，却淹没在咸阳传来的急报里——沛军主力已焚毁峣关粮道。虞姬捧着乌骓马的鬃毛跪在帐外，那马儿在击杀令下达时，竟将前蹄重重踏碎了你亲手打造的鎏金马槽。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "亲率精骑截断峣关退路",\n      "summary": "以雷霆之势剿灭残部，但可能激化与诸侯矛盾",\n      "success_r'
2025-09-26 01:49:10 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=725 预览='```json\n{\n  "text": "青铜剑锋划破刘邦咽喉的瞬间，帐内酒樽齐裂。范增的玉玦坠地碎成三瓣，项庄的剑尖仍在滴血。你攥着染血的剑穗登上高台，八千江东健儿的欢呼如潮水般涌来，却淹没在咸阳传来的急报里——沛军主力已焚毁峣关粮道。虞姬捧着乌骓马的鬃毛跪在帐外，那马儿在击杀令下达时，竟将前蹄重重踏碎了你亲手打造的'
2025-09-26 01:49:10 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=713 预览='{\n  "text": "青铜剑锋划破刘邦咽喉的瞬间，帐内酒樽齐裂。范增的玉玦坠地碎成三瓣，项庄的剑尖仍在滴血。你攥着染血的剑穗登上高台，八千江东健儿的欢呼如潮水般涌来，却淹没在咸阳传来的急报里——沛军主力已焚毁峣关粮道。虞姬捧着乌骓马的鬃毛跪在帐外，那马儿在击杀令下达时，竟将前蹄重重踏碎了你亲手打造的鎏金马槽。",\n'
2025-09-26 01:49:10 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=713 预览='{\n  "text": "青铜剑锋划破刘邦咽喉的瞬间，帐内酒樽齐裂。范增的玉玦坠地碎成三瓣，项庄的剑尖仍在滴血。你攥着染血的剑穗登上高台，八千江东健儿的欢呼如潮水般涌来，却淹没在咸阳传来的急报里——沛军主力已焚毁峣关粮道。虞姬捧着乌骓马的鬃毛跪在帐外，那马儿在击杀令下达时，竟将前蹄重重踏碎了你亲手打造的鎏金马槽。",\n  "success_rate": 68,\n  "choices": [\n   '
2025-09-26 01:49:10 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 144
2025-09-26 01:49:10 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:10 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:49:10 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:49:10 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:10 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=203 parent=201 choice='当场击杀刘邦'
2025-09-26 01:49:10 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=203 depth=1
2025-09-26 01:49:10 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=203 completed, triggered next level depth=1
2025-09-26 01:49:10 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=47 node=203
2025-09-26 01:49:13 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2098
2025-09-26 01:49:13 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=738 预览='\n\n```json\n{\n  "text": "青铜酒樽在案几上震颤，项庄的剑尖挑开刘邦衣袖时，你瞥见他腕间那道巨鹿之战留下的箭疤。范增的玉杯重重撞在地砖上，碎瓷溅入你靴中。\'大王，此竖子当诛！\'老将的嘶吼与帐外马蹄声共振，而刘邦突然跪地叩首，额角渗血的刹那，你闻到乌骓马厩飘来的艾草味——那是项伯今晨才抹在马鞍的气味。沛军使者正策马奔向咸阳的密报在案头未启，你按住腰间剑柄，指腹触到昨夜新淬的毒液寒意。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "挥剑斩落项庄兵刃",\n      "summary": "震慑范增，保全'
2025-09-26 01:49:13 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=736 预览='```json\n{\n  "text": "青铜酒樽在案几上震颤，项庄的剑尖挑开刘邦衣袖时，你瞥见他腕间那道巨鹿之战留下的箭疤。范增的玉杯重重撞在地砖上，碎瓷溅入你靴中。\'大王，此竖子当诛！\'老将的嘶吼与帐外马蹄声共振，而刘邦突然跪地叩首，额角渗血的刹那，你闻到乌骓马厩飘来的艾草味——那是项伯今晨才抹在马鞍的气味。沛军使'
2025-09-26 01:49:13 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=724 预览='{\n  "text": "青铜酒樽在案几上震颤，项庄的剑尖挑开刘邦衣袖时，你瞥见他腕间那道巨鹿之战留下的箭疤。范增的玉杯重重撞在地砖上，碎瓷溅入你靴中。\'大王，此竖子当诛！\'老将的嘶吼与帐外马蹄声共振，而刘邦突然跪地叩首，额角渗血的刹那，你闻到乌骓马厩飘来的艾草味——那是项伯今晨才抹在马鞍的气味。沛军使者正策马奔向咸阳'
2025-09-26 01:49:13 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=724 预览='{\n  "text": "青铜酒樽在案几上震颤，项庄的剑尖挑开刘邦衣袖时，你瞥见他腕间那道巨鹿之战留下的箭疤。范增的玉杯重重撞在地砖上，碎瓷溅入你靴中。\'大王，此竖子当诛！\'老将的嘶吼与帐外马蹄声共振，而刘邦突然跪地叩首，额角渗血的刹那，你闻到乌骓马厩飘来的艾草味——那是项伯今晨才抹在马鞍的气味。沛军使者正策马奔向咸阳的密报在案头未启，你按住腰间剑柄，指腹触到昨夜新淬的毒液寒意。",\n  "suc'
2025-09-26 01:49:13 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 178
2025-09-26 01:49:13 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:13 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:49:13 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:49:13 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:13 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=204 parent=201 choice='表面宽纵放行'
2025-09-26 01:49:13 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=204 depth=1
2025-09-26 01:49:13 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=204 completed, triggered next level depth=1
2025-09-26 01:49:14 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2164
2025-09-26 01:49:14 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=750 预览='\n\n```json\n{\n  "text": "青铜酒樽在案几上泛着冷光，刘邦伏地谢罪的脊背微微发抖。范增第三次举起玉玦时，你瞥见项庄剑锋在烛火中划出寒芒，却在触及刘邦咽喉的刹那被项伯横剑阻隔。帐外传来沛军斥候的马蹄声，你突然意识到——咸阳城头飘扬的汉军旌旗，竟与项伯铠甲上的纹路如出一辙。巨鹿之战的呐喊犹在耳畔，此刻帐内剑拔弩张的呼吸却让你想起父亲临终前攥紧你手腕的力道：\'江东儿郎的血，不该洒在猜忌的刀尖上。\'",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "当众斩杀刘邦",\n      "summary": "以雷霆手'
2025-09-26 01:49:14 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=748 预览='```json\n{\n  "text": "青铜酒樽在案几上泛着冷光，刘邦伏地谢罪的脊背微微发抖。范增第三次举起玉玦时，你瞥见项庄剑锋在烛火中划出寒芒，却在触及刘邦咽喉的刹那被项伯横剑阻隔。帐外传来沛军斥候的马蹄声，你突然意识到——咸阳城头飘扬的汉军旌旗，竟与项伯铠甲上的纹路如出一辙。巨鹿之战的呐喊犹在耳畔，此刻帐内剑拔'
2025-09-26 01:49:14 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=736 预览='{\n  "text": "青铜酒樽在案几上泛着冷光，刘邦伏地谢罪的脊背微微发抖。范增第三次举起玉玦时，你瞥见项庄剑锋在烛火中划出寒芒，却在触及刘邦咽喉的刹那被项伯横剑阻隔。帐外传来沛军斥候的马蹄声，你突然意识到——咸阳城头飘扬的汉军旌旗，竟与项伯铠甲上的纹路如出一辙。巨鹿之战的呐喊犹在耳畔，此刻帐内剑拔弩张的呼吸却让你'
2025-09-26 01:49:14 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=736 预览='{\n  "text": "青铜酒樽在案几上泛着冷光，刘邦伏地谢罪的脊背微微发抖。范增第三次举起玉玦时，你瞥见项庄剑锋在烛火中划出寒芒，却在触及刘邦咽喉的刹那被项伯横剑阻隔。帐外传来沛军斥候的马蹄声，你突然意识到——咸阳城头飘扬的汉军旌旗，竟与项伯铠甲上的纹路如出一辙。巨鹿之战的呐喊犹在耳畔，此刻帐内剑拔弩张的呼吸却让你想起父亲临终前攥紧你手腕的力道：\'江东儿郎的血，不该洒在猜忌的刀尖上。\'",\n '
2025-09-26 01:49:14 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 01:49:14 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:14 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:49:14 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:49:14 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:14 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=205 parent=201 choice='假意结盟设誓'
2025-09-26 01:49:14 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=205 depth=1
2025-09-26 01:49:14 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=205 completed, triggered next level depth=1
2025-09-26 01:49:26 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2015
2025-09-26 01:49:26 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=729 预览='\n\n```json\n{\n  "text": "咸阳城门在乐师们的啜泣声中缓缓开启，二十名披锦戴玉的秦宫乐师踏着月光离去。然而次日黎明，城东酒肆突然发现三具尸体——皆是昨日被释放的乐师，喉间插着刻有\'汉\'字的短剑。范增将染血的剑柄掷于你案前：\'沛公在向您献技了。\'更令人不安的是，江东斥候密报：章邯军中竟出现与乐师装束相同的斥候，正向函谷关方向传递密卷。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "斩杀章邯全军震慑汉军",\n      "summary": "以灭族之刑震慑叛军，但可能激化关中民变",\n      "s'
2025-09-26 01:49:26 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=727 预览='```json\n{\n  "text": "咸阳城门在乐师们的啜泣声中缓缓开启，二十名披锦戴玉的秦宫乐师踏着月光离去。然而次日黎明，城东酒肆突然发现三具尸体——皆是昨日被释放的乐师，喉间插着刻有\'汉\'字的短剑。范增将染血的剑柄掷于你案前：\'沛公在向您献技了。\'更令人不安的是，江东斥候密报：章邯军中竟出现与乐师装束相同的斥'
2025-09-26 01:49:26 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=715 预览='{\n  "text": "咸阳城门在乐师们的啜泣声中缓缓开启，二十名披锦戴玉的秦宫乐师踏着月光离去。然而次日黎明，城东酒肆突然发现三具尸体——皆是昨日被释放的乐师，喉间插着刻有\'汉\'字的短剑。范增将染血的剑柄掷于你案前：\'沛公在向您献技了。\'更令人不安的是，江东斥候密报：章邯军中竟出现与乐师装束相同的斥候，正向函谷关方'
2025-09-26 01:49:26 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=715 预览='{\n  "text": "咸阳城门在乐师们的啜泣声中缓缓开启，二十名披锦戴玉的秦宫乐师踏着月光离去。然而次日黎明，城东酒肆突然发现三具尸体——皆是昨日被释放的乐师，喉间插着刻有\'汉\'字的短剑。范增将染血的剑柄掷于你案前：\'沛公在向您献技了。\'更令人不安的是，江东斥候密报：章邯军中竟出现与乐师装束相同的斥候，正向函谷关方向传递密卷。",\n  "success_rate": 68,\n  "choice'
2025-09-26 01:49:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 153
2025-09-26 01:49:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:49:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:49:26 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:26 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=206 parent=202 choice='释放二十名秦宫乐师回城'
2025-09-26 01:49:26 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=206 depth=1
2025-09-26 01:49:26 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=206 completed, triggered next level depth=1
2025-09-26 01:49:27 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:49:36 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2227
2025-09-26 01:49:36 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=727 预览='\n\n```json\n{\n  "text": "整顿军备的号角在彭城城头回响，三万江东精锐列阵操练。项羽亲执长戟校场点兵，铁甲映着冬日残阳，却难掩帐中暗流涌动。范增捧着咸阳密报疾步入帐，指节叩在地图咸阳城标记上：\'刘邦已遣韩信北渡黄河，欲联合魏王豹！\'帐外传来乌骓马嘶鸣，巨鹿之战的功勋老将们正围聚私语，有人低声咒骂\'西楚虚有霸王之名，竟容沛狗坐大\'。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "挥师西进直取咸阳",\n      "summary": "以雷霆之势截断刘邦粮道，但可能暴露主力空虚",\n      "su'
2025-09-26 01:49:36 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=725 预览='```json\n{\n  "text": "整顿军备的号角在彭城城头回响，三万江东精锐列阵操练。项羽亲执长戟校场点兵，铁甲映着冬日残阳，却难掩帐中暗流涌动。范增捧着咸阳密报疾步入帐，指节叩在地图咸阳城标记上：\'刘邦已遣韩信北渡黄河，欲联合魏王豹！\'帐外传来乌骓马嘶鸣，巨鹿之战的功勋老将们正围聚私语，有人低声咒骂\'西楚虚有'
2025-09-26 01:49:36 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=713 预览='{\n  "text": "整顿军备的号角在彭城城头回响，三万江东精锐列阵操练。项羽亲执长戟校场点兵，铁甲映着冬日残阳，却难掩帐中暗流涌动。范增捧着咸阳密报疾步入帐，指节叩在地图咸阳城标记上：\'刘邦已遣韩信北渡黄河，欲联合魏王豹！\'帐外传来乌骓马嘶鸣，巨鹿之战的功勋老将们正围聚私语，有人低声咒骂\'西楚虚有霸王之名，竟容沛'
2025-09-26 01:49:36 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=713 预览='{\n  "text": "整顿军备的号角在彭城城头回响，三万江东精锐列阵操练。项羽亲执长戟校场点兵，铁甲映着冬日残阳，却难掩帐中暗流涌动。范增捧着咸阳密报疾步入帐，指节叩在地图咸阳城标记上：\'刘邦已遣韩信北渡黄河，欲联合魏王豹！\'帐外传来乌骓马嘶鸣，巨鹿之战的功勋老将们正围聚私语，有人低声咒骂\'西楚虚有霸王之名，竟容沛狗坐大\'。",\n  "success_rate": 68,\n  "choices'
2025-09-26 01:49:36 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 152
2025-09-26 01:49:36 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:36 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:49:36 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:49:36 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:36 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=207 parent=200 choice='整顿军备暂观其变'
2025-09-26 01:49:36 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=207 depth=2
2025-09-26 01:49:36 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '整顿军备暂观其变': cannot schedule new futures after shutdown
2025-09-26 01:49:43 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2069
2025-09-26 01:49:43 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=789 预览='\n\n```json\n{\n  "text": "铁骑踏碎咸阳郊外的薄冰，你率八百铁甲亲卫撕开韩信伏兵的包围网。火把映照着咸阳宫阙焦黑的断壁，残存的秦吏在暗巷中尖叫奔逃。当精锐们踹开未锁的传国玉玺藏殿时，却发现金匮空空如也——刘邦的谋士早用赝品调包。更糟的是，章邯的秦军战车正从咸阳西门杀出，他们举着半截烧焦的楚军旌旗，为首武将竟是你三日前斩杀的副将钟离昧！范增的战马突然人立而起，老将嘶吼着掷出酒囊：\'这是秦军诈死之计！彭城的密报你可还记得？\'",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "强攻章邯本阵",\n      "'
2025-09-26 01:49:43 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=787 预览='```json\n{\n  "text": "铁骑踏碎咸阳郊外的薄冰，你率八百铁甲亲卫撕开韩信伏兵的包围网。火把映照着咸阳宫阙焦黑的断壁，残存的秦吏在暗巷中尖叫奔逃。当精锐们踹开未锁的传国玉玺藏殿时，却发现金匮空空如也——刘邦的谋士早用赝品调包。更糟的是，章邯的秦军战车正从咸阳西门杀出，他们举着半截烧焦的楚军旌旗，为首武将'
2025-09-26 01:49:43 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=775 预览='{\n  "text": "铁骑踏碎咸阳郊外的薄冰，你率八百铁甲亲卫撕开韩信伏兵的包围网。火把映照着咸阳宫阙焦黑的断壁，残存的秦吏在暗巷中尖叫奔逃。当精锐们踹开未锁的传国玉玺藏殿时，却发现金匮空空如也——刘邦的谋士早用赝品调包。更糟的是，章邯的秦军战车正从咸阳西门杀出，他们举着半截烧焦的楚军旌旗，为首武将竟是你三日前斩杀'
2025-09-26 01:49:43 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=775 预览='{\n  "text": "铁骑踏碎咸阳郊外的薄冰，你率八百铁甲亲卫撕开韩信伏兵的包围网。火把映照着咸阳宫阙焦黑的断壁，残存的秦吏在暗巷中尖叫奔逃。当精锐们踹开未锁的传国玉玺藏殿时，却发现金匮空空如也——刘邦的谋士早用赝品调包。更糟的是，章邯的秦军战车正从咸阳西门杀出，他们举着半截烧焦的楚军旌旗，为首武将竟是你三日前斩杀的副将钟离昧！范增的战马突然人立而起，老将嘶吼着掷出酒囊：\'这是秦军诈死之计！彭'
2025-09-26 01:49:43 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-26 01:49:43 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:43 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:49:43 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:49:43 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:43 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=208 parent=202 choice='与章邯议和分秦旧地'
2025-09-26 01:49:43 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=208 depth=1
2025-09-26 01:49:43 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '与章邯议和分秦旧地': cannot schedule new futures after shutdown
2025-09-26 01:49:44 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2170
2025-09-26 01:49:44 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=753 预览='\n\n```json\n{\n  "text": "火光撕裂咸阳夜空，焦土气息裹挟着未熄灭的粮草残骸漫卷军阵。你亲卫队刚焚尽最后一座粮仓，韩信的轻骑便如毒蛇般从咸阳西市杀出。火把映照下，章邯的秦甲军竟与汉军旌旗交错——原来咸阳城早被刘邦布下棋局。范增的青铜酒爵在沙盘上重重一顿：\'粮道已断，彭城方向尘烟更盛，章邯此番倒戈恐有诈！\'江东将士的铠甲在寒风中叮当作响，有人开始摩挲剑柄看向汝南方向——那里传来百姓举着楚军旗号却唱着楚歌的诡异声浪。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "强攻韩信主力",\n      "summ'
2025-09-26 01:49:44 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=751 预览='```json\n{\n  "text": "火光撕裂咸阳夜空，焦土气息裹挟着未熄灭的粮草残骸漫卷军阵。你亲卫队刚焚尽最后一座粮仓，韩信的轻骑便如毒蛇般从咸阳西市杀出。火把映照下，章邯的秦甲军竟与汉军旌旗交错——原来咸阳城早被刘邦布下棋局。范增的青铜酒爵在沙盘上重重一顿：\'粮道已断，彭城方向尘烟更盛，章邯此番倒戈恐有诈！\''
2025-09-26 01:49:44 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=739 预览='{\n  "text": "火光撕裂咸阳夜空，焦土气息裹挟着未熄灭的粮草残骸漫卷军阵。你亲卫队刚焚尽最后一座粮仓，韩信的轻骑便如毒蛇般从咸阳西市杀出。火把映照下，章邯的秦甲军竟与汉军旌旗交错——原来咸阳城早被刘邦布下棋局。范增的青铜酒爵在沙盘上重重一顿：\'粮道已断，彭城方向尘烟更盛，章邯此番倒戈恐有诈！\'江东将士的铠甲在'
2025-09-26 01:49:44 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=739 预览='{\n  "text": "火光撕裂咸阳夜空，焦土气息裹挟着未熄灭的粮草残骸漫卷军阵。你亲卫队刚焚尽最后一座粮仓，韩信的轻骑便如毒蛇般从咸阳西市杀出。火把映照下，章邯的秦甲军竟与汉军旌旗交错——原来咸阳城早被刘邦布下棋局。范增的青铜酒爵在沙盘上重重一顿：\'粮道已断，彭城方向尘烟更盛，章邯此番倒戈恐有诈！\'江东将士的铠甲在寒风中叮当作响，有人开始摩挲剑柄看向汝南方向——那里传来百姓举着楚军旗号却唱着楚'
2025-09-26 01:49:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 194
2025-09-26 01:49:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:49:44 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:49:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:49:44 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:49:44 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=209 parent=202 choice='焚毁咸阳粮仓断敌归路'
2025-09-26 01:49:44 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=209 depth=1
2025-09-26 01:49:44 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '焚毁咸阳粮仓断敌归路': cannot schedule new futures after shutdown
2025-09-26 01:50:09 | INFO     | core.llm_clients:generate:256 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1773
2025-09-26 01:50:09 | DEBUG    | core.story_engine:_attempt_json_fix:205 - [JSON-FIX] 修复返回长度=765 预览='\n\n```json\n{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意识到那些被你分封的旧六国贵族正在暗中串联，而彭城的粮仓空虚得'
2025-09-26 01:50:09 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=763 预览='```json\n{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未'
2025-09-26 01:50:09 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=751 预览='{\n  "text": "咸阳宫的残垣断壁在夕阳下投下长长的阴影，你——西楚霸王项羽，握着沾血的青铜剑柄，望着阶下匍匐的秦王子婴。巨鹿之战的凯歌犹在耳畔，而此刻天下归属的重担压得你胸中气血翻涌。帐外传来范增急促的脚步声，老将喘息着递上密报：刘邦已入函谷关，正以\'义帝诏令\'之名收编三秦之地。你抚过铠甲上未干的血迹，突然意'
2025-09-26 01:50:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 188
2025-09-26 01:50:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:50:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:50:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:50:09 | INFO     | core.story_engine:start_story:242 - 成功生成开篇故事，图片为: /static/magic_forest.jpg
2025-09-26 01:50:09 | INFO     | core.story_engine:start_story:265 - 新故事生成成功
2025-09-26 01:50:09 | INFO     | api.story:_background_pregen_first_story:73 - [pregen] 第一节故事预生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=项羽...
2025-09-26 01:50:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:50:11 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:50:11 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:50:11 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:50:11 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:50:11 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:50:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:50:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:50:11 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:50:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:50:11 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:50:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:50:12 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:50:12 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:50:12 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:50:12 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:50:12 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:51:35 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:51:36 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:51:37 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:51:37 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:51:37 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:51:37 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:51:37 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:51:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:51:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:51:37 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:51:37 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:51:37 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:51:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:51:38 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:51:38 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:51:38 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:51:38 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:51:38 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:51:47 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:51:48 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:51:48 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:51:48 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:51:48 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:51:48 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:51:48 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:51:48 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:51:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:51:49 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:51:49 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:51:49 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:51:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:51:49 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:51:49 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:51:49 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:51:49 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:51:49 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:53:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:53:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:53:09 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:53:09 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:53:09 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:53:09 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:53:09 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:53:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:53:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:53:09 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:53:09 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:53:09 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:53:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:53:10 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:53:10 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:53:10 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:53:10 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:53:10 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:53:10 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:53:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:53:12 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:53:12 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:53:12 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:53:12 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:53:12 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:53:12 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:53:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:53:12 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:53:12 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:53:12 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:53:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:53:13 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:53:13 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:53:13 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:53:13 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:53:13 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:55:22 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:55:24 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:55:25 | DEBUG    | core.llm_clients:__init__:80 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:55:25 | INFO     | core.llm_clients:__init__:83 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:55:25 | INFO     | core.llm_clients:__init__:88 - 模型: Qwen/QwQ-32B
2025-09-26 01:55:25 | INFO     | core.llm_clients:__init__:89 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:55:25 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:55:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:55:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:55:25 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:55:25 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:55:25 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:55:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:55:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:55:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:55:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:55:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:55:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:55:43 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 01:55:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 01:55:45 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 01:55:45 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 01:55:45 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 01:55:45 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 01:55:45 | INFO     | core.story_engine:__init__:24 - 故事引擎初始化完成
2025-09-26 01:55:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:55:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:55:45 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 01:55:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 01:55:45 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 01:55:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 01:55:46 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 01:55:46 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 01:55:46 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 01:55:46 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 01:55:46 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 01:56:13 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 立即率精锐夜袭咸阳
2025-09-26 01:56:16 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 与章邯议和分秦旧地
2025-09-26 01:56:19 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 强攻章邯本阵
2025-09-26 01:56:19 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 强攻章邯本阵
2025-09-26 01:56:34 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2357
2025-09-26 01:56:34 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=797 预览='\n\n```json\n{\n  "text": "战鼓撕裂夜幕，你亲卫军的玄甲撞开章邯本阵时，发现秦军阵中竟飘着楚军残旗。章邯战车自阵中冲出，青铜面具下传来讥讽大笑：\'项王可知咸阳地底埋着多少秦卒尸骨？\'话音未落，地底突然传来闷响——整片平原竟暗藏连环地陷机关！韩信的轻骑从地裂处窜出截断退路，而彭城方向的烽火台骤然点燃，映出\'楚反\'二字血焰。范增的战马被地裂惊得坠入深坑，你抓住他手腕时，摸到他袖中滑落半块密信火漆——与三日前刘邦使者佩戴的纹章如出一辙。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁地陷机关触发装置"'
2025-09-26 01:56:34 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=795 预览='```json\n{\n  "text": "战鼓撕裂夜幕，你亲卫军的玄甲撞开章邯本阵时，发现秦军阵中竟飘着楚军残旗。章邯战车自阵中冲出，青铜面具下传来讥讽大笑：\'项王可知咸阳地底埋着多少秦卒尸骨？\'话音未落，地底突然传来闷响——整片平原竟暗藏连环地陷机关！韩信的轻骑从地裂处窜出截断退路，而彭城方向的烽火台骤然点燃，映出\''
2025-09-26 01:56:34 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=783 预览='{\n  "text": "战鼓撕裂夜幕，你亲卫军的玄甲撞开章邯本阵时，发现秦军阵中竟飘着楚军残旗。章邯战车自阵中冲出，青铜面具下传来讥讽大笑：\'项王可知咸阳地底埋着多少秦卒尸骨？\'话音未落，地底突然传来闷响——整片平原竟暗藏连环地陷机关！韩信的轻骑从地裂处窜出截断退路，而彭城方向的烽火台骤然点燃，映出\'楚反\'二字血焰。'
2025-09-26 01:56:34 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=783 预览='{\n  "text": "战鼓撕裂夜幕，你亲卫军的玄甲撞开章邯本阵时，发现秦军阵中竟飘着楚军残旗。章邯战车自阵中冲出，青铜面具下传来讥讽大笑：\'项王可知咸阳地底埋着多少秦卒尸骨？\'话音未落，地底突然传来闷响——整片平原竟暗藏连环地陷机关！韩信的轻骑从地裂处窜出截断退路，而彭城方向的烽火台骤然点燃，映出\'楚反\'二字血焰。范增的战马被地裂惊得坠入深坑，你抓住他手腕时，摸到他袖中滑落半块密信火漆——与三'
2025-09-26 01:56:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 203
2025-09-26 01:56:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:56:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:56:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:56:34 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:56:34 | INFO     | api.story:continue_existing_story:439 - 故事继续生成成功
2025-09-26 01:56:34 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=210 depth=3
2025-09-26 01:56:34 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=210
2025-09-26 01:56:34 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 焚毁地陷机关触发装置
2025-09-26 01:56:34 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 释放被俘秦军降卒为质
2025-09-26 01:56:34 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率残部突袭彭城烽火台
2025-09-26 01:56:49 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2621
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=768 预览='\n\n```json\n{\n  "text": "秦卒铁甲拖地的声响撕裂夜幕，八百降卒被松绑时眼中燃着诡异的红光。你挥剑斩断最后一根锁链，却见章邯副将钟离昧从队列中走出，他残缺的左臂竟用精钢义肢替换，手中青铜面具摔落尘埃：\'楚军仁义，教我等如何再效忠暴秦？\'话音未落，咸阳地底传来闷雷般的震动——韩信的弩车阵从城墙暗道涌出，箭矢钉入你脚前三寸处，箭杆刻着范增私印。彭城方向突然亮起狼烟，火光中隐约可见\'项\'字旗幡，那是你留在江东的亲族营帐！",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "火烧降卒营地诱出内应",\n      '
2025-09-26 01:56:49 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=766 预览='```json\n{\n  "text": "秦卒铁甲拖地的声响撕裂夜幕，八百降卒被松绑时眼中燃着诡异的红光。你挥剑斩断最后一根锁链，却见章邯副将钟离昧从队列中走出，他残缺的左臂竟用精钢义肢替换，手中青铜面具摔落尘埃：\'楚军仁义，教我等如何再效忠暴秦？\'话音未落，咸阳地底传来闷雷般的震动——韩信的弩车阵从城墙暗道涌出，箭矢'
2025-09-26 01:56:49 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=754 预览='{\n  "text": "秦卒铁甲拖地的声响撕裂夜幕，八百降卒被松绑时眼中燃着诡异的红光。你挥剑斩断最后一根锁链，却见章邯副将钟离昧从队列中走出，他残缺的左臂竟用精钢义肢替换，手中青铜面具摔落尘埃：\'楚军仁义，教我等如何再效忠暴秦？\'话音未落，咸阳地底传来闷雷般的震动——韩信的弩车阵从城墙暗道涌出，箭矢钉入你脚前三寸处'
2025-09-26 01:56:49 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=754 预览='{\n  "text": "秦卒铁甲拖地的声响撕裂夜幕，八百降卒被松绑时眼中燃着诡异的红光。你挥剑斩断最后一根锁链，却见章邯副将钟离昧从队列中走出，他残缺的左臂竟用精钢义肢替换，手中青铜面具摔落尘埃：\'楚军仁义，教我等如何再效忠暴秦？\'话音未落，咸阳地底传来闷雷般的震动——韩信的弩车阵从城墙暗道涌出，箭矢钉入你脚前三寸处，箭杆刻着范增私印。彭城方向突然亮起狼烟，火光中隐约可见\'项\'字旗幡，那是你留在'
2025-09-26 01:56:49 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 195
2025-09-26 01:56:49 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:56:49 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:56:49 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:56:49 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=211 parent=210 choice='释放被俘秦军降卒为质'
2025-09-26 01:56:49 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=211 depth=2
2025-09-26 01:56:49 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=211 completed, triggered next level depth=2
2025-09-26 01:56:49 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=211
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 火烧降卒营地诱出内应
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 佯装不知晓密信来源
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 立即将钟离昧献给降卒
2025-09-26 01:56:49 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2611
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=764 预览='\n\n```json\n{\n  "text": "彭城烽火台的夯土城墙在月光下泛着血色，你率三百残部攀上断垣时，突然发现台顶密布着青铜弩机——本该废弃的汉军工事竟暗藏千名死士。正当亲卫准备点燃火药库，东侧山道突然传来熟悉的战鼓声：项庄的乌骓马踏碎冰河，身后竟跟着披甲的八千江东老卒！范增枯瘦的手指掐住你肩甲低语：\'他们颈后都画着黥面标记，是章邯军的活尸营！\'西北方传来刘邦的号角，而你掌心的传国玉玺赝品正在寒风中发烫。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "点燃火药库与敌同归于尽",\n      "summary":'
2025-09-26 01:56:49 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=762 预览='```json\n{\n  "text": "彭城烽火台的夯土城墙在月光下泛着血色，你率三百残部攀上断垣时，突然发现台顶密布着青铜弩机——本该废弃的汉军工事竟暗藏千名死士。正当亲卫准备点燃火药库，东侧山道突然传来熟悉的战鼓声：项庄的乌骓马踏碎冰河，身后竟跟着披甲的八千江东老卒！范增枯瘦的手指掐住你肩甲低语：\'他们颈后都画着'
2025-09-26 01:56:49 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=750 预览='{\n  "text": "彭城烽火台的夯土城墙在月光下泛着血色，你率三百残部攀上断垣时，突然发现台顶密布着青铜弩机——本该废弃的汉军工事竟暗藏千名死士。正当亲卫准备点燃火药库，东侧山道突然传来熟悉的战鼓声：项庄的乌骓马踏碎冰河，身后竟跟着披甲的八千江东老卒！范增枯瘦的手指掐住你肩甲低语：\'他们颈后都画着黥面标记，是章邯'
2025-09-26 01:56:49 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=750 预览='{\n  "text": "彭城烽火台的夯土城墙在月光下泛着血色，你率三百残部攀上断垣时，突然发现台顶密布着青铜弩机——本该废弃的汉军工事竟暗藏千名死士。正当亲卫准备点燃火药库，东侧山道突然传来熟悉的战鼓声：项庄的乌骓马踏碎冰河，身后竟跟着披甲的八千江东老卒！范增枯瘦的手指掐住你肩甲低语：\'他们颈后都画着黥面标记，是章邯军的活尸营！\'西北方传来刘邦的号角，而你掌心的传国玉玺赝品正在寒风中发烫。",\n'
2025-09-26 01:56:49 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 184
2025-09-26 01:56:49 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:56:49 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:56:49 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:56:49 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=212 parent=210 choice='率残部突袭彭城烽火台'
2025-09-26 01:56:49 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=212 depth=2
2025-09-26 01:56:49 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=212 completed, triggered next level depth=2
2025-09-26 01:56:49 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=212
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 点燃火药库与敌同归于尽
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与项庄残部组成防御阵型
2025-09-26 01:56:49 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 释放玉玺赝品引开追兵
2025-09-26 01:56:58 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3066
2025-09-26 01:56:58 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=758 预览='\n\n```json\n{\n  "text": "烈焰吞没机关枢杻的刹那，咸阳地底的轰鸣戛然而止。章邯的战车在火光中化作焦炭，但你发现他的青铜面具下竟藏着半张烧焦的密信——与范增袖中滑落的火漆纹章严丝合缝。韩信的轻骑趁机从咸阳南门杀出，旌旗上赫然绣着\'楚汉共主\'四字。范增被俘虏的亲卫突然嘶吼：\'彭城地牢里还藏着两千楚军降卒！\'八千江东儿郎的战马在焦土上不安嘶鸣，而咸阳宫顶的残月正映出刘邦使者消失在城楼暗道的身影。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "突袭彭城地牢解救降卒",\n      "summary": "'
2025-09-26 01:56:58 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=756 预览='```json\n{\n  "text": "烈焰吞没机关枢杻的刹那，咸阳地底的轰鸣戛然而止。章邯的战车在火光中化作焦炭，但你发现他的青铜面具下竟藏着半张烧焦的密信——与范增袖中滑落的火漆纹章严丝合缝。韩信的轻骑趁机从咸阳南门杀出，旌旗上赫然绣着\'楚汉共主\'四字。范增被俘虏的亲卫突然嘶吼：\'彭城地牢里还藏着两千楚军降卒！\''
2025-09-26 01:56:58 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=744 预览='{\n  "text": "烈焰吞没机关枢杻的刹那，咸阳地底的轰鸣戛然而止。章邯的战车在火光中化作焦炭，但你发现他的青铜面具下竟藏着半张烧焦的密信——与范增袖中滑落的火漆纹章严丝合缝。韩信的轻骑趁机从咸阳南门杀出，旌旗上赫然绣着\'楚汉共主\'四字。范增被俘虏的亲卫突然嘶吼：\'彭城地牢里还藏着两千楚军降卒！\'八千江东儿郎的战'
2025-09-26 01:56:58 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=744 预览='{\n  "text": "烈焰吞没机关枢杻的刹那，咸阳地底的轰鸣戛然而止。章邯的战车在火光中化作焦炭，但你发现他的青铜面具下竟藏着半张烧焦的密信——与范增袖中滑落的火漆纹章严丝合缝。韩信的轻骑趁机从咸阳南门杀出，旌旗上赫然绣着\'楚汉共主\'四字。范增被俘虏的亲卫突然嘶吼：\'彭城地牢里还藏着两千楚军降卒！\'八千江东儿郎的战马在焦土上不安嘶鸣，而咸阳宫顶的残月正映出刘邦使者消失在城楼暗道的身影。",\n '
2025-09-26 01:56:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 01:56:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:56:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:56:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:56:58 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:56:58 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=213 parent=210 choice='焚毁地陷机关触发装置'
2025-09-26 01:56:58 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=213 depth=2
2025-09-26 01:56:58 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=213 completed, triggered next level depth=2
2025-09-26 01:56:58 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=213
2025-09-26 01:56:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 突袭彭城地牢解救降卒
2025-09-26 01:56:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 当众处决范增并公开密信
2025-09-26 01:56:58 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 假意与韩信结盟分割秦地
2025-09-26 01:57:01 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2667
2025-09-26 01:57:01 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=757 预览='\n\n```json\n{\n  "text": "彭城烽火台的青铜弩机喷吐着火舌，你与项庄的残部背靠背死守中央祭坛。突然有亲卫从背后传来密报：\'江东老卒阵中混入百名黥面死士！\'项庄的乌骓马嘶鸣着撞破东南角防御，你看见他铠甲下竟渗出黑血——那些\'江东子弟\'脖颈都系着与章邯军相同的玄色丝绦。范增拖着断剑刺入地砖，沙哑道：\'咸阳地底的尸骨阵还在向你索命！\'北面刘邦的赤色旌旗正借风势压来，而你腰间那枚赝品传国玉玺突然发出诡异共鸣。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁烽火台诱敌入瓮",\n      "summary'
2025-09-26 01:57:01 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=755 预览='```json\n{\n  "text": "彭城烽火台的青铜弩机喷吐着火舌，你与项庄的残部背靠背死守中央祭坛。突然有亲卫从背后传来密报：\'江东老卒阵中混入百名黥面死士！\'项庄的乌骓马嘶鸣着撞破东南角防御，你看见他铠甲下竟渗出黑血——那些\'江东子弟\'脖颈都系着与章邯军相同的玄色丝绦。范增拖着断剑刺入地砖，沙哑道：\'咸阳地底'
2025-09-26 01:57:01 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=743 预览='{\n  "text": "彭城烽火台的青铜弩机喷吐着火舌，你与项庄的残部背靠背死守中央祭坛。突然有亲卫从背后传来密报：\'江东老卒阵中混入百名黥面死士！\'项庄的乌骓马嘶鸣着撞破东南角防御，你看见他铠甲下竟渗出黑血——那些\'江东子弟\'脖颈都系着与章邯军相同的玄色丝绦。范增拖着断剑刺入地砖，沙哑道：\'咸阳地底的尸骨阵还在向你'
2025-09-26 01:57:01 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=743 预览='{\n  "text": "彭城烽火台的青铜弩机喷吐着火舌，你与项庄的残部背靠背死守中央祭坛。突然有亲卫从背后传来密报：\'江东老卒阵中混入百名黥面死士！\'项庄的乌骓马嘶鸣着撞破东南角防御，你看见他铠甲下竟渗出黑血——那些\'江东子弟\'脖颈都系着与章邯军相同的玄色丝绦。范增拖着断剑刺入地砖，沙哑道：\'咸阳地底的尸骨阵还在向你索命！\'北面刘邦的赤色旌旗正借风势压来，而你腰间那枚赝品传国玉玺突然发出诡异共鸣'
2025-09-26 01:57:01 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 188
2025-09-26 01:57:01 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:01 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:57:01 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:57:01 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:01 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=214 parent=212 choice='与项庄残部组成防御阵型'
2025-09-26 01:57:01 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=214 depth=1
2025-09-26 01:57:01 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=214 completed, triggered next level depth=1
2025-09-26 01:57:01 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=47 node=214
2025-09-26 01:57:04 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2686
2025-09-26 01:57:04 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=785 预览='\n\n```json\n{\n  "text": "咸阳宫地动山摇，你将范增按在断柱之下，剑锋悬在他咽喉三寸：\'老将军可知，放火的秦卒铠甲内衬绣着会稽纹样？\'范增苍老的手掌突然扣住你手腕，他溃烂的指甲渗着黑血：\'竖子不足与谋！彭城地牢还关着你八百江东儿郎！\'城外突然响起诡异的编钟声，韩信的传令兵倒吊在城墙箭楼，用楚地方言高唱：\'范增献玉玺，项王娶戚姬，楚军皆汉卒！\'八百降秦士卒在你身后突然齐刷刷跪倒，他们铁甲内翻出的红绸上，赫然绣着\'汉\'字。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "斩杀范增并公开其密信",\n    '
2025-09-26 01:57:04 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=783 预览='```json\n{\n  "text": "咸阳宫地动山摇，你将范增按在断柱之下，剑锋悬在他咽喉三寸：\'老将军可知，放火的秦卒铠甲内衬绣着会稽纹样？\'范增苍老的手掌突然扣住你手腕，他溃烂的指甲渗着黑血：\'竖子不足与谋！彭城地牢还关着你八百江东儿郎！\'城外突然响起诡异的编钟声，韩信的传令兵倒吊在城墙箭楼，用楚地方言高唱：\''
2025-09-26 01:57:04 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=771 预览='{\n  "text": "咸阳宫地动山摇，你将范增按在断柱之下，剑锋悬在他咽喉三寸：\'老将军可知，放火的秦卒铠甲内衬绣着会稽纹样？\'范增苍老的手掌突然扣住你手腕，他溃烂的指甲渗着黑血：\'竖子不足与谋！彭城地牢还关着你八百江东儿郎！\'城外突然响起诡异的编钟声，韩信的传令兵倒吊在城墙箭楼，用楚地方言高唱：\'范增献玉玺，项王'
2025-09-26 01:57:04 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=771 预览='{\n  "text": "咸阳宫地动山摇，你将范增按在断柱之下，剑锋悬在他咽喉三寸：\'老将军可知，放火的秦卒铠甲内衬绣着会稽纹样？\'范增苍老的手掌突然扣住你手腕，他溃烂的指甲渗着黑血：\'竖子不足与谋！彭城地牢还关着你八百江东儿郎！\'城外突然响起诡异的编钟声，韩信的传令兵倒吊在城墙箭楼，用楚地方言高唱：\'范增献玉玺，项王娶戚姬，楚军皆汉卒！\'八百降秦士卒在你身后突然齐刷刷跪倒，他们铁甲内翻出的红绸上'
2025-09-26 01:57:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 197
2025-09-26 01:57:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:57:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:57:04 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:04 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=215 parent=211 choice='佯装不知晓密信来源'
2025-09-26 01:57:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=215 depth=1
2025-09-26 01:57:04 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=215 completed, triggered next level depth=1
2025-09-26 01:57:07 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2837
2025-09-26 01:57:07 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=750 预览='\n\n```json\n{\n  "text": "火海吞没营地时，三道黑影从地穴密道窜出。你亲自提枪追击，却发现逃亡者皆佩戴范增亲卫的赤色臂章。咸阳城头突然升起楚军旗号，却在月光下扭曲成诡异的\'刘\'字纹样。彭城密使的竹简从燃烧的营帐中飞出，揭露范增三年前便与刘邦密商\'楚汉分秦\'之策。更致命的是，章邯残部趁乱攻破粮仓，八千江东子弟的粮草竟被换成掺毒麦粒——而你腰间解毒丹的锦盒，此刻正空空如也。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "斩杀范增并公开密信",\n      "summary": "以雷霆手段震慑叛徒，但可'
2025-09-26 01:57:07 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=748 预览='```json\n{\n  "text": "火海吞没营地时，三道黑影从地穴密道窜出。你亲自提枪追击，却发现逃亡者皆佩戴范增亲卫的赤色臂章。咸阳城头突然升起楚军旗号，却在月光下扭曲成诡异的\'刘\'字纹样。彭城密使的竹简从燃烧的营帐中飞出，揭露范增三年前便与刘邦密商\'楚汉分秦\'之策。更致命的是，章邯残部趁乱攻破粮仓，八千江东子'
2025-09-26 01:57:07 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=736 预览='{\n  "text": "火海吞没营地时，三道黑影从地穴密道窜出。你亲自提枪追击，却发现逃亡者皆佩戴范增亲卫的赤色臂章。咸阳城头突然升起楚军旗号，却在月光下扭曲成诡异的\'刘\'字纹样。彭城密使的竹简从燃烧的营帐中飞出，揭露范增三年前便与刘邦密商\'楚汉分秦\'之策。更致命的是，章邯残部趁乱攻破粮仓，八千江东子弟的粮草竟被换成'
2025-09-26 01:57:07 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=736 预览='{\n  "text": "火海吞没营地时，三道黑影从地穴密道窜出。你亲自提枪追击，却发现逃亡者皆佩戴范增亲卫的赤色臂章。咸阳城头突然升起楚军旗号，却在月光下扭曲成诡异的\'刘\'字纹样。彭城密使的竹简从燃烧的营帐中飞出，揭露范增三年前便与刘邦密商\'楚汉分秦\'之策。更致命的是，章邯残部趁乱攻破粮仓，八千江东子弟的粮草竟被换成掺毒麦粒——而你腰间解毒丹的锦盒，此刻正空空如也。",\n  "success_r'
2025-09-26 01:57:07 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 172
2025-09-26 01:57:07 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:07 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:57:07 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:57:07 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:07 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=216 parent=211 choice='火烧降卒营地诱出内应'
2025-09-26 01:57:07 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=216 depth=1
2025-09-26 01:57:07 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=216 completed, triggered next level depth=1
2025-09-26 01:57:09 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2793
2025-09-26 01:57:09 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=764 预览='\n\n```json\n{\n  "text": "赝玺坠地的脆响惊醒了沉寂的夜，章邯的追兵果然如潮水般涌向发光的玉匣。你趁机率残部遁入彭城地底，却在暗河密道中撞见诡异一幕——韩信的轻骑与楚军死士正共同抬着巨型弩车，车身上烙着秦始皇时期的龙纹。范增突然用血指在石壁画出咸阳地图：「章邯的兵马俑军营就在地下三十丈，而刘邦的火药正从泗水港运来！」暗河深处传来机械转动声，八千江东子弟的刀剑映出地宫深处若隐若现的青铜巨门。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "炸毁青铜巨门截断地宫",\n      "summary": "利'
2025-09-26 01:57:09 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=762 预览='```json\n{\n  "text": "赝玺坠地的脆响惊醒了沉寂的夜，章邯的追兵果然如潮水般涌向发光的玉匣。你趁机率残部遁入彭城地底，却在暗河密道中撞见诡异一幕——韩信的轻骑与楚军死士正共同抬着巨型弩车，车身上烙着秦始皇时期的龙纹。范增突然用血指在石壁画出咸阳地图：「章邯的兵马俑军营就在地下三十丈，而刘邦的火药正从泗'
2025-09-26 01:57:09 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=750 预览='{\n  "text": "赝玺坠地的脆响惊醒了沉寂的夜，章邯的追兵果然如潮水般涌向发光的玉匣。你趁机率残部遁入彭城地底，却在暗河密道中撞见诡异一幕——韩信的轻骑与楚军死士正共同抬着巨型弩车，车身上烙着秦始皇时期的龙纹。范增突然用血指在石壁画出咸阳地图：「章邯的兵马俑军营就在地下三十丈，而刘邦的火药正从泗水港运来！」暗河'
2025-09-26 01:57:09 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=750 预览='{\n  "text": "赝玺坠地的脆响惊醒了沉寂的夜，章邯的追兵果然如潮水般涌向发光的玉匣。你趁机率残部遁入彭城地底，却在暗河密道中撞见诡异一幕——韩信的轻骑与楚军死士正共同抬着巨型弩车，车身上烙着秦始皇时期的龙纹。范增突然用血指在石壁画出咸阳地图：「章邯的兵马俑军营就在地下三十丈，而刘邦的火药正从泗水港运来！」暗河深处传来机械转动声，八千江东子弟的刀剑映出地宫深处若隐若现的青铜巨门。",\n  '
2025-09-26 01:57:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 182
2025-09-26 01:57:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:57:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:57:09 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:09 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=217 parent=212 choice='释放玉玺赝品引开追兵'
2025-09-26 01:57:09 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=217 depth=1
2025-09-26 01:57:09 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=217 completed, triggered next level depth=1
2025-09-26 01:57:17 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2871
2025-09-26 01:57:17 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=770 预览='\n\n```json\n{\n  "text": "降卒们撕开血肉模糊的锁链，将钟离昧五花大绑推上高台。你亲卫刚要斩下人头，却见秦军阵中走出个跛足老卒——正是咸阳城破时失踪的库吏！他嘶吼着扑向钟离昧：\'你烧我妻儿于粮仓！\'乱刀之下，钟离昧的义肢飞出三丈，砸碎了范增的青铜酒樽。地底突然传来震耳欲聋的击缶声，章邯的秦军残部从咸阳地宫涌出，他们举着的火把拼成\'楚逆\'二字。范增的战马被乱刀砍翻，老将却诡异地笑了：\'好个诈降之计，可惜项王早有准备——\'话音未落，你发现彭城方向的狼烟竟化作\'范\'字形状。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "op'
2025-09-26 01:57:17 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=768 预览='```json\n{\n  "text": "降卒们撕开血肉模糊的锁链，将钟离昧五花大绑推上高台。你亲卫刚要斩下人头，却见秦军阵中走出个跛足老卒——正是咸阳城破时失踪的库吏！他嘶吼着扑向钟离昧：\'你烧我妻儿于粮仓！\'乱刀之下，钟离昧的义肢飞出三丈，砸碎了范增的青铜酒樽。地底突然传来震耳欲聋的击缶声，章邯的秦军残部从咸阳地宫'
2025-09-26 01:57:17 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=756 预览='{\n  "text": "降卒们撕开血肉模糊的锁链，将钟离昧五花大绑推上高台。你亲卫刚要斩下人头，却见秦军阵中走出个跛足老卒——正是咸阳城破时失踪的库吏！他嘶吼着扑向钟离昧：\'你烧我妻儿于粮仓！\'乱刀之下，钟离昧的义肢飞出三丈，砸碎了范增的青铜酒樽。地底突然传来震耳欲聋的击缶声，章邯的秦军残部从咸阳地宫涌出，他们举着的'
2025-09-26 01:57:17 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=756 预览='{\n  "text": "降卒们撕开血肉模糊的锁链，将钟离昧五花大绑推上高台。你亲卫刚要斩下人头，却见秦军阵中走出个跛足老卒——正是咸阳城破时失踪的库吏！他嘶吼着扑向钟离昧：\'你烧我妻儿于粮仓！\'乱刀之下，钟离昧的义肢飞出三丈，砸碎了范增的青铜酒樽。地底突然传来震耳欲聋的击缶声，章邯的秦军残部从咸阳地宫涌出，他们举着的火把拼成\'楚逆\'二字。范增的战马被乱刀砍翻，老将却诡异地笑了：\'好个诈降之计，可'
2025-09-26 01:57:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 222
2025-09-26 01:57:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:57:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:57:17 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:17 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=218 parent=211 choice='立即将钟离昧献给降卒'
2025-09-26 01:57:17 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=218 depth=1
2025-09-26 01:57:17 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=218 completed, triggered next level depth=1
2025-09-26 01:57:17 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2923
2025-09-26 01:57:17 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=783 预览='\n\n```json\n{\n  "text": "火药库的轰鸣撕裂夜空，彭城烽火台在烈焰中坍塌成焦黑骨架。你左手拽着昏迷的范增，右臂缠着染透战袍的伤口，亲眼看着韩信的轻骑被气浪掀飞如枯叶。但欢呼尚未出口，东侧山道突然亮起千盏火把——刘邦亲率的五万汉军主力踏碎冰河而来！更令人窒息的是，你从范增破碎的贴身锦囊中抖出半幅密图，赫然显露出楚军各郡暗桩的分布，收信人印章赫然是\'项伯亲启\'。八百亲卫的剑锋在你身后悄然转向，而北方地平线浮现出章邯的黑甲骑兵，他们举着的竟全是楚军残旗。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "斩杀'
2025-09-26 01:57:17 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=781 预览='```json\n{\n  "text": "火药库的轰鸣撕裂夜空，彭城烽火台在烈焰中坍塌成焦黑骨架。你左手拽着昏迷的范增，右臂缠着染透战袍的伤口，亲眼看着韩信的轻骑被气浪掀飞如枯叶。但欢呼尚未出口，东侧山道突然亮起千盏火把——刘邦亲率的五万汉军主力踏碎冰河而来！更令人窒息的是，你从范增破碎的贴身锦囊中抖出半幅密图，赫然显'
2025-09-26 01:57:17 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=769 预览='{\n  "text": "火药库的轰鸣撕裂夜空，彭城烽火台在烈焰中坍塌成焦黑骨架。你左手拽着昏迷的范增，右臂缠着染透战袍的伤口，亲眼看着韩信的轻骑被气浪掀飞如枯叶。但欢呼尚未出口，东侧山道突然亮起千盏火把——刘邦亲率的五万汉军主力踏碎冰河而来！更令人窒息的是，你从范增破碎的贴身锦囊中抖出半幅密图，赫然显露出楚军各郡暗桩'
2025-09-26 01:57:17 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=769 预览='{\n  "text": "火药库的轰鸣撕裂夜空，彭城烽火台在烈焰中坍塌成焦黑骨架。你左手拽着昏迷的范增，右臂缠着染透战袍的伤口，亲眼看着韩信的轻骑被气浪掀飞如枯叶。但欢呼尚未出口，东侧山道突然亮起千盏火把——刘邦亲率的五万汉军主力踏碎冰河而来！更令人窒息的是，你从范增破碎的贴身锦囊中抖出半幅密图，赫然显露出楚军各郡暗桩的分布，收信人印章赫然是\'项伯亲启\'。八百亲卫的剑锋在你身后悄然转向，而北方地平'
2025-09-26 01:57:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 212
2025-09-26 01:57:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:57:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:57:17 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:17 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=219 parent=212 choice='点燃火药库与敌同归于尽'
2025-09-26 01:57:17 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=219 depth=1
2025-09-26 01:57:17 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=219 completed, triggered next level depth=1
2025-09-26 01:57:21 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2652
2025-09-26 01:57:21 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=746 预览='\n\n```json\n{\n  "text": "彭城地牢的铁门在烈焰中崩塌时，两千楚军降卒的嘶吼震落梁上积尘。你割断锁链的瞬间，却发现多数俘虏脖颈都刻着诡异的秦篆图腾——与咸阳地陷机关触发器上的纹路完全一致。更可怕的是，当降卒们涌向城门时，暗巷突然涌出数百黑衣死士，他们手持的并非刀剑，而是浸泡火油的竹简，上面赫然记载着楚军各营布防图。范增的尸体从地牢深处浮出水面，他空洞的眼眶中插着半截刻有\'汉\'字的铜钉。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "屠城震慑",\n      "summary": "以降卒为饵诱出幕后'
2025-09-26 01:57:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=744 预览='```json\n{\n  "text": "彭城地牢的铁门在烈焰中崩塌时，两千楚军降卒的嘶吼震落梁上积尘。你割断锁链的瞬间，却发现多数俘虏脖颈都刻着诡异的秦篆图腾——与咸阳地陷机关触发器上的纹路完全一致。更可怕的是，当降卒们涌向城门时，暗巷突然涌出数百黑衣死士，他们手持的并非刀剑，而是浸泡火油的竹简，上面赫然记载着楚军各'
2025-09-26 01:57:21 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=732 预览='{\n  "text": "彭城地牢的铁门在烈焰中崩塌时，两千楚军降卒的嘶吼震落梁上积尘。你割断锁链的瞬间，却发现多数俘虏脖颈都刻着诡异的秦篆图腾——与咸阳地陷机关触发器上的纹路完全一致。更可怕的是，当降卒们涌向城门时，暗巷突然涌出数百黑衣死士，他们手持的并非刀剑，而是浸泡火油的竹简，上面赫然记载着楚军各营布防图。范增的'
2025-09-26 01:57:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=732 预览='{\n  "text": "彭城地牢的铁门在烈焰中崩塌时，两千楚军降卒的嘶吼震落梁上积尘。你割断锁链的瞬间，却发现多数俘虏脖颈都刻着诡异的秦篆图腾——与咸阳地陷机关触发器上的纹路完全一致。更可怕的是，当降卒们涌向城门时，暗巷突然涌出数百黑衣死士，他们手持的并非刀剑，而是浸泡火油的竹简，上面赫然记载着楚军各营布防图。范增的尸体从地牢深处浮出水面，他空洞的眼眶中插着半截刻有\'汉\'字的铜钉。",\n  "s'
2025-09-26 01:57:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 180
2025-09-26 01:57:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 01:57:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 01:57:21 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:21 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=220 parent=213 choice='突袭彭城地牢解救降卒'
2025-09-26 01:57:21 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=220 depth=1
2025-09-26 01:57:21 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=220 completed, triggered next level depth=1
2025-09-26 01:57:22 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2692
2025-09-26 01:57:22 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=767 预览='\n\n```json\n{\n  "text": "烈火焚尽机关残骸，范增的人头悬于咸阳城门时，你听见八千子弟兵的欢呼震落宫墙积雪。但那密信上\'彭城两千楚卒\'的字样，却在夜风中化作无数利刃——韩信的轻骑突然撕碎\'楚汉共主\'旌旗，将刘邦使者血淋淋的尸首抛至你马前。更令人窒息的是，章邯溃兵竟在咸阳地底挖出秦始皇陵的青铜水道图，水流中浮出的累累白骨，赫然穿着楚军旧甲。彭城方向的烽火彻夜不息，而你帐中谋士的面色，比咸阳冬雪更白。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "率军直捣彭城地牢",\n      "summary": '
2025-09-26 01:57:22 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=765 预览='```json\n{\n  "text": "烈火焚尽机关残骸，范增的人头悬于咸阳城门时，你听见八千子弟兵的欢呼震落宫墙积雪。但那密信上\'彭城两千楚卒\'的字样，却在夜风中化作无数利刃——韩信的轻骑突然撕碎\'楚汉共主\'旌旗，将刘邦使者血淋淋的尸首抛至你马前。更令人窒息的是，章邯溃兵竟在咸阳地底挖出秦始皇陵的青铜水道图，水流中'
2025-09-26 01:57:22 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=753 预览='{\n  "text": "烈火焚尽机关残骸，范增的人头悬于咸阳城门时，你听见八千子弟兵的欢呼震落宫墙积雪。但那密信上\'彭城两千楚卒\'的字样，却在夜风中化作无数利刃——韩信的轻骑突然撕碎\'楚汉共主\'旌旗，将刘邦使者血淋淋的尸首抛至你马前。更令人窒息的是，章邯溃兵竟在咸阳地底挖出秦始皇陵的青铜水道图，水流中浮出的累累白骨，'
2025-09-26 01:57:22 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=753 预览='{\n  "text": "烈火焚尽机关残骸，范增的人头悬于咸阳城门时，你听见八千子弟兵的欢呼震落宫墙积雪。但那密信上\'彭城两千楚卒\'的字样，却在夜风中化作无数利刃——韩信的轻骑突然撕碎\'楚汉共主\'旌旗，将刘邦使者血淋淋的尸首抛至你马前。更令人窒息的是，章邯溃兵竟在咸阳地底挖出秦始皇陵的青铜水道图，水流中浮出的累累白骨，赫然穿着楚军旧甲。彭城方向的烽火彻夜不息，而你帐中谋士的面色，比咸阳冬雪更白。"'
2025-09-26 01:57:22 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 186
2025-09-26 01:57:22 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:22 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:57:22 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:57:22 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:22 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=221 parent=213 choice='当众处决范增并公开密信'
2025-09-26 01:57:22 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=221 depth=1
2025-09-26 01:57:22 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=221 completed, triggered next level depth=1
2025-09-26 01:57:24 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2809
2025-09-26 01:57:24 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=743 预览='\n\n```json\n{\n  "text": "韩信的帅旗在咸阳城头与楚军赤旗并立，你与他共饮渭水浊酒时，他的指尖正摩挲着玉玺赝品的裂痕。\'楚军可愿让出汉中三郡？\'他忽然将酒盏重重砸向地图，震得\'秦\'字疆界图腾簌簌作响。就在此刻，彭城急报如黑鹰掠过宴厅——两千楚军降卒暴动，举着刘邦新铸的\'汉王符节\'冲破牢狱！范增的杖尖突然挑开你战靴下的地砖，露出半截染血的竹简，上面赫然是章邯与韩信往来的密约残章。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "火烧彭城地牢逼反韩信",\n      "summary": "以暴制暴震慑盟'
2025-09-26 01:57:24 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=741 预览='```json\n{\n  "text": "韩信的帅旗在咸阳城头与楚军赤旗并立，你与他共饮渭水浊酒时，他的指尖正摩挲着玉玺赝品的裂痕。\'楚军可愿让出汉中三郡？\'他忽然将酒盏重重砸向地图，震得\'秦\'字疆界图腾簌簌作响。就在此刻，彭城急报如黑鹰掠过宴厅——两千楚军降卒暴动，举着刘邦新铸的\'汉王符节\'冲破牢狱！范增的杖尖突然挑'
2025-09-26 01:57:24 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=729 预览='{\n  "text": "韩信的帅旗在咸阳城头与楚军赤旗并立，你与他共饮渭水浊酒时，他的指尖正摩挲着玉玺赝品的裂痕。\'楚军可愿让出汉中三郡？\'他忽然将酒盏重重砸向地图，震得\'秦\'字疆界图腾簌簌作响。就在此刻，彭城急报如黑鹰掠过宴厅——两千楚军降卒暴动，举着刘邦新铸的\'汉王符节\'冲破牢狱！范增的杖尖突然挑开你战靴下的地砖'
2025-09-26 01:57:24 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=729 预览='{\n  "text": "韩信的帅旗在咸阳城头与楚军赤旗并立，你与他共饮渭水浊酒时，他的指尖正摩挲着玉玺赝品的裂痕。\'楚军可愿让出汉中三郡？\'他忽然将酒盏重重砸向地图，震得\'秦\'字疆界图腾簌簌作响。就在此刻，彭城急报如黑鹰掠过宴厅——两千楚军降卒暴动，举着刘邦新铸的\'汉王符节\'冲破牢狱！范增的杖尖突然挑开你战靴下的地砖，露出半截染血的竹简，上面赫然是章邯与韩信往来的密约残章。",\n  "succe'
2025-09-26 01:57:24 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 176
2025-09-26 01:57:24 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:57:24 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:57:24 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:57:24 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:57:24 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=222 parent=213 choice='假意与韩信结盟分割秦地'
2025-09-26 01:57:24 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=222 depth=1
2025-09-26 01:57:24 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=222 completed, triggered next level depth=1
2025-09-26 01:57:32 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 焚毁地陷机关触发装置
2025-09-26 01:58:04 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 当众处决范增并公开密信
2025-09-26 01:58:37 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 率军直捣彭城地牢
2025-09-26 01:58:37 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 率军直捣彭城地牢
2025-09-26 01:58:53 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3092
2025-09-26 01:58:53 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=737 预览='\n\n```json\n{\n  "text": "彭城地牢的铁门在烈焰中崩塌，八百亲卫的火把照亮了地底深渊。两千楚军降卒的锁链声戛然而止——他们竟齐刷刷跪拜你的玄色大纛！地牢深处传来铁甲摩擦声，一名披发左衽的胡人将领从暗门跃出，手中攥着半幅咸阳水文图：\'章邯以秦陵水道为饵，引楚军自相残杀！\'此时咸阳方向突然马蹄如雷，韩信的轻骑竟从地牢暗河逆流杀至，船头插着刘邦新赐的\'反楚诛暴\'金印。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "屠尽地牢囚徒",\n      "summary": "震慑叛徒并夺取水文图，但可能失去潜在盟'
2025-09-26 01:58:53 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=735 预览='```json\n{\n  "text": "彭城地牢的铁门在烈焰中崩塌，八百亲卫的火把照亮了地底深渊。两千楚军降卒的锁链声戛然而止——他们竟齐刷刷跪拜你的玄色大纛！地牢深处传来铁甲摩擦声，一名披发左衽的胡人将领从暗门跃出，手中攥着半幅咸阳水文图：\'章邯以秦陵水道为饵，引楚军自相残杀！\'此时咸阳方向突然马蹄如雷，韩信的轻骑'
2025-09-26 01:58:53 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=723 预览='{\n  "text": "彭城地牢的铁门在烈焰中崩塌，八百亲卫的火把照亮了地底深渊。两千楚军降卒的锁链声戛然而止——他们竟齐刷刷跪拜你的玄色大纛！地牢深处传来铁甲摩擦声，一名披发左衽的胡人将领从暗门跃出，手中攥着半幅咸阳水文图：\'章邯以秦陵水道为饵，引楚军自相残杀！\'此时咸阳方向突然马蹄如雷，韩信的轻骑竟从地牢暗河逆流'
2025-09-26 01:58:53 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=723 预览='{\n  "text": "彭城地牢的铁门在烈焰中崩塌，八百亲卫的火把照亮了地底深渊。两千楚军降卒的锁链声戛然而止——他们竟齐刷刷跪拜你的玄色大纛！地牢深处传来铁甲摩擦声，一名披发左衽的胡人将领从暗门跃出，手中攥着半幅咸阳水文图：\'章邯以秦陵水道为饵，引楚军自相残杀！\'此时咸阳方向突然马蹄如雷，韩信的轻骑竟从地牢暗河逆流杀至，船头插着刘邦新赐的\'反楚诛暴\'金印。",\n  "success_rate"'
2025-09-26 01:58:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 168
2025-09-26 01:58:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:58:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:58:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:58:53 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:58:53 | INFO     | api.story:continue_existing_story:439 - 故事继续生成成功
2025-09-26 01:58:53 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=223 depth=3
2025-09-26 01:58:53 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=223
2025-09-26 01:58:53 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 屠尽地牢囚徒
2025-09-26 01:58:53 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与降卒结盟
2025-09-26 01:58:53 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 追查胡人将领
2025-09-26 01:59:08 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3131
2025-09-26 01:59:08 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=752 预览='\n\n```json\n{\n  "text": "地牢暗河的腥臭中，胡人将领的弯刀劈开火把光影，水文图上的秦陵暗道直指彭城城心。你勒马于崩塌的囚笼之上，两千楚卒的镣铐在暗流中叮当作响——他们脖颈皆刻着\'咸阳工匠\'印记。韩信的金印在河面漂浮，而胡将嘶吼着用楚地方言：\'章邯买通了咸阳铸币匠！\'此刻彭城外城墙突然震动，地底传来铁甲碾压青砖的轰鸣，城内酒肆却飘出熟悉的江东小调。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "掘开彭城地脉直捣章邯老巢",\n      "summary": "利用水文图炸毁城基，但可能引发秦陵殉葬机'
2025-09-26 01:59:08 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=750 预览='```json\n{\n  "text": "地牢暗河的腥臭中，胡人将领的弯刀劈开火把光影，水文图上的秦陵暗道直指彭城城心。你勒马于崩塌的囚笼之上，两千楚卒的镣铐在暗流中叮当作响——他们脖颈皆刻着\'咸阳工匠\'印记。韩信的金印在河面漂浮，而胡将嘶吼着用楚地方言：\'章邯买通了咸阳铸币匠！\'此刻彭城外城墙突然震动，地底传来铁甲碾'
2025-09-26 01:59:08 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=738 预览='{\n  "text": "地牢暗河的腥臭中，胡人将领的弯刀劈开火把光影，水文图上的秦陵暗道直指彭城城心。你勒马于崩塌的囚笼之上，两千楚卒的镣铐在暗流中叮当作响——他们脖颈皆刻着\'咸阳工匠\'印记。韩信的金印在河面漂浮，而胡将嘶吼着用楚地方言：\'章邯买通了咸阳铸币匠！\'此刻彭城外城墙突然震动，地底传来铁甲碾压青砖的轰鸣，城'
2025-09-26 01:59:08 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=738 预览='{\n  "text": "地牢暗河的腥臭中，胡人将领的弯刀劈开火把光影，水文图上的秦陵暗道直指彭城城心。你勒马于崩塌的囚笼之上，两千楚卒的镣铐在暗流中叮当作响——他们脖颈皆刻着\'咸阳工匠\'印记。韩信的金印在河面漂浮，而胡将嘶吼着用楚地方言：\'章邯买通了咸阳铸币匠！\'此刻彭城外城墙突然震动，地底传来铁甲碾压青砖的轰鸣，城内酒肆却飘出熟悉的江东小调。",\n  "success_rate": 68,\n '
2025-09-26 01:59:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 161
2025-09-26 01:59:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 01:59:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 01:59:08 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:08 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=224 parent=223 choice='追查胡人将领'
2025-09-26 01:59:08 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=224 depth=2
2025-09-26 01:59:08 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=224 completed, triggered next level depth=2
2025-09-26 01:59:08 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=224
2025-09-26 01:59:08 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 掘开彭城地脉直捣章邯老巢
2025-09-26 01:59:08 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 招降胡将并收编工匠
2025-09-26 01:59:08 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 突袭酒肆截获刘邦密使
2025-09-26 01:59:09 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3247
2025-09-26 01:59:09 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=776 预览='\n\n```json\n{\n  "text": "彭城地牢的铁链声尚未消散，两千楚卒的血红披风已裹挟着八千江东子弟的怒吼。降卒领袖项悍单膝跪地，却在你身后暗捏剑柄——他的刀鞘里藏着半幅咸阳水文图。韩信的斥候突然从彭城西市窜出，马蹄踏碎结冰的护城河，船队载着\'诛暴\'金印逆流而上。更诡异的是，章邯的残部竟从秦陵地宫中挖出七百具楚军尸首，每具胸甲都刻着\'范增亲卫\'的铭文。范增的首级在咸阳城头忽明忽暗，而你亲卫军中，已有三名老兵在深夜的篝火旁离奇失踪。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "以降卒为前锋突袭刘邦粮道",\n'
2025-09-26 01:59:09 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=774 预览='```json\n{\n  "text": "彭城地牢的铁链声尚未消散，两千楚卒的血红披风已裹挟着八千江东子弟的怒吼。降卒领袖项悍单膝跪地，却在你身后暗捏剑柄——他的刀鞘里藏着半幅咸阳水文图。韩信的斥候突然从彭城西市窜出，马蹄踏碎结冰的护城河，船队载着\'诛暴\'金印逆流而上。更诡异的是，章邯的残部竟从秦陵地宫中挖出七百具楚军'
2025-09-26 01:59:09 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=762 预览='{\n  "text": "彭城地牢的铁链声尚未消散，两千楚卒的血红披风已裹挟着八千江东子弟的怒吼。降卒领袖项悍单膝跪地，却在你身后暗捏剑柄——他的刀鞘里藏着半幅咸阳水文图。韩信的斥候突然从彭城西市窜出，马蹄踏碎结冰的护城河，船队载着\'诛暴\'金印逆流而上。更诡异的是，章邯的残部竟从秦陵地宫中挖出七百具楚军尸首，每具胸甲都'
2025-09-26 01:59:09 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=762 预览='{\n  "text": "彭城地牢的铁链声尚未消散，两千楚卒的血红披风已裹挟着八千江东子弟的怒吼。降卒领袖项悍单膝跪地，却在你身后暗捏剑柄——他的刀鞘里藏着半幅咸阳水文图。韩信的斥候突然从彭城西市窜出，马蹄踏碎结冰的护城河，船队载着\'诛暴\'金印逆流而上。更诡异的是，章邯的残部竟从秦陵地宫中挖出七百具楚军尸首，每具胸甲都刻着\'范增亲卫\'的铭文。范增的首级在咸阳城头忽明忽暗，而你亲卫军中，已有三名老兵'
2025-09-26 01:59:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 199
2025-09-26 01:59:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:59:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:59:09 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:09 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=225 parent=223 choice='与降卒结盟'
2025-09-26 01:59:09 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=225 depth=2
2025-09-26 01:59:09 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=225 completed, triggered next level depth=2
2025-09-26 01:59:09 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=225
2025-09-26 01:59:09 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 以降卒为前锋突袭刘邦粮道
2025-09-26 01:59:09 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与降卒领袖结拜为兄弟
2025-09-26 01:59:10 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 处决可疑老兵并公开尸首铭文
2025-09-26 01:59:20 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3683
2025-09-26 01:59:20 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=781 预览='\n\n```json\n{\n  "text": "血雾漫过彭城地牢的台阶，两千楚军降卒的哀嚎被刀锋斩断。但当你的亲卫拖出最后一具尸体时，铁链突然崩裂——项梁旧部的佩剑竟从尸堆中刺出！那名披发左衽的胡将手持半幅水文图，嘶吼着\'章邯已控秦陵暗河\'，而咸阳方向骤然马蹄如雷，韩信的轻骑竟从地牢暗河逆流杀至，船头金印在血光中映出\'反楚诛暴\'四字。更令人窒息的是，八千江东子弟的战马突然集体跪地，马鞍暗格中滚出刘邦密令：所有楚军战马皆被喂食过秦陵地脉毒草！",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁彭城地牢与水文图",\n   '
2025-09-26 01:59:20 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=779 预览='```json\n{\n  "text": "血雾漫过彭城地牢的台阶，两千楚军降卒的哀嚎被刀锋斩断。但当你的亲卫拖出最后一具尸体时，铁链突然崩裂——项梁旧部的佩剑竟从尸堆中刺出！那名披发左衽的胡将手持半幅水文图，嘶吼着\'章邯已控秦陵暗河\'，而咸阳方向骤然马蹄如雷，韩信的轻骑竟从地牢暗河逆流杀至，船头金印在血光中映出\'反楚诛'
2025-09-26 01:59:20 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=767 预览='{\n  "text": "血雾漫过彭城地牢的台阶，两千楚军降卒的哀嚎被刀锋斩断。但当你的亲卫拖出最后一具尸体时，铁链突然崩裂——项梁旧部的佩剑竟从尸堆中刺出！那名披发左衽的胡将手持半幅水文图，嘶吼着\'章邯已控秦陵暗河\'，而咸阳方向骤然马蹄如雷，韩信的轻骑竟从地牢暗河逆流杀至，船头金印在血光中映出\'反楚诛暴\'四字。更令人'
2025-09-26 01:59:20 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=767 预览='{\n  "text": "血雾漫过彭城地牢的台阶，两千楚军降卒的哀嚎被刀锋斩断。但当你的亲卫拖出最后一具尸体时，铁链突然崩裂——项梁旧部的佩剑竟从尸堆中刺出！那名披发左衽的胡将手持半幅水文图，嘶吼着\'章邯已控秦陵暗河\'，而咸阳方向骤然马蹄如雷，韩信的轻骑竟从地牢暗河逆流杀至，船头金印在血光中映出\'反楚诛暴\'四字。更令人窒息的是，八千江东子弟的战马突然集体跪地，马鞍暗格中滚出刘邦密令：所有楚军战马皆'
2025-09-26 01:59:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-26 01:59:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:59:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:59:20 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:20 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=226 parent=223 choice='屠尽地牢囚徒'
2025-09-26 01:59:20 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=226 depth=2
2025-09-26 01:59:20 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=226 completed, triggered next level depth=2
2025-09-26 01:59:20 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=226
2025-09-26 01:59:20 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 焚毁彭城地牢与水文图
2025-09-26 01:59:20 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 与韩信使者当面对质
2025-09-26 01:59:20 | INFO     | core.story_engine:continue_story:278 - 继续故事，用户选择: 秘密替换战马饲料
2025-09-26 01:59:21 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3097
2025-09-26 01:59:21 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=745 预览='\n\n```json\n{\n  "text": "胡将单于烈在铁链束缚下献上咸阳水文全图，两千工匠的镣铐声却暗藏诡异节奏。你勒马于彭城地牢深处，突然发现所有工匠颈间\'咸阳工匠\'印记皆新刻未褪——章邯早已将秦卒伪装成工匠潜伏楚境！韩信的密信随暗河漂至你掌心：\'今夜月圆，水道倒灌\'。地牢外忽传号角，彭城守军竟以楚军暗号回应，而单于烈的弯刀在火把下映出与章邯战车相同的饕餮纹。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "突袭咸阳水道总控",\n      "summary": "利用水文图先发制人，但需穿越秦军旧部埋伏区",\n'
2025-09-26 01:59:21 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=743 预览='```json\n{\n  "text": "胡将单于烈在铁链束缚下献上咸阳水文全图，两千工匠的镣铐声却暗藏诡异节奏。你勒马于彭城地牢深处，突然发现所有工匠颈间\'咸阳工匠\'印记皆新刻未褪——章邯早已将秦卒伪装成工匠潜伏楚境！韩信的密信随暗河漂至你掌心：\'今夜月圆，水道倒灌\'。地牢外忽传号角，彭城守军竟以楚军暗号回应，而单于'
2025-09-26 01:59:21 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=731 预览='{\n  "text": "胡将单于烈在铁链束缚下献上咸阳水文全图，两千工匠的镣铐声却暗藏诡异节奏。你勒马于彭城地牢深处，突然发现所有工匠颈间\'咸阳工匠\'印记皆新刻未褪——章邯早已将秦卒伪装成工匠潜伏楚境！韩信的密信随暗河漂至你掌心：\'今夜月圆，水道倒灌\'。地牢外忽传号角，彭城守军竟以楚军暗号回应，而单于烈的弯刀在火把下'
2025-09-26 01:59:21 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=731 预览='{\n  "text": "胡将单于烈在铁链束缚下献上咸阳水文全图，两千工匠的镣铐声却暗藏诡异节奏。你勒马于彭城地牢深处，突然发现所有工匠颈间\'咸阳工匠\'印记皆新刻未褪——章邯早已将秦卒伪装成工匠潜伏楚境！韩信的密信随暗河漂至你掌心：\'今夜月圆，水道倒灌\'。地牢外忽传号角，彭城守军竟以楚军暗号回应，而单于烈的弯刀在火把下映出与章邯战车相同的饕餮纹。",\n  "success_rate": 68,\n '
2025-09-26 01:59:21 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 161
2025-09-26 01:59:21 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:21 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:59:21 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:59:21 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:21 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=227 parent=224 choice='招降胡将并收编工匠'
2025-09-26 01:59:21 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=227 depth=1
2025-09-26 01:59:21 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=227 completed, triggered next level depth=1
2025-09-26 01:59:21 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=47 node=227
2025-09-26 01:59:23 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3256
2025-09-26 01:59:23 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=789 预览='\n\n```json\n{\n  "text": "彭城地牢的血雾尚未散尽，处决台上三具老兵尸体胸甲上的\'范增亲卫\'铭文在火把下猩红如血。八千江东子弟的欢呼转瞬凝固——你瞥见降卒阵中有人在模仿章邯溃兵的诡异手势。韩信的密信突然从处决台暗格滑出，羊皮纸上赫然绘着咸阳水道与彭城地牢相连的立体舆图。更令人胆寒的是，章邯的残部正用楚军旧语传唱着\'范增未死，水下为王\'的歌谣，而范增的首级在咸阳城头竟渗出黑色黏液，顺着城墙裂缝蜿蜒如活物。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁彭城地牢并追剿可疑降卒",\n      "su'
2025-09-26 01:59:23 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=787 预览='```json\n{\n  "text": "彭城地牢的血雾尚未散尽，处决台上三具老兵尸体胸甲上的\'范增亲卫\'铭文在火把下猩红如血。八千江东子弟的欢呼转瞬凝固——你瞥见降卒阵中有人在模仿章邯溃兵的诡异手势。韩信的密信突然从处决台暗格滑出，羊皮纸上赫然绘着咸阳水道与彭城地牢相连的立体舆图。更令人胆寒的是，章邯的残部正用楚军旧'
2025-09-26 01:59:23 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=775 预览='{\n  "text": "彭城地牢的血雾尚未散尽，处决台上三具老兵尸体胸甲上的\'范增亲卫\'铭文在火把下猩红如血。八千江东子弟的欢呼转瞬凝固——你瞥见降卒阵中有人在模仿章邯溃兵的诡异手势。韩信的密信突然从处决台暗格滑出，羊皮纸上赫然绘着咸阳水道与彭城地牢相连的立体舆图。更令人胆寒的是，章邯的残部正用楚军旧语传唱着\'范增未'
2025-09-26 01:59:23 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=775 预览='{\n  "text": "彭城地牢的血雾尚未散尽，处决台上三具老兵尸体胸甲上的\'范增亲卫\'铭文在火把下猩红如血。八千江东子弟的欢呼转瞬凝固——你瞥见降卒阵中有人在模仿章邯溃兵的诡异手势。韩信的密信突然从处决台暗格滑出，羊皮纸上赫然绘着咸阳水道与彭城地牢相连的立体舆图。更令人胆寒的是，章邯的残部正用楚军旧语传唱着\'范增未死，水下为王\'的歌谣，而范增的首级在咸阳城头竟渗出黑色黏液，顺着城墙裂缝蜿蜒如活'
2025-09-26 01:59:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 189
2025-09-26 01:59:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:59:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:59:23 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:23 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=228 parent=225 choice='处决可疑老兵并公开尸首铭文'
2025-09-26 01:59:23 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=228 depth=1
2025-09-26 01:59:23 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=228 completed, triggered next level depth=1
2025-09-26 01:59:25 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3081
2025-09-26 01:59:25 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=747 预览='\n\n```json\n{\n  "text": "酒肆地窖的腐木气息中，刘邦密使的竹简在火把下曝露真容——竟是一份《楚军工匠叛乱图册》，图中标明彭城城垣的火药暗道直通项羽行宫。当你的亲卫拖出浑身酒渍的密使时，那人口中嘶吼的\'咸阳铸币匠\'突然化作青烟，铜制人面在火焰中崩裂，露出内藏的秦半两钱。更诡异的是，城外突然擂响的战鼓竟与地牢暗河的水声同频，两千楚卒的镣铐声从四面城墙下隐约传来。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁彭城城墙逼反乱党",\n      "summary": "以火攻暴露地下通道，但可能误伤无'
2025-09-26 01:59:25 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=745 预览='```json\n{\n  "text": "酒肆地窖的腐木气息中，刘邦密使的竹简在火把下曝露真容——竟是一份《楚军工匠叛乱图册》，图中标明彭城城垣的火药暗道直通项羽行宫。当你的亲卫拖出浑身酒渍的密使时，那人口中嘶吼的\'咸阳铸币匠\'突然化作青烟，铜制人面在火焰中崩裂，露出内藏的秦半两钱。更诡异的是，城外突然擂响的战鼓竟与地'
2025-09-26 01:59:25 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=733 预览='{\n  "text": "酒肆地窖的腐木气息中，刘邦密使的竹简在火把下曝露真容——竟是一份《楚军工匠叛乱图册》，图中标明彭城城垣的火药暗道直通项羽行宫。当你的亲卫拖出浑身酒渍的密使时，那人口中嘶吼的\'咸阳铸币匠\'突然化作青烟，铜制人面在火焰中崩裂，露出内藏的秦半两钱。更诡异的是，城外突然擂响的战鼓竟与地牢暗河的水声同频'
2025-09-26 01:59:25 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=733 预览='{\n  "text": "酒肆地窖的腐木气息中，刘邦密使的竹简在火把下曝露真容——竟是一份《楚军工匠叛乱图册》，图中标明彭城城垣的火药暗道直通项羽行宫。当你的亲卫拖出浑身酒渍的密使时，那人口中嘶吼的\'咸阳铸币匠\'突然化作青烟，铜制人面在火焰中崩裂，露出内藏的秦半两钱。更诡异的是，城外突然擂响的战鼓竟与地牢暗河的水声同频，两千楚卒的镣铐声从四面城墙下隐约传来。",\n  "success_rate":'
2025-09-26 01:59:25 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 167
2025-09-26 01:59:25 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:25 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:59:25 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:59:25 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:25 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=229 parent=224 choice='突袭酒肆截获刘邦密使'
2025-09-26 01:59:25 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=229 depth=1
2025-09-26 01:59:25 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=229 completed, triggered next level depth=1
2025-09-26 01:59:29 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3532
2025-09-26 01:59:29 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=748 预览='\n\n```json\n{\n  "text": "酒坛摔碎在彭城地牢的青砖上，你与降卒领袖项悍以血为盟时，八千江东子弟的欢呼震落了地牢穹顶的积尘。但项悍的佩剑突然滑落——剑柄暗格中竟藏着半幅咸阳水文图，与章邯从秦陵挖出的\'范增亲卫\'铭文甲胄严丝合缝。韩信的轻骑恰在此时突袭彭城西市，船队载着刘邦新赐的\'诛暴\'金印逆流而上，而你亲卫中失踪的老兵，此刻正举着火把从地牢暗河涌出，铠甲上沾满范增旧部的血迹。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "突袭韩信船队",\n      "summary": "以降卒为饵引出幕后黑手，'
2025-09-26 01:59:29 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=746 预览='```json\n{\n  "text": "酒坛摔碎在彭城地牢的青砖上，你与降卒领袖项悍以血为盟时，八千江东子弟的欢呼震落了地牢穹顶的积尘。但项悍的佩剑突然滑落——剑柄暗格中竟藏着半幅咸阳水文图，与章邯从秦陵挖出的\'范增亲卫\'铭文甲胄严丝合缝。韩信的轻骑恰在此时突袭彭城西市，船队载着刘邦新赐的\'诛暴\'金印逆流而上，而你亲'
2025-09-26 01:59:29 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=734 预览='{\n  "text": "酒坛摔碎在彭城地牢的青砖上，你与降卒领袖项悍以血为盟时，八千江东子弟的欢呼震落了地牢穹顶的积尘。但项悍的佩剑突然滑落——剑柄暗格中竟藏着半幅咸阳水文图，与章邯从秦陵挖出的\'范增亲卫\'铭文甲胄严丝合缝。韩信的轻骑恰在此时突袭彭城西市，船队载着刘邦新赐的\'诛暴\'金印逆流而上，而你亲卫中失踪的老兵，'
2025-09-26 01:59:29 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=734 预览='{\n  "text": "酒坛摔碎在彭城地牢的青砖上，你与降卒领袖项悍以血为盟时，八千江东子弟的欢呼震落了地牢穹顶的积尘。但项悍的佩剑突然滑落——剑柄暗格中竟藏着半幅咸阳水文图，与章邯从秦陵挖出的\'范增亲卫\'铭文甲胄严丝合缝。韩信的轻骑恰在此时突袭彭城西市，船队载着刘邦新赐的\'诛暴\'金印逆流而上，而你亲卫中失踪的老兵，此刻正举着火把从地牢暗河涌出，铠甲上沾满范增旧部的血迹。",\n  "succes'
2025-09-26 01:59:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 175
2025-09-26 01:59:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:59:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:59:29 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:29 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=230 parent=225 choice='与降卒领袖结拜为兄弟'
2025-09-26 01:59:29 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=230 depth=1
2025-09-26 01:59:29 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=230 completed, triggered next level depth=1
2025-09-26 01:59:30 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3298
2025-09-26 01:59:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=758 预览='\n\n```json\n{\n  "text": "降卒前锋的火把撕裂夜幕，三千楚军借着彭城粮道的薄雾突袭成功。可当你们劫获粮草时，韩信的轻骑竟从粮仓地窖涌出——那些\'楚卒\'的铠甲内衬，竟绣着咸阳布政司的暗纹！项悍在混战中被斩落的头盔下，露出章邯副将的面容。更致命的是，刘邦的告示正贴满粮道沿途：\'楚军食人肉充饥\'。八千江东子弟的篝火旁，开始有人低声传诵彭城地牢的楚卒\'皆是被范增毒杀的秦降卒\'。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "焚毁所有粮草断敌后路",\n      "summary": "以焦土战术迫使刘邦退兵'
2025-09-26 01:59:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=756 预览='```json\n{\n  "text": "降卒前锋的火把撕裂夜幕，三千楚军借着彭城粮道的薄雾突袭成功。可当你们劫获粮草时，韩信的轻骑竟从粮仓地窖涌出——那些\'楚卒\'的铠甲内衬，竟绣着咸阳布政司的暗纹！项悍在混战中被斩落的头盔下，露出章邯副将的面容。更致命的是，刘邦的告示正贴满粮道沿途：\'楚军食人肉充饥\'。八千江东子弟的'
2025-09-26 01:59:30 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=744 预览='{\n  "text": "降卒前锋的火把撕裂夜幕，三千楚军借着彭城粮道的薄雾突袭成功。可当你们劫获粮草时，韩信的轻骑竟从粮仓地窖涌出——那些\'楚卒\'的铠甲内衬，竟绣着咸阳布政司的暗纹！项悍在混战中被斩落的头盔下，露出章邯副将的面容。更致命的是，刘邦的告示正贴满粮道沿途：\'楚军食人肉充饥\'。八千江东子弟的篝火旁，开始有人'
2025-09-26 01:59:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=744 预览='{\n  "text": "降卒前锋的火把撕裂夜幕，三千楚军借着彭城粮道的薄雾突袭成功。可当你们劫获粮草时，韩信的轻骑竟从粮仓地窖涌出——那些\'楚卒\'的铠甲内衬，竟绣着咸阳布政司的暗纹！项悍在混战中被斩落的头盔下，露出章邯副将的面容。更致命的是，刘邦的告示正贴满粮道沿途：\'楚军食人肉充饥\'。八千江东子弟的篝火旁，开始有人低声传诵彭城地牢的楚卒\'皆是被范增毒杀的秦降卒\'。",\n  "success_r'
2025-09-26 01:59:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 172
2025-09-26 01:59:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 01:59:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 01:59:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:30 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=231 parent=225 choice='以降卒为前锋突袭刘邦粮道'
2025-09-26 01:59:30 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=231 depth=1
2025-09-26 01:59:30 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=231 completed, triggered next level depth=1
2025-09-26 01:59:30 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3310
2025-09-26 01:59:30 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=756 预览='\n\n```json\n{\n  "text": "彭城地脉崩裂的轰鸣声中，章邯的老巢显露出狰狞真容——地底竟藏着秦始皇陵的青铜水道核心！章邯本尊从水道祭坛现身，手持半卷《水衡都尉图籍》狂笑：\'楚军每掘一尺地脉，咸阳百万工匠的亡魂便多一尺骸骨！\'两千楚卒降兵的锁链突然齐声作响，他们脖颈的\'咸阳工匠\'印记渗出黑血，化作无数骷髅傀儡冲出地缝。城外黄河突然逆流，韩信的楼船舰队竟从水道暗门现身，船头悬挂的竟是项羽自己在巨鹿之战斩落的帅旗。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "点燃水道火药库引发地脉大爆",\n      "'
2025-09-26 01:59:30 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=754 预览='```json\n{\n  "text": "彭城地脉崩裂的轰鸣声中，章邯的老巢显露出狰狞真容——地底竟藏着秦始皇陵的青铜水道核心！章邯本尊从水道祭坛现身，手持半卷《水衡都尉图籍》狂笑：\'楚军每掘一尺地脉，咸阳百万工匠的亡魂便多一尺骸骨！\'两千楚卒降兵的锁链突然齐声作响，他们脖颈的\'咸阳工匠\'印记渗出黑血，化作无数骷髅傀儡'
2025-09-26 01:59:30 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=742 预览='{\n  "text": "彭城地脉崩裂的轰鸣声中，章邯的老巢显露出狰狞真容——地底竟藏着秦始皇陵的青铜水道核心！章邯本尊从水道祭坛现身，手持半卷《水衡都尉图籍》狂笑：\'楚军每掘一尺地脉，咸阳百万工匠的亡魂便多一尺骸骨！\'两千楚卒降兵的锁链突然齐声作响，他们脖颈的\'咸阳工匠\'印记渗出黑血，化作无数骷髅傀儡冲出地缝。城外黄'
2025-09-26 01:59:30 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=742 预览='{\n  "text": "彭城地脉崩裂的轰鸣声中，章邯的老巢显露出狰狞真容——地底竟藏着秦始皇陵的青铜水道核心！章邯本尊从水道祭坛现身，手持半卷《水衡都尉图籍》狂笑：\'楚军每掘一尺地脉，咸阳百万工匠的亡魂便多一尺骸骨！\'两千楚卒降兵的锁链突然齐声作响，他们脖颈的\'咸阳工匠\'印记渗出黑血，化作无数骷髅傀儡冲出地缝。城外黄河突然逆流，韩信的楼船舰队竟从水道暗门现身，船头悬挂的竟是项羽自己在巨鹿之战斩落'
2025-09-26 01:59:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 01:59:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:59:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:59:30 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:30 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=232 parent=224 choice='掘开彭城地脉直捣章邯老巢'
2025-09-26 01:59:30 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=232 depth=1
2025-09-26 01:59:30 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=232 completed, triggered next level depth=1
2025-09-26 01:59:36 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3241
2025-09-26 01:59:36 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=785 预览='\n\n```json\n{\n  "text": "战马嘶鸣声中，你亲卫将解毒草药混入饲料。当最后一匹玄甲战马昂首踏步时，咸阳方向突然传来地动山摇的轰鸣——秦陵暗河竟从地底冲破城墙！章邯的秦军水师乘着青铜战船破土而出，船首悬挂的竟是你亲手斩断的范增帅旗。更令人胆寒的是，两千楚军降卒的白骨从暗流中浮起，每具骸骨胸前都刻着\'楚反\'二字。彭城方向的夜空突然被火把点亮，韩信的轻骑正以\'护陵军\'名义封锁所有退路。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "率骑兵强行突破暗河防线",\n      "summary": "利用战马恢'
2025-09-26 01:59:36 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=783 预览='```json\n{\n  "text": "战马嘶鸣声中，你亲卫将解毒草药混入饲料。当最后一匹玄甲战马昂首踏步时，咸阳方向突然传来地动山摇的轰鸣——秦陵暗河竟从地底冲破城墙！章邯的秦军水师乘着青铜战船破土而出，船首悬挂的竟是你亲手斩断的范增帅旗。更令人胆寒的是，两千楚军降卒的白骨从暗流中浮起，每具骸骨胸前都刻着\'楚反\'二'
2025-09-26 01:59:36 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=771 预览='{\n  "text": "战马嘶鸣声中，你亲卫将解毒草药混入饲料。当最后一匹玄甲战马昂首踏步时，咸阳方向突然传来地动山摇的轰鸣——秦陵暗河竟从地底冲破城墙！章邯的秦军水师乘着青铜战船破土而出，船首悬挂的竟是你亲手斩断的范增帅旗。更令人胆寒的是，两千楚军降卒的白骨从暗流中浮起，每具骸骨胸前都刻着\'楚反\'二字。彭城方向的夜'
2025-09-26 01:59:36 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=771 预览='{\n  "text": "战马嘶鸣声中，你亲卫将解毒草药混入饲料。当最后一匹玄甲战马昂首踏步时，咸阳方向突然传来地动山摇的轰鸣——秦陵暗河竟从地底冲破城墙！章邯的秦军水师乘着青铜战船破土而出，船首悬挂的竟是你亲手斩断的范增帅旗。更令人胆寒的是，两千楚军降卒的白骨从暗流中浮起，每具骸骨胸前都刻着\'楚反\'二字。彭城方向的夜空突然被火把点亮，韩信的轻骑正以\'护陵军\'名义封锁所有退路。",\n  "succ'
2025-09-26 01:59:36 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 177
2025-09-26 01:59:36 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:36 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 01:59:36 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 01:59:36 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:36 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=233 parent=226 choice='秘密替换战马饲料'
2025-09-26 01:59:36 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=233 depth=1
2025-09-26 01:59:36 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=233 completed, triggered next level depth=1
2025-09-26 01:59:36 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 屠尽地牢囚徒
2025-09-26 01:59:37 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3280
2025-09-26 01:59:37 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=735 预览='\n\n```json\n{\n  "text": "韩信使者跪在彭城血池中央，青铜剑尖抵住他咽喉时，你嗅到他衣襟间残留的咸阳宫熏香。\'章邯死前剖腹藏信，密告秦陵地脉毒草源自沛县药商！\'使者突然爆笑，颈间暗格弹出半枚虎符——与你斩杀的刘邦密使所持完全吻合。八千江东子弟的刀锋在血雾中凝滞，远处传来彭越水军战船破冰的轰鸣，而咸阳方向的烽烟竟燃成\'楚王弑贤\'四字。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "斩杀使者后焚烧虎符",\n      "summary": "彻底斩断刘邦与韩信的暗线，但可能激化内部猜疑",\n      '
2025-09-26 01:59:37 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=733 预览='```json\n{\n  "text": "韩信使者跪在彭城血池中央，青铜剑尖抵住他咽喉时，你嗅到他衣襟间残留的咸阳宫熏香。\'章邯死前剖腹藏信，密告秦陵地脉毒草源自沛县药商！\'使者突然爆笑，颈间暗格弹出半枚虎符——与你斩杀的刘邦密使所持完全吻合。八千江东子弟的刀锋在血雾中凝滞，远处传来彭越水军战船破冰的轰鸣，而咸阳方向的'
2025-09-26 01:59:37 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=721 预览='{\n  "text": "韩信使者跪在彭城血池中央，青铜剑尖抵住他咽喉时，你嗅到他衣襟间残留的咸阳宫熏香。\'章邯死前剖腹藏信，密告秦陵地脉毒草源自沛县药商！\'使者突然爆笑，颈间暗格弹出半枚虎符——与你斩杀的刘邦密使所持完全吻合。八千江东子弟的刀锋在血雾中凝滞，远处传来彭越水军战船破冰的轰鸣，而咸阳方向的烽烟竟燃成\'楚王'
2025-09-26 01:59:37 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=721 预览='{\n  "text": "韩信使者跪在彭城血池中央，青铜剑尖抵住他咽喉时，你嗅到他衣襟间残留的咸阳宫熏香。\'章邯死前剖腹藏信，密告秦陵地脉毒草源自沛县药商！\'使者突然爆笑，颈间暗格弹出半枚虎符——与你斩杀的刘邦密使所持完全吻合。八千江东子弟的刀锋在血雾中凝滞，远处传来彭越水军战船破冰的轰鸣，而咸阳方向的烽烟竟燃成\'楚王弑贤\'四字。",\n  "success_rate": 68,\n  "choice'
2025-09-26 01:59:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 153
2025-09-26 01:59:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 01:59:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 01:59:37 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:37 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=234 parent=226 choice='与韩信使者当面对质'
2025-09-26 01:59:37 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=234 depth=1
2025-09-26 01:59:37 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=234 completed, triggered next level depth=1
2025-09-26 01:59:40 | INFO     | core.llm_clients:generate:257 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 3450
2025-09-26 01:59:40 | INFO     | core.story_engine:continue_story:296 - [LLM raw][continue] 长度=765 预览='\n\n```json\n{\n  "text": "彭城地牢的血雾尚未散尽，八千江东子弟的战马却突然齐声嘶鸣。你发现马鞍暗格中的刘邦密令，毒草已渗入马匹血脉——若不立即切断水源，三日之内全军将毒发身亡。咸阳方向的烽火骤然转为青色，章邯的残部竟驾着秦陵水道的青铜战船破城而入，船头悬着范增的首级与半幅未烧毁的水文图。更令人震怒的是，韩信的轻骑裹着楚军玄甲，正将两千名地牢死者的血衣悬挂在彭城城楼。",\n  "success_rate": 68,\n  "choices": [\n    {\n      "option": "率铁骑强渡秦陵暗河",\n      "summary": "利用水文图逆流直击章邯大营'
2025-09-26 01:59:40 | DEBUG    | core.story_engine:_extract_json:36 - [JSON] 原始长度=763 预览='```json\n{\n  "text": "彭城地牢的血雾尚未散尽，八千江东子弟的战马却突然齐声嘶鸣。你发现马鞍暗格中的刘邦密令，毒草已渗入马匹血脉——若不立即切断水源，三日之内全军将毒发身亡。咸阳方向的烽火骤然转为青色，章邯的残部竟驾着秦陵水道的青铜战船破城而入，船头悬着范增的首级与半幅未烧毁的水文图。更令人震怒的是，'
2025-09-26 01:59:40 | DEBUG    | core.story_engine:_extract_json:43 - [JSON] 捕获到Markdown代码围栏，内层长度=751 预览='{\n  "text": "彭城地牢的血雾尚未散尽，八千江东子弟的战马却突然齐声嘶鸣。你发现马鞍暗格中的刘邦密令，毒草已渗入马匹血脉——若不立即切断水源，三日之内全军将毒发身亡。咸阳方向的烽火骤然转为青色，章邯的残部竟驾着秦陵水道的青铜战船破城而入，船头悬着范增的首级与半幅未烧毁的水文图。更令人震怒的是，韩信的轻骑裹着楚'
2025-09-26 01:59:40 | INFO     | core.story_engine:_parse_llm_response:138 - [JSON] 提取后长度=751 预览='{\n  "text": "彭城地牢的血雾尚未散尽，八千江东子弟的战马却突然齐声嘶鸣。你发现马鞍暗格中的刘邦密令，毒草已渗入马匹血脉——若不立即切断水源，三日之内全军将毒发身亡。咸阳方向的烽火骤然转为青色，章邯的残部竟驾着秦陵水道的青铜战船破城而入，船头悬着范增的首级与半幅未烧毁的水文图。更令人震怒的是，韩信的轻骑裹着楚军玄甲，正将两千名地牢死者的血衣悬挂在彭城城楼。",\n  "success_ra'
2025-09-26 01:59:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 171
2025-09-26 01:59:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 01:59:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 01:59:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 01:59:40 | INFO     | core.story_engine:continue_story:327 - 故事继续生成成功
2025-09-26 01:59:40 | DEBUG    | core.speculation:_generate_child_node:245 - [Speculation] created node=235 parent=226 choice='焚毁彭城地牢与水文图'
2025-09-26 01:59:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=47 node=235 depth=1
2025-09-26 01:59:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=235 completed, triggered next level depth=1
2025-09-26 01:59:43 | INFO     | api.story:continue_existing_story:320 - 收到故事继续请求，选择: 焚毁彭城地牢与水文图
2025-09-26 13:28:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:28:53 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:28:54 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:28:54 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:28:54 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:28:54 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:28:54 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:28:54 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:28:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:28:54 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:28:54 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:28:54 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:28:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:28:55 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:28:55 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:28:55 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:28:55 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:28:55 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:29:28 | INFO     | api.story:prepare_start_level:174 - 开始生成故事概要，愿望：马超...
2025-09-26 13:29:40 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1425
2025-09-26 13:29:40 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '马超'
2025-09-26 13:29:40 | INFO     | api.story:prepare_start_level:232 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=马超...
2025-09-26 13:30:08 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:30:08 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1740
2025-09-26 13:30:08 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=824 预览='{"text": "渭水河畔的硝烟尚未散尽，马超的铠甲浸透血渍。前方探马来报：曹操主力已绕道潼关，若直取西凉则可断其粮道，但需穿越羌人领地；若留守汉中则可休整兵力，却会坐失战机。帐内谋士分作两派，老将韩遂暗中向长安传递密信，而马腾的旧部在暗中集结。夜风卷起沙砾击打帐帘，马超握紧义兄遗留的青龙偃月刀——这柄本该属于他的武器，此刻刀镡处的裂痕正映着月光。", "choices": [{"option": "断敌归途", "summary": "率轻骑突袭羌人部落夺取要道，用青龙刀震慑部落首领", "effects": {"delta_progress": 12, "delta_risk": 9, '
2025-09-26 13:30:08 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=824 预览='{"text": "渭水河畔的硝烟尚未散尽，马超的铠甲浸透血渍。前方探马来报：曹操主力已绕道潼关，若直取西凉则可断其粮道，但需穿越羌人领地；若留守汉中则可休整兵力，却会坐失战机。帐内谋士分作两派，老将韩遂暗中向长安传递密信，而马腾的旧部在暗中集结。夜风卷起沙砾击打帐帘，马超握紧义兄遗留的青龙偃月刀——这柄本该属于他的武'
2025-09-26 13:30:08 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=824 预览='{"text": "渭水河畔的硝烟尚未散尽，马超的铠甲浸透血渍。前方探马来报：曹操主力已绕道潼关，若直取西凉则可断其粮道，但需穿越羌人领地；若留守汉中则可休整兵力，却会坐失战机。帐内谋士分作两派，老将韩遂暗中向长安传递密信，而马腾的旧部在暗中集结。夜风卷起沙砾击打帐帘，马超握紧义兄遗留的青龙偃月刀——这柄本该属于他的武'
2025-09-26 13:30:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 166
2025-09-26 13:30:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:30:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:30:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:30:08 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 13:30:08 | INFO     | api.story:_background_pregen_first_story:79 - [pregen] 第一节故事预生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=马超...
2025-09-26 13:30:08 | INFO     | api.story:start_new_story:282 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 马超
2025-09-26 13:30:08 | INFO     | api.story:start_new_story:303 - [pregen] 命中缓存，第一节故事秒出: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 13:30:08 | INFO     | api.story:start_new_story:338 - 新故事生成成功
2025-09-26 13:30:08 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=236 depth=3
2025-09-26 13:30:08 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=236
2025-09-26 13:30:08 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 断敌归途
2025-09-26 13:30:08 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 分化瓦解
2025-09-26 13:30:08 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 重铸盟约
2025-09-26 13:30:28 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:30:28 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1935
2025-09-26 13:30:28 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=826 预览='{"text": "马蹄声自帐外传来，马超掀帘望去，见亲卫抱来一卷密报。火光摇曳中，韩遂与长安的密信残片显露——竟是献图献城的密约。帐内谋士仍在争论不休，老将主张绕道时，马腾旧部突然按剑而起，刀鞘撞击地面的脆响惊飞了檐下寒鸦。远处传来羌笛呜咽，似在催促抉择。马超抚过青龙刀的裂痕，忽觉刀柄暗格滑开，露出半截褪色的绸缎——竟是父亲马腾的血书残片，字迹在月光下依稀可辨：\'西凉有变，速归\'。", "choices": [{"option": "焚信夺羌", "summary": "当众烧毁密信，率轻骑突入羌人领地抢粮", "effects": {"delta_progress": 14, "delta'
2025-09-26 13:30:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=826 预览='{"text": "马蹄声自帐外传来，马超掀帘望去，见亲卫抱来一卷密报。火光摇曳中，韩遂与长安的密信残片显露——竟是献图献城的密约。帐内谋士仍在争论不休，老将主张绕道时，马腾旧部突然按剑而起，刀鞘撞击地面的脆响惊飞了檐下寒鸦。远处传来羌笛呜咽，似在催促抉择。马超抚过青龙刀的裂痕，忽觉刀柄暗格滑开，露出半截褪色的绸缎——'
2025-09-26 13:30:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=826 预览='{"text": "马蹄声自帐外传来，马超掀帘望去，见亲卫抱来一卷密报。火光摇曳中，韩遂与长安的密信残片显露——竟是献图献城的密约。帐内谋士仍在争论不休，老将主张绕道时，马腾旧部突然按剑而起，刀鞘撞击地面的脆响惊飞了檐下寒鸦。远处传来羌笛呜咽，似在催促抉择。马超抚过青龙刀的裂痕，忽觉刀柄暗格滑开，露出半截褪色的绸缎——'
2025-09-26 13:30:28 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 13:30:28 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:30:28 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 13:30:28 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 13:30:28 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:30:28 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=237 parent=236 choice='分化瓦解'
2025-09-26 13:30:28 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=237 depth=2
2025-09-26 13:30:28 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=237 completed, triggered next level depth=2
2025-09-26 13:30:28 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=237
2025-09-26 13:30:28 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 焚信夺羌
2025-09-26 13:30:28 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 暗探密约
2025-09-26 13:30:28 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 血书为令
2025-09-26 13:30:30 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:30:30 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2090
2025-09-26 13:30:30 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=870 预览='{"text": "渭水河畔的硝烟在月光下凝成灰白雾霭，马超的铠甲在篝火映照下泛着暗红血渍。斥候的急报声刺破夜幕：\'曹军主力已过潼关，前锋距西凉不过两日路程！\'帐中烛火摇曳，韩遂的佩刀在案几上投下锯齿状阴影，而马腾旧部的密信正压在砚台下——那是用西凉特有的狼毒花汁液书写的密文。突然，青龙偃月刀的裂痕处传来异响，仿佛刀魂在催促着什么。远处羌人营地的狼烟忽明忽暗，与长安方向的烽火形成诡异的夹角。", "choices": [{"option": "突袭羌人部落夺取通道", "summary": "以雷霆之势掌控羌人领地，用战利品换取西凉商路通行权", "effects": {"delta_prog'
2025-09-26 13:30:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=870 预览='{"text": "渭水河畔的硝烟在月光下凝成灰白雾霭，马超的铠甲在篝火映照下泛着暗红血渍。斥候的急报声刺破夜幕：\'曹军主力已过潼关，前锋距西凉不过两日路程！\'帐中烛火摇曳，韩遂的佩刀在案几上投下锯齿状阴影，而马腾旧部的密信正压在砚台下——那是用西凉特有的狼毒花汁液书写的密文。突然，青龙偃月刀的裂痕处传来异响，仿佛刀魂'
2025-09-26 13:30:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=870 预览='{"text": "渭水河畔的硝烟在月光下凝成灰白雾霭，马超的铠甲在篝火映照下泛着暗红血渍。斥候的急报声刺破夜幕：\'曹军主力已过潼关，前锋距西凉不过两日路程！\'帐中烛火摇曳，韩遂的佩刀在案几上投下锯齿状阴影，而马腾旧部的密信正压在砚台下——那是用西凉特有的狼毒花汁液书写的密文。突然，青龙偃月刀的裂痕处传来异响，仿佛刀魂'
2025-09-26 13:30:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 187
2025-09-26 13:30:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:30:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 13:30:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 13:30:30 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:30:30 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=238 parent=236 choice='重铸盟约'
2025-09-26 13:30:30 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=238 depth=2
2025-09-26 13:30:30 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=238 completed, triggered next level depth=2
2025-09-26 13:30:31 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=238
2025-09-26 13:30:31 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 突袭羌人部落夺取通道
2025-09-26 13:30:31 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 假意归顺韩遂获取情报
2025-09-26 13:30:31 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 以刀鸣为号召集旧部
2025-09-26 13:30:41 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:30:41 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1906
2025-09-26 13:30:41 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=875 预览='{"text": "羌笛声撕开夜幕时，马超已将韩遂密信与血书并置案上。烛火在密信\'献潼关图\'的墨迹与血书\'西凉有变\'的裂痕间摇曳，帐外突然传来马蹄铁刮擦青石的锐响——竟是曹操斥候的追踪箭矢破帐而入。\'曹军八百铁骑已至三十里坡！\'亲卫滚入帐内嘶声禀报，同时马腾旧部的佩剑冷光正从四面八方向他逼近。羌人巫祝的祝祷声自帐外传来，混着马蹄与号角，恍若黄土高原在血脉中震颤。马超突然将青龙刀插入密信燃烧的火盆，火星溅上旧部首领的鹿皮铠甲的刹那，他听见自己嘶吼出的竟是父亲被囚时的暗语。", "choices": [{"option": "焚信裂营", "summary": "以密信为饵诱杀韩遂心腹，故意暴露西'
2025-09-26 13:30:41 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=875 预览='{"text": "羌笛声撕开夜幕时，马超已将韩遂密信与血书并置案上。烛火在密信\'献潼关图\'的墨迹与血书\'西凉有变\'的裂痕间摇曳，帐外突然传来马蹄铁刮擦青石的锐响——竟是曹操斥候的追踪箭矢破帐而入。\'曹军八百铁骑已至三十里坡！\'亲卫滚入帐内嘶声禀报，同时马腾旧部的佩剑冷光正从四面八方向他逼近。羌人巫祝的祝祷声自帐外传来'
2025-09-26 13:30:41 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=875 预览='{"text": "羌笛声撕开夜幕时，马超已将韩遂密信与血书并置案上。烛火在密信\'献潼关图\'的墨迹与血书\'西凉有变\'的裂痕间摇曳，帐外突然传来马蹄铁刮擦青石的锐响——竟是曹操斥候的追踪箭矢破帐而入。\'曹军八百铁骑已至三十里坡！\'亲卫滚入帐内嘶声禀报，同时马腾旧部的佩剑冷光正从四面八方向他逼近。羌人巫祝的祝祷声自帐外传来'
2025-09-26 13:30:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 227
2025-09-26 13:30:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:30:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 13:30:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 13:30:41 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:30:41 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=239 parent=237 choice='焚信夺羌'
2025-09-26 13:30:41 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=239 depth=1
2025-09-26 13:30:41 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=239 completed, triggered next level depth=1
2025-09-26 13:30:41 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=48 node=239
2025-09-26 13:30:45 | INFO     | api.story:continue_existing_story:359 - 收到故事继续请求，选择: 断敌归途
2025-09-26 13:30:47 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:30:47 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2189
2025-09-26 13:30:47 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=834 预览='{"text": "羌寨的篝火在马蹄下碎裂，马超的玄甲倒映着狼烟与星斗。羌族首领柯先举起青铜酒樽，酒液里沉着半片狼毒花瓣——与马腾密信上的毒汁同源。\'汉家将军的刀能斩断裂痕，却斩不断血脉羁绊。\'他突然用流利的西凉方言低语，帐外忽然传来铁甲碰撞声。韩遂的密信在马超袖中发烫，而马腾旧部的亲卫已潜伏在第三顶毡帐后。青龙刀的裂痕突然迸发幽蓝光芒，刀镡处浮现出从未见过的古老符文，仿佛在回应某种召唤。当柯先的侍卫拔出弯刀时，马超听见身后传来熟悉的马蹄声——曹操的斥候竟已绕至羌寨后山。", "choices": [{"option": "以刀为契", "summary": "将青龙刀暂时交予羌族作为结盟信物'
2025-09-26 13:30:47 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=834 预览='{"text": "羌寨的篝火在马蹄下碎裂，马超的玄甲倒映着狼烟与星斗。羌族首领柯先举起青铜酒樽，酒液里沉着半片狼毒花瓣——与马腾密信上的毒汁同源。\'汉家将军的刀能斩断裂痕，却斩不断血脉羁绊。\'他突然用流利的西凉方言低语，帐外忽然传来铁甲碰撞声。韩遂的密信在马超袖中发烫，而马腾旧部的亲卫已潜伏在第三顶毡帐后。青龙刀的裂'
2025-09-26 13:30:47 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=834 预览='{"text": "羌寨的篝火在马蹄下碎裂，马超的玄甲倒映着狼烟与星斗。羌族首领柯先举起青铜酒樽，酒液里沉着半片狼毒花瓣——与马腾密信上的毒汁同源。\'汉家将军的刀能斩断裂痕，却斩不断血脉羁绊。\'他突然用流利的西凉方言低语，帐外忽然传来铁甲碰撞声。韩遂的密信在马超袖中发烫，而马腾旧部的亲卫已潜伏在第三顶毡帐后。青龙刀的裂'
2025-09-26 13:30:47 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 228
2025-09-26 13:30:47 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:30:47 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:30:47 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:30:47 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:30:47 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=240 parent=238 choice='以刀鸣为号召集旧部'
2025-09-26 13:30:47 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=240 depth=1
2025-09-26 13:30:47 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=240 completed, triggered next level depth=1
2025-09-26 13:30:51 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1993
2025-09-26 13:30:51 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1108 预览='\n\n```json\n{\n  "text": "渭水河畔的硝烟尚未散尽，马超的铠甲浸透血渍。探马跪在沙盘前，指尖划过羊肠小道的痕迹：\'曹军主力已绕过潼关，分兵两路——若直取西凉可断其粮道，但需穿越羌人领地；若留守汉中可休整兵力，却会坐失战机。\'帐内谋士分作两派，老将韩遂的佩刀在烛火下泛着冷光，暗卫密报他昨夜曾遣亲信向长安传递密信。更深夜静时，马腾旧部的旗帜在营外若隐若现，而他手中那柄青龙偃月刀的裂痕，正映着月光割裂帐顶的星辉。",\n  "choices": [\n    {\n      "option": "羌刀开路",\n      "summary": "强行穿越羌人领地直捣西凉，用马家军的威名'
2025-09-26 13:30:51 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1106 预览='```json\n{\n  "text": "渭水河畔的硝烟尚未散尽，马超的铠甲浸透血渍。探马跪在沙盘前，指尖划过羊肠小道的痕迹：\'曹军主力已绕过潼关，分兵两路——若直取西凉可断其粮道，但需穿越羌人领地；若留守汉中可休整兵力，却会坐失战机。\'帐内谋士分作两派，老将韩遂的佩刀在烛火下泛着冷光，暗卫密报他昨夜曾遣亲信向长安传递'
2025-09-26 13:30:51 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1094 预览='{\n  "text": "渭水河畔的硝烟尚未散尽，马超的铠甲浸透血渍。探马跪在沙盘前，指尖划过羊肠小道的痕迹：\'曹军主力已绕过潼关，分兵两路——若直取西凉可断其粮道，但需穿越羌人领地；若留守汉中可休整兵力，却会坐失战机。\'帐内谋士分作两派，老将韩遂的佩刀在烛火下泛着冷光，暗卫密报他昨夜曾遣亲信向长安传递密信。更深夜静时'
2025-09-26 13:30:51 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 13:30:51 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:30:51 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:30:51 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:30:51 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:30:52 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=241 parent=236 choice='断敌归途'
2025-09-26 13:30:52 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=241 depth=2
2025-09-26 13:30:52 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=241 completed, triggered next level depth=2
2025-09-26 13:30:52 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=241
2025-09-26 13:30:52 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 羌刀开路
2025-09-26 13:30:52 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 火中取栗
2025-09-26 13:30:52 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 断刃为誓
2025-09-26 13:30:59 | INFO     | api.story:continue_existing_story:359 - 收到故事继续请求，选择: 断敌归途
2025-09-26 13:31:05 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1997
2025-09-26 13:31:05 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1121 预览='\n\n```json\n{\n  "text": "羌寨篝火在夜雾中明灭，马超将韩遂密信与血书并置案上。\'西凉若失，陇上皆危。\'他低语间，亲卫呈上新获羌人斥候——那人身负三处刀伤，却死死咬住马鞍环不吐露半字。马超割开其衣襟，赫然露出胸口刺青：竟是羌族祭司的禁卫标记。帐外忽有马蹄声急，探子回报汉中粮道遭袭，而长安方向飘来焦糊气息。马超将青龙刀横放案头，刀尖指向地图上三个红圈——韩遂私军屯粮处、羌人圣地祭坛、以及长安城门暗桩的方位。羌笛声中，他解下臂甲掷向烛台，火星溅落处，三封密信在羊皮上烙下不同图腾。",\n  "choices": [\n    {\n      "option": "血盟羌酋",\n   '
2025-09-26 13:31:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1119 预览='```json\n{\n  "text": "羌寨篝火在夜雾中明灭，马超将韩遂密信与血书并置案上。\'西凉若失，陇上皆危。\'他低语间，亲卫呈上新获羌人斥候——那人身负三处刀伤，却死死咬住马鞍环不吐露半字。马超割开其衣襟，赫然露出胸口刺青：竟是羌族祭司的禁卫标记。帐外忽有马蹄声急，探子回报汉中粮道遭袭，而长安方向飘来焦糊气息。'
2025-09-26 13:31:05 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1107 预览='{\n  "text": "羌寨篝火在夜雾中明灭，马超将韩遂密信与血书并置案上。\'西凉若失，陇上皆危。\'他低语间，亲卫呈上新获羌人斥候——那人身负三处刀伤，却死死咬住马鞍环不吐露半字。马超割开其衣襟，赫然露出胸口刺青：竟是羌族祭司的禁卫标记。帐外忽有马蹄声急，探子回报汉中粮道遭袭，而长安方向飘来焦糊气息。马超将青龙刀横放'
2025-09-26 13:31:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 226
2025-09-26 13:31:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:31:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:31:05 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:05 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=242 parent=237 choice='暗探密约'
2025-09-26 13:31:05 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=242 depth=1
2025-09-26 13:31:05 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=242 completed, triggered next level depth=1
2025-09-26 13:31:06 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2021
2025-09-26 13:31:06 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1106 预览='\n\n```json\n{\n  "text": "羌笛声撕裂夜幕时，马超已将韩遂的密信残片按在烛火上。羊皮卷在火舌中蜷曲，却让血书上的西凉地形图显出暗纹——父亲用朱砂勾勒的暗道直通金城。帐外亲卫忽然跪报：马腾旧部的火把正以三长两短的节奏明灭，这是建安年间西凉军的密令暗号。马超扯断青龙刀断裂的刀镡，金属碎片在掌心划出血痕。远处传来羌人祭祀的鼓声，鼓点与马蹄声诡异地重合，仿佛整片荒原都在催促抉择。韩遂的心腹此刻正举着火把逼近营帐，而密道图显示若此时直插金城，既能截断曹操粮道，又能逼迫羌酋选择阵营。",\n  "choices": [\n    {\n      "option": "血书为契",\n     '
2025-09-26 13:31:06 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1104 预览='```json\n{\n  "text": "羌笛声撕裂夜幕时，马超已将韩遂的密信残片按在烛火上。羊皮卷在火舌中蜷曲，却让血书上的西凉地形图显出暗纹——父亲用朱砂勾勒的暗道直通金城。帐外亲卫忽然跪报：马腾旧部的火把正以三长两短的节奏明灭，这是建安年间西凉军的密令暗号。马超扯断青龙刀断裂的刀镡，金属碎片在掌心划出血痕。远处传'
2025-09-26 13:31:06 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1092 预览='{\n  "text": "羌笛声撕裂夜幕时，马超已将韩遂的密信残片按在烛火上。羊皮卷在火舌中蜷曲，却让血书上的西凉地形图显出暗纹——父亲用朱砂勾勒的暗道直通金城。帐外亲卫忽然跪报：马腾旧部的火把正以三长两短的节奏明灭，这是建安年间西凉军的密令暗号。马超扯断青龙刀断裂的刀镡，金属碎片在掌心划出血痕。远处传来羌人祭祀的鼓声'
2025-09-26 13:31:06 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 224
2025-09-26 13:31:06 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:06 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:31:06 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:31:06 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:06 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=243 parent=237 choice='血书为令'
2025-09-26 13:31:06 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=243 depth=1
2025-09-26 13:31:06 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=243 completed, triggered next level depth=1
2025-09-26 13:31:10 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2312
2025-09-26 13:31:10 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1132 预览='\n\n```json\n{\n  "text": "马超勒马于断崖边，羌人祭司的骨笛声穿透夜雾。三万铁骑隐入山道褶皱，刀盾碰撞声被朔风揉碎。斥候突然拽住缰绳——前方山谷燃起狼烟，韩遂的亲卫营竟提前占据隘口。\'西凉牧民在焚烧粮仓！\'副将指向远处腾起的黑烟，曹军的补给线正在自毁。马超扯开染血的战袍，露出腰间密信：韩遂与曹操约定，若马超取道羌地，则献上其父马腾的首级。月光掠过青龙刀的裂痕，映出身后旧部将领们紧绷的脊背——他们中有人正用指甲掐着掌心的旧伤疤，那是十年前随马腾征战时留下的印记。",\n  "choices": [\n    {\n      "option": "与羌酋歃血盟",\n      "su'
2025-09-26 13:31:10 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1130 预览='```json\n{\n  "text": "马超勒马于断崖边，羌人祭司的骨笛声穿透夜雾。三万铁骑隐入山道褶皱，刀盾碰撞声被朔风揉碎。斥候突然拽住缰绳——前方山谷燃起狼烟，韩遂的亲卫营竟提前占据隘口。\'西凉牧民在焚烧粮仓！\'副将指向远处腾起的黑烟，曹军的补给线正在自毁。马超扯开染血的战袍，露出腰间密信：韩遂与曹操约定，若马'
2025-09-26 13:31:10 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1118 预览='{\n  "text": "马超勒马于断崖边，羌人祭司的骨笛声穿透夜雾。三万铁骑隐入山道褶皱，刀盾碰撞声被朔风揉碎。斥候突然拽住缰绳——前方山谷燃起狼烟，韩遂的亲卫营竟提前占据隘口。\'西凉牧民在焚烧粮仓！\'副将指向远处腾起的黑烟，曹军的补给线正在自毁。马超扯开染血的战袍，露出腰间密信：韩遂与曹操约定，若马超取道羌地，则献'
2025-09-26 13:31:10 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 218
2025-09-26 13:31:10 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:10 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 13:31:10 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 13:31:10 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:10 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=244 parent=241 choice='火中取栗'
2025-09-26 13:31:10 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=244 depth=1
2025-09-26 13:31:10 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=244 completed, triggered next level depth=1
2025-09-26 13:31:11 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2129
2025-09-26 13:31:11 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1085 预览='\n\n```json\n{\n  "text": "篝火在青铜鼎中噼啪炸裂，羌人首领的鹿角冠在火光中投下锯齿状阴影。马超将青龙刀横放案上，裂痕处的寒光与密信上的狼毒花印痕重叠。\'西凉牧草足供三军半年，但需以马家血脉为质。\'韩遂的嗓音裹着酒气渗入帐内，而马腾旧部的密信正用血墨续写着：\'曹军斥候已探明汉中栈道暗桩。\'羌人巫祝突然以骨杖叩击地面，沙盘上的烽燧标记竟与长安密信的夹角完全吻合。马超的铠甲在火光中忽明忽暗，他听见刀镡裂痕深处传来某种古老战歌的残章。",\n  "choices": [\n    {\n      "option": "羌人结盟",\n      "summary": "以马家血脉为质换取'
2025-09-26 13:31:11 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1083 预览='```json\n{\n  "text": "篝火在青铜鼎中噼啪炸裂，羌人首领的鹿角冠在火光中投下锯齿状阴影。马超将青龙刀横放案上，裂痕处的寒光与密信上的狼毒花印痕重叠。\'西凉牧草足供三军半年，但需以马家血脉为质。\'韩遂的嗓音裹着酒气渗入帐内，而马腾旧部的密信正用血墨续写着：\'曹军斥候已探明汉中栈道暗桩。\'羌人巫祝突然以骨'
2025-09-26 13:31:11 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1071 预览='{\n  "text": "篝火在青铜鼎中噼啪炸裂，羌人首领的鹿角冠在火光中投下锯齿状阴影。马超将青龙刀横放案上，裂痕处的寒光与密信上的狼毒花印痕重叠。\'西凉牧草足供三军半年，但需以马家血脉为质。\'韩遂的嗓音裹着酒气渗入帐内，而马腾旧部的密信正用血墨续写着：\'曹军斥候已探明汉中栈道暗桩。\'羌人巫祝突然以骨杖叩击地面，沙盘'
2025-09-26 13:31:11 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 202
2025-09-26 13:31:11 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:11 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 13:31:11 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 13:31:11 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:11 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=245 parent=238 choice='突袭羌人部落夺取通道'
2025-09-26 13:31:11 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=245 depth=1
2025-09-26 13:31:11 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=245 completed, triggered next level depth=1
2025-09-26 13:31:11 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2382
2025-09-26 13:31:11 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1067 预览='\n\n```json\n{\n  "text": "羌人祭司的骨杖在沙盘上划出蜿蜒血痕，马超的瞳孔倒映着篝火与刀光。\'西凉道有三险：白狼河的浮冰、烧当羌的箭雨、还有韩遂暗中勾结的匈奴轻骑。\'他割开斥候染血的衣襟，露出腰间曹操赐予的虎符——这枚本该锁在长安城的信物，此刻正渗出青铜腥气。营外传来马蹄铁与碎石的摩擦声，旧部首领成公英的玄甲卫已列阵待发，而韩遂营帐的灯火在夜雾中明灭不定，仿佛随时会燃成燎原野火。",\n  "choices": [\n    {\n      "option": "血祭白狼河",\n      "summary": "以羌人祭祀为掩护强行渡河，用虎符换取匈奴中立",\n      "e'
2025-09-26 13:31:11 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1065 预览='```json\n{\n  "text": "羌人祭司的骨杖在沙盘上划出蜿蜒血痕，马超的瞳孔倒映着篝火与刀光。\'西凉道有三险：白狼河的浮冰、烧当羌的箭雨、还有韩遂暗中勾结的匈奴轻骑。\'他割开斥候染血的衣襟，露出腰间曹操赐予的虎符——这枚本该锁在长安城的信物，此刻正渗出青铜腥气。营外传来马蹄铁与碎石的摩擦声，旧部首领成公英的'
2025-09-26 13:31:11 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1053 预览='{\n  "text": "羌人祭司的骨杖在沙盘上划出蜿蜒血痕，马超的瞳孔倒映着篝火与刀光。\'西凉道有三险：白狼河的浮冰、烧当羌的箭雨、还有韩遂暗中勾结的匈奴轻骑。\'他割开斥候染血的衣襟，露出腰间曹操赐予的虎符——这枚本该锁在长安城的信物，此刻正渗出青铜腥气。营外传来马蹄铁与碎石的摩擦声，旧部首领成公英的玄甲卫已列阵待发'
2025-09-26 13:31:11 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 177
2025-09-26 13:31:11 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:11 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 13:31:11 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 13:31:11 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:11 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=246 parent=241 choice='羌刀开路'
2025-09-26 13:31:11 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=246 depth=1
2025-09-26 13:31:11 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=246 completed, triggered next level depth=1
2025-09-26 13:31:20 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2374
2025-09-26 13:31:20 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1075 预览='\n\n```json\n{\n  "text": "青铜面具在篝火中忽明忽暗，羌族首领拓跋赤红着双目将酒碗砸向沙盘：\'十年前你们背弃诺言，今夜若无血盟，西凉仍是汉家禁地！\'马超的指尖抚过青龙刀裂痕，刀镡渗出的血珠滴落在密信上，墨迹晕开处显出韩遂与曹操的暗语。帐外传来驼铃与铁甲摩擦声，三百轻骑正绕过黄河九曲，那是马腾旧部最后的精锐。突然有斥候滚入帐中，袖中滑落半枚虎符——与长安城门卫统领所戴者如出一辙。",\n  "choices": [\n    {\n      "option": "血盟之誓",\n      "summary": "割掌心血与羌人首领共饮，用虎符作信物换取铁骑",\n      "eff'
2025-09-26 13:31:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1073 预览='```json\n{\n  "text": "青铜面具在篝火中忽明忽暗，羌族首领拓跋赤红着双目将酒碗砸向沙盘：\'十年前你们背弃诺言，今夜若无血盟，西凉仍是汉家禁地！\'马超的指尖抚过青龙刀裂痕，刀镡渗出的血珠滴落在密信上，墨迹晕开处显出韩遂与曹操的暗语。帐外传来驼铃与铁甲摩擦声，三百轻骑正绕过黄河九曲，那是马腾旧部最后的精锐'
2025-09-26 13:31:20 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1061 预览='{\n  "text": "青铜面具在篝火中忽明忽暗，羌族首领拓跋赤红着双目将酒碗砸向沙盘：\'十年前你们背弃诺言，今夜若无血盟，西凉仍是汉家禁地！\'马超的指尖抚过青龙刀裂痕，刀镡渗出的血珠滴落在密信上，墨迹晕开处显出韩遂与曹操的暗语。帐外传来驼铃与铁甲摩擦声，三百轻骑正绕过黄河九曲，那是马腾旧部最后的精锐。突然有斥候滚入'
2025-09-26 13:31:20 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 176
2025-09-26 13:31:20 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:20 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 13:31:20 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 13:31:20 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:20 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=247 parent=238 choice='假意归顺韩遂获取情报'
2025-09-26 13:31:20 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=247 depth=1
2025-09-26 13:31:20 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=247 completed, triggered next level depth=1
2025-09-26 13:31:24 | INFO     | api.story:continue_existing_story:359 - 收到故事继续请求，选择: 羌刀开路
2025-09-26 13:31:32 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2224
2025-09-26 13:31:32 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1114 预览='\n\n```json\n{\n  "text": "马超率轻骑踏破羌人封山的木栅时，黎明正撕开天际的猩红。羌人头领拓跋部的营火在峡谷两侧明灭，裹着狼皮的斥候举着弯刀拦截，却在看清青龙偃月刀的裂痕后突然退散。\'马氏儿郎的刀，不该染汉家血。\'老祭司用鲜卑语低语，将半卷残破的《出师表》掷入火堆。这时韩遂的密信在副将怀中被血浸透——长安城已悬起曹操的帅旗。马腾旧部的黑旗突然从侧翼杀出，为首者铠甲下露出与马超相似的锁子纹身，刀尖挑着半幅西凉地图：\'父亲临终前说，青龙刀的裂痕该对准潼关。\'",\n  "choices": [\n    {\n      "option": "与羌人歃血为盟",\n      "summ'
2025-09-26 13:31:32 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1112 预览='```json\n{\n  "text": "马超率轻骑踏破羌人封山的木栅时，黎明正撕开天际的猩红。羌人头领拓跋部的营火在峡谷两侧明灭，裹着狼皮的斥候举着弯刀拦截，却在看清青龙偃月刀的裂痕后突然退散。\'马氏儿郎的刀，不该染汉家血。\'老祭司用鲜卑语低语，将半卷残破的《出师表》掷入火堆。这时韩遂的密信在副将怀中被血浸透——长安'
2025-09-26 13:31:32 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1100 预览='{\n  "text": "马超率轻骑踏破羌人封山的木栅时，黎明正撕开天际的猩红。羌人头领拓跋部的营火在峡谷两侧明灭，裹着狼皮的斥候举着弯刀拦截，却在看清青龙偃月刀的裂痕后突然退散。\'马氏儿郎的刀，不该染汉家血。\'老祭司用鲜卑语低语，将半卷残破的《出师表》掷入火堆。这时韩遂的密信在副将怀中被血浸透——长安城已悬起曹操的帅'
2025-09-26 13:31:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 215
2025-09-26 13:31:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:31:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 13:31:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 13:31:32 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:31:32 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=248 parent=241 choice='断刃为誓'
2025-09-26 13:31:32 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=48 node=248 depth=1
2025-09-26 13:31:32 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=248 completed, triggered next level depth=1
2025-09-26 13:40:40 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:40:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:40:42 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:40:42 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:40:42 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:40:42 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:40:42 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:40:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:40:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:40:42 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:40:42 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:40:42 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:40:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:40:43 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:40:43 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:40:43 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:40:43 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:40:43 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:41:00 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:41:01 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:41:02 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:41:02 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:41:02 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:41:02 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:41:02 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:41:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:41:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:41:02 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:41:02 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:41:02 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:41:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:41:03 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:41:03 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:41:03 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:41:03 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:41:03 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:41:46 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:41:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:41:47 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:41:47 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:41:47 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:41:47 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:41:47 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:41:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:41:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:41:48 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:41:48 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:41:48 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:41:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:41:48 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:41:48 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:41:48 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:41:48 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:41:48 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:42:04 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:42:05 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:42:05 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:42:05 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:42:05 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:42:05 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:42:05 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:42:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:06 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:42:06 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:42:06 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:42:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:07 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:42:07 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:42:07 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:42:07 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:42:07 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:42:35 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:42:36 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:42:37 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:42:37 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:42:37 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:42:37 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:42:37 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:42:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:38 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:42:38 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:42:38 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:42:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:38 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:42:38 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:42:38 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:42:38 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:42:38 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:42:51 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:42:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:42:53 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:42:53 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:42:53 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:42:53 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:42:53 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:42:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:53 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:42:53 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:42:53 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:42:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:42:54 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:42:54 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:42:54 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:42:54 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:42:54 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:44:11 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 13:44:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:44:15 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 13:44:16 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 13:44:16 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 13:44:16 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 13:44:16 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 13:44:16 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 13:44:16 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:44:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:44:16 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 13:44:16 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 13:44:16 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 13:44:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 13:44:17 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 13:44:17 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 13:44:17 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 13:44:17 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 13:44:17 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 13:44:50 | INFO     | api.story:prepare_start_level:177 - 开始生成故事概要，愿望：项羽...
2025-09-26 13:45:06 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1854
2025-09-26 13:45:06 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 13:45:06 | INFO     | api.story:prepare_start_level:235 - [pregen] 已启动后台预生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=项羽...
2025-09-26 13:45:35 | INFO     | api.story:start_new_story:285 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 项羽
2025-09-26 13:45:35 | INFO     | api.story:start_new_story:308 - [pregen] 未命中缓存，现场生成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 13:45:35 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 13:45:38 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:45:38 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2022
2025-09-26 13:45:38 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=836 预览='{"text": "残阳如血，染红彭城宫阙。项羽按剑立于城头，八千江东子弟的铠甲在暮色中泛着冷光。斥候急报：刘邦联军已屯兵垓下，齐赵两国使者正于帐中议和。帐内灯火摇曳，钟离昧低声劝谏\'分封诸侯需谨慎\'，而龙且却主张\'当夜袭刘邦大营\'。营外传来乌骓马嘶鸣，那匹随他破釜沉舟的战马正焦躁地刨着地面，仿佛预感着即将到来的风暴。", "choices": [{"option": "单骑突入刘邦大营，当众斩杀联军主将震慑群雄", "summary": "以雷霆之势震慑诸侯", "effects": {"delta_progress": 12, "delta_risk": 10, "delta_exposu'
2025-09-26 13:45:38 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=836 预览='{"text": "残阳如血，染红彭城宫阙。项羽按剑立于城头，八千江东子弟的铠甲在暮色中泛着冷光。斥候急报：刘邦联军已屯兵垓下，齐赵两国使者正于帐中议和。帐内灯火摇曳，钟离昧低声劝谏\'分封诸侯需谨慎\'，而龙且却主张\'当夜袭刘邦大营\'。营外传来乌骓马嘶鸣，那匹随他破釜沉舟的战马正焦躁地刨着地面，仿佛预感着即将到来的风暴。'
2025-09-26 13:45:38 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=836 预览='{"text": "残阳如血，染红彭城宫阙。项羽按剑立于城头，八千江东子弟的铠甲在暮色中泛着冷光。斥候急报：刘邦联军已屯兵垓下，齐赵两国使者正于帐中议和。帐内灯火摇曳，钟离昧低声劝谏\'分封诸侯需谨慎\'，而龙且却主张\'当夜袭刘邦大营\'。营外传来乌骓马嘶鸣，那匹随他破釜沉舟的战马正焦躁地刨着地面，仿佛预感着即将到来的风暴。'
2025-09-26 13:45:38 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 150
2025-09-26 13:45:38 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:45:38 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:45:38 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:45:38 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 13:45:38 | INFO     | api.story:_background_pregen_first_story:79 - [pregen] 第一节故事预生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, wish=项羽...
2025-09-26 13:45:55 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:45:55 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2041
2025-09-26 13:45:55 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=871 预览='{"text": "残阳如血，染红彭城宫阙的飞檐。项羽独坐虎帐，青铜灯树在案头投下摇曳的阴影。帐外传来战马嘶鸣，斥候急报：刘邦军已渡过黄河南下，与彭越合兵十万屯于荥阳。副将钟离昧按剑低语：\'陛下，齐地三郡昨夜举旗归汉，若不速决...\'话音未落，一封火漆信笺被暗卫密送而来，展开竟是韩信亲笔：\'楚虽三户，亡秦必楚——今愿以十万汉卒，换霸王一诺。\'帐外秋风卷起沙尘，将帅们的呼吸在青铜灯下凝成白雾。", "choices": [{"option": "将密信当众焚毁，命人将韩信画像悬于军营各处", "summary": "以威慑姿态巩固内部军心", "effects": {"delta_progres'
2025-09-26 13:45:55 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=871 预览='{"text": "残阳如血，染红彭城宫阙的飞檐。项羽独坐虎帐，青铜灯树在案头投下摇曳的阴影。帐外传来战马嘶鸣，斥候急报：刘邦军已渡过黄河南下，与彭越合兵十万屯于荥阳。副将钟离昧按剑低语：\'陛下，齐地三郡昨夜举旗归汉，若不速决...\'话音未落，一封火漆信笺被暗卫密送而来，展开竟是韩信亲笔：\'楚虽三户，亡秦必楚——今愿以'
2025-09-26 13:45:55 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=871 预览='{"text": "残阳如血，染红彭城宫阙的飞檐。项羽独坐虎帐，青铜灯树在案头投下摇曳的阴影。帐外传来战马嘶鸣，斥候急报：刘邦军已渡过黄河南下，与彭越合兵十万屯于荥阳。副将钟离昧按剑低语：\'陛下，齐地三郡昨夜举旗归汉，若不速决...\'话音未落，一封火漆信笺被暗卫密送而来，展开竟是韩信亲笔：\'楚虽三户，亡秦必楚——今愿以'
2025-09-26 13:45:55 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 187
2025-09-26 13:45:55 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:45:55 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 13:45:55 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 13:45:55 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 13:45:55 | INFO     | api.story:start_new_story:341 - 新故事生成成功
2025-09-26 13:45:55 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=249 depth=3
2025-09-26 13:45:55 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=249
2025-09-26 13:45:55 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将密信当众焚毁，命人将韩信画像悬于军营各处
2025-09-26 13:45:55 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 深夜策马直奔荥阳城下，单骑挑战刘邦军阵
2025-09-26 13:45:55 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 传令全军三日后出征，暗中却命工匠连夜铸造巨型投石机
2025-09-26 13:46:11 | INFO     | api.story:continue_existing_story:362 - 收到故事继续请求，选择: 将密信当众焚毁，命人将韩信画像悬于军营各处
2025-09-26 13:46:17 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:46:17 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2098
2025-09-26 13:46:17 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=860 预览='{"text": "青铜灯树爆出一串火星，项羽的瞳孔在火光中收缩成两点寒星。韩信的信笺被他捏出裂痕，墨迹间\'一诺\'二字仿佛渗出血色。帐外传来急促的马蹄声，钟离昧的佩剑正抵在案几边缘，剑鞘上的蟠螭纹在阴影里蠢蠢欲动。\'传令三军整备，明晨出征！\'项羽突然暴喝，惊得烛火剧烈摇晃。但当他瞥见案头那枚刘邦派使者\'献礼\'的和氏璧时，喉间发出低沉的冷笑——这方玉璧分明少了半寸裂痕。帐外秋风卷起沙尘，将\'荥阳\'二字吹得支离破碎。", "choices": [{"option": "将韩信密信当众焚毁，以刘邦使者为祭品誓师出征", "summary": "震慑内外的威压手段", "effects": {"del'
2025-09-26 13:46:17 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=860 预览='{"text": "青铜灯树爆出一串火星，项羽的瞳孔在火光中收缩成两点寒星。韩信的信笺被他捏出裂痕，墨迹间\'一诺\'二字仿佛渗出血色。帐外传来急促的马蹄声，钟离昧的佩剑正抵在案几边缘，剑鞘上的蟠螭纹在阴影里蠢蠢欲动。\'传令三军整备，明晨出征！\'项羽突然暴喝，惊得烛火剧烈摇晃。但当他瞥见案头那枚刘邦派使者\'献礼\'的和氏璧时'
2025-09-26 13:46:17 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=860 预览='{"text": "青铜灯树爆出一串火星，项羽的瞳孔在火光中收缩成两点寒星。韩信的信笺被他捏出裂痕，墨迹间\'一诺\'二字仿佛渗出血色。帐外传来急促的马蹄声，钟离昧的佩剑正抵在案几边缘，剑鞘上的蟠螭纹在阴影里蠢蠢欲动。\'传令三军整备，明晨出征！\'项羽突然暴喝，惊得烛火剧烈摇晃。但当他瞥见案头那枚刘邦派使者\'献礼\'的和氏璧时'
2025-09-26 13:46:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-26 13:46:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:46:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 13:46:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 13:46:17 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:46:17 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=250 parent=249 choice='深夜策马直奔荥阳城下，单骑挑战刘邦军阵'
2025-09-26 13:46:17 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=250 depth=2
2025-09-26 13:46:17 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=250 completed, triggered next level depth=2
2025-09-26 13:46:17 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=250
2025-09-26 13:46:17 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将韩信密信当众焚毁，以刘邦使者为祭品誓师出征
2025-09-26 13:46:17 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 暗派亲卫携密函潜入荥阳，与彭越旧部接洽
2025-09-26 13:46:17 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命工匠连夜仿制九斿大旗，率精锐突袭汉军粮仓
2025-09-26 13:46:27 | WARNING  | api.story:continue_existing_story:394 - [continue] 等待推演完成超时 session=49 choice=将密信当众焚毁，命人将韩信画像悬于军营各处
2025-09-26 13:46:27 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将密信当众焚毁，命人将韩信画像悬于军营各处
2025-09-26 13:46:31 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:46:31 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2167
2025-09-26 13:46:31 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=873 预览='{"text": "战马铁蹄踏碎荥阳城外的月光，项羽的玄铁铠甲在夜风中嗡鸣。城头汉军火把骤然亮起，万箭如蝗群遮蔽星河，却在距他三丈处被横飞的枪影尽数击落。\'楚霸王亲至！\'守将夏侯婴的声音在颤抖，城门竟缓缓开启半寸。暗处忽然爆响火把，韩信白衣胜雪立于箭楼，手中攥着半块染血的和氏璧——与项羽案头那半恰好严丝合缝。\'此玉可证，韩信从未负楚。\'他的声音裹着夜风传来，\'但若霸王执意血洗荥阳，明日此时，齐地三郡将尽成焦土。\'", "choices": [{"option": "暴喝着策马直冲城门，枪尖挑飞守军灯笼劈开通道", "summary": "以绝对武力强行突破", "effects": {"del'
2025-09-26 13:46:31 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=873 预览='{"text": "战马铁蹄踏碎荥阳城外的月光，项羽的玄铁铠甲在夜风中嗡鸣。城头汉军火把骤然亮起，万箭如蝗群遮蔽星河，却在距他三丈处被横飞的枪影尽数击落。\'楚霸王亲至！\'守将夏侯婴的声音在颤抖，城门竟缓缓开启半寸。暗处忽然爆响火把，韩信白衣胜雪立于箭楼，手中攥着半块染血的和氏璧——与项羽案头那半恰好严丝合缝。\'此玉可证'
2025-09-26 13:46:31 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=873 预览='{"text": "战马铁蹄踏碎荥阳城外的月光，项羽的玄铁铠甲在夜风中嗡鸣。城头汉军火把骤然亮起，万箭如蝗群遮蔽星河，却在距他三丈处被横飞的枪影尽数击落。\'楚霸王亲至！\'守将夏侯婴的声音在颤抖，城门竟缓缓开启半寸。暗处忽然爆响火把，韩信白衣胜雪立于箭楼，手中攥着半块染血的和氏璧——与项羽案头那半恰好严丝合缝。\'此玉可证'
2025-09-26 13:46:31 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-26 13:46:31 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:46:31 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:46:31 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:46:31 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:46:31 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=251 parent=250 choice='将韩信密信当众焚毁，以刘邦使者为祭品誓师出征'
2025-09-26 13:46:31 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=251 depth=1
2025-09-26 13:46:31 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=251 completed, triggered next level depth=1
2025-09-26 13:46:37 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:46:37 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2138
2025-09-26 13:46:37 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=853 预览='{"text": "青铜灯树突然爆出一声爆响，火星溅在韩信密信的\'一诺\'二字上。项羽的瞳孔在火光中收缩，信笺边缘的焦痕蜿蜒如蛇。帐外传来战马铁掌踏碎枯枝的脆响，钟离昧的剑穗已缠上案角——那柄曾斩杀宋义的青釭剑正泛着寒光。\'将密信烧了。\'项羽突然用剑尖挑起半片残简，\'传令三军：明晨鸡鸣时，本王要看见刘邦的首级悬在荥阳城头。\'但密信背面的暗纹在烛火下浮现：韩信的私印旁，赫然印着彭越的蛇形标记。", "choices": [{"option": "当众撕碎密信，率精骑直扑荥阳城", "summary": "以绝对武力震慑内外", "effects": {"delta_progress": 12, "'
2025-09-26 13:46:37 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=853 预览='{"text": "青铜灯树突然爆出一声爆响，火星溅在韩信密信的\'一诺\'二字上。项羽的瞳孔在火光中收缩，信笺边缘的焦痕蜿蜒如蛇。帐外传来战马铁掌踏碎枯枝的脆响，钟离昧的剑穗已缠上案角——那柄曾斩杀宋义的青釭剑正泛着寒光。\'将密信烧了。\'项羽突然用剑尖挑起半片残简，\'传令三军：明晨鸡鸣时，本王要看见刘邦的首级悬在荥阳城头'
2025-09-26 13:46:37 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=853 预览='{"text": "青铜灯树突然爆出一声爆响，火星溅在韩信密信的\'一诺\'二字上。项羽的瞳孔在火光中收缩，信笺边缘的焦痕蜿蜒如蛇。帐外传来战马铁掌踏碎枯枝的脆响，钟离昧的剑穗已缠上案角——那柄曾斩杀宋义的青釭剑正泛着寒光。\'将密信烧了。\'项羽突然用剑尖挑起半片残简，\'传令三军：明晨鸡鸣时，本王要看见刘邦的首级悬在荥阳城头'
2025-09-26 13:46:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 186
2025-09-26 13:46:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:46:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 13:46:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 13:46:37 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:46:37 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=252 parent=249 choice='传令全军三日后出征，暗中却命工匠连夜铸造巨型投石机'
2025-09-26 13:46:37 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=252 depth=2
2025-09-26 13:46:37 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=252 completed, triggered next level depth=2
2025-09-26 13:46:37 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=252
2025-09-26 13:46:37 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 当众撕碎密信，率精骑直扑荥阳城
2025-09-26 13:46:37 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 暗中派遣死士调查彭越与韩信的勾连
2025-09-26 13:46:37 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将密信原文刻在青铜箭矢上射向汉军阵营
2025-09-26 13:46:38 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2422
2025-09-26 13:46:38 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1061 预览='\n\n```json\n{\n  "text": "铁蹄踏碎荥阳城外的枯叶，乌骓马喷着白雾冲向汉军营垒。项羽的霸王枪在月光下划出银弧，枪尖挑飞三名哨兵的头盔。\'楚霸王在此！谁敢出战？\'怒吼震得护城河浮冰碎裂。汉军阵中忽然亮起万千火把，却不见人影——韩信的计策显了形：万人空城只余木偶披甲。城头忽现黑袍人影，掷下染血的和氏璧碎片，\'鸿门宴的火，该烧回彭城了。\'",\n  "choices": [\n    {\n      "option": "挥舞霸王枪直取中军帅旗，逼迫刘邦出阵对战",\n      "summary": "以绝对武力震慑敌军",\n      "effects": {\n        "de'
2025-09-26 13:46:38 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1059 预览='```json\n{\n  "text": "铁蹄踏碎荥阳城外的枯叶，乌骓马喷着白雾冲向汉军营垒。项羽的霸王枪在月光下划出银弧，枪尖挑飞三名哨兵的头盔。\'楚霸王在此！谁敢出战？\'怒吼震得护城河浮冰碎裂。汉军阵中忽然亮起万千火把，却不见人影——韩信的计策显了形：万人空城只余木偶披甲。城头忽现黑袍人影，掷下染血的和氏璧碎片，\''
2025-09-26 13:46:38 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1047 预览='{\n  "text": "铁蹄踏碎荥阳城外的枯叶，乌骓马喷着白雾冲向汉军营垒。项羽的霸王枪在月光下划出银弧，枪尖挑飞三名哨兵的头盔。\'楚霸王在此！谁敢出战？\'怒吼震得护城河浮冰碎裂。汉军阵中忽然亮起万千火把，却不见人影——韩信的计策显了形：万人空城只余木偶披甲。城头忽现黑袍人影，掷下染血的和氏璧碎片，\'鸿门宴的火，该烧'
2025-09-26 13:46:38 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 153
2025-09-26 13:46:38 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:46:38 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 13:46:38 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 13:46:38 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:46:38 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=253 parent=250 choice='暗派亲卫携密函潜入荥阳，与彭越旧部接洽'
2025-09-26 13:46:38 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=253 depth=1
2025-09-26 13:46:38 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=253 completed, triggered next level depth=1
2025-09-26 13:46:38 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=49 node=253
2025-09-26 13:46:45 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:46:45 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2469
2025-09-26 13:46:45 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=878 预览='{"text": "项羽的巨瞳在灯影中骤然收缩，青铜灯树被掌风震得嗡鸣。他捏碎火漆信笺，韩信的字迹如刀锋般刺入眼帘——\'楚虽三户，亡秦必楚\'。帐外传来战马焦躁的刨地声，钟离昧的剑鞘正抵在沙盘上划出裂痕。\'烧了这封卖国书！\'副将项伯的暴喝被项羽一掌按住，\'传令三军饱食三日，明日卯时全军压向荥阳。\'但韩信的密信在案头渗出暗红墨迹，恍若当年咸阳宫里刘邦的血——那夜他本可取其首级，却放虎归山。帐外忽有夜枭长鸣，斥候又报：齐地降将田横暗中遣人联络项梁旧部...", "choices": [{"option": "拍案震裂青铜灯树，率八千江东子弟夜渡淮水截击汉军", "summary": "以雷霆之势展现'
2025-09-26 13:46:45 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=878 预览='{"text": "项羽的巨瞳在灯影中骤然收缩，青铜灯树被掌风震得嗡鸣。他捏碎火漆信笺，韩信的字迹如刀锋般刺入眼帘——\'楚虽三户，亡秦必楚\'。帐外传来战马焦躁的刨地声，钟离昧的剑鞘正抵在沙盘上划出裂痕。\'烧了这封卖国书！\'副将项伯的暴喝被项羽一掌按住，\'传令三军饱食三日，明日卯时全军压向荥阳。\'但韩信的密信在案头渗出暗'
2025-09-26 13:46:45 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=878 预览='{"text": "项羽的巨瞳在灯影中骤然收缩，青铜灯树被掌风震得嗡鸣。他捏碎火漆信笺，韩信的字迹如刀锋般刺入眼帘——\'楚虽三户，亡秦必楚\'。帐外传来战马焦躁的刨地声，钟离昧的剑鞘正抵在沙盘上划出裂痕。\'烧了这封卖国书！\'副将项伯的暴喝被项羽一掌按住，\'传令三军饱食三日，明日卯时全军压向荥阳。\'但韩信的密信在案头渗出暗'
2025-09-26 13:46:45 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 13:46:45 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:46:45 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:46:45 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:46:45 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:46:45 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=254 parent=249 choice='将密信当众焚毁，命人将韩信画像悬于军营各处'
2025-09-26 13:46:45 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=254 depth=2
2025-09-26 13:46:45 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=254 completed, triggered next level depth=2
2025-09-26 13:46:45 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=254
2025-09-26 13:46:45 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 拍案震裂青铜灯树，率八千江东子弟夜渡淮水截击汉军
2025-09-26 13:46:45 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命钟离昧星夜兼程，召回正在收编的江东旧部与楚地义军
2025-09-26 13:46:45 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命暗卫混入荥阳商队，将裹挟毒药的酒囊送入汉军中军大帐
2025-09-26 13:46:56 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:46:56 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2269
2025-09-26 13:46:56 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=851 预览='{"text": "铁匠铺的锻铁声震得虎帐嗡鸣，十二座青铜模具在月光下泛着冷光。项羽的瞳孔倒映着投石机逐渐成型的轮廓，却在次日朝会上当众怒斥钟离昧\'畏战\'——那将军脖颈青筋暴起，却在看见密信焦痕时突然跪地请罪。三更时分，暗卫回报荥阳城头飘起汉军赤旗，而韩信密信背面的蛇形标记，正与彭越军旗纹样如出一辙。此刻工匠送来新制的青铜弩机，机簧转动声里混着远处斥候急促的马蹄。", "choices": [{"option": "将密信残片混入投石机零件，故意让暗卫\'丢失\'在汉军必经之路", "summary": "借机埋下反间诱饵", "effects": {"delta_progress": 10, "'
2025-09-26 13:46:56 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=851 预览='{"text": "铁匠铺的锻铁声震得虎帐嗡鸣，十二座青铜模具在月光下泛着冷光。项羽的瞳孔倒映着投石机逐渐成型的轮廓，却在次日朝会上当众怒斥钟离昧\'畏战\'——那将军脖颈青筋暴起，却在看见密信焦痕时突然跪地请罪。三更时分，暗卫回报荥阳城头飘起汉军赤旗，而韩信密信背面的蛇形标记，正与彭越军旗纹样如出一辙。此刻工匠送来新制的'
2025-09-26 13:46:56 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=851 预览='{"text": "铁匠铺的锻铁声震得虎帐嗡鸣，十二座青铜模具在月光下泛着冷光。项羽的瞳孔倒映着投石机逐渐成型的轮廓，却在次日朝会上当众怒斥钟离昧\'畏战\'——那将军脖颈青筋暴起，却在看见密信焦痕时突然跪地请罪。三更时分，暗卫回报荥阳城头飘起汉军赤旗，而韩信密信背面的蛇形标记，正与彭越军旗纹样如出一辙。此刻工匠送来新制的'
2025-09-26 13:46:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 173
2025-09-26 13:46:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:46:56 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:46:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:46:56 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:46:56 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=255 parent=252 choice='当众撕碎密信，率精骑直扑荥阳城'
2025-09-26 13:46:56 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=255 depth=1
2025-09-26 13:46:56 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=255 completed, triggered next level depth=1
2025-09-26 13:47:00 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2611
2025-09-26 13:47:00 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1116 预览='\n\n```json\n{\n  "text": "铁蹄踏碎荥阳城外的枯叶，项羽的乌骓马嘶鸣着撞开汉军箭楼。火把如长蛇蜿蜒，十万旌旗在夜风中猎猎作响。他横戟劈开三名斥候，戟尖挑飞悬挂在城头的刘邦帅旗，金丝织就的\'汉\'字应声而裂。突然，暗处传来韩信的冷笑：\'霸王可知这城下埋着多少火油？\'城门轰然洞开，却不见兵马，只见韩信策马立于焦土之上，手中玉璧正映着月光——那道新添的裂痕，恰好与刘邦\'献礼\'的和氏璧严丝合缝。",\n  "choices": [\n    {\n      "option": "纵马直取韩信咽喉，以雷霆之势撕破虚张声势的陷阱",\n      "summary": "用绝对武力震慑敌军，直捣'
2025-09-26 13:47:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1114 预览='```json\n{\n  "text": "铁蹄踏碎荥阳城外的枯叶，项羽的乌骓马嘶鸣着撞开汉军箭楼。火把如长蛇蜿蜒，十万旌旗在夜风中猎猎作响。他横戟劈开三名斥候，戟尖挑飞悬挂在城头的刘邦帅旗，金丝织就的\'汉\'字应声而裂。突然，暗处传来韩信的冷笑：\'霸王可知这城下埋着多少火油？\'城门轰然洞开，却不见兵马，只见韩信策马立于焦'
2025-09-26 13:47:00 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1102 预览='{\n  "text": "铁蹄踏碎荥阳城外的枯叶，项羽的乌骓马嘶鸣着撞开汉军箭楼。火把如长蛇蜿蜒，十万旌旗在夜风中猎猎作响。他横戟劈开三名斥候，戟尖挑飞悬挂在城头的刘邦帅旗，金丝织就的\'汉\'字应声而裂。突然，暗处传来韩信的冷笑：\'霸王可知这城下埋着多少火油？\'城门轰然洞开，却不见兵马，只见韩信策马立于焦土之上，手中玉璧'
2025-09-26 13:47:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 180
2025-09-26 13:47:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:47:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:47:00 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:00 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=256 parent=250 choice='命工匠连夜仿制九斿大旗，率精锐突袭汉军粮仓'
2025-09-26 13:47:00 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=256 depth=1
2025-09-26 13:47:00 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=256 completed, triggered next level depth=1
2025-09-26 13:47:00 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:47:00 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2279
2025-09-26 13:47:00 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=877 预览='{"text": "青铜灯树爆出一声灯花，项羽的手指在韩信密信上划出裂痕。信笺边缘的朱砂印泥晕染着\'汉将韩信谨启\'字样，那字迹竟与三年前背楚归汉时的决绝判若两人。帐外传来战马铁掌踏碎冰碴的脆响，钟离昧的佩剑已出鞘半寸。\'陛下，齐地降旗飘动的方向——\'副将话音未落，项羽突然抓起案头酒爵泼向帐帘。暗卫们本能地护住面容后，露出个浑身滴水的斥候：\'汉军在敖仓囤积粮草，彭越的赤眉旗插满了谷仓！\'青铜灯树的火光在项羽瞳孔里跳动，像极了巨鹿之战焚毁秦军战旗时的火光。", "choices": [{"option": "将韩信密信撕碎掷地，命人即刻点齐兵马直扑荥阳", "summary": "以雷霆之势震慑汉'
2025-09-26 13:47:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=877 预览='{"text": "青铜灯树爆出一声灯花，项羽的手指在韩信密信上划出裂痕。信笺边缘的朱砂印泥晕染着\'汉将韩信谨启\'字样，那字迹竟与三年前背楚归汉时的决绝判若两人。帐外传来战马铁掌踏碎冰碴的脆响，钟离昧的佩剑已出鞘半寸。\'陛下，齐地降旗飘动的方向——\'副将话音未落，项羽突然抓起案头酒爵泼向帐帘。暗卫们本能地护住面容后，露'
2025-09-26 13:47:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=877 预览='{"text": "青铜灯树爆出一声灯花，项羽的手指在韩信密信上划出裂痕。信笺边缘的朱砂印泥晕染着\'汉将韩信谨启\'字样，那字迹竟与三年前背楚归汉时的决绝判若两人。帐外传来战马铁掌踏碎冰碴的脆响，钟离昧的佩剑已出鞘半寸。\'陛下，齐地降旗飘动的方向——\'副将话音未落，项羽突然抓起案头酒爵泼向帐帘。暗卫们本能地护住面容后，露'
2025-09-26 13:47:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 218
2025-09-26 13:47:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:47:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:47:00 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:00 | INFO     | api.story:continue_existing_story:488 - 故事继续生成成功
2025-09-26 13:47:00 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=254 depth=3
2025-09-26 13:47:00 | DEBUG    | core.speculation:enqueue:65 - [Speculation] skip duplicate enqueue for session=49 node=254
2025-09-26 13:47:00 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:47:00 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2018
2025-09-26 13:47:00 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=783 预览='{"text": "烈焰腾空时，韩信的面容在火舌中扭曲成嘲讽的鬼脸。项羽的戟尖挑飞灰烬，帐外传来甲胄摩擦声——三千铁骑已列阵待发。\'悬赏黄金千镒，活捉叛贼！\'他的吼声震得铜灯摇晃，却见钟离昧按剑后退半步。夜风卷起未燃尽的信笺残片，露出\'项庄舞剑\'四字，恰似当年鸿门宴的倒影。斥候飞报：荥阳汉军主力竟在焚信时分突然西撤，而齐地降军营寨升起诡异的青色狼烟。", "choices": [{"option": "当众斩杀三个犹豫不前的亲兵震慑军心", "summary": "以血腥手段强化威权", "effects": {"delta_progress": 12, "delta_risk": 8, "d'
2025-09-26 13:47:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=783 预览='{"text": "烈焰腾空时，韩信的面容在火舌中扭曲成嘲讽的鬼脸。项羽的戟尖挑飞灰烬，帐外传来甲胄摩擦声——三千铁骑已列阵待发。\'悬赏黄金千镒，活捉叛贼！\'他的吼声震得铜灯摇晃，却见钟离昧按剑后退半步。夜风卷起未燃尽的信笺残片，露出\'项庄舞剑\'四字，恰似当年鸿门宴的倒影。斥候飞报：荥阳汉军主力竟在焚信时分突然西撤，而'
2025-09-26 13:47:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=783 预览='{"text": "烈焰腾空时，韩信的面容在火舌中扭曲成嘲讽的鬼脸。项羽的戟尖挑飞灰烬，帐外传来甲胄摩擦声——三千铁骑已列阵待发。\'悬赏黄金千镒，活捉叛贼！\'他的吼声震得铜灯摇晃，却见钟离昧按剑后退半步。夜风卷起未燃尽的信笺残片，露出\'项庄舞剑\'四字，恰似当年鸿门宴的倒影。斥候飞报：荥阳汉军主力竟在焚信时分突然西撤，而'
2025-09-26 13:47:00 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 166
2025-09-26 13:47:00 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:00 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 13:47:00 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 13:47:00 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:00 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=257 parent=254 choice='拍案震裂青铜灯树，率八千江东子弟夜渡淮水截击汉军'
2025-09-26 13:47:00 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=257 depth=1
2025-09-26 13:47:00 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=257 completed, triggered next level depth=1
2025-09-26 13:47:08 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:47:08 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2786
2025-09-26 13:47:08 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=884 预览='{"text": "青铜熔炉在子夜时分发出低吼，三百工匠的喘息与铁锤声震得营帐簌簌作响。项羽的瞳孔倒映着投石机钢索上凝结的血渍——有工匠被绞进齿轮，半截手臂还攥着未完工的弩臂。\'三日...三日必成！\'监工嘶吼时，斥候快马自东方折返：\'荥阳城头新筑起三丈厚墙，彭越军竟与汉军分营而驻！\'钟离昧的剑尖划过密信暗纹，蛇形印记在火光中扭动如活物。项羽突然抓起尚带人血的钢索，将韩信密信卷成筒状，\'传令：明晨寅时，所有火把必须指向西北。\'", "choices": [{"option": "在黎明前强行完成投石机，以雷霆之势轰击荥阳城墙", "summary": "赌上西楚最后的精锐与工匠血肉", "eff'
2025-09-26 13:47:08 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=884 预览='{"text": "青铜熔炉在子夜时分发出低吼，三百工匠的喘息与铁锤声震得营帐簌簌作响。项羽的瞳孔倒映着投石机钢索上凝结的血渍——有工匠被绞进齿轮，半截手臂还攥着未完工的弩臂。\'三日...三日必成！\'监工嘶吼时，斥候快马自东方折返：\'荥阳城头新筑起三丈厚墙，彭越军竟与汉军分营而驻！\'钟离昧的剑尖划过密信暗纹，蛇形印记在'
2025-09-26 13:47:08 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=884 预览='{"text": "青铜熔炉在子夜时分发出低吼，三百工匠的喘息与铁锤声震得营帐簌簌作响。项羽的瞳孔倒映着投石机钢索上凝结的血渍——有工匠被绞进齿轮，半截手臂还攥着未完工的弩臂。\'三日...三日必成！\'监工嘶吼时，斥候快马自东方折返：\'荥阳城头新筑起三丈厚墙，彭越军竟与汉军分营而驻！\'钟离昧的剑尖划过密信暗纹，蛇形印记在'
2025-09-26 13:47:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 204
2025-09-26 13:47:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 13:47:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 13:47:08 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:08 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=258 parent=252 choice='暗中派遣死士调查彭越与韩信的勾连'
2025-09-26 13:47:08 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=258 depth=1
2025-09-26 13:47:08 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=258 completed, triggered next level depth=1
2025-09-26 13:47:09 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:47:09 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2413
2025-09-26 13:47:09 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=841 预览='{"text": "铁匠铺的火光映红半边夜空，三百工匠抡锤声震地。项羽独坐观兵台，指尖摩挲着密信背面的蛇形印记，突然将青铜酒爵砸向阶下——碎瓷声中，十二名亲卫自暗处现身，各怀不同密函。\'彭越的蛇，为何缠上韩信的剑？\'他冷笑掀开舆图，荥阳城外的汉军营地在月光下如蚁群蠕动。此时副将季布疾驰而入，手中竹简滴着血：\'北营探子回报，汉军昨夜更换了三处烽火台守将。\'", "choices": [{"option": "率五百铁骑突袭荥阳北门，趁投石机未就绪时撕开缺口", "summary": "以迅雷之势强攻薄弱环节", "effects": {"delta_progress": 12, "delta_r'
2025-09-26 13:47:09 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=841 预览='{"text": "铁匠铺的火光映红半边夜空，三百工匠抡锤声震地。项羽独坐观兵台，指尖摩挲着密信背面的蛇形印记，突然将青铜酒爵砸向阶下——碎瓷声中，十二名亲卫自暗处现身，各怀不同密函。\'彭越的蛇，为何缠上韩信的剑？\'他冷笑掀开舆图，荥阳城外的汉军营地在月光下如蚁群蠕动。此时副将季布疾驰而入，手中竹简滴着血：\'北营探子回'
2025-09-26 13:47:09 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=841 预览='{"text": "铁匠铺的火光映红半边夜空，三百工匠抡锤声震地。项羽独坐观兵台，指尖摩挲着密信背面的蛇形印记，突然将青铜酒爵砸向阶下——碎瓷声中，十二名亲卫自暗处现身，各怀不同密函。\'彭越的蛇，为何缠上韩信的剑？\'他冷笑掀开舆图，荥阳城外的汉军营地在月光下如蚁群蠕动。此时副将季布疾驰而入，手中竹简滴着血：\'北营探子回'
2025-09-26 13:47:09 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 168
2025-09-26 13:47:09 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:09 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 13:47:09 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 13:47:09 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:09 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=259 parent=252 choice='将密信原文刻在青铜箭矢上射向汉军阵营'
2025-09-26 13:47:09 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=259 depth=1
2025-09-26 13:47:09 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=259 completed, triggered next level depth=1
2025-09-26 13:47:17 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2836
2025-09-26 13:47:17 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1102 预览='\n\n```json\n{\n  "text": "烈焰吞没密信的瞬间，项羽的瞳孔在火光中收缩成两点寒星。韩信的字迹在灰烬中蜷曲成焦黑的蛇形，帐外传来士卒欢呼的声浪。钟离昧却按住剑柄，瞥见灰烬里渗出一滴暗红——那墨汁竟掺了血。\'悬赏画像！\'项羽暴喝震得青铜灯树嗡鸣，画工仓促描摹的韩信像被钉在辕门，却在深夜被暴雨冲刷得模糊不清。三日后，彭越密报荥阳粮道遭袭，可押运官坚称劫匪高喊\'楚虽三户\'，马鞍上刻着半枚烧焦的\'韩\'字烙印。",\n  "choices": [\n    {\n      "option": "率八百铁骑直扑荥阳粮道，当面质问彭越是否私通汉军",\n      "summary": "以雷霆之'
2025-09-26 13:47:17 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1100 预览='```json\n{\n  "text": "烈焰吞没密信的瞬间，项羽的瞳孔在火光中收缩成两点寒星。韩信的字迹在灰烬中蜷曲成焦黑的蛇形，帐外传来士卒欢呼的声浪。钟离昧却按住剑柄，瞥见灰烬里渗出一滴暗红——那墨汁竟掺了血。\'悬赏画像！\'项羽暴喝震得青铜灯树嗡鸣，画工仓促描摹的韩信像被钉在辕门，却在深夜被暴雨冲刷得模糊不清。三'
2025-09-26 13:47:17 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1088 预览='{\n  "text": "烈焰吞没密信的瞬间，项羽的瞳孔在火光中收缩成两点寒星。韩信的字迹在灰烬中蜷曲成焦黑的蛇形，帐外传来士卒欢呼的声浪。钟离昧却按住剑柄，瞥见灰烬里渗出一滴暗红——那墨汁竟掺了血。\'悬赏画像！\'项羽暴喝震得青铜灯树嗡鸣，画工仓促描摹的韩信像被钉在辕门，却在深夜被暴雨冲刷得模糊不清。三日后，彭越密报荥'
2025-09-26 13:47:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 187
2025-09-26 13:47:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 13:47:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 13:47:17 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:17 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=260 parent=254 choice='命钟离昧星夜兼程，召回正在收编的江东旧部与楚地义军'
2025-09-26 13:47:17 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=260 depth=1
2025-09-26 13:47:17 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=260 completed, triggered next level depth=1
2025-09-26 13:47:18 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2467
2025-09-26 13:47:18 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1127 预览='\n\n```json\n{\n  "text": "焦黑的密信灰烬在青铜灯树下翻卷，韩信的画像被钉在辕门旗杆顶端。项羽的虎目扫过列队跪拜的将士，听见有人低呼\'汉贼\'二字。钟离昧突然按住腰间鱼肠剑——沙盘上荥阳的朱砂标记旁，新添了三道暗红箭头，指向彭城粮道。\'谁在帐外窥探？\'项羽暴喝震落梁上积尘，却见副将龙且匆匆跪禀：\'齐地田横使者求见，携有田氏宗祠密匣。\'帐外忽有马蹄声骤起，斥候飞报汉军夜袭敖仓，而画像下堆积的赏金告示正被秋风掀起一角，露出背面密密麻麻的细小刀痕。",\n  "choices": [\n    {\n      "option": "将密信残片交给钟离昧彻查，同时佯装巡视粮道",\n    '
2025-09-26 13:47:18 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1125 预览='```json\n{\n  "text": "焦黑的密信灰烬在青铜灯树下翻卷，韩信的画像被钉在辕门旗杆顶端。项羽的虎目扫过列队跪拜的将士，听见有人低呼\'汉贼\'二字。钟离昧突然按住腰间鱼肠剑——沙盘上荥阳的朱砂标记旁，新添了三道暗红箭头，指向彭城粮道。\'谁在帐外窥探？\'项羽暴喝震落梁上积尘，却见副将龙且匆匆跪禀：\'齐地田横使'
2025-09-26 13:47:18 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1113 预览='{\n  "text": "焦黑的密信灰烬在青铜灯树下翻卷，韩信的画像被钉在辕门旗杆顶端。项羽的虎目扫过列队跪拜的将士，听见有人低呼\'汉贼\'二字。钟离昧突然按住腰间鱼肠剑——沙盘上荥阳的朱砂标记旁，新添了三道暗红箭头，指向彭城粮道。\'谁在帐外窥探？\'项羽暴喝震落梁上积尘，却见副将龙且匆匆跪禀：\'齐地田横使者求见，携有田氏'
2025-09-26 13:47:18 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 208
2025-09-26 13:47:18 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:18 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:47:18 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:47:18 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:18 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=261 parent=254 choice='命暗卫混入荥阳商队，将裹挟毒药的酒囊送入汉军中军大帐'
2025-09-26 13:47:18 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=261 depth=1
2025-09-26 13:47:18 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=261 completed, triggered next level depth=1
2025-09-26 13:47:30 | INFO     | api.story:continue_existing_story:362 - 收到故事继续请求，选择: 将韩信密信撕碎掷地，命人即刻点齐兵马直扑荥阳
2025-09-26 13:47:30 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将韩信密信撕碎掷地，命人即刻点齐兵马直扑荥阳
2025-09-26 13:47:50 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:47:50 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2297
2025-09-26 13:47:50 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=874 预览='{"text": "烈焰吞噬密信的瞬间，韩信的面容在火舌中扭曲成嘲弄。项羽将画像高悬辕门，墨迹未干的\'汉贼\'二字刺痛每名将士的瞳孔。三军哗变的暗流却在篝火旁暗涌——老卒们压低嗓音议论，说那画像眉眼竟与当年破釜沉舟时的韩信分毫不差。夜半，亲卫在田横使者马鞍夹层中搜出半片竹简，残文赫然写着\'楚虽三户\'。钟离昧的佩剑突然出鞘，剑尖挑起竹简时，帐外传来沛公军战鼓，震得沙盘上的楚军布防沙粒簌簌滑落。", "choices": [{"option": "当众斩杀田横使者，将首级悬于韩信画像旁", "summary": "以血洗血震慑宵小", "effects": {"delta_progress": 12'
2025-09-26 13:47:50 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=874 预览='{"text": "烈焰吞噬密信的瞬间，韩信的面容在火舌中扭曲成嘲弄。项羽将画像高悬辕门，墨迹未干的\'汉贼\'二字刺痛每名将士的瞳孔。三军哗变的暗流却在篝火旁暗涌——老卒们压低嗓音议论，说那画像眉眼竟与当年破釜沉舟时的韩信分毫不差。夜半，亲卫在田横使者马鞍夹层中搜出半片竹简，残文赫然写着\'楚虽三户\'。钟离昧的佩剑突然出鞘'
2025-09-26 13:47:50 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=874 预览='{"text": "烈焰吞噬密信的瞬间，韩信的面容在火舌中扭曲成嘲弄。项羽将画像高悬辕门，墨迹未干的\'汉贼\'二字刺痛每名将士的瞳孔。三军哗变的暗流却在篝火旁暗涌——老卒们压低嗓音议论，说那画像眉眼竟与当年破釜沉舟时的韩信分毫不差。夜半，亲卫在田横使者马鞍夹层中搜出半片竹简，残文赫然写着\'楚虽三户\'。钟离昧的佩剑突然出鞘'
2025-09-26 13:47:50 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 186
2025-09-26 13:47:50 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:47:50 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 13:47:50 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 13:47:50 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:47:50 | INFO     | api.story:continue_existing_story:488 - 故事继续生成成功
2025-09-26 13:47:50 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=262 depth=3
2025-09-26 13:47:50 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=262
2025-09-26 13:47:50 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 当众斩杀田横使者，将首级悬于韩信画像旁
2025-09-26 13:47:50 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 暗中派遣死士混入齐地商队，调查田横联络项梁旧部的细节
2025-09-26 13:47:50 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 率八千江东子弟夜袭荥阳汉营，亲自斩杀彭越以儆效尤
2025-09-26 13:48:07 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:07 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2613
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=828 预览='{"text": "战鼓撕裂夜空，楚军铁甲如黑潮漫过原野。项羽横槊立马，马蹄扬起的尘土遮蔽月光，斥候突然从侧翼跌落马背——染血的腰牌显示这是刘邦亲卫。前军传来骚动，老卒们交头接耳：\'霸王此举与鸿门放刘邦何异？\'沙尘中忽现百骑黑旗，为首者头戴鹖冠，竟是叛逃的韩信亲卫长。他嘶吼着掷来半截竹简，残文与密信如出一辙，项梁旧部的火把此刻正从齐地方向蜿蜒逼近。", "choices": [{"option": "将叛逃韩信亲卫长斩首示众，率精锐铁骑强行突入荥阳城门", "summary": "以暴制暴震慑军心", "effects": {"delta_progress": 12, "delta_risk"'
2025-09-26 13:48:07 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=828 预览='{"text": "战鼓撕裂夜空，楚军铁甲如黑潮漫过原野。项羽横槊立马，马蹄扬起的尘土遮蔽月光，斥候突然从侧翼跌落马背——染血的腰牌显示这是刘邦亲卫。前军传来骚动，老卒们交头接耳：\'霸王此举与鸿门放刘邦何异？\'沙尘中忽现百骑黑旗，为首者头戴鹖冠，竟是叛逃的韩信亲卫长。他嘶吼着掷来半截竹简，残文与密信如出一辙，项梁旧部的'
2025-09-26 13:48:07 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=828 预览='{"text": "战鼓撕裂夜空，楚军铁甲如黑潮漫过原野。项羽横槊立马，马蹄扬起的尘土遮蔽月光，斥候突然从侧翼跌落马背——染血的腰牌显示这是刘邦亲卫。前军传来骚动，老卒们交头接耳：\'霸王此举与鸿门放刘邦何异？\'沙尘中忽现百骑黑旗，为首者头戴鹖冠，竟是叛逃的韩信亲卫长。他嘶吼着掷来半截竹简，残文与密信如出一辙，项梁旧部的'
2025-09-26 13:48:07 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 165
2025-09-26 13:48:07 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:07 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:48:07 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:07 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=263 parent=262 choice='暗中派遣死士混入齐地商队，调查田横联络项梁旧部的细节'
2025-09-26 13:48:07 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=263 depth=2
2025-09-26 13:48:07 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=263 completed, triggered next level depth=2
2025-09-26 13:48:07 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=263
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将叛逃韩信亲卫长斩首示众，率精锐铁骑强行突入荥阳城门
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命降卒携带密信残片混入汉军，暗中策反荥阳守军
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 在行军途中突然转向齐地，先清剿项梁旧部再回师荥阳
2025-09-26 13:48:07 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:07 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2368
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=873 预览='{"text": "战鼓撕裂夜幕时，韩信的密信灰烬正随风飘向黄河。项羽亲提霸王枪踏碎辕门积雪，八千江东子弟铁甲映着狼烟，却在行军途中遭遇诡异变故——斥候回报荥阳城头竟同时飘起汉楚双旗，彭越营中突然响起刘邦的军号。更骇人的是，半途截获的密报显示：韩信亲率精锐已绕后突袭彭城，而田横使者正与项梁旧部在睢水河畔歃血为盟。钟离昧的佩剑插进冻土，剑柄玉珏发出裂响：\'陛下，三路大军若同时压境…\'", "choices": [{"option": "将计就计放火焚烧粮草，引刘邦主力入预设伏击圈", "summary": "以退为进的诱敌之策", "effects": {"delta_progress": 12'
2025-09-26 13:48:07 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=873 预览='{"text": "战鼓撕裂夜幕时，韩信的密信灰烬正随风飘向黄河。项羽亲提霸王枪踏碎辕门积雪，八千江东子弟铁甲映着狼烟，却在行军途中遭遇诡异变故——斥候回报荥阳城头竟同时飘起汉楚双旗，彭越营中突然响起刘邦的军号。更骇人的是，半途截获的密报显示：韩信亲率精锐已绕后突袭彭城，而田横使者正与项梁旧部在睢水河畔歃血为盟。钟离昧'
2025-09-26 13:48:07 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=873 预览='{"text": "战鼓撕裂夜幕时，韩信的密信灰烬正随风飘向黄河。项羽亲提霸王枪踏碎辕门积雪，八千江东子弟铁甲映着狼烟，却在行军途中遭遇诡异变故——斥候回报荥阳城头竟同时飘起汉楚双旗，彭越营中突然响起刘邦的军号。更骇人的是，半途截获的密报显示：韩信亲率精锐已绕后突袭彭城，而田横使者正与项梁旧部在睢水河畔歃血为盟。钟离昧'
2025-09-26 13:48:07 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 182
2025-09-26 13:48:07 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:07 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:48:07 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:07 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=264 parent=262 choice='率八千江东子弟夜袭荥阳汉营，亲自斩杀彭越以儆效尤'
2025-09-26 13:48:07 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=264 depth=2
2025-09-26 13:48:07 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=264 completed, triggered next level depth=2
2025-09-26 13:48:07 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=264
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将计就计放火焚烧粮草，引刘邦主力入预设伏击圈
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 派遣死士混入彭越军中，散布楚军粮草尽断的谣言
2025-09-26 13:48:07 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 亲率铁骑突袭睢水河畔，当面质问田横叛变真相
2025-09-26 13:48:13 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2926
2025-09-26 13:48:13 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1124 预览='\n\n```json\n{\n  "text": "战鼓震得沙盘簌簌颤动，项羽青铜铠甲上的裂痕在月光下泛着冷光。十万楚军衔枚疾进，却在距荥阳三十里处撞上彭越的鹿角阵——汉军弓弩手藏于壕沟后，箭雨如蝗。\'报！\'亲卫滚鞍落马，\'刘邦主力已绕至我军粮道，韩信旧部在阵后举起了楚字旗！\'钟离昧的佩剑劈开箭雨：\'陛下，彭越阵前换上了楚军玄甲！\'沙尘中忽现韩信白马，他单骑立于两军阵前，手中卷轴展开竟是当年巨鹿之战楚军阵图，血书\'楚虽三户\'四字浸透绢帛。",\n  "choices": [\n    {\n      "option": "挥动霸王枪冲破汉军前锋，以战阵之威震慑动摇的楚卒",\n      "summary'
2025-09-26 13:48:13 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1122 预览='```json\n{\n  "text": "战鼓震得沙盘簌簌颤动，项羽青铜铠甲上的裂痕在月光下泛着冷光。十万楚军衔枚疾进，却在距荥阳三十里处撞上彭越的鹿角阵——汉军弓弩手藏于壕沟后，箭雨如蝗。\'报！\'亲卫滚鞍落马，\'刘邦主力已绕至我军粮道，韩信旧部在阵后举起了楚字旗！\'钟离昧的佩剑劈开箭雨：\'陛下，彭越阵前换上了楚军玄甲'
2025-09-26 13:48:13 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1110 预览='{\n  "text": "战鼓震得沙盘簌簌颤动，项羽青铜铠甲上的裂痕在月光下泛着冷光。十万楚军衔枚疾进，却在距荥阳三十里处撞上彭越的鹿角阵——汉军弓弩手藏于壕沟后，箭雨如蝗。\'报！\'亲卫滚鞍落马，\'刘邦主力已绕至我军粮道，韩信旧部在阵后举起了楚字旗！\'钟离昧的佩剑劈开箭雨：\'陛下，彭越阵前换上了楚军玄甲！\'沙尘中忽现韩'
2025-09-26 13:48:13 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 195
2025-09-26 13:48:13 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:13 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:48:13 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:48:13 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:13 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=265 parent=262 choice='当众斩杀田横使者，将首级悬于韩信画像旁'
2025-09-26 13:48:13 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=265 depth=2
2025-09-26 13:48:13 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=265 completed, triggered next level depth=2
2025-09-26 13:48:13 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=265
2025-09-26 13:48:13 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 挥动霸王枪冲破汉军前锋，以战阵之威震慑动摇的楚卒
2025-09-26 13:48:13 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 下令军中散布韩信已降楚的谣言，趁彭越军阵混乱时突袭粮道
2025-09-26 13:48:13 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 斩杀传韩信密信的暗卫以儆效尤，亲率亲卫营为先锋
2025-09-26 13:48:21 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2552
2025-09-26 13:48:21 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1081 预览='\n\n{\n  "text": "死士第三日自齐地密报，田横使者正与项梁旧将密会于琅琊山坳。项羽摩挲着传国玉玺裂痕，忽见沙盘上新添的松针——那是楚军斥候暗语：韩信亲卫在商队中。夜半帐外马蹄声骤，钟离昧持血染的半幅帛画闯入：\'齐地三镇同时举火，皆以"楚虽三户"为号！\'青铜灯树突然熄灭，黑暗中传来金属拖拽声，帐顶垂下韩信的鹖冠，冠缨滴落的血正画出项羽的佩剑纹路。",\n  "choices": [\n    {\n      "option": "亲率精骑突袭琅琊山坳，当面质问田横与项梁旧部",\n      "summary": "以雷霆之势震慑叛徒",\n      "effects": {\n       '
2025-09-26 13:48:21 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1079 预览='{\n  "text": "死士第三日自齐地密报，田横使者正与项梁旧将密会于琅琊山坳。项羽摩挲着传国玉玺裂痕，忽见沙盘上新添的松针——那是楚军斥候暗语：韩信亲卫在商队中。夜半帐外马蹄声骤，钟离昧持血染的半幅帛画闯入：\'齐地三镇同时举火，皆以"楚虽三户"为号！\'青铜灯树突然熄灭，黑暗中传来金属拖拽声，帐顶垂下韩信的鹖冠，冠'
2025-09-26 13:48:21 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=1079 预览='{\n  "text": "死士第三日自齐地密报，田横使者正与项梁旧将密会于琅琊山坳。项羽摩挲着传国玉玺裂痕，忽见沙盘上新添的松针——那是楚军斥候暗语：韩信亲卫在商队中。夜半帐外马蹄声骤，钟离昧持血染的半幅帛画闯入：\'齐地三镇同时举火，皆以"楚虽三户"为号！\'青铜灯树突然熄灭，黑暗中传来金属拖拽声，帐顶垂下韩信的鹖冠，冠'
2025-09-26 13:48:21 | ERROR    | core.story_engine:_parse_node_v2:123 - [V2] 解析节点JSON失败: Expecting ',' delimiter: line 2 column 119 (char 120); 预览='{\n  "text": "死士第三日自齐地密报，田横使者正与项梁旧将密会于琅琊山坳。项羽摩挲着传国玉玺裂痕，忽见沙盘上新添的松针——那是楚军斥候暗语：韩信亲卫在商队中。夜半帐外马蹄声骤，钟离昧持血染的半幅帛画闯入：\'齐地三镇同时举火，皆以"楚虽三户"为号！\'青铜灯树突然熄灭，黑暗中传来金属拖拽声，帐顶垂下韩信的鹖冠，冠缨滴落的血正画出项羽的佩剑纹路。",\n  "choices": [\n    {\n'
2025-09-26 13:48:22 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:22 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2664
2025-09-26 13:48:22 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=857 预览='{"text": "铁蹄踏碎荥阳城门时，彭越的首级已悬在枪尖。项羽亲斩叛将的捷报传遍八方，却在黎明前遭遇诡异——汉军营寨突然燃起青磷火把，刘邦竟端坐中军帐内纹丝不动。更令人惊觉的是，韩信的亲卫从尸堆中爬出，高举残破帅旗嘶吼\'楚军内应在此\'。彭越尸体腰间暗袋里，半片竹简与田横使者所持的纹路严丝合缝。钟离昧的佩剑劈开晨雾：\'陛下，睢水方向烟尘蔽日，似有大军压境...\'", "choices": [{"option": "将韩信亲卫与竹简一同钉于城楼，悬赏十万黄金追捕田横", "summary": "以血腥示众震慑潜在叛徒", "effects": {"delta_progress": 12, "d'
2025-09-26 13:48:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=857 预览='{"text": "铁蹄踏碎荥阳城门时，彭越的首级已悬在枪尖。项羽亲斩叛将的捷报传遍八方，却在黎明前遭遇诡异——汉军营寨突然燃起青磷火把，刘邦竟端坐中军帐内纹丝不动。更令人惊觉的是，韩信的亲卫从尸堆中爬出，高举残破帅旗嘶吼\'楚军内应在此\'。彭越尸体腰间暗袋里，半片竹简与田横使者所持的纹路严丝合缝。钟离昧的佩剑劈开晨雾：'
2025-09-26 13:48:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=857 预览='{"text": "铁蹄踏碎荥阳城门时，彭越的首级已悬在枪尖。项羽亲斩叛将的捷报传遍八方，却在黎明前遭遇诡异——汉军营寨突然燃起青磷火把，刘邦竟端坐中军帐内纹丝不动。更令人惊觉的是，韩信的亲卫从尸堆中爬出，高举残破帅旗嘶吼\'楚军内应在此\'。彭越尸体腰间暗袋里，半片竹简与田横使者所持的纹路严丝合缝。钟离昧的佩剑劈开晨雾：'
2025-09-26 13:48:22 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 173
2025-09-26 13:48:22 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:22 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:48:22 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:48:22 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:22 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=266 parent=264 choice='将计就计放火焚烧粮草，引刘邦主力入预设伏击圈'
2025-09-26 13:48:22 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=266 depth=1
2025-09-26 13:48:22 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=266 completed, triggered next level depth=1
2025-09-26 13:48:22 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=49 node=266
2025-09-26 13:48:23 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:23 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2718
2025-09-26 13:48:23 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=881 预览='{"text": "战马铁蹄踏碎荥阳郊外的薄冰，项羽的霸王枪挑开汉军帅旗时，彭越正倚着刘邦的虎符饮酒。\'楚虽三户，亡秦必楚！\'项羽的怒吼震落箭楼积雪，枪尖挑飞彭越酒樽的瞬间，暗巷突然涌出千名黑甲死士——竟是韩信亲率的\'死士营\'！刘邦的军旗在城头诡异地转向，田横使者的声音通过八百健儿的传唱响彻战场：\'楚军已断后路！\'江东子弟的方阵开始出现裂痕，钟离昧的佩剑斩断三名逃卒脚筋时，睢水方向的烟尘已遮蔽月光。", "choices": [{"option": "霸王枪挑开城门，率铁骑直冲彭越帅帐", "summary": "以绝对武力强行突破核心", "effects": {"delta_progres'
2025-09-26 13:48:23 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=881 预览='{"text": "战马铁蹄踏碎荥阳郊外的薄冰，项羽的霸王枪挑开汉军帅旗时，彭越正倚着刘邦的虎符饮酒。\'楚虽三户，亡秦必楚！\'项羽的怒吼震落箭楼积雪，枪尖挑飞彭越酒樽的瞬间，暗巷突然涌出千名黑甲死士——竟是韩信亲率的\'死士营\'！刘邦的军旗在城头诡异地转向，田横使者的声音通过八百健儿的传唱响彻战场：\'楚军已断后路！\'江东'
2025-09-26 13:48:23 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=881 预览='{"text": "战马铁蹄踏碎荥阳郊外的薄冰，项羽的霸王枪挑开汉军帅旗时，彭越正倚着刘邦的虎符饮酒。\'楚虽三户，亡秦必楚！\'项羽的怒吼震落箭楼积雪，枪尖挑飞彭越酒樽的瞬间，暗巷突然涌出千名黑甲死士——竟是韩信亲率的\'死士营\'！刘邦的军旗在城头诡异地转向，田横使者的声音通过八百健儿的传唱响彻战场：\'楚军已断后路！\'江东'
2025-09-26 13:48:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 13:48:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 13:48:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 13:48:23 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:23 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=267 parent=264 choice='派遣死士混入彭越军中，散布楚军粮草尽断的谣言'
2025-09-26 13:48:23 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=267 depth=1
2025-09-26 13:48:23 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=267 completed, triggered next level depth=1
2025-09-26 13:48:28 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:28 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2538
2025-09-26 13:48:28 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=830 预览='{"text": "死士第三日回报时，项羽正用剑尖挑开荥阳方向飘来的灰烬。田横的商队确在齐地边境徘徊，但随行的项梁旧部竟佩戴着楚军虎符——那是他去年熔铸的九千枚符节，每枚都刻着自己的掌纹。暗卫突然呈上沾血的丝帛，拓印着项梁战死那日的军报残页，末尾赫然有自己亲笔签署的\'准\'字。钟离昧的佩剑突然劈开案上烛台，火苗腾起瞬间，帐外传来沛军战鼓，与齐地方言的呼喝声诡异地交织成楚歌。", "choices": [{"option": "当众斩杀田横使者，将项梁旧部押赴刑场示众", "summary": "以雷霆手段震慑叛乱", "effects": {"delta_progress": 12, "delt'
2025-09-26 13:48:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=830 预览='{"text": "死士第三日回报时，项羽正用剑尖挑开荥阳方向飘来的灰烬。田横的商队确在齐地边境徘徊，但随行的项梁旧部竟佩戴着楚军虎符——那是他去年熔铸的九千枚符节，每枚都刻着自己的掌纹。暗卫突然呈上沾血的丝帛，拓印着项梁战死那日的军报残页，末尾赫然有自己亲笔签署的\'准\'字。钟离昧的佩剑突然劈开案上烛台，火苗腾起瞬间，'
2025-09-26 13:48:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=830 预览='{"text": "死士第三日回报时，项羽正用剑尖挑开荥阳方向飘来的灰烬。田横的商队确在齐地边境徘徊，但随行的项梁旧部竟佩戴着楚军虎符——那是他去年熔铸的九千枚符节，每枚都刻着自己的掌纹。暗卫突然呈上沾血的丝帛，拓印着项梁战死那日的军报残页，末尾赫然有自己亲笔签署的\'准\'字。钟离昧的佩剑突然劈开案上烛台，火苗腾起瞬间，'
2025-09-26 13:48:28 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 177
2025-09-26 13:48:28 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:28 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 13:48:28 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 13:48:28 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:28 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=268 parent=263 choice='在行军途中突然转向齐地，先清剿项梁旧部再回师荥阳'
2025-09-26 13:48:28 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=268 depth=1
2025-09-26 13:48:28 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=268 completed, triggered next level depth=1
2025-09-26 13:48:33 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:33 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2748
2025-09-26 13:48:33 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=875 预览='{"text": "血珠溅在韩信画像的眉间，田横的首级在秋风中摇晃。彭城守军忽然传来急报：齐地三郡举火响应田横余党，城头楚字旗被连夜换作白旗。项羽的瞳孔在火把映照下收缩成竖，发现韩信画像的衣摆竟绣着彭越军的暗纹——原来那封密信的墨迹早被药水处理，烈火焚尽后才会显出真正内容。钟离昧的佩剑突然抵住副将后心：\'三日前调防的齐将，此刻竟无一人在帐！\'帐外马蹄声如惊雷炸响，斥候滚进帐来嘶声低语：\'陛下，汉军主力已破敖仓，韩信亲率五千轻骑直插楚军大营后路！\'", "choices": [{"option": "跨上乌骓马亲征齐地，将叛乱将领全族押至阵前震慑", "summary": "以雷霆手段镇压叛乱"'
2025-09-26 13:48:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=875 预览='{"text": "血珠溅在韩信画像的眉间，田横的首级在秋风中摇晃。彭城守军忽然传来急报：齐地三郡举火响应田横余党，城头楚字旗被连夜换作白旗。项羽的瞳孔在火把映照下收缩成竖，发现韩信画像的衣摆竟绣着彭越军的暗纹——原来那封密信的墨迹早被药水处理，烈火焚尽后才会显出真正内容。钟离昧的佩剑突然抵住副将后心：\'三日前调防的齐'
2025-09-26 13:48:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=875 预览='{"text": "血珠溅在韩信画像的眉间，田横的首级在秋风中摇晃。彭城守军忽然传来急报：齐地三郡举火响应田横余党，城头楚字旗被连夜换作白旗。项羽的瞳孔在火把映照下收缩成竖，发现韩信画像的衣摆竟绣着彭越军的暗纹——原来那封密信的墨迹早被药水处理，烈火焚尽后才会显出真正内容。钟离昧的佩剑突然抵住副将后心：\'三日前调防的齐'
2025-09-26 13:48:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 215
2025-09-26 13:48:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:33 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:48:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:48:33 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:33 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=269 parent=265 choice='挥动霸王枪冲破汉军前锋，以战阵之威震慑动摇的楚卒'
2025-09-26 13:48:33 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=269 depth=1
2025-09-26 13:48:33 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=269 completed, triggered next level depth=1
2025-09-26 13:48:33 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:33 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2792
2025-09-26 13:48:33 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=853 预览='{"text": "死士第三日带回消息：田横使者马车夹层暗藏陶罐，内盛盐渍青鱼——这是项梁旧部传递密令的暗号。项羽将鱼腹剖开，果然在鱼骨上刻着\'楚河汉界\'四字。子时帐中，钟离昧突然掀帘而入，腰间佩剑滴落血迹：\'齐地斥候营遭袭，三名死士尸体悬于城门，皆被挖去双目！\'帐外传来马蹄急促的响动，暗卫禀报说韩信的黑旗骑兵正向彭城侧翼迂回，而沙盘上的楚军布防图，不知何时被划出一道贯穿荥阳的裂痕。", "choices": [{"option": "将青鱼与密文公开展示，当众剖解田横使者舌骨", "summary": "震慑叛徒的血腥示众", "effects": {"delta_progress": 12'
2025-09-26 13:48:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=853 预览='{"text": "死士第三日带回消息：田横使者马车夹层暗藏陶罐，内盛盐渍青鱼——这是项梁旧部传递密令的暗号。项羽将鱼腹剖开，果然在鱼骨上刻着\'楚河汉界\'四字。子时帐中，钟离昧突然掀帘而入，腰间佩剑滴落血迹：\'齐地斥候营遭袭，三名死士尸体悬于城门，皆被挖去双目！\'帐外传来马蹄急促的响动，暗卫禀报说韩信的黑旗骑兵正向彭城'
2025-09-26 13:48:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=853 预览='{"text": "死士第三日带回消息：田横使者马车夹层暗藏陶罐，内盛盐渍青鱼——这是项梁旧部传递密令的暗号。项羽将鱼腹剖开，果然在鱼骨上刻着\'楚河汉界\'四字。子时帐中，钟离昧突然掀帘而入，腰间佩剑滴落血迹：\'齐地斥候营遭袭，三名死士尸体悬于城门，皆被挖去双目！\'帐外传来马蹄急促的响动，暗卫禀报说韩信的黑旗骑兵正向彭城'
2025-09-26 13:48:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 13:48:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:33 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:48:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:48:33 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:33 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=270 parent=263 choice='命降卒携带密信残片混入汉军，暗中策反荥阳守军'
2025-09-26 13:48:33 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=270 depth=1
2025-09-26 13:48:33 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=270 completed, triggered next level depth=1
2025-09-26 13:48:33 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:33 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2742
2025-09-26 13:48:33 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=916 预览='{"text": "血珠顺着项羽的剑锋滴落，在韩信画像前的青砖上绽开暗红梅花。田横使者首级悬挂的刹那，齐地方言的咒骂声从阵后传来——原属楚军的齐地士卒突然按剑围住楚旗，为首者竟是韩信旧部统领季布。\'楚虽三户，不斩信者！\'他腰间玉佩闪过寒光，正是当年巨鹿之战项羽所赐。钟离昧的剑阵刚要压上，斥候飞报：刘邦军主力已绕至汜水，彭越正用楚军号令调遣粮草。帐外忽有黑影掠过，沙盘上的楚军布防图竟被撕去荥阳一带，仅余\'死地\'二字用血写着。", "choices": [{"option": "斩断季布佩剑掷入火堆，当众宣布齐地士卒皆编入死士营", "summary": "以血腥手段震慑动摇军心者", "effe'
2025-09-26 13:48:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=916 预览='{"text": "血珠顺着项羽的剑锋滴落，在韩信画像前的青砖上绽开暗红梅花。田横使者首级悬挂的刹那，齐地方言的咒骂声从阵后传来——原属楚军的齐地士卒突然按剑围住楚旗，为首者竟是韩信旧部统领季布。\'楚虽三户，不斩信者！\'他腰间玉佩闪过寒光，正是当年巨鹿之战项羽所赐。钟离昧的剑阵刚要压上，斥候飞报：刘邦军主力已绕至汜水，'
2025-09-26 13:48:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=916 预览='{"text": "血珠顺着项羽的剑锋滴落，在韩信画像前的青砖上绽开暗红梅花。田横使者首级悬挂的刹那，齐地方言的咒骂声从阵后传来——原属楚军的齐地士卒突然按剑围住楚旗，为首者竟是韩信旧部统领季布。\'楚虽三户，不斩信者！\'他腰间玉佩闪过寒光，正是当年巨鹿之战项羽所赐。钟离昧的剑阵刚要压上，斥候飞报：刘邦军主力已绕至汜水，'
2025-09-26 13:48:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 203
2025-09-26 13:48:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:33 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:48:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:48:33 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:33 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=271 parent=265 choice='斩杀传韩信密信的暗卫以儆效尤，亲率亲卫营为先锋'
2025-09-26 13:48:33 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=271 depth=1
2025-09-26 13:48:33 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=271 completed, triggered next level depth=1
2025-09-26 13:48:35 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2884
2025-09-26 13:48:35 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1116 预览='\n\n```json\n{\n  "text": "项羽的霸王枪挑开荥阳城头汉军旌旗时，彭越的血正溅在青铜枪缨上。但城内杀声骤变，韩信的玄甲精骑竟从地窖暗道涌出，将楚军先锋截成两段。项羽怒吼着挥枪连斩七员汉将，忽见彭越帅帐后转出田横，手中正握着项梁旧部的兵符。\'楚军粮道已被彭越残部烧毁！\'亲卫的嘶喊与韩信的战鼓同时炸响，八千江东子弟的阵型在三面夹击中开始松动，远处睢水河畔腾起的狼烟正与楚军旗幡诡异地交错。",\n  "choices": [\n    {\n      "option": "挥动霸王枪劈开血路，直取韩信帅旗以重振军心",\n      "summary": "以绝对武力压制战场局势",\n  '
2025-09-26 13:48:35 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1114 预览='```json\n{\n  "text": "项羽的霸王枪挑开荥阳城头汉军旌旗时，彭越的血正溅在青铜枪缨上。但城内杀声骤变，韩信的玄甲精骑竟从地窖暗道涌出，将楚军先锋截成两段。项羽怒吼着挥枪连斩七员汉将，忽见彭越帅帐后转出田横，手中正握着项梁旧部的兵符。\'楚军粮道已被彭越残部烧毁！\'亲卫的嘶喊与韩信的战鼓同时炸响，八千江东'
2025-09-26 13:48:35 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1102 预览='{\n  "text": "项羽的霸王枪挑开荥阳城头汉军旌旗时，彭越的血正溅在青铜枪缨上。但城内杀声骤变，韩信的玄甲精骑竟从地窖暗道涌出，将楚军先锋截成两段。项羽怒吼着挥枪连斩七员汉将，忽见彭越帅帐后转出田横，手中正握着项梁旧部的兵符。\'楚军粮道已被彭越残部烧毁！\'亲卫的嘶喊与韩信的战鼓同时炸响，八千江东子弟的阵型在三面'
2025-09-26 13:48:35 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 178
2025-09-26 13:48:35 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:35 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 13:48:35 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 13:48:35 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:35 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=272 parent=264 choice='亲率铁骑突袭睢水河畔，当面质问田横叛变真相'
2025-09-26 13:48:35 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=272 depth=1
2025-09-26 13:48:35 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=272 completed, triggered next level depth=1
2025-09-26 13:48:37 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:37 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2715
2025-09-26 13:48:37 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=861 预览='{"text": "血珠溅上青铜灯树时，田横使者的头颅正被铁钩贯穿悬于画像旁。韩信的面容在血泊中愈发清晰，与那颗无头躯干形成诡异对称。齐地降卒突然齐刷刷跪倒，有人嘶吼\'霸王不仁！\'，马厩方向传来铁甲翻倒的巨响。钟离昧的佩剑已劈开三名躁动士卒，项羽却盯着画像右下角——韩信的左手小指竟少了一截，与悬首上的残缺完美契合。夜风骤起，刘邦军的火把突然在东南方连成赤龙，而沙盘上的楚军布防图正被血水浸透成狰狞鬼面。", "choices": [{"option": "策马直冲齐军大营，用断头台威慑降卒", "summary": "以暴制暴的震慑策略", "effects": {"delta_progress'
2025-09-26 13:48:37 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=861 预览='{"text": "血珠溅上青铜灯树时，田横使者的头颅正被铁钩贯穿悬于画像旁。韩信的面容在血泊中愈发清晰，与那颗无头躯干形成诡异对称。齐地降卒突然齐刷刷跪倒，有人嘶吼\'霸王不仁！\'，马厩方向传来铁甲翻倒的巨响。钟离昧的佩剑已劈开三名躁动士卒，项羽却盯着画像右下角——韩信的左手小指竟少了一截，与悬首上的残缺完美契合。夜风'
2025-09-26 13:48:37 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=861 预览='{"text": "血珠溅上青铜灯树时，田横使者的头颅正被铁钩贯穿悬于画像旁。韩信的面容在血泊中愈发清晰，与那颗无头躯干形成诡异对称。齐地降卒突然齐刷刷跪倒，有人嘶吼\'霸王不仁！\'，马厩方向传来铁甲翻倒的巨响。钟离昧的佩剑已劈开三名躁动士卒，项羽却盯着画像右下角——韩信的左手小指竟少了一截，与悬首上的残缺完美契合。夜风'
2025-09-26 13:48:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 192
2025-09-26 13:48:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 13:48:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 13:48:37 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:37 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=273 parent=265 choice='下令军中散布韩信已降楚的谣言，趁彭越军阵混乱时突袭粮道'
2025-09-26 13:48:37 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=273 depth=1
2025-09-26 13:48:37 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=273 completed, triggered next level depth=1
2025-09-26 13:48:57 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 13:48:57 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1884
2025-09-26 13:48:57 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=851 预览='{"text": "死士第三日自齐地密报，田横使者正与项梁旧将密会于琅琊山坳。项羽摩挲着传国玉玺裂痕，忽见沙盘上新添的松针——那是楚军斥候暗语：韩信亲卫在商队中。夜半帐外马蹄声骤，钟离昧持血染的半幅帛画闯入：\'齐地三镇同时举火，皆以\\"楚虽三户\\"为号！\'青铜灯树突然熄灭，黑暗中传来金属拖拽声，帐顶垂下韩信的鹖冠，冠缨'
2025-09-26 13:48:57 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=851 预览='{"text": "死士第三日自齐地密报，田横使者正与项梁旧将密会于琅琊山坳。项羽摩挲着传国玉玺裂痕，忽见沙盘上新添的松针——那是楚军斥候暗语：韩信亲卫在商队中。夜半帐外马蹄声骤，钟离昧持血染的半幅帛画闯入：\'齐地三镇同时举火，皆以\\"楚虽三户\\"为号！\'青铜灯树突然熄灭，黑暗中传来金属拖拽声，帐顶垂下韩信的鹖冠，冠缨'
2025-09-26 13:48:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 163
2025-09-26 13:48:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 13:48:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 13:48:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 13:48:57 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 13:48:57 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=274 parent=263 choice='将叛逃韩信亲卫长斩首示众，率精锐铁骑强行突入荥阳城门'
2025-09-26 13:48:57 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=49 node=274 depth=1
2025-09-26 13:48:57 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=274 completed, triggered next level depth=1
2025-09-26 14:02:41 | INFO     | api.story:continue_existing_story:362 - 收到故事继续请求，选择: 当众斩杀田横使者，将首级悬于韩信画像旁
2025-09-26 14:04:26 | INFO     | api.story:continue_existing_story:362 - 收到故事继续请求，选择: 挥动霸王枪冲破汉军前锋，以战阵之威震慑动摇的楚卒
2025-09-26 14:12:01 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:12:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:12:03 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:12:03 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:12:03 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:12:03 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:12:03 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:12:03 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:04 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:12:04 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:12:04 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:12:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:05 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:12:05 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:12:05 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:12:05 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:12:05 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:12:24 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:12:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:12:26 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:12:26 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:12:26 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:12:26 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:12:26 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:12:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:26 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:12:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:12:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:12:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:27 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:12:27 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:12:27 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:12:27 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:12:27 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:12:51 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:12:53 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:12:54 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:12:54 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:12:54 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:12:54 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:12:54 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:12:54 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:54 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:12:54 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:12:54 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:12:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:12:55 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:12:55 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:12:55 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:12:55 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:12:55 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:05 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:13:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:13:07 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:13:07 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:13:07 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:13:07 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:07 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:13:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:08 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:13:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:13:08 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:13:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:13:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:13:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:13:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:13:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:23 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:13:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:13:26 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:13:26 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:13:26 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:13:26 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:26 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:13:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:26 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:13:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:13:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:13:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:13:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:13:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:13:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:13:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:40 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:13:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:13:42 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:13:42 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:13:42 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:13:42 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:42 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:13:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:42 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:13:42 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:13:42 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:13:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:43 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:13:43 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:13:43 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:13:43 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:13:43 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:53 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:13:54 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:13:55 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:13:55 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:13:55 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:13:55 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:13:55 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:13:55 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:56 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:13:56 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:13:56 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:13:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:13:56 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:13:56 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:13:56 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:13:56 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:13:56 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:14:11 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:14:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:14:13 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:14:13 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:14:13 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:14:13 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:14:13 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:14:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:13 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:14:13 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:14:13 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:14:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:14:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:14:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:14:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:14:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:14:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:14:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:14:31 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:14:31 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:14:31 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:14:31 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:14:31 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:14:31 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:31 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:14:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:14:31 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:14:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:32 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:14:32 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:14:32 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:14:32 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:14:32 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:14:37 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:14:38 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:14:39 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:14:39 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:14:39 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:14:39 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:14:39 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:14:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:39 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:14:39 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:14:39 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:14:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:14:40 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:14:40 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:14:40 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:14:40 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:14:40 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:15:09 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:15:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:15:11 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:15:11 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:15:11 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:15:11 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:15:11 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:15:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:11 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:15:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:15:11 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:15:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:12 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:15:12 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:15:12 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:15:12 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:15:12 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:15:18 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:15:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:15:20 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:15:20 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:15:20 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:15:20 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:15:20 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:15:20 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:20 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:15:20 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:15:20 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:15:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:21 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:15:21 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:15:21 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:15:21 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:15:21 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:15:32 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:15:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:15:34 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:15:34 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:15:34 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:15:34 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:15:34 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:15:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:34 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:15:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:15:34 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:15:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:15:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:15:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:15:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:15:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:15:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:22:43 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:22:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:22:47 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:22:48 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:22:48 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:22:48 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:22:48 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:22:48 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:22:48 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:22:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:22:48 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:22:48 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:22:48 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:22:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:22:49 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:22:49 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:22:49 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:22:49 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:22:49 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:23:04 | INFO     | api.story:prepare_start_level:139 - 开始生成故事概要，愿望：项羽...
2025-09-26 14:23:17 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1594
2025-09-26 14:24:51 | INFO     | api.story:start_new_story:232 - 用户 49ca3f6d-ae3c-44f5-9471-9d51d56ac473 收到新故事请求，愿望: 项羽
2025-09-26 14:24:51 | INFO     | api.story:start_new_story:238 - 开始生成第一节故事: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 14:24:51 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 14:25:08 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 14:25:08 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2017
2025-09-26 14:25:08 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=847 预览='{"text": "残阳如血，乌江渡口的战旗在朔风中猎猎作响。项羽的铠甲映着暮色泛着冷光，八千江东子弟的喘息声里混杂着远处刘邦联军的号角。中军帐内，范增的玉斗碎在案几上，残留着鸿门宴的余温。斥候急报：韩信已屯兵固陵，彭越截断粮道，而咸阳传来的密函更令他血脉偾张——刘邦竟以楚共王之位收买英布。帐外传来战马嘶鸣，虞姬的琴声忽地凝滞，弦音在暮色中碎成寒霜。", "choices": [{"option": "率八千子弟夜袭固陵大营，以火牛阵撕开缺口", "summary": "孤注一掷的雷霆攻势", "effects": {"delta_progress": 12, "delta_risk": 10'
2025-09-26 14:25:08 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=847 预览='{"text": "残阳如血，乌江渡口的战旗在朔风中猎猎作响。项羽的铠甲映着暮色泛着冷光，八千江东子弟的喘息声里混杂着远处刘邦联军的号角。中军帐内，范增的玉斗碎在案几上，残留着鸿门宴的余温。斥候急报：韩信已屯兵固陵，彭越截断粮道，而咸阳传来的密函更令他血脉偾张——刘邦竟以楚共王之位收买英布。帐外传来战马嘶鸣，虞姬的琴声'
2025-09-26 14:25:08 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=847 预览='{"text": "残阳如血，乌江渡口的战旗在朔风中猎猎作响。项羽的铠甲映着暮色泛着冷光，八千江东子弟的喘息声里混杂着远处刘邦联军的号角。中军帐内，范增的玉斗碎在案几上，残留着鸿门宴的余温。斥候急报：韩信已屯兵固陵，彭越截断粮道，而咸阳传来的密函更令他血脉偾张——刘邦竟以楚共王之位收买英布。帐外传来战马嘶鸣，虞姬的琴声'
2025-09-26 14:25:08 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: 1 validation error for ChoiceOption
success_rate_delta
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/int_type
2025-09-26 14:25:10 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:25:11 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:25:12 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:25:12 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:25:12 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:25:12 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:25:12 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:25:12 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:25:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:25:12 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:25:12 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:25:12 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:25:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:25:13 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:25:13 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:25:13 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:25:13 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:25:13 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:26:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:26:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:27:00 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:27:00 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:27:00 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:27:00 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:27:00 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:27:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:27:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:27:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:27:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:27:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:27:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:27:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:27:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:27:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:27:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:27:14 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:27:14 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:27:14 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:27:14 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:27:14 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:27:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:14 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:27:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:27:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:27:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:27:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:27:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:27:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:27:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:27:24 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:27:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:27:25 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:27:25 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:27:25 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:27:25 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:27:25 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:27:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:26 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:27:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:27:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:27:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:27:26 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:27:26 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:27:26 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:27:26 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:27:26 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:27:59 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:28:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:28:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:28:05 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:28:05 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:28:05 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:28:05 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:28:05 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:28:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:28:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:28:05 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:28:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:28:05 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:28:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:28:06 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:28:06 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:28:06 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:28:06 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:28:06 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:28:24 | INFO     | api.story:prepare_start_level:158 - 开始生成故事概要，愿望：黄忠...
2025-09-26 14:28:37 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1621
2025-09-26 14:28:37 | INFO     | api.story:_background_generate_first_story:72 - [预生成] 开始生成第一节故事: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 14:28:37 | INFO     | api.story:prepare_start_level:234 - [预生成] 已启动后台第一节故事生成线程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 14:28:37 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '黄忠'
2025-09-26 14:28:53 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 14:28:53 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1966
2025-09-26 14:28:53 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=832 预览='{"text": "建安二十四年的秋夜，汉中定军山下飘着细雨。黄忠握紧青龙偃月刀，刀刃映出远处曹军营寨的灯火。斥候刚传来急报：夏侯渊正调集精锐准备黎明突袭。帐外马蹄声突然密集，老将眯起眼睛——那是赵云亲卫的特殊暗号，意味着主公刘备派来的密使正在穿越峡谷。但三路伏兵已封锁所有通道，若不能在鸡鸣前护送密使抵达，不仅汉中战局将逆转，更可能改变整个三国鼎立的轨迹。", "choices": [{"option": "点燃箭矢发起火攻，趁夜突袭敌营粮草", "summary": "以火攻制造混乱掩护密使", "effects": {"delta_progress": 12, "delta_risk": '
2025-09-26 14:28:53 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=832 预览='{"text": "建安二十四年的秋夜，汉中定军山下飘着细雨。黄忠握紧青龙偃月刀，刀刃映出远处曹军营寨的灯火。斥候刚传来急报：夏侯渊正调集精锐准备黎明突袭。帐外马蹄声突然密集，老将眯起眼睛——那是赵云亲卫的特殊暗号，意味着主公刘备派来的密使正在穿越峡谷。但三路伏兵已封锁所有通道，若不能在鸡鸣前护送密使抵达，不仅汉中战局'
2025-09-26 14:28:53 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=832 预览='{"text": "建安二十四年的秋夜，汉中定军山下飘着细雨。黄忠握紧青龙偃月刀，刀刃映出远处曹军营寨的灯火。斥候刚传来急报：夏侯渊正调集精锐准备黎明突袭。帐外马蹄声突然密集，老将眯起眼睛——那是赵云亲卫的特殊暗号，意味着主公刘备派来的密使正在穿越峡谷。但三路伏兵已封锁所有通道，若不能在鸡鸣前护送密使抵达，不仅汉中战局'
2025-09-26 14:28:53 | ERROR    | api.story:_background_generate_first_story:78 - [预生成] 第一节故事生成失败: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, error=1 validation error for ChoiceOption
success_rate_delta
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/int_type
2025-09-26 14:29:26 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 14:29:27 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:29:28 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:29:28 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:29:28 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:29:28 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:29:28 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:29:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:29:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:29:28 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:29:28 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:29:28 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:29:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:29:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:29:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:29:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:29:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:29:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:35:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:35:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 14:36:00 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 14:36:00 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 14:36:00 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 14:36:00 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 14:36:00 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 14:36:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:36:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:36:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 14:36:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 14:36:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 14:36:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 14:36:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 14:36:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 14:36:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 14:36:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 14:36:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 14:38:47 | INFO     | api.story:prepare_start_level:158 - 开始生成故事概要，愿望：张飞...
2025-09-26 14:39:03 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1721
2025-09-26 14:39:03 | INFO     | api.story:_background_generate_first_story:72 - [预生成] 开始生成第一节故事: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 14:39:03 | INFO     | api.story:prepare_start_level:234 - [预生成] 已启动后台第一节故事生成线程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 14:39:03 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '张飞'
2025-09-26 14:39:15 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 14:39:15 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1867
2025-09-26 14:39:15 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=792 预览='{"text": "残阳如血，长坂坡的焦土上飘荡着铁锈与硝烟。张飞勒马立于断桥残桩前，身后是溃散的曹军追骑，眼前是蜿蜒的汉水。他忽然勒紧缰绳——对岸隐约传来鼓角声，分明是刘备主力已偏离原定路线！若此刻折返救援，必会暴露断后虚实；若继续诱敌深入，又恐粮道被截。马蹄声由远及近，张飞的丈八蛇矛在地上划出火星，喉间低吼惊起芦苇丛中一群寒鸦。", "choices": [{"option": "将战马猛然转向，高举蛇矛直指曹军阵眼", "summary": "以威势震慑敌阵争取时间", "effects": {"delta_progress": 12, "delta_risk": 10, "delta_'
2025-09-26 14:39:15 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=792 预览='{"text": "残阳如血，长坂坡的焦土上飘荡着铁锈与硝烟。张飞勒马立于断桥残桩前，身后是溃散的曹军追骑，眼前是蜿蜒的汉水。他忽然勒紧缰绳——对岸隐约传来鼓角声，分明是刘备主力已偏离原定路线！若此刻折返救援，必会暴露断后虚实；若继续诱敌深入，又恐粮道被截。马蹄声由远及近，张飞的丈八蛇矛在地上划出火星，喉间低吼惊起芦苇'
2025-09-26 14:39:15 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=792 预览='{"text": "残阳如血，长坂坡的焦土上飘荡着铁锈与硝烟。张飞勒马立于断桥残桩前，身后是溃散的曹军追骑，眼前是蜿蜒的汉水。他忽然勒紧缰绳——对岸隐约传来鼓角声，分明是刘备主力已偏离原定路线！若此刻折返救援，必会暴露断后虚实；若继续诱敌深入，又恐粮道被截。马蹄声由远及近，张飞的丈八蛇矛在地上划出火星，喉间低吼惊起芦苇'
2025-09-26 14:39:15 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 157
2025-09-26 14:39:15 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 14:39:15 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 14:39:15 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 14:39:15 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 14:39:15 | INFO     | api.story:_background_generate_first_story:76 - [预生成] 第一节故事生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:33:38 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:33:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:33:40 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:33:40 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:33:40 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:33:40 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:33:40 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:33:40 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:33:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:33:40 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:33:40 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:33:40 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:33:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:33:41 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:33:41 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:33:41 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:33:41 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:33:41 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:33:48 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:33:49 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:33:50 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:33:50 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:33:50 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:33:50 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:33:50 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:33:50 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:33:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:33:50 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:33:50 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:33:50 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:33:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:33:51 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:33:51 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:33:51 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:33:51 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:33:51 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:03 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:34:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:34:05 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:34:05 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:34:05 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:34:05 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:05 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:34:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:05 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:34:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:34:05 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:34:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:06 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:34:06 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:34:06 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:34:06 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:34:06 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:18 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:34:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:34:20 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:34:20 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:34:20 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:34:20 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:20 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:34:20 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:20 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:34:20 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:34:20 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:34:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:21 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:34:21 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:34:21 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:34:21 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:34:21 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:27 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:34:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:34:29 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:34:29 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:34:29 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:34:29 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:29 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:34:29 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:29 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:34:29 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:34:29 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:34:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:30 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:34:30 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:34:30 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:34:30 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:34:30 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:42 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:34:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:34:59 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:34:59 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:34:59 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:34:59 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:34:59 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:34:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:34:59 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:34:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:34:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:35:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:00 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:35:00 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:35:00 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:35:00 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:35:00 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:35:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:35:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:35:09 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:35:09 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:35:09 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:35:09 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:35:09 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:35:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:09 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:35:09 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:35:09 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:35:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:10 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:35:10 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:35:10 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:35:10 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:35:10 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:35:21 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:35:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:35:23 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:35:23 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:35:23 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:35:23 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:35:23 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:35:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:23 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:35:23 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:35:23 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:35:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:35:24 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:35:24 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:35:24 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:35:24 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:35:24 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:36:02 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:36:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:36:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:36:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:36:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:36:17 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:36:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:36:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:36:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:36:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:36:17 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:36:17 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:36:17 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:36:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:36:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:36:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:36:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:36:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:36:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:36:37 | INFO     | api.story:prepare_start_level:189 - 开始生成故事概要，愿望：刘备...
2025-09-26 15:37:15 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1760
2025-09-26 15:37:15 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:37:15 | INFO     | api.story:prepare_start_level:265 - [预生成] 已启动后台完整故事生成线程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:37:15 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-26 15:39:32 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:39:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:39:34 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:39:34 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:39:34 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:39:34 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:39:34 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:39:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:39:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:39:34 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:39:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:39:34 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:39:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:39:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:39:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:39:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:39:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:39:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:40:43 | INFO     | api.story:prepare_start_level:190 - 开始生成故事概要，愿望：关羽...
2025-09-26 15:42:11 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1598
2025-09-26 15:42:11 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:42:11 | INFO     | api.story:prepare_start_level:266 - [预生成] 已启动后台完整故事生成线程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:42:11 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:42:11 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-26 15:42:47 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:42:47 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2035
2025-09-26 15:42:47 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=817 预览='{"text": "赤兔马的铁蹄踏碎月光，你策马立于汉中咽喉要道。前方曹军营寨篝火连绵，斥候往来如织。帐内传来曹操与夏侯惇的争执声，\'关羽若真降我，何须三日不归？\'你攥紧青龙偃月刀，发现地图残片上标记着一条废弃的栈道——那是当年韩信暗度陈仓的古道。若此刻折返，或许能改变整个汉中之战的走向，但身后追兵的号角声已在山坳间回荡。", "choices": [{"option": "将火把掷向侧翼山林，制造敌军分兵灭火的混乱", "summary": "利用环境制造战术机会", "effects": {"delta_progress": 12, "delta_risk": 7, "delta_expo'
2025-09-26 15:42:47 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=817 预览='{"text": "赤兔马的铁蹄踏碎月光，你策马立于汉中咽喉要道。前方曹军营寨篝火连绵，斥候往来如织。帐内传来曹操与夏侯惇的争执声，\'关羽若真降我，何须三日不归？\'你攥紧青龙偃月刀，发现地图残片上标记着一条废弃的栈道——那是当年韩信暗度陈仓的古道。若此刻折返，或许能改变整个汉中之战的走向，但身后追兵的号角声已在山坳间回'
2025-09-26 15:42:47 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=817 预览='{"text": "赤兔马的铁蹄踏碎月光，你策马立于汉中咽喉要道。前方曹军营寨篝火连绵，斥候往来如织。帐内传来曹操与夏侯惇的争执声，\'关羽若真降我，何须三日不归？\'你攥紧青龙偃月刀，发现地图残片上标记着一条废弃的栈道——那是当年韩信暗度陈仓的古道。若此刻折返，或许能改变整个汉中之战的走向，但身后追兵的号角声已在山坳间回'
2025-09-26 15:42:47 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 152
2025-09-26 15:42:47 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:42:47 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 15:42:47 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 15:42:47 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 15:42:47 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, text长度=152
2025-09-26 15:42:47 | ERROR    | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程失败: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, error=invalid literal for int() with base 10: '49ca3f6d-ae3c-44f5-9471-9d51d56ac473'
2025-09-26 15:42:47 | DEBUG    | api.story:_background_generate_with_pregeneration:111 - [预生成] 数据库会话已安全关闭: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:43:55 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:43:57 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:43:57 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:43:57 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:43:57 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:43:57 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:43:57 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:43:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:43:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:43:58 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:43:58 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:43:58 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:43:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:43:58 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:43:58 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:43:58 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:43:58 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:43:58 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:45:41 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 15:45:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:45:48 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 15:45:49 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 15:45:49 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 15:45:49 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 15:45:49 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 15:45:49 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 15:45:49 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:45:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:45:49 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 15:45:49 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 15:45:49 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 15:45:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 15:45:50 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 15:45:50 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 15:45:50 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 15:45:50 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 15:45:50 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 15:46:28 | INFO     | api.story:prepare_start_level:190 - 开始生成故事概要，愿望：马超...
2025-09-26 15:47:49 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1462
2025-09-26 15:47:49 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:47:49 | INFO     | api.story:prepare_start_level:266 - [预生成] 已启动后台完整故事生成线程: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:47:49 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:47:49 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '马超'
2025-09-26 15:50:32 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:50:32 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1976
2025-09-26 15:50:32 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=824 预览='{"text": "马蹄踏碎渭水寒雾，马超的银枪在月光下泛着冷光。汉中城头曹操的旌旗猎猎作响，城下却传来百姓哭嚎——曹军正以流民为人盾推进。你勒马立于断崖，远处火光映出三路伏兵的轮廓。斥候突然滚落崖边，血沫中吐出半句密报：\'西凉...粮道...被劫...\' 战鼓声从三个方向同时逼近，沙尘遮蔽了星河。", "choices": [{"option": "纵马直冲曹操大营中军帅旗，用银枪挑飞曹字大纛", "summary": "以威势震慑敌胆的孤注一掷", "effects": {"delta_progress": 12, "delta_risk": 10, "delta_exposure": 8'
2025-09-26 15:50:32 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=824 预览='{"text": "马蹄踏碎渭水寒雾，马超的银枪在月光下泛着冷光。汉中城头曹操的旌旗猎猎作响，城下却传来百姓哭嚎——曹军正以流民为人盾推进。你勒马立于断崖，远处火光映出三路伏兵的轮廓。斥候突然滚落崖边，血沫中吐出半句密报：\'西凉...粮道...被劫...\' 战鼓声从三个方向同时逼近，沙尘遮蔽了星河。", "choice'
2025-09-26 15:50:32 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=824 预览='{"text": "马蹄踏碎渭水寒雾，马超的银枪在月光下泛着冷光。汉中城头曹操的旌旗猎猎作响，城下却传来百姓哭嚎——曹军正以流民为人盾推进。你勒马立于断崖，远处火光映出三路伏兵的轮廓。斥候突然滚落崖边，血沫中吐出半句密报：\'西凉...粮道...被劫...\' 战鼓声从三个方向同时逼近，沙尘遮蔽了星河。", "choice'
2025-09-26 15:50:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 140
2025-09-26 15:50:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:50:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 15:50:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 15:50:32 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 15:50:32 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, text长度=140
2025-09-26 15:50:32 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=50
2025-09-26 15:50:32 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=275
2025-09-26 15:50:32 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=275 depth=3
2025-09-26 15:50:32 | INFO     | api.story:_background_generate_with_pregeneration:97 - [预生成] 已触发speculation预生成: session=50, node=275
2025-09-26 15:50:32 | INFO     | api.story:_background_generate_with_pregeneration:99 - [预生成] 完整流程成功完成: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473, session=50
2025-09-26 15:50:32 | DEBUG    | api.story:_background_generate_with_pregeneration:111 - [预生成] 数据库会话已安全关闭: user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473
2025-09-26 15:50:32 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=275
2025-09-26 15:50:32 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 纵马直冲曹操大营中军帅旗，用银枪挑飞曹字大纛
2025-09-26 15:50:32 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 拆散亲兵分作三队，伪装成曹军向三路伏兵发起突袭
2025-09-26 15:50:32 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 带领残部退入山谷，点燃事先埋藏的火油引曹军自焚
2025-09-26 15:51:51 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:51:51 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2103
2025-09-26 15:51:51 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=817 预览='{"text": "马蹄声撕裂夜幕，你攥紧寒铁枪，斥候临终的断语在耳畔炸响。西凉粮道被劫意味着军心将溃，而曹军三路伏兵已呈合围之势。城下哭嚎声忽被利箭破空声截断——夏侯渊的玄甲重骑正从侧翼杀出。你瞥见渭水对岸有片芦苇荡随风起伏，而某面残破的羌字旗在东南角城楼若隐若现。战鼓声中，三支流民队伍突然转向你所在崖壁，火把连成赤红锁链。", "choices": [{"option": "纵马直冲曹军阵前，以银枪劈开人盾洪流", "summary": "用绝对武勇撕开突破口", "effects": {"delta_progress": 12, "delta_risk": 10, "delta_expo'
2025-09-26 15:51:51 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=817 预览='{"text": "马蹄声撕裂夜幕，你攥紧寒铁枪，斥候临终的断语在耳畔炸响。西凉粮道被劫意味着军心将溃，而曹军三路伏兵已呈合围之势。城下哭嚎声忽被利箭破空声截断——夏侯渊的玄甲重骑正从侧翼杀出。你瞥见渭水对岸有片芦苇荡随风起伏，而某面残破的羌字旗在东南角城楼若隐若现。战鼓声中，三支流民队伍突然转向你所在崖壁，火把连成赤'
2025-09-26 15:51:51 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=817 预览='{"text": "马蹄声撕裂夜幕，你攥紧寒铁枪，斥候临终的断语在耳畔炸响。西凉粮道被劫意味着军心将溃，而曹军三路伏兵已呈合围之势。城下哭嚎声忽被利箭破空声截断——夏侯渊的玄甲重骑正从侧翼杀出。你瞥见渭水对岸有片芦苇荡随风起伏，而某面残破的羌字旗在东南角城楼若隐若现。战鼓声中，三支流民队伍突然转向你所在崖壁，火把连成赤'
2025-09-26 15:51:51 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 154
2025-09-26 15:51:51 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:51:51 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 15:51:51 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 15:51:51 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:51:51 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=276 parent=275 choice='拆散亲兵分作三队，伪装成曹军向三路伏兵发起突袭'
2025-09-26 15:51:51 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=276 depth=2
2025-09-26 15:51:51 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=276 completed, triggered next level depth=2
2025-09-26 15:51:51 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=276
2025-09-26 15:51:51 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 纵马直冲曹军阵前，以银枪劈开人盾洪流
2025-09-26 15:51:51 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将密报残片抛向流民，高呼'西凉断粮者必是曹操奸计'
2025-09-26 15:51:51 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 策马跃入渭水芦苇荡，循羌字旗方向疾驰
2025-09-26 15:52:02 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2302
2025-09-26 15:52:02 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1136 预览='\n\n```json\n{\n  "text": "马蹄声在断崖边骤然凝滞。你攥紧银枪，斥候滚落前的断语在耳畔炸响——西凉粮道被劫，汉中城内必有内应！曹军三路伏兵的火把在夜色中连成赤链，裹挟着流民的哭嚎步步紧逼。突然，西北方的沙尘中亮起一簇幽蓝火光，那是韩遂军特有的信号。你猛然勒马，枪尖挑起崖边碎石，石子滚落的轨迹正巧划过流民阵后方的阴影——那里有数十具被缚的西凉商队马匹。",\n  "choices": [\n    {\n      "option": "纵马直冲曹军阵前，以银枪挑翻举火把的士卒，直指中军大旗",\n      "summary": "以武破局震慑敌胆",\n      "effects"'
2025-09-26 15:52:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1134 预览='```json\n{\n  "text": "马蹄声在断崖边骤然凝滞。你攥紧银枪，斥候滚落前的断语在耳畔炸响——西凉粮道被劫，汉中城内必有内应！曹军三路伏兵的火把在夜色中连成赤链，裹挟着流民的哭嚎步步紧逼。突然，西北方的沙尘中亮起一簇幽蓝火光，那是韩遂军特有的信号。你猛然勒马，枪尖挑起崖边碎石，石子滚落的轨迹正巧划过流民阵'
2025-09-26 15:52:02 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1122 预览='{\n  "text": "马蹄声在断崖边骤然凝滞。你攥紧银枪，斥候滚落前的断语在耳畔炸响——西凉粮道被劫，汉中城内必有内应！曹军三路伏兵的火把在夜色中连成赤链，裹挟着流民的哭嚎步步紧逼。突然，西北方的沙尘中亮起一簇幽蓝火光，那是韩遂军特有的信号。你猛然勒马，枪尖挑起崖边碎石，石子滚落的轨迹正巧划过流民阵后方的阴影——那'
2025-09-26 15:52:02 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 162
2025-09-26 15:52:02 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:02 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 15:52:02 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 15:52:02 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:02 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=277 parent=275 choice='纵马直冲曹操大营中军帅旗，用银枪挑飞曹字大纛'
2025-09-26 15:52:02 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=277 depth=2
2025-09-26 15:52:02 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=277 completed, triggered next level depth=2
2025-09-26 15:52:02 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=277
2025-09-26 15:52:02 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 纵马直冲曹军阵前，以银枪挑翻举火把的士卒，直指中军大旗
2025-09-26 15:52:02 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 策马绕向流民阵后方，高呼西凉军来援，试图瓦解人盾阵型
2025-09-26 15:52:02 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 让亲卫殿后诱敌，自己带轻骑抄小径直取西凉粮道被劫之处
2025-09-26 15:52:05 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:05 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2072
2025-09-26 15:52:05 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=867 预览='{"text": "银枪劈开血雾的刹那，三队亲兵已化作锋矢刺入敌阵。西凉口音与曹军旗号竟成最佳掩护——夏侯渊的玄甲骑率先中计，铁蹄踏碎自家伏兵的阵型。你勒马冲向东南角城楼，羌字旗的残破布帛在风中忽闪，背后突然传来马蹄铁刮擦青石的锐响：三百铁骑裹挟着渭水寒气自芦苇荡杀出，马蹄下压着的正是被劫粮队的牛车骸骨。\'马儿休走！\'一声暴喝震碎残旗，于禁的青龙刀映着火光刺来，而城头曹旗突然齐刷刷转向——似有暗号传递。", "choices": [{"option": "将羌字旗抛向空中，高呼\'西凉救兵至\'诱敌内讧", "summary": "利用敌我信息差制造混乱", "effects": {"delta_'
2025-09-26 15:52:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=867 预览='{"text": "银枪劈开血雾的刹那，三队亲兵已化作锋矢刺入敌阵。西凉口音与曹军旗号竟成最佳掩护——夏侯渊的玄甲骑率先中计，铁蹄踏碎自家伏兵的阵型。你勒马冲向东南角城楼，羌字旗的残破布帛在风中忽闪，背后突然传来马蹄铁刮擦青石的锐响：三百铁骑裹挟着渭水寒气自芦苇荡杀出，马蹄下压着的正是被劫粮队的牛车骸骨。\'马儿休走！\''
2025-09-26 15:52:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=867 预览='{"text": "银枪劈开血雾的刹那，三队亲兵已化作锋矢刺入敌阵。西凉口音与曹军旗号竟成最佳掩护——夏侯渊的玄甲骑率先中计，铁蹄踏碎自家伏兵的阵型。你勒马冲向东南角城楼，羌字旗的残破布帛在风中忽闪，背后突然传来马蹄铁刮擦青石的锐响：三百铁骑裹挟着渭水寒气自芦苇荡杀出，马蹄下压着的正是被劫粮队的牛车骸骨。\'马儿休走！\''
2025-09-26 15:52:05 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 193
2025-09-26 15:52:05 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:05 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 15:52:05 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 15:52:05 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:05 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=278 parent=276 choice='纵马直冲曹军阵前，以银枪劈开人盾洪流'
2025-09-26 15:52:05 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=278 depth=1
2025-09-26 15:52:05 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=278 completed, triggered next level depth=1
2025-09-26 15:52:05 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=49ca3f6d-ae3c-44f5-9471-9d51d56ac473 session=50 node=278
2025-09-26 15:52:12 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:12 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2133
2025-09-26 15:52:12 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=837 预览='{"text": "银枪挑碎当先曹将的玄铁铠，三路伏兵在混乱中互相残杀。你突然勒马驻足——东南城楼的羌字旗在风中舒展，与斥候临终前欲言又止的神情重叠。西凉粮道被劫的真凶，此刻正借你的混乱大摇大摆出城，马蹄印里混着羌人特有的赭红色砂砾。夏侯渊的重骑兵已冲破芦苇荡，箭矢暴雨般钉入你方才所立的断崖。亲兵队长嘶吼着要掩护你撤离，但渭水对岸的芦苇深处，某个戴金冠的身影正若隐若现。", "choices": [{"option": "扯下羌字旗裹住面门，率残部杀向城楼金冠者", "summary": "直面幕后黑手的凶险赌注", "effects": {"delta_progress": 12, "del'
2025-09-26 15:52:12 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=837 预览='{"text": "银枪挑碎当先曹将的玄铁铠，三路伏兵在混乱中互相残杀。你突然勒马驻足——东南城楼的羌字旗在风中舒展，与斥候临终前欲言又止的神情重叠。西凉粮道被劫的真凶，此刻正借你的混乱大摇大摆出城，马蹄印里混着羌人特有的赭红色砂砾。夏侯渊的重骑兵已冲破芦苇荡，箭矢暴雨般钉入你方才所立的断崖。亲兵队长嘶吼着要掩护你撤离'
2025-09-26 15:52:12 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=837 预览='{"text": "银枪挑碎当先曹将的玄铁铠，三路伏兵在混乱中互相残杀。你突然勒马驻足——东南城楼的羌字旗在风中舒展，与斥候临终前欲言又止的神情重叠。西凉粮道被劫的真凶，此刻正借你的混乱大摇大摆出城，马蹄印里混着羌人特有的赭红色砂砾。夏侯渊的重骑兵已冲破芦苇荡，箭矢暴雨般钉入你方才所立的断崖。亲兵队长嘶吼着要掩护你撤离'
2025-09-26 15:52:12 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 176
2025-09-26 15:52:12 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:12 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 15:52:12 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 15:52:12 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:12 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=279 parent=276 choice='策马跃入渭水芦苇荡，循羌字旗方向疾驰'
2025-09-26 15:52:12 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=279 depth=1
2025-09-26 15:52:12 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=279 completed, triggered next level depth=1
2025-09-26 15:52:18 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:18 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2190
2025-09-26 15:52:18 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=864 预览='{"text": "银枪撕裂夜幕的刹那，大纛如陨星坠地。曹操中军骤然炸开血色狼烟，夏侯惇的青龙刀与你的寒芒在帅旗残骸上相撞。流民阵中突然腾起蓝焰，韩遂的幽火信号竟与曹军烽燧诡异地呼应。西南方粮道方向传来马蹄铁与碎石的摩擦声——那是西凉商队惯用的铁蹄声！你枪尖挑开夏侯惇咽喉三寸，瞥见他铠甲内衬绣着半幅赤龙纹，与韩遂密使腰封上的图腾如出一辙。北面沙丘突然塌陷，数百具蒙面弓弩手从地底涌出，箭雨裹挟着硫磺气息直扑流民阵。", "choices": [{"option": "纵马踏碎蓝焰信号，枪挑韩遂使者咽喉", "summary": "直捣叛徒核心的孤注一掷", "effects": {"delta_'
2025-09-26 15:52:18 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=864 预览='{"text": "银枪撕裂夜幕的刹那，大纛如陨星坠地。曹操中军骤然炸开血色狼烟，夏侯惇的青龙刀与你的寒芒在帅旗残骸上相撞。流民阵中突然腾起蓝焰，韩遂的幽火信号竟与曹军烽燧诡异地呼应。西南方粮道方向传来马蹄铁与碎石的摩擦声——那是西凉商队惯用的铁蹄声！你枪尖挑开夏侯惇咽喉三寸，瞥见他铠甲内衬绣着半幅赤龙纹，与韩遂密使腰'
2025-09-26 15:52:18 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=864 预览='{"text": "银枪撕裂夜幕的刹那，大纛如陨星坠地。曹操中军骤然炸开血色狼烟，夏侯惇的青龙刀与你的寒芒在帅旗残骸上相撞。流民阵中突然腾起蓝焰，韩遂的幽火信号竟与曹军烽燧诡异地呼应。西南方粮道方向传来马蹄铁与碎石的摩擦声——那是西凉商队惯用的铁蹄声！你枪尖挑开夏侯惇咽喉三寸，瞥见他铠甲内衬绣着半幅赤龙纹，与韩遂密使腰'
2025-09-26 15:52:18 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 198
2025-09-26 15:52:18 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:18 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 15:52:18 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 15:52:18 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:18 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=280 parent=277 choice='让亲卫殿后诱敌，自己带轻骑抄小径直取西凉粮道被劫之处'
2025-09-26 15:52:18 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=280 depth=1
2025-09-26 15:52:18 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=280 completed, triggered next level depth=1
2025-09-26 15:52:23 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:23 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2103
2025-09-26 15:52:23 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=856 预览='{"text": "银枪破空的瞬间，大纛如陨星坠落。曹操中军骤然炸开一片血浪，夏侯惇的双刀裹挟寒光截杀而来。你瞥见帅旗断裂处露出半幅密函残角——那是韩遂军的鹰隼纹章！西北方沙尘中突然杀出铁骑，马蹄踏碎流民队形，为首将领的玄甲上嵌着西凉狼牙。\'马儿莫要中计！\'身后传来庞德嘶吼，三支流矢擦着他肩甲飞过。曹操中军阵型骤然收缩，八面青铜牛角同时鸣响，伏在渭水浮冰下的铁甲重骑正破冰而出。", "choices": [{"option": "强行撞开夏侯惇拦截，直取密函残角", "summary": "直面核心谜团的凶险抉择", "effects": {"delta_progress": 12, "del'
2025-09-26 15:52:23 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=856 预览='{"text": "银枪破空的瞬间，大纛如陨星坠落。曹操中军骤然炸开一片血浪，夏侯惇的双刀裹挟寒光截杀而来。你瞥见帅旗断裂处露出半幅密函残角——那是韩遂军的鹰隼纹章！西北方沙尘中突然杀出铁骑，马蹄踏碎流民队形，为首将领的玄甲上嵌着西凉狼牙。\'马儿莫要中计！\'身后传来庞德嘶吼，三支流矢擦着他肩甲飞过。曹操中军阵型骤然收缩'
2025-09-26 15:52:23 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=856 预览='{"text": "银枪破空的瞬间，大纛如陨星坠落。曹操中军骤然炸开一片血浪，夏侯惇的双刀裹挟寒光截杀而来。你瞥见帅旗断裂处露出半幅密函残角——那是韩遂军的鹰隼纹章！西北方沙尘中突然杀出铁骑，马蹄踏碎流民队形，为首将领的玄甲上嵌着西凉狼牙。\'马儿莫要中计！\'身后传来庞德嘶吼，三支流矢擦着他肩甲飞过。曹操中军阵型骤然收缩'
2025-09-26 15:52:23 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 180
2025-09-26 15:52:23 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:23 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 15:52:23 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 15:52:23 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:23 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=281 parent=277 choice='纵马直冲曹军阵前，以银枪挑翻举火把的士卒，直指中军大旗'
2025-09-26 15:52:23 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=281 depth=1
2025-09-26 15:52:23 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=281 completed, triggered next level depth=1
2025-09-26 15:52:29 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:29 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2326
2025-09-26 15:52:29 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=864 预览='{"text": "马蹄铁与碎石在陡坡上擦出火星，马超的银枪尖端滴落寒露。城下哭喊声突然沉寂——曹军将流民推向前方三丈处，火把映出孩童惊恐的脸。西凉斥候的血字在崖边凝固：粮道被劫者，竟是韩遂亲卫！北面伏兵的旌旗忽被狂风撕裂，露出半幅\'马\'字残纹。马超的瞳孔骤然收缩，二十年前父亲被曹操诱杀的夜雨，与此刻渭水的腥咸竟如此相似。东南方林间传来马蹄杂沓声，分明是西凉轻骑的蹄印，却朝着与大营相反的方向蜿蜒。", "choices": [{"option": "将银枪插进流民阵前冻土，以马蹄踏碎冰面发出巨响", "summary": "制造混乱争取决策时间", "effects": {"delta_pro'
2025-09-26 15:52:29 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=864 预览='{"text": "马蹄铁与碎石在陡坡上擦出火星，马超的银枪尖端滴落寒露。城下哭喊声突然沉寂——曹军将流民推向前方三丈处，火把映出孩童惊恐的脸。西凉斥候的血字在崖边凝固：粮道被劫者，竟是韩遂亲卫！北面伏兵的旌旗忽被狂风撕裂，露出半幅\'马\'字残纹。马超的瞳孔骤然收缩，二十年前父亲被曹操诱杀的夜雨，与此刻渭水的腥咸竟如此相'
2025-09-26 15:52:29 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=864 预览='{"text": "马蹄铁与碎石在陡坡上擦出火星，马超的银枪尖端滴落寒露。城下哭喊声突然沉寂——曹军将流民推向前方三丈处，火把映出孩童惊恐的脸。西凉斥候的血字在崖边凝固：粮道被劫者，竟是韩遂亲卫！北面伏兵的旌旗忽被狂风撕裂，露出半幅\'马\'字残纹。马超的瞳孔骤然收缩，二十年前父亲被曹操诱杀的夜雨，与此刻渭水的腥咸竟如此相'
2025-09-26 15:52:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 190
2025-09-26 15:52:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 15:52:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 15:52:29 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:29 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=282 parent=275 choice='带领残部退入山谷，点燃事先埋藏的火油引曹军自焚'
2025-09-26 15:52:29 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=282 depth=2
2025-09-26 15:52:29 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=282 completed, triggered next level depth=2
2025-09-26 15:52:29 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=282
2025-09-26 15:52:29 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将银枪插进流民阵前冻土，以马蹄踏碎冰面发出巨响
2025-09-26 15:52:29 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 策马直冲东南方蹄印，任由三路伏兵追击形成包围
2025-09-26 15:52:29 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 突然高呼韩遂名号，用西凉方言质问流民阵中可疑者
2025-09-26 15:52:52 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:52 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2070
2025-09-26 15:52:52 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=858 预览='{"text": "火油炸裂的轰鸣撕开夜幕，曹军前阵在烈焰中崩塌。你策马冲出山谷时，却见韩遂大纛正从侧翼疾退——那\'马\'字残旗在烟尘中若隐若现。流民堆里爬出个断臂老者，将半块染血虎符按在你马蹄下。东南林间突然亮起三盏红灯，正是西凉斥候特有的联络暗号，却朝着与大营相反的方向明灭闪烁。马蹄铁刮过焦土，你嗅到阴谋的铁锈味比渭水更腥。", "choices": [{"option": "斩断韩遂退路，当先杀入其本阵抢夺粮草", "summary": "以攻代守的决绝反击", "effects": {"delta_progress": 12, "delta_risk": 10, "delta_expos'
2025-09-26 15:52:52 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=858 预览='{"text": "火油炸裂的轰鸣撕开夜幕，曹军前阵在烈焰中崩塌。你策马冲出山谷时，却见韩遂大纛正从侧翼疾退——那\'马\'字残旗在烟尘中若隐若现。流民堆里爬出个断臂老者，将半块染血虎符按在你马蹄下。东南林间突然亮起三盏红灯，正是西凉斥候特有的联络暗号，却朝着与大营相反的方向明灭闪烁。马蹄铁刮过焦土，你嗅到阴谋的铁锈味比渭'
2025-09-26 15:52:52 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=858 预览='{"text": "火油炸裂的轰鸣撕开夜幕，曹军前阵在烈焰中崩塌。你策马冲出山谷时，却见韩遂大纛正从侧翼疾退——那\'马\'字残旗在烟尘中若隐若现。流民堆里爬出个断臂老者，将半块染血虎符按在你马蹄下。东南林间突然亮起三盏红灯，正是西凉斥候特有的联络暗号，却朝着与大营相反的方向明灭闪烁。马蹄铁刮过焦土，你嗅到阴谋的铁锈味比渭'
2025-09-26 15:52:52 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 154
2025-09-26 15:52:52 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:52 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 15:52:52 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 15:52:52 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:52 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=283 parent=282 choice='将银枪插进流民阵前冻土，以马蹄踏碎冰面发出巨响'
2025-09-26 15:52:52 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=283 depth=1
2025-09-26 15:52:52 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=283 completed, triggered next level depth=1
2025-09-26 15:52:52 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:52:52 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2341
2025-09-26 15:52:52 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=870 预览='{"text": "火油引线在马蹄下迸溅，山谷骤然炸开冲天火柱。曹军铁骑在烈焰中嘶鸣，却被东侧密林里突然涌出的西凉轻骑截断退路——那些本该守护粮道的同袍，此刻刀尖竟指向汉中！马超的银枪挑开飞溅的火舌，瞥见韩遂使者玉佩在敌将腰间闪烁。北面伏兵的\'马\'字残旗突然调转方向，与东南方的火光连成诡异弧线。流民堆里有个裹着破毯的妇人突然起身，将染血的军报塞进他护腕：\'温水原...韩遂与曹操...\' 火墙外传来密集马蹄，不知是增援还是追兵。", "choices": [{"option": "纵马冲入火海，用银枪劈开曹军防线救出流民孩童", "summary": "以人质为盾牌争取转机", "effects'
2025-09-26 15:52:52 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=870 预览='{"text": "火油引线在马蹄下迸溅，山谷骤然炸开冲天火柱。曹军铁骑在烈焰中嘶鸣，却被东侧密林里突然涌出的西凉轻骑截断退路——那些本该守护粮道的同袍，此刻刀尖竟指向汉中！马超的银枪挑开飞溅的火舌，瞥见韩遂使者玉佩在敌将腰间闪烁。北面伏兵的\'马\'字残旗突然调转方向，与东南方的火光连成诡异弧线。流民堆里有个裹着破毯的妇'
2025-09-26 15:52:52 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=870 预览='{"text": "火油引线在马蹄下迸溅，山谷骤然炸开冲天火柱。曹军铁骑在烈焰中嘶鸣，却被东侧密林里突然涌出的西凉轻骑截断退路——那些本该守护粮道的同袍，此刻刀尖竟指向汉中！马超的银枪挑开飞溅的火舌，瞥见韩遂使者玉佩在敌将腰间闪烁。北面伏兵的\'马\'字残旗突然调转方向，与东南方的火光连成诡异弧线。流民堆里有个裹着破毯的妇'
2025-09-26 15:52:52 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 205
2025-09-26 15:52:52 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:52:52 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 15:52:52 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 15:52:52 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:52:52 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=284 parent=282 choice='突然高呼韩遂名号，用西凉方言质问流民阵中可疑者'
2025-09-26 15:52:52 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=284 depth=1
2025-09-26 15:52:52 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=284 completed, triggered next level depth=1
2025-09-26 15:53:57 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:53:57 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2156
2025-09-26 15:53:57 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=877 预览='{"text": "火油爆燃的轰鸣震裂了渭水冰面，曹军前阵在烈焰中化作焦炭。但浓烟深处突然亮起三处火把——韩遂的西凉轻骑竟从侧翼包抄而来！马超的银枪挑开飞溅的熔铁，瞥见韩遂大纛上暗绣的\'曹\'字副印。流民营方向传来铁链断裂声，数百绑着草人的人质正被拖向山谷隘口。你听见身后残部的铠甲碰撞声：他们半数铠甲内衬空无一人，是马腾旧部用木偶填充的假象。韩遂的冷笑穿透火幕：\'温侯之子，可知你父亲当年是怎么死的？\'", "choices": [{"option": "纵马直取韩遂帅旗，用银枪挑飞那枚曹魏副印", "summary": "以武力震慑盟军内部的背叛者", "effects": {"delta_pr'
2025-09-26 15:53:57 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=877 预览='{"text": "火油爆燃的轰鸣震裂了渭水冰面，曹军前阵在烈焰中化作焦炭。但浓烟深处突然亮起三处火把——韩遂的西凉轻骑竟从侧翼包抄而来！马超的银枪挑开飞溅的熔铁，瞥见韩遂大纛上暗绣的\'曹\'字副印。流民营方向传来铁链断裂声，数百绑着草人的人质正被拖向山谷隘口。你听见身后残部的铠甲碰撞声：他们半数铠甲内衬空无一人，是马腾'
2025-09-26 15:53:57 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=877 预览='{"text": "火油爆燃的轰鸣震裂了渭水冰面，曹军前阵在烈焰中化作焦炭。但浓烟深处突然亮起三处火把——韩遂的西凉轻骑竟从侧翼包抄而来！马超的银枪挑开飞溅的熔铁，瞥见韩遂大纛上暗绣的\'曹\'字副印。流民营方向传来铁链断裂声，数百绑着草人的人质正被拖向山谷隘口。你听见身后残部的铠甲碰撞声：他们半数铠甲内衬空无一人，是马腾'
2025-09-26 15:53:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 15:53:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:53:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 15:53:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 15:53:57 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:53:57 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=285 parent=282 choice='策马直冲东南方蹄印，任由三路伏兵追击形成包围'
2025-09-26 15:53:57 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=285 depth=1
2025-09-26 15:53:57 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=285 completed, triggered next level depth=1
2025-09-26 15:54:26 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:54:26 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2031
2025-09-26 15:54:26 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=852 预览='{"text": "银枪挑碎当先士卒的盾牌，你率假扮曹军的亲兵冲入伏兵阵列。佯攻的马蹄声中，东侧伏军竟高呼\'西凉反贼！\'率先发难——有人提前识破了军旗暗号。北面传来羌人战鼓，南侧伏兵阵中突然亮起火把，照出\'夏侯\'字旗，却有数十骑马尾缀着羌族鹰羽。三路兵马开始收缩包围圈，而你发现被劫粮道的踪迹指向了渭水上游。亲兵首领的战马突然人立长嘶，马鞍暗格里掉出半卷羌文地图，墨迹未干的箭头正刺向汉中粮仓。", "choices": [{"option": "纵马直取羌将帅旗，用西凉方言高喊\'奉飞将军令策反各部\'", "summary": "利用身份优势制造混乱", "effects": {"delta_pr'
2025-09-26 15:54:26 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=852 预览='{"text": "银枪挑碎当先士卒的盾牌，你率假扮曹军的亲兵冲入伏兵阵列。佯攻的马蹄声中，东侧伏军竟高呼\'西凉反贼！\'率先发难——有人提前识破了军旗暗号。北面传来羌人战鼓，南侧伏兵阵中突然亮起火把，照出\'夏侯\'字旗，却有数十骑马尾缀着羌族鹰羽。三路兵马开始收缩包围圈，而你发现被劫粮道的踪迹指向了渭水上游。亲兵首领的战'
2025-09-26 15:54:26 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=852 预览='{"text": "银枪挑碎当先士卒的盾牌，你率假扮曹军的亲兵冲入伏兵阵列。佯攻的马蹄声中，东侧伏军竟高呼\'西凉反贼！\'率先发难——有人提前识破了军旗暗号。北面传来羌人战鼓，南侧伏兵阵中突然亮起火把，照出\'夏侯\'字旗，却有数十骑马尾缀着羌族鹰羽。三路兵马开始收缩包围圈，而你发现被劫粮道的踪迹指向了渭水上游。亲兵首领的战'
2025-09-26 15:54:26 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 187
2025-09-26 15:54:26 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:54:26 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 15:54:26 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 15:54:26 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:54:26 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=286 parent=276 choice='将密报残片抛向流民，高呼'西凉断粮者必是曹操奸计''
2025-09-26 15:54:26 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=286 depth=1
2025-09-26 15:54:26 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=286 completed, triggered next level depth=1
2025-09-26 15:55:32 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 15:55:32 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2383
2025-09-26 15:55:32 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=878 预览='{"text": "银枪撕裂夜幕的瞬间，曹字大纛如断线风筝般坠落。中军阵前骤然炸开万箭齐发，马蹄铁在青石板上刮出刺耳尖啸。曹操亲卫的玄甲重骑从帅旗后方涌出，铁戟阵却在你枪尖划过的轨迹前分崩离析。西北方韩遂的幽蓝火光突然转为三短一长，流民阵中竟有人高举西凉旌旗。你瞥见粮道方向腾起黑烟——那分明是韩遂斥候的求援信号。曹军阵型开始收缩，但城头忽有金锣骤响，数百火把从瓮城深处倾泻而出，裹挟着被缚的西凉商队马匹。", "choices": [{"option": "纵马直扑韩遂信号方位，用西凉商队马匹撕开流民阵缺口", "summary": "利用混乱突破关键节点", "effects": {"delt'
2025-09-26 15:55:32 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=878 预览='{"text": "银枪撕裂夜幕的瞬间，曹字大纛如断线风筝般坠落。中军阵前骤然炸开万箭齐发，马蹄铁在青石板上刮出刺耳尖啸。曹操亲卫的玄甲重骑从帅旗后方涌出，铁戟阵却在你枪尖划过的轨迹前分崩离析。西北方韩遂的幽蓝火光突然转为三短一长，流民阵中竟有人高举西凉旌旗。你瞥见粮道方向腾起黑烟——那分明是韩遂斥候的求援信号。曹军阵'
2025-09-26 15:55:32 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=878 预览='{"text": "银枪撕裂夜幕的瞬间，曹字大纛如断线风筝般坠落。中军阵前骤然炸开万箭齐发，马蹄铁在青石板上刮出刺耳尖啸。曹操亲卫的玄甲重骑从帅旗后方涌出，铁戟阵却在你枪尖划过的轨迹前分崩离析。西北方韩遂的幽蓝火光突然转为三短一长，流民阵中竟有人高举西凉旌旗。你瞥见粮道方向腾起黑烟——那分明是韩遂斥候的求援信号。曹军阵'
2025-09-26 15:55:32 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 193
2025-09-26 15:55:32 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 15:55:32 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 15:55:32 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 15:55:32 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 15:55:32 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=287 parent=277 choice='策马绕向流民阵后方，高呼西凉军来援，试图瓦解人盾阵型'
2025-09-26 15:55:32 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=50 node=287 depth=1
2025-09-26 15:55:32 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=287 completed, triggered next level depth=1
2025-09-26 20:15:31 | INFO     | api.story:retry_from_node:541 - 收到时空回溯请求，目标节点: 287
2025-09-26 20:15:31 | INFO     | database.crud:prune_story_after_node:298 - 正在从节点 287 之后进行时空回溯...
2025-09-26 20:15:31 | INFO     | database.crud:prune_story_after_node:313 - 节点 287 没有后代，无需删除。
2025-09-26 20:15:31 | INFO     | database.crud:prune_story_after_node:320 - 已成功完成回溯，当前故事线的终点为节点 287。
2025-09-26 20:15:41 | INFO     | api.story:continue_existing_story:399 - 收到故事继续请求，选择: 纵马直扑韩遂信号方位，用西凉商队马匹撕开流民阵缺口
2025-09-26 20:16:48 | INFO     | backend.database.crud:create_user:36 - 创建新用户: 690161230@qq.com
2025-09-26 20:16:55 | INFO     | api.story:prepare_start_level:190 - 开始生成故事概要，愿望：项羽...
2025-09-26 20:17:29 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 1714
2025-09-26 20:17:29 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 20:17:29 | INFO     | api.story:prepare_start_level:266 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 20:17:29 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 20:17:29 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 20:18:17 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:18:17 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2153
2025-09-26 20:18:17 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=951 预览='{"text": "亥时三刻的楚军大营被篝火割裂成明暗交错的碎片。项羽握剑的手指在甲胄上敲出急促节拍——八百里加急斥候刚报，刘邦主力已突破宛城防线，彭城方向又传来地方豪族倒戈的密报。帐外忽有马蹄声撕破夜幕，竟是逃回的前哨官浑身浴血：\'汉军裹着百姓作人盾，沿途焚烧粮仓！\'帐中谋士们交头接耳，有人低声劝谏迁都彭城巩固根基，更多人盯着主位上那位横眉立目的霸王。青铜灯树突然爆出火星，映亮项羽腰间断裂的虎纹绦带——那是昨日斩杀汉军探子时被暗器所伤。", "choices": [{"option": "将逃回的前哨官斩于帐前，当众剖开其伤口查看是否中了汉军慢性毒药", "summary": "以暴制暴震慑'
2025-09-26 20:18:17 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=951 预览='{"text": "亥时三刻的楚军大营被篝火割裂成明暗交错的碎片。项羽握剑的手指在甲胄上敲出急促节拍——八百里加急斥候刚报，刘邦主力已突破宛城防线，彭城方向又传来地方豪族倒戈的密报。帐外忽有马蹄声撕破夜幕，竟是逃回的前哨官浑身浴血：\'汉军裹着百姓作人盾，沿途焚烧粮仓！\'帐中谋士们交头接耳，有人低声劝谏迁都彭城巩固根基，'
2025-09-26 20:18:17 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=951 预览='{"text": "亥时三刻的楚军大营被篝火割裂成明暗交错的碎片。项羽握剑的手指在甲胄上敲出急促节拍——八百里加急斥候刚报，刘邦主力已突破宛城防线，彭城方向又传来地方豪族倒戈的密报。帐外忽有马蹄声撕破夜幕，竟是逃回的前哨官浑身浴血：\'汉军裹着百姓作人盾，沿途焚烧粮仓！\'帐中谋士们交头接耳，有人低声劝谏迁都彭城巩固根基，'
2025-09-26 20:18:17 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 211
2025-09-26 20:18:17 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:18:17 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 20:18:17 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 20:18:17 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 20:18:17 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=211
2025-09-26 20:18:17 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=1
2025-09-26 20:18:17 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=1
2025-09-26 20:18:17 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=1 depth=3
2025-09-26 20:18:17 | INFO     | api.story:_background_generate_with_pregeneration:97 - [预生成] 已触发speculation预生成: session=1, node=1
2025-09-26 20:18:17 | INFO     | api.story:_background_generate_with_pregeneration:99 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=1
2025-09-26 20:18:17 | DEBUG    | api.story:_background_generate_with_pregeneration:111 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 20:18:17 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=1
2025-09-26 20:18:17 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将逃回的前哨官斩于帐前，当众剖开其伤口查看是否中了汉军慢性毒药
2025-09-26 20:18:17 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人抬着伤兵巡游各营，沿途分发浸透龙涎香的绷带让将士们嗅闻军情
2025-09-26 20:18:17 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 突然拔剑劈开案上密报，宣称天机不可泄露，命全军即刻向东南三十里高地集结
2025-09-26 20:18:23 | INFO     | api.story:start_new_story:296 - 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 项羽
2025-09-26 20:18:23 | INFO     | api.story:start_new_story:311 - [预生成] 命中缓存，使用预生成的会话和节点: session=1, node=1
2025-09-26 20:18:23 | ERROR    | backend.main:global_exception_handler:82 - 全局异常: 'StoryNode' object has no attribute 'text'
2025-09-26 20:18:42 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:18:42 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2232
2025-09-26 20:18:42 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=840 预览='{"text": "青铜灯树在夜风中摇曳，将项羽的影子撕成碎片投射在舆图上。他忽然攥住案几边缘，指节泛白：彭城方向的密报墨迹未干，宛城逃兵的血衣还带着焦糊味。帐外马蹄声未息，又有亲卫踉跄闯入，腰间箭簇犹在滴血：\'北线斥候营全军覆没，汉军悬赏千金购求楚军降卒！\'谋士范增的玉簪在烛火中泛冷光，他望着项羽腰间断裂的虎纹绦带，喉结滚动三次才开口：\'陛下，百姓人盾……是韩信新研的火攻阵？\'帐外忽有鼓角嘶鸣，似是西线烽火台燃起。", "choices": [{"option": "拔剑劈开舆图，率亲卫营连夜突袭汉军粮道", "summary": "以暴制暴的决断", "effects": {"delta_'
2025-09-26 20:18:42 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=840 预览='{"text": "青铜灯树在夜风中摇曳，将项羽的影子撕成碎片投射在舆图上。他忽然攥住案几边缘，指节泛白：彭城方向的密报墨迹未干，宛城逃兵的血衣还带着焦糊味。帐外马蹄声未息，又有亲卫踉跄闯入，腰间箭簇犹在滴血：\'北线斥候营全军覆没，汉军悬赏千金购求楚军降卒！\'谋士范增的玉簪在烛火中泛冷光，他望着项羽腰间断裂的虎纹绦带，'
2025-09-26 20:18:42 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=840 预览='{"text": "青铜灯树在夜风中摇曳，将项羽的影子撕成碎片投射在舆图上。他忽然攥住案几边缘，指节泛白：彭城方向的密报墨迹未干，宛城逃兵的血衣还带着焦糊味。帐外马蹄声未息，又有亲卫踉跄闯入，腰间箭簇犹在滴血：\'北线斥候营全军覆没，汉军悬赏千金购求楚军降卒！\'谋士范增的玉簪在烛火中泛冷光，他望着项羽腰间断裂的虎纹绦带，'
2025-09-26 20:18:42 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 200
2025-09-26 20:18:42 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:18:42 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 20:18:42 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 20:18:42 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:18:42 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=2 parent=1 choice='突然拔剑劈开案上密报，宣称天机不可泄露，命全军即刻向东南三十里高地集结'
2025-09-26 20:18:42 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=2 depth=2
2025-09-26 20:18:42 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=2 completed, triggered next level depth=2
2025-09-26 20:18:42 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=2
2025-09-26 20:18:42 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 拔剑劈开舆图，率亲卫营连夜突袭汉军粮道
2025-09-26 20:18:42 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人拖出前哨官，当众拷问其与汉军勾结的证据
2025-09-26 20:18:42 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人抬来酒坛，借醉意将虎纹绦带抛入火盆
2025-09-26 20:18:56 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:18:56 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2336
2025-09-26 20:18:56 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=984 预览='{"text": "青铜灯树爆出的火星在项羽眉骨投下狰狞阴影，断裂的虎纹绦带随他猛然起身时的铠甲摩擦声簌簌坠地。帐外逃兵的血还在沙盘上洇开暗红纹路，谋士们的私语像毒蛇吐信：\'百姓作盾...烧粮仓...\'项羽的瞳孔在\'人盾\'二字炸开的瞬间收缩成竖瞳，他想起巨鹿之战时汉军射来的裹着妇孺尸块的火箭。帐外马蹄声又起，斥候滚进帐内嘶声：\'彭城粮道被断，赵营主暗中与汉使...\'项羽的巨阙剑突然出鞘，剑风削断三支烛台，帐内陷入半明半暗。谋士钟离昧踉跄扶住案几，看见霸王指节因过度用力泛着青白，剑尖正抵在沙盘上刘邦军的行军路线——那里洇着血迹，蜿蜒如毒蛇。", "choices": [{"option": "挥'
2025-09-26 20:18:56 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=984 预览='{"text": "青铜灯树爆出的火星在项羽眉骨投下狰狞阴影，断裂的虎纹绦带随他猛然起身时的铠甲摩擦声簌簌坠地。帐外逃兵的血还在沙盘上洇开暗红纹路，谋士们的私语像毒蛇吐信：\'百姓作盾...烧粮仓...\'项羽的瞳孔在\'人盾\'二字炸开的瞬间收缩成竖瞳，他想起巨鹿之战时汉军射来的裹着妇孺尸块的火箭。帐外马蹄声又起，斥候滚进帐'
2025-09-26 20:18:56 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=984 预览='{"text": "青铜灯树爆出的火星在项羽眉骨投下狰狞阴影，断裂的虎纹绦带随他猛然起身时的铠甲摩擦声簌簌坠地。帐外逃兵的血还在沙盘上洇开暗红纹路，谋士们的私语像毒蛇吐信：\'百姓作盾...烧粮仓...\'项羽的瞳孔在\'人盾\'二字炸开的瞬间收缩成竖瞳，他想起巨鹿之战时汉军射来的裹着妇孺尸块的火箭。帐外马蹄声又起，斥候滚进帐'
2025-09-26 20:18:56 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 262
2025-09-26 20:18:56 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:18:56 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 20:18:56 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 20:18:56 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:18:56 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=3 parent=1 choice='命人抬着伤兵巡游各营，沿途分发浸透龙涎香的绷带让将士们嗅闻军情'
2025-09-26 20:18:56 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=3 depth=2
2025-09-26 20:18:56 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=3 completed, triggered next level depth=2
2025-09-26 20:18:56 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=3
2025-09-26 20:18:56 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 挥剑斩断案几，率八千江东子弟连夜追击刘邦主力
2025-09-26 20:18:56 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人抬来断头台置于辕门，当众枭首三个通敌小吏
2025-09-26 20:18:56 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 解下断裂的虎纹绦带抛给钟离昧：'即刻联络旧部，调三万楚军精锐秘密入彭城'
2025-09-26 20:18:57 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:18:57 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2273
2025-09-26 20:18:57 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=857 预览='{"text": "青铜灯树的火苗在项羽暴怒的呵斥中剧烈摇晃。他一掌拍碎案几上的陶爵，酒液泼洒在密报上洇出深褐的疆域图。\'放火焚仓？\'他捏着前哨官染血的护腕冷笑，指节泛白的虎口渗出新血，\'传令三军：明日鸡鸣时分，本王要看见汉军的人头悬满宛城城门！\'帐外忽有鼓角撕破夜色，斥候飞马奔入：彭城方向的火光已映红半边天际，裹着楚军袍甲的叛徒正驱赶百姓向西楚大营行进。项羽腰间断绦突然崩落，露出一道结痂未愈的箭伤——那是鸿门宴上刘邦刺客留下的印记。", "choices": [{"option": "亲自率精锐夜袭汉军粮道，以雷霆之势震慑刘邦", "summary": "展现霸王威势的果断抉择", "eff'
2025-09-26 20:18:57 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=857 预览='{"text": "青铜灯树的火苗在项羽暴怒的呵斥中剧烈摇晃。他一掌拍碎案几上的陶爵，酒液泼洒在密报上洇出深褐的疆域图。\'放火焚仓？\'他捏着前哨官染血的护腕冷笑，指节泛白的虎口渗出新血，\'传令三军：明日鸡鸣时分，本王要看见汉军的人头悬满宛城城门！\'帐外忽有鼓角撕破夜色，斥候飞马奔入：彭城方向的火光已映红半边天际，裹着楚'
2025-09-26 20:18:57 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=857 预览='{"text": "青铜灯树的火苗在项羽暴怒的呵斥中剧烈摇晃。他一掌拍碎案几上的陶爵，酒液泼洒在密报上洇出深褐的疆域图。\'放火焚仓？\'他捏着前哨官染血的护腕冷笑，指节泛白的虎口渗出新血，\'传令三军：明日鸡鸣时分，本王要看见汉军的人头悬满宛城城门！\'帐外忽有鼓角撕破夜色，斥候飞马奔入：彭城方向的火光已映红半边天际，裹着楚'
2025-09-26 20:18:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 209
2025-09-26 20:18:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:18:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 20:18:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 20:18:57 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:18:57 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=4 parent=1 choice='将逃回的前哨官斩于帐前，当众剖开其伤口查看是否中了汉军慢性毒药'
2025-09-26 20:18:57 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=4 depth=2
2025-09-26 20:18:57 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=4 completed, triggered next level depth=2
2025-09-26 20:18:57 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=4
2025-09-26 20:18:57 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 亲自率精锐夜袭汉军粮道，以雷霆之势震慑刘邦
2025-09-26 20:18:57 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将叛徒百姓押至阵前，当众处决震慑宵小
2025-09-26 20:18:57 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 暗中派遣死士混入叛军，刺探刘邦主力虚实
2025-09-26 20:19:10 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:19:10 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2193
2025-09-26 20:19:10 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=884 预览='{"text": "断剑插入案台的火星尚未熄灭，项羽的咆哮震得青铜灯树嗡鸣：\'东南高地有虎狼之势，可断汉军粮道！\'亲兵抬来断裂的帅旗残片——那是今晨被流矢击中的旗手死死攥着的。范增突然抓住项羽染血的披风下摆，玉簪几乎戳到他腰间渗血的虎纹绦带：\'东南三十里是韩信布下的火油陷阱！\'帐外传来惊呼，斥候正将浑身焦黑的降卒拖入，那人口中不断重复\'彭城...彭城...\'。项羽的瞳孔突然收缩——焦尸脚踝的刺青与昨日斩杀的汉军探子如出一辙。", "choices": [{"option": "拽过焦尸脚踝验明刺青，将范增的玉簪掷入火盆", "summary": "以暴制暴震慑谋士", "effects": {'
2025-09-26 20:19:10 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=884 预览='{"text": "断剑插入案台的火星尚未熄灭，项羽的咆哮震得青铜灯树嗡鸣：\'东南高地有虎狼之势，可断汉军粮道！\'亲兵抬来断裂的帅旗残片——那是今晨被流矢击中的旗手死死攥着的。范增突然抓住项羽染血的披风下摆，玉簪几乎戳到他腰间渗血的虎纹绦带：\'东南三十里是韩信布下的火油陷阱！\'帐外传来惊呼，斥候正将浑身焦黑的降卒拖入，'
2025-09-26 20:19:10 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=884 预览='{"text": "断剑插入案台的火星尚未熄灭，项羽的咆哮震得青铜灯树嗡鸣：\'东南高地有虎狼之势，可断汉军粮道！\'亲兵抬来断裂的帅旗残片——那是今晨被流矢击中的旗手死死攥着的。范增突然抓住项羽染血的披风下摆，玉簪几乎戳到他腰间渗血的虎纹绦带：\'东南三十里是韩信布下的火油陷阱！\'帐外传来惊呼，斥候正将浑身焦黑的降卒拖入，'
2025-09-26 20:19:10 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 204
2025-09-26 20:19:10 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:10 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 20:19:10 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 20:19:10 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:10 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=5 parent=2 choice='命人抬来酒坛，借醉意将虎纹绦带抛入火盆'
2025-09-26 20:19:10 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=5 depth=1
2025-09-26 20:19:10 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=5 completed, triggered next level depth=1
2025-09-26 20:19:10 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=1 node=5
2025-09-26 20:19:16 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:19:16 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2483
2025-09-26 20:19:16 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=913 预览='{"text": "断剑劈开密报的瞬间，青铜灯树被剑气震得剧烈摇晃，飞溅的纸屑混着血滴在项羽的玄铁护腕上凝结成暗红斑点。东南高地的集结号角尚未吹响，副将钟离昧突然按住剑柄跪地嘶吼：\'陛下！东南三十里是韩信布下的流沙沼泽！\'话音未落，东南天际骤然炸开三支火把，映出蜿蜒如蛇阵的汉军火把正从三个方向包抄而来。范增的玉簪在混乱中折断，他抓起案上未烧尽的密报残片，发现刘邦的军印旁竟盖着彭城守将私章——这封\'密报\'的墨迹里掺着西域荧光粉，在火光下显出\'诱\'字暗纹。", "choices": [{"option": "挥剑斩断东南方向的军旗，改向西北山坳突进", "summary": "当机立断改变行军路线'
2025-09-26 20:19:16 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=913 预览='{"text": "断剑劈开密报的瞬间，青铜灯树被剑气震得剧烈摇晃，飞溅的纸屑混着血滴在项羽的玄铁护腕上凝结成暗红斑点。东南高地的集结号角尚未吹响，副将钟离昧突然按住剑柄跪地嘶吼：\'陛下！东南三十里是韩信布下的流沙沼泽！\'话音未落，东南天际骤然炸开三支火把，映出蜿蜒如蛇阵的汉军火把正从三个方向包抄而来。范增的玉簪在混乱'
2025-09-26 20:19:16 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=913 预览='{"text": "断剑劈开密报的瞬间，青铜灯树被剑气震得剧烈摇晃，飞溅的纸屑混着血滴在项羽的玄铁护腕上凝结成暗红斑点。东南高地的集结号角尚未吹响，副将钟离昧突然按住剑柄跪地嘶吼：\'陛下！东南三十里是韩信布下的流沙沼泽！\'话音未落，东南天际骤然炸开三支火把，映出蜿蜒如蛇阵的汉军火把正从三个方向包抄而来。范增的玉簪在混乱'
2025-09-26 20:19:16 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 218
2025-09-26 20:19:16 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:16 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 20:19:16 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 20:19:16 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:16 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=6 parent=2 choice='拔剑劈开舆图，率亲卫营连夜突袭汉军粮道'
2025-09-26 20:19:16 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=6 depth=1
2025-09-26 20:19:16 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=6 completed, triggered next level depth=1
2025-09-26 20:19:19 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:19:19 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2338
2025-09-26 20:19:19 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=883 预览='{"text": "断剑插入案台的火星尚未熄灭，东南方向突然传来闷雷般的马蹄声。项羽的虎纹战袍被夜风灌满，断裂的绦带在腰间猎猎作响。前哨官的血衣被剑气卷起，飘落在展开的舆图上，恰好遮住刘邦主力推进的朱砂标记。\'传令三军：违令者斩！\'他的吼声震得青铜灯树嗡嗡作响，却见谋士钟离眜突然按住剑柄——东南三十里是断龙崖，仅有一条羊肠小道可通。更远处，刘邦的斥候火把正在山脊线上明灭，像一串讥讽的鬼火。范增的玉簪突然折断在掌心，碎玉滚过密报上\'百姓人盾\'的字样。", "choices": [{"option": "策马冲向断龙崖，用战旗撕开密林为全军开路", "summary": "以身作则鼓舞士气", "'
2025-09-26 20:19:19 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=883 预览='{"text": "断剑插入案台的火星尚未熄灭，东南方向突然传来闷雷般的马蹄声。项羽的虎纹战袍被夜风灌满，断裂的绦带在腰间猎猎作响。前哨官的血衣被剑气卷起，飘落在展开的舆图上，恰好遮住刘邦主力推进的朱砂标记。\'传令三军：违令者斩！\'他的吼声震得青铜灯树嗡嗡作响，却见谋士钟离眜突然按住剑柄——东南三十里是断龙崖，仅有一条'
2025-09-26 20:19:19 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=883 预览='{"text": "断剑插入案台的火星尚未熄灭，东南方向突然传来闷雷般的马蹄声。项羽的虎纹战袍被夜风灌满，断裂的绦带在腰间猎猎作响。前哨官的血衣被剑气卷起，飘落在展开的舆图上，恰好遮住刘邦主力推进的朱砂标记。\'传令三军：违令者斩！\'他的吼声震得青铜灯树嗡嗡作响，却见谋士钟离眜突然按住剑柄——东南三十里是断龙崖，仅有一条'
2025-09-26 20:19:19 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 216
2025-09-26 20:19:19 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:19 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 20:19:19 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 20:19:19 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:19 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=7 parent=2 choice='命人拖出前哨官，当众拷问其与汉军勾结的证据'
2025-09-26 20:19:19 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=7 depth=1
2025-09-26 20:19:19 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=7 completed, triggered next level depth=1
2025-09-26 20:19:23 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 20:19:29 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:19:29 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2174
2025-09-26 20:19:29 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=836 预览='{"text": "血刃劈开前哨官胸膛的瞬间，暗红肌理间翻涌出青灰色脓液。项羽的瞳孔骤然收缩——这正是巨鹿之战后汉军用来溃散秦军的腐骨毒。帐外鼓角声更急，叛逃百姓的哭喊穿透夜幕，楚军甲士们不自觉地后退半步，青铜灯树在血腥气中明灭不定。\'传令三军：即刻清查所有伤员！\'项羽将染毒的剑刃狠狠插入地砖，断裂的虎纹绦带随动作飘落，露出腰间那道旧箭伤——伤口边缘正泛起相似的青灰色。", "choices": [{"option": "将染毒的剑刃刺入自己手臂，当众证明无惧汉军诡计", "summary": "以自身为盾的极端示威", "effects": {"delta_progress": 12, "d'
2025-09-26 20:19:29 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=836 预览='{"text": "血刃劈开前哨官胸膛的瞬间，暗红肌理间翻涌出青灰色脓液。项羽的瞳孔骤然收缩——这正是巨鹿之战后汉军用来溃散秦军的腐骨毒。帐外鼓角声更急，叛逃百姓的哭喊穿透夜幕，楚军甲士们不自觉地后退半步，青铜灯树在血腥气中明灭不定。\'传令三军：即刻清查所有伤员！\'项羽将染毒的剑刃狠狠插入地砖，断裂的虎纹绦带随动作飘落'
2025-09-26 20:19:29 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=836 预览='{"text": "血刃劈开前哨官胸膛的瞬间，暗红肌理间翻涌出青灰色脓液。项羽的瞳孔骤然收缩——这正是巨鹿之战后汉军用来溃散秦军的腐骨毒。帐外鼓角声更急，叛逃百姓的哭喊穿透夜幕，楚军甲士们不自觉地后退半步，青铜灯树在血腥气中明灭不定。\'传令三军：即刻清查所有伤员！\'项羽将染毒的剑刃狠狠插入地砖，断裂的虎纹绦带随动作飘落'
2025-09-26 20:19:29 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 176
2025-09-26 20:19:29 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:29 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 20:19:29 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 20:19:29 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:29 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=8 parent=4 choice='暗中派遣死士混入叛军，刺探刘邦主力虚实'
2025-09-26 20:19:29 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=8 depth=1
2025-09-26 20:19:29 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '暗中派遣死士混入叛军，刺探刘邦主力虚实': cannot schedule new futures after shutdown
2025-09-26 20:19:36 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:19:36 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2288
2025-09-26 20:19:36 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=891 预览='{"text": "血刃劈开前哨官胸膛的瞬间，暗红肌理间竟泛着诡异的靛青纹路。项羽捏起半截断箭抵在鼻尖——箭簇淬着与鸿门宴刺客相同的乌头毒。帐外叛民的哭喊声陡然密集，楚军将士面面相觑间，项羽突然将染毒断箭掷入火盆，青紫色烟雾瞬间扭曲了青铜灯树的光影。\'汉军要的不是杀我，\'他撕开腰间渗血的箭伤，毒血与断绦纠缠成缕，\'是让楚军自相践踏！\'此刻彭城方向的火光已连成赤红带，裹着\'楚王暴虐\'的帛书正钉在营门外的焦尸上。", "choices": [{"option": "当众焚烧所有帛书，命死士护送伤员穿越火线直扑刘邦大营", "summary": "以暴制暴的决绝反击", "effects": {"d'
2025-09-26 20:19:36 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=891 预览='{"text": "血刃劈开前哨官胸膛的瞬间，暗红肌理间竟泛着诡异的靛青纹路。项羽捏起半截断箭抵在鼻尖——箭簇淬着与鸿门宴刺客相同的乌头毒。帐外叛民的哭喊声陡然密集，楚军将士面面相觑间，项羽突然将染毒断箭掷入火盆，青紫色烟雾瞬间扭曲了青铜灯树的光影。\'汉军要的不是杀我，\'他撕开腰间渗血的箭伤，毒血与断绦纠缠成缕，\'是让'
2025-09-26 20:19:36 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=891 预览='{"text": "血刃劈开前哨官胸膛的瞬间，暗红肌理间竟泛着诡异的靛青纹路。项羽捏起半截断箭抵在鼻尖——箭簇淬着与鸿门宴刺客相同的乌头毒。帐外叛民的哭喊声陡然密集，楚军将士面面相觑间，项羽突然将染毒断箭掷入火盆，青紫色烟雾瞬间扭曲了青铜灯树的光影。\'汉军要的不是杀我，\'他撕开腰间渗血的箭伤，毒血与断绦纠缠成缕，\'是让'
2025-09-26 20:19:36 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 196
2025-09-26 20:19:36 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:36 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 20:19:36 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 20:19:36 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:36 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=9 parent=4 choice='将叛徒百姓押至阵前，当众处决震慑宵小'
2025-09-26 20:19:36 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=9 depth=1
2025-09-26 20:19:36 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '将叛徒百姓押至阵前，当众处决震慑宵小': cannot schedule new futures after shutdown
2025-09-26 20:19:39 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2449
2025-09-26 20:19:39 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1110 预览='\n\n```json\n{\n  "text": "血色绷带在夜风中翻卷如幡，龙涎香混着血腥味渗入每名将士的肺叶。当伤兵轿辇行至赵营主大帐前时，一名佩鱼符的使者突然撞开帐帘，腰间玉玦正闪烁着与彭城密使相同的暗纹。项羽巨阙剑尖挑起那人的衣摆，断裂的虎纹绦带残片从帐外沙盘上被剑风卷起——那正是昨日斩杀汉军探子时被暗器割裂的信物。帐外传来赵营亲卫调动的甲胄碰撞声，而巡游归来的伤兵们正将浸满龙涎香的绷带偷偷塞进各营箭囊。",\n  "choices": [\n    {\n      "option": "当众剖开赵营使者腹腔，将虎纹绦带残片钉在帅旗之下",\n      "summary": "以暴制暴震慑宵小"'
2025-09-26 20:19:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1108 预览='```json\n{\n  "text": "血色绷带在夜风中翻卷如幡，龙涎香混着血腥味渗入每名将士的肺叶。当伤兵轿辇行至赵营主大帐前时，一名佩鱼符的使者突然撞开帐帘，腰间玉玦正闪烁着与彭城密使相同的暗纹。项羽巨阙剑尖挑起那人的衣摆，断裂的虎纹绦带残片从帐外沙盘上被剑风卷起——那正是昨日斩杀汉军探子时被暗器割裂的信物。帐外'
2025-09-26 20:19:39 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1096 预览='{\n  "text": "血色绷带在夜风中翻卷如幡，龙涎香混着血腥味渗入每名将士的肺叶。当伤兵轿辇行至赵营主大帐前时，一名佩鱼符的使者突然撞开帐帘，腰间玉玦正闪烁着与彭城密使相同的暗纹。项羽巨阙剑尖挑起那人的衣摆，断裂的虎纹绦带残片从帐外沙盘上被剑风卷起——那正是昨日斩杀汉军探子时被暗器割裂的信物。帐外传来赵营亲卫调动'
2025-09-26 20:19:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 182
2025-09-26 20:19:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:39 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 20:19:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 20:19:39 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:39 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=10 parent=3 choice='挥剑斩断案几，率八千江东子弟连夜追击刘邦主力'
2025-09-26 20:19:39 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=10 depth=1
2025-09-26 20:19:39 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '挥剑斩断案几，率八千江东子弟连夜追击刘邦主力': cannot schedule new futures after shutdown
2025-09-26 20:19:40 | INFO     | core.llm_clients:generate:250 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 20:19:40 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2446
2025-09-26 20:19:40 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=907 预览='{"text": "剖开的伤口皮肉翻卷，暗红血肉间并无异物。项羽用剑尖挑开溃烂的肌腱，青铜灯树的火苗突然爆燃，将他眉骨处的旧箭伤映得猩红。\'无毒！\'他暴喝声震得案上竹简簌簌作响，\'汉军这是在挑拨我军与百姓！\'帐外鼓噪声陡然加剧，彭城方向的叛徒已驱赶着上千百姓逼近营寨，火把在夜色中蜿蜒如毒蛇。项羽猛然扯断腰间断绦，露出腰间新旧箭伤交错的狰狞疤痕，手指深深掐进掌心——那日鸿门宴上刘邦的谄笑，此刻竟与百姓呜咽声重叠。帐中谋士们噤若寒蝉，唯有案角陶爵碎片在烛光中泛着冷光。", "choices": [{"option": "纵马冲出大帐，亲率精骑截断汉军退路直扑刘邦主营", "summary": "以'
2025-09-26 20:19:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=907 预览='{"text": "剖开的伤口皮肉翻卷，暗红血肉间并无异物。项羽用剑尖挑开溃烂的肌腱，青铜灯树的火苗突然爆燃，将他眉骨处的旧箭伤映得猩红。\'无毒！\'他暴喝声震得案上竹简簌簌作响，\'汉军这是在挑拨我军与百姓！\'帐外鼓噪声陡然加剧，彭城方向的叛徒已驱赶着上千百姓逼近营寨，火把在夜色中蜿蜒如毒蛇。项羽猛然扯断腰间断绦，露出腰'
2025-09-26 20:19:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=907 预览='{"text": "剖开的伤口皮肉翻卷，暗红血肉间并无异物。项羽用剑尖挑开溃烂的肌腱，青铜灯树的火苗突然爆燃，将他眉骨处的旧箭伤映得猩红。\'无毒！\'他暴喝声震得案上竹简簌簌作响，\'汉军这是在挑拨我军与百姓！\'帐外鼓噪声陡然加剧，彭城方向的叛徒已驱赶着上千百姓逼近营寨，火把在夜色中蜿蜒如毒蛇。项羽猛然扯断腰间断绦，露出腰'
2025-09-26 20:19:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 224
2025-09-26 20:19:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:19:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 20:19:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 20:19:40 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:19:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=11 parent=4 choice='亲自率精锐夜袭汉军粮道，以雷霆之势震慑刘邦'
2025-09-26 20:19:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=11 depth=1
2025-09-26 20:19:40 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '亲自率精锐夜袭汉军粮道，以雷霆之势震慑刘邦': cannot schedule new futures after shutdown
2025-09-26 20:20:27 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2480
2025-09-26 20:20:27 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1117 预览='\n\n```json\n{\n  "text": "血浸透的绷带在夜风中飘散龙涎香，抬着的伤兵营车碾过楚军大营的青石路。士兵们凑近嗅闻时，绷带上若隐若现的焦黑指痕与箭矢贯穿的伤口，让甲胄摩擦声渐次化作低吼。\'汉狗敢烧我粮仓！\' \'拿百姓当盾牌算什么好汉！\' 沸腾的声浪惊起鸦群，恰逢彭城方向火光冲天——赵营主的赤帜已换作汉军青旗。项羽站在观星台上俯瞰沸腾的军营，忽见东南角火把簇拥着异动：竟是未归附的江东老卒自发列阵，矛尖指向刘邦来路。",\n  "choices": [\n    {\n      "option": "亲自率铁骑夜袭刘邦粮仓，用火油焚毁其补给线",\n      "summary": "以雷'
2025-09-26 20:20:27 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1115 预览='```json\n{\n  "text": "血浸透的绷带在夜风中飘散龙涎香，抬着的伤兵营车碾过楚军大营的青石路。士兵们凑近嗅闻时，绷带上若隐若现的焦黑指痕与箭矢贯穿的伤口，让甲胄摩擦声渐次化作低吼。\'汉狗敢烧我粮仓！\' \'拿百姓当盾牌算什么好汉！\' 沸腾的声浪惊起鸦群，恰逢彭城方向火光冲天——赵营主的赤帜已换作汉军青旗。'
2025-09-26 20:20:27 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1103 预览='{\n  "text": "血浸透的绷带在夜风中飘散龙涎香，抬着的伤兵营车碾过楚军大营的青石路。士兵们凑近嗅闻时，绷带上若隐若现的焦黑指痕与箭矢贯穿的伤口，让甲胄摩擦声渐次化作低吼。\'汉狗敢烧我粮仓！\' \'拿百姓当盾牌算什么好汉！\' 沸腾的声浪惊起鸦群，恰逢彭城方向火光冲天——赵营主的赤帜已换作汉军青旗。项羽站在观星台上'
2025-09-26 20:20:27 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 192
2025-09-26 20:20:27 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:20:27 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 20:20:27 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 20:20:27 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:20:27 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=12 parent=3 choice='解下断裂的虎纹绦带抛给钟离昧：'即刻联络旧部，调三万楚军精锐秘密入彭城''
2025-09-26 20:20:27 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=12 depth=1
2025-09-26 20:20:27 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '解下断裂的虎纹绦带抛给钟离昧：'即刻联络旧部，调三万楚军精锐秘密入彭城'': cannot schedule new futures after shutdown
2025-09-26 20:20:31 | INFO     | core.llm_clients:generate:260 - 模型生成成功 - 模型: Qwen/QwQ-32B, tokens使用: 2726
2025-09-26 20:20:31 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=1099 预览='\n\n```json\n{\n  "text": "血浸的绷带在夜风中飘散龙涎香的腥甜，楚军将士们将伤兵抬过篝火时，甲胄撞击声震得沙盘簌簌作响。项羽的玄色披风扫过案上密卷，忽有亲卫惊呼——绷带里裹着的竟是半截汉军箭簇！帐外传来骚动，三营副将按剑跪地：\'禀大王，东南哨塔发现密文，说彭城豪族正与汉使交易军械！\'项羽的巨阙剑尖挑起那支箭，青铜剑格映出箭尾\'沛\'字烙印，恰与沙盘上刘邦军的行军路线重合。夜枭啼叫中，彭城逃来的老卒突然指着绷带大喊：\'这香味...和汉军毒烟一模一样！\'",\n  "choices": [\n    {\n      "option": "当众劈断箭杆，命死士连夜突袭沛军粮道",\n   '
2025-09-26 20:20:31 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=1097 预览='```json\n{\n  "text": "血浸的绷带在夜风中飘散龙涎香的腥甜，楚军将士们将伤兵抬过篝火时，甲胄撞击声震得沙盘簌簌作响。项羽的玄色披风扫过案上密卷，忽有亲卫惊呼——绷带里裹着的竟是半截汉军箭簇！帐外传来骚动，三营副将按剑跪地：\'禀大王，东南哨塔发现密文，说彭城豪族正与汉使交易军械！\'项羽的巨阙剑尖挑起那支'
2025-09-26 20:20:31 | DEBUG    | core.story_engine:_extract_json:210 - [JSON] 捕获到Markdown代码围栏，内层长度=1085 预览='{\n  "text": "血浸的绷带在夜风中飘散龙涎香的腥甜，楚军将士们将伤兵抬过篝火时，甲胄撞击声震得沙盘簌簌作响。项羽的玄色披风扫过案上密卷，忽有亲卫惊呼——绷带里裹着的竟是半截汉军箭簇！帐外传来骚动，三营副将按剑跪地：\'禀大王，东南哨塔发现密文，说彭城豪族正与汉使交易军械！\'项羽的巨阙剑尖挑起那支箭，青铜剑格映出'
2025-09-26 20:20:31 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 212
2025-09-26 20:20:31 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 20:20:31 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 20:20:31 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 20:20:31 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 20:20:31 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=13 parent=3 choice='命人抬来断头台置于辕门，当众枭首三个通敌小吏'
2025-09-26 20:20:31 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=1 node=13 depth=1
2025-09-26 20:20:31 | ERROR    | core.speculation:_generate_children_pipeline:209 - [Speculation] pipeline child generation failed for choice '命人抬来断头台置于辕门，当众枭首三个通敌小吏': cannot schedule new futures after shutdown
2025-09-26 20:20:32 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:20:33 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 20:20:33 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 20:20:33 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 20:20:33 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 20:20:33 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 20:20:33 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:20:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:20:33 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 20:20:33 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 20:20:33 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 20:20:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:20:34 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 20:20:34 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 20:20:34 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 20:20:34 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 20:20:34 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 20:47:47 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 20:47:48 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:47:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:48:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:48:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:48:07 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 20:48:07 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 20:48:07 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 20:48:07 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 20:48:07 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 20:48:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:07 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 20:48:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 20:48:07 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 20:48:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:08 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 20:48:08 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 20:48:08 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 20:48:08 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 20:48:08 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 20:48:09 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 20:48:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:48:11 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 20:48:11 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 20:48:11 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 20:48:11 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 20:48:11 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 20:48:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:11 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 20:48:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 20:48:11 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 20:48:11 | ERROR    | backend.main:_run_alembic_cmd:94 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 3221225786.
2025-09-26 20:48:11 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 20:48:11 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 20:48:11 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 20:48:11 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 20:48:11 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 20:48:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:48:13 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-jktujilqgvlkhhnuqjpkvfczxbafmkkibwkjysvixsunyfcd', 'base_url': 'https://api.siliconflow.cn/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 20:48:13 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 20:48:13 | INFO     | core.llm_clients:__init__:89 - 模型: Qwen/QwQ-32B
2025-09-26 20:48:13 | INFO     | core.llm_clients:__init__:90 - API地址: https://api.siliconflow.cn/v1
2025-09-26 20:48:13 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 20:48:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:13 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 20:48:13 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 20:48:13 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 20:48:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 20:48:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 20:48:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 20:48:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 20:48:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: Qwen/QwQ-32B
2025-09-26 20:48:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://api.siliconflow.cn/v1
2025-09-26 20:59:51 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 20:59:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 20:59:54 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:00:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:00:46 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:01:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:01:35 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:01:35 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:01:35 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:01:35 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:01:35 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:01:35 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:01:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:01:35 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:01:35 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:01:35 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:01:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:01:36 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:01:36 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:01:36 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:01:36 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:01:36 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:03:47 | INFO     | api.story:prepare_start_level:190 - 开始生成故事概要，愿望：项羽...
2025-09-26 21:03:49 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:03:49 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1002
2025-09-26 21:03:49 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:03:49 | INFO     | api.story:prepare_start_level:266 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:03:49 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:03:49 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-26 21:03:53 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:03:53 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1428
2025-09-26 21:03:53 | INFO     | core.story_engine:start_story:403 - [LLM raw][start-V2] 长度=878 预览='{"text": "垓下寒夜，朔风卷旗如铁。项羽立于军帐前，手中青铜剑映着残月，听闻四面楚歌渐起，将士面色凝重。他怒目扫视远方，却见一骑飞驰而至——是斥候，带来噩耗：汉军已断粮道，围城三日，士卒腹中空如鼓。帐内烛火摇曳，一名老将低声劝谏：‘大王，不如焚营突围，或可一线生机。’项羽握紧剑柄，指节发白，眼中燃起烈焰般的决意。他知道，此刻的每一步，都可能决定生死存亡。然而，真正的敌人或许不在城外，而在人心之中。", "choices": [{"option": "命人点燃所有战鼓与号角，以声势震慑敌军，制造虚张声势的突围假象", "summary": "以气势破局，扰乱敌方判断", "effects'
2025-09-26 21:03:53 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=878 预览='{"text": "垓下寒夜，朔风卷旗如铁。项羽立于军帐前，手中青铜剑映着残月，听闻四面楚歌渐起，将士面色凝重。他怒目扫视远方，却见一骑飞驰而至——是斥候，带来噩耗：汉军已断粮道，围城三日，士卒腹中空如鼓。帐内烛火摇曳，一名老将低声劝谏：‘大王，不如焚营突围，或可一线生机。’项羽握紧剑柄，指节发白，眼中燃起烈焰般的决意'
2025-09-26 21:03:53 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=878 预览='{"text": "垓下寒夜，朔风卷旗如铁。项羽立于军帐前，手中青铜剑映着残月，听闻四面楚歌渐起，将士面色凝重。他怒目扫视远方，却见一骑飞驰而至——是斥候，带来噩耗：汉军已断粮道，围城三日，士卒腹中空如鼓。帐内烛火摇曳，一名老将低声劝谏：‘大王，不如焚营突围，或可一线生机。’项羽握紧剑柄，指节发白，眼中燃起烈焰般的决意'
2025-09-26 21:03:53 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 194
2025-09-26 21:03:53 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:03:53 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:03:53 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:03:53 | INFO     | core.story_engine:start_story:445 - 新故事生成成功[V2]
2025-09-26 21:03:53 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=194
2025-09-26 21:03:53 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=2
2025-09-26 21:03:53 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=14
2025-09-26 21:03:53 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=14 depth=3
2025-09-26 21:03:53 | INFO     | api.story:_background_generate_with_pregeneration:97 - [预生成] 已触发speculation预生成: session=2, node=14
2025-09-26 21:03:53 | INFO     | api.story:_background_generate_with_pregeneration:99 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=2
2025-09-26 21:03:53 | DEBUG    | api.story:_background_generate_with_pregeneration:111 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:03:53 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=14
2025-09-26 21:03:53 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人点燃所有战鼓与号角，以声势震慑敌军，制造虚张声势的突围假象
2025-09-26 21:03:53 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 亲赴前线，当众斩杀一名临阵脱逃的将领，以血立威，重振军心
2025-09-26 21:03:53 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 召来谋士密议，暗中派遣细作潜入汉营，散布谣言称刘邦身患重疾
2025-09-26 21:03:57 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:03:57 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1640
2025-09-26 21:03:57 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=917 预览='{"text": "风雪愈发凛冽，帐外楚歌如刀割心。项羽凝视手中剑锋，忽而仰天长笑，声震穹苍：‘天亡我，非战之罪！’话音未落，他猛然拔剑劈向案几，木屑飞溅，残烛尽灭。黑暗中，他转身对亲卫低语：‘传令三军，今夜子时，全军披甲，随我冲阵！’士兵们惊愕抬头，却见霸王眼中火光不灭，仿佛已将生死置之度外。然而就在他踏出帐门的刹那，一名年轻小卒踉跄跪倒，怀中掉出半块干粮——那是从死人尸身扒下的。项羽脚步顿住，目光如刃扫过那微弱的光亮，心中翻涌起难以言喻的沉重。这不仅是突围之战，更是对人心与尊严的最后搏斗。", "choices": [{"option": "将那半块干粮掷于地上，厉声下令全军以血为誓，破围'
2025-09-26 21:03:57 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=917 预览='{"text": "风雪愈发凛冽，帐外楚歌如刀割心。项羽凝视手中剑锋，忽而仰天长笑，声震穹苍：‘天亡我，非战之罪！’话音未落，他猛然拔剑劈向案几，木屑飞溅，残烛尽灭。黑暗中，他转身对亲卫低语：‘传令三军，今夜子时，全军披甲，随我冲阵！’士兵们惊愕抬头，却见霸王眼中火光不灭，仿佛已将生死置之度外。然而就在他踏出帐门的刹那'
2025-09-26 21:03:57 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=917 预览='{"text": "风雪愈发凛冽，帐外楚歌如刀割心。项羽凝视手中剑锋，忽而仰天长笑，声震穹苍：‘天亡我，非战之罪！’话音未落，他猛然拔剑劈向案几，木屑飞溅，残烛尽灭。黑暗中，他转身对亲卫低语：‘传令三军，今夜子时，全军披甲，随我冲阵！’士兵们惊愕抬头，却见霸王眼中火光不灭，仿佛已将生死置之度外。然而就在他踏出帐门的刹那'
2025-09-26 21:03:57 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 239
2025-09-26 21:03:57 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:03:57 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 21:03:57 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 21:03:57 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:03:57 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=15 parent=14 choice='亲赴前线，当众斩杀一名临阵脱逃的将领，以血立威，重振军心'
2025-09-26 21:03:57 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=15 depth=2
2025-09-26 21:03:57 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=15 completed, triggered next level depth=2
2025-09-26 21:03:57 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=15
2025-09-26 21:03:57 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 将那半块干粮掷于地上，厉声下令全军以血为誓，破围而出
2025-09-26 21:03:57 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 默默拾起干粮，亲手递给那小卒，并轻声道‘活着，才配听楚歌’
2025-09-26 21:03:57 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人将所有粮袋尽数焚毁，纵火于营前，以烈焰为号，直扑汉军大营
2025-09-26 21:03:58 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:03:58 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1628
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=914 预览='{"text": "寒风撕扯着战旗，残月如刀割裂夜幕。项羽凝视着帐外摇曳的火光，耳边楚歌愈发凄厉，仿佛从四面八方渗入骨髓。他缓缓拔剑，剑锋轻触唇角，血珠滑落，在冷月下泛出暗红微光。老将低语未尽，一匹黑马嘶鸣自远处奔来——是信使，马背上的竹简已浸透雨水。项羽接过，展开刹那，瞳孔骤缩：‘韩信亲率三万精骑，已断东门粮道。’他猛然抬头，目光如炬，却见将士们眼中已有动摇之色。他知道，此刻若不决断，人心将如这残烛般熄灭。但真正的风暴，或许不在敌营，而在自己心中——那曾不可一世的霸王，是否还能听见自己的心跳？", "choices": [{"option": "当众斩杀一名动摇军心的将领，以血立威，震慑全营'
2025-09-26 21:03:58 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=914 预览='{"text": "寒风撕扯着战旗，残月如刀割裂夜幕。项羽凝视着帐外摇曳的火光，耳边楚歌愈发凄厉，仿佛从四面八方渗入骨髓。他缓缓拔剑，剑锋轻触唇角，血珠滑落，在冷月下泛出暗红微光。老将低语未尽，一匹黑马嘶鸣自远处奔来——是信使，马背上的竹简已浸透雨水。项羽接过，展开刹那，瞳孔骤缩：‘韩信亲率三万精骑，已断东门粮道。’他'
2025-09-26 21:03:58 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=914 预览='{"text": "寒风撕扯着战旗，残月如刀割裂夜幕。项羽凝视着帐外摇曳的火光，耳边楚歌愈发凄厉，仿佛从四面八方渗入骨髓。他缓缓拔剑，剑锋轻触唇角，血珠滑落，在冷月下泛出暗红微光。老将低语未尽，一匹黑马嘶鸣自远处奔来——是信使，马背上的竹简已浸透雨水。项羽接过，展开刹那，瞳孔骤缩：‘韩信亲率三万精骑，已断东门粮道。’他'
2025-09-26 21:03:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 240
2025-09-26 21:03:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:03:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:03:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:03:58 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=16 parent=14 choice='召来谋士密议，暗中派遣细作潜入汉营，散布谣言称刘邦身患重疾'
2025-09-26 21:03:58 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=16 depth=2
2025-09-26 21:03:58 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=16 completed, triggered next level depth=2
2025-09-26 21:03:58 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=16
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 当众斩杀一名动摇军心的将领，以血立威，震慑全营
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 命人传令，将最后一锅稀粥分给伤兵，自己则吞下草根充饥
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 深夜独自策马出营，直奔汉军大营前，高声质问刘邦为何背信弃义
2025-09-26 21:03:58 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:03:58 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1655
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=901 预览='{"text": "寒风如刃，割裂夜色。项羽凝视着城外连绵的火光，楚歌未歇，军心似散。他忽然拔剑斩断帐前旗杆，青铜剑锋划破空气，发出清越长鸣。‘若天亡我，非战之罪！’他低吼一声，转身走向马厩，披上玄甲，铁蹄踏地声震得雪雾飞溅。老将欲阻，却被他目光一扫，退后半步。此时，一名小卒踉跄奔来，手中紧握一封密信——竟是韩信亲笔，字迹潦草，却言‘若能弃城南逃，可借水道通吴越，尚有三分活路’。项羽盯着那信纸，指节在剑柄上捏得发白，仿佛听见了江东父老的呼唤，也听见了命运的倒计时。", "choices": [{"option": "撕碎密信掷于火盆，命全军整装向北突围，以死破局", "summary": "以'
2025-09-26 21:03:58 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=901 预览='{"text": "寒风如刃，割裂夜色。项羽凝视着城外连绵的火光，楚歌未歇，军心似散。他忽然拔剑斩断帐前旗杆，青铜剑锋划破空气，发出清越长鸣。‘若天亡我，非战之罪！’他低吼一声，转身走向马厩，披上玄甲，铁蹄踏地声震得雪雾飞溅。老将欲阻，却被他目光一扫，退后半步。此时，一名小卒踉跄奔来，手中紧握一封密信——竟是韩信亲笔，'
2025-09-26 21:03:58 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=901 预览='{"text": "寒风如刃，割裂夜色。项羽凝视着城外连绵的火光，楚歌未歇，军心似散。他忽然拔剑斩断帐前旗杆，青铜剑锋划破空气，发出清越长鸣。‘若天亡我，非战之罪！’他低吼一声，转身走向马厩，披上玄甲，铁蹄踏地声震得雪雾飞溅。老将欲阻，却被他目光一扫，退后半步。此时，一名小卒踉跄奔来，手中紧握一封密信——竟是韩信亲笔，'
2025-09-26 21:03:58 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 224
2025-09-26 21:03:58 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:03:58 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 21:03:58 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:03:58 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=17 parent=14 choice='命人点燃所有战鼓与号角，以声势震慑敌军，制造虚张声势的突围假象'
2025-09-26 21:03:58 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=17 depth=2
2025-09-26 21:03:58 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=17 completed, triggered next level depth=2
2025-09-26 21:03:58 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=17
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 撕碎密信掷于火盆，命全军整装向北突围，以死破局
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 召集群将秘密议事，以重金悬赏献计者，暗中联络城内叛将
2025-09-26 21:03:58 | INFO     | core.story_engine:continue_story:493 - 继续故事，用户选择: 独自策马出营，直面汉军大营，高呼‘项籍在此，何不迎战’
2025-09-26 21:04:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1966
2025-09-26 21:04:02 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=988 预览='{"text": "寒风撕扯着战旗，项羽踏出帐门，青铜剑在月光下划出一道冷芒。他缓步走向阵前，身后亲卫抬来一名颤抖的将领——正是昨夜擅自退入后营的都尉。将士们屏息凝视，火把摇曳中，那人的铠甲上还沾着未干的泥污。项羽不发一言，只将剑尖轻轻抵住其咽喉，声音如铁：“你可认得这剑？”那人瞳孔骤缩，喉头滚动，却说不出话。项羽猛然拔剑，血光飞溅，头颅滚落于地，鲜血浸透雪地，像一朵骤然绽放的红梅。刹那间，万籁俱寂。随后，项羽拾起断首，高举过顶，嘶声吼道：‘谁敢怯战，便是此下场！’军心如潮水翻涌，悲愤与敬畏交织，仿佛死寂的魂魄被重新点燃。然而就在此刻，远处传来一声微弱的呜咽——是那名小卒，正跪在尸堆旁，捧着半'
2025-09-26 21:04:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=988 预览='{"text": "寒风撕扯着战旗，项羽踏出帐门，青铜剑在月光下划出一道冷芒。他缓步走向阵前，身后亲卫抬来一名颤抖的将领——正是昨夜擅自退入后营的都尉。将士们屏息凝视，火把摇曳中，那人的铠甲上还沾着未干的泥污。项羽不发一言，只将剑尖轻轻抵住其咽喉，声音如铁：“你可认得这剑？”那人瞳孔骤缩，喉头滚动，却说不出话。项羽猛然'
2025-09-26 21:04:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=988 预览='{"text": "寒风撕扯着战旗，项羽踏出帐门，青铜剑在月光下划出一道冷芒。他缓步走向阵前，身后亲卫抬来一名颤抖的将领——正是昨夜擅自退入后营的都尉。将士们屏息凝视，火把摇曳中，那人的铠甲上还沾着未干的泥污。项羽不发一言，只将剑尖轻轻抵住其咽喉，声音如铁：“你可认得这剑？”那人瞳孔骤缩，喉头滚动，却说不出话。项羽猛然'
2025-09-26 21:04:02 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 299
2025-09-26 21:04:02 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:02 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 21:04:02 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 21:04:02 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:02 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=18 parent=15 choice='默默拾起干粮，亲手递给那小卒，并轻声道‘活着，才配听楚歌’'
2025-09-26 21:04:02 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=18 depth=1
2025-09-26 21:04:02 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=18 completed, triggered next level depth=1
2025-09-26 21:04:02 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=2 node=18
2025-09-26 21:04:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1889
2025-09-26 21:04:02 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=918 预览='{"text": "项羽踏出帐门，寒风如刃割面。他缓步走向校场中央，手中青铜剑斜指地面，血珠自剑尖滴落，在冻土上绽开暗红印记。那名临阵脱逃的将领跪伏于地，面色惨白，双目失神。项羽俯身，目光如炬直刺其心：‘你怕死，可曾想过身后三千将士？’话音未落，剑光一闪，头颅滚落雪地，鲜血喷涌如泉。四野死寂，唯有风声呜咽。他拾起首级，高举过顶，厉声喝道：‘今日我斩一人，为明日全军之魂！’士兵们怔然凝望，有人低头，有人握紧刀柄，有人眼中泛起泪光。战鼓未响，人心却已沸腾。然而就在此时，远处传来马蹄急促，一骑疾驰而来——是汉军斥候，正朝楚营飞奔，似有密报。项羽瞳孔微缩，知道这短暂的震慑，或许已惊动敌营。", "ch'
2025-09-26 21:04:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=918 预览='{"text": "项羽踏出帐门，寒风如刃割面。他缓步走向校场中央，手中青铜剑斜指地面，血珠自剑尖滴落，在冻土上绽开暗红印记。那名临阵脱逃的将领跪伏于地，面色惨白，双目失神。项羽俯身，目光如炬直刺其心：‘你怕死，可曾想过身后三千将士？’话音未落，剑光一闪，头颅滚落雪地，鲜血喷涌如泉。四野死寂，唯有风声呜咽。他拾起首级，'
2025-09-26 21:04:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=918 预览='{"text": "项羽踏出帐门，寒风如刃割面。他缓步走向校场中央，手中青铜剑斜指地面，血珠自剑尖滴落，在冻土上绽开暗红印记。那名临阵脱逃的将领跪伏于地，面色惨白，双目失神。项羽俯身，目光如炬直刺其心：‘你怕死，可曾想过身后三千将士？’话音未落，剑光一闪，头颅滚落雪地，鲜血喷涌如泉。四野死寂，唯有风声呜咽。他拾起首级，'
2025-09-26 21:04:02 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 284
2025-09-26 21:04:02 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:02 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 21:04:02 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 21:04:02 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:02 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=19 parent=15 choice='将那半块干粮掷于地上，厉声下令全军以血为誓，破围而出'
2025-09-26 21:04:02 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=19 depth=1
2025-09-26 21:04:02 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=19 completed, triggered next level depth=1
2025-09-26 21:04:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1930
2025-09-26 21:04:02 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=975 预览='{"text": "项羽踏出帐门，寒风如刃割面。他缓步走向校场中央，手中青铜剑在残月下一闪，血光骤起——那名临阵脱逃的将领已被斩首，头颅高悬于旗杆之上，脖颈喷涌的鲜血在雪地上凝成暗红冰纹。士兵们跪伏于地，呼吸凝滞，唯有风卷着楚歌与血雾，在夜空中盘旋不散。项羽立于尸首前，声音如铁铸般穿透风雪：‘今日之血，非为杀戮，乃为重铸我军魂！’他将剑插入冻土，剑身嗡鸣，仿佛回应着将士心中沉寂已久的战意。刹那间，有老卒仰天嘶吼，继而万声应和，如雷贯耳。军心似火，燃尽绝望。然而就在此刻，一名副将踉跄奔来，怀中紧抱一卷帛书——那是从敌营俘虏口中得来的密信，上面赫然写着‘刘邦已遣使勾连江东旧部’。项羽目光骤冷，剑尖'
2025-09-26 21:04:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=975 预览='{"text": "项羽踏出帐门，寒风如刃割面。他缓步走向校场中央，手中青铜剑在残月下一闪，血光骤起——那名临阵脱逃的将领已被斩首，头颅高悬于旗杆之上，脖颈喷涌的鲜血在雪地上凝成暗红冰纹。士兵们跪伏于地，呼吸凝滞，唯有风卷着楚歌与血雾，在夜空中盘旋不散。项羽立于尸首前，声音如铁铸般穿透风雪：‘今日之血，非为杀戮，乃为重'
2025-09-26 21:04:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=975 预览='{"text": "项羽踏出帐门，寒风如刃割面。他缓步走向校场中央，手中青铜剑在残月下一闪，血光骤起——那名临阵脱逃的将领已被斩首，头颅高悬于旗杆之上，脖颈喷涌的鲜血在雪地上凝成暗红冰纹。士兵们跪伏于地，呼吸凝滞，唯有风卷着楚歌与血雾，在夜空中盘旋不散。项羽立于尸首前，声音如铁铸般穿透风雪：‘今日之血，非为杀戮，乃为重'
2025-09-26 21:04:02 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 309
2025-09-26 21:04:02 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:02 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 21:04:02 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 21:04:02 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:02 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=20 parent=15 choice='命人将所有粮袋尽数焚毁，纵火于营前，以烈焰为号，直扑汉军大营'
2025-09-26 21:04:02 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=20 depth=1
2025-09-26 21:04:02 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=20 completed, triggered next level depth=1
2025-09-26 21:04:03 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:03 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1877
2025-09-26 21:04:03 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=926 预览='{"text": "项羽将竹简缓缓卷起，指尖轻抚上那行‘刘邦重疾’的字迹，眼中寒光微闪。他转身步入内帐，唤来心腹谋士范增之侄——一名精通音律与人心的隐士。‘传令下去，命三名楚歌乐师夜半于城南高台弹唱《悲歌行》，曲调哀婉如泣，每句皆暗藏‘汉主病危、军心动摇’之语。’他低声道，声音如刀削冰面。与此同时，一队身着汉军破衣的细作悄然潜出，每人怀中藏着伪造的密信与染血的药囊，目标直指韩信大营外的粮车驿站。风声渐紧，火光在帐篷间跳跃，仿佛整座垓下正在被无形之手撕裂。人心，比刀锋更易割裂。", "choices": [{"option": "命乐师以旧楚宫曲调编排新词，让楚歌在汉营外反复回荡，诱使士兵思乡叛'
2025-09-26 21:04:03 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=926 预览='{"text": "项羽将竹简缓缓卷起，指尖轻抚上那行‘刘邦重疾’的字迹，眼中寒光微闪。他转身步入内帐，唤来心腹谋士范增之侄——一名精通音律与人心的隐士。‘传令下去，命三名楚歌乐师夜半于城南高台弹唱《悲歌行》，曲调哀婉如泣，每句皆暗藏‘汉主病危、军心动摇’之语。’他低声道，声音如刀削冰面。与此同时，一队身着汉军破衣的细'
2025-09-26 21:04:03 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=926 预览='{"text": "项羽将竹简缓缓卷起，指尖轻抚上那行‘刘邦重疾’的字迹，眼中寒光微闪。他转身步入内帐，唤来心腹谋士范增之侄——一名精通音律与人心的隐士。‘传令下去，命三名楚歌乐师夜半于城南高台弹唱《悲歌行》，曲调哀婉如泣，每句皆暗藏‘汉主病危、军心动摇’之语。’他低声道，声音如刀削冰面。与此同时，一队身着汉军破衣的细'
2025-09-26 21:04:03 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 230
2025-09-26 21:04:03 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:03 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 21:04:03 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 21:04:03 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:03 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=21 parent=16 choice='深夜独自策马出营，直奔汉军大营前，高声质问刘邦为何背信弃义'
2025-09-26 21:04:03 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=21 depth=1
2025-09-26 21:04:03 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=21 completed, triggered next level depth=1
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1902
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=930 预览='{"text": "夜色如墨，帐中烛火将项羽的影子拉得修长如刀。他凝视手中竹简，眉峰紧锁，忽而冷笑一声：‘刘邦病重？倒不如说，是人心先病了。’他召来心腹谋士，低语片刻，命人取来三枚青铜铃铛，系于飞鸟足踝，又以朱砂在帛书上写下‘汉主已崩，军心涣散’八字。暗令细作携帛书混入汉营炊事队，趁夜风送信，更以鸣铃为号，使谣言如瘟疫般蔓延。一时间，汉营内疑云密布，探马奔走，将领面面相觑。项羽立于帐外，仰望残月，耳畔似闻楚歌与战鼓交织成网，将敌阵悄然撕裂。然而，这虚实之间，终有破绽——若被识破，反噬之祸，或将焚尽此夜孤光。", "choices": [{"option": "命人假扮汉军斥候，在篝火边高声谈论'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=930 预览='{"text": "夜色如墨，帐中烛火将项羽的影子拉得修长如刀。他凝视手中竹简，眉峰紧锁，忽而冷笑一声：‘刘邦病重？倒不如说，是人心先病了。’他召来心腹谋士，低语片刻，命人取来三枚青铜铃铛，系于飞鸟足踝，又以朱砂在帛书上写下‘汉主已崩，军心涣散’八字。暗令细作携帛书混入汉营炊事队，趁夜风送信，更以鸣铃为号，使谣言如瘟疫'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=930 预览='{"text": "夜色如墨，帐中烛火将项羽的影子拉得修长如刀。他凝视手中竹简，眉峰紧锁，忽而冷笑一声：‘刘邦病重？倒不如说，是人心先病了。’他召来心腹谋士，低语片刻，命人取来三枚青铜铃铛，系于飞鸟足踝，又以朱砂在帛书上写下‘汉主已崩，军心涣散’八字。暗令细作携帛书混入汉营炊事队，趁夜风送信，更以鸣铃为号，使谣言如瘟疫'
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 246
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=22 parent=16 choice='命人传令，将最后一锅稀粥分给伤兵，自己则吞下草根充饥'
2025-09-26 21:04:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=22 depth=1
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=22 completed, triggered next level depth=1
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1861
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=888 预览='{"text": "战鼓骤响，如雷贯耳，号角声撕裂夜幕，自四面八方涌起，仿佛千军万马奔袭而来。项羽立于高台，玄甲映着火光，眼中燃着孤注一掷的烈焰。他下令点燃所有鼓架与铜角，火焰舔舐着青铜器身，发出嗡鸣般的余音。远处汉军营帐顿时骚动，火光摇曳中似见楚骑奔腾，烟尘蔽天。然而，这声势浩大之下，却是空营虚影——粮草未焚，士卒疲敝，连战鼓皆由老卒强撑敲击。风中飘来一句低语：‘大王，这声音……怕是撑不过三更。’项羽不答，只将剑尖缓缓划过自己掌心，血珠滴落鼓面，如誓约之印。", "choices": [{"option": "命亲卫率精锐骑兵突袭敌军侧翼，借声势掩护真突围", "summary": "以虚张'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=888 预览='{"text": "战鼓骤响，如雷贯耳，号角声撕裂夜幕，自四面八方涌起，仿佛千军万马奔袭而来。项羽立于高台，玄甲映着火光，眼中燃着孤注一掷的烈焰。他下令点燃所有鼓架与铜角，火焰舔舐着青铜器身，发出嗡鸣般的余音。远处汉军营帐顿时骚动，火光摇曳中似见楚骑奔腾，烟尘蔽天。然而，这声势浩大之下，却是空营虚影——粮草未焚，士卒疲'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=888 预览='{"text": "战鼓骤响，如雷贯耳，号角声撕裂夜幕，自四面八方涌起，仿佛千军万马奔袭而来。项羽立于高台，玄甲映着火光，眼中燃着孤注一掷的烈焰。他下令点燃所有鼓架与铜角，火焰舔舐着青铜器身，发出嗡鸣般的余音。远处汉军营帐顿时骚动，火光摇曳中似见楚骑奔腾，烟尘蔽天。然而，这声势浩大之下，却是空营虚影——粮草未焚，士卒疲'
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 222
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=23 parent=17 choice='撕碎密信掷于火盆，命全军整装向北突围，以死破局'
2025-09-26 21:04:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=23 depth=1
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=23 completed, triggered next level depth=1
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1882
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=917 预览='{"text": "战鼓如雷，号角撕裂夜空。项羽一声令下，数十面大鼓轰然擂响，铜锣震天，声浪如潮水般涌向敌营。火把齐举，旗帜翻飞，军中士卒高呼‘霸王在此’，声震四野。汉军阵前顿时骚动，斥候惊报：楚军似有万人突围之势！远处火光映照下，项羽立于高台，玄甲如墨，剑锋指天，仿佛真有千军万马正从黑暗中奔腾而出。然而，这声势浩大的假象背后，是粮尽兵疲的真相——每一记鼓点，都是在燃烧最后的意志。老将望着那被风卷起的残旗，低声叹息：‘大王，这声势，能骗得一时，却骗不了三日。’但项羽只是冷笑，眼中燃着不肯熄灭的烈焰。", "choices": [{"option": "命亲卫率精锐骑兵突袭东侧汉军薄弱点，借鼓声'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=917 预览='{"text": "战鼓如雷，号角撕裂夜空。项羽一声令下，数十面大鼓轰然擂响，铜锣震天，声浪如潮水般涌向敌营。火把齐举，旗帜翻飞，军中士卒高呼‘霸王在此’，声震四野。汉军阵前顿时骚动，斥候惊报：楚军似有万人突围之势！远处火光映照下，项羽立于高台，玄甲如墨，剑锋指天，仿佛真有千军万马正从黑暗中奔腾而出。然而，这声势浩大的'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=917 预览='{"text": "战鼓如雷，号角撕裂夜空。项羽一声令下，数十面大鼓轰然擂响，铜锣震天，声浪如潮水般涌向敌营。火把齐举，旗帜翻飞，军中士卒高呼‘霸王在此’，声震四野。汉军阵前顿时骚动，斥候惊报：楚军似有万人突围之势！远处火光映照下，项羽立于高台，玄甲如墨，剑锋指天，仿佛真有千军万马正从黑暗中奔腾而出。然而，这声势浩大的'
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 242
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=24 parent=17 choice='召集群将秘密议事，以重金悬赏献计者，暗中联络城内叛将'
2025-09-26 21:04:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=24 depth=1
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=24 completed, triggered next level depth=1
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1904
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=937 预览='{"text": "战鼓骤起，如雷贯耳，号角声撕裂寒夜，震得雪尘翻涌。项羽立于高台，亲自擂动巨鼓，青铜剑尖挑起一面面残破战旗，火光映照他铁甲如狱。四野的楚军闻声而动，纷纷点燃鼓面与铜角，声浪滚滚如千军万马奔袭。远处汉营火光忽明忽暗，隐约传来骚动——敌军竟真被这声势所慑，阵脚微乱。然而，就在鼓声达到巅峰之际，一匹孤骑自北侧飞驰而来，披风猎猎，手中高举一封火漆未开的密函，嘶喊着‘大王！东门守将已降，城内有内应！’项羽目光一凛，剑锋猛然下压，鼓声戛然而止。天地骤静，唯有风雪呜咽。他知道，这虚张声势的壮举，不过为争一线生机，而真正的风暴，正从内部悄然逼近。", "choices": [{"option'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=937 预览='{"text": "战鼓骤起，如雷贯耳，号角声撕裂寒夜，震得雪尘翻涌。项羽立于高台，亲自擂动巨鼓，青铜剑尖挑起一面面残破战旗，火光映照他铁甲如狱。四野的楚军闻声而动，纷纷点燃鼓面与铜角，声浪滚滚如千军万马奔袭。远处汉营火光忽明忽暗，隐约传来骚动——敌军竟真被这声势所慑，阵脚微乱。然而，就在鼓声达到巅峰之际，一匹孤骑自北'
2025-09-26 21:04:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=937 预览='{"text": "战鼓骤起，如雷贯耳，号角声撕裂寒夜，震得雪尘翻涌。项羽立于高台，亲自擂动巨鼓，青铜剑尖挑起一面面残破战旗，火光映照他铁甲如狱。四野的楚军闻声而动，纷纷点燃鼓面与铜角，声浪滚滚如千军万马奔袭。远处汉营火光忽明忽暗，隐约传来骚动——敌军竟真被这声势所慑，阵脚微乱。然而，就在鼓声达到巅峰之际，一匹孤骑自北'
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 267
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:04 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 21:04:04 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 21:04:04 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=25 parent=17 choice='独自策马出营，直面汉军大营，高呼‘项籍在此，何不迎战’'
2025-09-26 21:04:04 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=25 depth=1
2025-09-26 21:04:04 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=25 completed, triggered next level depth=1
2025-09-26 21:04:08 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:04:08 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1872
2025-09-26 21:04:08 | INFO     | core.story_engine:continue_story:524 - [LLM raw][continue-V2] 长度=904 预览='{"text": "夜风如刃，吹动帐中残旗。项羽将竹简折成两半，血迹渗入竹纹，似裂开的天命。他低声道：‘传范增，密议三更。’老谋士踏雪而至，衣袍沾霜，目光如炬。项羽凝视他，一字一句：‘去请楚地旧部，以‘汉主病危、军心涣散’为饵，暗布流言于汉营耳目之间——让刘邦的阴影，先从自己人心里裂开。’范增颔首，袖中滑出一卷帛书，上书‘楚音乱秦’四字。火光摇曳间，一队黑影悄然潜入夜色，如蛇游过寒原。远处，汉营篝火忽明忽暗，仿佛正被无形之手拨弄。人心，比刀剑更易动摇。", "choices": [{"option": "命人假扮汉军斥候，在粮道散布谣言称刘邦已死", "summary": "以敌之口，传己之语'
2025-09-26 21:04:08 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=904 预览='{"text": "夜风如刃，吹动帐中残旗。项羽将竹简折成两半，血迹渗入竹纹，似裂开的天命。他低声道：‘传范增，密议三更。’老谋士踏雪而至，衣袍沾霜，目光如炬。项羽凝视他，一字一句：‘去请楚地旧部，以‘汉主病危、军心涣散’为饵，暗布流言于汉营耳目之间——让刘邦的阴影，先从自己人心里裂开。’范增颔首，袖中滑出一卷帛书，上'
2025-09-26 21:04:08 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=904 预览='{"text": "夜风如刃，吹动帐中残旗。项羽将竹简折成两半，血迹渗入竹纹，似裂开的天命。他低声道：‘传范增，密议三更。’老谋士踏雪而至，衣袍沾霜，目光如炬。项羽凝视他，一字一句：‘去请楚地旧部，以‘汉主病危、军心涣散’为饵，暗布流言于汉营耳目之间——让刘邦的阴影，先从自己人心里裂开。’范增颔首，袖中滑出一卷帛书，上'
2025-09-26 21:04:08 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 218
2025-09-26 21:04:08 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:04:08 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 21:04:08 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 21:04:08 | INFO     | core.story_engine:continue_story:605 - 故事继续生成成功[V2]
2025-09-26 21:04:08 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=26 parent=16 choice='当众斩杀一名动摇军心的将领，以血立威，震慑全营'
2025-09-26 21:04:08 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=2 node=26 depth=1
2025-09-26 21:04:08 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=26 completed, triggered next level depth=1
2025-09-26 21:04:14 | INFO     | api.story:start_new_story:296 - 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 项羽
2025-09-26 21:04:14 | INFO     | api.story:start_new_story:311 - [预生成] 命中缓存，使用预生成的会话和节点: session=2, node=14
2025-09-26 21:04:15 | INFO     | api.story:start_new_story:371 - 新故事生成成功
2025-09-26 21:04:15 | INFO     | api.story:start_new_story:378 - 使用预生成故事，跳过speculation触发: session=2, node=14
2025-09-26 21:04:30 | INFO     | api.story:continue_existing_story:399 - 收到故事继续请求，选择: 亲赴前线，当众斩杀一名临阵脱逃的将领，以血立威，重振军心
2025-09-26 21:05:57 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:05:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:05:59 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:05:59 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:05:59 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:05:59 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:05:59 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:05:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:05:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:05:59 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:05:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:05:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:06:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:00 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:06:00 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:06:00 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:06:00 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:06:00 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:06:33 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:06:34 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:06:35 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:06:35 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:06:35 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:06:35 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:06:35 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:06:35 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:35 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:06:35 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:06:35 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:06:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:36 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:06:36 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:06:36 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:06:36 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:06:36 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:06:54 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:06:55 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:06:56 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:06:56 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:06:56 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:06:56 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:06:56 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:06:56 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:56 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:06:56 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:06:56 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:06:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:06:57 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:06:57 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:06:57 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:06:57 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:06:57 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:19 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:08:21 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:08:21 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:08:21 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:08:21 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:08:21 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:21 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:08:21 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:22 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:08:22 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:08:22 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:08:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:22 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:08:22 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:08:22 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:08:22 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:08:22 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:32 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:08:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:08:34 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:08:34 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:08:34 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:08:34 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:34 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:08:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:34 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:08:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:08:34 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:08:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:08:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:08:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:08:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:08:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:44 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:08:45 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:08:46 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:08:46 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:08:46 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:08:46 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:46 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:08:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:46 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:08:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:08:46 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:08:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:08:47 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:08:47 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:08:47 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:08:47 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:08:47 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:08:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:08:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:09:00 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:09:00 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:09:00 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:09:00 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:09:00 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:09:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:09:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:09:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:09:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:09:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:09:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:09:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:09:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:09:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:09:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:09:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:09:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:09:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:09:31 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:09:31 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:09:31 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:09:31 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:09:31 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:09:31 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:09:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:09:31 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:09:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:09:31 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:09:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:09:32 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:09:32 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:09:32 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:09:32 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:09:32 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:09:57 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:10:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:10:20 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:10:20 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:10:20 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:10:20 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:10:20 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:10:20 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:10:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:10:20 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:10:20 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:10:21 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:10:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:10:21 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:10:21 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:10:21 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:10:21 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:10:21 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:10:39 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:10:40 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:10:41 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:10:41 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:10:41 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:10:41 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:10:41 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:10:41 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:10:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:10:41 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:10:41 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:10:41 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:10:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:10:42 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:10:42 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:10:42 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:10:42 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:10:42 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:10:58 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:10:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:11:00 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:11:00 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:11:00 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:11:00 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:11:00 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:11:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:11:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:11:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:11:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:11:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:11:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:11:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:11:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:11:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:11:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:11:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:11:15 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:12:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:12:04 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:12:04 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:12:04 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:12:04 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:12:04 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:12:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:12:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:12:05 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:12:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:12:05 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:12:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:12:06 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:12:06 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:12:06 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:12:06 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:12:06 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:12:19 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:13:01 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:13:02 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:13:02 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:13:02 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:13:02 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:13:02 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:13:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:02 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:13:02 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:13:02 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:13:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:03 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:13:03 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:13:03 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:13:03 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:13:03 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:13:15 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:13:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:13:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:13:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:13:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:13:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:13:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:13:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:18 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:13:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:13:18 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:13:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:13:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:13:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:13:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:13:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:13:31 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:13:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:13:33 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:13:33 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:13:33 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:13:33 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:13:33 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:13:33 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:13:42 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:13:42 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:13:42 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:13:42 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:13:42 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:13:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:13:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:14:56 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:14:57 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:14:57 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:14:57 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:14:57 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:14:57 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:14:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:14:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:14:57 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:14:57 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:14:57 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:14:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:14:58 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:14:58 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:14:58 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:14:58 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:14:58 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:15:15 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:15:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:15:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:15:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:15:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:15:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:15:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:15:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:15:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:15:17 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:15:17 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:15:17 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:15:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:15:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:15:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:15:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:15:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:15:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:15:48 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:15:49 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:15:50 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:15:50 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:15:50 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:15:50 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:15:50 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:15:50 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:15:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:15:50 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:15:50 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:15:50 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:15:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:15:51 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:15:51 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:15:51 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:15:51 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:15:51 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:16:00 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 21:16:01 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 21:16:02 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 21:16:02 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 21:16:02 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 21:16:02 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:16:02 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 21:16:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:16:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:16:02 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 21:16:02 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 21:16:02 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 21:16:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 21:16:03 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 21:16:03 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 21:16:03 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 21:16:03 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 21:16:03 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 21:18:25 | INFO     | api.story:prepare_start_level:190 - 开始生成故事概要，愿望：刘邦...
2025-09-26 21:18:26 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:26 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 938
2025-09-26 21:18:26 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:18:26 | INFO     | api.story:prepare_start_level:265 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:18:26 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:18:26 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘邦'
2025-09-26 21:18:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1382
2025-09-26 21:18:30 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=829 预览='{"text": "夜色如墨，咸阳城外的篝火在风中摇曳。刘邦立于高坡，凝视着远处楚军营寨的灯火，手中紧握一封密信——韩信已至颍川，但迟迟未发兵。他轻叹一声，袖中暗藏的刀柄微微发烫。三日前，项羽派使者送来‘和谈’之议，言辞谦卑，却暗藏杀机。此刻，帐内谋士们争执不休：有人主张借势反攻，有人劝其暂避锋芒。刘邦缓缓起身，眼中闪过一丝狡黠——他早已察觉，那使者衣角绣着的并非楚国纹样，而是齐地特有的云纹。真正的敌人，或许不在前方，而在身后。", "choices": [{"option": "命人假扮齐使，以密语试探楚营内部虚实", "summary": "以毒攻毒，引蛇出洞的险招", "effects"'
2025-09-26 21:18:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=829 预览='{"text": "夜色如墨，咸阳城外的篝火在风中摇曳。刘邦立于高坡，凝视着远处楚军营寨的灯火，手中紧握一封密信——韩信已至颍川，但迟迟未发兵。他轻叹一声，袖中暗藏的刀柄微微发烫。三日前，项羽派使者送来‘和谈’之议，言辞谦卑，却暗藏杀机。此刻，帐内谋士们争执不休：有人主张借势反攻，有人劝其暂避锋芒。刘邦缓缓起身，眼中闪'
2025-09-26 21:18:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=829 预览='{"text": "夜色如墨，咸阳城外的篝火在风中摇曳。刘邦立于高坡，凝视着远处楚军营寨的灯火，手中紧握一封密信——韩信已至颍川，但迟迟未发兵。他轻叹一声，袖中暗藏的刀柄微微发烫。三日前，项羽派使者送来‘和谈’之议，言辞谦卑，却暗藏杀机。此刻，帐内谋士们争执不休：有人主张借势反攻，有人劝其暂避锋芒。刘邦缓缓起身，眼中闪'
2025-09-26 21:18:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 206
2025-09-26 21:18:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:18:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:18:30 | INFO     | core.story_engine:start_story:446 - 新故事生成成功
2025-09-26 21:18:30 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=206
2025-09-26 21:18:30 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=3
2025-09-26 21:18:30 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=27
2025-09-26 21:18:30 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=27 depth=3
2025-09-26 21:18:30 | INFO     | api.story:_background_generate_with_pregeneration:97 - [预生成] 已触发speculation预生成: session=3, node=27
2025-09-26 21:18:30 | INFO     | api.story:_background_generate_with_pregeneration:99 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=3
2025-09-26 21:18:30 | DEBUG    | api.story:_background_generate_with_pregeneration:111 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 21:18:30 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=27
2025-09-26 21:18:30 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 命人假扮齐使，以密语试探楚营内部虚实
2025-09-26 21:18:30 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 亲赴韩信军营，当面托付兵权与密令
2025-09-26 21:18:30 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 设宴款待楚使，席间故意泄露虚假军情
2025-09-26 21:18:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1587
2025-09-26 21:18:33 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=860 预览='{"text": "夜风卷起战旗，猎猎作响。刘邦缓步踱至帐前，指尖轻抚那封密信的边角，忽然低笑出声——齐地云纹，分明是田横旧部的标记。他转身命人取来一盏青铜灯，将信纸置于火上缓缓焚烧，灰烬飘散如蝶。‘项羽要和谈？’他喃喃自语，‘可这信上的墨，分明是用齐国特有的松烟调制。’远处传来马蹄轻响，一名斥候翻身下马，手中紧握一枚刻有‘颍川’二字的铜符。刘邦目光骤冷：韩信未动，却已有人冒充使者送信。真正的棋局，才刚刚掀开第一层幕布。", "choices": [{"option": "命人假扮楚军使者，反向诱骗对方暴露身份", "summary": "以诈制诈，借敌之手揭开内鬼真面目", "effects'
2025-09-26 21:18:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=860 预览='{"text": "夜风卷起战旗，猎猎作响。刘邦缓步踱至帐前，指尖轻抚那封密信的边角，忽然低笑出声——齐地云纹，分明是田横旧部的标记。他转身命人取来一盏青铜灯，将信纸置于火上缓缓焚烧，灰烬飘散如蝶。‘项羽要和谈？’他喃喃自语，‘可这信上的墨，分明是用齐国特有的松烟调制。’远处传来马蹄轻响，一名斥候翻身下马，手中紧握一枚'
2025-09-26 21:18:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=860 预览='{"text": "夜风卷起战旗，猎猎作响。刘邦缓步踱至帐前，指尖轻抚那封密信的边角，忽然低笑出声——齐地云纹，分明是田横旧部的标记。他转身命人取来一盏青铜灯，将信纸置于火上缓缓焚烧，灰烬飘散如蝶。‘项羽要和谈？’他喃喃自语，‘可这信上的墨，分明是用齐国特有的松烟调制。’远处传来马蹄轻响，一名斥候翻身下马，手中紧握一枚'
2025-09-26 21:18:33 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 202
2025-09-26 21:18:33 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:33 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 21:18:33 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 21:18:33 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:33 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=28 parent=27 choice='设宴款待楚使，席间故意泄露虚假军情'
2025-09-26 21:18:33 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=28 depth=2
2025-09-26 21:18:33 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=28 completed, triggered next level depth=2
2025-09-26 21:18:33 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=28
2025-09-26 21:18:33 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 命人假扮楚军使者，反向诱骗对方暴露身份
2025-09-26 21:18:33 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 连夜召见所有将领，当众拆穿密信疑点，逼迫内应现身
2025-09-26 21:18:33 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 悄悄将密信内容抄录于帛书，派人送往韩信营中试探反应
2025-09-26 21:18:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1588
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=850 预览='{"text": "风卷残烬，火光在刘邦的瞳孔中跳动。他忽然将密信投入篝火，看着那齐地云纹在烈焰中扭曲成灰。他转身对谋士道：‘项羽若真愿和，为何使者衣角绣的是齐国纹样？’话音未落，远处传来马蹄轻响——一骑飞驰而至，正是韩信派来的急报：颍川城内已埋伏三队死士，只待一声令下。刘邦嘴角微扬，却猛地拔剑劈向身旁古树，剑锋入木三分。‘既然有人想演戏，那便陪他们唱完这出大戏。’他收剑入鞘，目光如刀，扫过众将——真正的战场，不在前方，而在人心之间。", "choices": [{"option": "命人假扮齐国使节，反向诱骗楚军情报", "summary": "以彼之道还施彼身，设局钓出内鬼", "eff'
2025-09-26 21:18:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=850 预览='{"text": "风卷残烬，火光在刘邦的瞳孔中跳动。他忽然将密信投入篝火，看着那齐地云纹在烈焰中扭曲成灰。他转身对谋士道：‘项羽若真愿和，为何使者衣角绣的是齐国纹样？’话音未落，远处传来马蹄轻响——一骑飞驰而至，正是韩信派来的急报：颍川城内已埋伏三队死士，只待一声令下。刘邦嘴角微扬，却猛地拔剑劈向身旁古树，剑锋入木三'
2025-09-26 21:18:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=850 预览='{"text": "风卷残烬，火光在刘邦的瞳孔中跳动。他忽然将密信投入篝火，看着那齐地云纹在烈焰中扭曲成灰。他转身对谋士道：‘项羽若真愿和，为何使者衣角绣的是齐国纹样？’话音未落，远处传来马蹄轻响——一骑飞驰而至，正是韩信派来的急报：颍川城内已埋伏三队死士，只待一声令下。刘邦嘴角微扬，却猛地拔剑劈向身旁古树，剑锋入木三'
2025-09-26 21:18:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 209
2025-09-26 21:18:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 21:18:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:34 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=29 parent=27 choice='命人假扮齐使，以密语试探楚营内部虚实'
2025-09-26 21:18:34 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=29 depth=2
2025-09-26 21:18:34 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=29 completed, triggered next level depth=2
2025-09-26 21:18:34 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=29
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 命人假扮齐国使节，反向诱骗楚军情报
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 当夜亲赴颍川，借韩信之名暗查伏兵真相
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 下令全军佯装溃退，引楚军主力追击至伏击圈
2025-09-26 21:18:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1615
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=893 预览='{"text": "风卷残叶，篝火噼啪作响。刘邦凝视着那枚沾了尘土的齐地云纹铜扣，指尖轻抚其边缘——这分明是韩信密信中提到的‘天机印’信物，却出现在楚使衣角。他忽然笑了，低声对身旁亲卫道：‘去把张良请来，就说……咸阳城外，有只狐狸在演戏。’帐外传来马蹄声，一骑疾驰而至，披风上绣着半枚裂开的龙纹。那是陈平的暗号。刘邦望向远方，眼中寒光乍现：若韩信真被牵制，那颍川的兵锋，或许正悄然转向沛县——他的老家，他母亲的坟茔所在。真正的棋局，从不是在战场，而是在人心深处。", "choices": [{"option": "命人假扮楚使，用伪造的云纹信物反向诱骗敌军密探", "summary": "以毒攻毒'
2025-09-26 21:18:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=893 预览='{"text": "风卷残叶，篝火噼啪作响。刘邦凝视着那枚沾了尘土的齐地云纹铜扣，指尖轻抚其边缘——这分明是韩信密信中提到的‘天机印’信物，却出现在楚使衣角。他忽然笑了，低声对身旁亲卫道：‘去把张良请来，就说……咸阳城外，有只狐狸在演戏。’帐外传来马蹄声，一骑疾驰而至，披风上绣着半枚裂开的龙纹。那是陈平的暗号。刘邦望向'
2025-09-26 21:18:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=893 预览='{"text": "风卷残叶，篝火噼啪作响。刘邦凝视着那枚沾了尘土的齐地云纹铜扣，指尖轻抚其边缘——这分明是韩信密信中提到的‘天机印’信物，却出现在楚使衣角。他忽然笑了，低声对身旁亲卫道：‘去把张良请来，就说……咸阳城外，有只狐狸在演戏。’帐外传来马蹄声，一骑疾驰而至，披风上绣着半枚裂开的龙纹。那是陈平的暗号。刘邦望向'
2025-09-26 21:18:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 221
2025-09-26 21:18:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 21:18:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:34 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=30 parent=27 choice='亲赴韩信军营，当面托付兵权与密令'
2025-09-26 21:18:34 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=30 depth=2
2025-09-26 21:18:34 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=30 completed, triggered next level depth=2
2025-09-26 21:18:34 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=30
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 命人假扮楚使，用伪造的云纹信物反向诱骗敌军密探
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 连夜写信焚毁，改派心腹星夜兼程送信给韩信，暗示其自保
2025-09-26 21:18:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 当众撕毁和谈书，命人高举火把点燃营帐，制造决裂假象
2025-09-26 21:18:37 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:37 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1807
2025-09-26 21:18:37 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=870 预览='{"text": "烛火摇曳，楚使端坐主位，锦袍上金线绣着云纹，却在酒过三巡后微微颤抖。刘邦举杯相敬，笑语晏晏间忽然低声道：‘韩信已遣五千精骑绕道颍川，若非粮道断绝，三日便可合围彭城。’话音未落，他佯作醉意，将酒盏轻叩案几，酒液泼洒如血。那使者瞳孔骤缩，袖中手指悄然攥紧——他不知，这番‘密谈’早已被暗处的细作录下。帐外风声渐急，远处传来战马嘶鸣，似有大军压境。刘邦不动声色，只将一枚铜钱轻轻推至桌角，那是齐地田横旧部的暗记。真正的猎物，正在自投罗网。", "choices": [{"option": "命人假扮斥候闯入营帐，撞破‘密谋’以激怒对方", "summary": "以虚张声势逼迫敌使暴'
2025-09-26 21:18:37 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=870 预览='{"text": "烛火摇曳，楚使端坐主位，锦袍上金线绣着云纹，却在酒过三巡后微微颤抖。刘邦举杯相敬，笑语晏晏间忽然低声道：‘韩信已遣五千精骑绕道颍川，若非粮道断绝，三日便可合围彭城。’话音未落，他佯作醉意，将酒盏轻叩案几，酒液泼洒如血。那使者瞳孔骤缩，袖中手指悄然攥紧——他不知，这番‘密谈’早已被暗处的细作录下。帐外'
2025-09-26 21:18:37 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=870 预览='{"text": "烛火摇曳，楚使端坐主位，锦袍上金线绣着云纹，却在酒过三巡后微微颤抖。刘邦举杯相敬，笑语晏晏间忽然低声道：‘韩信已遣五千精骑绕道颍川，若非粮道断绝，三日便可合围彭城。’话音未落，他佯作醉意，将酒盏轻叩案几，酒液泼洒如血。那使者瞳孔骤缩，袖中手指悄然攥紧——他不知，这番‘密谈’早已被暗处的细作录下。帐外'
2025-09-26 21:18:37 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 216
2025-09-26 21:18:37 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:37 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 21:18:37 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 21:18:37 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:37 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=31 parent=28 choice='命人假扮楚军使者，反向诱骗对方暴露身份'
2025-09-26 21:18:37 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=31 depth=1
2025-09-26 21:18:37 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=31 completed, triggered next level depth=1
2025-09-26 21:18:37 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=3 node=31
2025-09-26 21:18:38 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:38 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1821
2025-09-26 21:18:38 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=898 预览='{"text": "篝火映照着楚使的面庞，他举杯浅笑，眼中却掠过一丝警惕。刘邦斜倚案前，酒液在铜樽中微微晃动，仿佛也映出他心底的波澜。他忽然放声大笑，将一卷帛书‘不经意’推至案边，正是虚报粮草已尽、韩信军心动摇的密报。‘这等机密，岂能瞒过将军？’他故意压低嗓音，似醉非醉地低语。楚使眸光微闪，指尖轻敲杯沿，竟不动声色地将那帛书一角悄悄捻入袖中。帐外风声骤紧，远处传来战马嘶鸣——是韩信派来的信使，正悄然逼近咸阳城郊。刘邦嘴角微扬，暗中命人调换灯油，让烛火忽明忽暗，如鬼魅般勾勒出帐内诡谲的影子。真正的棋局，从这一刻起，已不在战场。", "choices": [{"option": "命人假扮粮官，当'
2025-09-26 21:18:38 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=898 预览='{"text": "篝火映照着楚使的面庞，他举杯浅笑，眼中却掠过一丝警惕。刘邦斜倚案前，酒液在铜樽中微微晃动，仿佛也映出他心底的波澜。他忽然放声大笑，将一卷帛书‘不经意’推至案边，正是虚报粮草已尽、韩信军心动摇的密报。‘这等机密，岂能瞒过将军？’他故意压低嗓音，似醉非醉地低语。楚使眸光微闪，指尖轻敲杯沿，竟不动声色地将'
2025-09-26 21:18:38 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=898 预览='{"text": "篝火映照着楚使的面庞，他举杯浅笑，眼中却掠过一丝警惕。刘邦斜倚案前，酒液在铜樽中微微晃动，仿佛也映出他心底的波澜。他忽然放声大笑，将一卷帛书‘不经意’推至案边，正是虚报粮草已尽、韩信军心动摇的密报。‘这等机密，岂能瞒过将军？’他故意压低嗓音，似醉非醉地低语。楚使眸光微闪，指尖轻敲杯沿，竟不动声色地将'
2025-09-26 21:18:38 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 255
2025-09-26 21:18:38 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:38 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:18:38 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:18:38 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:38 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=32 parent=28 choice='悄悄将密信内容抄录于帛书，派人送往韩信营中试探反应'
2025-09-26 21:18:38 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=32 depth=1
2025-09-26 21:18:38 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=32 completed, triggered next level depth=1
2025-09-26 21:18:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1807
2025-09-26 21:18:39 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=878 预览='{"text": "篝火渐熄，余烬如血。刘邦凝视着灰中未燃尽的齐地云纹，忽然低笑出声：‘原来他们早把戏台搭在了自己人身上。’他唤来心腹，耳语片刻——命人假扮齐国使节，携伪造的密信与暗语，潜入楚营。那信上写着‘韩信已受封，颍川三军听调’，字迹却刻意模仿齐地书吏的笔锋。更妙的是，信尾附有一枚刻着‘鱼符’的铜片——那是齐国军中通行的旧物，如今已被项羽用来做诱饵。夜风掠过战旗，仿佛听见远处楚营传来低语：‘齐使到了？快请进。’刘邦站在高坡上，手指轻抚剑柄，眼中映着火光与阴谋的倒影——真正的棋局，才刚刚落子。", "choices": [{"option": "让谋士冒充齐国老臣，以故交口吻试探楚将虚实"'
2025-09-26 21:18:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=878 预览='{"text": "篝火渐熄，余烬如血。刘邦凝视着灰中未燃尽的齐地云纹，忽然低笑出声：‘原来他们早把戏台搭在了自己人身上。’他唤来心腹，耳语片刻——命人假扮齐国使节，携伪造的密信与暗语，潜入楚营。那信上写着‘韩信已受封，颍川三军听调’，字迹却刻意模仿齐地书吏的笔锋。更妙的是，信尾附有一枚刻着‘鱼符’的铜片——那是齐国军'
2025-09-26 21:18:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=878 预览='{"text": "篝火渐熄，余烬如血。刘邦凝视着灰中未燃尽的齐地云纹，忽然低笑出声：‘原来他们早把戏台搭在了自己人身上。’他唤来心腹，耳语片刻——命人假扮齐国使节，携伪造的密信与暗语，潜入楚营。那信上写着‘韩信已受封，颍川三军听调’，字迹却刻意模仿齐地书吏的笔锋。更妙的是，信尾附有一枚刻着‘鱼符’的铜片——那是齐国军'
2025-09-26 21:18:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 241
2025-09-26 21:18:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:39 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 21:18:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 21:18:39 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:39 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=33 parent=29 choice='当夜亲赴颍川，借韩信之名暗查伏兵真相'
2025-09-26 21:18:39 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=33 depth=1
2025-09-26 21:18:39 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=33 completed, triggered next level depth=1
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1823
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=907 预览='{"text": "烛火摇曳，楚使端坐上座，锦袍华贵却难掩眉间倦意。刘邦举杯相敬，谈笑间轻描淡写提及‘颍川粮道已断，韩信三日未发一兵’，语调轻松如闲话家常。酒过三巡，他忽然醉眼朦胧，将一枚刻有‘汉军主力驻扎陈留’的铜符推至案前，还故意用袖口蹭了蹭墨迹——那分明是伪造的军令印记。楚使瞳孔微缩，手指不自觉地扣紧了腰间佩剑。帐外风声骤起，远处传来几声狼嗥，仿佛天地也为这虚实交错的棋局屏息。刘邦不动声色，只轻轻一笑，将残酒泼向地面，任其渗入黄土。他知道，这一步赌的是人心，更是项羽对‘内应’的贪婪与猜忌。", "choices": [{"option": "命人悄悄将假情报传给楚使随从，再借酒醉之名反咬'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=907 预览='{"text": "烛火摇曳，楚使端坐上座，锦袍华贵却难掩眉间倦意。刘邦举杯相敬，谈笑间轻描淡写提及‘颍川粮道已断，韩信三日未发一兵’，语调轻松如闲话家常。酒过三巡，他忽然醉眼朦胧，将一枚刻有‘汉军主力驻扎陈留’的铜符推至案前，还故意用袖口蹭了蹭墨迹——那分明是伪造的军令印记。楚使瞳孔微缩，手指不自觉地扣紧了腰间佩剑。'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=907 预览='{"text": "烛火摇曳，楚使端坐上座，锦袍华贵却难掩眉间倦意。刘邦举杯相敬，谈笑间轻描淡写提及‘颍川粮道已断，韩信三日未发一兵’，语调轻松如闲话家常。酒过三巡，他忽然醉眼朦胧，将一枚刻有‘汉军主力驻扎陈留’的铜符推至案前，还故意用袖口蹭了蹭墨迹——那分明是伪造的军令印记。楚使瞳孔微缩，手指不自觉地扣紧了腰间佩剑。'
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 240
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=34 parent=28 choice='连夜召见所有将领，当众拆穿密信疑点，逼迫内应现身'
2025-09-26 21:18:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=34 depth=1
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=34 completed, triggered next level depth=1
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1768
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=850 预览='{"text": "篝火渐熄，夜露凝霜。刘邦将密信灰烬拂入风中，冷声道：‘齐使？不过是项羽布下的饵。’他转身唤来心腹，低语道：‘即刻遣人假扮齐国使节，携三枚玉符、一句暗语——若楚营内应识得此符，必会主动接洽。’那人领命而去，身影隐入雾霭。三更时分，城南哨塔传来异动：一队楚兵竟在未报备的情况下，悄然调换岗哨，手中令牌赫然印着齐地云纹。刘邦立于高坡，手中铜镜映出天光微明，嘴角浮起一丝冷笑——那不是接应，是试探。真正的棋局，才刚落下第一子。", "choices": [{"option": "命人伪装成齐国使者，以旧日盟约之名接触楚军将领", "summary": "借历史渊源制造信任，引蛇出洞",'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=850 预览='{"text": "篝火渐熄，夜露凝霜。刘邦将密信灰烬拂入风中，冷声道：‘齐使？不过是项羽布下的饵。’他转身唤来心腹，低语道：‘即刻遣人假扮齐国使节，携三枚玉符、一句暗语——若楚营内应识得此符，必会主动接洽。’那人领命而去，身影隐入雾霭。三更时分，城南哨塔传来异动：一队楚兵竟在未报备的情况下，悄然调换岗哨，手中令牌赫然'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=850 预览='{"text": "篝火渐熄，夜露凝霜。刘邦将密信灰烬拂入风中，冷声道：‘齐使？不过是项羽布下的饵。’他转身唤来心腹，低语道：‘即刻遣人假扮齐国使节，携三枚玉符、一句暗语——若楚营内应识得此符，必会主动接洽。’那人领命而去，身影隐入雾霭。三更时分，城南哨塔传来异动：一队楚兵竟在未报备的情况下，悄然调换岗哨，手中令牌赫然'
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 209
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: background1.jpg
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/background1.jpg
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=35 parent=29 choice='下令全军佯装溃退，引楚军主力追击至伏击圈'
2025-09-26 21:18:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=35 depth=1
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=35 completed, triggered next level depth=1
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1851
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=918 预览='{"text": "夜色如铁，马蹄踏碎霜露。刘邦独骑疾驰于颍川古道，披风猎猎，腰间佩剑轻鸣。他已命人焚毁所有信使文书，只身赴韩信军营——不是为求援，而是为验真伪。途中，一队巡哨拦路，火把映出他们胸前的‘汉’字铜牌，却无韩信亲令。刘邦勒马，目光如炬：‘我乃沛公，奉密诏传令于韩将军。’话音未落，远处传来战鼓声，三更天的号角竟从东南方向响起——那是韩信军营的调兵信号，可如今，营地灯火稀疏，似有异动。他忽然明白：有人冒名顶替，而真正的韩信，或许正被囚禁于某处暗牢。风卷残叶，他握紧缰绳，眼中燃起烈焰——若忠臣被缚，那便亲自去解救他。", "choices": [{"option": "以旧日兄弟之名叩营'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=918 预览='{"text": "夜色如铁，马蹄踏碎霜露。刘邦独骑疾驰于颍川古道，披风猎猎，腰间佩剑轻鸣。他已命人焚毁所有信使文书，只身赴韩信军营——不是为求援，而是为验真伪。途中，一队巡哨拦路，火把映出他们胸前的‘汉’字铜牌，却无韩信亲令。刘邦勒马，目光如炬：‘我乃沛公，奉密诏传令于韩将军。’话音未落，远处传来战鼓声，三更天的号角'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=918 预览='{"text": "夜色如铁，马蹄踏碎霜露。刘邦独骑疾驰于颍川古道，披风猎猎，腰间佩剑轻鸣。他已命人焚毁所有信使文书，只身赴韩信军营——不是为求援，而是为验真伪。途中，一队巡哨拦路，火把映出他们胸前的‘汉’字铜牌，却无韩信亲令。刘邦勒马，目光如炬：‘我乃沛公，奉密诏传令于韩将军。’话音未落，远处传来战鼓声，三更天的号角'
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 254
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=36 parent=30 choice='命人假扮楚使，用伪造的云纹信物反向诱骗敌军密探'
2025-09-26 21:18:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=36 depth=1
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=36 completed, triggered next level depth=1
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1812
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=868 预览='{"text": "夜色如墨，马蹄踏碎霜露。刘邦独自策马奔向颍川方向，披风猎猎，腰间佩剑未解。他已下令三军暂驻原地，只带两名亲卫与一封血书密令——那是韩信母亲墓前的香灰所调之墨写就。途中忽闻林中异响，一队楚军伏兵悄然逼近，火把映出他们胸前的裂龙纹。刘邦勒马停步，缓缓摘下头盔，露出那张被岁月与权谋刻满沟壑的脸。他朗声一笑：‘项羽的兵，怎敢在我汉王面前放肆？’话音未落，身后传来急促马蹄——竟是陈平率轻骑突袭而来，刀光如电，直取敌首。战局未定，而真正的试探才刚刚开始。", "choices": [{"option": "命亲卫引开敌军，自己潜入韩信大营假传密令", "summary": "以身犯险，'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=868 预览='{"text": "夜色如墨，马蹄踏碎霜露。刘邦独自策马奔向颍川方向，披风猎猎，腰间佩剑未解。他已下令三军暂驻原地，只带两名亲卫与一封血书密令——那是韩信母亲墓前的香灰所调之墨写就。途中忽闻林中异响，一队楚军伏兵悄然逼近，火把映出他们胸前的裂龙纹。刘邦勒马停步，缓缓摘下头盔，露出那张被岁月与权谋刻满沟壑的脸。他朗声一笑'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=868 预览='{"text": "夜色如墨，马蹄踏碎霜露。刘邦独自策马奔向颍川方向，披风猎猎，腰间佩剑未解。他已下令三军暂驻原地，只带两名亲卫与一封血书密令——那是韩信母亲墓前的香灰所调之墨写就。途中忽闻林中异响，一队楚军伏兵悄然逼近，火把映出他们胸前的裂龙纹。刘邦勒马停步，缓缓摘下头盔，露出那张被岁月与权谋刻满沟壑的脸。他朗声一笑'
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 223
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=37 parent=30 choice='连夜写信焚毁，改派心腹星夜兼程送信给韩信，暗示其自保'
2025-09-26 21:18:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=37 depth=1
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=37 completed, triggered next level depth=1
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1821
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=899 预览='{"text": "篝火渐熄，夜风卷起残烬如灰蝶飞舞。刘邦凝视着火堆中蜷缩的密信灰烬，忽然低笑出声：‘齐使？倒不如说是楚人设的局。’他唤来心腹谋士，低声下令：‘即刻以齐国口音伪造一封密函，言明韩信已与齐王合谋反楚，只待楚营内应一响便举兵。’又命人将三枚刻有齐地符节的铜钱埋入驿道，再遣两名死士扮作商旅，故意在楚营外露出行迹。‘让他们以为，是齐国在暗中布局——而我们，不过是一群被利用的棋子。’话音未落，远处传来马蹄声，似有斥候巡行。刘邦缓缓抚过剑柄，眼中寒光一闪：‘戏要演得像，才有人信。’", "choices": [{"option": "让死士故意在楚营外争执，暴露伪造的齐国密信", "sum'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=899 预览='{"text": "篝火渐熄，夜风卷起残烬如灰蝶飞舞。刘邦凝视着火堆中蜷缩的密信灰烬，忽然低笑出声：‘齐使？倒不如说是楚人设的局。’他唤来心腹谋士，低声下令：‘即刻以齐国口音伪造一封密函，言明韩信已与齐王合谋反楚，只待楚营内应一响便举兵。’又命人将三枚刻有齐地符节的铜钱埋入驿道，再遣两名死士扮作商旅，故意在楚营外露出行'
2025-09-26 21:18:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=899 预览='{"text": "篝火渐熄，夜风卷起残烬如灰蝶飞舞。刘邦凝视着火堆中蜷缩的密信灰烬，忽然低笑出声：‘齐使？倒不如说是楚人设的局。’他唤来心腹谋士，低声下令：‘即刻以齐国口音伪造一封密函，言明韩信已与齐王合谋反楚，只待楚营内应一响便举兵。’又命人将三枚刻有齐地符节的铜钱埋入驿道，再遣两名死士扮作商旅，故意在楚营外露出行'
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 235
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: cyberpunk_city.jpg
2025-09-26 21:18:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/cyberpunk_city.jpg
2025-09-26 21:18:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=38 parent=29 choice='命人假扮齐国使节，反向诱骗楚军情报'
2025-09-26 21:18:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=38 depth=1
2025-09-26 21:18:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=38 completed, triggered next level depth=1
2025-09-26 21:18:41 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:18:41 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1841
2025-09-26 21:18:41 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=908 预览='{"text": "夜雾如纱，刘邦策马穿行于颍川山道，披风猎猎，手中紧握那枚沾血的齐地云纹铜扣。他已命人暗中调换韩信军营的巡哨路线，却仍不敢轻进——韩信的营帐外，三名亲兵持戟而立，目光如刃。远处传来更鼓声，一队骑兵正从东南方向疾驰而来，马蹄踏碎霜露。刘邦勒马停步，忽见帐帘微动，一名老卒捧着酒壶走出，眼神浑浊却似曾相识。他忽然记起：这人是当年随自己渡河的老卒，早已战死于彭城。‘不可能……’他心头一震，随即冷笑——若连幻影都敢冒充旧部，那韩信的营中，怕早已不是故人之魂。他翻身下马，将铜扣置于篝火之上，火焰腾起，映出他半张冷峻面容。‘既然你愿演戏，那我便陪你演到底。’", "choices": [{'
2025-09-26 21:18:41 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=908 预览='{"text": "夜雾如纱，刘邦策马穿行于颍川山道，披风猎猎，手中紧握那枚沾血的齐地云纹铜扣。他已命人暗中调换韩信军营的巡哨路线，却仍不敢轻进——韩信的营帐外，三名亲兵持戟而立，目光如刃。远处传来更鼓声，一队骑兵正从东南方向疾驰而来，马蹄踏碎霜露。刘邦勒马停步，忽见帐帘微动，一名老卒捧着酒壶走出，眼神浑浊却似曾相识。'
2025-09-26 21:18:41 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=908 预览='{"text": "夜雾如纱，刘邦策马穿行于颍川山道，披风猎猎，手中紧握那枚沾血的齐地云纹铜扣。他已命人暗中调换韩信军营的巡哨路线，却仍不敢轻进——韩信的营帐外，三名亲兵持戟而立，目光如刃。远处传来更鼓声，一队骑兵正从东南方向疾驰而来，马蹄踏碎霜露。刘邦勒马停步，忽见帐帘微动，一名老卒捧着酒壶走出，眼神浑浊却似曾相识。'
2025-09-26 21:18:41 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 274
2025-09-26 21:18:41 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:18:41 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:18:41 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:18:41 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:18:41 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=39 parent=30 choice='当众撕毁和谈书，命人高举火把点燃营帐，制造决裂假象'
2025-09-26 21:18:41 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=39 depth=1
2025-09-26 21:18:41 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=39 completed, triggered next level depth=1
2025-09-26 21:18:51 | INFO     | api.story:start_new_story:295 - 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 刘邦
2025-09-26 21:18:51 | INFO     | api.story:start_new_story:310 - [预生成] 命中缓存，使用预生成的会话和节点: session=3, node=27
2025-09-26 21:18:51 | INFO     | api.story:start_new_story:370 - 新故事生成成功
2025-09-26 21:18:51 | INFO     | api.story:start_new_story:377 - 使用预生成故事，跳过speculation触发: session=3, node=27
2025-09-26 21:18:56 | INFO     | api.story:continue_existing_story:398 - 收到故事继续请求，选择: 命人假扮齐使，以密语试探楚营内部虚实
2025-09-26 21:19:21 | INFO     | api.story:continue_existing_story:398 - 收到故事继续请求，选择: 当夜亲赴颍川，借韩信之名暗查伏兵真相
2025-09-26 21:19:26 | INFO     | api.story:continue_existing_story:398 - 收到故事继续请求，选择: 暗中埋伏死士于城门两侧，只待假使入内便一网打尽
2025-09-26 21:19:26 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 暗中埋伏死士于城门两侧，只待假使入内便一网打尽
2025-09-26 21:19:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2082
2025-09-26 21:19:30 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=937 预览='{"text": "夜色如墨，颍川城外的枯林间传来野狼低嗥。刘邦披着灰褐斗篷，独自策马穿行于泥泞小径，手中紧握韩信亲笔密令——那字迹与前日所见无异，却在火光下泛出一丝异样金粉。他勒马停驻，凝视前方城墙内侧一排箭垛：三处暗哨的位置，竟与韩信军中布防图完全吻合。可那守将的腰牌上，赫然刻着‘项’字。他忽然冷笑，翻身下马，将密令投入路边枯井，任其沉入黑暗。‘原来不是伏兵，是诱饵。’他低声自语，目光扫过远处灯火——那一片楚营的篝火，正以极慢的速度，朝颍川城门缓缓移动。真正的棋局，早已不在城内，而在人心之间。他转身牵马，身影融进风雪，只留下一串马蹄印，像一道未解的谜题。", "choices": [{"o'
2025-09-26 21:19:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=937 预览='{"text": "夜色如墨，颍川城外的枯林间传来野狼低嗥。刘邦披着灰褐斗篷，独自策马穿行于泥泞小径，手中紧握韩信亲笔密令——那字迹与前日所见无异，却在火光下泛出一丝异样金粉。他勒马停驻，凝视前方城墙内侧一排箭垛：三处暗哨的位置，竟与韩信军中布防图完全吻合。可那守将的腰牌上，赫然刻着‘项’字。他忽然冷笑，翻身下马，将密'
2025-09-26 21:19:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=937 预览='{"text": "夜色如墨，颍川城外的枯林间传来野狼低嗥。刘邦披着灰褐斗篷，独自策马穿行于泥泞小径，手中紧握韩信亲笔密令——那字迹与前日所见无异，却在火光下泛出一丝异样金粉。他勒马停驻，凝视前方城墙内侧一排箭垛：三处暗哨的位置，竟与韩信军中布防图完全吻合。可那守将的腰牌上，赫然刻着‘项’字。他忽然冷笑，翻身下马，将密'
2025-09-26 21:19:30 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 272
2025-09-26 21:19:30 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:30 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:19:30 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:19:30 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:30 | INFO     | api.story:continue_existing_story:518 - 故事继续生成成功
2025-09-26 21:19:30 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=40 depth=3
2025-09-26 21:19:30 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=40
2025-09-26 21:19:30 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 潜入敌营，借夜色掩护，用韩信旧部暗号试探真假将领
2025-09-26 21:19:30 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 折返咸阳，命人伪造韩信手书，引诱楚营内部自乱阵脚
2025-09-26 21:19:30 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 伪装成伤兵混入城门，借哀嚎之声刺探守军口风
2025-09-26 21:19:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2322
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=899 预览='{"text": "城门两侧的枯树在风中低语，死士们伏于暗影，手中刀刃映着残月。刘邦立于高坡，目光如鹰隼扫过城门——那扇厚重的铁门内，守卫正低声交谈，语气中透出陌生口音。他忽然抬手，一枝火折子从袖中滑落，点燃了墙角堆叠的干草。烈焰腾起，火光冲天，惊动了城楼上的巡卒。‘有敌袭！’喊声未落，城门却悄然开启，一队楚军精锐鱼贯而出，竟是来‘接应’那假使的。刘邦瞳孔微缩：原来他们早知有人埋伏，竟以火为饵，诱杀活饵。他缓缓拔剑，剑尖指向城门，低声道：‘既然想演戏，那便让这出戏，烧得更彻底些。’", "choices": [{"option": "点燃预先埋设的火油，引燃城门附近的粮草堆", "summar'
2025-09-26 21:19:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=899 预览='{"text": "城门两侧的枯树在风中低语，死士们伏于暗影，手中刀刃映着残月。刘邦立于高坡，目光如鹰隼扫过城门——那扇厚重的铁门内，守卫正低声交谈，语气中透出陌生口音。他忽然抬手，一枝火折子从袖中滑落，点燃了墙角堆叠的干草。烈焰腾起，火光冲天，惊动了城楼上的巡卒。‘有敌袭！’喊声未落，城门却悄然开启，一队楚军精锐鱼贯'
2025-09-26 21:19:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=899 预览='{"text": "城门两侧的枯树在风中低语，死士们伏于暗影，手中刀刃映着残月。刘邦立于高坡，目光如鹰隼扫过城门——那扇厚重的铁门内，守卫正低声交谈，语气中透出陌生口音。他忽然抬手，一枝火折子从袖中滑落，点燃了墙角堆叠的干草。烈焰腾起，火光冲天，惊动了城楼上的巡卒。‘有敌袭！’喊声未落，城门却悄然开启，一队楚军精锐鱼贯'
2025-09-26 21:19:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 233
2025-09-26 21:19:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:19:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:34 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=41 parent=40 choice='折返咸阳，命人伪造韩信手书，引诱楚营内部自乱阵脚'
2025-09-26 21:19:34 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=41 depth=2
2025-09-26 21:19:34 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=41 completed, triggered next level depth=2
2025-09-26 21:19:34 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=41
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 点燃预先埋设的火油，引燃城门附近的粮草堆
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 命死士佯装溃逃，引敌军追击至伏击圈外
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 亲自潜入城门内侧，借夜色混入敌军队伍
2025-09-26 21:19:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2348
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=954 预览='{"text": "城门两侧的枯树如鬼影般摇曳，死士们伏于暗处，呼吸凝滞。刘邦立于高坡，目光穿透风雪，望见那假使策马而来，披风猎猎，腰间铜铃轻响——正是韩信军中才有的‘鱼符’。他缓缓抽出佩剑，剑尖指向地面，低声道：‘等他入瓮，便以火把为号，三声急鼓，杀尽伪使。’话音未落，远处传来马蹄踏雪声，那使者已至城门前，正欲递上密函。忽然，一阵寒风吹过，卷起一缕灰烬，飘向城楼——那是前日焚烧密信时残留的灰烬，如今竟被风带回了战场。刘邦瞳孔微缩，心中警铃大作：若这使者真能通过，那岂非意味着……整个颍川早已布满内应？他猛然抬手，压下即将发出的信号。真正的杀机，或许不在城门，而在人心深处。", "choices'
2025-09-26 21:19:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=954 预览='{"text": "城门两侧的枯树如鬼影般摇曳，死士们伏于暗处，呼吸凝滞。刘邦立于高坡，目光穿透风雪，望见那假使策马而来，披风猎猎，腰间铜铃轻响——正是韩信军中才有的‘鱼符’。他缓缓抽出佩剑，剑尖指向地面，低声道：‘等他入瓮，便以火把为号，三声急鼓，杀尽伪使。’话音未落，远处传来马蹄踏雪声，那使者已至城门前，正欲递上密'
2025-09-26 21:19:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=954 预览='{"text": "城门两侧的枯树如鬼影般摇曳，死士们伏于暗处，呼吸凝滞。刘邦立于高坡，目光穿透风雪，望见那假使策马而来，披风猎猎，腰间铜铃轻响——正是韩信军中才有的‘鱼符’。他缓缓抽出佩剑，剑尖指向地面，低声道：‘等他入瓮，便以火把为号，三声急鼓，杀尽伪使。’话音未落，远处传来马蹄踏雪声，那使者已至城门前，正欲递上密'
2025-09-26 21:19:34 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 279
2025-09-26 21:19:34 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:34 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:19:34 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:34 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=42 parent=40 choice='潜入敌营，借夜色掩护，用韩信旧部暗号试探真假将领'
2025-09-26 21:19:34 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=42 depth=2
2025-09-26 21:19:34 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=42 completed, triggered next level depth=2
2025-09-26 21:19:34 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=42
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 悄然点燃城楼烽火，引燃敌营疑兵之计
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 命人假扮守将，诱骗使者自曝身份
2025-09-26 21:19:34 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 悄然撤退，改道绕行至西关，另寻破局之机
2025-09-26 21:19:38 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:38 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2581
2025-09-26 21:19:38 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=928 预览='{"text": "咸阳城的夜风卷着黄沙掠过宫墙，刘邦独坐密室，烛火摇曳中铺开一张素笺。他提笔蘸墨，以韩信惯用的笔锋写下‘颍川粮道已断，宜速调兵’，字迹间暗藏三处齐地密语标记——那是韩信与旧部约定的‘死讯’信号。墨未干，他便命人将信封入火漆，附上一枚伪造的鱼符，遣死士快马送往楚营。三日后，楚军大帐内，项羽亲见此信，勃然大怒：‘韩信竟敢私通汉廷？’一时间，楚营内部疑云四起，将领互指，军心动摇。刘邦在灯下轻笑，指尖拂过案上另一份密报——那正是韩信真正的手书，正悄然送往齐地，只待时机一到，便可反向引燃战火。真正的棋局，从来不在纸上。", "choices": [{"option": "命人假扮韩信亲'
2025-09-26 21:19:38 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=928 预览='{"text": "咸阳城的夜风卷着黄沙掠过宫墙，刘邦独坐密室，烛火摇曳中铺开一张素笺。他提笔蘸墨，以韩信惯用的笔锋写下‘颍川粮道已断，宜速调兵’，字迹间暗藏三处齐地密语标记——那是韩信与旧部约定的‘死讯’信号。墨未干，他便命人将信封入火漆，附上一枚伪造的鱼符，遣死士快马送往楚营。三日后，楚军大帐内，项羽亲见此信，勃然'
2025-09-26 21:19:38 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=928 预览='{"text": "咸阳城的夜风卷着黄沙掠过宫墙，刘邦独坐密室，烛火摇曳中铺开一张素笺。他提笔蘸墨，以韩信惯用的笔锋写下‘颍川粮道已断，宜速调兵’，字迹间暗藏三处齐地密语标记——那是韩信与旧部约定的‘死讯’信号。墨未干，他便命人将信封入火漆，附上一枚伪造的鱼符，遣死士快马送往楚营。三日后，楚军大帐内，项羽亲见此信，勃然'
2025-09-26 21:19:38 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 256
2025-09-26 21:19:38 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:38 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:19:38 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:19:38 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:38 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=43 parent=41 choice='点燃预先埋设的火油，引燃城门附近的粮草堆'
2025-09-26 21:19:38 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=43 depth=1
2025-09-26 21:19:38 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=43 completed, triggered next level depth=1
2025-09-26 21:19:38 | INFO     | core.speculation:_run_pipeline:93 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=3 node=43
2025-09-26 21:19:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2594
2025-09-26 21:19:39 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=922 预览='{"text": "夜风卷过咸阳宫墙，烛火摇曳中，刘邦独坐案前，将韩信亲笔书信反复摩挲。他忽然撕碎纸页，蘸墨重写——字迹如刀锋般凌厉，却故意在落款处留下几道不连贯的墨痕，仿若醉后潦草。信中言辞激烈，斥责楚营‘背盟欺主’，更称已命颍川三军‘即刻发兵，直取彭城’。他命人连夜抄录十份，分由五名死士携往楚营各部，每封信皆附一枚伪造的‘韩信印’。次日清晨，楚营内骤起骚动：将领们争执不休，有人主张速战，有人疑虑诈降。项羽震怒，下令彻查‘韩信通敌’之案。而刘邦立于城楼之上，望着远方烟尘滚滚，嘴角微扬：‘人心一乱，胜过千军万马。’", "choices": [{"option": "命人将伪造密信藏于楚军俘虏'
2025-09-26 21:19:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=922 预览='{"text": "夜风卷过咸阳宫墙，烛火摇曳中，刘邦独坐案前，将韩信亲笔书信反复摩挲。他忽然撕碎纸页，蘸墨重写——字迹如刀锋般凌厉，却故意在落款处留下几道不连贯的墨痕，仿若醉后潦草。信中言辞激烈，斥责楚营‘背盟欺主’，更称已命颍川三军‘即刻发兵，直取彭城’。他命人连夜抄录十份，分由五名死士携往楚营各部，每封信皆附一枚'
2025-09-26 21:19:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=922 预览='{"text": "夜风卷过咸阳宫墙，烛火摇曳中，刘邦独坐案前，将韩信亲笔书信反复摩挲。他忽然撕碎纸页，蘸墨重写——字迹如刀锋般凌厉，却故意在落款处留下几道不连贯的墨痕，仿若醉后潦草。信中言辞激烈，斥责楚营‘背盟欺主’，更称已命颍川三军‘即刻发兵，直取彭城’。他命人连夜抄录十份，分由五名死士携往楚营各部，每封信皆附一枚'
2025-09-26 21:19:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 250
2025-09-26 21:19:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:39 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:19:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:19:39 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:39 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=44 parent=41 choice='亲自潜入城门内侧，借夜色混入敌军队伍'
2025-09-26 21:19:39 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=44 depth=1
2025-09-26 21:19:39 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=44 completed, triggered next level depth=1
2025-09-26 21:19:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2630
2025-09-26 21:19:39 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=963 预览='{"text": "夜色如墨，楚营灯火在风中摇曳，仿佛无数只窥视的眼睛。刘邦潜行于断墙残垣之间，斗篷裹紧身形，指尖轻触腰间韩信旧部所传的‘鱼符’——那枚刻有‘信’字的青铜片，在月光下泛着幽冷微光。他悄然接近一处哨卡，低语一句暗号：‘颍川雨落，信使未至。’守卫一怔，随即应道：‘兵已备，将未归。’话音未落，远处传来马蹄声，似有新使至。刘邦心头一紧——这应答虽合旧制，却少了韩信军中特有的尾音顿挫，那是他亲自教过的口令节奏。他猛然意识到，真正的韩信旧部，早已被调离或囚禁。眼前这营地，不过是一具披着旧皮的空壳。他缓缓后退，藏身于枯树阴影，目光如刀，扫视营中每一处火光与人影——若连暗语都能伪造，那谁才是真'
2025-09-26 21:19:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=963 预览='{"text": "夜色如墨，楚营灯火在风中摇曳，仿佛无数只窥视的眼睛。刘邦潜行于断墙残垣之间，斗篷裹紧身形，指尖轻触腰间韩信旧部所传的‘鱼符’——那枚刻有‘信’字的青铜片，在月光下泛着幽冷微光。他悄然接近一处哨卡，低语一句暗号：‘颍川雨落，信使未至。’守卫一怔，随即应道：‘兵已备，将未归。’话音未落，远处传来马蹄声，'
2025-09-26 21:19:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=963 预览='{"text": "夜色如墨，楚营灯火在风中摇曳，仿佛无数只窥视的眼睛。刘邦潜行于断墙残垣之间，斗篷裹紧身形，指尖轻触腰间韩信旧部所传的‘鱼符’——那枚刻有‘信’字的青铜片，在月光下泛着幽冷微光。他悄然接近一处哨卡，低语一句暗号：‘颍川雨落，信使未至。’守卫一怔，随即应道：‘兵已备，将未归。’话音未落，远处传来马蹄声，'
2025-09-26 21:19:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 295
2025-09-26 21:19:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:39 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:19:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:19:39 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:39 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=45 parent=42 choice='悄然点燃城楼烽火，引燃敌营疑兵之计'
2025-09-26 21:19:39 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=45 depth=1
2025-09-26 21:19:39 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=45 completed, triggered next level depth=1
2025-09-26 21:19:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2578
2025-09-26 21:19:39 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=900 预览='{"text": "寒风如刀，割裂夜色。刘邦伏于楚营外三里处的枯冢之间，斗篷裹身，只露一双鹰目。他取出一枚旧时韩信所赐的铜铃，轻轻一晃——铃声低哑，却暗合当年军中‘归雁三叠’的暗号。远处营帐深处，传来一声极轻的回应：‘三更归雁，翼未展。’那声音沙哑，似是故人，又似伪装。他心头一凛，这非韩信旧部惯用语，而是刻意模仿。若真有内应，必不会如此生硬。他缓缓将铜铃藏入袖中，目光扫过营门守卫的换班节奏——五人轮值，七刻一更，而今正是第三更初。真正的考验不在识破，而在如何让对方自曝。他深吸一口冷气，指尖轻触腰间短刃，准备以血为引，试出谁才是真正的‘雁影’。", "choices": [{"option": '
2025-09-26 21:19:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=900 预览='{"text": "寒风如刀，割裂夜色。刘邦伏于楚营外三里处的枯冢之间，斗篷裹身，只露一双鹰目。他取出一枚旧时韩信所赐的铜铃，轻轻一晃——铃声低哑，却暗合当年军中‘归雁三叠’的暗号。远处营帐深处，传来一声极轻的回应：‘三更归雁，翼未展。’那声音沙哑，似是故人，又似伪装。他心头一凛，这非韩信旧部惯用语，而是刻意模仿。若真'
2025-09-26 21:19:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=900 预览='{"text": "寒风如刀，割裂夜色。刘邦伏于楚营外三里处的枯冢之间，斗篷裹身，只露一双鹰目。他取出一枚旧时韩信所赐的铜铃，轻轻一晃——铃声低哑，却暗合当年军中‘归雁三叠’的暗号。远处营帐深处，传来一声极轻的回应：‘三更归雁，翼未展。’那声音沙哑，似是故人，又似伪装。他心头一凛，这非韩信旧部惯用语，而是刻意模仿。若真'
2025-09-26 21:19:39 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 264
2025-09-26 21:19:39 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:39 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: space_station.jpg
2025-09-26 21:19:39 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/space_station.jpg
2025-09-26 21:19:39 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:39 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=46 parent=42 choice='悄然撤退，改道绕行至西关，另寻破局之机'
2025-09-26 21:19:39 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=46 depth=1
2025-09-26 21:19:39 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=46 completed, triggered next level depth=1
2025-09-26 21:19:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2340
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=899 预览='{"text": "城门两侧的枯枝在风中轻颤，死士们伏于暗影，呼吸凝滞如冰。刘邦立于高坡，目光如刃，锁住那缓缓开启的城门——假使已至，身披齐使白袍，腰间铜符微光闪烁。他忽然抬手，一缕火折子自袖中飞出，直坠城门内侧草堆。烈焰骤起，映亮了守将惊愕的脸。‘原来不是齐使，是楚军的饵。’他低语，嘴角却浮起一丝冷笑。真正的猎物，从不入瓮，而是诱敌自投罗网。他挥手示意，死士们悄然拔刀，箭矢上弦，只待一声令下——但就在此刻，远处传来马蹄声如雷，一支精骑正朝城门疾驰而来，旗上绣着‘韩’字，正是韩信亲兵！刘邦瞳孔骤缩，手中剑柄微微发烫——这局棋，竟有人抢先落子。", "choices": [{"option": '
2025-09-26 21:19:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=899 预览='{"text": "城门两侧的枯枝在风中轻颤，死士们伏于暗影，呼吸凝滞如冰。刘邦立于高坡，目光如刃，锁住那缓缓开启的城门——假使已至，身披齐使白袍，腰间铜符微光闪烁。他忽然抬手，一缕火折子自袖中飞出，直坠城门内侧草堆。烈焰骤起，映亮了守将惊愕的脸。‘原来不是齐使，是楚军的饵。’他低语，嘴角却浮起一丝冷笑。真正的猎物，从'
2025-09-26 21:19:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=899 预览='{"text": "城门两侧的枯枝在风中轻颤，死士们伏于暗影，呼吸凝滞如冰。刘邦立于高坡，目光如刃，锁住那缓缓开启的城门——假使已至，身披齐使白袍，腰间铜符微光闪烁。他忽然抬手，一缕火折子自袖中飞出，直坠城门内侧草堆。烈焰骤起，映亮了守将惊愕的脸。‘原来不是齐使，是楚军的饵。’他低语，嘴角却浮起一丝冷笑。真正的猎物，从'
2025-09-26 21:19:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 264
2025-09-26 21:19:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:19:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=47 parent=40 choice='伪装成伤兵混入城门，借哀嚎之声刺探守军口风'
2025-09-26 21:19:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=47 depth=2
2025-09-26 21:19:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=47 completed, triggered next level depth=2
2025-09-26 21:19:40 | DEBUG    | core.speculation:_generate_children_pipeline:190 - [Speculation] pipeline generating 3 children for node=47
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 点燃预埋火油，制造混乱后趁乱突袭
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 立即撤退，改道南门，借夜色绕行潜入
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:461 - 继续故事，用户选择: 高举韩信令牌，佯装接应，反向策动敌营内乱
2025-09-26 21:19:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2598
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=921 预览='{"text": "寒风如刀，割过楚营的栅栏。刘邦伏于断墙之后，斗篷上沾满霜雪，手中紧握一枚韩信旧部所用的铜铃——那是当年拜将仪式上赐予亲信的信物。他屏息凝神，忽然轻摇铜铃三声，音色低哑，恰似旧日军令。片刻后，远处火堆旁传来一声回应：‘韩信未至，何人来此？’声音沙哑，却带着一丝熟悉口音。刘邦心头一震——这并非韩信亲兵惯用的暗语节奏。他悄然将铃铛藏入袖中，目光扫向营帐深处：一名将领正与副将低声商议，腰间佩刀上的刻痕，竟与韩信旧部所用的‘雁翎’纹样一模一样。可那副将袖口露出的布料，却是齐国特有的靛蓝丝线。真正的敌人，早已混入了自己人的影子里。", "choices": [{"option": "假'
2025-09-26 21:19:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=921 预览='{"text": "寒风如刀，割过楚营的栅栏。刘邦伏于断墙之后，斗篷上沾满霜雪，手中紧握一枚韩信旧部所用的铜铃——那是当年拜将仪式上赐予亲信的信物。他屏息凝神，忽然轻摇铜铃三声，音色低哑，恰似旧日军令。片刻后，远处火堆旁传来一声回应：‘韩信未至，何人来此？’声音沙哑，却带着一丝熟悉口音。刘邦心头一震——这并非韩信亲兵惯'
2025-09-26 21:19:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=921 预览='{"text": "寒风如刀，割过楚营的栅栏。刘邦伏于断墙之后，斗篷上沾满霜雪，手中紧握一枚韩信旧部所用的铜铃——那是当年拜将仪式上赐予亲信的信物。他屏息凝神，忽然轻摇铜铃三声，音色低哑，恰似旧日军令。片刻后，远处火堆旁传来一声回应：‘韩信未至，何人来此？’声音沙哑，却带着一丝熟悉口音。刘邦心头一震——这并非韩信亲兵惯'
2025-09-26 21:19:40 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 262
2025-09-26 21:19:40 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:40 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: rebirth_gate_placeholder.png
2025-09-26 21:19:40 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/rebirth_gate_placeholder.png
2025-09-26 21:19:40 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:40 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=48 parent=42 choice='命人假扮守将，诱骗使者自曝身份'
2025-09-26 21:19:40 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=48 depth=1
2025-09-26 21:19:40 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=48 completed, triggered next level depth=1
2025-09-26 21:19:44 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:44 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2585
2025-09-26 21:19:44 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=900 预览='{"text": "城门下，一具被弃的伤兵蜷缩在泥泞中，血染破衣，气息微弱。刘邦紧咬牙关，任冷雨浸透伤口，喉间咳出混着铁锈味的血沫。他听见守军低语：‘齐使已入内，韩信那厮怕是真要反了？’话音未落，一队披甲士兵匆匆而过，腰间佩刀却无韩信军制纹样。他瞳孔骤缩——这根本不是韩信的人！可那‘韩信’的名号，竟已成了他们最锋利的刀。他缓缓抬手，将一块沾血的铜片塞入怀中，那是方才假使掉落的暗记。风卷残烬，火光映在他眼中，如寒星般幽深。真正的敌人，从不现身，只借他人之名，行杀戮之实。", "choices": [{"option": "装作失语，以指画地拼出‘韩信未至’四字，诱使守军暴露内情", "summa'
2025-09-26 21:19:44 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=900 预览='{"text": "城门下，一具被弃的伤兵蜷缩在泥泞中，血染破衣，气息微弱。刘邦紧咬牙关，任冷雨浸透伤口，喉间咳出混着铁锈味的血沫。他听见守军低语：‘齐使已入内，韩信那厮怕是真要反了？’话音未落，一队披甲士兵匆匆而过，腰间佩刀却无韩信军制纹样。他瞳孔骤缩——这根本不是韩信的人！可那‘韩信’的名号，竟已成了他们最锋利的刀'
2025-09-26 21:19:44 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=900 预览='{"text": "城门下，一具被弃的伤兵蜷缩在泥泞中，血染破衣，气息微弱。刘邦紧咬牙关，任冷雨浸透伤口，喉间咳出混着铁锈味的血沫。他听见守军低语：‘齐使已入内，韩信那厮怕是真要反了？’话音未落，一队披甲士兵匆匆而过，腰间佩刀却无韩信军制纹样。他瞳孔骤缩——这根本不是韩信的人！可那‘韩信’的名号，竟已成了他们最锋利的刀'
2025-09-26 21:19:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 226
2025-09-26 21:19:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:44 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:19:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:19:44 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:44 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=49 parent=47 choice='点燃预埋火油，制造混乱后趁乱突袭'
2025-09-26 21:19:44 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=49 depth=1
2025-09-26 21:19:44 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=49 completed, triggered next level depth=1
2025-09-26 21:19:44 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:44 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2589
2025-09-26 21:19:44 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=902 预览='{"text": "夜风卷起破袍，刘邦伏在城门侧沟渠中，浑身沾满泥浆与血渍，右臂缠着染血的布条，发出断续的呻吟。守军巡哨的脚步声渐近，他咬牙将脸埋入腐叶，任寒气刺骨。一名楚兵掀开他衣袖，见伤处溃烂，皱眉道：‘这伤是火燎的？’刘邦喉咙沙哑地哀嚎：‘韩将军……说颍川有异动……让我来报……’话音未落，另一名老兵冷笑：‘韩信？那可是齐国的人，如今倒成了汉军的走狗？’声音低沉，却如刀割耳膜。刘邦心头一震——原来连守军都已察觉韩信之名被滥用。他闭眼吞下苦涩，暗中记下那句‘齐国的人’，心中已生新局：若连敌营都信韩信为叛，那便让这谎言，烧成燎原之火。", "choices": [{"option": "佯装失'
2025-09-26 21:19:44 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=902 预览='{"text": "夜风卷起破袍，刘邦伏在城门侧沟渠中，浑身沾满泥浆与血渍，右臂缠着染血的布条，发出断续的呻吟。守军巡哨的脚步声渐近，他咬牙将脸埋入腐叶，任寒气刺骨。一名楚兵掀开他衣袖，见伤处溃烂，皱眉道：‘这伤是火燎的？’刘邦喉咙沙哑地哀嚎：‘韩将军……说颍川有异动……让我来报……’话音未落，另一名老兵冷笑：‘韩信？'
2025-09-26 21:19:44 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=902 预览='{"text": "夜风卷起破袍，刘邦伏在城门侧沟渠中，浑身沾满泥浆与血渍，右臂缠着染血的布条，发出断续的呻吟。守军巡哨的脚步声渐近，他咬牙将脸埋入腐叶，任寒气刺骨。一名楚兵掀开他衣袖，见伤处溃烂，皱眉道：‘这伤是火燎的？’刘邦喉咙沙哑地哀嚎：‘韩将军……说颍川有异动……让我来报……’话音未落，另一名老兵冷笑：‘韩信？'
2025-09-26 21:19:44 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 260
2025-09-26 21:19:44 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:44 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:19:44 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:19:44 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:44 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=50 parent=47 choice='立即撤退，改道南门，借夜色绕行潜入'
2025-09-26 21:19:44 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=50 depth=1
2025-09-26 21:19:44 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=50 completed, triggered next level depth=1
2025-09-26 21:19:45 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:45 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2584
2025-09-26 21:19:45 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=900 预览='{"text": "城门下，寒风卷起破袍，刘邦伏于血泊之中，右臂染血，指节因剧痛而发白。他低喘着，喉间溢出断续呻吟，仿佛一名被乱箭射穿的溃兵。守军火把摇曳，脚步声渐近。‘又一个逃兵？’一卒弯腰探头，鼻尖几乎触到他沾满泥泞的脸。刘邦闭目，任冷雨灌入衣领，却在对方俯身瞬间，指尖悄然扣住腰间暗藏的短刃——那不是杀意，而是试探。他忽然嘶哑开口：‘韩将军……说今夜……有齐使入城……要见主将……’话音未落，守将瞳孔骤缩，下意识反问：‘韩将军？他不是在颍川？’——这句脱口而出的疑虑，如刀锋划过夜幕。刘邦嘴角微动，心知已触到真相的裂痕。", "choices": [{"option": "装作惊恐失语，趁守将'
2025-09-26 21:19:45 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=900 预览='{"text": "城门下，寒风卷起破袍，刘邦伏于血泊之中，右臂染血，指节因剧痛而发白。他低喘着，喉间溢出断续呻吟，仿佛一名被乱箭射穿的溃兵。守军火把摇曳，脚步声渐近。‘又一个逃兵？’一卒弯腰探头，鼻尖几乎触到他沾满泥泞的脸。刘邦闭目，任冷雨灌入衣领，却在对方俯身瞬间，指尖悄然扣住腰间暗藏的短刃——那不是杀意，而是试探'
2025-09-26 21:19:45 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=900 预览='{"text": "城门下，寒风卷起破袍，刘邦伏于血泊之中，右臂染血，指节因剧痛而发白。他低喘着，喉间溢出断续呻吟，仿佛一名被乱箭射穿的溃兵。守军火把摇曳，脚步声渐近。‘又一个逃兵？’一卒弯腰探头，鼻尖几乎触到他沾满泥泞的脸。刘邦闭目，任冷雨灌入衣领，却在对方俯身瞬间，指尖悄然扣住腰间暗藏的短刃——那不是杀意，而是试探'
2025-09-26 21:19:45 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 253
2025-09-26 21:19:45 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:45 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: fantasy_castle.jpg
2025-09-26 21:19:45 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/fantasy_castle.jpg
2025-09-26 21:19:45 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:45 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=51 parent=47 choice='高举韩信令牌，佯装接应，反向策动敌营内乱'
2025-09-26 21:19:45 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=51 depth=1
2025-09-26 21:19:45 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=51 completed, triggered next level depth=1
2025-09-26 21:19:46 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 21:19:46 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2574
2025-09-26 21:19:46 | INFO     | core.story_engine:continue_story:491 - [LLM raw][continue] 长度=920 预览='{"text": "夜色如铁，咸阳宫内烛火摇曳。刘邦独坐案前，将韩信亲笔书信置于火盆之上，任其边缘卷曲焦黑。他凝视着火焰中扭曲的字迹，忽然低笑出声：‘你写得真像，可惜……忘了我认得你笔锋里那点倔气。’他提笔蘸墨，以韩信惯用的章草重写一封密函，内容却暗藏反间之语——‘项羽已许我齐地三郡，颍川可弃’。墨迹未干，便命心腹连夜送往楚营，附带一枚伪造的‘虎符’印信。风穿过空庭，仿佛听见远方楚营传来低语：‘韩将军果然有异心？’刘邦起身望向窗外，月光如霜，洒在城墙上斑驳的裂痕上。真正的风暴，不在刀兵之间，而在人心缝隙里悄然生长。", "choices": [{"option": "命人假扮韩信亲信，在楚军营'
2025-09-26 21:19:46 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=920 预览='{"text": "夜色如铁，咸阳宫内烛火摇曳。刘邦独坐案前，将韩信亲笔书信置于火盆之上，任其边缘卷曲焦黑。他凝视着火焰中扭曲的字迹，忽然低笑出声：‘你写得真像，可惜……忘了我认得你笔锋里那点倔气。’他提笔蘸墨，以韩信惯用的章草重写一封密函，内容却暗藏反间之语——‘项羽已许我齐地三郡，颍川可弃’。墨迹未干，便命心腹连夜'
2025-09-26 21:19:46 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=920 预览='{"text": "夜色如铁，咸阳宫内烛火摇曳。刘邦独坐案前，将韩信亲笔书信置于火盆之上，任其边缘卷曲焦黑。他凝视着火焰中扭曲的字迹，忽然低笑出声：‘你写得真像，可惜……忘了我认得你笔锋里那点倔气。’他提笔蘸墨，以韩信惯用的章草重写一封密函，内容却暗藏反间之语——‘项羽已许我齐地三郡，颍川可弃’。墨迹未干，便命心腹连夜'
2025-09-26 21:19:46 | DEBUG    | core.image_service:get_image_for_story:89 - 开始为故事获取图片，故事文本长度: 250
2025-09-26 21:19:46 | INFO     | core.image_service:find_image_in_library:45 - 正在从预置图库中查找图片...
2025-09-26 21:19:46 | INFO     | core.image_service:find_image_in_library:72 - 未匹配到关键字，随机选择了图片: magic_forest.jpg
2025-09-26 21:19:46 | DEBUG    | core.image_service:get_image_for_story:93 - 图库查找结果: /static/magic_forest.jpg
2025-09-26 21:19:46 | INFO     | core.story_engine:continue_story:572 - 故事继续生成成功
2025-09-26 21:19:46 | DEBUG    | core.speculation:_generate_child_node:246 - [Speculation] created node=52 parent=41 choice='命死士佯装溃逃，引敌军追击至伏击圈外'
2025-09-26 21:19:46 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=3 node=52 depth=1
2025-09-26 21:19:46 | DEBUG    | core.speculation:_generate_children_pipeline:207 - [Speculation] child node=52 completed, triggered next level depth=1
2025-09-26 21:20:30 | INFO     | api.story:continue_existing_story:398 - 收到故事继续请求，选择: 潜入敌营，借夜色掩护，用韩信旧部暗号试探真假将领
2025-09-26 22:06:56 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:06:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:06:59 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:06:59 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:06:59 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:06:59 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:06:59 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:06:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:07:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:07:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:07:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:07:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:07:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:07:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:07:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:07:13 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:07:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:07:15 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:07:15 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:07:15 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:07:15 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:07:15 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:07:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:15 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:07:15 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:07:15 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:07:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:16 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:07:16 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:07:16 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:07:16 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:07:16 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:07:38 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:07:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:07:40 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:07:40 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:07:40 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:07:40 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:07:40 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:07:40 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:40 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:07:40 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:07:40 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:07:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:07:41 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:07:41 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:07:41 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:07:41 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:07:41 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:01 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:08:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:08:03 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:08:03 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:08:03 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:08:03 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:03 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:08:03 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:03 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:08:03 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:08:03 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:08:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:04 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:08:04 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:08:04 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:08:04 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:08:04 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:29 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:08:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:08:30 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:08:30 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:08:30 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:08:30 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:30 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:08:30 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:31 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:08:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:08:31 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:08:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:31 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:08:31 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:08:31 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:08:31 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:08:31 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:38 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:08:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:08:40 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:08:40 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:08:40 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:08:40 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:40 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:08:40 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:40 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:08:40 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:08:40 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:08:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:41 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:08:41 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:08:41 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:08:41 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:08:41 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:54 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:08:55 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:08:56 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:08:56 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:08:56 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:08:56 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:08:56 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:08:56 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:56 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:08:56 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:08:56 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:08:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:08:57 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:08:57 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:08:57 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:08:57 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:08:57 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:09:32 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:09:33 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:09:34 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:09:34 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:09:34 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:09:34 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:09:34 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:09:34 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:09:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:09:34 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:09:34 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:09:34 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:09:35 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:09:35 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:09:35 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:09:35 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:09:35 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:09:35 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:10:26 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:10:27 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:10:28 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:10:28 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:10:28 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:10:28 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:10:28 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:10:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:10:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:10:28 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:10:28 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:10:28 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:10:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:10:29 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:10:29 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:10:29 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:10:29 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:10:29 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:10:49 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:10:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:10:51 | INFO     | backend.core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-26 22:10:51 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: qwen-image, 提示词: A beautiful sunset over mountains...
2025-09-26 22:10:51 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:10:51 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:10:51 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:10:51 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:10:51 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:10:51 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:10:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:10:51 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:10:51 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:10:51 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:10:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:10:52 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:10:52 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:10:52 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:10:52 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:10:52 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:11:16 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 620
2025-09-26 22:11:16 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: qwen-image, 提示词: 一只可爱的小猫咪在花园里玩耍...
2025-09-26 22:11:44 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 620
2025-09-26 22:11:44 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: qwen-image, 提示词: Future city with flying cars...
2025-09-26 22:12:08 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 620
2025-09-26 22:12:08 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: A beautiful sunset over mountains...
2025-09-26 22:12:18 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 703
2025-09-26 22:12:18 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: 一只可爱的小猫咪在花园里玩耍...
2025-09-26 22:12:30 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 703
2025-09-26 22:12:30 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Future city with flying cars...
2025-09-26 22:12:43 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 764
2025-09-26 22:12:43 | ERROR    | backend.core.image_generation:generate_image:63 - 图像生成失败: 模型 'invalid-model' 不可用。可用模型: ['qwen-image', 'nano-banana']
2025-09-26 22:12:43 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: qwen-image, 提示词: ...
2025-09-26 22:13:08 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 620
2025-09-26 22:14:57 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:14:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:14:58 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:14:58 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:14:58 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:14:58 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:14:58 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:14:58 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:14:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:14:59 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:14:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:14:59 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:14:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:14:59 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:14:59 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:14:59 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:14:59 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:14:59 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:14:59 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:15:00 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:15:01 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:15:01 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:15:01 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:15:01 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:15:01 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:15:01 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:15:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:15:01 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:15:01 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:15:02 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:15:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:15:02 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:15:02 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:15:02 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:15:02 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:15:02 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:15:16 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:15:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:15:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:15:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:15:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:15:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:15:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:15:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:15:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:15:18 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:15:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:15:18 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:15:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:15:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:15:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:15:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:15:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:15:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:15:30 | INFO     | backend.core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-26 22:15:30 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: A beautiful sunset over mountains...
2025-09-26 22:15:51 | ERROR    | backend.core.image_generation:_generate_oneapi:131 - 图像生成请求失败: HTTPSConnectionPool(host='oneapi.cyberclaude.com', port=443): Max retries exceeded with url: /v1/chat/completions (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x00000178C827F390>, 'Connection to oneapi.cyberclaude.com timed out. (connect timeout=60)'))
2025-09-26 22:15:51 | ERROR    | backend.core.image_generation:generate_image:63 - 图像生成失败: 网络请求失败: HTTPSConnectionPool(host='oneapi.cyberclaude.com', port=443): Max retries exceeded with url: /v1/chat/completions (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x00000178C827F390>, 'Connection to oneapi.cyberclaude.com timed out. (connect timeout=60)'))
2025-09-26 22:15:51 | ERROR    | backend.core.image_generation:generate_image:63 - 图像生成失败: 模型 'invalid-model' 不可用。可用模型: ['nano-banana']
2025-09-26 22:15:51 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: ...
2025-09-26 22:16:13 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:16:14 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:16:14 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:16:14 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:16:14 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:16:14 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:14 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:16:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:14 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:16:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:16:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:16:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:16:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:16:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:16:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:16:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:15 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:16:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:16:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:16:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:16:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:16:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:16:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:17 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:16:17 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:16:17 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:16:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:18 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:16:18 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:16:18 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:16:18 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:16:18 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:24 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:16:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:16:26 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:16:26 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:16:26 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:16:26 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:26 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:16:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:26 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:16:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:16:26 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:16:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:27 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:16:27 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:16:27 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:16:27 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:16:27 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:27 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:16:28 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:16:29 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:16:29 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:16:29 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:16:29 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:29 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:16:29 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:29 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:16:29 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:16:29 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:16:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:16:30 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:16:30 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:16:30 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:16:30 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:16:30 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:16:36 | INFO     | backend.core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-26 22:16:36 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: qwen-image, 提示词: A beautiful sunset over mountains...
2025-09-26 22:17:00 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 620
2025-09-26 22:17:00 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: qwen-image, 提示词: 一只可爱的小猫咪在花园里玩耍...
2025-09-26 22:18:12 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:18:13 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:18:14 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:18:14 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:18:14 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:18:14 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:18:14 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:18:14 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:18:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:18:14 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:18:14 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:18:14 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:18:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:18:15 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:18:15 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:18:15 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:18:15 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:18:15 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:18:16 | INFO     | backend.core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-26 22:18:16 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: A beautiful sunset over mountains...
2025-09-26 22:18:31 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 703
2025-09-26 22:18:31 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: 一只可爱的小猫咪在花园里玩耍...
2025-09-26 22:18:48 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 703
2025-09-26 22:18:48 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Future city with flying cars...
2025-09-26 22:19:05 | INFO     | backend.core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 703
2025-09-26 22:19:05 | ERROR    | backend.core.image_generation:generate_image:63 - 图像生成失败: 模型 'invalid-model' 不可用。可用模型: ['nano-banana']
2025-09-26 22:19:05 | INFO     | backend.core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: ...
2025-09-26 22:23:34 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:23:35 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:23:36 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:23:36 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:23:36 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:23:36 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:23:36 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:23:36 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:23:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:23:36 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:23:36 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:23:36 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:23:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:23:37 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:23:37 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:23:37 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:23:37 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:23:37 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:37:10 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:37:12 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:37:12 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:37:12 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:37:12 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:37:12 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:37:12 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:37:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:37:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:37:13 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:37:13 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:37:13 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:37:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:37:14 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:37:14 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:37:14 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:37:14 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:37:14 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:38:07 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:38:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:38:10 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:38:10 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:38:10 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:38:10 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:38:10 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:38:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:38:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:38:10 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:38:10 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:38:10 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:38:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:38:11 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:38:11 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:38:11 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:38:11 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:38:11 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:38:41 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:38:59 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:39:00 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:39:00 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:39:00 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:39:00 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:39:00 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:39:00 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:39:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:39:00 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:39:00 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:39:00 | INFO     | backend.main:_run_alembic_cmd:90 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:39:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:39:01 | INFO     | backend.main:_run_alembic_cmd:92 - Alembic migration complete.
2025-09-26 22:39:01 | INFO     | backend.main:startup_event:103 - 重生之我是……API服务启动
2025-09-26 22:39:01 | INFO     | backend.main:startup_event:104 - 调试模式: True
2025-09-26 22:39:01 | INFO     | backend.main:startup_event:109 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:39:01 | INFO     | backend.main:startup_event:110 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:39:21 | INFO     | backend.main:shutdown_event:116 - 重生之我是……API服务关闭
2025-09-26 22:39:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:39:23 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:39:23 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:39:23 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:39:23 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:39:23 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:39:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:39:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:39:23 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:39:23 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:39:23 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:39:23 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:39:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:39:24 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:39:24 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:39:24 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:39:24 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:39:24 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:21 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 22:42:22 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:42:23 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:42:23 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:42:23 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:42:23 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:23 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:42:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:23 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:42:23 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:42:23 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:42:23 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:42:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:24 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:42:24 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:42:24 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:42:24 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:42:24 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:39 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 22:42:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:42:42 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:42:42 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:42:42 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:42:42 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:42 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:42:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:42 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:42:42 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:42:42 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:42:42 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:42:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:43 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:42:43 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:42:43 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:42:43 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:42:43 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:43 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 22:42:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:42:45 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:42:45 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:42:45 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:42:45 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:45 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:42:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:45 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:42:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:42:45 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:42:45 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:42:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:46 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:42:46 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:42:46 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:42:46 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:42:46 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:57 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 22:42:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:42:59 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:42:59 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:42:59 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:42:59 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:42:59 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:42:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:42:59 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:42:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:42:59 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:42:59 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:43:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:00 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:43:00 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:43:00 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:43:00 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:43:00 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:43:26 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 22:43:27 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:43:28 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:43:28 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:43:28 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:43:28 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:43:28 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:43:28 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:28 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:43:28 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:43:28 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:43:28 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:43:28 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:29 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:43:29 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:43:29 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:43:29 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:43:29 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:43:29 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 22:43:30 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 22:43:30 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 22:43:30 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 22:43:30 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 22:43:30 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 22:43:30 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 22:43:30 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:31 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 22:43:31 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 22:43:31 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 22:43:31 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 22:43:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 22:43:31 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 22:43:31 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 22:43:31 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 22:43:31 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 22:43:31 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:01:35 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:01:36 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:01:37 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:01:37 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:01:37 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:01:37 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:01:37 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:01:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:01:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:01:37 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:01:37 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:01:37 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:01:37 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:01:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:01:38 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:01:38 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:01:38 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:01:38 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:01:38 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:01:55 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:01:56 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:01:57 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:01:57 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:01:57 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:01:57 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:01:57 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:01:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:01:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:01:57 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:01:57 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:01:57 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:01:57 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:01:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:01:57 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:01:57 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:01:57 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:01:57 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:01:57 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:02:08 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:02:09 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:02:09 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:02:09 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:02:09 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:02:09 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:02:09 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:02:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:02:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:02:10 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:02:10 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:02:10 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:02:10 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:02:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:02:10 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:02:10 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:02:10 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:02:10 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:02:10 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:02:38 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:02:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:02:40 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:02:40 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:02:40 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:02:40 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:02:40 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:02:40 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:02:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:02:40 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:02:40 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:02:40 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:02:40 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:02:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:02:41 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:02:41 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:02:41 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:02:41 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:02:41 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:03:15 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:03:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:03:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:03:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:03:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:03:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:03:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:03:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:03:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:03:17 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:03:17 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:03:17 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:03:17 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:03:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:03:18 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:03:18 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:03:18 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:03:18 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:03:18 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:03:51 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:03:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:03:53 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:03:53 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:03:53 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:03:53 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:03:53 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:03:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:03:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:03:53 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:03:53 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:03:53 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:03:53 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:03:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:03:54 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:03:54 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:03:54 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:03:54 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:03:54 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:05:06 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:05:07 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:05:08 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:05:08 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:05:08 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:05:08 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:05:08 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:05:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:05:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:05:08 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:05:08 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:05:08 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:05:08 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:05:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:05:09 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:05:09 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:05:09 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:05:09 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:05:09 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:05:36 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:05:37 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:05:38 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:05:38 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:05:38 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:05:38 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:05:38 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:05:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:05:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:05:38 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:05:38 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:05:38 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:05:38 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:05:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:05:39 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:05:39 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:05:39 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:05:39 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:05:39 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:06:03 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:06:04 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:06:05 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:06:05 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:06:05 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:06:05 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:06:05 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:06:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:06:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:06:05 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:06:05 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:06:05 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:06:05 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:06:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:06:06 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:06:06 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:06:06 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:06:06 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:06:06 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:06:57 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:06:58 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:06:59 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:06:59 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:06:59 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:06:59 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:06:59 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:06:59 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:06:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:06:59 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:06:59 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:06:59 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:06:59 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:07:00 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:07:00 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:07:00 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:07:00 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:07:00 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:07:00 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:09:09 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:09:10 | INFO     | core.image_service:_load_image_library:46 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:09:10 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:09:10 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:09:10 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:09:10 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:09:10 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:09:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:11 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:09:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:09:11 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:09:11 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:09:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:11 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:09:11 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:09:11 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:09:11 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:09:11 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:09:28 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:09:29 | INFO     | core.image_service:_load_image_library:46 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:09:30 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:09:30 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:09:30 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:09:30 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:09:30 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:09:30 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:30 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:09:30 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:09:30 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:09:30 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:09:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:31 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:09:31 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:09:31 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:09:31 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:09:31 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:09:44 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:09:45 | INFO     | core.image_service:_load_image_library:46 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:09:46 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:09:46 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:09:46 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:09:46 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:09:46 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:09:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:46 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:09:46 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:09:46 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:09:46 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:09:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:09:47 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:09:47 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:09:47 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:09:47 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:09:47 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:10:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:10:03 | INFO     | core.image_service:_load_image_library:46 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:10:04 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:10:04 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:10:04 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:10:04 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:10:04 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:10:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:10:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:10:04 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:10:04 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:10:04 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:10:04 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:10:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:10:04 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:10:04 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:10:04 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:10:04 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:10:04 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:10:35 | INFO     | api.story:prepare_start_level:197 - 开始生成故事概要，愿望：张飞...
2025-09-26 23:10:36 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:10:36 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 883
2025-09-26 23:10:36 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整(故事+图像)生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:10:36 | INFO     | api.story:prepare_start_level:272 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:10:36 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:10:36 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '张飞'
2025-09-26 23:10:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:10:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1367
2025-09-26 23:10:39 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=833 预览='{"text": "夜色如墨，江风卷起战旗猎猎作响。张飞立于断崖边缘，铁甲上斑驳的血迹尚未干透。前方是通往曹军粮道的必经隘口，守将已布下重兵，火把连成星河。他紧握蛇矛，眼中燃着不灭的怒火——若此关不破，刘备的征途将被截断于蜀道尽头。远处传来马蹄声，一支斥候小队正疾驰而来，却在三丈外骤然停步，目光如刃般刺向他。张飞冷笑一声，踏前一步，足下碎石崩裂，仿佛整座山峦都在为他震颤。他必须在敌军合围前，撕开这道铁幕。", "choices": [{"option": "猛然跃下断崖，借藤蔓滑入敌阵腹地，以雷霆之势直取主将", "summary": "孤注一掷的突袭，以勇猛撼动局势", "effects":'
2025-09-26 23:10:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=833 预览='{"text": "夜色如墨，江风卷起战旗猎猎作响。张飞立于断崖边缘，铁甲上斑驳的血迹尚未干透。前方是通往曹军粮道的必经隘口，守将已布下重兵，火把连成星河。他紧握蛇矛，眼中燃着不灭的怒火——若此关不破，刘备的征途将被截断于蜀道尽头。远处传来马蹄声，一支斥候小队正疾驰而来，却在三丈外骤然停步，目光如刃般刺向他。张飞冷笑一'
2025-09-26 23:10:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=833 预览='{"text": "夜色如墨，江风卷起战旗猎猎作响。张飞立于断崖边缘，铁甲上斑驳的血迹尚未干透。前方是通往曹军粮道的必经隘口，守将已布下重兵，火把连成星河。他紧握蛇矛，眼中燃着不灭的怒火——若此关不破，刘备的征途将被截断于蜀道尽头。远处传来马蹄声，一支斥候小队正疾驰而来，却在三丈外骤然停步，目光如刃般刺向他。张飞冷笑一'
2025-09-26 23:10:39 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 194
2025-09-26 23:10:39 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:10:39 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 194
2025-09-26 23:10:39 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-26 23:10:39 | INFO     | core.image_storage:__init__:27 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:10:39 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，江风卷起战旗猎猎作响。张飞立于断崖边缘，铁甲上斑驳的血迹尚未干透。前方是通往曹军粮道的必经隘口，守将已布下重兵，火把连成星河。他紧握蛇矛，眼中燃着不灭的怒火——若此关不破，刘备的征途将被截断于蜀道尽头。远处传来马蹄声，一支斥候小队正疾驰而来，却在三丈外骤然停步，目光如刃般刺向他。张飞冷笑一声，踏前一步，足下碎石崩裂，仿佛整座山峦都在为他震颤。他必须在敌军合围前，撕开这道铁幕。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:10:39 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，江风卷起战旗猎...
2025-09-26 23:10:52 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:10:52 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:10:52 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899451971_428.png
2025-09-26 23:10:52 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899451971_428.png
2025-09-26 23:10:56 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_8b2bfaa49a716c75a616b1a2f1e0d14e.png (大小: 1254969 字节)
2025-09-26 23:10:56 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_8b2bfaa49a716c75a616b1a2f1e0d14e.png
2025-09-26 23:10:56 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:10:56 | INFO     | core.story_engine:start_story:448 - 新故事生成成功
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=194
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 开始为第一节故事重新生成图像: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:10:56 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 194
2025-09-26 23:10:56 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_8b2bfaa49a716c75a616b1a2f1e0d14e.png
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:84 - [预生成] 第一节图像生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, image_url=/static/generated/ai_gen_8b2bfaa49a716c75a616b1a2f1e0d14e.png
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 创建会话成功: session_id=4
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:92 - [预生成] 创建第一个节点成功: node_id=53
2025-09-26 23:10:56 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=53 depth=3
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:104 - [预生成] 已触发speculation预生成: session=4, node=53
2025-09-26 23:10:56 | INFO     | api.story:_background_generate_with_pregeneration:106 - [预生成] 完整(故事+图像)流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=4
2025-09-26 23:10:56 | DEBUG    | api.story:_background_generate_with_pregeneration:118 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:10:56 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=53
2025-09-26 23:10:56 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 猛然跃下断崖，借藤蔓滑入敌阵腹地，以雷霆之势直取主将
2025-09-26 23:10:56 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 模仿敌军号角，用喉音吹奏调令，诱骗守军自相残杀
2025-09-26 23:10:56 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 悄然点燃山林枯叶，制造浓烟与火光，引敌军误判方向
2025-09-26 23:11:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1570
2025-09-26 23:11:00 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=880 预览='{"text": "夜风如刀，割裂了敌营的寂静。张飞立于断崖边缘，铁甲在月光下泛着冷光，蛇矛斜指地面，仿佛已与山岩融为一体。远处火把摇曳，守军巡哨的脚步声渐近，三丈外那支斥候小队仍凝视着他，如鹰隼锁定猎物。他忽然仰天长啸，声震山谷，竟将敌营巡哨惊得一滞。就在这瞬间，他猛然踏地而起，如猛虎扑食般冲向隘口侧壁——那里有一道被藤蔓遮掩的旧时栈道，据传乃当年蜀道修筑者遗下的隐秘通道。他以矛尖划开藤蔓，身形如电，直坠入深谷阴影之中，身后只余一声怒吼回荡在群峰之间。", "choices": [{"option": "以战鼓节奏模仿敌军暗号，混入巡逻队中潜行", "summary": "借声音伪装身份，悄'
2025-09-26 23:11:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=880 预览='{"text": "夜风如刀，割裂了敌营的寂静。张飞立于断崖边缘，铁甲在月光下泛着冷光，蛇矛斜指地面，仿佛已与山岩融为一体。远处火把摇曳，守军巡哨的脚步声渐近，三丈外那支斥候小队仍凝视着他，如鹰隼锁定猎物。他忽然仰天长啸，声震山谷，竟将敌营巡哨惊得一滞。就在这瞬间，他猛然踏地而起，如猛虎扑食般冲向隘口侧壁——那里有一道'
2025-09-26 23:11:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=880 预览='{"text": "夜风如刀，割裂了敌营的寂静。张飞立于断崖边缘，铁甲在月光下泛着冷光，蛇矛斜指地面，仿佛已与山岩融为一体。远处火把摇曳，守军巡哨的脚步声渐近，三丈外那支斥候小队仍凝视着他，如鹰隼锁定猎物。他忽然仰天长啸，声震山谷，竟将敌营巡哨惊得一滞。就在这瞬间，他猛然踏地而起，如猛虎扑食般冲向隘口侧壁——那里有一道'
2025-09-26 23:11:00 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 219
2025-09-26 23:11:00 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:00 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 219
2025-09-26 23:11:00 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，割裂了敌营的寂静。张飞立于断崖边缘，铁甲在月光下泛着冷光，蛇矛斜指地面，仿佛已与山岩融为一体。远处火把摇曳，守军巡哨的脚步声渐近，三丈外那支斥候小队仍凝视着他，如鹰隼锁定猎物。他忽然仰天长啸，声震山谷，竟将敌营巡哨惊得一滞。就在这瞬间，他猛然踏地而起，如猛虎扑食般冲向隘口侧壁——那里有一道被藤蔓遮掩的旧时栈道，据传乃当年蜀道修筑者遗下的隐秘通道。他以矛尖划开藤蔓，身形如电，直坠入深谷阴影之中，身后只余一声怒吼回荡在群峰之间。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，割裂了敌营的寂...
2025-09-26 23:11:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1562
2025-09-26 23:11:00 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=855 预览='{"text": "夜风卷起张飞的披风，他凝视着隘口上密布的火把，如星河垂落人间。敌军哨塔间传来更鼓声，节奏分明，仿佛在丈量他的时间。他忽然仰天长啸，声震山谷，竟引得远处敌兵纷纷探头张望——那一瞬，他已踏出一步，蛇矛点地，身形如电般冲向侧翼断崖。岩壁之上，一条被藤蔓半掩的旧栈道悄然显露，那是当年蜀汉修路时遗下的秘径，如今却成了破局之机。可若走此道，必惊动山中巡哨；若不走，便只能硬闯千军万马。他眯眼望向那幽深缝隙，战意如火燎原。", "choices": [{"option": "用铁矛击碎山壁石块制造塌方，借乱声掩护自己攀爬秘径", "summary": "以破坏制造混乱，趁机突袭", "ef'
2025-09-26 23:11:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=855 预览='{"text": "夜风卷起张飞的披风，他凝视着隘口上密布的火把，如星河垂落人间。敌军哨塔间传来更鼓声，节奏分明，仿佛在丈量他的时间。他忽然仰天长啸，声震山谷，竟引得远处敌兵纷纷探头张望——那一瞬，他已踏出一步，蛇矛点地，身形如电般冲向侧翼断崖。岩壁之上，一条被藤蔓半掩的旧栈道悄然显露，那是当年蜀汉修路时遗下的秘径，如'
2025-09-26 23:11:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=855 预览='{"text": "夜风卷起张飞的披风，他凝视着隘口上密布的火把，如星河垂落人间。敌军哨塔间传来更鼓声，节奏分明，仿佛在丈量他的时间。他忽然仰天长啸，声震山谷，竟引得远处敌兵纷纷探头张望——那一瞬，他已踏出一步，蛇矛点地，身形如电般冲向侧翼断崖。岩壁之上，一条被藤蔓半掩的旧栈道悄然显露，那是当年蜀汉修路时遗下的秘径，如'
2025-09-26 23:11:00 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 205
2025-09-26 23:11:00 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:00 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 205
2025-09-26 23:11:00 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起张飞的披风，他凝视着隘口上密布的火把，如星河垂落人间。敌军哨塔间传来更鼓声，节奏分明，仿佛在丈量他的时间。他忽然仰天长啸，声震山谷，竟引得远处敌兵纷纷探头张望——那一瞬，他已踏出一步，蛇矛点地，身形如电般冲向侧翼断崖。岩壁之上，一条被藤蔓半掩的旧栈道悄然显露，那是当年蜀汉修路时遗下的秘径，如今却成了破局之机。可若走此道，必惊动山中巡哨；若不走，便只能硬闯千军万马。他眯眼望向那幽深缝隙，战意如火燎原。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起张飞的披风，他凝...
2025-09-26 23:11:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1608
2025-09-26 23:11:00 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=902 预览='{"text": "夜风如刀，割裂了江岸的寂静。张飞立于断崖边缘，铁甲在火光下泛着幽冷的光，蛇矛斜指地面，仿佛与大地同震。敌军营寨灯火通明，箭楼上的守卒来回巡哨，每一步都踏在生死的弦上。远处传来更鼓声，三更将尽，正是换防间隙最短之时。他忽然仰天长啸，声如惊雷，震得林间宿鸟四散——这并非示威，而是向天地宣告：此关必破！刹那间，他身形暴起，如猛虎扑食，直冲敌阵侧翼，足下碎石飞溅，竟似要踏穿山岩。敌兵惊觉，火把骤然转向，箭矢如雨倾泻而下。然而就在那千钧一发之际，一道黑影自暗处疾掠而出，悄然接应，仿佛早已埋伏于此。是友？是敌？还是命运的伏笔？", "choices": [{"option": "借势翻'
2025-09-26 23:11:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=902 预览='{"text": "夜风如刀，割裂了江岸的寂静。张飞立于断崖边缘，铁甲在火光下泛着幽冷的光，蛇矛斜指地面，仿佛与大地同震。敌军营寨灯火通明，箭楼上的守卒来回巡哨，每一步都踏在生死的弦上。远处传来更鼓声，三更将尽，正是换防间隙最短之时。他忽然仰天长啸，声如惊雷，震得林间宿鸟四散——这并非示威，而是向天地宣告：此关必破！刹'
2025-09-26 23:11:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=902 预览='{"text": "夜风如刀，割裂了江岸的寂静。张飞立于断崖边缘，铁甲在火光下泛着幽冷的光，蛇矛斜指地面，仿佛与大地同震。敌军营寨灯火通明，箭楼上的守卒来回巡哨，每一步都踏在生死的弦上。远处传来更鼓声，三更将尽，正是换防间隙最短之时。他忽然仰天长啸，声如惊雷，震得林间宿鸟四散——这并非示威，而是向天地宣告：此关必破！刹'
2025-09-26 23:11:00 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 260
2025-09-26 23:11:00 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:00 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 260
2025-09-26 23:11:00 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，割裂了江岸的寂静。张飞立于断崖边缘，铁甲在火光下泛着幽冷的光，蛇矛斜指地面，仿佛与大地同震。敌军营寨灯火通明，箭楼上的守卒来回巡哨，每一步都踏在生死的弦上。远处传来更鼓声，三更将尽，正是换防间隙最短之时。他忽然仰天长啸，声如惊雷，震得林间宿鸟四散——这并非示威，而是向天地宣告：此关必破！刹那间，他身形暴起，如猛虎扑食，直冲敌阵侧翼，足下碎石飞溅，竟似要踏穿山岩。敌兵惊觉，火把骤然转向，箭矢如雨倾泻而下。然而就在那千钧一发之际，一道黑影自暗处疾掠而出，悄然接应，仿佛早已埋伏于此。是友？是敌？还是命运的伏笔？. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，割裂了江岸的寂...
2025-09-26 23:11:10 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:10 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:10 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:10 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:10 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:10 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:10 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=53 choice='猛然跃下断崖，借藤蔓滑入敌阵腹地，以雷霆之势直取主将'
2025-09-26 23:11:10 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 260
2025-09-26 23:11:10 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:10 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 260
2025-09-26 23:11:10 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，割裂了江岸的寂静。张飞立于断崖边缘，铁甲在火光下泛着幽冷的光，蛇矛斜指地面，仿佛与大地同震。敌军营寨灯火通明，箭楼上的守卒来回巡哨，每一步都踏在生死的弦上。远处传来更鼓声，三更将尽，正是换防间隙最短之时。他忽然仰天长啸，声如惊雷，震得林间宿鸟四散——这并非示威，而是向天地宣告：此关必破！刹那间，他身形暴起，如猛虎扑食，直冲敌阵侧翼，足下碎石飞溅，竟似要踏穿山岩。敌兵惊觉，火把骤然转向，箭矢如雨倾泻而下。然而就在那千钧一发之际，一道黑影自暗处疾掠而出，悄然接应，仿佛早已埋伏于此。是友？是敌？还是命运的伏笔？. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:10 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，割裂了江岸的寂...
2025-09-26 23:11:10 | INFO     | api.story:start_new_story:302 - 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 张飞
2025-09-26 23:11:10 | INFO     | api.story:start_new_story:317 - [预生成] 命中缓存，使用预生成的会话和节点: session=4, node=53
2025-09-26 23:11:10 | INFO     | api.story:start_new_story:377 - 新故事生成成功
2025-09-26 23:11:10 | INFO     | api.story:start_new_story:384 - 使用预生成故事，跳过speculation触发: session=4, node=53
2025-09-26 23:11:11 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 772
2025-09-26 23:11:11 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:11 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899471472_477.png
2025-09-26 23:11:11 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899471472_477.png
2025-09-26 23:11:12 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:11:12 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:12 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899472379_601.png
2025-09-26 23:11:12 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899472379_601.png
2025-09-26 23:11:15 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_a79539864a0ada3f5d1d192d014c1a1a.png (大小: 1343086 字节)
2025-09-26 23:11:15 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_a79539864a0ada3f5d1d192d014c1a1a.png
2025-09-26 23:11:15 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:15 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:15 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=53 choice='悄然点燃山林枯叶，制造浓烟与火光，引敌军误判方向'
2025-09-26 23:11:15 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 205
2025-09-26 23:11:15 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_a79539864a0ada3f5d1d192d014c1a1a.png
2025-09-26 23:11:15 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=53 choice='悄然点燃山林枯叶，制造浓烟与火光，引敌军误判方向', image_url=/static/generated/ai_gen_a79539864a0ada3f5d1d192d014c1a1a.png
2025-09-26 23:11:15 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=54 parent=53 choice='悄然点燃山林枯叶，制造浓烟与火光，引敌军误判方向'
2025-09-26 23:11:15 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=54 depth=2
2025-09-26 23:11:15 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=54 completed, triggered next level depth=2
2025-09-26 23:11:15 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=54
2025-09-26 23:11:15 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 用铁矛击碎山壁石块制造塌方，借乱声掩护自己攀爬秘径
2025-09-26 23:11:15 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 模仿敌军口令，假扮斥候混入换防队伍
2025-09-26 23:11:15 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 点燃一支火把，故意引燃草堆吸引注意力，趁机从后山绕行
2025-09-26 23:11:18 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_c8778b00fcc49b826e9741222c7a3597.png (大小: 1322545 字节)
2025-09-26 23:11:18 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_c8778b00fcc49b826e9741222c7a3597.png
2025-09-26 23:11:18 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:18 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:18 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=53 choice='模仿敌军号角，用喉音吹奏调令，诱骗守军自相残杀'
2025-09-26 23:11:18 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 219
2025-09-26 23:11:18 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_c8778b00fcc49b826e9741222c7a3597.png
2025-09-26 23:11:18 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=53 choice='模仿敌军号角，用喉音吹奏调令，诱骗守军自相残杀', image_url=/static/generated/ai_gen_c8778b00fcc49b826e9741222c7a3597.png
2025-09-26 23:11:18 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=55 parent=53 choice='模仿敌军号角，用喉音吹奏调令，诱骗守军自相残杀'
2025-09-26 23:11:18 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=55 depth=2
2025-09-26 23:11:18 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=55 completed, triggered next level depth=2
2025-09-26 23:11:18 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=55
2025-09-26 23:11:18 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 以战鼓节奏模仿敌军暗号，混入巡逻队中潜行
2025-09-26 23:11:18 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 点燃火把引燃山林，制造混乱趁机突袭主门
2025-09-26 23:11:18 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 攀上绝壁，从上方投掷石块扰乱守军视线，再伺机跃下
2025-09-26 23:11:19 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:19 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1762
2025-09-26 23:11:19 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=858 预览='{"text": "张飞低伏身形，将火折子悄然掷入崖壁下堆积的枯叶堆。刹那间，浓烟如黑蛇腾起，火舌舔舐着干裂的枝桠，噼啪作响。山风骤然助燃，火光映红了半边天际，仿佛整座山谷都在燃烧。远处敌营顿时骚动，号角声急促响起，守军纷纷向火源方向调兵遣将。张飞却已借着烟幕掩护，沿着岩缝疾行，铁靴踏碎石砾，如鬼魅穿行于暗影之间。他听见马蹄声由远及近，那是敌军主力正朝错误的方向奔袭而去。然而，火势蔓延过快，山林深处传来隐隐爆裂声——若引燃松脂林，可能引发山崩，反噬己方退路。", "choices": [{"option": "迅速攀上断崖顶端，从高处俯瞰敌军调动，寻找真正薄弱点", "summary": "借'
2025-09-26 23:11:19 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=858 预览='{"text": "张飞低伏身形，将火折子悄然掷入崖壁下堆积的枯叶堆。刹那间，浓烟如黑蛇腾起，火舌舔舐着干裂的枝桠，噼啪作响。山风骤然助燃，火光映红了半边天际，仿佛整座山谷都在燃烧。远处敌营顿时骚动，号角声急促响起，守军纷纷向火源方向调兵遣将。张飞却已借着烟幕掩护，沿着岩缝疾行，铁靴踏碎石砾，如鬼魅穿行于暗影之间。他听'
2025-09-26 23:11:19 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=858 预览='{"text": "张飞低伏身形，将火折子悄然掷入崖壁下堆积的枯叶堆。刹那间，浓烟如黑蛇腾起，火舌舔舐着干裂的枝桠，噼啪作响。山风骤然助燃，火光映红了半边天际，仿佛整座山谷都在燃烧。远处敌营顿时骚动，号角声急促响起，守军纷纷向火源方向调兵遣将。张飞却已借着烟幕掩护，沿着岩缝疾行，铁靴踏碎石砾，如鬼魅穿行于暗影之间。他听'
2025-09-26 23:11:19 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 221
2025-09-26 23:11:19 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:19 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 221
2025-09-26 23:11:19 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞低伏身形，将火折子悄然掷入崖壁下堆积的枯叶堆。刹那间，浓烟如黑蛇腾起，火舌舔舐着干裂的枝桠，噼啪作响。山风骤然助燃，火光映红了半边天际，仿佛整座山谷都在燃烧。远处敌营顿时骚动，号角声急促响起，守军纷纷向火源方向调兵遣将。张飞却已借着烟幕掩护，沿着岩缝疾行，铁靴踏碎石砾，如鬼魅穿行于暗影之间。他听见马蹄声由远及近，那是敌军主力正朝错误的方向奔袭而去。然而，火势蔓延过快，山林深处传来隐隐爆裂声——若引燃松脂林，可能引发山崩，反噬己方退路。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:19 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞低伏身形，将火折子悄...
2025-09-26 23:11:19 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:19 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1739
2025-09-26 23:11:19 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=819 预览='{"text": "张飞猛然抽出腰间火折，点燃一丛枯叶堆。烈焰骤然腾起，浓烟如黑龙般卷向夜空，火光映红了半边崖壁。山风推着烟柱扑向敌军主寨方向，哨塔上顿时响起急促的铜铃声——‘东侧有火！’‘是伏兵！’喊声四起，守军纷纷调转旗鼓，箭矢乱射向烟雾弥漫的远处。张飞却已借着混乱的掩护，悄然滑下断崖，蛇矛轻点岩壁，身形如影掠入那条幽暗的旧栈道。火光与喧嚣成了他最锋利的盾牌，而真正的杀机，正从山腹深处悄然逼近。", "choices": [{"option": "沿着栈道疾行，趁敌军调防时突袭粮仓", "summary": "借势而动，直取敌方命脉", "effects": {"delta_progres'
2025-09-26 23:11:19 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=819 预览='{"text": "张飞猛然抽出腰间火折，点燃一丛枯叶堆。烈焰骤然腾起，浓烟如黑龙般卷向夜空，火光映红了半边崖壁。山风推着烟柱扑向敌军主寨方向，哨塔上顿时响起急促的铜铃声——‘东侧有火！’‘是伏兵！’喊声四起，守军纷纷调转旗鼓，箭矢乱射向烟雾弥漫的远处。张飞却已借着混乱的掩护，悄然滑下断崖，蛇矛轻点岩壁，身形如影掠入那'
2025-09-26 23:11:19 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=819 预览='{"text": "张飞猛然抽出腰间火折，点燃一丛枯叶堆。烈焰骤然腾起，浓烟如黑龙般卷向夜空，火光映红了半边崖壁。山风推着烟柱扑向敌军主寨方向，哨塔上顿时响起急促的铜铃声——‘东侧有火！’‘是伏兵！’喊声四起，守军纷纷调转旗鼓，箭矢乱射向烟雾弥漫的远处。张飞却已借着混乱的掩护，悄然滑下断崖，蛇矛轻点岩壁，身形如影掠入那'
2025-09-26 23:11:19 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 23:11:19 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:19 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 191
2025-09-26 23:11:19 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然抽出腰间火折，点燃一丛枯叶堆。烈焰骤然腾起，浓烟如黑龙般卷向夜空，火光映红了半边崖壁。山风推着烟柱扑向敌军主寨方向，哨塔上顿时响起急促的铜铃声——‘东侧有火！’‘是伏兵！’喊声四起，守军纷纷调转旗鼓，箭矢乱射向烟雾弥漫的远处。张飞却已借着混乱的掩护，悄然滑下断崖，蛇矛轻点岩壁，身形如影掠入那条幽暗的旧栈道。火光与喧嚣成了他最锋利的盾牌，而真正的杀机，正从山腹深处悄然逼近。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:19 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然抽出腰间火折，点...
2025-09-26 23:11:19 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:19 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1753
2025-09-26 23:11:19 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=843 预览='{"text": "张飞低伏身形，从腰间抽出火折子，指尖轻触枯叶堆。火苗舔舐而起，迅速蔓延成一片橘红的烟幕，浓烟如巨蟒般腾空而起，裹挟着火星直冲夜空。远处敌军哨塔顿时骚动，火把乱舞，人声鼎沸——他们以为主攻方向在南翼山口。张飞却已借烟雾掩护，悄然潜入断崖侧壁的藤蔓密林，蛇矛点地，每一步都踏在岩石与腐叶的缝隙之间，如同幽影游走于生死边缘。山风忽转，吹散了部分烟尘，他猛然抬头，发现一队巡哨正朝这边疾驰而来，刀锋映着火光，寒意刺骨。", "choices": [{"option": "以铁甲反光诱敌，引其误判为埋伏主力", "summary": "以巧计制造假象，扰乱敌军判断", "effects"'
2025-09-26 23:11:19 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=843 预览='{"text": "张飞低伏身形，从腰间抽出火折子，指尖轻触枯叶堆。火苗舔舐而起，迅速蔓延成一片橘红的烟幕，浓烟如巨蟒般腾空而起，裹挟着火星直冲夜空。远处敌军哨塔顿时骚动，火把乱舞，人声鼎沸——他们以为主攻方向在南翼山口。张飞却已借烟雾掩护，悄然潜入断崖侧壁的藤蔓密林，蛇矛点地，每一步都踏在岩石与腐叶的缝隙之间，如同幽'
2025-09-26 23:11:19 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=843 预览='{"text": "张飞低伏身形，从腰间抽出火折子，指尖轻触枯叶堆。火苗舔舐而起，迅速蔓延成一片橘红的烟幕，浓烟如巨蟒般腾空而起，裹挟着火星直冲夜空。远处敌军哨塔顿时骚动，火把乱舞，人声鼎沸——他们以为主攻方向在南翼山口。张飞却已借烟雾掩护，悄然潜入断崖侧壁的藤蔓密林，蛇矛点地，每一步都踏在岩石与腐叶的缝隙之间，如同幽'
2025-09-26 23:11:19 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 205
2025-09-26 23:11:19 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:19 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 205
2025-09-26 23:11:19 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞低伏身形，从腰间抽出火折子，指尖轻触枯叶堆。火苗舔舐而起，迅速蔓延成一片橘红的烟幕，浓烟如巨蟒般腾空而起，裹挟着火星直冲夜空。远处敌军哨塔顿时骚动，火把乱舞，人声鼎沸——他们以为主攻方向在南翼山口。张飞却已借烟雾掩护，悄然潜入断崖侧壁的藤蔓密林，蛇矛点地，每一步都踏在岩石与腐叶的缝隙之间，如同幽影游走于生死边缘。山风忽转，吹散了部分烟尘，他猛然抬头，发现一队巡哨正朝这边疾驰而来，刀锋映着火光，寒意刺骨。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:19 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞低伏身形，从腰间抽出...
2025-09-26 23:11:21 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:21 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:21 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:21 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:21 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:21 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=53 choice='猛然跃下断崖，借藤蔓滑入敌阵腹地，以雷霆之势直取主将', image_url=/static/error_placeholder.png
2025-09-26 23:11:21 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=56 parent=53 choice='猛然跃下断崖，借藤蔓滑入敌阵腹地，以雷霆之势直取主将'
2025-09-26 23:11:21 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=56 depth=2
2025-09-26 23:11:21 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=56 completed, triggered next level depth=2
2025-09-26 23:11:21 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=56
2025-09-26 23:11:21 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 借势翻滚入敌阵，以血肉之躯撞开第一道拒马
2025-09-26 23:11:21 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 突然收声，单膝跪地假意投降，引诱守将出营探视
2025-09-26 23:11:21 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 反手将蛇矛插入崖壁，借力跃至半空，直扑敌楼顶端
2025-09-26 23:11:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1802
2025-09-26 23:11:22 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=872 预览='{"text": "张飞闭目凝神，喉间滚动如雷鸣低伏。他猛然吸气，以胸腔震颤发出一声尖锐的号角声——那调令音节竟与敌军传令官如出一辙，连尾音的颤音都分毫不差。山风骤然停歇，远处守军营帐中传来一阵骚动：‘三更换防！右翼松懈！’火把摇曳，巡哨开始调转方向，彼此对峙，刀锋相向。张飞嘴角微扬，眼中闪过狡黠寒光，正欲趁乱冲入隘口，却忽闻谷底传来一声异响——那不是人声，而是一头被铁链锁住的猛虎，正仰首咆哮，似在回应他的号角。天地间，仿佛有某种古老的血脉在共鸣。", "choices": [{"option": "借猛虎吼声扰乱敌军阵型，趁机突袭隘口主道", "summary": "以兽威为刃，搅乱敌军部署'
2025-09-26 23:11:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=872 预览='{"text": "张飞闭目凝神，喉间滚动如雷鸣低伏。他猛然吸气，以胸腔震颤发出一声尖锐的号角声——那调令音节竟与敌军传令官如出一辙，连尾音的颤音都分毫不差。山风骤然停歇，远处守军营帐中传来一阵骚动：‘三更换防！右翼松懈！’火把摇曳，巡哨开始调转方向，彼此对峙，刀锋相向。张飞嘴角微扬，眼中闪过狡黠寒光，正欲趁乱冲入隘口'
2025-09-26 23:11:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=872 预览='{"text": "张飞闭目凝神，喉间滚动如雷鸣低伏。他猛然吸气，以胸腔震颤发出一声尖锐的号角声——那调令音节竟与敌军传令官如出一辙，连尾音的颤音都分毫不差。山风骤然停歇，远处守军营帐中传来一阵骚动：‘三更换防！右翼松懈！’火把摇曳，巡哨开始调转方向，彼此对峙，刀锋相向。张飞嘴角微扬，眼中闪过狡黠寒光，正欲趁乱冲入隘口'
2025-09-26 23:11:22 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 216
2025-09-26 23:11:22 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:22 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 216
2025-09-26 23:11:22 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞闭目凝神，喉间滚动如雷鸣低伏。他猛然吸气，以胸腔震颤发出一声尖锐的号角声——那调令音节竟与敌军传令官如出一辙，连尾音的颤音都分毫不差。山风骤然停歇，远处守军营帐中传来一阵骚动：‘三更换防！右翼松懈！’火把摇曳，巡哨开始调转方向，彼此对峙，刀锋相向。张飞嘴角微扬，眼中闪过狡黠寒光，正欲趁乱冲入隘口，却忽闻谷底传来一声异响——那不是人声，而是一头被铁链锁住的猛虎，正仰首咆哮，似在回应他的号角。天地间，仿佛有某种古老的血脉在共鸣。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞闭目凝神，喉间滚动如...
2025-09-26 23:11:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1830
2025-09-26 23:11:22 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=917 预览='{"text": "张飞伏在断崖边缘的乱石堆中，喉间滚动着低沉的呜咽。他闭目凝神，将气息压至极致，随后猛然张口——一声凄厉如狼嗥的号角骤然撕裂夜空，音调扭曲却精准复刻了曹军夜间传令的节律。远处敌营瞬间骚动，火把晃动，三支巡哨队竟朝不同方向奔去，彼此呼喝着‘左翼有变’‘右翼受袭’，刀剑相击声在谷中回荡。张飞瞳孔微缩，已知计得逞，正欲起身，却见一队精锐斥候从侧翼疾驰而来，火把映出铁甲上‘虎豹骑’的纹章——这并非普通守卒，而是曹操亲卫！他迅速伏低身形，蛇矛紧握，指尖渗出血痕，唯有静待下一波风暴降临。", "choices": [{"option": "借势翻滚突袭，以血雾遮蔽视线，趁乱刺杀领头将官"'
2025-09-26 23:11:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=917 预览='{"text": "张飞伏在断崖边缘的乱石堆中，喉间滚动着低沉的呜咽。他闭目凝神，将气息压至极致，随后猛然张口——一声凄厉如狼嗥的号角骤然撕裂夜空，音调扭曲却精准复刻了曹军夜间传令的节律。远处敌营瞬间骚动，火把晃动，三支巡哨队竟朝不同方向奔去，彼此呼喝着‘左翼有变’‘右翼受袭’，刀剑相击声在谷中回荡。张飞瞳孔微缩，已知'
2025-09-26 23:11:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=917 预览='{"text": "张飞伏在断崖边缘的乱石堆中，喉间滚动着低沉的呜咽。他闭目凝神，将气息压至极致，随后猛然张口——一声凄厉如狼嗥的号角骤然撕裂夜空，音调扭曲却精准复刻了曹军夜间传令的节律。远处敌营瞬间骚动，火把晃动，三支巡哨队竟朝不同方向奔去，彼此呼喝着‘左翼有变’‘右翼受袭’，刀剑相击声在谷中回荡。张飞瞳孔微缩，已知'
2025-09-26 23:11:22 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 239
2025-09-26 23:11:22 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:22 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 239
2025-09-26 23:11:22 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的乱石堆中，喉间滚动着低沉的呜咽。他闭目凝神，将气息压至极致，随后猛然张口——一声凄厉如狼嗥的号角骤然撕裂夜空，音调扭曲却精准复刻了曹军夜间传令的节律。远处敌营瞬间骚动，火把晃动，三支巡哨队竟朝不同方向奔去，彼此呼喝着‘左翼有变’‘右翼受袭’，刀剑相击声在谷中回荡。张飞瞳孔微缩，已知计得逞，正欲起身，却见一队精锐斥候从侧翼疾驰而来，火把映出铁甲上‘虎豹骑’的纹章——这并非普通守卒，而是曹操亲卫！他迅速伏低身形，蛇矛紧握，指尖渗出血痕，唯有静待下一波风暴降临。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的乱石堆...
2025-09-26 23:11:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1823
2025-09-26 23:11:22 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=906 预览='{"text": "张飞伏在断崖边缘的岩隙中，喉间滚动着低沉的呜咽，竟真以喉音吹出一串扭曲的军号调令——那声音如鬼魅穿风，竟与敌营传令兵的哨音几无二致。远处守军闻声而动，火把忽明忽暗，巡哨队伍开始混乱对峙，彼此举矛相向，喊杀声在夜雾中炸开。他咬破舌尖，将血腥味压入喉底，继续嘶鸣，仿佛要将整支军队的耳膜撕裂。就在这自毁式号角的余音未散之际，一道身影从侧翼踉跄跌出，竟是敌方斥候队长，面露惊疑，正欲举旗示警——张飞瞳孔骤缩，蛇矛已悄然横扫而出，无声无息，血光溅落于石缝之间。", "choices": [{"option": "借乱势突袭斥候队长，夺其令牌直闯主寨", "summary": "趁敌自相'
2025-09-26 23:11:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=906 预览='{"text": "张飞伏在断崖边缘的岩隙中，喉间滚动着低沉的呜咽，竟真以喉音吹出一串扭曲的军号调令——那声音如鬼魅穿风，竟与敌营传令兵的哨音几无二致。远处守军闻声而动，火把忽明忽暗，巡哨队伍开始混乱对峙，彼此举矛相向，喊杀声在夜雾中炸开。他咬破舌尖，将血腥味压入喉底，继续嘶鸣，仿佛要将整支军队的耳膜撕裂。就在这自毁式'
2025-09-26 23:11:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=906 预览='{"text": "张飞伏在断崖边缘的岩隙中，喉间滚动着低沉的呜咽，竟真以喉音吹出一串扭曲的军号调令——那声音如鬼魅穿风，竟与敌营传令兵的哨音几无二致。远处守军闻声而动，火把忽明忽暗，巡哨队伍开始混乱对峙，彼此举矛相向，喊杀声在夜雾中炸开。他咬破舌尖，将血腥味压入喉底，继续嘶鸣，仿佛要将整支军队的耳膜撕裂。就在这自毁式'
2025-09-26 23:11:22 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 226
2025-09-26 23:11:22 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:22 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 226
2025-09-26 23:11:22 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的岩隙中，喉间滚动着低沉的呜咽，竟真以喉音吹出一串扭曲的军号调令——那声音如鬼魅穿风，竟与敌营传令兵的哨音几无二致。远处守军闻声而动，火把忽明忽暗，巡哨队伍开始混乱对峙，彼此举矛相向，喊杀声在夜雾中炸开。他咬破舌尖，将血腥味压入喉底，继续嘶鸣，仿佛要将整支军队的耳膜撕裂。就在这自毁式号角的余音未散之际，一道身影从侧翼踉跄跌出，竟是敌方斥候队长，面露惊疑，正欲举旗示警——张飞瞳孔骤缩，蛇矛已悄然横扫而出，无声无息，血光溅落于石缝之间。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的岩隙中...
2025-09-26 23:11:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1864
2025-09-26 23:11:25 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=888 预览='{"text": "张飞猛然跃下断崖，铁甲与岩壁剧烈摩擦，火星四溅。藤蔓在掌心撕裂，血丝顺着蛇矛滴落江面，却未让他迟疑半分。借着千钧坠势，他如黑豹般翻滚入敌阵腹地，瞬间扑向主将所在的中军帐。火光映照下，他怒目圆睁，咆哮震天，矛尖直指帐内那道披金戴银的身影。守卫惊乱，箭矢纷飞，但张飞已如雷霆入网，一击破帐，剑影横扫，刀光裂空——整个营寨仿佛被撕开一道血口。然而就在他即将擒获主将之际，帐外传来急促马蹄，一支精锐铁骑正自暗处疾驰而来，矛尖寒光凛冽，直指他的后心。", "choices": [{"option": "反手掷出蛇矛，借力腾空翻滚，引敌骑兵冲入己方埋伏圈", "summary": "以攻为'
2025-09-26 23:11:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=888 预览='{"text": "张飞猛然跃下断崖，铁甲与岩壁剧烈摩擦，火星四溅。藤蔓在掌心撕裂，血丝顺着蛇矛滴落江面，却未让他迟疑半分。借着千钧坠势，他如黑豹般翻滚入敌阵腹地，瞬间扑向主将所在的中军帐。火光映照下，他怒目圆睁，咆哮震天，矛尖直指帐内那道披金戴银的身影。守卫惊乱，箭矢纷飞，但张飞已如雷霆入网，一击破帐，剑影横扫，刀光'
2025-09-26 23:11:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=888 预览='{"text": "张飞猛然跃下断崖，铁甲与岩壁剧烈摩擦，火星四溅。藤蔓在掌心撕裂，血丝顺着蛇矛滴落江面，却未让他迟疑半分。借着千钧坠势，他如黑豹般翻滚入敌阵腹地，瞬间扑向主将所在的中军帐。火光映照下，他怒目圆睁，咆哮震天，矛尖直指帐内那道披金戴银的身影。守卫惊乱，箭矢纷飞，但张飞已如雷霆入网，一击破帐，剑影横扫，刀光'
2025-09-26 23:11:25 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 220
2025-09-26 23:11:25 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:25 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 220
2025-09-26 23:11:25 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然跃下断崖，铁甲与岩壁剧烈摩擦，火星四溅。藤蔓在掌心撕裂，血丝顺着蛇矛滴落江面，却未让他迟疑半分。借着千钧坠势，他如黑豹般翻滚入敌阵腹地，瞬间扑向主将所在的中军帐。火光映照下，他怒目圆睁，咆哮震天，矛尖直指帐内那道披金戴银的身影。守卫惊乱，箭矢纷飞，但张飞已如雷霆入网，一击破帐，剑影横扫，刀光裂空——整个营寨仿佛被撕开一道血口。然而就在他即将擒获主将之际，帐外传来急促马蹄，一支精锐铁骑正自暗处疾驰而来，矛尖寒光凛冽，直指他的后心。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然跃下断崖，铁甲与...
2025-09-26 23:11:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1810
2025-09-26 23:11:25 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=841 预览='{"text": "张飞纵身跃下断崖，铁甲与岩石碰撞迸出火星，藤蔓如活蛇般缠绕而下，将他稳稳垂入敌阵腹地。夜风呼啸，火光在岩壁间投下扭曲的影，他落地瞬间反手一撑，蛇矛破空刺向最近的哨塔木桩，轰然炸裂！守卒惊叫四散，火把翻滚如星坠。他借势腾跃，身形如鬼魅穿行于帐篷之间，每一步都踏碎寂静。远处主将营帐的帘幕微动，一道身影正凝视着这突如其来的风暴。张飞嘴角扬起，眼中战意如焚——他已听见那重甲之下，心跳的节拍。", "choices": [{"option": "佯装敌军斥候，混入主将议事帐中探听虚实", "summary": "以假乱真，潜伏于敌方核心决策圈", "effects": {"delta'
2025-09-26 23:11:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=841 预览='{"text": "张飞纵身跃下断崖，铁甲与岩石碰撞迸出火星，藤蔓如活蛇般缠绕而下，将他稳稳垂入敌阵腹地。夜风呼啸，火光在岩壁间投下扭曲的影，他落地瞬间反手一撑，蛇矛破空刺向最近的哨塔木桩，轰然炸裂！守卒惊叫四散，火把翻滚如星坠。他借势腾跃，身形如鬼魅穿行于帐篷之间，每一步都踏碎寂静。远处主将营帐的帘幕微动，一道身影正'
2025-09-26 23:11:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=841 预览='{"text": "张飞纵身跃下断崖，铁甲与岩石碰撞迸出火星，藤蔓如活蛇般缠绕而下，将他稳稳垂入敌阵腹地。夜风呼啸，火光在岩壁间投下扭曲的影，他落地瞬间反手一撑，蛇矛破空刺向最近的哨塔木桩，轰然炸裂！守卒惊叫四散，火把翻滚如星坠。他借势腾跃，身形如鬼魅穿行于帐篷之间，每一步都踏碎寂静。远处主将营帐的帘幕微动，一道身影正'
2025-09-26 23:11:25 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 193
2025-09-26 23:11:25 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:25 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 193
2025-09-26 23:11:25 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞纵身跃下断崖，铁甲与岩石碰撞迸出火星，藤蔓如活蛇般缠绕而下，将他稳稳垂入敌阵腹地。夜风呼啸，火光在岩壁间投下扭曲的影，他落地瞬间反手一撑，蛇矛破空刺向最近的哨塔木桩，轰然炸裂！守卒惊叫四散，火把翻滚如星坠。他借势腾跃，身形如鬼魅穿行于帐篷之间，每一步都踏碎寂静。远处主将营帐的帘幕微动，一道身影正凝视着这突如其来的风暴。张飞嘴角扬起，眼中战意如焚——他已听见那重甲之下，心跳的节拍。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞纵身跃下断崖，铁甲与...
2025-09-26 23:11:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:11:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1880
2025-09-26 23:11:25 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=914 预览='{"text": "张飞猛然跃下断崖，铁甲与岩壁摩擦迸出火星，藤蔓在掌心撕裂血痕仍死死攥紧。他如黑豹般借力滑坠，身形在半空翻转，蛇矛破风而出，刺穿一名正欲举火的守卒咽喉。落地瞬间，他单膝跪地，震得地面微颤，敌阵侧翼的哨塔骤然警铃大作。火光映照下，他甩去额前血丝，目光如刀锁定主将所在的中军帐——那顶绣有‘曹’字金纹的帅旗正随风猎猎作响。他踏着尸首残肢疾冲，每一步都踏碎敌兵的梦魇。然而就在距帅帐三十步时，一道暗影自帐后掠出，手持双刃，竟与他同为猛将之姿！两人目光相撞，杀意如雷贯耳——是敌？还是另一名被命运推至绝境的孤勇者？", "choices": [{"option": "怒吼着迎向那道黑影，以'
2025-09-26 23:11:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=914 预览='{"text": "张飞猛然跃下断崖，铁甲与岩壁摩擦迸出火星，藤蔓在掌心撕裂血痕仍死死攥紧。他如黑豹般借力滑坠，身形在半空翻转，蛇矛破风而出，刺穿一名正欲举火的守卒咽喉。落地瞬间，他单膝跪地，震得地面微颤，敌阵侧翼的哨塔骤然警铃大作。火光映照下，他甩去额前血丝，目光如刀锁定主将所在的中军帐——那顶绣有‘曹’字金纹的帅旗'
2025-09-26 23:11:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=914 预览='{"text": "张飞猛然跃下断崖，铁甲与岩壁摩擦迸出火星，藤蔓在掌心撕裂血痕仍死死攥紧。他如黑豹般借力滑坠，身形在半空翻转，蛇矛破风而出，刺穿一名正欲举火的守卒咽喉。落地瞬间，他单膝跪地，震得地面微颤，敌阵侧翼的哨塔骤然警铃大作。火光映照下，他甩去额前血丝，目光如刀锁定主将所在的中军帐——那顶绣有‘曹’字金纹的帅旗'
2025-09-26 23:11:25 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 252
2025-09-26 23:11:25 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:25 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 252
2025-09-26 23:11:25 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然跃下断崖，铁甲与岩壁摩擦迸出火星，藤蔓在掌心撕裂血痕仍死死攥紧。他如黑豹般借力滑坠，身形在半空翻转，蛇矛破风而出，刺穿一名正欲举火的守卒咽喉。落地瞬间，他单膝跪地，震得地面微颤，敌阵侧翼的哨塔骤然警铃大作。火光映照下，他甩去额前血丝，目光如刀锁定主将所在的中军帐——那顶绣有‘曹’字金纹的帅旗正随风猎猎作响。他踏着尸首残肢疾冲，每一步都踏碎敌兵的梦魇。然而就在距帅帐三十步时，一道暗影自帐后掠出，手持双刃，竟与他同为猛将之姿！两人目光相撞，杀意如雷贯耳——是敌？还是另一名被命运推至绝境的孤勇者？. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然跃下断崖，铁甲与...
2025-09-26 23:11:30 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:11:30 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:30 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899490408_946.png
2025-09-26 23:11:30 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899490408_946.png
2025-09-26 23:11:32 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:32 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:32 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:32 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:32 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:32 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:32 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=55 choice='攀上绝壁，从上方投掷石块扰乱守军视线，再伺机跃下'
2025-09-26 23:11:32 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 226
2025-09-26 23:11:32 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:32 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 226
2025-09-26 23:11:32 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的岩隙中，喉间滚动着低沉的呜咽，竟真以喉音吹出一串扭曲的军号调令——那声音如鬼魅穿风，竟与敌营传令兵的哨音几无二致。远处守军闻声而动，火把忽明忽暗，巡哨队伍开始混乱对峙，彼此举矛相向，喊杀声在夜雾中炸开。他咬破舌尖，将血腥味压入喉底，继续嘶鸣，仿佛要将整支军队的耳膜撕裂。就在这自毁式号角的余音未散之际，一道身影从侧翼踉跄跌出，竟是敌方斥候队长，面露惊疑，正欲举旗示警——张飞瞳孔骤缩，蛇矛已悄然横扫而出，无声无息，血光溅落于石缝之间。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:32 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的岩隙中...
2025-09-26 23:11:33 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 750
2025-09-26 23:11:33 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:33 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899493118_774.png
2025-09-26 23:11:33 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899493118_774.png
2025-09-26 23:11:34 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 758
2025-09-26 23:11:34 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:34 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899494097_593.png
2025-09-26 23:11:34 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899494097_593.png
2025-09-26 23:11:36 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:36 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:36 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:36 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:36 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:36 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:36 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=56 choice='借势翻滚入敌阵，以血肉之躯撞开第一道拒马'
2025-09-26 23:11:36 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 220
2025-09-26 23:11:36 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:36 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 220
2025-09-26 23:11:36 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然跃下断崖，铁甲与岩壁剧烈摩擦，火星四溅。藤蔓在掌心撕裂，血丝顺着蛇矛滴落江面，却未让他迟疑半分。借着千钧坠势，他如黑豹般翻滚入敌阵腹地，瞬间扑向主将所在的中军帐。火光映照下，他怒目圆睁，咆哮震天，矛尖直指帐内那道披金戴银的身影。守卫惊乱，箭矢纷飞，但张飞已如雷霆入网，一击破帐，剑影横扫，刀光裂空——整个营寨仿佛被撕开一道血口。然而就在他即将擒获主将之际，帐外传来急促马蹄，一支精锐铁骑正自暗处疾驰而来，矛尖寒光凛冽，直指他的后心。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:36 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞猛然跃下断崖，铁甲与...
2025-09-26 23:11:36 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_b4883ff76357f8ead23cf20e8e583232.png (大小: 1614559 字节)
2025-09-26 23:11:36 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_b4883ff76357f8ead23cf20e8e583232.png
2025-09-26 23:11:36 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:36 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:36 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=54 choice='模仿敌军口令，假扮斥候混入换防队伍'
2025-09-26 23:11:36 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 221
2025-09-26 23:11:36 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_b4883ff76357f8ead23cf20e8e583232.png
2025-09-26 23:11:36 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=54 choice='模仿敌军口令，假扮斥候混入换防队伍', image_url=/static/generated/ai_gen_b4883ff76357f8ead23cf20e8e583232.png
2025-09-26 23:11:36 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=57 parent=54 choice='模仿敌军口令，假扮斥候混入换防队伍'
2025-09-26 23:11:36 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=57 depth=1
2025-09-26 23:11:36 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=57 completed, triggered next level depth=1
2025-09-26 23:11:36 | INFO     | core.speculation:_run_pipeline:98 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=4 node=57
2025-09-26 23:11:38 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_bbbac0708a21e2f02e9848eb2731c47b.png (大小: 1367972 字节)
2025-09-26 23:11:38 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_bbbac0708a21e2f02e9848eb2731c47b.png
2025-09-26 23:11:38 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:38 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:38 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=54 choice='用铁矛击碎山壁石块制造塌方，借乱声掩护自己攀爬秘径'
2025-09-26 23:11:38 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 191
2025-09-26 23:11:38 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_bbbac0708a21e2f02e9848eb2731c47b.png
2025-09-26 23:11:38 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=54 choice='用铁矛击碎山壁石块制造塌方，借乱声掩护自己攀爬秘径', image_url=/static/generated/ai_gen_bbbac0708a21e2f02e9848eb2731c47b.png
2025-09-26 23:11:38 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=58 parent=54 choice='用铁矛击碎山壁石块制造塌方，借乱声掩护自己攀爬秘径'
2025-09-26 23:11:38 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=58 depth=1
2025-09-26 23:11:38 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=58 completed, triggered next level depth=1
2025-09-26 23:11:39 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_56e4a86c06fd362e6d3c806bbca6532a.png (大小: 1378944 字节)
2025-09-26 23:11:39 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_56e4a86c06fd362e6d3c806bbca6532a.png
2025-09-26 23:11:39 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:39 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:39 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=55 choice='以战鼓节奏模仿敌军暗号，混入巡逻队中潜行'
2025-09-26 23:11:39 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 216
2025-09-26 23:11:39 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_56e4a86c06fd362e6d3c806bbca6532a.png
2025-09-26 23:11:39 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=55 choice='以战鼓节奏模仿敌军暗号，混入巡逻队中潜行', image_url=/static/generated/ai_gen_56e4a86c06fd362e6d3c806bbca6532a.png
2025-09-26 23:11:39 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=59 parent=55 choice='以战鼓节奏模仿敌军暗号，混入巡逻队中潜行'
2025-09-26 23:11:39 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=59 depth=1
2025-09-26 23:11:39 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=59 completed, triggered next level depth=1
2025-09-26 23:11:39 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 785
2025-09-26 23:11:39 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:39 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899499219_531.png
2025-09-26 23:11:39 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899499219_531.png
2025-09-26 23:11:40 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:40 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:40 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:40 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:40 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:40 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:40 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=55 choice='点燃火把引燃山林，制造混乱趁机突袭主门'
2025-09-26 23:11:40 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 239
2025-09-26 23:11:40 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:11:40 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 239
2025-09-26 23:11:40 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的乱石堆中，喉间滚动着低沉的呜咽。他闭目凝神，将气息压至极致，随后猛然张口——一声凄厉如狼嗥的号角骤然撕裂夜空，音调扭曲却精准复刻了曹军夜间传令的节律。远处敌营瞬间骚动，火把晃动，三支巡哨队竟朝不同方向奔去，彼此呼喝着‘左翼有变’‘右翼受袭’，刀剑相击声在谷中回荡。张飞瞳孔微缩，已知计得逞，正欲起身，却见一队精锐斥候从侧翼疾驰而来，火把映出铁甲上‘虎豹骑’的纹章——这并非普通守卒，而是曹操亲卫！他迅速伏低身形，蛇矛紧握，指尖渗出血痕，唯有静待下一波风暴降临。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:11:40 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 张飞伏在断崖边缘的乱石堆...
2025-09-26 23:11:42 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_7d49ea48252118f67fcde823f247b812.png (大小: 1581709 字节)
2025-09-26 23:11:42 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_7d49ea48252118f67fcde823f247b812.png
2025-09-26 23:11:42 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:42 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:42 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=54 choice='点燃一支火把，故意引燃草堆吸引注意力，趁机从后山绕行'
2025-09-26 23:11:42 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 205
2025-09-26 23:11:42 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_7d49ea48252118f67fcde823f247b812.png
2025-09-26 23:11:42 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=54 choice='点燃一支火把，故意引燃草堆吸引注意力，趁机从后山绕行', image_url=/static/generated/ai_gen_7d49ea48252118f67fcde823f247b812.png
2025-09-26 23:11:42 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=60 parent=54 choice='点燃一支火把，故意引燃草堆吸引注意力，趁机从后山绕行'
2025-09-26 23:11:42 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=60 depth=1
2025-09-26 23:11:42 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=60 completed, triggered next level depth=1
2025-09-26 23:11:43 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:43 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:43 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:43 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:43 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:43 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=55 choice='攀上绝壁，从上方投掷石块扰乱守军视线，再伺机跃下', image_url=/static/error_placeholder.png
2025-09-26 23:11:43 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=61 parent=55 choice='攀上绝壁，从上方投掷石块扰乱守军视线，再伺机跃下'
2025-09-26 23:11:43 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=61 depth=1
2025-09-26 23:11:43 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=61 completed, triggered next level depth=1
2025-09-26 23:11:48 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:11:48 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:48 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899507823_671.png
2025-09-26 23:11:48 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899507823_671.png
2025-09-26 23:11:50 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:11:50 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:50 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899508998_879.png
2025-09-26 23:11:50 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899508998_879.png
2025-09-26 23:11:53 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_0703c8e5fe9f7f3b12f880aab2f58ff0.png (大小: 1431018 字节)
2025-09-26 23:11:53 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_0703c8e5fe9f7f3b12f880aab2f58ff0.png
2025-09-26 23:11:53 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:53 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:53 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=56 choice='反手将蛇矛插入崖壁，借力跃至半空，直扑敌楼顶端'
2025-09-26 23:11:53 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 193
2025-09-26 23:11:53 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_0703c8e5fe9f7f3b12f880aab2f58ff0.png
2025-09-26 23:11:53 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=56 choice='反手将蛇矛插入崖壁，借力跃至半空，直扑敌楼顶端', image_url=/static/generated/ai_gen_0703c8e5fe9f7f3b12f880aab2f58ff0.png
2025-09-26 23:11:53 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=62 parent=56 choice='反手将蛇矛插入崖壁，借力跃至半空，直扑敌楼顶端'
2025-09-26 23:11:53 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=62 depth=1
2025-09-26 23:11:53 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=62 completed, triggered next level depth=1
2025-09-26 23:11:54 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_96787da44da02b8da5b09f0306c8ea4b.png (大小: 1425000 字节)
2025-09-26 23:11:54 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_96787da44da02b8da5b09f0306c8ea4b.png
2025-09-26 23:11:54 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:54 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:11:54 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=56 choice='突然收声，单膝跪地假意投降，引诱守将出营探视'
2025-09-26 23:11:54 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 252
2025-09-26 23:11:54 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_96787da44da02b8da5b09f0306c8ea4b.png
2025-09-26 23:11:54 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=56 choice='突然收声，单膝跪地假意投降，引诱守将出营探视', image_url=/static/generated/ai_gen_96787da44da02b8da5b09f0306c8ea4b.png
2025-09-26 23:11:54 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=63 parent=56 choice='突然收声，单膝跪地假意投降，引诱守将出营探视'
2025-09-26 23:11:54 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=63 depth=1
2025-09-26 23:11:54 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=63 completed, triggered next level depth=1
2025-09-26 23:11:55 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:11:55 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:55 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758899514316_170.png
2025-09-26 23:11:55 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758899514316_170.png
2025-09-26 23:11:57 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-26 23:11:57 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:11:57 | WARNING  | core.image_service:_extract_image_url:152 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-26 23:11:57 | WARNING  | core.image_service:generate_image_realtime:119 - ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:11:57 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:57 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=56 choice='借势翻滚入敌阵，以血肉之躯撞开第一道拒马', image_url=/static/error_placeholder.png
2025-09-26 23:11:57 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=64 parent=56 choice='借势翻滚入敌阵，以血肉之躯撞开第一道拒马'
2025-09-26 23:11:57 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=64 depth=1
2025-09-26 23:11:57 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=64 completed, triggered next level depth=1
2025-09-26 23:11:58 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_282445b2afd2fb4f014a0132f0b16199.png (大小: 1384905 字节)
2025-09-26 23:11:58 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_282445b2afd2fb4f014a0132f0b16199.png
2025-09-26 23:11:58 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:11:58 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=55 choice='点燃火把引燃山林，制造混乱趁机突袭主门', image_url=/static/generated/ai_gen_282445b2afd2fb4f014a0132f0b16199.png
2025-09-26 23:11:58 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=65 parent=55 choice='点燃火把引燃山林，制造混乱趁机突袭主门'
2025-09-26 23:11:58 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=4 node=65 depth=1
2025-09-26 23:11:58 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=65 completed, triggered next level depth=1
2025-09-26 23:12:50 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:12:51 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:12:52 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:12:52 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:12:52 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:12:52 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:12:52 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:12:52 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:12:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:12:52 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:12:52 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:12:52 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:12:52 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:12:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:12:53 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:12:53 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:12:53 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:12:53 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:12:53 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:29:37 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:29:38 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:29:39 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:29:39 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:29:39 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:29:39 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:29:39 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:29:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:29:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:29:39 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:29:39 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:29:39 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:29:39 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:29:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:29:40 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:29:40 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:29:40 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:29:40 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:29:40 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:30:39 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:30:40 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:30:41 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:30:41 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:30:41 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:30:41 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:30:41 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:30:41 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:30:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:30:41 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:30:41 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:30:41 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:30:41 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:30:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:30:42 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:30:42 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:30:42 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:30:42 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:30:42 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:31:42 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:31:43 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:31:44 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:31:44 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:31:44 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:31:44 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:31:44 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:31:44 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:31:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:31:44 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:31:44 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:31:44 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:31:44 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:31:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:31:45 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:31:45 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:31:45 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:31:45 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:31:45 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:32:24 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:32:25 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:32:26 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:32:26 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:32:26 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:32:26 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:32:26 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:32:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:26 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:32:26 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:32:26 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:32:26 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:32:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:27 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:32:27 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:32:27 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:32:27 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:32:27 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:32:41 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:32:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:32:43 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:32:43 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:32:43 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:32:43 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:32:43 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:32:43 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:43 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:32:43 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:32:43 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:32:43 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:32:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:43 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:32:43 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:32:43 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:32:43 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:32:43 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:32:51 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:32:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:32:53 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:32:53 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:32:53 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:32:53 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:32:53 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:32:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:53 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:32:53 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:32:53 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:32:53 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:32:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:32:54 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:32:54 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:32:54 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:32:54 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:32:54 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:33:07 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:33:08 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:33:09 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:33:09 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:33:09 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:33:09 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:33:09 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:33:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:33:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:33:09 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:33:09 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:33:09 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:33:09 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:33:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:33:10 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:33:10 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:33:10 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:33:10 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:33:10 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:33:31 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:33:32 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:33:33 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:33:33 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:33:33 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:33:33 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:33:33 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:33:33 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:33:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:33:33 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:33:33 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:33:33 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:33:33 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:33:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:33:34 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:33:34 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:33:34 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:33:34 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:33:34 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:35:40 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:35:41 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:35:42 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:35:42 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:35:42 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:35:42 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:35:42 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:35:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:35:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:35:42 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:35:42 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:35:42 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:35:42 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:35:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:35:43 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:35:43 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:35:43 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:35:43 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:35:43 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:43:41 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:43:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:43:43 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:43:43 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:43:43 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:43:43 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:43:43 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:43:43 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:43:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:43:43 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:43:43 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:43:43 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:43:43 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:43:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:43:44 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:43:44 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:43:44 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:43:44 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:43:44 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:43:51 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:43:52 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:43:53 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:43:53 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:43:53 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:43:53 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:43:53 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:43:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:43:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:43:53 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:43:53 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:43:53 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:43:53 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:43:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:43:54 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:43:54 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:43:54 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:43:54 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:43:54 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:44:09 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:44:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:44:10 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:44:10 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:44:10 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:44:10 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:44:10 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:44:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:44:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:44:11 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:44:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:44:11 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:44:11 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:44:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:44:11 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:44:11 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:44:11 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:44:11 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:44:11 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:44:28 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:44:29 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:44:30 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:44:30 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:44:30 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:44:30 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:44:30 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:44:30 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:44:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:44:30 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:44:30 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:44:30 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:44:30 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:44:31 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:44:31 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:44:31 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:44:31 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:44:31 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:44:31 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:46:40 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-26 23:46:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:46:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:46:45 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:46:45 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:46:45 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:46:45 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:46:45 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:46:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:46:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:46:45 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:46:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:46:45 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:46:45 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:46:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:46:46 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:46:46 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:46:46 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:46:46 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:46:46 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:47:14 | INFO     | api.story:prepare_start_level:197 - 开始生成故事概要，愿望：关羽...
2025-09-26 23:47:15 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:47:15 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 887
2025-09-26 23:47:15 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整(故事+图像)生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:47:15 | INFO     | api.story:prepare_start_level:272 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:47:15 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:47:15 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-26 23:47:18 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:47:18 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1358
2025-09-26 23:47:18 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=836 预览='{"text": "夜色如墨，荆州城楼的风卷起关羽的战袍，他立于箭垛之间，目光穿透迷雾，直视那座被重兵把守的粮仓。火把摇曳，铁甲映光，敌军巡逻队的脚步声在石板路上回响。他手中青龙偃月刀微微震颤，仿佛感知到命运的裂痕——若此刻夺取粮草，可解刘备大军断炊之危，但一旦暴露，便是万劫不复。远处钟声敲响三更，守卫换班的间隙仅剩片刻。他深吸一口气，肩头压着千钧之重：是孤身闯入，还是另寻蹊径？历史的齿轮在此刻停滞，只等一念抉择。", "choices": [{"option": "以长袍裹身伪装成送饭小卒，混入粮仓后巷", "summary": "借身份掩护潜入，暗藏锋芒于卑微之中", "effects":'
2025-09-26 23:47:18 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=836 预览='{"text": "夜色如墨，荆州城楼的风卷起关羽的战袍，他立于箭垛之间，目光穿透迷雾，直视那座被重兵把守的粮仓。火把摇曳，铁甲映光，敌军巡逻队的脚步声在石板路上回响。他手中青龙偃月刀微微震颤，仿佛感知到命运的裂痕——若此刻夺取粮草，可解刘备大军断炊之危，但一旦暴露，便是万劫不复。远处钟声敲响三更，守卫换班的间隙仅剩片'
2025-09-26 23:47:18 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=836 预览='{"text": "夜色如墨，荆州城楼的风卷起关羽的战袍，他立于箭垛之间，目光穿透迷雾，直视那座被重兵把守的粮仓。火把摇曳，铁甲映光，敌军巡逻队的脚步声在石板路上回响。他手中青龙偃月刀微微震颤，仿佛感知到命运的裂痕——若此刻夺取粮草，可解刘备大军断炊之危，但一旦暴露，便是万劫不复。远处钟声敲响三更，守卫换班的间隙仅剩片'
2025-09-26 23:47:18 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 199
2025-09-26 23:47:18 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:47:18 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 199
2025-09-26 23:47:18 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，荆州城楼的风卷起关羽的战袍，他立于箭垛之间，目光穿透迷雾，直视那座被重兵把守的粮仓。火把摇曳，铁甲映光，敌军巡逻队的脚步声在石板路上回响。他手中青龙偃月刀微微震颤，仿佛感知到命运的裂痕——若此刻夺取粮草，可解刘备大军断炊之危，但一旦暴露，便是万劫不复。远处钟声敲响三更，守卫换班的间隙仅剩片刻。他深吸一口气，肩头压着千钧之重：是孤身闯入，还是另寻蹊径？历史的齿轮在此刻停滞，只等一念抉择。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:47:18 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，荆州城楼的风卷...
2025-09-26 23:47:30 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:47:30 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:47:30 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901650289_905.png
2025-09-26 23:47:30 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901650289_905.png
2025-09-26 23:47:36 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_611a081b850c6bdd63f27c636783d56f.png (大小: 731708 字节)
2025-09-26 23:47:36 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_611a081b850c6bdd63f27c636783d56f.png
2025-09-26 23:47:36 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:47:36 | INFO     | core.story_engine:start_story:448 - 新故事生成成功
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=199
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 开始为第一节故事重新生成图像: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:47:36 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 199
2025-09-26 23:47:36 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_611a081b850c6bdd63f27c636783d56f.png
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:84 - [预生成] 第一节图像生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, image_url=/static/generated/ai_gen_611a081b850c6bdd63f27c636783d56f.png
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 创建会话成功: session_id=5
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:92 - [预生成] 创建第一个节点成功: node_id=66
2025-09-26 23:47:36 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=66 depth=3
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:104 - [预生成] 已触发speculation预生成: session=5, node=66
2025-09-26 23:47:36 | INFO     | api.story:_background_generate_with_pregeneration:106 - [预生成] 完整(故事+图像)流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=5
2025-09-26 23:47:36 | DEBUG    | api.story:_background_generate_with_pregeneration:118 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:47:36 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=66
2025-09-26 23:47:36 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 以长袍裹身伪装成送饭小卒，混入粮仓后巷
2025-09-26 23:47:36 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 引燃一捆干草制造混乱，趁乱纵马冲向主仓门
2025-09-26 23:47:36 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 攀上城楼外侧瓦檐，借夜雾滑至粮仓屋顶
2025-09-26 23:47:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:47:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1529
2025-09-26 23:47:39 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=832 预览='{"text": "夜风卷起关羽的披风，他凝视着粮仓西侧那道被月光斜切的缝隙——守卫换班的间隙如刀锋般短暂。远处更鼓再响，铜铃轻颤，他忽然瞥见一名小卒踉跄跌入草堆，手中火把熄灭。一瞬之间，机会浮现：若趁乱引燃草垛制造混乱，或可掩护突袭；但若动作稍迟，便是万箭穿心之局。他握紧刀柄，青龙偃月刀的寒光在唇边一闪而过，仿佛回应着血脉深处的战意。是借势而起，还是静待天时？命运的丝线正悬于一线。", "choices": [{"option": "猛然跃出，以刀尖挑起草堆点燃火源，制造烟雾掩护", "summary": "以烈焰为盾，主动制造混乱突破防线", "effects": {"delta_prog'
2025-09-26 23:47:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=832 预览='{"text": "夜风卷起关羽的披风，他凝视着粮仓西侧那道被月光斜切的缝隙——守卫换班的间隙如刀锋般短暂。远处更鼓再响，铜铃轻颤，他忽然瞥见一名小卒踉跄跌入草堆，手中火把熄灭。一瞬之间，机会浮现：若趁乱引燃草垛制造混乱，或可掩护突袭；但若动作稍迟，便是万箭穿心之局。他握紧刀柄，青龙偃月刀的寒光在唇边一闪而过，仿佛回应'
2025-09-26 23:47:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=832 预览='{"text": "夜风卷起关羽的披风，他凝视着粮仓西侧那道被月光斜切的缝隙——守卫换班的间隙如刀锋般短暂。远处更鼓再响，铜铃轻颤，他忽然瞥见一名小卒踉跄跌入草堆，手中火把熄灭。一瞬之间，机会浮现：若趁乱引燃草垛制造混乱，或可掩护突袭；但若动作稍迟，便是万箭穿心之局。他握紧刀柄，青龙偃月刀的寒光在唇边一闪而过，仿佛回应'
2025-09-26 23:47:39 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 23:47:39 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:47:39 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 183
2025-09-26 23:47:39 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起关羽的披风，他凝视着粮仓西侧那道被月光斜切的缝隙——守卫换班的间隙如刀锋般短暂。远处更鼓再响，铜铃轻颤，他忽然瞥见一名小卒踉跄跌入草堆，手中火把熄灭。一瞬之间，机会浮现：若趁乱引燃草垛制造混乱，或可掩护突袭；但若动作稍迟，便是万箭穿心之局。他握紧刀柄，青龙偃月刀的寒光在唇边一闪而过，仿佛回应着血脉深处的战意。是借势而起，还是静待天时？命运的丝线正悬于一线。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:47:39 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起关羽的披风，他凝...
2025-09-26 23:47:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:47:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1551
2025-09-26 23:47:39 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=879 预览='{"text": "夜风掠过城楼，关羽的刀尖轻点地面，发出细微嗡鸣。他凝视着粮仓侧墙下那道被月光勾勒出的缝隙——那是旧时排水沟的残口，如今却成了通往敌营腹地的隐秘通道。远处传来更夫的梆子声，守卫正缓缓移步至转角。他深吸一口寒气，衣袍猎猎如战旗，左手已悄然摸向腰间暗藏的铁索。若从这窄缝潜入，需在三息之内翻越石垣，否则将暴露于巡夜火把之下；若贸然行动，哪怕一丝声响都可能惊动整座军营。他的目光扫过粮仓顶上飘动的布幡，仿佛听见刘备军中将士饥肠辘辘的呻吟。此刻，命运只系于一念之间。", "choices": [{"option": "将铁索甩向墙外树枝，借力翻越石垣，悄无声息落地", "summary"'
2025-09-26 23:47:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=879 预览='{"text": "夜风掠过城楼，关羽的刀尖轻点地面，发出细微嗡鸣。他凝视着粮仓侧墙下那道被月光勾勒出的缝隙——那是旧时排水沟的残口，如今却成了通往敌营腹地的隐秘通道。远处传来更夫的梆子声，守卫正缓缓移步至转角。他深吸一口寒气，衣袍猎猎如战旗，左手已悄然摸向腰间暗藏的铁索。若从这窄缝潜入，需在三息之内翻越石垣，否则将暴'
2025-09-26 23:47:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=879 预览='{"text": "夜风掠过城楼，关羽的刀尖轻点地面，发出细微嗡鸣。他凝视着粮仓侧墙下那道被月光勾勒出的缝隙——那是旧时排水沟的残口，如今却成了通往敌营腹地的隐秘通道。远处传来更夫的梆子声，守卫正缓缓移步至转角。他深吸一口寒气，衣袍猎猎如战旗，左手已悄然摸向腰间暗藏的铁索。若从这窄缝潜入，需在三息之内翻越石垣，否则将暴'
2025-09-26 23:47:39 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 228
2025-09-26 23:47:39 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:47:39 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 228
2025-09-26 23:47:39 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风掠过城楼，关羽的刀尖轻点地面，发出细微嗡鸣。他凝视着粮仓侧墙下那道被月光勾勒出的缝隙——那是旧时排水沟的残口，如今却成了通往敌营腹地的隐秘通道。远处传来更夫的梆子声，守卫正缓缓移步至转角。他深吸一口寒气，衣袍猎猎如战旗，左手已悄然摸向腰间暗藏的铁索。若从这窄缝潜入，需在三息之内翻越石垣，否则将暴露于巡夜火把之下；若贸然行动，哪怕一丝声响都可能惊动整座军营。他的目光扫过粮仓顶上飘动的布幡，仿佛听见刘备军中将士饥肠辘辘的呻吟。此刻，命运只系于一念之间。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:47:39 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风掠过城楼，关羽的刀尖...
2025-09-26 23:47:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:47:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1553
2025-09-26 23:47:39 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=861 预览='{"text": "风卷残云，城楼上的火把忽明忽暗，关羽凝视着粮仓铁门后隐约闪烁的油灯。他猛然察觉，守卫换班的间隙并非仅靠时间——那名老卒手中铜铃竟在三更时分自动轻响，仿佛与某种古老机关共鸣。他眯眼细看，发现墙角石缝中嵌着一枚锈蚀的青铜铃铛，与守卫所持如出一辙。若能引动这枚铃铛，或许可借‘报时之律’掩护身形，悄然入内。但此举需以自身为引，一旦铃声错乱，便是暴露于万箭之下。他握紧刀柄，寒意从指尖蔓延至脊背——是顺其自然，还是逆天改命？", "choices": [{"option": "以青龙刀刃轻敲石壁，模仿铃声节奏，诱使守卫误判换班时机", "summary": "以声制声，借敌之律扰乱敌之'
2025-09-26 23:47:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=861 预览='{"text": "风卷残云，城楼上的火把忽明忽暗，关羽凝视着粮仓铁门后隐约闪烁的油灯。他猛然察觉，守卫换班的间隙并非仅靠时间——那名老卒手中铜铃竟在三更时分自动轻响，仿佛与某种古老机关共鸣。他眯眼细看，发现墙角石缝中嵌着一枚锈蚀的青铜铃铛，与守卫所持如出一辙。若能引动这枚铃铛，或许可借‘报时之律’掩护身形，悄然入内。'
2025-09-26 23:47:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=861 预览='{"text": "风卷残云，城楼上的火把忽明忽暗，关羽凝视着粮仓铁门后隐约闪烁的油灯。他猛然察觉，守卫换班的间隙并非仅靠时间——那名老卒手中铜铃竟在三更时分自动轻响，仿佛与某种古老机关共鸣。他眯眼细看，发现墙角石缝中嵌着一枚锈蚀的青铜铃铛，与守卫所持如出一辙。若能引动这枚铃铛，或许可借‘报时之律’掩护身形，悄然入内。'
2025-09-26 23:47:39 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 208
2025-09-26 23:47:39 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:47:39 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 208
2025-09-26 23:47:39 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残云，城楼上的火把忽明忽暗，关羽凝视着粮仓铁门后隐约闪烁的油灯。他猛然察觉，守卫换班的间隙并非仅靠时间——那名老卒手中铜铃竟在三更时分自动轻响，仿佛与某种古老机关共鸣。他眯眼细看，发现墙角石缝中嵌着一枚锈蚀的青铜铃铛，与守卫所持如出一辙。若能引动这枚铃铛，或许可借‘报时之律’掩护身形，悄然入内。但此举需以自身为引，一旦铃声错乱，便是暴露于万箭之下。他握紧刀柄，寒意从指尖蔓延至脊背——是顺其自然，还是逆天改命？. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:47:39 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残云，城楼上的火把忽...
2025-09-26 23:47:53 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:47:53 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:47:53 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901673040_311.png
2025-09-26 23:47:53 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901673040_311.png
2025-09-26 23:47:53 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:47:53 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:47:53 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901673341_514.png
2025-09-26 23:47:53 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901673341_514.png
2025-09-26 23:47:54 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 712
2025-09-26 23:47:54 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:47:54 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901674446_874.png
2025-09-26 23:47:54 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901674446_874.png
2025-09-26 23:47:57 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_79d8c8da15b52ba24d05f91232ea8bc8.png (大小: 1463014 字节)
2025-09-26 23:47:57 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_79d8c8da15b52ba24d05f91232ea8bc8.png
2025-09-26 23:47:57 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:47:57 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:47:57 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=66 choice='攀上城楼外侧瓦檐，借夜雾滑至粮仓屋顶'
2025-09-26 23:47:57 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 228
2025-09-26 23:47:57 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_79d8c8da15b52ba24d05f91232ea8bc8.png
2025-09-26 23:47:57 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=66 choice='攀上城楼外侧瓦檐，借夜雾滑至粮仓屋顶', image_url=/static/generated/ai_gen_79d8c8da15b52ba24d05f91232ea8bc8.png
2025-09-26 23:47:57 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=67 parent=66 choice='攀上城楼外侧瓦檐，借夜雾滑至粮仓屋顶'
2025-09-26 23:47:57 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=67 depth=2
2025-09-26 23:47:57 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=67 completed, triggered next level depth=2
2025-09-26 23:47:57 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=67
2025-09-26 23:47:57 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 将铁索甩向墙外树枝，借力翻越石垣，悄无声息落地
2025-09-26 23:47:57 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 点燃一支火折子扔向粮仓后院，制造混乱引开守卫注意力
2025-09-26 23:47:57 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 静立原地，闭目默念桃园誓约，以心神镇定压住心跳
2025-09-26 23:47:58 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_48e71a3ccef3b54e3821e95c614c29e2.png (大小: 1503950 字节)
2025-09-26 23:47:58 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_48e71a3ccef3b54e3821e95c614c29e2.png
2025-09-26 23:47:58 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:47:58 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:47:58 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=66 choice='引燃一捆干草制造混乱，趁乱纵马冲向主仓门'
2025-09-26 23:47:58 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 208
2025-09-26 23:47:58 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_48e71a3ccef3b54e3821e95c614c29e2.png
2025-09-26 23:47:58 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=66 choice='引燃一捆干草制造混乱，趁乱纵马冲向主仓门', image_url=/static/generated/ai_gen_48e71a3ccef3b54e3821e95c614c29e2.png
2025-09-26 23:47:58 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=68 parent=66 choice='引燃一捆干草制造混乱，趁乱纵马冲向主仓门'
2025-09-26 23:47:58 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=68 depth=2
2025-09-26 23:47:58 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=68 completed, triggered next level depth=2
2025-09-26 23:47:58 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=68
2025-09-26 23:47:58 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 以青龙刀刃轻敲石壁，模仿铃声节奏，诱使守卫误判换班时机
2025-09-26 23:47:58 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 撕下战袍一角，用血在墙上画出古代兵符图样，试探是否触发隐藏通道
2025-09-26 23:47:58 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 悄然蹲伏于阴影中，静待钟声落定，以影子贴地滑行逼近侧门
2025-09-26 23:48:00 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_2f5b5a4f4afc1b1b33a3f307a3739b9d.png (大小: 1114070 字节)
2025-09-26 23:48:00 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_2f5b5a4f4afc1b1b33a3f307a3739b9d.png
2025-09-26 23:48:00 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:00 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:00 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=66 choice='以长袍裹身伪装成送饭小卒，混入粮仓后巷'
2025-09-26 23:48:00 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 183
2025-09-26 23:48:00 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_2f5b5a4f4afc1b1b33a3f307a3739b9d.png
2025-09-26 23:48:00 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=66 choice='以长袍裹身伪装成送饭小卒，混入粮仓后巷', image_url=/static/generated/ai_gen_2f5b5a4f4afc1b1b33a3f307a3739b9d.png
2025-09-26 23:48:00 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=69 parent=66 choice='以长袍裹身伪装成送饭小卒，混入粮仓后巷'
2025-09-26 23:48:00 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=69 depth=2
2025-09-26 23:48:00 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=69 completed, triggered next level depth=2
2025-09-26 23:48:00 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=69
2025-09-26 23:48:00 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 猛然跃出，以刀尖挑起草堆点燃火源，制造烟雾掩护
2025-09-26 23:48:00 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 悄然攀上墙头，用铁链缠住吊篮，伪装成运送柴薪的民夫潜入
2025-09-26 23:48:00 | INFO     | core.story_engine:continue_story:463 - 继续故事，用户选择: 轻声呼唤远处巡哨，佯装是友军传令兵，试图以口令混入
2025-09-26 23:48:01 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:01 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1781
2025-09-26 23:48:01 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=893 预览='{"text": "夜雾如纱，关羽借着瓦檐的凹凸起伏悄然攀行，铁靴与青石摩擦发出细微嘶鸣。他贴身于屋脊之上，如同一道游动的黑影，每一步都踩在生死边缘。风卷起他残破的战袍，露出肩头旧日刀痕——那是赤壁之战留下的印记。前方粮仓顶上，布幡猎猎，似有暗语低吟。突然，一阵脚步声由远及近，两名守军正朝此处巡弋。他屏息凝神，将身躯隐入檐角阴影，指尖紧握青龙偃月刀的刀柄，指节发白。就在此时，一只乌鸦扑翅惊飞，惊动了巡逻队。他必须立刻行动：要么趁乱跃下投掷火种点燃粮堆，要么借雨槽滑落至地窖入口，直捣中枢。", "choices": [{"option": "借乌鸦惊飞之机，甩出铁索缠住梁柱，顺势荡向粮仓侧墙",'
2025-09-26 23:48:01 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=893 预览='{"text": "夜雾如纱，关羽借着瓦檐的凹凸起伏悄然攀行，铁靴与青石摩擦发出细微嘶鸣。他贴身于屋脊之上，如同一道游动的黑影，每一步都踩在生死边缘。风卷起他残破的战袍，露出肩头旧日刀痕——那是赤壁之战留下的印记。前方粮仓顶上，布幡猎猎，似有暗语低吟。突然，一阵脚步声由远及近，两名守军正朝此处巡弋。他屏息凝神，将身躯隐'
2025-09-26 23:48:01 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=893 预览='{"text": "夜雾如纱，关羽借着瓦檐的凹凸起伏悄然攀行，铁靴与青石摩擦发出细微嘶鸣。他贴身于屋脊之上，如同一道游动的黑影，每一步都踩在生死边缘。风卷起他残破的战袍，露出肩头旧日刀痕——那是赤壁之战留下的印记。前方粮仓顶上，布幡猎猎，似有暗语低吟。突然，一阵脚步声由远及近，两名守军正朝此处巡弋。他屏息凝神，将身躯隐'
2025-09-26 23:48:01 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 236
2025-09-26 23:48:01 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:01 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 236
2025-09-26 23:48:01 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，关羽借着瓦檐的凹凸起伏悄然攀行，铁靴与青石摩擦发出细微嘶鸣。他贴身于屋脊之上，如同一道游动的黑影，每一步都踩在生死边缘。风卷起他残破的战袍，露出肩头旧日刀痕——那是赤壁之战留下的印记。前方粮仓顶上，布幡猎猎，似有暗语低吟。突然，一阵脚步声由远及近，两名守军正朝此处巡弋。他屏息凝神，将身躯隐入檐角阴影，指尖紧握青龙偃月刀的刀柄，指节发白。就在此时，一只乌鸦扑翅惊飞，惊动了巡逻队。他必须立刻行动：要么趁乱跃下投掷火种点燃粮堆，要么借雨槽滑落至地窖入口，直捣中枢。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:01 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，关羽借着瓦檐的...
2025-09-26 23:48:01 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:01 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1750
2025-09-26 23:48:01 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=859 预览='{"text": "关羽身形如狸猫般贴上城楼外壁，瓦片在寒风中微微震颤。他借夜雾掩护，顺着屋檐滑落，青龙偃月刀刀尖轻点石脊，发出几不可闻的脆响。风卷残云，一缕月光骤然穿透薄雾，照亮粮仓屋顶的瓦隙——那里，一队巡兵正从东侧走来，火把摇曳，影子在瓦垄间拉长。他迅速伏低身躯，将身体嵌入屋脊凹槽，呼吸凝滞如冰。远处传来更夫的低语，脚步声渐近。他目光扫过仓顶边缘那道被雨水冲刷出的裂痕，仿佛看见刘备军中将士因饥饿而颤抖的手。此刻，唯有静待时机，或以雷霆之势破局。", "choices": [{"option": "引动屋檐积雪，制造坠落声响吸引巡兵注意力", "summary": "以声制静，借自然之力扰'
2025-09-26 23:48:01 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=859 预览='{"text": "关羽身形如狸猫般贴上城楼外壁，瓦片在寒风中微微震颤。他借夜雾掩护，顺着屋檐滑落，青龙偃月刀刀尖轻点石脊，发出几不可闻的脆响。风卷残云，一缕月光骤然穿透薄雾，照亮粮仓屋顶的瓦隙——那里，一队巡兵正从东侧走来，火把摇曳，影子在瓦垄间拉长。他迅速伏低身躯，将身体嵌入屋脊凹槽，呼吸凝滞如冰。远处传来更夫的低'
2025-09-26 23:48:01 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=859 预览='{"text": "关羽身形如狸猫般贴上城楼外壁，瓦片在寒风中微微震颤。他借夜雾掩护，顺着屋檐滑落，青龙偃月刀刀尖轻点石脊，发出几不可闻的脆响。风卷残云，一缕月光骤然穿透薄雾，照亮粮仓屋顶的瓦隙——那里，一队巡兵正从东侧走来，火把摇曳，影子在瓦垄间拉长。他迅速伏低身躯，将身体嵌入屋脊凹槽，呼吸凝滞如冰。远处传来更夫的低'
2025-09-26 23:48:01 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 23:48:01 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:01 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 217
2025-09-26 23:48:01 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽身形如狸猫般贴上城楼外壁，瓦片在寒风中微微震颤。他借夜雾掩护，顺着屋檐滑落，青龙偃月刀刀尖轻点石脊，发出几不可闻的脆响。风卷残云，一缕月光骤然穿透薄雾，照亮粮仓屋顶的瓦隙——那里，一队巡兵正从东侧走来，火把摇曳，影子在瓦垄间拉长。他迅速伏低身躯，将身体嵌入屋脊凹槽，呼吸凝滞如冰。远处传来更夫的低语，脚步声渐近。他目光扫过仓顶边缘那道被雨水冲刷出的裂痕，仿佛看见刘备军中将士因饥饿而颤抖的手。此刻，唯有静待时机，或以雷霆之势破局。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:01 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽身形如狸猫般贴上城楼...
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1758
2025-09-26 23:48:02 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=865 预览='{"text": "关羽猛然将手中火把掷向堆积的干草堆，烈焰轰然腾起，火舌如龙卷般舔舐夜空。浓烟翻滚中，守卫惊呼四散，马蹄声骤乱，城楼上的弓手纷纷转向火源。他趁机纵马疾驰，青龙偃月刀在火光中划出一道寒芒，直扑主仓铁门。铁门在马蹄撞击下发出刺耳呻吟，锁链崩裂，尘土与碎屑飞溅如雨。然而就在他冲入的一瞬，远处钟声突变——三更已过，警报铃铛竟自行响起，整座粮仓的暗哨同时亮起火把，杀机四伏。他立于门内阴影之中，刀锋未收，目光扫视四周，已知此路虽通，却再无退途。", "choices": [{"option": "将火把插进粮堆制造二次爆炸，引燃整座仓库", "summary": "以毁灭为代价换取彻底混'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=865 预览='{"text": "关羽猛然将手中火把掷向堆积的干草堆，烈焰轰然腾起，火舌如龙卷般舔舐夜空。浓烟翻滚中，守卫惊呼四散，马蹄声骤乱，城楼上的弓手纷纷转向火源。他趁机纵马疾驰，青龙偃月刀在火光中划出一道寒芒，直扑主仓铁门。铁门在马蹄撞击下发出刺耳呻吟，锁链崩裂，尘土与碎屑飞溅如雨。然而就在他冲入的一瞬，远处钟声突变——三更'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=865 预览='{"text": "关羽猛然将手中火把掷向堆积的干草堆，烈焰轰然腾起，火舌如龙卷般舔舐夜空。浓烟翻滚中，守卫惊呼四散，马蹄声骤乱，城楼上的弓手纷纷转向火源。他趁机纵马疾驰，青龙偃月刀在火光中划出一道寒芒，直扑主仓铁门。铁门在马蹄撞击下发出刺耳呻吟，锁链崩裂，尘土与碎屑飞溅如雨。然而就在他冲入的一瞬，远处钟声突变——三更'
2025-09-26 23:48:02 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 23:48:02 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 217
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽猛然将手中火把掷向堆积的干草堆，烈焰轰然腾起，火舌如龙卷般舔舐夜空。浓烟翻滚中，守卫惊呼四散，马蹄声骤乱，城楼上的弓手纷纷转向火源。他趁机纵马疾驰，青龙偃月刀在火光中划出一道寒芒，直扑主仓铁门。铁门在马蹄撞击下发出刺耳呻吟，锁链崩裂，尘土与碎屑飞溅如雨。然而就在他冲入的一瞬，远处钟声突变——三更已过，警报铃铛竟自行响起，整座粮仓的暗哨同时亮起火把，杀机四伏。他立于门内阴影之中，刀锋未收，目光扫视四周，已知此路虽通，却再无退途。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:02 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽猛然将手中火把掷向堆...
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1756
2025-09-26 23:48:02 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=859 预览='{"text": "关羽猛然将干草掷向垛口，火舌瞬间舔舐夜空，浓烟裹着火星翻滚而起。守卫惊呼四散，马蹄声骤然炸响——他勒缰纵马，青龙偃月刀在火光中划出一道银弧，直扑主仓铁门。箭矢如雨点般射来，他侧身避过，战马嘶鸣跃起，刀锋劈开厚重门闩，木屑纷飞间，粮仓深处幽暗的堆栈如巨兽之腹骤然敞开。火光映照下，他瞥见一排铁笼中关押的俘虏，眼神哀绝，而最深处，竟有一只铜铃静静悬于梁上，与墙角那枚遥相呼应。风卷残云，火势蔓延，可这胜利的代价，是否已悄然埋下更深的伏笔？", "choices": [{"option": "撕开粮袋，将谷物抛向空中引开敌军注意力", "summary": "以物资为饵，制造混乱转移'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=859 预览='{"text": "关羽猛然将干草掷向垛口，火舌瞬间舔舐夜空，浓烟裹着火星翻滚而起。守卫惊呼四散，马蹄声骤然炸响——他勒缰纵马，青龙偃月刀在火光中划出一道银弧，直扑主仓铁门。箭矢如雨点般射来，他侧身避过，战马嘶鸣跃起，刀锋劈开厚重门闩，木屑纷飞间，粮仓深处幽暗的堆栈如巨兽之腹骤然敞开。火光映照下，他瞥见一排铁笼中关押的'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=859 预览='{"text": "关羽猛然将干草掷向垛口，火舌瞬间舔舐夜空，浓烟裹着火星翻滚而起。守卫惊呼四散，马蹄声骤然炸响——他勒缰纵马，青龙偃月刀在火光中划出一道银弧，直扑主仓铁门。箭矢如雨点般射来，他侧身避过，战马嘶鸣跃起，刀锋劈开厚重门闩，木屑纷飞间，粮仓深处幽暗的堆栈如巨兽之腹骤然敞开。火光映照下，他瞥见一排铁笼中关押的'
2025-09-26 23:48:02 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 23:48:02 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 217
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽猛然将干草掷向垛口，火舌瞬间舔舐夜空，浓烟裹着火星翻滚而起。守卫惊呼四散，马蹄声骤然炸响——他勒缰纵马，青龙偃月刀在火光中划出一道银弧，直扑主仓铁门。箭矢如雨点般射来，他侧身避过，战马嘶鸣跃起，刀锋劈开厚重门闩，木屑纷飞间，粮仓深处幽暗的堆栈如巨兽之腹骤然敞开。火光映照下，他瞥见一排铁笼中关押的俘虏，眼神哀绝，而最深处，竟有一只铜铃静静悬于梁上，与墙角那枚遥相呼应。风卷残云，火势蔓延，可这胜利的代价，是否已悄然埋下更深的伏笔？. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:02 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽猛然将干草掷向垛口，...
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1787
2025-09-26 23:48:02 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=886 预览='{"text": "关羽身形如狸猫般贴上城楼外侧的瓦檐，青石与瓦片在夜风中发出细微摩擦声。他借着浓雾掩护，沿着陡峭的屋脊缓缓滑行，指尖紧扣砖缝，每一步都踩在生死边缘。月光被云层撕碎，洒在粮仓顶部的陶瓦上，映出一片幽蓝的冷光。突然，一只乌鸦惊飞，扑棱声划破寂静——守卫的哨塔传来一声低喝。他猛然伏低，脊背紧贴瓦面，任由寒露浸透战袍。就在那瞬间，他瞥见粮仓西侧通风口处，一缕炊烟正悄然升腾，仿佛有暗哨在值守。若强行翻越屋顶，必会惊动耳尖的敌兵；若退回，前功尽弃。他咬牙，将刀柄抵入瓦缝，身体如弓般绷紧，只待下一瞬的静默。", "choices": [{"option": "用铁索缠住瓦当，借力荡向通风口'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=886 预览='{"text": "关羽身形如狸猫般贴上城楼外侧的瓦檐，青石与瓦片在夜风中发出细微摩擦声。他借着浓雾掩护，沿着陡峭的屋脊缓缓滑行，指尖紧扣砖缝，每一步都踩在生死边缘。月光被云层撕碎，洒在粮仓顶部的陶瓦上，映出一片幽蓝的冷光。突然，一只乌鸦惊飞，扑棱声划破寂静——守卫的哨塔传来一声低喝。他猛然伏低，脊背紧贴瓦面，任由寒露'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=886 预览='{"text": "关羽身形如狸猫般贴上城楼外侧的瓦檐，青石与瓦片在夜风中发出细微摩擦声。他借着浓雾掩护，沿着陡峭的屋脊缓缓滑行，指尖紧扣砖缝，每一步都踩在生死边缘。月光被云层撕碎，洒在粮仓顶部的陶瓦上，映出一片幽蓝的冷光。突然，一只乌鸦惊飞，扑棱声划破寂静——守卫的哨塔传来一声低喝。他猛然伏低，脊背紧贴瓦面，任由寒露'
2025-09-26 23:48:02 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 248
2025-09-26 23:48:02 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 248
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽身形如狸猫般贴上城楼外侧的瓦檐，青石与瓦片在夜风中发出细微摩擦声。他借着浓雾掩护，沿着陡峭的屋脊缓缓滑行，指尖紧扣砖缝，每一步都踩在生死边缘。月光被云层撕碎，洒在粮仓顶部的陶瓦上，映出一片幽蓝的冷光。突然，一只乌鸦惊飞，扑棱声划破寂静——守卫的哨塔传来一声低喝。他猛然伏低，脊背紧贴瓦面，任由寒露浸透战袍。就在那瞬间，他瞥见粮仓西侧通风口处，一缕炊烟正悄然升腾，仿佛有暗哨在值守。若强行翻越屋顶，必会惊动耳尖的敌兵；若退回，前功尽弃。他咬牙，将刀柄抵入瓦缝，身体如弓般绷紧，只待下一瞬的静默。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:02 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽身形如狸猫般贴上城楼...
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1723
2025-09-26 23:48:02 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=825 预览='{"text": "关羽猛然抽刀劈向堆叠的干草，火舌瞬间舔舐夜空，浓烟如龙卷升腾。守卫惊呼四起，马匹嘶鸣乱窜，混乱在城楼间炸开。他纵身跃上战马，青龙偃月刀在火光中划出一道冷冽弧线，直冲主仓铁门。箭矢如雨落下，他侧身闪避，战袍被灼破一角，但马蹄已踏碎木门，轰然撞入粮仓深处。火光映照下，粮袋堆积如山，而正中央一尊铜制战鼓静静矗立——那正是刘备军魂所寄之物，传说可唤醒沉睡的荆州旧部。然而，鼓面裂痕深处，竟有暗纹如血丝蔓延，仿佛预示着某种不可逆的觉醒。", "choices": [{"option": "用刀尖轻触战鼓，试探其共鸣之力", "summary": "以血脉感应触发未知机关", "effe'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=825 预览='{"text": "关羽猛然抽刀劈向堆叠的干草，火舌瞬间舔舐夜空，浓烟如龙卷升腾。守卫惊呼四起，马匹嘶鸣乱窜，混乱在城楼间炸开。他纵身跃上战马，青龙偃月刀在火光中划出一道冷冽弧线，直冲主仓铁门。箭矢如雨落下，他侧身闪避，战袍被灼破一角，但马蹄已踏碎木门，轰然撞入粮仓深处。火光映照下，粮袋堆积如山，而正中央一尊铜制战鼓静'
2025-09-26 23:48:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=825 预览='{"text": "关羽猛然抽刀劈向堆叠的干草，火舌瞬间舔舐夜空，浓烟如龙卷升腾。守卫惊呼四起，马匹嘶鸣乱窜，混乱在城楼间炸开。他纵身跃上战马，青龙偃月刀在火光中划出一道冷冽弧线，直冲主仓铁门。箭矢如雨落下，他侧身闪避，战袍被灼破一角，但马蹄已踏碎木门，轰然撞入粮仓深处。火光映照下，粮袋堆积如山，而正中央一尊铜制战鼓静'
2025-09-26 23:48:02 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 214
2025-09-26 23:48:02 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 214
2025-09-26 23:48:02 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽猛然抽刀劈向堆叠的干草，火舌瞬间舔舐夜空，浓烟如龙卷升腾。守卫惊呼四起，马匹嘶鸣乱窜，混乱在城楼间炸开。他纵身跃上战马，青龙偃月刀在火光中划出一道冷冽弧线，直冲主仓铁门。箭矢如雨落下，他侧身闪避，战袍被灼破一角，但马蹄已踏碎木门，轰然撞入粮仓深处。火光映照下，粮袋堆积如山，而正中央一尊铜制战鼓静静矗立——那正是刘备军魂所寄之物，传说可唤醒沉睡的荆州旧部。然而，鼓面裂痕深处，竟有暗纹如血丝蔓延，仿佛预示着某种不可逆的觉醒。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:03 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 关羽猛然抽刀劈向堆叠的干...
2025-09-26 23:48:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1736
2025-09-26 23:48:04 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=867 预览='{"text": "夜雾低垂，关羽将战袍裹紧，化作一名佝偻老卒，肩挑竹筐，脚步蹒跚地穿过粮仓后巷的暗影。草叶沾湿了他的鞋履，远处更夫的梆子声如心跳般敲打寂静。他低头避开火把光晕，指尖轻触腰间短刃——那是一道藏于衣褶的退路。忽然，一队巡兵从转角逼近，火光映出他布满裂痕的脸。他缓缓放下竹筐，假装咳嗽，将一碗冷粥泼向石缝，借着烟尘与声响掩住呼吸。就在守卫侧目的一瞬，他猛然缩身入墙根，青筋在腕上跳动，仿佛整座荆州城的重量都压在这一息之间。他已踏入敌营腹地，但真正的考验才刚刚开始。", "choices": [{"option": "趁守卫分神，用袖中短刃割断绳索，引燃堆在角落的干草", "summar'
2025-09-26 23:48:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=867 预览='{"text": "夜雾低垂，关羽将战袍裹紧，化作一名佝偻老卒，肩挑竹筐，脚步蹒跚地穿过粮仓后巷的暗影。草叶沾湿了他的鞋履，远处更夫的梆子声如心跳般敲打寂静。他低头避开火把光晕，指尖轻触腰间短刃——那是一道藏于衣褶的退路。忽然，一队巡兵从转角逼近，火光映出他布满裂痕的脸。他缓缓放下竹筐，假装咳嗽，将一碗冷粥泼向石缝，借'
2025-09-26 23:48:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=867 预览='{"text": "夜雾低垂，关羽将战袍裹紧，化作一名佝偻老卒，肩挑竹筐，脚步蹒跚地穿过粮仓后巷的暗影。草叶沾湿了他的鞋履，远处更夫的梆子声如心跳般敲打寂静。他低头避开火把光晕，指尖轻触腰间短刃——那是一道藏于衣褶的退路。忽然，一队巡兵从转角逼近，火光映出他布满裂痕的脸。他缓缓放下竹筐，假装咳嗽，将一碗冷粥泼向石缝，借'
2025-09-26 23:48:04 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 228
2025-09-26 23:48:04 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:04 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 228
2025-09-26 23:48:04 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾低垂，关羽将战袍裹紧，化作一名佝偻老卒，肩挑竹筐，脚步蹒跚地穿过粮仓后巷的暗影。草叶沾湿了他的鞋履，远处更夫的梆子声如心跳般敲打寂静。他低头避开火把光晕，指尖轻触腰间短刃——那是一道藏于衣褶的退路。忽然，一队巡兵从转角逼近，火光映出他布满裂痕的脸。他缓缓放下竹筐，假装咳嗽，将一碗冷粥泼向石缝，借着烟尘与声响掩住呼吸。就在守卫侧目的一瞬，他猛然缩身入墙根，青筋在腕上跳动，仿佛整座荆州城的重量都压在这一息之间。他已踏入敌营腹地，但真正的考验才刚刚开始。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾低垂，关羽将战袍裹紧...
2025-09-26 23:48:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1713
2025-09-26 23:48:05 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=828 预览='{"text": "夜雾如纱，关羽裹紧破旧长袍，低头疾行于粮仓后巷的阴影之间。他肩扛竹筐，筐中堆叠着空陶罐，仿佛真是一名送饭小卒。守卫在墙角踱步，火把映出他脸上一道未愈的旧疤。他故意踉跄一步，竹筐倾倒，陶罐碎裂声惊得守卫侧目。就在那瞬间，他猛然抬手，以袖中暗藏的铁钩勾住墙头瓦片，借力一跃，身形如影掠入粮仓内院。草垛翻飞，尘土弥漫，远处传来犬吠与喝问。他伏身于粮袋堆后，呼吸凝滞——已入敌巢，但耳畔风声已起，步步皆险。", "choices": [{"option": "点燃火油桶引燃草料，制造混乱掩护突袭", "summary": "以烈焰为盾，撕裂敌阵防线", "effects": {"del'
2025-09-26 23:48:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=828 预览='{"text": "夜雾如纱，关羽裹紧破旧长袍，低头疾行于粮仓后巷的阴影之间。他肩扛竹筐，筐中堆叠着空陶罐，仿佛真是一名送饭小卒。守卫在墙角踱步，火把映出他脸上一道未愈的旧疤。他故意踉跄一步，竹筐倾倒，陶罐碎裂声惊得守卫侧目。就在那瞬间，他猛然抬手，以袖中暗藏的铁钩勾住墙头瓦片，借力一跃，身形如影掠入粮仓内院。草垛翻飞'
2025-09-26 23:48:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=828 预览='{"text": "夜雾如纱，关羽裹紧破旧长袍，低头疾行于粮仓后巷的阴影之间。他肩扛竹筐，筐中堆叠着空陶罐，仿佛真是一名送饭小卒。守卫在墙角踱步，火把映出他脸上一道未愈的旧疤。他故意踉跄一步，竹筐倾倒，陶罐碎裂声惊得守卫侧目。就在那瞬间，他猛然抬手，以袖中暗藏的铁钩勾住墙头瓦片，借力一跃，身形如影掠入粮仓内院。草垛翻飞'
2025-09-26 23:48:05 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 199
2025-09-26 23:48:05 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:05 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 199
2025-09-26 23:48:05 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，关羽裹紧破旧长袍，低头疾行于粮仓后巷的阴影之间。他肩扛竹筐，筐中堆叠着空陶罐，仿佛真是一名送饭小卒。守卫在墙角踱步，火把映出他脸上一道未愈的旧疤。他故意踉跄一步，竹筐倾倒，陶罐碎裂声惊得守卫侧目。就在那瞬间，他猛然抬手，以袖中暗藏的铁钩勾住墙头瓦片，借力一跃，身形如影掠入粮仓内院。草垛翻飞，尘土弥漫，远处传来犬吠与喝问。他伏身于粮袋堆后，呼吸凝滞——已入敌巢，但耳畔风声已起，步步皆险。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:05 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，关羽裹紧破旧长...
2025-09-26 23:48:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:48:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1741
2025-09-26 23:48:05 | INFO     | core.story_engine:continue_story:493 - [LLM raw][continue] 长度=861 预览='{"text": "夜风卷起长袍一角，关羽将青龙偃月刀藏于腰后，披风裹身如老卒佝偻。他低垂眉目，一手托着破陶碗，另一手紧握半块冷饼，步履蹒跚地走向粮仓后巷的炊事棚。守卫倚在墙角打盹，鼻息粗重，火把映出他脸上一道旧疤。关羽缓步靠近，突然一声犬吠撕破寂静——那狗嗅到铁锈味，猛然抬头。他不动声色，将手中冷饼轻轻抛向角落，狗扑去吞食，尾巴一甩，竟撞翻了油灯。火焰舔舐草堆，火光骤亮，照见他半边脸庞，也照亮了守卫惊醒的眼瞳。他仍低头，仿佛只是个送饭的苦力，可刀柄已悄然滑入掌心，随时准备出鞘。", "choices": [{"option": "顺势跌倒，佯装被烟呛到咳嗽，借势掩住面容", "summary'
2025-09-26 23:48:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=861 预览='{"text": "夜风卷起长袍一角，关羽将青龙偃月刀藏于腰后，披风裹身如老卒佝偻。他低垂眉目，一手托着破陶碗，另一手紧握半块冷饼，步履蹒跚地走向粮仓后巷的炊事棚。守卫倚在墙角打盹，鼻息粗重，火把映出他脸上一道旧疤。关羽缓步靠近，突然一声犬吠撕破寂静——那狗嗅到铁锈味，猛然抬头。他不动声色，将手中冷饼轻轻抛向角落，狗扑'
2025-09-26 23:48:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=861 预览='{"text": "夜风卷起长袍一角，关羽将青龙偃月刀藏于腰后，披风裹身如老卒佝偻。他低垂眉目，一手托着破陶碗，另一手紧握半块冷饼，步履蹒跚地走向粮仓后巷的炊事棚。守卫倚在墙角打盹，鼻息粗重，火把映出他脸上一道旧疤。关羽缓步靠近，突然一声犬吠撕破寂静——那狗嗅到铁锈味，猛然抬头。他不动声色，将手中冷饼轻轻抛向角落，狗扑'
2025-09-26 23:48:05 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 232
2025-09-26 23:48:05 | INFO     | core.image_service:get_image_for_story:237 - AI图像生成已启用，优先尝试AI生成...
2025-09-26 23:48:05 | INFO     | core.image_service:generate_image_realtime:90 - 开始即时生成图片，故事文本长度: 232
2025-09-26 23:48:05 | INFO     | core.image_service:generate_image_realtime:99 - 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起长袍一角，关羽将青龙偃月刀藏于腰后，披风裹身如老卒佝偻。他低垂眉目，一手托着破陶碗，另一手紧握半块冷饼，步履蹒跚地走向粮仓后巷的炊事棚。守卫倚在墙角打盹，鼻息粗重，火把映出他脸上一道旧疤。关羽缓步靠近，突然一声犬吠撕破寂静——那狗嗅到铁锈味，猛然抬头。他不动声色，将手中冷饼轻轻抛向角落，狗扑去吞食，尾巴一甩，竟撞翻了油灯。火焰舔舐草堆，火光骤亮，照见他半边脸庞，也照亮了守卫惊醒的眼瞳。他仍低头，仿佛只是个送饭的苦力，可刀柄已悄然滑入掌心，随时准备出鞘。. Style: detailed, dramatic lighting, high quality.
2025-09-26 23:48:05 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起长袍一角，关羽将...
2025-09-26 23:48:14 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 772
2025-09-26 23:48:14 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:14 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901693790_077.png
2025-09-26 23:48:14 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901693790_077.png
2025-09-26 23:48:14 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:48:14 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:14 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901693980_169.png
2025-09-26 23:48:14 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901693980_169.png
2025-09-26 23:48:15 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:48:15 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:15 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901693963_454.png
2025-09-26 23:48:15 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901693963_454.png
2025-09-26 23:48:15 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:48:15 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:15 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901694649_426.png
2025-09-26 23:48:15 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901694649_426.png
2025-09-26 23:48:16 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:48:16 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:16 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901696271_574.png
2025-09-26 23:48:16 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901696271_574.png
2025-09-26 23:48:17 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:48:17 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:17 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901696508_781.png
2025-09-26 23:48:17 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901696508_781.png
2025-09-26 23:48:18 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_257c51ffd758b9a10b1e239ceefd1094.png (大小: 1270298 字节)
2025-09-26 23:48:18 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_257c51ffd758b9a10b1e239ceefd1094.png
2025-09-26 23:48:18 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:18 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=67 choice='点燃一支火折子扔向粮仓后院，制造混乱引开守卫注意力'
2025-09-26 23:48:18 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 23:48:18 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_257c51ffd758b9a10b1e239ceefd1094.png
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=67 choice='点燃一支火折子扔向粮仓后院，制造混乱引开守卫注意力', image_url=/static/generated/ai_gen_257c51ffd758b9a10b1e239ceefd1094.png
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=70 parent=67 choice='点燃一支火折子扔向粮仓后院，制造混乱引开守卫注意力'
2025-09-26 23:48:18 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=70 depth=1
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=70 completed, triggered next level depth=1
2025-09-26 23:48:18 | INFO     | core.speculation:_run_pipeline:98 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=5 node=70
2025-09-26 23:48:18 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_6d373423f8c66b5b273b313779f85d90.png (大小: 1218848 字节)
2025-09-26 23:48:18 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_6d373423f8c66b5b273b313779f85d90.png
2025-09-26 23:48:18 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:18 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=68 choice='悄然蹲伏于阴影中，静待钟声落定，以影子贴地滑行逼近侧门'
2025-09-26 23:48:18 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 23:48:18 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_6d373423f8c66b5b273b313779f85d90.png
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=68 choice='悄然蹲伏于阴影中，静待钟声落定，以影子贴地滑行逼近侧门', image_url=/static/generated/ai_gen_6d373423f8c66b5b273b313779f85d90.png
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=71 parent=68 choice='悄然蹲伏于阴影中，静待钟声落定，以影子贴地滑行逼近侧门'
2025-09-26 23:48:18 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=71 depth=1
2025-09-26 23:48:18 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=71 completed, triggered next level depth=1
2025-09-26 23:48:19 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 765
2025-09-26 23:48:19 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:19 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901698702_468.png
2025-09-26 23:48:19 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901698702_468.png
2025-09-26 23:48:19 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_a40e1939cc0e537e62f66a509aa82e05.png (大小: 1243670 字节)
2025-09-26 23:48:19 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_a40e1939cc0e537e62f66a509aa82e05.png
2025-09-26 23:48:19 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:19 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:19 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=67 choice='静立原地，闭目默念桃园誓约，以心神镇定压住心跳'
2025-09-26 23:48:19 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 248
2025-09-26 23:48:19 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_a40e1939cc0e537e62f66a509aa82e05.png
2025-09-26 23:48:19 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=67 choice='静立原地，闭目默念桃园誓约，以心神镇定压住心跳', image_url=/static/generated/ai_gen_a40e1939cc0e537e62f66a509aa82e05.png
2025-09-26 23:48:19 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=72 parent=67 choice='静立原地，闭目默念桃园誓约，以心神镇定压住心跳'
2025-09-26 23:48:19 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=72 depth=1
2025-09-26 23:48:19 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=72 completed, triggered next level depth=1
2025-09-26 23:48:19 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 786
2025-09-26 23:48:19 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:19 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901699485_205.png
2025-09-26 23:48:19 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901699485_205.png
2025-09-26 23:48:20 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_9a5d360b71b90dc7228b77bb16ea9f46.png (大小: 1389000 字节)
2025-09-26 23:48:20 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_9a5d360b71b90dc7228b77bb16ea9f46.png
2025-09-26 23:48:20 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:20 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=67 choice='将铁索甩向墙外树枝，借力翻越石垣，悄无声息落地'
2025-09-26 23:48:20 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 236
2025-09-26 23:48:20 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_9a5d360b71b90dc7228b77bb16ea9f46.png
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=67 choice='将铁索甩向墙外树枝，借力翻越石垣，悄无声息落地', image_url=/static/generated/ai_gen_9a5d360b71b90dc7228b77bb16ea9f46.png
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=73 parent=67 choice='将铁索甩向墙外树枝，借力翻越石垣，悄无声息落地'
2025-09-26 23:48:20 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=73 depth=1
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=73 completed, triggered next level depth=1
2025-09-26 23:48:20 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_c798cd0a2ab6e013294b645c7ec87736.png (大小: 1329593 字节)
2025-09-26 23:48:20 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_c798cd0a2ab6e013294b645c7ec87736.png
2025-09-26 23:48:20 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:20 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=69 choice='猛然跃出，以刀尖挑起草堆点燃火源，制造烟雾掩护'
2025-09-26 23:48:20 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 228
2025-09-26 23:48:20 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_c798cd0a2ab6e013294b645c7ec87736.png
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=69 choice='猛然跃出，以刀尖挑起草堆点燃火源，制造烟雾掩护', image_url=/static/generated/ai_gen_c798cd0a2ab6e013294b645c7ec87736.png
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=74 parent=69 choice='猛然跃出，以刀尖挑起草堆点燃火源，制造烟雾掩护'
2025-09-26 23:48:20 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=74 depth=1
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=74 completed, triggered next level depth=1
2025-09-26 23:48:20 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_3d40974b657d0f837392b712fa04c1b4.png (大小: 1004704 字节)
2025-09-26 23:48:20 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_3d40974b657d0f837392b712fa04c1b4.png
2025-09-26 23:48:20 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:20 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=68 choice='以青龙刀刃轻敲石壁，模仿铃声节奏，诱使守卫误判换班时机'
2025-09-26 23:48:20 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 217
2025-09-26 23:48:20 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_3d40974b657d0f837392b712fa04c1b4.png
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=68 choice='以青龙刀刃轻敲石壁，模仿铃声节奏，诱使守卫误判换班时机', image_url=/static/generated/ai_gen_3d40974b657d0f837392b712fa04c1b4.png
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=75 parent=68 choice='以青龙刀刃轻敲石壁，模仿铃声节奏，诱使守卫误判换班时机'
2025-09-26 23:48:20 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=75 depth=1
2025-09-26 23:48:20 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=75 completed, triggered next level depth=1
2025-09-26 23:48:22 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_d10735087b507c31dd9276b4b776ba7e.png (大小: 1498079 字节)
2025-09-26 23:48:22 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_d10735087b507c31dd9276b4b776ba7e.png
2025-09-26 23:48:22 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:22 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:22 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=69 choice='轻声呼唤远处巡哨，佯装是友军传令兵，试图以口令混入'
2025-09-26 23:48:22 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 232
2025-09-26 23:48:22 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_d10735087b507c31dd9276b4b776ba7e.png
2025-09-26 23:48:22 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=69 choice='轻声呼唤远处巡哨，佯装是友军传令兵，试图以口令混入', image_url=/static/generated/ai_gen_d10735087b507c31dd9276b4b776ba7e.png
2025-09-26 23:48:22 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=76 parent=69 choice='轻声呼唤远处巡哨，佯装是友军传令兵，试图以口令混入'
2025-09-26 23:48:22 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=76 depth=1
2025-09-26 23:48:22 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=76 completed, triggered next level depth=1
2025-09-26 23:48:24 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_77f2618f9df2996e9ed8eca0461a62d5.png (大小: 1457151 字节)
2025-09-26 23:48:24 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_77f2618f9df2996e9ed8eca0461a62d5.png
2025-09-26 23:48:24 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:24 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:24 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=69 choice='悄然攀上墙头，用铁链缠住吊篮，伪装成运送柴薪的民夫潜入'
2025-09-26 23:48:24 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 199
2025-09-26 23:48:24 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_77f2618f9df2996e9ed8eca0461a62d5.png
2025-09-26 23:48:24 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=69 choice='悄然攀上墙头，用铁链缠住吊篮，伪装成运送柴薪的民夫潜入', image_url=/static/generated/ai_gen_77f2618f9df2996e9ed8eca0461a62d5.png
2025-09-26 23:48:24 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=77 parent=69 choice='悄然攀上墙头，用铁链缠住吊篮，伪装成运送柴薪的民夫潜入'
2025-09-26 23:48:24 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=77 depth=1
2025-09-26 23:48:24 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=77 completed, triggered next level depth=1
2025-09-26 23:48:27 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 772
2025-09-26 23:48:27 | INFO     | core.image_service:generate_image_realtime:103 - AI图像生成成功
2025-09-26 23:48:27 | DEBUG    | core.image_service:_extract_image_url:149 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758901707203_335.png
2025-09-26 23:48:27 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758901707203_335.png
2025-09-26 23:48:32 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_22fb66ebb9803221fbbe545de506776f.png (大小: 1395596 字节)
2025-09-26 23:48:32 | INFO     | core.image_service:generate_image_realtime:113 - ✅ 图像已保存到本地: /static/generated/ai_gen_22fb66ebb9803221fbbe545de506776f.png
2025-09-26 23:48:32 | INFO     | core.image_service:get_image_for_story:242 - ✅ AI生成成功，返回AI生成的图像
2025-09-26 23:48:32 | INFO     | core.story_engine:continue_story:575 - 故事继续生成成功
2025-09-26 23:48:32 | DEBUG    | core.speculation:_generate_child_node:235 - [Speculation] story generation completed for parent=68 choice='撕下战袍一角，用血在墙上画出古代兵符图样，试探是否触发隐藏通道'
2025-09-26 23:48:32 | DEBUG    | core.image_service:get_image_for_story:213 - 开始为故事获取图片，故事文本长度: 214
2025-09-26 23:48:32 | DEBUG    | core.image_service:get_image_for_story:223 - Cache hit for story, returning cached image: /static/generated/ai_gen_22fb66ebb9803221fbbe545de506776f.png
2025-09-26 23:48:32 | DEBUG    | core.speculation:_generate_child_node:252 - [Speculation] image generation completed for parent=68 choice='撕下战袍一角，用血在墙上画出古代兵符图样，试探是否触发隐藏通道', image_url=/static/generated/ai_gen_22fb66ebb9803221fbbe545de506776f.png
2025-09-26 23:48:32 | DEBUG    | core.speculation:_generate_child_node:294 - [Speculation] created node=78 parent=68 choice='撕下战袍一角，用血在墙上画出古代兵符图样，试探是否触发隐藏通道'
2025-09-26 23:48:32 | DEBUG    | core.speculation:enqueue:66 - [Speculation] enqueue PIPELINE session=5 node=78 depth=1
2025-09-26 23:48:32 | DEBUG    | core.speculation:_generate_children_pipeline:212 - [Speculation] child node=78 completed, triggered next level depth=1
2025-09-26 23:48:49 | INFO     | api.story:start_new_story:302 - 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 关羽
2025-09-26 23:48:49 | INFO     | api.story:start_new_story:317 - [预生成] 命中缓存，使用预生成的会话和节点: session=5, node=66
2025-09-26 23:48:49 | INFO     | api.story:start_new_story:377 - 新故事生成成功
2025-09-26 23:48:49 | INFO     | api.story:start_new_story:384 - 使用预生成故事，跳过speculation触发: session=5, node=66
2025-09-26 23:55:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:55:42 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-26 23:55:43 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-26 23:55:43 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-26 23:55:43 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-26 23:55:43 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:55:43 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-26 23:55:43 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:55:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:55:43 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-26 23:55:43 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-26 23:55:43 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:55:43 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-26 23:55:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-26 23:55:44 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-26 23:55:44 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-26 23:55:44 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-26 23:55:44 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-26 23:55:44 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-26 23:56:33 | INFO     | api.story:prepare_start_level:214 - [PrepareStart] 🚀 开始生成故事概要，愿望：黄忠...
2025-09-26 23:56:33 | DEBUG    | api.story:prepare_start_level:216 - [PrepareStart] 构建提示词上下文...
2025-09-26 23:56:33 | DEBUG    | api.story:prepare_start_level:218 - [PrepareStart] 上下文构建完成，推荐章节数: 9
2025-09-26 23:56:33 | INFO     | api.story:prepare_start_level:225 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 473
2025-09-26 23:56:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:56:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 906
2025-09-26 23:56:34 | INFO     | api.story:prepare_start_level:227 - [PrepareStart] ✅ LLM响应完成，响应长度: 226
2025-09-26 23:56:34 | INFO     | api.story:prepare_start_level:254 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-26 23:56:34 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 解析结果 - title: 黄忠重生：定军山之誓, background: 公元219年，汉中之战烽火连天。黄忠身为蜀汉老将，却因年迈被轻视。他立誓于定军山下，以残躯破敌，改写..., quest: 在定军山战役前夺取天荡山，改变历史节点...
2025-09-26 23:56:34 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:56:34 | INFO     | api.story:prepare_start_level:298 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:56:34 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:56:34 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '黄忠'
2025-09-26 23:56:37 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:56:37 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1318
2025-09-26 23:56:37 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=786 预览='{"text": "夜色如墨，烽火台的残影在风中摇曳。黄忠立于断崖边缘，手中青铜箭簇映着星火，目光穿透迷雾——前方三里外，便是曹军粮道的咽喉要塞。敌骑巡哨如梭，火把连成暗流。他已知此地必有伏兵，却也明白，若不截断粮草，汉中战局将如沙塔崩塌。远处传来马蹄声渐近，他紧握弓弦，耳畔响起昔日主公的低语：‘老将虽迟，不可无志。’此刻，命运的箭镞已搭上弦。", "choices": [{"option": "点燃火把佯装溃兵，借混乱冲入敌阵核心", "summary": "以假乱真，制造战场错觉", "effects": {"delta_progress": 12, "delta_risk": 9, "d'
2025-09-26 23:56:37 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=786 预览='{"text": "夜色如墨，烽火台的残影在风中摇曳。黄忠立于断崖边缘，手中青铜箭簇映着星火，目光穿透迷雾——前方三里外，便是曹军粮道的咽喉要塞。敌骑巡哨如梭，火把连成暗流。他已知此地必有伏兵，却也明白，若不截断粮草，汉中战局将如沙塔崩塌。远处传来马蹄声渐近，他紧握弓弦，耳畔响起昔日主公的低语：‘老将虽迟，不可无志。’'
2025-09-26 23:56:37 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=786 预览='{"text": "夜色如墨，烽火台的残影在风中摇曳。黄忠立于断崖边缘，手中青铜箭簇映着星火，目光穿透迷雾——前方三里外，便是曹军粮道的咽喉要塞。敌骑巡哨如梭，火把连成暗流。他已知此地必有伏兵，却也明白，若不截断粮草，汉中战局将如沙塔崩塌。远处传来马蹄声渐近，他紧握弓弦，耳畔响起昔日主公的低语：‘老将虽迟，不可无志。’'
2025-09-26 23:56:37 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 163
2025-09-26 23:56:37 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 夜色如墨，烽火台的残影在风中摇曳。黄忠立于断崖边缘，手中青铜箭簇映着星火，目光穿透迷雾——前方三里外...
2025-09-26 23:56:37 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: background1.jpg
2025-09-26 23:56:37 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/background1.jpg
2025-09-26 23:56:37 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-26 23:56:37 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=163
2025-09-26 23:56:37 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=6
2025-09-26 23:56:37 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=79
2025-09-26 23:56:37 | INFO     | api.story:_background_generate_with_pregeneration:90 - [预生成] 开始为首节点异步生成AI图像: node_id=79
2025-09-26 23:56:37 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 163
2025-09-26 23:56:37 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:56:37 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-26 23:56:37 | INFO     | core.image_storage:__init__:27 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-26 23:56:37 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:56:37 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，烽火台的残影在...
2025-09-26 23:56:37 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:56:37 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，烽火台的残影在...
2025-09-26 23:56:51 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:56:51 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:56:51 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:56:51 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902211207_249.png
2025-09-26 23:56:51 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902211207_249.png
2025-09-26 23:56:51 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:56:51 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902211207_249.png
2025-09-26 23:56:55 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_8067aaf8f9366014a9a0ed708c4ccf03.png (大小: 1068024 字节)
2025-09-26 23:56:55 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_8067aaf8f9366014a9a0ed708c4ccf03.png
2025-09-26 23:56:55 | INFO     | api.story:_background_generate_with_pregeneration:101 - [预生成] 首节点AI图像生成成功: node_id=79 image_url=/static/generated/ai_gen_8067aaf8f9366014a9a0ed708c4ccf03.png
2025-09-26 23:56:55 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=79 depth=3
2025-09-26 23:56:55 | INFO     | api.story:_background_generate_with_pregeneration:121 - [预生成] 已触发speculation预生成: session=6, node=79
2025-09-26 23:56:55 | INFO     | api.story:_background_generate_with_pregeneration:123 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=6
2025-09-26 23:56:55 | DEBUG    | api.story:_background_generate_with_pregeneration:135 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-26 23:56:55 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=79
2025-09-26 23:56:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=79 choice='点燃火把佯装溃兵，借混乱冲入敌阵核心'
2025-09-26 23:56:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=79 choice='攀上岩壁潜行至高处，用箭矢射落哨塔灯笼'
2025-09-26 23:56:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=79 choice='点燃火把佯装溃兵，借混乱冲入敌阵核心'
2025-09-26 23:56:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=79 choice='吹响古旧号角，模仿敌军传令节奏引开守卫'
2025-09-26 23:56:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=79 choice='攀上岩壁潜行至高处，用箭矢射落哨塔灯笼'
2025-09-26 23:56:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃火把佯装溃兵，借混乱冲入敌阵核心
2025-09-26 23:56:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=79 choice='吹响古旧号角，模仿敌军传令节奏引开守卫'
2025-09-26 23:56:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 攀上岩壁潜行至高处，用箭矢射落哨塔灯笼
2025-09-26 23:56:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 吹响古旧号角，模仿敌军传令节奏引开守卫
2025-09-26 23:56:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:56:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1493
2025-09-26 23:56:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=804 预览='{"text": "风卷残烬，黄忠的影子被拉得细长如刃。他凝视着粮道入口那道铁栅门，门后火光摇曳，哨兵的脚步声规律而沉重。忽然，远处传来战马嘶鸣，一支骑兵小队正从侧翼疾驰而来——是援军？还是陷阱？他屏息凝神，指尖轻抚箭囊，心中默念：若今夜不破此关，明日便是蜀军的葬礼。他望向断崖边缘那棵枯松，树干上刻着当年与主公的誓约。此刻，箭在弦上，命运只待一瞬抉择。", "choices": [{"option": "引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入", "summary": "以奇制胜，用视觉冲击扰乱敌阵", "effects": {"delta_progress": 12, "delta_'
2025-09-26 23:56:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=804 预览='{"text": "风卷残烬，黄忠的影子被拉得细长如刃。他凝视着粮道入口那道铁栅门，门后火光摇曳，哨兵的脚步声规律而沉重。忽然，远处传来战马嘶鸣，一支骑兵小队正从侧翼疾驰而来——是援军？还是陷阱？他屏息凝神，指尖轻抚箭囊，心中默念：若今夜不破此关，明日便是蜀军的葬礼。他望向断崖边缘那棵枯松，树干上刻着当年与主公的誓约。'
2025-09-26 23:56:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=804 预览='{"text": "风卷残烬，黄忠的影子被拉得细长如刃。他凝视着粮道入口那道铁栅门，门后火光摇曳，哨兵的脚步声规律而沉重。忽然，远处传来战马嘶鸣，一支骑兵小队正从侧翼疾驰而来——是援军？还是陷阱？他屏息凝神，指尖轻抚箭囊，心中默念：若今夜不破此关，明日便是蜀军的葬礼。他望向断崖边缘那棵枯松，树干上刻着当年与主公的誓约。'
2025-09-26 23:56:59 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 167
2025-09-26 23:56:59 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 风卷残烬，黄忠的影子被拉得细长如刃。他凝视着粮道入口那道铁栅门，门后火光摇曳，哨兵的脚步声规律而沉重...
2025-09-26 23:56:59 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: space_station.jpg
2025-09-26 23:56:59 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/space_station.jpg
2025-09-26 23:56:59 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=79 choice='攀上岩壁潜行至高处，用箭矢射落哨塔灯笼' text_length=167
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=79 choice='攀上岩壁潜行至高处，用箭矢射落哨塔灯笼'
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=80 parent=79 choice='攀上岩壁潜行至高处，用箭矢射落哨塔灯笼'
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=80 text_length=167
2025-09-26 23:56:59 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 167
2025-09-26 23:56:59 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:56:59 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:56:59 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残烬，黄忠的影子被拉...
2025-09-26 23:56:59 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:56:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残烬，黄忠的影子被拉...
2025-09-26 23:56:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:56:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1506
2025-09-26 23:56:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=813 预览='{"text": "夜风卷起黄忠的战袍，箭镞在星辉下泛着冷光。他凝视着粮道入口那排火把，忽而眯眼——守卫轮班间隙尚有三息空档，但东侧哨塔上，一名斥候正缓缓抬首。若此时突袭，必惊动全营；可若退避，粮车将如洪流般驶过。他指尖轻抚箭羽，脑中闪过少年时在汉水边射落飞雁的刹那。那时的箭，从不为杀戮而发，只为守护。如今，箭锋所指，是山河存亡的抉择。", "choices": [{"option": "引弓射落东塔哨兵的火把，借暗影掩护疾冲入关", "summary": "以迅雷之势制造混乱，趁机突入", "effects": {"delta_progress": 12, "delta_risk": 9, '
2025-09-26 23:56:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=813 预览='{"text": "夜风卷起黄忠的战袍，箭镞在星辉下泛着冷光。他凝视着粮道入口那排火把，忽而眯眼——守卫轮班间隙尚有三息空档，但东侧哨塔上，一名斥候正缓缓抬首。若此时突袭，必惊动全营；可若退避，粮车将如洪流般驶过。他指尖轻抚箭羽，脑中闪过少年时在汉水边射落飞雁的刹那。那时的箭，从不为杀戮而发，只为守护。如今，箭锋所指，'
2025-09-26 23:56:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=813 预览='{"text": "夜风卷起黄忠的战袍，箭镞在星辉下泛着冷光。他凝视着粮道入口那排火把，忽而眯眼——守卫轮班间隙尚有三息空档，但东侧哨塔上，一名斥候正缓缓抬首。若此时突袭，必惊动全营；可若退避，粮车将如洪流般驶过。他指尖轻抚箭羽，脑中闪过少年时在汉水边射落飞雁的刹那。那时的箭，从不为杀戮而发，只为守护。如今，箭锋所指，'
2025-09-26 23:56:59 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 159
2025-09-26 23:56:59 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 夜风卷起黄忠的战袍，箭镞在星辉下泛着冷光。他凝视着粮道入口那排火把，忽而眯眼——守卫轮班间隙尚有三息...
2025-09-26 23:56:59 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: cyberpunk_city.jpg
2025-09-26 23:56:59 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/cyberpunk_city.jpg
2025-09-26 23:56:59 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=79 choice='吹响古旧号角，模仿敌军传令节奏引开守卫' text_length=159
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=79 choice='吹响古旧号角，模仿敌军传令节奏引开守卫'
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=81 parent=79 choice='吹响古旧号角，模仿敌军传令节奏引开守卫'
2025-09-26 23:56:59 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=81 text_length=159
2025-09-26 23:56:59 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 159
2025-09-26 23:56:59 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:56:59 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:56:59 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起黄忠的战袍，箭镞...
2025-09-26 23:56:59 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:56:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起黄忠的战袍，箭镞...
2025-09-26 23:57:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1569
2025-09-26 23:57:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=914 预览='{"text": "夜风卷起黄忠的战袍，如一面残破的旌旗猎猎作响。他凝视着粮道入口处那座摇曳的木楼——守卫轮值将至，火把在风中忽明忽暗。远处传来更鼓声，三更已过，正是最易疏忽的时辰。他缓缓抽出一支箭，箭镞上刻着‘忠’字，那是当年主公亲赐的信物。他忽然俯身，在沙地上画出一道蜿蜒的火线，仿佛要将整条粮道烧成灰烬。可就在他欲动之际，一缕焦香自敌营深处飘来，是新烤的胡麻饼——这味道，竟与当年汉中军营的炊烟一模一样。他瞳孔微缩：若非陷阱，便是有人在模仿旧日记忆，诱他入局。", "choices": [{"option": "点燃随身火油，引燃草堆制造混乱，趁乱突袭主门", "summary": "以烈焰'
2025-09-26 23:57:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=914 预览='{"text": "夜风卷起黄忠的战袍，如一面残破的旌旗猎猎作响。他凝视着粮道入口处那座摇曳的木楼——守卫轮值将至，火把在风中忽明忽暗。远处传来更鼓声，三更已过，正是最易疏忽的时辰。他缓缓抽出一支箭，箭镞上刻着‘忠’字，那是当年主公亲赐的信物。他忽然俯身，在沙地上画出一道蜿蜒的火线，仿佛要将整条粮道烧成灰烬。可就在他欲'
2025-09-26 23:57:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=914 预览='{"text": "夜风卷起黄忠的战袍，如一面残破的旌旗猎猎作响。他凝视着粮道入口处那座摇曳的木楼——守卫轮值将至，火把在风中忽明忽暗。远处传来更鼓声，三更已过，正是最易疏忽的时辰。他缓缓抽出一支箭，箭镞上刻着‘忠’字，那是当年主公亲赐的信物。他忽然俯身，在沙地上画出一道蜿蜒的火线，仿佛要将整条粮道烧成灰烬。可就在他欲'
2025-09-26 23:57:00 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 223
2025-09-26 23:57:00 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 夜风卷起黄忠的战袍，如一面残破的旌旗猎猎作响。他凝视着粮道入口处那座摇曳的木楼——守卫轮值将至，火把...
2025-09-26 23:57:00 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: background1.jpg
2025-09-26 23:57:00 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/background1.jpg
2025-09-26 23:57:00 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:00 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=79 choice='点燃火把佯装溃兵，借混乱冲入敌阵核心' text_length=223
2025-09-26 23:57:00 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=79 choice='点燃火把佯装溃兵，借混乱冲入敌阵核心'
2025-09-26 23:57:00 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=82 parent=79 choice='点燃火把佯装溃兵，借混乱冲入敌阵核心'
2025-09-26 23:57:00 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=82 text_length=223
2025-09-26 23:57:00 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 223
2025-09-26 23:57:00 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:00 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:00 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起黄忠的战袍，如一...
2025-09-26 23:57:00 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起黄忠的战袍，如一...
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:328 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 黄忠...
2025-09-26 23:57:04 | DEBUG    | api.story:start_new_story:331 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-26 23:57:04 | DEBUG    | api.story:start_new_story:336 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:3650419467142261436
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:340 - [Start] 🔍 缓存查询结果: 命中
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:346 - [预生成] 命中缓存，使用预生成的会话和节点: session=6, node=79
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:367 - [Start] ✅ 使用预生成节点: session_id=6, node_id=79
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:423 - [Start] 🎉 新故事生成成功！session_id=6, node_id=79
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:424 - [Start] 📊 响应详情 - 文本长度: 163, 选择数: 3, 图片: /static/generated/ai_gen_8067aaf8f9366014a9a0ed708c4ccf03.png
2025-09-26 23:57:04 | INFO     | api.story:start_new_story:432 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=6, node=79
2025-09-26 23:57:11 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:11 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:11 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:11 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902230815_748.png
2025-09-26 23:57:11 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902230815_748.png
2025-09-26 23:57:11 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:11 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902230815_748.png
2025-09-26 23:57:13 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:13 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:13 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:13 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902232473_975.png
2025-09-26 23:57:13 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902232473_975.png
2025-09-26 23:57:13 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:13 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902232473_975.png
2025-09-26 23:57:13 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:13 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:13 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:13 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902232777_493.png
2025-09-26 23:57:13 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902232777_493.png
2025-09-26 23:57:13 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:13 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902232777_493.png
2025-09-26 23:57:15 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_66840c8bf3fdb9733a43f1ee39d02547.png (大小: 1350552 字节)
2025-09-26 23:57:15 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_66840c8bf3fdb9733a43f1ee39d02547.png
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=82 image_url=/static/generated/ai_gen_66840c8bf3fdb9733a43f1ee39d02547.png
2025-09-26 23:57:15 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=82 depth=2
2025-09-26 23:57:15 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=82 completed, triggered next level depth=2
2025-09-26 23:57:15 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=82
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=82 choice='点燃随身火油，引燃草堆制造混乱，趁乱突袭主门'
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=82 choice='摘下头盔轻掷于地，让铜铃声惊扰马群，借乱潜行至侧翼'
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=82 choice='点燃随身火油，引燃草堆制造混乱，趁乱突袭主门'
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=82 choice='悄然退至崖边，用箭矢射断敌方信号绳索，使其误判我军动向'
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=82 choice='摘下头盔轻掷于地，让铜铃声惊扰马群，借乱潜行至侧翼'
2025-09-26 23:57:15 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃随身火油，引燃草堆制造混乱，趁乱突袭主门
2025-09-26 23:57:15 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=82 choice='悄然退至崖边，用箭矢射断敌方信号绳索，使其误判我军动向'
2025-09-26 23:57:15 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 摘下头盔轻掷于地，让铜铃声惊扰马群，借乱潜行至侧翼
2025-09-26 23:57:15 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然退至崖边，用箭矢射断敌方信号绳索，使其误判我军动向
2025-09-26 23:57:16 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_9e418e5209a6bfea6212294bd87b3ead.png (大小: 1523024 字节)
2025-09-26 23:57:16 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_9e418e5209a6bfea6212294bd87b3ead.png
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=81 image_url=/static/generated/ai_gen_9e418e5209a6bfea6212294bd87b3ead.png
2025-09-26 23:57:16 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=81 depth=2
2025-09-26 23:57:16 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=81 completed, triggered next level depth=2
2025-09-26 23:57:16 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=81
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=81 choice='引弓射落东塔哨兵的火把，借暗影掩护疾冲入关'
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=81 choice='引弓射落东塔哨兵的火把，借暗影掩护疾冲入关'
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=81 choice='将一支带火的箭射向远处草堆，引燃野火佯作大军来袭'
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=81 choice='悄然卸下铠甲，伏于溪畔石后，静待敌军巡哨经过'
2025-09-26 23:57:16 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 引弓射落东塔哨兵的火把，借暗影掩护疾冲入关
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=81 choice='将一支带火的箭射向远处草堆，引燃野火佯作大军来袭'
2025-09-26 23:57:16 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=81 choice='悄然卸下铠甲，伏于溪畔石后，静待敌军巡哨经过'
2025-09-26 23:57:16 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将一支带火的箭射向远处草堆，引燃野火佯作大军来袭
2025-09-26 23:57:16 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然卸下铠甲，伏于溪畔石后，静待敌军巡哨经过
2025-09-26 23:57:18 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_ddb5c4daf50f280a15278b867cd33e4e.png (大小: 1759819 字节)
2025-09-26 23:57:18 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_ddb5c4daf50f280a15278b867cd33e4e.png
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=80 image_url=/static/generated/ai_gen_ddb5c4daf50f280a15278b867cd33e4e.png
2025-09-26 23:57:18 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=80 depth=2
2025-09-26 23:57:18 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=80 completed, triggered next level depth=2
2025-09-26 23:57:18 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=80
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=80 choice='引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入'
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=80 choice='引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入'
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=80 choice='折断枯枝模拟脚步声，佯装巡逻队从另一侧靠近，诱敌分心'
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=80 choice='将箭矢绑于石块，投掷至敌营深处，引燃草堆制造火势'
2025-09-26 23:57:18 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=80 choice='折断枯枝模拟脚步声，佯装巡逻队从另一侧靠近，诱敌分心'
2025-09-26 23:57:18 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=80 choice='将箭矢绑于石块，投掷至敌营深处，引燃草堆制造火势'
2025-09-26 23:57:18 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 折断枯枝模拟脚步声，佯装巡逻队从另一侧靠近，诱敌分心
2025-09-26 23:57:18 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将箭矢绑于石块，投掷至敌营深处，引燃草堆制造火势
2025-09-26 23:57:19 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:19 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1784
2025-09-26 23:57:19 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=911 预览='{"text": "黄忠将火把插进沙地，火光在风中摇曳如垂死之眼。他扯下战袍一角裹住头脸，又从怀中掏出半块焦黑的胡麻饼——正是那缕香气的来源。他猛地将饼砸向远处枯树，火焰骤然腾起，浓烟滚滚。敌营顿时骚动，哨兵呼喝着朝火源奔去。趁着混乱，黄忠低伏身形，如影般掠过断崖边缘，踏着碎石奔向粮道入口。守卫正忙于扑火，未及察觉一道黑影已贴着墙根滑入暗巷。他右手紧握青铜箭，左手却悄然摸向腰间那枚刻有‘忠’字的铜铃——若真有埋伏，这铃声便是唯一的暗号。前方木楼的窗棂忽明忽暗，仿佛有人在窥视。他屏息凝神，脚步却未停。", "choices": [{"option": "将铜铃轻摇三声，试探是否有应和者", "s'
2025-09-26 23:57:19 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=911 预览='{"text": "黄忠将火把插进沙地，火光在风中摇曳如垂死之眼。他扯下战袍一角裹住头脸，又从怀中掏出半块焦黑的胡麻饼——正是那缕香气的来源。他猛地将饼砸向远处枯树，火焰骤然腾起，浓烟滚滚。敌营顿时骚动，哨兵呼喝着朝火源奔去。趁着混乱，黄忠低伏身形，如影般掠过断崖边缘，踏着碎石奔向粮道入口。守卫正忙于扑火，未及察觉一道'
2025-09-26 23:57:19 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=911 预览='{"text": "黄忠将火把插进沙地，火光在风中摇曳如垂死之眼。他扯下战袍一角裹住头脸，又从怀中掏出半块焦黑的胡麻饼——正是那缕香气的来源。他猛地将饼砸向远处枯树，火焰骤然腾起，浓烟滚滚。敌营顿时骚动，哨兵呼喝着朝火源奔去。趁着混乱，黄忠低伏身形，如影般掠过断崖边缘，踏着碎石奔向粮道入口。守卫正忙于扑火，未及察觉一道'
2025-09-26 23:57:19 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 242
2025-09-26 23:57:19 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠将火把插进沙地，火光在风中摇曳如垂死之眼。他扯下战袍一角裹住头脸，又从怀中掏出半块焦黑的胡麻饼—...
2025-09-26 23:57:19 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: space_station.jpg
2025-09-26 23:57:19 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/space_station.jpg
2025-09-26 23:57:19 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:19 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=82 choice='点燃随身火油，引燃草堆制造混乱，趁乱突袭主门' text_length=242
2025-09-26 23:57:19 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=82 choice='点燃随身火油，引燃草堆制造混乱，趁乱突袭主门'
2025-09-26 23:57:19 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=83 parent=82 choice='点燃随身火油，引燃草堆制造混乱，趁乱突袭主门'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=83 text_length=242
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 242
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠将火把插进沙地，火光...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠将火把插进沙地，火光...
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1795
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=905 预览='{"text": "黄忠将火把猛地掷向沙地，火焰瞬间腾起，映红半边崖壁。他撕下战袍一角裹住手臂，借着火光佯装溃兵踉跄奔逃，口中嘶喊着汉中军的暗号。敌哨见状大喜，以为是败退的斥候，竟有两人策马迎上。就在他们勒马欲问时，黄忠猛然转身，箭已离弦——一箭穿喉，另一箭破风直取马首。火光中，他如孤狼般冲入敌阵，衣袍翻飞如残旗，手中青铜箭镞在夜风中发出低鸣。远处传来警钟，粮道两侧火把骤然亮起，无数弓手从暗影中现身，箭雨如蝗。他伏身滚入塌陷的粮车堆，耳畔尽是铁甲碰撞与战马嘶鸣，而那缕焦香仍在风中飘荡，仿佛来自另一个时空的召唤。", "choices": [{"option": "以断箭为引，点燃粮车引信，制造'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=905 预览='{"text": "黄忠将火把猛地掷向沙地，火焰瞬间腾起，映红半边崖壁。他撕下战袍一角裹住手臂，借着火光佯装溃兵踉跄奔逃，口中嘶喊着汉中军的暗号。敌哨见状大喜，以为是败退的斥候，竟有两人策马迎上。就在他们勒马欲问时，黄忠猛然转身，箭已离弦——一箭穿喉，另一箭破风直取马首。火光中，他如孤狼般冲入敌阵，衣袍翻飞如残旗，手中'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=905 预览='{"text": "黄忠将火把猛地掷向沙地，火焰瞬间腾起，映红半边崖壁。他撕下战袍一角裹住手臂，借着火光佯装溃兵踉跄奔逃，口中嘶喊着汉中军的暗号。敌哨见状大喜，以为是败退的斥候，竟有两人策马迎上。就在他们勒马欲问时，黄忠猛然转身，箭已离弦——一箭穿喉，另一箭破风直取马首。火光中，他如孤狼般冲入敌阵，衣袍翻飞如残旗，手中'
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 248
2025-09-26 23:57:20 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠将火把猛地掷向沙地，火焰瞬间腾起，映红半边崖壁。他撕下战袍一角裹住手臂，借着火光佯装溃兵踉跄奔逃...
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: background1.jpg
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/background1.jpg
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=82 choice='摘下头盔轻掷于地，让铜铃声惊扰马群，借乱潜行至侧翼' text_length=248
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=82 choice='摘下头盔轻掷于地，让铜铃声惊扰马群，借乱潜行至侧翼'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=84 parent=82 choice='摘下头盔轻掷于地，让铜铃声惊扰马群，借乱潜行至侧翼'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=84 text_length=248
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 248
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠将火把猛地掷向沙地，...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠将火把猛地掷向沙地，...
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1733
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=898 预览='{"text": "黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中的节奏，吹出一串错落有致的军令信号——三短一长，二短一长，正是曹军夜间传讯的暗码。远处哨塔上的斥候猛然抬头，火把微颤，似乎在辨认这突如其来的呼唤。片刻后，东侧守卫营帐内传来急促脚步声，火光晃动，一名将领正下令调兵应援。粮道入口的巡哨开始向东南方向移动，空档如裂开的河床。黄忠瞳孔骤缩，手指紧握箭囊——这是千载难逢的破局之机，可若被识破，号角之声将成为招来杀身之祸的引信。", "choices": [{"option": "趁敌阵未稳，以孤身之姿疾冲粮道核心，直取主仓", "su'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=898 预览='{"text": "黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中的节奏，吹出一串错落有致的军令信号——三短一长，二短一长，正是曹军夜间传讯的暗码。远处哨塔上的斥候猛然抬头，火把微颤，似乎在辨认这突如其来的呼唤。片刻后，东侧守卫营帐内传来急促脚步声，火光晃动，一名将'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=898 预览='{"text": "黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中的节奏，吹出一串错落有致的军令信号——三短一长，二短一长，正是曹军夜间传讯的暗码。远处哨塔上的斥候猛然抬头，火把微颤，似乎在辨认这突如其来的呼唤。片刻后，东侧守卫营帐内传来急促脚步声，火光晃动，一名将'
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 235
2025-09-26 23:57:20 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中...
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: cyberpunk_city.jpg
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/cyberpunk_city.jpg
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=81 choice='引弓射落东塔哨兵的火把，借暗影掩护疾冲入关' text_length=235
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=81 choice='引弓射落东塔哨兵的火把，借暗影掩护疾冲入关'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=85 parent=81 choice='引弓射落东塔哨兵的火把，借暗影掩护疾冲入关'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=85 text_length=235
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 235
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，将那支斑...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，将那支斑...
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1699
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=860 预览='{"text": "黄忠深吸一口气，将古旧号角抵在唇边。铜管在夜风中微微震颤，他依着记忆中的节奏，吹出一串短促而错落的哨音——那是曹军夜间传令的暗语。号声初起时如寒鸦掠空，第二声却骤然扭曲，仿佛被风吹散的残梦。东侧哨塔的斥候猛然抬头，火把摇晃间目光扫过崖壁，却未察觉那声音正从三里外的断崖回荡而来。片刻后，粮道入口的守卫果然骚动，马蹄声由远及近，竟真朝断崖方向奔去。黄忠凝神屏息，弓弦轻颤，箭镞已悄然对准了那条暴露的缝隙——但更远处，另一座哨塔的火光正缓缓亮起，似有新的警觉正在苏醒。", "choices": [{"option": "趁敌军注意力转移，疾速攀岩突袭粮车核心", "summary"'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=860 预览='{"text": "黄忠深吸一口气，将古旧号角抵在唇边。铜管在夜风中微微震颤，他依着记忆中的节奏，吹出一串短促而错落的哨音——那是曹军夜间传令的暗语。号声初起时如寒鸦掠空，第二声却骤然扭曲，仿佛被风吹散的残梦。东侧哨塔的斥候猛然抬头，火把摇晃间目光扫过崖壁，却未察觉那声音正从三里外的断崖回荡而来。片刻后，粮道入口的守卫'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=860 预览='{"text": "黄忠深吸一口气，将古旧号角抵在唇边。铜管在夜风中微微震颤，他依着记忆中的节奏，吹出一串短促而错落的哨音——那是曹军夜间传令的暗语。号声初起时如寒鸦掠空，第二声却骤然扭曲，仿佛被风吹散的残梦。东侧哨塔的斥候猛然抬头，火把摇晃间目光扫过崖壁，却未察觉那声音正从三里外的断崖回荡而来。片刻后，粮道入口的守卫'
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 232
2025-09-26 23:57:20 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠深吸一口气，将古旧号角抵在唇边。铜管在夜风中微微震颤，他依着记忆中的节奏，吹出一串短促而错落的哨...
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: rebirth_gate_placeholder.png
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/rebirth_gate_placeholder.png
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=81 choice='将一支带火的箭射向远处草堆，引燃野火佯作大军来袭' text_length=232
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=81 choice='将一支带火的箭射向远处草堆，引燃野火佯作大军来袭'
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1766
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=916 预览='{"text": "黄忠猛然将火把掷向枯草堆，烈焰腾起如血色长蛇，映红半边天际。他撕下战袍一角裹住手臂，点燃后高举过头，踉跄奔向敌营入口——仿佛一名被追杀的溃兵，衣袍焦黑，脚步踉跄。守卫惊疑抬头，火光中只见一人披发狂奔，口中呜咽着模糊的军令。就在他们迟疑瞬间，黄忠已借烟尘掩护，一头撞入粮道主门的阴影之下。风卷起灰烬，如亡魂低语；远处传来马蹄急响，是巡哨正朝这边逼近。他伏身于倒木之后，耳畔听见敌卒低声议论：‘那不是张郃部的残兵？’——可张郃早已阵亡三载。这谎言，竟连敌人都信了。", "choices": [{"option": "趁乱混入粮仓，用火油点燃堆积的草料", "summary": "以'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=916 预览='{"text": "黄忠猛然将火把掷向枯草堆，烈焰腾起如血色长蛇，映红半边天际。他撕下战袍一角裹住手臂，点燃后高举过头，踉跄奔向敌营入口——仿佛一名被追杀的溃兵，衣袍焦黑，脚步踉跄。守卫惊疑抬头，火光中只见一人披发狂奔，口中呜咽着模糊的军令。就在他们迟疑瞬间，黄忠已借烟尘掩护，一头撞入粮道主门的阴影之下。风卷起灰烬，如'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=916 预览='{"text": "黄忠猛然将火把掷向枯草堆，烈焰腾起如血色长蛇，映红半边天际。他撕下战袍一角裹住手臂，点燃后高举过头，踉跄奔向敌营入口——仿佛一名被追杀的溃兵，衣袍焦黑，脚步踉跄。守卫惊疑抬头，火光中只见一人披发狂奔，口中呜咽着模糊的军令。就在他们迟疑瞬间，黄忠已借烟尘掩护，一头撞入粮道主门的阴影之下。风卷起灰烬，如'
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 230
2025-09-26 23:57:20 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠猛然将火把掷向枯草堆，烈焰腾起如血色长蛇，映红半边天际。他撕下战袍一角裹住手臂，点燃后高举过头，...
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: rebirth_gate_placeholder.png
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/rebirth_gate_placeholder.png
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=82 choice='悄然退至崖边，用箭矢射断敌方信号绳索，使其误判我军动向' text_length=230
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=82 choice='悄然退至崖边，用箭矢射断敌方信号绳索，使其误判我军动向'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=86 parent=81 choice='将一支带火的箭射向远处草堆，引燃野火佯作大军来袭'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=86 text_length=232
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 232
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，将古旧号...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，将古旧号...
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=87 parent=82 choice='悄然退至崖边，用箭矢射断敌方信号绳索，使其误判我军动向'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=87 text_length=230
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 230
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠猛然将火把掷向枯草堆...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠猛然将火把掷向枯草堆...
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1692
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=856 预览='{"text": "黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中的敌军传令节奏，吹出三短一长的信号——那是曹军夜间调兵的暗号。号声未落，东侧哨塔上的斥候猛然抬头，火把微颤，随即挥手示意。片刻后，粮道入口的守卫竟真开始移动，火把交错，人影晃动，仿佛真的有小队巡营经过。黄忠紧握弓弦，目光如刃，盯住那短暂松动的防线。然而，远处马蹄声骤然急促，一支精骑正从侧翼疾驰而来——有人识破了这声号角！夜风卷起尘土，箭羽在星下微微发烫。", "choices": [{"option": "借号角余音掩护，趁乱射杀主将", "summary": "以声为幕，直'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=856 预览='{"text": "黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中的敌军传令节奏，吹出三短一长的信号——那是曹军夜间调兵的暗号。号声未落，东侧哨塔上的斥候猛然抬头，火把微颤，随即挥手示意。片刻后，粮道入口的守卫竟真开始移动，火把交错，人影晃动，仿佛真的有小队巡营经过'
2025-09-26 23:57:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=856 预览='{"text": "黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中的敌军传令节奏，吹出三短一长的信号——那是曹军夜间调兵的暗号。号声未落，东侧哨塔上的斥候猛然抬头，火把微颤，随即挥手示意。片刻后，粮道入口的守卫竟真开始移动，火把交错，人影晃动，仿佛真的有小队巡营经过'
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 228
2025-09-26 23:57:20 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠深吸一口气，将那支斑驳的青铜号角贴上唇边。号角在风中发出低沉呜咽，如远古战魂的叹息。他依着记忆中...
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: fantasy_castle.jpg
2025-09-26 23:57:20 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/fantasy_castle.jpg
2025-09-26 23:57:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=81 choice='悄然卸下铠甲，伏于溪畔石后，静待敌军巡哨经过' text_length=228
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=81 choice='悄然卸下铠甲，伏于溪畔石后，静待敌军巡哨经过'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=88 parent=81 choice='悄然卸下铠甲，伏于溪畔石后，静待敌军巡哨经过'
2025-09-26 23:57:20 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=88 text_length=228
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 228
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:20 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，将那支斑...
2025-09-26 23:57:20 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，将那支斑...
2025-09-26 23:57:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1673
2025-09-26 23:57:22 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=834 预览='{"text": "黄忠弓身贴岩，指尖抠进石缝，借着风声掩护攀上断崖。夜雾如纱，他借着残月微光，在峭壁间如鬼影游走。至顶峰时俯瞰，哨塔灯笼悬于高柱，火光摇曳如心跳。他取箭搭弦，青铜箭镞在冷风中轻颤，仿佛与星辰共鸣。一息之间，箭出如电——火光骤灭，塔上警铃未响，只余一声闷响坠地。暗处传来守兵惊疑的低语，而粮道入口的阴影里，一道黑影正悄然滑出，直奔铁栅门。黄忠未动，目光却已锁住那道缝隙，他知道，真正的试探才刚刚开始。", "choices": [{"option": "以飞石引开巡逻骑兵，趁其回头时突袭粮车", "summary": "借动静扰乱敌军节奏，制造混乱突破口", "effects": '
2025-09-26 23:57:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=834 预览='{"text": "黄忠弓身贴岩，指尖抠进石缝，借着风声掩护攀上断崖。夜雾如纱，他借着残月微光，在峭壁间如鬼影游走。至顶峰时俯瞰，哨塔灯笼悬于高柱，火光摇曳如心跳。他取箭搭弦，青铜箭镞在冷风中轻颤，仿佛与星辰共鸣。一息之间，箭出如电——火光骤灭，塔上警铃未响，只余一声闷响坠地。暗处传来守兵惊疑的低语，而粮道入口的阴影里'
2025-09-26 23:57:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=834 预览='{"text": "黄忠弓身贴岩，指尖抠进石缝，借着风声掩护攀上断崖。夜雾如纱，他借着残月微光，在峭壁间如鬼影游走。至顶峰时俯瞰，哨塔灯笼悬于高柱，火光摇曳如心跳。他取箭搭弦，青铜箭镞在冷风中轻颤，仿佛与星辰共鸣。一息之间，箭出如电——火光骤灭，塔上警铃未响，只余一声闷响坠地。暗处传来守兵惊疑的低语，而粮道入口的阴影里'
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 198
2025-09-26 23:57:22 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠弓身贴岩，指尖抠进石缝，借着风声掩护攀上断崖。夜雾如纱，他借着残月微光，在峭壁间如鬼影游走。至顶...
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: rebirth_gate_placeholder.png
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/rebirth_gate_placeholder.png
2025-09-26 23:57:22 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=80 choice='将箭矢绑于石块，投掷至敌营深处，引燃草堆制造火势' text_length=198
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=80 choice='将箭矢绑于石块，投掷至敌营深处，引燃草堆制造火势'
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=89 parent=80 choice='将箭矢绑于石块，投掷至敌营深处，引燃草堆制造火势'
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=89 text_length=198
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 198
2025-09-26 23:57:22 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:22 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠弓身贴岩，指尖抠进石...
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠弓身贴岩，指尖抠进石...
2025-09-26 23:57:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1683
2025-09-26 23:57:22 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=827 预览='{"text": "黄忠贴着岩壁缓缓攀升，青苔滑落如碎星。他借夜风掩住呼吸，指尖紧扣石缝，身影在断崖的暗影中如老树虬枝般隐没。至顶峰时，他俯身凝视哨塔——灯笼摇曳，火光映出守兵的轮廓。他取箭搭弦，弓身微颤，却未急射。片刻后，他从怀中取出一枚铜铃，轻轻一振，清音破空，引得远处马蹄骤停。他趁此间隙，将箭矢悄然射向灯笼绳索，火光应声熄灭，整座哨塔陷入黑暗。刹那间，敌营警觉如潮水涌动，而他已如鹰隼般跃下，消失于山脊的阴影之中。", "choices": [{"option": "趁乱潜入粮仓，用火油点燃草堆制造混乱", "summary": "借火势扰乱敌军调度，制造突破口", "effects": '
2025-09-26 23:57:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=827 预览='{"text": "黄忠贴着岩壁缓缓攀升，青苔滑落如碎星。他借夜风掩住呼吸，指尖紧扣石缝，身影在断崖的暗影中如老树虬枝般隐没。至顶峰时，他俯身凝视哨塔——灯笼摇曳，火光映出守兵的轮廓。他取箭搭弦，弓身微颤，却未急射。片刻后，他从怀中取出一枚铜铃，轻轻一振，清音破空，引得远处马蹄骤停。他趁此间隙，将箭矢悄然射向灯笼绳索，'
2025-09-26 23:57:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=827 预览='{"text": "黄忠贴着岩壁缓缓攀升，青苔滑落如碎星。他借夜风掩住呼吸，指尖紧扣石缝，身影在断崖的暗影中如老树虬枝般隐没。至顶峰时，他俯身凝视哨塔——灯笼摇曳，火光映出守兵的轮廓。他取箭搭弦，弓身微颤，却未急射。片刻后，他从怀中取出一枚铜铃，轻轻一振，清音破空，引得远处马蹄骤停。他趁此间隙，将箭矢悄然射向灯笼绳索，'
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 201
2025-09-26 23:57:22 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠贴着岩壁缓缓攀升，青苔滑落如碎星。他借夜风掩住呼吸，指尖紧扣石缝，身影在断崖的暗影中如老树虬枝般...
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: fantasy_castle.jpg
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/fantasy_castle.jpg
2025-09-26 23:57:22 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=80 choice='折断枯枝模拟脚步声，佯装巡逻队从另一侧靠近，诱敌分心' text_length=201
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=80 choice='折断枯枝模拟脚步声，佯装巡逻队从另一侧靠近，诱敌分心'
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=90 parent=80 choice='折断枯枝模拟脚步声，佯装巡逻队从另一侧靠近，诱敌分心'
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=90 text_length=201
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 201
2025-09-26 23:57:22 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:22 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠贴着岩壁缓缓攀升，青...
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠贴着岩壁缓缓攀升，青...
2025-09-26 23:57:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-26 23:57:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1662
2025-09-26 23:57:22 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=814 预览='{"text": "黄忠深吸一口气，借着岩壁的裂痕攀援而上，枯枝在掌心碎裂如骨。他贴紧崖顶，目光锁定哨塔顶端那盏摇曳的灯笼——火光映出守卫的身影轮廓。他缓缓拉开弓弦，青铜箭镞在月色下泛起幽蓝寒芒。一息之后，箭离弦，无声如风，直贯灯芯。灯笼骤灭，塔内传来惊呼与脚步乱响。他未待回音，已翻身跃入暗影，如老鹰敛翼，潜入粮道上方的断墙废墟。远处马蹄声更近，仿佛命运的鼓点正敲击着生死之门。", "choices": [{"option": "点燃事先埋藏的火油桶，制造混乱吸引敌军注意", "summary": "以烈焰为引，搅动敌阵秩序", "effects": {"delta_progress": 12'
2025-09-26 23:57:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=814 预览='{"text": "黄忠深吸一口气，借着岩壁的裂痕攀援而上，枯枝在掌心碎裂如骨。他贴紧崖顶，目光锁定哨塔顶端那盏摇曳的灯笼——火光映出守卫的身影轮廓。他缓缓拉开弓弦，青铜箭镞在月色下泛起幽蓝寒芒。一息之后，箭离弦，无声如风，直贯灯芯。灯笼骤灭，塔内传来惊呼与脚步乱响。他未待回音，已翻身跃入暗影，如老鹰敛翼，潜入粮道上方'
2025-09-26 23:57:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=814 预览='{"text": "黄忠深吸一口气，借着岩壁的裂痕攀援而上，枯枝在掌心碎裂如骨。他贴紧崖顶，目光锁定哨塔顶端那盏摇曳的灯笼——火光映出守卫的身影轮廓。他缓缓拉开弓弦，青铜箭镞在月色下泛起幽蓝寒芒。一息之后，箭离弦，无声如风，直贯灯芯。灯笼骤灭，塔内传来惊呼与脚步乱响。他未待回音，已翻身跃入暗影，如老鹰敛翼，潜入粮道上方'
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:45 - [ImageLibrary] 正在从预置图库中查找图片，故事文本长度: 180
2025-09-26 23:57:22 | DEBUG    | core.image_service:find_image_in_library:59 - [ImageLibrary] 开始关键词匹配，故事片段: 黄忠深吸一口气，借着岩壁的裂痕攀援而上，枯枝在掌心碎裂如骨。他贴紧崖顶，目光锁定哨塔顶端那盏摇曳的灯...
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:76 - [ImageLibrary] ⚪ 无关键字匹配，随机选择: magic_forest.jpg
2025-09-26 23:57:22 | INFO     | core.image_service:find_image_in_library:79 - [ImageLibrary] 🎯 最终返回图片URL: /static/magic_forest.jpg
2025-09-26 23:57:22 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=80 choice='引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入' text_length=180
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=80 choice='引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入'
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=91 parent=80 choice='引弓射落敌军旗杆，借旗帜倒下制造混乱，趁机潜入'
2025-09-26 23:57:22 | INFO     | core.speculation:_generate_child_node:278 - [Speculation] 第3阶段-AI图像生成开始：node_id=91 text_length=180
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:87 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 180
2025-09-26 23:57:22 | DEBUG    | core.image_service:generate_image_realtime:91 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-26 23:57:22 | DEBUG    | core.image_service:generate_image_realtime:96 - [AIImageGen] 提取图像提示词...
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，借着岩壁...
2025-09-26 23:57:22 | INFO     | core.image_service:generate_image_realtime:101 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-26 23:57:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 黄忠深吸一口气，借着岩壁...
2025-09-26 23:57:23 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 632
2025-09-26 23:57:23 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 1
2025-09-26 23:57:23 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:23 | WARNING  | core.image_service:_extract_image_url:156 - 无法从AI响应中提取图像URL: `...
2025-09-26 23:57:23 | WARNING  | core.image_service:generate_image_realtime:123 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL
2025-09-26 23:57:23 | INFO     | core.speculation:_generate_child_node:297 - [Speculation] 第3阶段-AI图像生成失败，保持图库图像：node_id=88
2025-09-26 23:57:23 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=88 depth=1
2025-09-26 23:57:23 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=88 completed, triggered next level depth=1
2025-09-26 23:57:23 | INFO     | core.speculation:_run_pipeline:100 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=6 node=88
2025-09-26 23:57:32 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:32 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:32 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:32 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902252486_563.png
2025-09-26 23:57:32 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902252486_563.png
2025-09-26 23:57:32 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:32 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902252486_563.png
2025-09-26 23:57:33 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:33 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:33 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:33 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902253099_846.png
2025-09-26 23:57:33 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902253099_846.png
2025-09-26 23:57:33 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:33 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902253099_846.png
2025-09-26 23:57:34 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:34 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:34 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:34 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902252971_334.png
2025-09-26 23:57:34 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902252971_334.png
2025-09-26 23:57:34 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:34 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902252971_334.png
2025-09-26 23:57:34 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:34 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:34 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:34 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902254014_230.png
2025-09-26 23:57:34 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902254014_230.png
2025-09-26 23:57:34 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:34 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902254014_230.png
2025-09-26 23:57:35 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 771
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 137
2025-09-26 23:57:35 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:35 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902254932_216.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902254932_216.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:35 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902254932_216.png
2025-09-26 23:57:35 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:35 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:35 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902254993_731.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902254993_731.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:35 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902254993_731.png
2025-09-26 23:57:35 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:35 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:35 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902254457_399.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902254457_399.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:35 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902254457_399.png
2025-09-26 23:57:35 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:103 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-26 23:57:35 | DEBUG    | core.image_service:generate_image_realtime:106 - [AIImageGen] 提取图像URL...
2025-09-26 23:57:35 | DEBUG    | core.image_service:_extract_image_url:153 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758902254542_308.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:110 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758902254542_308.png
2025-09-26 23:57:35 | INFO     | core.image_service:generate_image_realtime:113 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-26 23:57:35 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758902254542_308.png
2025-09-26 23:57:36 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_2bcc03cdc441cde2979ae3e6ab67d96e.png (大小: 1365005 字节)
2025-09-26 23:57:36 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_2bcc03cdc441cde2979ae3e6ab67d96e.png
2025-09-26 23:57:36 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=86 image_url=/static/generated/ai_gen_2bcc03cdc441cde2979ae3e6ab67d96e.png
2025-09-26 23:57:36 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=86 depth=1
2025-09-26 23:57:36 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=86 completed, triggered next level depth=1
2025-09-26 23:57:37 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_46710a35f1772fa86cc59dc53071b092.png (大小: 1363608 字节)
2025-09-26 23:57:37 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_46710a35f1772fa86cc59dc53071b092.png
2025-09-26 23:57:37 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=91 image_url=/static/generated/ai_gen_46710a35f1772fa86cc59dc53071b092.png
2025-09-26 23:57:37 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=91 depth=1
2025-09-26 23:57:37 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=91 completed, triggered next level depth=1
2025-09-26 23:57:38 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_dbb644fa3db2ce25066559f07cb4c2a9.png (大小: 1490381 字节)
2025-09-26 23:57:38 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_dbb644fa3db2ce25066559f07cb4c2a9.png
2025-09-26 23:57:38 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=84 image_url=/static/generated/ai_gen_dbb644fa3db2ce25066559f07cb4c2a9.png
2025-09-26 23:57:38 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=84 depth=1
2025-09-26 23:57:38 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=84 completed, triggered next level depth=1
2025-09-26 23:57:38 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_b4e71fd5579410dd64be4aab0a81fd02.png (大小: 1270869 字节)
2025-09-26 23:57:38 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_b4e71fd5579410dd64be4aab0a81fd02.png
2025-09-26 23:57:38 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=85 image_url=/static/generated/ai_gen_b4e71fd5579410dd64be4aab0a81fd02.png
2025-09-26 23:57:38 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=85 depth=1
2025-09-26 23:57:38 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=85 completed, triggered next level depth=1
2025-09-26 23:57:38 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_9b75bfb82f7d6e6d7ff471a90b0c6df9.png (大小: 1254257 字节)
2025-09-26 23:57:38 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_9b75bfb82f7d6e6d7ff471a90b0c6df9.png
2025-09-26 23:57:38 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=89 image_url=/static/generated/ai_gen_9b75bfb82f7d6e6d7ff471a90b0c6df9.png
2025-09-26 23:57:38 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=89 depth=1
2025-09-26 23:57:38 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=89 completed, triggered next level depth=1
2025-09-26 23:57:38 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_36a8ae73bb32918a3b10843213c09e65.png (大小: 1505511 字节)
2025-09-26 23:57:38 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_36a8ae73bb32918a3b10843213c09e65.png
2025-09-26 23:57:38 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=87 image_url=/static/generated/ai_gen_36a8ae73bb32918a3b10843213c09e65.png
2025-09-26 23:57:38 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=87 depth=1
2025-09-26 23:57:38 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=87 completed, triggered next level depth=1
2025-09-26 23:57:39 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_0039a42a21b3985eee77f36829d28842.png (大小: 1371571 字节)
2025-09-26 23:57:39 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_0039a42a21b3985eee77f36829d28842.png
2025-09-26 23:57:39 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=83 image_url=/static/generated/ai_gen_0039a42a21b3985eee77f36829d28842.png
2025-09-26 23:57:39 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=83 depth=1
2025-09-26 23:57:39 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=83 completed, triggered next level depth=1
2025-09-26 23:57:39 | INFO     | core.image_storage:save_ai_image:74 - ✅ 图像下载成功: ai_gen_c9a05fcbac86b9c12a24b4e32827d62a.png (大小: 1237674 字节)
2025-09-26 23:57:39 | INFO     | core.image_service:generate_image_realtime:117 - [AIImageGen] ✅ 图像已保存到本地: /static/generated/ai_gen_c9a05fcbac86b9c12a24b4e32827d62a.png
2025-09-26 23:57:39 | INFO     | core.speculation:_generate_child_node:295 - [Speculation] 第3阶段-AI图像生成成功：node_id=90 image_url=/static/generated/ai_gen_c9a05fcbac86b9c12a24b4e32827d62a.png
2025-09-26 23:57:39 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=6 node=90 depth=1
2025-09-26 23:57:39 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=90 completed, triggered next level depth=1
2025-09-27 00:00:15 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:00:16 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:00:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:00:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:00:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:00:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:00:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:00:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:17 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:00:17 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:00:17 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:00:17 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:00:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:18 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:00:18 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:00:18 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:00:18 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:00:18 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:00:25 | INFO     | api.story:continue_existing_story:453 - 收到故事继续请求，选择: 攀上岩壁潜行至高处，用箭矢射落哨塔灯笼
2025-09-27 00:00:25 | INFO     | api.story:continue_existing_story:497 - [ImageWait] 检查节点图像生成状态：node_id=80
2025-09-27 00:00:25 | INFO     | api.story:continue_existing_story:513 - [ImageWait] 图像生成完成或无需等待：node_id=80
2025-09-27 00:00:38 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:00:39 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:00:40 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:00:40 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:00:40 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:00:40 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:00:40 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:00:40 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:40 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:00:40 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:00:40 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:00:40 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:00:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:41 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:00:41 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:00:41 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:00:41 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:00:41 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:00:49 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:00:50 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:00:50 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:00:50 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:00:50 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:00:50 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:00:50 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:00:50 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:51 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:00:51 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:00:51 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:00:51 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:00:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:00:51 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:00:51 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:00:51 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:00:51 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:00:51 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:01:16 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:01:17 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:01:18 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:01:18 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:01:18 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:01:18 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:01:18 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:01:18 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:01:18 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:01:18 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:01:18 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:01:18 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:01:18 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:01:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:01:19 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:01:19 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:01:19 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:01:19 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:01:19 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:01:34 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:01:35 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:01:36 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:01:36 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:01:36 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:01:36 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:01:36 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:01:36 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:01:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:01:36 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:01:36 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:01:36 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:01:36 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:01:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:01:37 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:01:37 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:01:37 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:01:37 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:01:37 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:01 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:10:02 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:10:03 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:10:03 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:10:03 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:10:03 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:03 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:10:03 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:03 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:10:03 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:10:03 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:10:03 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:10:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:04 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:10:04 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:10:04 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:10:04 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:10:04 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:18 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:10:19 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:10:20 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:10:20 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:10:20 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:10:20 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:20 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:10:20 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:20 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:20 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:10:20 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:10:20 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:10:20 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:10:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:21 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:10:21 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:10:21 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:10:21 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:10:21 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:31 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:10:32 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:10:33 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:10:33 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:10:33 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:10:33 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:33 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:10:33 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:33 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:10:33 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:10:33 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:10:33 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:10:34 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:34 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:10:34 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:10:34 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:10:34 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:10:34 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:43 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:10:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:10:45 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:10:45 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:10:45 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:10:45 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:10:45 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:10:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:45 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:10:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:10:45 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:10:45 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:10:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:10:46 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:10:46 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:10:46 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:10:46 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:10:46 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:13:48 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:13:49 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:13:50 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:13:50 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:13:50 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:13:50 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:13:50 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:13:50 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:13:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:13:50 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:13:50 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:13:50 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:13:50 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:13:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:13:51 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:13:51 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:13:51 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:13:51 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:13:51 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:14:05 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:14:06 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:14:07 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:14:07 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:14:07 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:14:07 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:14:07 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:14:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:07 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:14:07 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:14:07 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:14:07 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:14:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:08 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:14:08 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:14:08 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:14:08 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:14:08 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:14:25 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:14:26 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:14:27 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:14:27 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:14:27 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:14:27 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:14:27 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:14:27 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:27 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:14:27 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:14:27 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:14:27 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:14:27 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:28 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:14:28 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:14:28 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:14:28 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:14:28 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:14:43 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:14:44 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:14:45 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:14:45 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:14:45 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:14:45 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:14:45 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:14:45 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:45 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:14:45 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:14:45 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:14:45 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:14:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:14:46 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:14:46 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:14:46 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:14:46 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:14:46 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:15:06 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:15:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:15:10 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:15:11 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:15:11 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:15:11 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:15:11 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:15:11 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:15:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:15:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:15:11 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:15:11 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:15:11 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:15:11 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:15:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:15:12 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:15:12 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:15:12 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:15:12 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:15:12 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:15:32 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：项羽...
2025-09-27 00:15:32 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 00:15:32 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 10
2025-09-27 00:15:32 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 513
2025-09-27 00:15:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:15:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 922
2025-09-27 00:15:33 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 202
2025-09-27 00:15:33 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 00:15:33 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 霸王重生：巨鹿之誓, background: 楚汉之争烽火未熄，项羽于巨鹿之战后重临战场。昔日破釜沉舟的豪气犹在，但军心浮动、诸侯观望，刘邦暗中积..., quest: 在三日内召集八千江东子弟，重振楚军士气...
2025-09-27 00:15:33 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:15:33 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:15:33 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:15:33 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-27 00:15:36 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:15:36 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1442
2025-09-27 00:15:36 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=860 预览='{"text": "垓下寒夜，风卷残旗。项羽立于营帐之外，目光如炬扫过四野。楚军粮尽兵疲，士卒低语渐起，连战马也嘶鸣不止。远处传来刘邦军的鼓声，似在嘲弄这孤城将倾。他手中握紧那柄染血的长戟，指节发白。忽然，一队溃兵踉跄奔来，报称南门守将已暗通汉军，欲献城为功。项羽眸光一凛，杀意如霜，但此刻若贸然斩将，恐动摇军心；若不惩，人心更散。他转身望向帐中那幅未完成的《山河图》，墨迹未干，江山犹在，可人心却如流沙。", "choices": [{"option": "命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌", "summary": "以暴制乱，震慑宵小，唤醒将士血性", "effect'
2025-09-27 00:15:36 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=860 预览='{"text": "垓下寒夜，风卷残旗。项羽立于营帐之外，目光如炬扫过四野。楚军粮尽兵疲，士卒低语渐起，连战马也嘶鸣不止。远处传来刘邦军的鼓声，似在嘲弄这孤城将倾。他手中握紧那柄染血的长戟，指节发白。忽然，一队溃兵踉跄奔来，报称南门守将已暗通汉军，欲献城为功。项羽眸光一凛，杀意如霜，但此刻若贸然斩将，恐动摇军心；若不惩'
2025-09-27 00:15:36 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=860 预览='{"text": "垓下寒夜，风卷残旗。项羽立于营帐之外，目光如炬扫过四野。楚军粮尽兵疲，士卒低语渐起，连战马也嘶鸣不止。远处传来刘邦军的鼓声，似在嘲弄这孤城将倾。他手中握紧那柄染血的长戟，指节发白。忽然，一队溃兵踉跄奔来，报称南门守将已暗通汉军，欲献城为功。项羽眸光一凛，杀意如霜，但此刻若贸然斩将，恐动摇军心；若不惩'
2025-09-27 00:15:36 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 193
2025-09-27 00:15:36 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:15:36 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 193
2025-09-27 00:15:36 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:15:37 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 00:15:37 | INFO     | core.image_storage:__init__:27 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:15:37 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:15:37 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 垓下寒夜，风卷残旗。项羽...
2025-09-27 00:15:37 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:15:37 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 垓下寒夜，风卷残旗。项羽...
2025-09-27 00:15:51 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:15:51 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:15:51 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:15:51 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903350656_112.png
2025-09-27 00:15:51 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903350656_112.png
2025-09-27 00:15:51 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:15:51 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903350656_112.png
2025-09-27 00:15:56 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_f5224fc42baa5c09ad44cb1473297b3b.png (大小: 1434348 字节)
2025-09-27 00:15:56 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_f5224fc42baa5c09ad44cb1473297b3b.png
2025-09-27 00:15:56 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_f5224fc42baa5c09ad44cb1473297b3b.png
2025-09-27 00:15:56 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 00:15:56 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=193
2025-09-27 00:15:56 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=7
2025-09-27 00:15:56 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=92
2025-09-27 00:15:56 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=92 image_url=/static/generated/ai_gen_f5224fc42baa5c09ad44cb1473297b3b.png
2025-09-27 00:15:56 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=92 depth=3
2025-09-27 00:15:56 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=7, node=92
2025-09-27 00:15:56 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=7
2025-09-27 00:15:56 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:15:56 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=92
2025-09-27 00:15:56 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=92 choice='命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌'
2025-09-27 00:15:56 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=92 choice='命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌'
2025-09-27 00:15:56 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=92 choice='亲赴前营，披甲执戟，于月下朗声诵读《楚辞·国殇》'
2025-09-27 00:15:56 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=92 choice='悄然召来心腹，密议假传诏令，诱骗敌探入伏，反设疑兵之计'
2025-09-27 00:15:56 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌
2025-09-27 00:15:56 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=92 choice='亲赴前营，披甲执戟，于月下朗声诵读《楚辞·国殇》'
2025-09-27 00:15:56 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=92 choice='悄然召来心腹，密议假传诏令，诱骗敌探入伏，反设疑兵之计'
2025-09-27 00:15:56 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲赴前营，披甲执戟，于月下朗声诵读《楚辞·国殇》
2025-09-27 00:15:56 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然召来心腹，密议假传诏令，诱骗敌探入伏，反设疑兵之计
2025-09-27 00:15:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:15:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1619
2025-09-27 00:15:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=868 预览='{"text": "寒风撕扯着残破的旗帜，项羽缓缓抽出腰间佩剑，在掌心划下一道血痕。血滴落于《山河图》上，墨迹如活物般蔓延，仿佛整片江山都在震颤。他低语：‘若城可失，心不可亡。’忽闻帐外传来幼兵的啜泣——那是个刚满十四岁的炊事童子，因藏匿半块干粮被巡营士卒拖出。项羽目光一沉，竟转身将手中长戟掷向旗杆，戟身嗡鸣，钉入木中，声震四野。他大步走向孩童，一把掀开其衣襟，露出胸前绣着的‘楚’字布条，竟是当年在彭城救下的孤儿。夜色如铁，杀机与怜悯在这一刻交锋。", "choices": [{"option": "当众斩断守将头颅，以血祭旗，震慑军心", "summary": "以雷霆手段重振威信，代价是人'
2025-09-27 00:15:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=868 预览='{"text": "寒风撕扯着残破的旗帜，项羽缓缓抽出腰间佩剑，在掌心划下一道血痕。血滴落于《山河图》上，墨迹如活物般蔓延，仿佛整片江山都在震颤。他低语：‘若城可失，心不可亡。’忽闻帐外传来幼兵的啜泣——那是个刚满十四岁的炊事童子，因藏匿半块干粮被巡营士卒拖出。项羽目光一沉，竟转身将手中长戟掷向旗杆，戟身嗡鸣，钉入木中'
2025-09-27 00:15:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=868 预览='{"text": "寒风撕扯着残破的旗帜，项羽缓缓抽出腰间佩剑，在掌心划下一道血痕。血滴落于《山河图》上，墨迹如活物般蔓延，仿佛整片江山都在震颤。他低语：‘若城可失，心不可亡。’忽闻帐外传来幼兵的啜泣——那是个刚满十四岁的炊事童子，因藏匿半块干粮被巡营士卒拖出。项羽目光一沉，竟转身将手中长戟掷向旗杆，戟身嗡鸣，钉入木中'
2025-09-27 00:15:59 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 216
2025-09-27 00:15:59 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:15:59 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 216
2025-09-27 00:15:59 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:15:59 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:15:59 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风撕扯着残破的旗帜，项...
2025-09-27 00:15:59 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:15:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风撕扯着残破的旗帜，项...
2025-09-27 00:15:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:15:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1626
2025-09-27 00:15:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=871 预览='{"text": "夜风撕扯着残破的战旗，项羽凝视着南门方向，火光在城垛间跳动如鬼影。那守将若真通敌，此刻正与汉军密语于暗处；若未叛，却已动摇军心。他缓缓抽出腰间佩剑，剑锋映出自己眉宇间的孤绝。忽然，远处传来马蹄轻响——一骑飞驰而至，是斥候，浑身血污，口中嘶喊：‘将军！北门有异动，疑有伏兵！’项羽瞳孔骤缩，脑中电闪：是敌计？还是真有变局？他猛然转身，将剑插入土中，拔出那幅未完成的《山河图》，撕下一角，掷于地上，冷声下令：‘点起三万火把，全军列阵，南门不许开，北门……我亲自去会会那藏在黑暗里的狼。’", "choices": [{"option": "命亲卫伪装成溃兵混入北门，趁乱探明敌情", '
2025-09-27 00:15:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=871 预览='{"text": "夜风撕扯着残破的战旗，项羽凝视着南门方向，火光在城垛间跳动如鬼影。那守将若真通敌，此刻正与汉军密语于暗处；若未叛，却已动摇军心。他缓缓抽出腰间佩剑，剑锋映出自己眉宇间的孤绝。忽然，远处传来马蹄轻响——一骑飞驰而至，是斥候，浑身血污，口中嘶喊：‘将军！北门有异动，疑有伏兵！’项羽瞳孔骤缩，脑中电闪：是'
2025-09-27 00:15:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=871 预览='{"text": "夜风撕扯着残破的战旗，项羽凝视着南门方向，火光在城垛间跳动如鬼影。那守将若真通敌，此刻正与汉军密语于暗处；若未叛，却已动摇军心。他缓缓抽出腰间佩剑，剑锋映出自己眉宇间的孤绝。忽然，远处传来马蹄轻响——一骑飞驰而至，是斥候，浑身血污，口中嘶喊：‘将军！北门有异动，疑有伏兵！’项羽瞳孔骤缩，脑中电闪：是'
2025-09-27 00:15:59 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 241
2025-09-27 00:15:59 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:15:59 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 241
2025-09-27 00:15:59 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:15:59 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:15:59 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风撕扯着残破的战旗，项...
2025-09-27 00:15:59 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:15:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风撕扯着残破的战旗，项...
2025-09-27 00:16:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1624
2025-09-27 00:16:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=879 预览='{"text": "夜风撕扯着残破的旗帜，项羽缓缓抽出腰间佩剑，在掌心划下一道血痕。血滴落于《山河图》上，墨色如潮般晕开，仿佛整片江山在无声哀鸣。他猛然抬头，目光如刀，直刺南门方向——那道即将崩塌的防线，不只是城门，更是人心的堤坝。若今日不立威，明日楚军将自溃于内；若杀一人而震全军，又恐落下滥杀之名。他转身走向帐中青铜镜，镜面映出他眼底的孤绝与怒火，仿佛听见了历史在低语：霸王之名，岂容败于一将之私？", "choices": [{"option": "当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众", "summary": "以雷霆手段震慑动摇者，唤醒将士血性", "effects": {"'
2025-09-27 00:16:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=879 预览='{"text": "夜风撕扯着残破的旗帜，项羽缓缓抽出腰间佩剑，在掌心划下一道血痕。血滴落于《山河图》上，墨色如潮般晕开，仿佛整片江山在无声哀鸣。他猛然抬头，目光如刀，直刺南门方向——那道即将崩塌的防线，不只是城门，更是人心的堤坝。若今日不立威，明日楚军将自溃于内；若杀一人而震全军，又恐落下滥杀之名。他转身走向帐中青铜'
2025-09-27 00:16:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=879 预览='{"text": "夜风撕扯着残破的旗帜，项羽缓缓抽出腰间佩剑，在掌心划下一道血痕。血滴落于《山河图》上，墨色如潮般晕开，仿佛整片江山在无声哀鸣。他猛然抬头，目光如刀，直刺南门方向——那道即将崩塌的防线，不只是城门，更是人心的堤坝。若今日不立威，明日楚军将自溃于内；若杀一人而震全军，又恐落下滥杀之名。他转身走向帐中青铜'
2025-09-27 00:16:00 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 191
2025-09-27 00:16:00 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:00 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 191
2025-09-27 00:16:00 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:00 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:00 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风撕扯着残破的旗帜，项...
2025-09-27 00:16:00 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风撕扯着残破的旗帜，项...
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 项羽...
2025-09-27 00:16:04 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 00:16:04 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:7947412967299587799
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=7, node=92
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=7, node_id=92
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=7, node_id=92
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 193, 选择数: 3, 图片: /static/generated/ai_gen_f5224fc42baa5c09ad44cb1473297b3b.png
2025-09-27 00:16:04 | INFO     | api.story:start_new_story:482 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=7, node=92
2025-09-27 00:16:14 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:14 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:14 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:14 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903373924_459.png
2025-09-27 00:16:14 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903373924_459.png
2025-09-27 00:16:14 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:14 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903373924_459.png
2025-09-27 00:16:15 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:15 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:15 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:15 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903374522_595.png
2025-09-27 00:16:15 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903374522_595.png
2025-09-27 00:16:15 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:15 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903374522_595.png
2025-09-27 00:16:16 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:16 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:16 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:16 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903376219_015.png
2025-09-27 00:16:16 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903376219_015.png
2025-09-27 00:16:16 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:16 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903376219_015.png
2025-09-27 00:16:18 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_0d68e19228dfb18d9e78ee144b07e8a2.png (大小: 1478710 字节)
2025-09-27 00:16:18 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_0d68e19228dfb18d9e78ee144b07e8a2.png
2025-09-27 00:16:18 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_0d68e19228dfb18d9e78ee144b07e8a2.png
2025-09-27 00:16:18 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=92 choice='悄然召来心腹，密议假传诏令，诱骗敌探入伏，反设疑兵之计' text_length=216
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=92 choice='悄然召来心腹，密议假传诏令，诱骗敌探入伏，反设疑兵之计'
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=93 parent=92 choice='悄然召来心腹，密议假传诏令，诱骗敌探入伏，反设疑兵之计'
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=93 image_url=/static/generated/ai_gen_0d68e19228dfb18d9e78ee144b07e8a2.png
2025-09-27 00:16:18 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=93 depth=2
2025-09-27 00:16:18 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=93 completed, triggered next level depth=2
2025-09-27 00:16:18 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=93
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=93 choice='当众斩断守将头颅，以血祭旗，震慑军心'
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=93 choice='将童子抱至火堆前，亲手烤熟那半块干粮，分予全营'
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=93 choice='当众斩断守将头颅，以血祭旗，震慑军心'
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=93 choice='命人将守将绑在战鼓旁，用鼓声掩盖其哀嚎，逼其自陈罪状'
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=93 choice='将童子抱至火堆前，亲手烤熟那半块干粮，分予全营'
2025-09-27 00:16:18 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 当众斩断守将头颅，以血祭旗，震慑军心
2025-09-27 00:16:18 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=93 choice='命人将守将绑在战鼓旁，用鼓声掩盖其哀嚎，逼其自陈罪状'
2025-09-27 00:16:18 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将童子抱至火堆前，亲手烤熟那半块干粮，分予全营
2025-09-27 00:16:18 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人将守将绑在战鼓旁，用鼓声掩盖其哀嚎，逼其自陈罪状
2025-09-27 00:16:19 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_cefed20e7a4c9e7890e9de91a4b45925.png (大小: 1346818 字节)
2025-09-27 00:16:19 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_cefed20e7a4c9e7890e9de91a4b45925.png
2025-09-27 00:16:19 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_cefed20e7a4c9e7890e9de91a4b45925.png
2025-09-27 00:16:19 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=92 choice='命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌' text_length=241
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=92 choice='命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌'
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=94 parent=92 choice='命人将叛将绑于辕门，当众以铁链穿耳示众，再令其亲率部下迎敌'
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=94 image_url=/static/generated/ai_gen_cefed20e7a4c9e7890e9de91a4b45925.png
2025-09-27 00:16:19 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=94 depth=2
2025-09-27 00:16:19 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=94 completed, triggered next level depth=2
2025-09-27 00:16:19 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=94
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=94 choice='命亲卫伪装成溃兵混入北门，趁乱探明敌情'
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=94 choice='命亲卫伪装成溃兵混入北门，趁乱探明敌情'
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=94 choice='亲自率精锐突袭北门，以雷霆之势震慑内外'
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=94 choice='召集群将，当众宣读军令，公开质问南门守将'
2025-09-27 00:16:19 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命亲卫伪装成溃兵混入北门，趁乱探明敌情
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=94 choice='亲自率精锐突袭北门，以雷霆之势震慑内外'
2025-09-27 00:16:19 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=94 choice='召集群将，当众宣读军令，公开质问南门守将'
2025-09-27 00:16:19 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲自率精锐突袭北门，以雷霆之势震慑内外
2025-09-27 00:16:19 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 召集群将，当众宣读军令，公开质问南门守将
2025-09-27 00:16:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1883
2025-09-27 00:16:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1864
2025-09-27 00:16:22 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=918 预览='{"text": "项羽凝视着那名稚嫩的炊事童子，掌心血痕仍在渗出，滴落在《山河图》的江流之上。他忽然低笑一声，声音如裂帛。‘你既姓楚，便不该饿死于城中。’他转身命亲卫取来半袋粟米，亲手塞入孩童怀中，又将一枚铜钱别在布条上——那是当年彭城救他时所用的信物。随后，他唤来心腹将领，耳语密议：‘传我令，南门守将叛变，即刻调集三营精锐夜袭汉军斥候；再命人以火把燃起虚影，佯作粮草集结，诱敌深入。’帐外风雪骤起，战鼓声忽远忽近，仿佛天地也在为这场生死之局屏息。当夜，数十支火把在城头晃动，如星河倾泻，而真正的伏兵早已潜伏于芦苇荡中，箭镞映着寒月，静待猎物入彀。", "choices": [{"option"'
2025-09-27 00:16:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=918 预览='{"text": "项羽凝视着那名稚嫩的炊事童子，掌心血痕仍在渗出，滴落在《山河图》的江流之上。他忽然低笑一声，声音如裂帛。‘你既姓楚，便不该饿死于城中。’他转身命亲卫取来半袋粟米，亲手塞入孩童怀中，又将一枚铜钱别在布条上——那是当年彭城救他时所用的信物。随后，他唤来心腹将领，耳语密议：‘传我令，南门守将叛变，即刻调集'
2025-09-27 00:16:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=918 预览='{"text": "项羽凝视着那名稚嫩的炊事童子，掌心血痕仍在渗出，滴落在《山河图》的江流之上。他忽然低笑一声，声音如裂帛。‘你既姓楚，便不该饿死于城中。’他转身命亲卫取来半袋粟米，亲手塞入孩童怀中，又将一枚铜钱别在布条上——那是当年彭城救他时所用的信物。随后，他唤来心腹将领，耳语密议：‘传我令，南门守将叛变，即刻调集'
2025-09-27 00:16:22 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=898 预览='{"text": "项羽凝视着那枚沾血的布条，指尖轻抚过‘楚’字的针脚。他转身低喝：‘传令三军，今夜子时，南门设火鼓为号，三更前不得点灯。’话音未落，已命亲卫取来染黑的战袍与汉军旗角，暗中交予心腹。那人领命而去，身影如烟渗入夜雾。项羽则立于高台，将幼兵轻轻扶起，低声耳语：‘你若能活到明日，便知何为楚魂不灭。’风卷残雪，帐外忽有异响——一匹无鞍马从敌营方向奔来，马背竟驮着半幅破损的《山河图》，墨迹被雨水冲刷成诡异纹路，似在诉说某种预兆。他目光骤冷，仿佛听见了历史深处的回响。", "choices": [{"option": "将破损地图置于火盆中焚烧，借灰烬占卜天意", "summary": "'
2025-09-27 00:16:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=898 预览='{"text": "项羽凝视着那枚沾血的布条，指尖轻抚过‘楚’字的针脚。他转身低喝：‘传令三军，今夜子时，南门设火鼓为号，三更前不得点灯。’话音未落，已命亲卫取来染黑的战袍与汉军旗角，暗中交予心腹。那人领命而去，身影如烟渗入夜雾。项羽则立于高台，将幼兵轻轻扶起，低声耳语：‘你若能活到明日，便知何为楚魂不灭。’风卷残雪，'
2025-09-27 00:16:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=898 预览='{"text": "项羽凝视着那枚沾血的布条，指尖轻抚过‘楚’字的针脚。他转身低喝：‘传令三军，今夜子时，南门设火鼓为号，三更前不得点灯。’话音未落，已命亲卫取来染黑的战袍与汉军旗角，暗中交予心腹。那人领命而去，身影如烟渗入夜雾。项羽则立于高台，将幼兵轻轻扶起，低声耳语：‘你若能活到明日，便知何为楚魂不灭。’风卷残雪，'
2025-09-27 00:16:22 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 266
2025-09-27 00:16:22 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 228
2025-09-27 00:16:22 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:22 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:22 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 266
2025-09-27 00:16:22 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:22 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:22 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 228
2025-09-27 00:16:22 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:22 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:22 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着那名稚嫩的炊事...
2025-09-27 00:16:22 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着那枚沾血的布条...
2025-09-27 00:16:22 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:22 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着那名稚嫩的炊事...
2025-09-27 00:16:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着那枚沾血的布条...
2025-09-27 00:16:23 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:23 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1857
2025-09-27 00:16:23 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=874 预览='{"text": "项羽凝视着那枚沾血的布条，指尖轻抚‘楚’字，喉结微动。他转身低喝：‘来人，唤范增之孙入帐——非为问策，乃为传令。’暗影中走出一名黑衣少年，眉目清冷，正是老谋士遗孤。项羽将半块干粮塞入其掌心，声音如铁：‘你去南门，假称我亲笔诏书，命守将即刻调三队精兵至东坡演武。若他迟疑，便说……本王已知他通敌，只待一瞬之机。’少年领命而去，背影融进风雪。项羽立于帐口，望见远处火光忽明忽暗，似有千军万马在虚影中奔腾。他缓缓抽出腰间佩剑，剑尖点地，划出一道深痕，仿佛在丈量生死之间的距离。夜愈深，杀机如潮。", "choices": [{"option": "命亲卫扮作敌探，故意暴露行踪引蛇出洞"'
2025-09-27 00:16:23 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=874 预览='{"text": "项羽凝视着那枚沾血的布条，指尖轻抚‘楚’字，喉结微动。他转身低喝：‘来人，唤范增之孙入帐——非为问策，乃为传令。’暗影中走出一名黑衣少年，眉目清冷，正是老谋士遗孤。项羽将半块干粮塞入其掌心，声音如铁：‘你去南门，假称我亲笔诏书，命守将即刻调三队精兵至东坡演武。若他迟疑，便说……本王已知他通敌，只待一'
2025-09-27 00:16:23 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=874 预览='{"text": "项羽凝视着那枚沾血的布条，指尖轻抚‘楚’字，喉结微动。他转身低喝：‘来人，唤范增之孙入帐——非为问策，乃为传令。’暗影中走出一名黑衣少年，眉目清冷，正是老谋士遗孤。项羽将半块干粮塞入其掌心，声音如铁：‘你去南门，假称我亲笔诏书，命守将即刻调三队精兵至东坡演武。若他迟疑，便说……本王已知他通敌，只待一'
2025-09-27 00:16:23 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 244
2025-09-27 00:16:23 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:23 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 244
2025-09-27 00:16:23 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:23 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:23 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着那枚沾血的布条...
2025-09-27 00:16:23 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:23 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着那枚沾血的布条...
2025-09-27 00:16:23 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:23 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1887
2025-09-27 00:16:23 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=893 预览='{"text": "项羽立于辕门之下，寒风卷起残旗如血。叛将被铁链穿耳，赤足跪于泥泞，脖颈垂落，面如死灰。他缓缓抽出佩剑，刃尖轻点地面，发出刺耳的摩擦声。三万火把轰然燃起，映红半边天幕，楚军列阵如林，刀锋齐指南门。‘今日之刑，非为杀一人，乃为立一信！’项羽声如雷霆，震得城楼簌簌落尘。他命叛将亲率部下出战，背负家国之耻，踏向敌阵。火光中，那队士卒沉默前行，脚步沉重，仿佛每一步都踩在生死边缘。远处，北门方向马蹄隐隐，似有大军压境。项羽凝视那支队伍远去的身影，眼中无悲无怒，唯余孤绝——他知道，这一战，不是攻城，而是赌命。", "choices": [{"option": "亲率精锐潜行至北门，趁夜突'
2025-09-27 00:16:23 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=893 预览='{"text": "项羽立于辕门之下，寒风卷起残旗如血。叛将被铁链穿耳，赤足跪于泥泞，脖颈垂落，面如死灰。他缓缓抽出佩剑，刃尖轻点地面，发出刺耳的摩擦声。三万火把轰然燃起，映红半边天幕，楚军列阵如林，刀锋齐指南门。‘今日之刑，非为杀一人，乃为立一信！’项羽声如雷霆，震得城楼簌簌落尘。他命叛将亲率部下出战，背负家国之耻，'
2025-09-27 00:16:23 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=893 预览='{"text": "项羽立于辕门之下，寒风卷起残旗如血。叛将被铁链穿耳，赤足跪于泥泞，脖颈垂落，面如死灰。他缓缓抽出佩剑，刃尖轻点地面，发出刺耳的摩擦声。三万火把轰然燃起，映红半边天幕，楚军列阵如林，刀锋齐指南门。‘今日之刑，非为杀一人，乃为立一信！’项羽声如雷霆，震得城楼簌簌落尘。他命叛将亲率部下出战，背负家国之耻，'
2025-09-27 00:16:23 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 250
2025-09-27 00:16:23 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:23 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 250
2025-09-27 00:16:23 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:23 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:23 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于辕门之下，寒风卷...
2025-09-27 00:16:23 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:23 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于辕门之下，寒风卷...
2025-09-27 00:16:24 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_d9f7d07d8cb3442e2acd06e83200d5d6.png (大小: 1523095 字节)
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_d9f7d07d8cb3442e2acd06e83200d5d6.png
2025-09-27 00:16:24 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_d9f7d07d8cb3442e2acd06e83200d5d6.png
2025-09-27 00:16:24 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=92 choice='亲赴前营，披甲执戟，于月下朗声诵读《楚辞·国殇》' text_length=191
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=92 choice='亲赴前营，披甲执戟，于月下朗声诵读《楚辞·国殇》'
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=95 parent=92 choice='亲赴前营，披甲执戟，于月下朗声诵读《楚辞·国殇》'
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=95 image_url=/static/generated/ai_gen_d9f7d07d8cb3442e2acd06e83200d5d6.png
2025-09-27 00:16:24 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=95 depth=2
2025-09-27 00:16:24 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=95 completed, triggered next level depth=2
2025-09-27 00:16:24 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=95
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=95 choice='当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众'
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=95 choice='当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众'
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=95 choice='召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应'
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=95 choice='命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行'
2025-09-27 00:16:24 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=95 choice='召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应'
2025-09-27 00:16:24 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=95 choice='命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行'
2025-09-27 00:16:24 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应
2025-09-27 00:16:24 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行
2025-09-27 00:16:24 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:24 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1916
2025-09-27 00:16:24 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=908 预览='{"text": "项羽冷眼俯视辕门，叛将被铁链穿耳，血珠顺着锁骨滑落，在冰冷的石板上溅开暗红。他一声令下，火把骤然燃起，映得整座军营如炼狱。三万火光齐刷刷转向南门，士卒列阵如墙，刀锋在夜风中低鸣。那守将被推至阵前，项羽缓缓抽出佩剑，剑尖轻点其喉：‘你若真忠，便带兵出城，迎敌于野；若心有二意——便以血洗清污名。’守将颤声应命，踉跄奔向城门。项羽立于高台，目光如炬，望向那扇即将开启的黑暗之门，仿佛在等待一场命运的对弈。火光摇曳间，他的身影被拉得极长，如同一尊镇压山河的战神。", "choices": [{"option": "命人暗中布伏于城门两侧，一旦叛将引敌入内，即刻合围剿杀", "summ'
2025-09-27 00:16:24 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=908 预览='{"text": "项羽冷眼俯视辕门，叛将被铁链穿耳，血珠顺着锁骨滑落，在冰冷的石板上溅开暗红。他一声令下，火把骤然燃起，映得整座军营如炼狱。三万火光齐刷刷转向南门，士卒列阵如墙，刀锋在夜风中低鸣。那守将被推至阵前，项羽缓缓抽出佩剑，剑尖轻点其喉：‘你若真忠，便带兵出城，迎敌于野；若心有二意——便以血洗清污名。’守将颤'
2025-09-27 00:16:24 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=908 预览='{"text": "项羽冷眼俯视辕门，叛将被铁链穿耳，血珠顺着锁骨滑落，在冰冷的石板上溅开暗红。他一声令下，火把骤然燃起，映得整座军营如炼狱。三万火光齐刷刷转向南门，士卒列阵如墙，刀锋在夜风中低鸣。那守将被推至阵前，项羽缓缓抽出佩剑，剑尖轻点其喉：‘你若真忠，便带兵出城，迎敌于野；若心有二意——便以血洗清污名。’守将颤'
2025-09-27 00:16:24 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 228
2025-09-27 00:16:24 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 228
2025-09-27 00:16:24 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:24 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽冷眼俯视辕门，叛将被...
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:24 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽冷眼俯视辕门，叛将被...
2025-09-27 00:16:24 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:24 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1932
2025-09-27 00:16:24 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=929 预览='{"text": "项羽立于辕门之下，寒风卷起残破战袍，铁链在月光下泛着冷光。那守将被缚于木桩之上，双耳穿铁环，血迹蜿蜒至脖颈，却仍死死咬住嘴唇不发一言。楚军列阵如林，目光灼灼，静待王命。项羽缓缓抽出佩剑，剑尖轻点其肩，声音低沉如雷：‘你既敢通敌，便以血洗罪。今命你亲率部下，出南门迎敌——若胜，可赎前愆；若败，便是自取其戮。’话音未落，号角骤响，三万火把齐燃，映得整座城池如血染。南门轰然开启，守将踉跄而出，身后士卒面面相觑，脚步沉重。夜色中，汉军伏兵似有动静，而项羽伫立原地，眸光如刀，正等待一场风暴的开端。", "choices": [{"option": "命人暗中换上敌军服饰，趁乱潜入南门'
2025-09-27 00:16:24 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=929 预览='{"text": "项羽立于辕门之下，寒风卷起残破战袍，铁链在月光下泛着冷光。那守将被缚于木桩之上，双耳穿铁环，血迹蜿蜒至脖颈，却仍死死咬住嘴唇不发一言。楚军列阵如林，目光灼灼，静待王命。项羽缓缓抽出佩剑，剑尖轻点其肩，声音低沉如雷：‘你既敢通敌，便以血洗罪。今命你亲率部下，出南门迎敌——若胜，可赎前愆；若败，便是自取'
2025-09-27 00:16:24 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=929 预览='{"text": "项羽立于辕门之下，寒风卷起残破战袍，铁链在月光下泛着冷光。那守将被缚于木桩之上，双耳穿铁环，血迹蜿蜒至脖颈，却仍死死咬住嘴唇不发一言。楚军列阵如林，目光灼灼，静待王命。项羽缓缓抽出佩剑，剑尖轻点其肩，声音低沉如雷：‘你既敢通敌，便以血洗罪。今命你亲率部下，出南门迎敌——若胜，可赎前愆；若败，便是自取'
2025-09-27 00:16:24 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 246
2025-09-27 00:16:24 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 246
2025-09-27 00:16:24 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:24 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于辕门之下，寒风卷...
2025-09-27 00:16:24 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:24 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于辕门之下，寒风卷...
2025-09-27 00:16:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1802
2025-09-27 00:16:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=842 预览='{"text": "月光如霜，洒在项羽披甲的肩头。他缓步走向前营，长戟拄地，每一步都似踏碎寒夜。《楚辞·国殇》的吟诵声自喉间涌出，字字如铁，句句带血——‘身既死兮神以灵，魂魄毅兮为鬼雄！’ 声浪翻滚，惊起宿鸟，连风也凝滞片刻。士卒们从战壕中抬头，眼中火光渐燃，有人跪伏，有人握紧刀柄，南门方向传来低沉的应和。那名叛将立于城楼之上，面露惊惧，却不敢动弹。项羽不语，只将佩剑缓缓插入地面，剑锋震颤，如君王之怒未歇。军心如潮，倒流回这孤城之中。", "choices": [{"option": "命人将叛将绑于旗杆，当众剖心祭旗", "summary": "以血祭军心，震慑三军", "effects":'
2025-09-27 00:16:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=842 预览='{"text": "月光如霜，洒在项羽披甲的肩头。他缓步走向前营，长戟拄地，每一步都似踏碎寒夜。《楚辞·国殇》的吟诵声自喉间涌出，字字如铁，句句带血——‘身既死兮神以灵，魂魄毅兮为鬼雄！’ 声浪翻滚，惊起宿鸟，连风也凝滞片刻。士卒们从战壕中抬头，眼中火光渐燃，有人跪伏，有人握紧刀柄，南门方向传来低沉的应和。那名叛将立于'
2025-09-27 00:16:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=842 预览='{"text": "月光如霜，洒在项羽披甲的肩头。他缓步走向前营，长戟拄地，每一步都似踏碎寒夜。《楚辞·国殇》的吟诵声自喉间涌出，字字如铁，句句带血——‘身既死兮神以灵，魂魄毅兮为鬼雄！’ 声浪翻滚，惊起宿鸟，连风也凝滞片刻。士卒们从战壕中抬头，眼中火光渐燃，有人跪伏，有人握紧刀柄，南门方向传来低沉的应和。那名叛将立于'
2025-09-27 00:16:28 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 209
2025-09-27 00:16:28 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 209
2025-09-27 00:16:28 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:28 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 月光如霜，洒在项羽披甲的...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 月光如霜，洒在项羽披甲的...
2025-09-27 00:16:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1827
2025-09-27 00:16:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=871 预览='{"text": "月光如霜，洒在项羽披甲的背影上。他缓步走向前营，戟尖轻点地面，发出低沉的嗡鸣。《国殇》之声自喉间涌出，字字如铁，句句泣血：‘身既死兮神以灵，魂魄毅兮为鬼雄！’ 声浪翻卷，穿透寒夜，直抵每一颗颤抖的心。士卒们闻声驻足，仰首凝望那孤傲身影，眼中火光渐起。南门守将立于城楼，面如土色，手中长刀悄然滑落。风止，鼓声顿歇，连汉军的斥候都屏息凝听。这一刻，不是战鼓，而是灵魂的号角——楚军的脊梁，在悲歌中重新挺直。", "choices": [{"option": "命人将《国殇》刻于石碑，立于南门之下，以示不屈", "summary": "以文铸魂，让誓言永存于城垣之间", "effec'
2025-09-27 00:16:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=871 预览='{"text": "月光如霜，洒在项羽披甲的背影上。他缓步走向前营，戟尖轻点地面，发出低沉的嗡鸣。《国殇》之声自喉间涌出，字字如铁，句句泣血：‘身既死兮神以灵，魂魄毅兮为鬼雄！’ 声浪翻卷，穿透寒夜，直抵每一颗颤抖的心。士卒们闻声驻足，仰首凝望那孤傲身影，眼中火光渐起。南门守将立于城楼，面如土色，手中长刀悄然滑落。风止'
2025-09-27 00:16:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=871 预览='{"text": "月光如霜，洒在项羽披甲的背影上。他缓步走向前营，戟尖轻点地面，发出低沉的嗡鸣。《国殇》之声自喉间涌出，字字如铁，句句泣血：‘身既死兮神以灵，魂魄毅兮为鬼雄！’ 声浪翻卷，穿透寒夜，直抵每一颗颤抖的心。士卒们闻声驻足，仰首凝望那孤傲身影，眼中火光渐起。南门守将立于城楼，面如土色，手中长刀悄然滑落。风止'
2025-09-27 00:16:28 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 201
2025-09-27 00:16:28 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 201
2025-09-27 00:16:28 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:28 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 月光如霜，洒在项羽披甲的...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 月光如霜，洒在项羽披甲的...
2025-09-27 00:16:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:16:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1850
2025-09-27 00:16:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=922 预览='{"text": "月光如霜，洒在项羽披甲的肩头，他缓步走向前营，戟尖轻点地面，发出低沉的嗡鸣。《国殇》之声自喉间迸出，声震四野——‘身既死兮神以灵，魂魄毅兮为鬼雄！’楚军将士闻之，纷纷抬头，目光由涣散转为凝重。战马嘶鸣渐息，士卒垂首，仿佛听见了千军万马的回响。南门守将立于城楼之上，面露惊疑，却不敢动弹。项羽不看其人，只将长戟插入泥土，任风卷起残旗，猎猎作响。他身后，万千将士悄然列阵，如铁铸般肃立。这一刻，不是威压，而是信仰的复苏。那幅《山河图》上的墨痕，正随夜风缓缓流淌，似在应和着这天地间的悲歌。", "choices": [{"option": "命人将《国殇》刻于断戟之上，悬于城头，以示'
2025-09-27 00:16:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=922 预览='{"text": "月光如霜，洒在项羽披甲的肩头，他缓步走向前营，戟尖轻点地面，发出低沉的嗡鸣。《国殇》之声自喉间迸出，声震四野——‘身既死兮神以灵，魂魄毅兮为鬼雄！’楚军将士闻之，纷纷抬头，目光由涣散转为凝重。战马嘶鸣渐息，士卒垂首，仿佛听见了千军万马的回响。南门守将立于城楼之上，面露惊疑，却不敢动弹。项羽不看其人，'
2025-09-27 00:16:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=922 预览='{"text": "月光如霜，洒在项羽披甲的肩头，他缓步走向前营，戟尖轻点地面，发出低沉的嗡鸣。《国殇》之声自喉间迸出，声震四野——‘身既死兮神以灵，魂魄毅兮为鬼雄！’楚军将士闻之，纷纷抬头，目光由涣散转为凝重。战马嘶鸣渐息，士卒垂首，仿佛听见了千军万马的回响。南门守将立于城楼之上，面露惊疑，却不敢动弹。项羽不看其人，'
2025-09-27 00:16:28 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 242
2025-09-27 00:16:28 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 242
2025-09-27 00:16:28 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:16:28 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 月光如霜，洒在项羽披甲的...
2025-09-27 00:16:28 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:16:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 月光如霜，洒在项羽披甲的...
2025-09-27 00:16:34 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:34 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:34 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:34 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903394014_809.png
2025-09-27 00:16:34 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903394014_809.png
2025-09-27 00:16:34 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:34 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903394014_809.png
2025-09-27 00:16:35 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-27 00:16:35 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 86
2025-09-27 00:16:35 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:35 | WARNING  | core.image_service:_extract_image_url:133 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-27 00:16:35 | WARNING  | core.image_service:generate_image_realtime:100 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL，降级到随机图库
2025-09-27 00:16:35 | INFO     | core.image_service:get_random_image_from_library:44 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 00:16:35 | INFO     | core.image_service:get_random_image_from_library:54 - [ImageLibrary] ✅ 随机选择图片: fantasy_castle.jpg
2025-09-27 00:16:35 | INFO     | core.image_service:get_random_image_from_library:55 - [ImageLibrary] 🎯 返回图片URL: /static/fantasy_castle.jpg
2025-09-27 00:16:35 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/fantasy_castle.jpg
2025-09-27 00:16:35 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:35 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=94 choice='命亲卫伪装成溃兵混入北门，趁乱探明敌情' text_length=228
2025-09-27 00:16:35 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=94 choice='命亲卫伪装成溃兵混入北门，趁乱探明敌情'
2025-09-27 00:16:35 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=96 parent=94 choice='命亲卫伪装成溃兵混入北门，趁乱探明敌情'
2025-09-27 00:16:35 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=96 image_url=/static/fantasy_castle.jpg
2025-09-27 00:16:35 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=96 depth=1
2025-09-27 00:16:35 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=96 completed, triggered next level depth=1
2025-09-27 00:16:35 | INFO     | core.speculation:_run_pipeline:100 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=7 node=96
2025-09-27 00:16:36 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:36 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:36 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:36 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903395990_429.png
2025-09-27 00:16:36 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903395990_429.png
2025-09-27 00:16:36 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:36 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903395990_429.png
2025-09-27 00:16:36 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-27 00:16:36 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 86
2025-09-27 00:16:36 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:36 | WARNING  | core.image_service:_extract_image_url:133 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-27 00:16:36 | WARNING  | core.image_service:generate_image_realtime:100 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL，降级到随机图库
2025-09-27 00:16:36 | INFO     | core.image_service:get_random_image_from_library:44 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 00:16:36 | INFO     | core.image_service:get_random_image_from_library:54 - [ImageLibrary] ✅ 随机选择图片: background1.jpg
2025-09-27 00:16:36 | INFO     | core.image_service:get_random_image_from_library:55 - [ImageLibrary] 🎯 返回图片URL: /static/background1.jpg
2025-09-27 00:16:36 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/background1.jpg
2025-09-27 00:16:36 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:36 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=94 choice='召集群将，当众宣读军令，公开质问南门守将' text_length=246
2025-09-27 00:16:36 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=94 choice='召集群将，当众宣读军令，公开质问南门守将'
2025-09-27 00:16:36 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=97 parent=94 choice='召集群将，当众宣读军令，公开质问南门守将'
2025-09-27 00:16:36 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=97 image_url=/static/background1.jpg
2025-09-27 00:16:36 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=97 depth=1
2025-09-27 00:16:36 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=97 completed, triggered next level depth=1
2025-09-27 00:16:38 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_8e38f6df881a2efca8596c397266c762.png (大小: 1346660 字节)
2025-09-27 00:16:38 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_8e38f6df881a2efca8596c397266c762.png
2025-09-27 00:16:38 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_8e38f6df881a2efca8596c397266c762.png
2025-09-27 00:16:38 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:38 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=93 choice='将童子抱至火堆前，亲手烤熟那半块干粮，分予全营' text_length=244
2025-09-27 00:16:38 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=93 choice='将童子抱至火堆前，亲手烤熟那半块干粮，分予全营'
2025-09-27 00:16:38 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=98 parent=93 choice='将童子抱至火堆前，亲手烤熟那半块干粮，分予全营'
2025-09-27 00:16:38 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=98 image_url=/static/generated/ai_gen_8e38f6df881a2efca8596c397266c762.png
2025-09-27 00:16:38 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=98 depth=1
2025-09-27 00:16:38 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=98 completed, triggered next level depth=1
2025-09-27 00:16:39 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:39 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:39 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:39 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903398108_712.png
2025-09-27 00:16:39 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903398108_712.png
2025-09-27 00:16:39 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:39 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903398108_712.png
2025-09-27 00:16:40 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 761
2025-09-27 00:16:40 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 127
2025-09-27 00:16:40 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:40 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903399506_933.png
2025-09-27 00:16:40 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903399506_933.png
2025-09-27 00:16:40 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:40 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903399506_933.png
2025-09-27 00:16:40 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_bf570e9b7858830a7938dfbba3342865.png (大小: 1510460 字节)
2025-09-27 00:16:40 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_bf570e9b7858830a7938dfbba3342865.png
2025-09-27 00:16:40 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_bf570e9b7858830a7938dfbba3342865.png
2025-09-27 00:16:40 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:40 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=93 choice='当众斩断守将头颅，以血祭旗，震慑军心' text_length=266
2025-09-27 00:16:40 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=93 choice='当众斩断守将头颅，以血祭旗，震慑军心'
2025-09-27 00:16:40 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=99 parent=93 choice='当众斩断守将头颅，以血祭旗，震慑军心'
2025-09-27 00:16:40 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=99 image_url=/static/generated/ai_gen_bf570e9b7858830a7938dfbba3342865.png
2025-09-27 00:16:40 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=99 depth=1
2025-09-27 00:16:40 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=99 completed, triggered next level depth=1
2025-09-27 00:16:41 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:41 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:41 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:41 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903400697_463.png
2025-09-27 00:16:41 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903400697_463.png
2025-09-27 00:16:41 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:41 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903400697_463.png
2025-09-27 00:16:41 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:41 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:41 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:41 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903401236_709.png
2025-09-27 00:16:41 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903401236_709.png
2025-09-27 00:16:41 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:41 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903401236_709.png
2025-09-27 00:16:42 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_e6f900d9d8d193645e5dddd31089588e.png (大小: 1389665 字节)
2025-09-27 00:16:42 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_e6f900d9d8d193645e5dddd31089588e.png
2025-09-27 00:16:42 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_e6f900d9d8d193645e5dddd31089588e.png
2025-09-27 00:16:42 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:42 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=93 choice='命人将守将绑在战鼓旁，用鼓声掩盖其哀嚎，逼其自陈罪状' text_length=228
2025-09-27 00:16:42 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=93 choice='命人将守将绑在战鼓旁，用鼓声掩盖其哀嚎，逼其自陈罪状'
2025-09-27 00:16:42 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=100 parent=93 choice='命人将守将绑在战鼓旁，用鼓声掩盖其哀嚎，逼其自陈罪状'
2025-09-27 00:16:42 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=100 image_url=/static/generated/ai_gen_e6f900d9d8d193645e5dddd31089588e.png
2025-09-27 00:16:42 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=100 depth=1
2025-09-27 00:16:42 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=100 completed, triggered next level depth=1
2025-09-27 00:16:43 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:16:43 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:16:43 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:16:43 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:16:43 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903403265_809.png
2025-09-27 00:16:43 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903403265_809.png
2025-09-27 00:16:43 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:16:43 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903403265_809.png
2025-09-27 00:16:44 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_1960a050ff2b090360bc9854e39adb5b.png (大小: 1483052 字节)
2025-09-27 00:16:44 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_1960a050ff2b090360bc9854e39adb5b.png
2025-09-27 00:16:44 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_1960a050ff2b090360bc9854e39adb5b.png
2025-09-27 00:16:44 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=94 choice='亲自率精锐突袭北门，以雷霆之势震慑内外' text_length=250
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=94 choice='亲自率精锐突袭北门，以雷霆之势震慑内外'
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=101 parent=94 choice='亲自率精锐突袭北门，以雷霆之势震慑内外'
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=101 image_url=/static/generated/ai_gen_1960a050ff2b090360bc9854e39adb5b.png
2025-09-27 00:16:44 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=101 depth=1
2025-09-27 00:16:44 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '亲自率精锐突袭北门，以雷霆之势震慑内外': cannot schedule new futures after shutdown
2025-09-27 00:16:44 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_ce4e53d70b25e3b346308cd0c4009ac0.png (大小: 1274556 字节)
2025-09-27 00:16:44 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_ce4e53d70b25e3b346308cd0c4009ac0.png
2025-09-27 00:16:44 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_ce4e53d70b25e3b346308cd0c4009ac0.png
2025-09-27 00:16:44 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=95 choice='命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行' text_length=201
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=95 choice='命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行'
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=102 parent=95 choice='命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行'
2025-09-27 00:16:44 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=102 image_url=/static/generated/ai_gen_ce4e53d70b25e3b346308cd0c4009ac0.png
2025-09-27 00:16:44 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=102 depth=1
2025-09-27 00:16:44 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '命人将守将囚于战鼓之下，令其听三日三夜鼓声，静待其自曝罪行': cannot schedule new futures after shutdown
2025-09-27 00:16:45 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_e7162d57f52fc87debe2252a7d651749.png (大小: 1563583 字节)
2025-09-27 00:16:45 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_e7162d57f52fc87debe2252a7d651749.png
2025-09-27 00:16:45 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_e7162d57f52fc87debe2252a7d651749.png
2025-09-27 00:16:45 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:45 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=95 choice='召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应' text_length=209
2025-09-27 00:16:45 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=95 choice='召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应'
2025-09-27 00:16:45 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=103 parent=95 choice='召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应'
2025-09-27 00:16:45 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=103 image_url=/static/generated/ai_gen_e7162d57f52fc87debe2252a7d651749.png
2025-09-27 00:16:45 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=103 depth=1
2025-09-27 00:16:45 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '召来所有将领共饮一壶烈酒，借醉话试探忠心，暗中观察神情反应': cannot schedule new futures after shutdown
2025-09-27 00:16:48 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_bd47ee7e938742abf98512c72caf9547.png (大小: 1509986 字节)
2025-09-27 00:16:48 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_bd47ee7e938742abf98512c72caf9547.png
2025-09-27 00:16:48 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_bd47ee7e938742abf98512c72caf9547.png
2025-09-27 00:16:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:16:48 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=95 choice='当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众' text_length=242
2025-09-27 00:16:48 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=95 choice='当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众'
2025-09-27 00:16:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=104 parent=95 choice='当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众'
2025-09-27 00:16:48 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=104 image_url=/static/generated/ai_gen_bd47ee7e938742abf98512c72caf9547.png
2025-09-27 00:16:48 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=7 node=104 depth=1
2025-09-27 00:16:48 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '当众斩首叛将，以血祭旗，再命亲兵高举其首环营示众': cannot schedule new futures after shutdown
2025-09-27 00:24:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:24:53 | INFO     | core.image_service:_load_image_library:37 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:24:54 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:24:54 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:24:54 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:24:54 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:24:54 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:24:54 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:24:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:24:54 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:24:54 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:24:54 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 00:24:54 | INFO     | backend.main:_run_alembic_cmd:96 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:24:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:24:55 | INFO     | backend.main:_run_alembic_cmd:98 - Alembic migration complete.
2025-09-27 00:24:55 | INFO     | backend.main:startup_event:109 - 重生之我是……API服务启动
2025-09-27 00:24:55 | INFO     | backend.main:startup_event:110 - 调试模式: True
2025-09-27 00:24:55 | INFO     | backend.main:startup_event:115 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:24:55 | INFO     | backend.main:startup_event:116 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:25:13 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：刘邦...
2025-09-27 00:25:13 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 00:25:13 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 11
2025-09-27 00:25:13 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 509
2025-09-27 00:25:14 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:14 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 927
2025-09-27 00:25:14 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 211
2025-09-27 00:25:14 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 00:25:14 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 草根起兵：沛县风云, background: 秦末暴政，民不聊生。你作为泗水亭长刘邦，目睹百姓流离失所，心中燃起反旗。昔日同僚畏惧权势，唯恐牵连；..., quest: 在三十日内，拉拢三名关键盟友并建立初步势力...
2025-09-27 00:25:14 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:25:14 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:25:14 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:25:14 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘邦'
2025-09-27 00:25:17 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:17 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1382
2025-09-27 00:25:17 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=802 预览='{"text": "夜色如墨，荥阳城外的风卷起残旗，远处楚军营火明灭不定。刘邦独坐于山丘之上，手中握着一封密信——韩信已破赵地，但粮道被断，三日未通。他眯眼望向天际，忽而轻笑一声：‘项羽以为我困守孤城，却不知我早布一局。’身旁谋士低语：‘若派细作偷运粮草，需借道敌后，险中求生。’他缓缓起身，袍角扫过冷石，目光如刀，直指那片幽暗的战场。", "choices": [{"option": "命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息", "summary": "以假乱真，将计就计引蛇出洞", "effects": {"delta_progress": 12, "delta_risk": 6,'
2025-09-27 00:25:17 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=802 预览='{"text": "夜色如墨，荥阳城外的风卷起残旗，远处楚军营火明灭不定。刘邦独坐于山丘之上，手中握着一封密信——韩信已破赵地，但粮道被断，三日未通。他眯眼望向天际，忽而轻笑一声：‘项羽以为我困守孤城，却不知我早布一局。’身旁谋士低语：‘若派细作偷运粮草，需借道敌后，险中求生。’他缓缓起身，袍角扫过冷石，目光如刀，直指'
2025-09-27 00:25:17 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=802 预览='{"text": "夜色如墨，荥阳城外的风卷起残旗，远处楚军营火明灭不定。刘邦独坐于山丘之上，手中握着一封密信——韩信已破赵地，但粮道被断，三日未通。他眯眼望向天际，忽而轻笑一声：‘项羽以为我困守孤城，却不知我早布一局。’身旁谋士低语：‘若派细作偷运粮草，需借道敌后，险中求生。’他缓缓起身，袍角扫过冷石，目光如刀，直指'
2025-09-27 00:25:17 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 158
2025-09-27 00:25:17 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:17 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 158
2025-09-27 00:25:17 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:17 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 00:25:17 | INFO     | core.image_storage:__init__:27 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:25:17 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:17 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，荥阳城外的风卷...
2025-09-27 00:25:17 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:17 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，荥阳城外的风卷...
2025-09-27 00:25:30 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:25:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:25:30 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:25:30 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903929305_281.png
2025-09-27 00:25:30 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903929305_281.png
2025-09-27 00:25:30 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:25:30 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903929305_281.png
2025-09-27 00:25:34 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_209dfdd95fc85146395b45eacc6cd7c6.png (大小: 1226095 字节)
2025-09-27 00:25:34 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_209dfdd95fc85146395b45eacc6cd7c6.png
2025-09-27 00:25:34 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_209dfdd95fc85146395b45eacc6cd7c6.png
2025-09-27 00:25:34 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 00:25:34 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=158
2025-09-27 00:25:34 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=8
2025-09-27 00:25:34 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=105
2025-09-27 00:25:34 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=105 image_url=/static/generated/ai_gen_209dfdd95fc85146395b45eacc6cd7c6.png
2025-09-27 00:25:34 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=105 depth=3
2025-09-27 00:25:34 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=8, node=105
2025-09-27 00:25:34 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=8
2025-09-27 00:25:34 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:25:34 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=105
2025-09-27 00:25:34 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=105 choice='命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息'
2025-09-27 00:25:34 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=105 choice='命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息'
2025-09-27 00:25:34 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=105 choice='亲率百骑夜袭敌哨，以雷霆之势夺下要道，逼其自乱阵脚'
2025-09-27 00:25:34 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息
2025-09-27 00:25:34 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=105 choice='遣使与陈余旧部暗通款曲，以故人之名换取一条隐秘小径'
2025-09-27 00:25:34 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=105 choice='亲率百骑夜袭敌哨，以雷霆之势夺下要道，逼其自乱阵脚'
2025-09-27 00:25:34 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=105 choice='遣使与陈余旧部暗通款曲，以故人之名换取一条隐秘小径'
2025-09-27 00:25:34 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率百骑夜袭敌哨，以雷霆之势夺下要道，逼其自乱阵脚
2025-09-27 00:25:34 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 遣使与陈余旧部暗通款曲，以故人之名换取一条隐秘小径
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 刘邦...
2025-09-27 00:25:37 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 00:25:37 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:-6942782752907474051
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=8, node=105
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=8, node_id=105
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=8, node_id=105
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 158, 选择数: 3, 图片: /static/generated/ai_gen_209dfdd95fc85146395b45eacc6cd7c6.png
2025-09-27 00:25:37 | INFO     | api.story:start_new_story:482 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=8, node=105
2025-09-27 00:25:38 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:38 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1575
2025-09-27 00:25:38 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=871 预览='{"text": "夜风卷起刘邦的衣袍，他凝视着远处敌营火光，忽然将密信投入篝火。火焰跃动间映出他眼底深沉的算计。‘韩信等我三日，若粮不至，他可自破赵地；但若我先一步断项羽之援，天下格局便改。’他转身对身旁谋士低语：‘去唤陈平来，让他带一支假旗队，扮作楚军斥候，直插彭城东侧山道——那里有条旧矿道，曾是项羽埋兵之处。’谋士领命而去，足音渐远。刘邦独坐石上，指尖轻敲膝盖，仿佛在数着命运的节拍。风过处，残旗猎猎，如战鼓未歇。", "choices": [{"option": "命人点燃山头烽火，伪造楚军主力集结的假象", "summary": "以虚张声势扰乱敌军判断，引其调兵自保", "effec'
2025-09-27 00:25:38 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=871 预览='{"text": "夜风卷起刘邦的衣袍，他凝视着远处敌营火光，忽然将密信投入篝火。火焰跃动间映出他眼底深沉的算计。‘韩信等我三日，若粮不至，他可自破赵地；但若我先一步断项羽之援，天下格局便改。’他转身对身旁谋士低语：‘去唤陈平来，让他带一支假旗队，扮作楚军斥候，直插彭城东侧山道——那里有条旧矿道，曾是项羽埋兵之处。’谋'
2025-09-27 00:25:38 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=871 预览='{"text": "夜风卷起刘邦的衣袍，他凝视着远处敌营火光，忽然将密信投入篝火。火焰跃动间映出他眼底深沉的算计。‘韩信等我三日，若粮不至，他可自破赵地；但若我先一步断项羽之援，天下格局便改。’他转身对身旁谋士低语：‘去唤陈平来，让他带一支假旗队，扮作楚军斥候，直插彭城东侧山道——那里有条旧矿道，曾是项羽埋兵之处。’谋'
2025-09-27 00:25:38 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 201
2025-09-27 00:25:38 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:38 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 201
2025-09-27 00:25:38 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:38 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:38 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的衣袍，他凝...
2025-09-27 00:25:38 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:38 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的衣袍，他凝...
2025-09-27 00:25:38 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:38 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1598
2025-09-27 00:25:38 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=892 预览='{"text": "夜风撕扯着残破的战旗，刘邦凝视着远处楚军营帐间跳动的火光，忽然从怀中取出一枚青铜虎符——那是韩信亲授的调兵信物。他低声对身旁谋士道：‘若粮道断绝，便让韩信以奇兵绕道敖仓，假传我令，诱项羽分兵。’话音未落，一队骑兵自山后疾驰而至，马蹄踏碎枯枝，为首者肩头染血，嘶声报捷：‘陈平已策反荥阳守将，城内暗藏三处粮窖！’刘邦眸光微闪，手指轻叩膝上剑柄，仿佛听见了天命的低语——这一局，不止是粮草之争，更是人心与时机的角力。", "choices": [{"option": "命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力", "summary": "以权谋牵制敌方部署，制造'
2025-09-27 00:25:38 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=892 预览='{"text": "夜风撕扯着残破的战旗，刘邦凝视着远处楚军营帐间跳动的火光，忽然从怀中取出一枚青铜虎符——那是韩信亲授的调兵信物。他低声对身旁谋士道：‘若粮道断绝，便让韩信以奇兵绕道敖仓，假传我令，诱项羽分兵。’话音未落，一队骑兵自山后疾驰而至，马蹄踏碎枯枝，为首者肩头染血，嘶声报捷：‘陈平已策反荥阳守将，城内暗藏三'
2025-09-27 00:25:38 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=892 预览='{"text": "夜风撕扯着残破的战旗，刘邦凝视着远处楚军营帐间跳动的火光，忽然从怀中取出一枚青铜虎符——那是韩信亲授的调兵信物。他低声对身旁谋士道：‘若粮道断绝，便让韩信以奇兵绕道敖仓，假传我令，诱项羽分兵。’话音未落，一队骑兵自山后疾驰而至，马蹄踏碎枯枝，为首者肩头染血，嘶声报捷：‘陈平已策反荥阳守将，城内暗藏三'
2025-09-27 00:25:38 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 206
2025-09-27 00:25:38 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:38 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 206
2025-09-27 00:25:38 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:38 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:38 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风撕扯着残破的战旗，刘...
2025-09-27 00:25:38 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:38 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风撕扯着残破的战旗，刘...
2025-09-27 00:25:42 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:42 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1564
2025-09-27 00:25:42 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=852 预览='{"text": "风卷残旗，火光在远处楚军营帐间跳动如鬼影。刘邦凝视着手中那封被火漆封印的急报——韩信粮道断绝，三日无援，士卒已食草根。他缓缓将信折成纸鸢形状，掷入夜风。‘若信不能达，便让风替我传话。’他转身对谋士低语：‘去唤那‘夜行鸦’来，我要借他们的眼睛，看穿项羽的耳目。’山丘之下，一队黑衣人悄然从林中现身，肩披鸦羽，面覆青铜面具，仿佛从幽冥走出。刘邦嘴角微扬：‘今夜，不是我们求生，是敌人的命该断了。’", "choices": [{"option": "命夜行鸦假扮楚军斥候，混入敌营传递假情报", "summary": "以诡计扰乱敌军部署，制造混乱时机", "effects": {"'
2025-09-27 00:25:42 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=852 预览='{"text": "风卷残旗，火光在远处楚军营帐间跳动如鬼影。刘邦凝视着手中那封被火漆封印的急报——韩信粮道断绝，三日无援，士卒已食草根。他缓缓将信折成纸鸢形状，掷入夜风。‘若信不能达，便让风替我传话。’他转身对谋士低语：‘去唤那‘夜行鸦’来，我要借他们的眼睛，看穿项羽的耳目。’山丘之下，一队黑衣人悄然从林中现身，肩披'
2025-09-27 00:25:42 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=852 预览='{"text": "风卷残旗，火光在远处楚军营帐间跳动如鬼影。刘邦凝视着手中那封被火漆封印的急报——韩信粮道断绝，三日无援，士卒已食草根。他缓缓将信折成纸鸢形状，掷入夜风。‘若信不能达，便让风替我传话。’他转身对谋士低语：‘去唤那‘夜行鸦’来，我要借他们的眼睛，看穿项羽的耳目。’山丘之下，一队黑衣人悄然从林中现身，肩披'
2025-09-27 00:25:42 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 196
2025-09-27 00:25:42 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:42 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 196
2025-09-27 00:25:42 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:42 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:42 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残旗，火光在远处楚军...
2025-09-27 00:25:42 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:42 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残旗，火光在远处楚军...
2025-09-27 00:25:51 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 775
2025-09-27 00:25:51 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 141
2025-09-27 00:25:51 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:25:51 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903950568_437.png
2025-09-27 00:25:51 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903950568_437.png
2025-09-27 00:25:51 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:25:51 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903950568_437.png
2025-09-27 00:25:52 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:25:52 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:25:52 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:25:52 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903952042_095.png
2025-09-27 00:25:52 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903952042_095.png
2025-09-27 00:25:52 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:25:52 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903952042_095.png
2025-09-27 00:25:54 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_9c9139ad65d75c1ffee6b906f890872e.png (大小: 1391368 字节)
2025-09-27 00:25:54 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_9c9139ad65d75c1ffee6b906f890872e.png
2025-09-27 00:25:54 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_9c9139ad65d75c1ffee6b906f890872e.png
2025-09-27 00:25:54 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=105 choice='亲率百骑夜袭敌哨，以雷霆之势夺下要道，逼其自乱阵脚' text_length=206
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=105 choice='亲率百骑夜袭敌哨，以雷霆之势夺下要道，逼其自乱阵脚'
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=106 parent=105 choice='亲率百骑夜袭敌哨，以雷霆之势夺下要道，逼其自乱阵脚'
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=106 image_url=/static/generated/ai_gen_9c9139ad65d75c1ffee6b906f890872e.png
2025-09-27 00:25:54 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=106 depth=2
2025-09-27 00:25:54 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=106 completed, triggered next level depth=2
2025-09-27 00:25:54 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=106
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=106 choice='命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力'
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=106 choice='亲率亲卫潜入城内密窖，亲自点验粮草并下令开仓赈济流民，收拢人心'
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=106 choice='命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力'
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=106 choice='将虎符交予一名老卒，命其乔装成驿使，沿古道向南传递密信，引诱项羽误判方向'
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=106 choice='亲率亲卫潜入城内密窖，亲自点验粮草并下令开仓赈济流民，收拢人心'
2025-09-27 00:25:54 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=106 choice='将虎符交予一名老卒，命其乔装成驿使，沿古道向南传递密信，引诱项羽误判方向'
2025-09-27 00:25:54 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率亲卫潜入城内密窖，亲自点验粮草并下令开仓赈济流民，收拢人心
2025-09-27 00:25:54 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将虎符交予一名老卒，命其乔装成驿使，沿古道向南传递密信，引诱项羽误判方向
2025-09-27 00:25:54 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_c7c7cb9f479cce5b4ee21f20ab0ad3e4.png (大小: 1479963 字节)
2025-09-27 00:25:54 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_c7c7cb9f479cce5b4ee21f20ab0ad3e4.png
2025-09-27 00:25:54 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_c7c7cb9f479cce5b4ee21f20ab0ad3e4.png
2025-09-27 00:25:54 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=105 choice='命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息' text_length=201
2025-09-27 00:25:54 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=105 choice='命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息'
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=107 parent=105 choice='命人扮作楚军俘虏，押送粮车混入敌营，借机传递消息'
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=107 image_url=/static/generated/ai_gen_c7c7cb9f479cce5b4ee21f20ab0ad3e4.png
2025-09-27 00:25:55 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=107 depth=2
2025-09-27 00:25:55 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=107 completed, triggered next level depth=2
2025-09-27 00:25:55 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=107
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=107 choice='命人点燃山头烽火，伪造楚军主力集结的假象'
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=107 choice='命人点燃山头烽火，伪造楚军主力集结的假象'
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=107 choice='亲率五名精锐潜入矿道，亲自勘验地形并设伏'
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=107 choice='遣使暗通彭城内应，用一封伪造的项羽密令诱敌自乱'
2025-09-27 00:25:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人点燃山头烽火，伪造楚军主力集结的假象
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=107 choice='亲率五名精锐潜入矿道，亲自勘验地形并设伏'
2025-09-27 00:25:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=107 choice='遣使暗通彭城内应，用一封伪造的项羽密令诱敌自乱'
2025-09-27 00:25:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率五名精锐潜入矿道，亲自勘验地形并设伏
2025-09-27 00:25:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 遣使暗通彭城内应，用一封伪造的项羽密令诱敌自乱
2025-09-27 00:25:57 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:25:57 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:25:57 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:25:57 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903956526_088.png
2025-09-27 00:25:57 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903956526_088.png
2025-09-27 00:25:57 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:25:57 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903956526_088.png
2025-09-27 00:25:58 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:58 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1844
2025-09-27 00:25:58 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=924 预览='{"text": "夜风如刀，刘邦翻身跃上战马，百骑铁甲在月色下泛着冷光。他挥剑指向敌哨方向，低喝一声：‘随我冲！’马蹄踏碎枯枝，如雷贯耳，直扑那处孤悬于山口的楚军瞭望台。火把摇曳间，守兵惊觉，刚欲鸣鼓，箭雨已至——一箭穿喉，两骑突入，刀光劈开夜幕。敌哨瞬间溃乱，旗倒人散。刘邦立于高坡，望着火光中仓皇奔逃的残兵，嘴角微扬：‘项羽啊项羽，你算准了我守城，却没算到我敢以命搏命。’远处传来战鼓渐近，是楚军主力正朝此地压来，而粮道已在眼前，但代价也已显露——这雷霆一击，必将引来更猛烈的反扑。", "choices": [{"option": "命人点燃烽火，诈称援军抵达，诱敌疑兵自乱阵脚", "sum'
2025-09-27 00:25:58 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=924 预览='{"text": "夜风如刀，刘邦翻身跃上战马，百骑铁甲在月色下泛着冷光。他挥剑指向敌哨方向，低喝一声：‘随我冲！’马蹄踏碎枯枝，如雷贯耳，直扑那处孤悬于山口的楚军瞭望台。火把摇曳间，守兵惊觉，刚欲鸣鼓，箭雨已至——一箭穿喉，两骑突入，刀光劈开夜幕。敌哨瞬间溃乱，旗倒人散。刘邦立于高坡，望着火光中仓皇奔逃的残兵，嘴角微'
2025-09-27 00:25:58 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=924 预览='{"text": "夜风如刀，刘邦翻身跃上战马，百骑铁甲在月色下泛着冷光。他挥剑指向敌哨方向，低喝一声：‘随我冲！’马蹄踏碎枯枝，如雷贯耳，直扑那处孤悬于山口的楚军瞭望台。火把摇曳间，守兵惊觉，刚欲鸣鼓，箭雨已至——一箭穿喉，两骑突入，刀光劈开夜幕。敌哨瞬间溃乱，旗倒人散。刘邦立于高坡，望着火光中仓皇奔逃的残兵，嘴角微'
2025-09-27 00:25:58 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 234
2025-09-27 00:25:58 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 234
2025-09-27 00:25:58 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:58 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，刘邦翻身跃上战...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:58 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，刘邦翻身跃上战...
2025-09-27 00:25:58 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:58 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1845
2025-09-27 00:25:58 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=911 预览='{"text": "夜色如铁，刘邦翻身跃上战马，百骑如墨流般隐入风沙。他勒马于断崖之畔，俯视下方敌哨——火把摇曳，守卒呵气成霜。他低喝一声，亲率精锐自山脊疾冲而下，马蹄踏碎枯枝，铁甲映着星火，如雷霆劈开沉寂。敌哨猝然惊觉，仓促鸣鼓，却已迟了半步。刘邦一剑挑落旗杆，血染寒霜，敌军阵脚大乱，奔逃者踩踏彼此。他立于高处，冷眼扫视溃兵，心中默念：‘项羽，你可曾料到，这孤城之主竟敢以百骑破千营？’远处传来马蹄轰鸣，陈平的密信正从城中飞驰而来，字迹未干，却已点燃燎原之火。", "choices": [{"option": "命人点燃三处烽火台，伪造大军压境之势，引敌军主力南调", "summary": "'
2025-09-27 00:25:58 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=911 预览='{"text": "夜色如铁，刘邦翻身跃上战马，百骑如墨流般隐入风沙。他勒马于断崖之畔，俯视下方敌哨——火把摇曳，守卒呵气成霜。他低喝一声，亲率精锐自山脊疾冲而下，马蹄踏碎枯枝，铁甲映着星火，如雷霆劈开沉寂。敌哨猝然惊觉，仓促鸣鼓，却已迟了半步。刘邦一剑挑落旗杆，血染寒霜，敌军阵脚大乱，奔逃者踩踏彼此。他立于高处，冷眼'
2025-09-27 00:25:58 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=911 预览='{"text": "夜色如铁，刘邦翻身跃上战马，百骑如墨流般隐入风沙。他勒马于断崖之畔，俯视下方敌哨——火把摇曳，守卒呵气成霜。他低喝一声，亲率精锐自山脊疾冲而下，马蹄踏碎枯枝，铁甲映着星火，如雷霆劈开沉寂。敌哨猝然惊觉，仓促鸣鼓，却已迟了半步。刘邦一剑挑落旗杆，血染寒霜，敌军阵脚大乱，奔逃者踩踏彼此。他立于高处，冷眼'
2025-09-27 00:25:58 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 222
2025-09-27 00:25:58 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 222
2025-09-27 00:25:58 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:58 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，刘邦翻身跃上战...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:58 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，刘邦翻身跃上战...
2025-09-27 00:25:58 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:25:58 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1861
2025-09-27 00:25:58 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=947 预览='{"text": "夜风如刀，刘邦翻身跃上战马，铁甲在月光下泛着冷芒。他一声令下，百骑如黑潮奔涌，踏碎枯枝，直扑楚军哨所。火把未燃，人已近前——箭雨骤起，却已被伏兵引开。他策马冲入敌阵中央，剑锋划过旗杆，将一面楚军令旗斩落于地，随即高举虎符大喝：‘汉王亲至，降者免死！’刹那间，守卒惊惶四散，营门洞开。远处传来战鼓急响，仿佛天地为之一震。这雷霆一击，不仅夺下要道，更在敌人心中种下疑云——谁敢担保那不是诈？刘邦立于断墙之上，目光扫过溃散的敌影，嘴角微扬：‘项羽啊项羽，你算尽天机，却不知我早将人心，当作最利之刃。’", "choices": [{"option": "命人点燃三处烽火台，伪造大军压境'
2025-09-27 00:25:58 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=947 预览='{"text": "夜风如刀，刘邦翻身跃上战马，铁甲在月光下泛着冷芒。他一声令下，百骑如黑潮奔涌，踏碎枯枝，直扑楚军哨所。火把未燃，人已近前——箭雨骤起，却已被伏兵引开。他策马冲入敌阵中央，剑锋划过旗杆，将一面楚军令旗斩落于地，随即高举虎符大喝：‘汉王亲至，降者免死！’刹那间，守卒惊惶四散，营门洞开。远处传来战鼓急响，'
2025-09-27 00:25:58 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=947 预览='{"text": "夜风如刀，刘邦翻身跃上战马，铁甲在月光下泛着冷芒。他一声令下，百骑如黑潮奔涌，踏碎枯枝，直扑楚军哨所。火把未燃，人已近前——箭雨骤起，却已被伏兵引开。他策马冲入敌阵中央，剑锋划过旗杆，将一面楚军令旗斩落于地，随即高举虎符大喝：‘汉王亲至，降者免死！’刹那间，守卒惊惶四散，营门洞开。远处传来战鼓急响，'
2025-09-27 00:25:58 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 247
2025-09-27 00:25:58 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 247
2025-09-27 00:25:58 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:25:58 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，刘邦翻身跃上战...
2025-09-27 00:25:58 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:25:58 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风如刀，刘邦翻身跃上战...
2025-09-27 00:26:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:26:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1834
2025-09-27 00:26:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=919 预览='{"text": "夜色如铁，荥阳城外的风卷着枯叶掠过断墙。刘邦凝视着那支被蒙上黑布的粮车，车轮碾过泥泞，发出沉闷的呻吟。他低声道：‘让陈平亲自押运，扮作楚军俘虏，身上烙印要真，哭声要惨。’一名将领领命而去，将数十名身披破甲、面涂灰土的士兵推上马车，绳索勒进皮肉，仿佛真被俘获。火把摇曳中，车轮吱呀前行，直奔楚军东门——那里有座废弃的烽燧台，曾是项羽设伏的旧地。刘邦站在高坡，目光如炬：‘若他们能活着穿过三道哨卡，韩信便知我已动兵；若他们死在途中，那便是我的血祭。’风起时，远处传来战马嘶鸣，仿佛天地都在屏息等待这场赌局的终章。", "choices": [{"option": "命人假扮重伤囚徒，'
2025-09-27 00:26:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=919 预览='{"text": "夜色如铁，荥阳城外的风卷着枯叶掠过断墙。刘邦凝视着那支被蒙上黑布的粮车，车轮碾过泥泞，发出沉闷的呻吟。他低声道：‘让陈平亲自押运，扮作楚军俘虏，身上烙印要真，哭声要惨。’一名将领领命而去，将数十名身披破甲、面涂灰土的士兵推上马车，绳索勒进皮肉，仿佛真被俘获。火把摇曳中，车轮吱呀前行，直奔楚军东门——'
2025-09-27 00:26:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=919 预览='{"text": "夜色如铁，荥阳城外的风卷着枯叶掠过断墙。刘邦凝视着那支被蒙上黑布的粮车，车轮碾过泥泞，发出沉闷的呻吟。他低声道：‘让陈平亲自押运，扮作楚军俘虏，身上烙印要真，哭声要惨。’一名将领领命而去，将数十名身披破甲、面涂灰土的士兵推上马车，绳索勒进皮肉，仿佛真被俘获。火把摇曳中，车轮吱呀前行，直奔楚军东门——'
2025-09-27 00:26:00 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 254
2025-09-27 00:26:00 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:26:00 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 254
2025-09-27 00:26:00 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:26:00 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:26:00 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，荥阳城外的风卷...
2025-09-27 00:26:00 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:26:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，荥阳城外的风卷...
2025-09-27 00:26:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:26:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1842
2025-09-27 00:26:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=919 预览='{"text": "夜色如铁，荥阳城外的山道上，一队披着楚军破甲的俘虏被押送前行，粮车轱辘碾过碎石，发出沉闷的呻吟。刘邦亲自在暗处点起三盏红灯，信号既出，陈平已率假旗队潜入彭城东侧山道。此刻，那支伪装成楚军俘虏的队伍正缓缓逼近敌营寨门，领头者脸上涂着灰泥，双目低垂，仿佛真为困顿之卒。守卫持火把靠近，鼻尖嗅到粮车中散发的焦糊麦香——那是特意熏过的劣质谷物，只为掩人耳目。一名小校呵斥着要搜身，却见俘虏中有人突然跪地痛哭，高喊‘韩信将军已破邯郸，我等愿降’。声音沙哑，字字如刀，直刺守军心防。风卷残旗，火光摇曳间，一张密信悄然从粮袋夹层滑落，飘向篝火边的影子。", "choices": [{"opti'
2025-09-27 00:26:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=919 预览='{"text": "夜色如铁，荥阳城外的山道上，一队披着楚军破甲的俘虏被押送前行，粮车轱辘碾过碎石，发出沉闷的呻吟。刘邦亲自在暗处点起三盏红灯，信号既出，陈平已率假旗队潜入彭城东侧山道。此刻，那支伪装成楚军俘虏的队伍正缓缓逼近敌营寨门，领头者脸上涂着灰泥，双目低垂，仿佛真为困顿之卒。守卫持火把靠近，鼻尖嗅到粮车中散发的'
2025-09-27 00:26:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=919 预览='{"text": "夜色如铁，荥阳城外的山道上，一队披着楚军破甲的俘虏被押送前行，粮车轱辘碾过碎石，发出沉闷的呻吟。刘邦亲自在暗处点起三盏红灯，信号既出，陈平已率假旗队潜入彭城东侧山道。此刻，那支伪装成楚军俘虏的队伍正缓缓逼近敌营寨门，领头者脸上涂着灰泥，双目低垂，仿佛真为困顿之卒。守卫持火把靠近，鼻尖嗅到粮车中散发的'
2025-09-27 00:26:00 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 269
2025-09-27 00:26:00 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:26:00 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 269
2025-09-27 00:26:00 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:26:00 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:26:00 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，荥阳城外的山道...
2025-09-27 00:26:00 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:26:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，荥阳城外的山道...
2025-09-27 00:26:02 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_d83ac21379094d0fa6dec66a7aab2749.png (大小: 1158803 字节)
2025-09-27 00:26:02 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_d83ac21379094d0fa6dec66a7aab2749.png
2025-09-27 00:26:02 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_d83ac21379094d0fa6dec66a7aab2749.png
2025-09-27 00:26:02 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=105 choice='遣使与陈余旧部暗通款曲，以故人之名换取一条隐秘小径' text_length=196
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=105 choice='遣使与陈余旧部暗通款曲，以故人之名换取一条隐秘小径'
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=108 parent=105 choice='遣使与陈余旧部暗通款曲，以故人之名换取一条隐秘小径'
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=108 image_url=/static/generated/ai_gen_d83ac21379094d0fa6dec66a7aab2749.png
2025-09-27 00:26:02 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=108 depth=2
2025-09-27 00:26:02 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=108 completed, triggered next level depth=2
2025-09-27 00:26:02 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=108
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=108 choice='命夜行鸦假扮楚军斥候，混入敌营传递假情报'
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=108 choice='命夜行鸦假扮楚军斥候，混入敌营传递假情报'
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=108 choice='亲率精锐小队，趁暴雨夜强袭敌后粮仓'
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=108 choice='将密信绑在飞鸽脚上，放飞向韩信所在方向'
2025-09-27 00:26:02 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命夜行鸦假扮楚军斥候，混入敌营传递假情报
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=108 choice='亲率精锐小队，趁暴雨夜强袭敌后粮仓'
2025-09-27 00:26:02 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=108 choice='将密信绑在飞鸽脚上，放飞向韩信所在方向'
2025-09-27 00:26:02 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率精锐小队，趁暴雨夜强袭敌后粮仓
2025-09-27 00:26:02 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将密信绑在飞鸽脚上，放飞向韩信所在方向
2025-09-27 00:26:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:26:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1757
2025-09-27 00:26:04 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=837 预览='{"text": "夜色如墨，粮车在泥泞小道上缓缓前行，车轮碾过枯枝发出细微的碎裂声。刘邦命人将数十名俘虏绑于车后，衣衫褴褛、面带血污，口中含着破布，装作楚军败兵。车夫披着残破的楚军斗篷，手中长鞭挥动，低喝着生涩的楚语。远处敌营火光摇曳，守卒巡哨的脚步声渐近。突然，一队楚军骑兵从侧翼驰来，马蹄踏碎寂静。押运官猛然勒缰，颤抖着递上通关符——那是陈平暗中伪造的军令。火光映照下，他眼中闪过一丝决绝：若被识破，便是万箭穿心之局。", "choices": [{"option": "命俘虏高唱楚地民谣，借歌声扰乱守军警觉", "summary": "以文化迷惑敌人，制造混乱间隙", "effects":'
2025-09-27 00:26:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=837 预览='{"text": "夜色如墨，粮车在泥泞小道上缓缓前行，车轮碾过枯枝发出细微的碎裂声。刘邦命人将数十名俘虏绑于车后，衣衫褴褛、面带血污，口中含着破布，装作楚军败兵。车夫披着残破的楚军斗篷，手中长鞭挥动，低喝着生涩的楚语。远处敌营火光摇曳，守卒巡哨的脚步声渐近。突然，一队楚军骑兵从侧翼驰来，马蹄踏碎寂静。押运官猛然勒缰，'
2025-09-27 00:26:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=837 预览='{"text": "夜色如墨，粮车在泥泞小道上缓缓前行，车轮碾过枯枝发出细微的碎裂声。刘邦命人将数十名俘虏绑于车后，衣衫褴褛、面带血污，口中含着破布，装作楚军败兵。车夫披着残破的楚军斗篷，手中长鞭挥动，低喝着生涩的楚语。远处敌营火光摇曳，守卒巡哨的脚步声渐近。突然，一队楚军骑兵从侧翼驰来，马蹄踏碎寂静。押运官猛然勒缰，'
2025-09-27 00:26:04 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 202
2025-09-27 00:26:04 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:26:04 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 202
2025-09-27 00:26:04 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:26:04 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:26:04 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，粮车在泥泞小道...
2025-09-27 00:26:04 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:26:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，粮车在泥泞小道...
2025-09-27 00:26:06 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:26:06 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1817
2025-09-27 00:26:06 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=897 预览='{"text": "夜雾如纱，山道蜿蜒如蛇。刘邦命人将陈余旧部的信物——一枚刻有‘赵破’二字的青铜虎符，置于枯枝堆中，引火点燃。烟雾升腾间，远处林影微动，一名披褐衣的老卒悄然现身，跪地叩首：‘将军旧部，今奉令来迎。’他声音沙哑如裂帛：‘小径通幽，唯惧有诈。’刘邦轻抚腰间剑柄，目光扫过那条隐没在乱石间的羊肠小道，低声道：‘人心若死，便以故人之名唤醒；若活，则借其骨血铺路。’他转身对谋士道：‘传令三军，佯攻东门，诱敌分兵。我带亲卫走此暗道，明日子时，必见韩信烽火。’风卷残烬，星火如泪，洒落在即将开启的生死之门。", "choices": [{"option": "命亲卫扮作陈余旧部，以密语为证混入'
2025-09-27 00:26:06 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=897 预览='{"text": "夜雾如纱，山道蜿蜒如蛇。刘邦命人将陈余旧部的信物——一枚刻有‘赵破’二字的青铜虎符，置于枯枝堆中，引火点燃。烟雾升腾间，远处林影微动，一名披褐衣的老卒悄然现身，跪地叩首：‘将军旧部，今奉令来迎。’他声音沙哑如裂帛：‘小径通幽，唯惧有诈。’刘邦轻抚腰间剑柄，目光扫过那条隐没在乱石间的羊肠小道，低声道：'
2025-09-27 00:26:06 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=897 预览='{"text": "夜雾如纱，山道蜿蜒如蛇。刘邦命人将陈余旧部的信物——一枚刻有‘赵破’二字的青铜虎符，置于枯枝堆中，引火点燃。烟雾升腾间，远处林影微动，一名披褐衣的老卒悄然现身，跪地叩首：‘将军旧部，今奉令来迎。’他声音沙哑如裂帛：‘小径通幽，唯惧有诈。’刘邦轻抚腰间剑柄，目光扫过那条隐没在乱石间的羊肠小道，低声道：'
2025-09-27 00:26:06 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 246
2025-09-27 00:26:06 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 246
2025-09-27 00:26:06 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:26:06 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，山道蜿蜒如蛇。...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:26:06 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，山道蜿蜒如蛇。...
2025-09-27 00:26:06 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:26:06 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1805
2025-09-27 00:26:06 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=885 预览='{"text": "夜雾如纱，缠绕着荥阳城外的断壁残垣。刘邦凝视着手中那枚陈余旧部的信物——一枚刻有‘河间’二字的青铜虎符，指尖轻抚其上凹痕，仿佛触到故人未冷的骨血。他低语：‘陈余虽死，其部犹存，若以旧情为引，或可借其心火燃我粮道。’谋士沉声道：‘但此辈桀骜难驯，若知你欲借其名行险，恐反噬于前。’刘邦却只一笑，将虎符掷入火盆，焰光映出他眼中幽深的算计：‘非借其名，是借其魂。’他提笔写下密信，墨迹未干，便命亲信潜入赵地，携信与一盏孤灯，去寻那埋在尘土中的旧日盟约。", "choices": [{"option": "以陈余遗孀之名写信，唤起旧部忠义之心", "summary": "借悲情唤醒沉睡'
2025-09-27 00:26:06 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=885 预览='{"text": "夜雾如纱，缠绕着荥阳城外的断壁残垣。刘邦凝视着手中那枚陈余旧部的信物——一枚刻有‘河间’二字的青铜虎符，指尖轻抚其上凹痕，仿佛触到故人未冷的骨血。他低语：‘陈余虽死，其部犹存，若以旧情为引，或可借其心火燃我粮道。’谋士沉声道：‘但此辈桀骜难驯，若知你欲借其名行险，恐反噬于前。’刘邦却只一笑，将虎符掷'
2025-09-27 00:26:06 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=885 预览='{"text": "夜雾如纱，缠绕着荥阳城外的断壁残垣。刘邦凝视着手中那枚陈余旧部的信物——一枚刻有‘河间’二字的青铜虎符，指尖轻抚其上凹痕，仿佛触到故人未冷的骨血。他低语：‘陈余虽死，其部犹存，若以旧情为引，或可借其心火燃我粮道。’谋士沉声道：‘但此辈桀骜难驯，若知你欲借其名行险，恐反噬于前。’刘邦却只一笑，将虎符掷'
2025-09-27 00:26:06 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 223
2025-09-27 00:26:06 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 223
2025-09-27 00:26:06 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:26:06 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，缠绕着荥阳城外...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:26:06 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，缠绕着荥阳城外...
2025-09-27 00:26:06 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:26:06 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1793
2025-09-27 00:26:06 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=878 预览='{"text": "夜雾如纱，缠绕着陈余旧部驻守的隘口。刘邦命人将一封用楚地方言书写的密信绑在一只白鸽腿上，放飞于风中——那是他与故人之间唯一的暗语。片刻后，山坳深处传来三声短促的梆响，如幽魂低语。一队披着破旧甲胄的士卒悄然现身，为首者面有刀疤，目光如炬：‘韩信将军曾救我性命，今愿以命相报。’他指向一道隐于断崖间的羊肠小径，仅容一人侧身而过，尽头是通往赵地粮仓的秘道。刘邦凝视那条蜿蜒如蛇的路径，忽然轻笑：‘项羽以为天险可锁汉军，却不知人心才是最深的关隘。’他转身下令：‘备马，即刻启程。’", "choices": [{"option": "让细作乔装成陈余旧部，假借祭祖之名混入隘口守军", "'
2025-09-27 00:26:06 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=878 预览='{"text": "夜雾如纱，缠绕着陈余旧部驻守的隘口。刘邦命人将一封用楚地方言书写的密信绑在一只白鸽腿上，放飞于风中——那是他与故人之间唯一的暗语。片刻后，山坳深处传来三声短促的梆响，如幽魂低语。一队披着破旧甲胄的士卒悄然现身，为首者面有刀疤，目光如炬：‘韩信将军曾救我性命，今愿以命相报。’他指向一道隐于断崖间的羊肠'
2025-09-27 00:26:06 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=878 预览='{"text": "夜雾如纱，缠绕着陈余旧部驻守的隘口。刘邦命人将一封用楚地方言书写的密信绑在一只白鸽腿上，放飞于风中——那是他与故人之间唯一的暗语。片刻后，山坳深处传来三声短促的梆响，如幽魂低语。一队披着破旧甲胄的士卒悄然现身，为首者面有刀疤，目光如炬：‘韩信将军曾救我性命，今愿以命相报。’他指向一道隐于断崖间的羊肠'
2025-09-27 00:26:06 | INFO     | core.image_service:get_image_for_story:162 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 236
2025-09-27 00:26:06 | INFO     | core.image_service:get_image_for_story:169 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:63 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 236
2025-09-27 00:26:06 | DEBUG    | core.image_service:generate_image_realtime:67 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:26:06 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 提取图像提示词...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:74 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，缠绕着陈余旧部...
2025-09-27 00:26:06 | INFO     | core.image_service:generate_image_realtime:77 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:26:06 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜雾如纱，缠绕着陈余旧部...
2025-09-27 00:26:07 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 731
2025-09-27 00:26:07 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 86
2025-09-27 00:26:07 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:07 | WARNING  | core.image_service:_extract_image_url:133 - 无法从AI响应中提取图像URL: 

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-27 00:26:07 | WARNING  | core.image_service:generate_image_realtime:100 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL，降级到随机图库
2025-09-27 00:26:07 | INFO     | core.image_service:get_random_image_from_library:44 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 00:26:07 | INFO     | core.image_service:get_random_image_from_library:54 - [ImageLibrary] ✅ 随机选择图片: fantasy_castle.jpg
2025-09-27 00:26:07 | INFO     | core.image_service:get_random_image_from_library:55 - [ImageLibrary] 🎯 返回图片URL: /static/fantasy_castle.jpg
2025-09-27 00:26:07 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/fantasy_castle.jpg
2025-09-27 00:26:07 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:07 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=106 choice='命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力' text_length=222
2025-09-27 00:26:07 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=106 choice='命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力'
2025-09-27 00:26:07 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=109 parent=106 choice='命人连夜伪造诏书，以刘邦名义召韩信火速回援，借机调离敌军主力'
2025-09-27 00:26:07 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=109 image_url=/static/fantasy_castle.jpg
2025-09-27 00:26:07 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=109 depth=1
2025-09-27 00:26:07 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=109 completed, triggered next level depth=1
2025-09-27 00:26:07 | INFO     | core.speculation:_run_pipeline:100 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=8 node=109
2025-09-27 00:26:11 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:11 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:11 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:11 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903970864_473.png
2025-09-27 00:26:11 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903970864_473.png
2025-09-27 00:26:11 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:11 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903970864_473.png
2025-09-27 00:26:11 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:11 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:11 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:11 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903971105_460.png
2025-09-27 00:26:11 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903971105_460.png
2025-09-27 00:26:11 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:11 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903971105_460.png
2025-09-27 00:26:14 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:14 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:14 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:14 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903973490_383.png
2025-09-27 00:26:14 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903973490_383.png
2025-09-27 00:26:14 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:14 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903973490_383.png
2025-09-27 00:26:15 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_563098136e5be64755b40e845e307e9d.png (大小: 1435196 字节)
2025-09-27 00:26:15 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_563098136e5be64755b40e845e307e9d.png
2025-09-27 00:26:15 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_563098136e5be64755b40e845e307e9d.png
2025-09-27 00:26:15 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=106 choice='将虎符交予一名老卒，命其乔装成驿使，沿古道向南传递密信，引诱项羽误判方向' text_length=247
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=106 choice='将虎符交予一名老卒，命其乔装成驿使，沿古道向南传递密信，引诱项羽误判方向'
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=110 parent=106 choice='将虎符交予一名老卒，命其乔装成驿使，沿古道向南传递密信，引诱项羽误判方向'
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=110 image_url=/static/generated/ai_gen_563098136e5be64755b40e845e307e9d.png
2025-09-27 00:26:15 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=110 depth=1
2025-09-27 00:26:15 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=110 completed, triggered next level depth=1
2025-09-27 00:26:15 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_e83f08a5231a8210e1a7773477de49f0.png (大小: 1625144 字节)
2025-09-27 00:26:15 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_e83f08a5231a8210e1a7773477de49f0.png
2025-09-27 00:26:15 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_e83f08a5231a8210e1a7773477de49f0.png
2025-09-27 00:26:15 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=107 choice='命人点燃山头烽火，伪造楚军主力集结的假象' text_length=254
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=107 choice='命人点燃山头烽火，伪造楚军主力集结的假象'
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=111 parent=107 choice='命人点燃山头烽火，伪造楚军主力集结的假象'
2025-09-27 00:26:15 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=111 image_url=/static/generated/ai_gen_e83f08a5231a8210e1a7773477de49f0.png
2025-09-27 00:26:15 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=111 depth=1
2025-09-27 00:26:15 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=111 completed, triggered next level depth=1
2025-09-27 00:26:16 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:16 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:16 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:16 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903975873_852.png
2025-09-27 00:26:16 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903975873_852.png
2025-09-27 00:26:16 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:16 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903975873_852.png
2025-09-27 00:26:17 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:17 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:17 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:17 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903976930_886.png
2025-09-27 00:26:17 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903976930_886.png
2025-09-27 00:26:17 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:17 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903976930_886.png
2025-09-27 00:26:17 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:17 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:17 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:17 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903977220_035.png
2025-09-27 00:26:17 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903977220_035.png
2025-09-27 00:26:17 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:17 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903977220_035.png
2025-09-27 00:26:18 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_2ee5b4aa17dca2629c3be86658cff5e4.png (大小: 1379051 字节)
2025-09-27 00:26:18 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_2ee5b4aa17dca2629c3be86658cff5e4.png
2025-09-27 00:26:18 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_2ee5b4aa17dca2629c3be86658cff5e4.png
2025-09-27 00:26:18 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:18 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=106 choice='亲率亲卫潜入城内密窖，亲自点验粮草并下令开仓赈济流民，收拢人心' text_length=234
2025-09-27 00:26:18 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=106 choice='亲率亲卫潜入城内密窖，亲自点验粮草并下令开仓赈济流民，收拢人心'
2025-09-27 00:26:18 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=112 parent=106 choice='亲率亲卫潜入城内密窖，亲自点验粮草并下令开仓赈济流民，收拢人心'
2025-09-27 00:26:18 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=112 image_url=/static/generated/ai_gen_2ee5b4aa17dca2629c3be86658cff5e4.png
2025-09-27 00:26:18 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=112 depth=1
2025-09-27 00:26:18 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=112 completed, triggered next level depth=1
2025-09-27 00:26:19 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_ea037c41e880c5ac046312bc005aee08.png (大小: 1067071 字节)
2025-09-27 00:26:19 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_ea037c41e880c5ac046312bc005aee08.png
2025-09-27 00:26:19 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_ea037c41e880c5ac046312bc005aee08.png
2025-09-27 00:26:19 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:19 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=107 choice='遣使暗通彭城内应，用一封伪造的项羽密令诱敌自乱' text_length=202
2025-09-27 00:26:19 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=107 choice='遣使暗通彭城内应，用一封伪造的项羽密令诱敌自乱'
2025-09-27 00:26:19 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:19 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:19 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:19 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903978837_035.png
2025-09-27 00:26:19 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903978837_035.png
2025-09-27 00:26:19 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:19 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903978837_035.png
2025-09-27 00:26:19 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=113 parent=107 choice='遣使暗通彭城内应，用一封伪造的项羽密令诱敌自乱'
2025-09-27 00:26:19 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=113 image_url=/static/generated/ai_gen_ea037c41e880c5ac046312bc005aee08.png
2025-09-27 00:26:19 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=113 depth=1
2025-09-27 00:26:19 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=113 completed, triggered next level depth=1
2025-09-27 00:26:20 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_66b1d53e1b82742f7d759aa4dcde6ff0.png (大小: 986022 字节)
2025-09-27 00:26:20 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_66b1d53e1b82742f7d759aa4dcde6ff0.png
2025-09-27 00:26:20 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_66b1d53e1b82742f7d759aa4dcde6ff0.png
2025-09-27 00:26:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=108 choice='将密信绑在飞鸽脚上，放飞向韩信所在方向' text_length=236
2025-09-27 00:26:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=108 choice='将密信绑在飞鸽脚上，放飞向韩信所在方向'
2025-09-27 00:26:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=114 parent=108 choice='将密信绑在飞鸽脚上，放飞向韩信所在方向'
2025-09-27 00:26:20 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=114 image_url=/static/generated/ai_gen_66b1d53e1b82742f7d759aa4dcde6ff0.png
2025-09-27 00:26:20 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=114 depth=1
2025-09-27 00:26:20 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=114 completed, triggered next level depth=1
2025-09-27 00:26:21 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_e4ed46c3d7d12c35308623e735a62309.png (大小: 1554530 字节)
2025-09-27 00:26:21 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_e4ed46c3d7d12c35308623e735a62309.png
2025-09-27 00:26:21 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_e4ed46c3d7d12c35308623e735a62309.png
2025-09-27 00:26:21 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=107 choice='亲率五名精锐潜入矿道，亲自勘验地形并设伏' text_length=269
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=107 choice='亲率五名精锐潜入矿道，亲自勘验地形并设伏'
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=115 parent=107 choice='亲率五名精锐潜入矿道，亲自勘验地形并设伏'
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=115 image_url=/static/generated/ai_gen_e4ed46c3d7d12c35308623e735a62309.png
2025-09-27 00:26:21 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=115 depth=1
2025-09-27 00:26:21 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=115 completed, triggered next level depth=1
2025-09-27 00:26:21 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_fe9c92fdeb9ce7d9bd3f8d8bb860ed1d.png (大小: 1594095 字节)
2025-09-27 00:26:21 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_fe9c92fdeb9ce7d9bd3f8d8bb860ed1d.png
2025-09-27 00:26:21 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_fe9c92fdeb9ce7d9bd3f8d8bb860ed1d.png
2025-09-27 00:26:21 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=108 choice='亲率精锐小队，趁暴雨夜强袭敌后粮仓' text_length=246
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=108 choice='亲率精锐小队，趁暴雨夜强袭敌后粮仓'
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=116 parent=108 choice='亲率精锐小队，趁暴雨夜强袭敌后粮仓'
2025-09-27 00:26:21 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=116 image_url=/static/generated/ai_gen_fe9c92fdeb9ce7d9bd3f8d8bb860ed1d.png
2025-09-27 00:26:21 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=116 depth=1
2025-09-27 00:26:21 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=116 completed, triggered next level depth=1
2025-09-27 00:26:23 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:26:23 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:26:23 | DEBUG    | core.image_service:generate_image_realtime:82 - [AIImageGen] 提取图像URL...
2025-09-27 00:26:23 | DEBUG    | core.image_service:_extract_image_url:130 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758903982973_051.png
2025-09-27 00:26:23 | INFO     | core.image_service:generate_image_realtime:86 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758903982973_051.png
2025-09-27 00:26:23 | INFO     | core.image_service:generate_image_realtime:89 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:26:23 | INFO     | core.image_storage:save_ai_image:47 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758903982973_051.png
2025-09-27 00:26:29 | INFO     | core.image_storage:save_ai_image:82 - ✅ 图像下载成功: ai_gen_c55bbfba88394a201fb352fb2758508c.png (大小: 1365569 字节)
2025-09-27 00:26:29 | INFO     | core.image_service:generate_image_realtime:93 - [AIImageGen] ✅ 图像已完全保存并验证可访问: /static/generated/ai_gen_c55bbfba88394a201fb352fb2758508c.png
2025-09-27 00:26:29 | INFO     | core.image_service:get_image_for_story:176 - [ImageService] ✅ AI生成成功: /static/generated/ai_gen_c55bbfba88394a201fb352fb2758508c.png
2025-09-27 00:26:29 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:26:29 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=108 choice='命夜行鸦假扮楚军斥候，混入敌营传递假情报' text_length=223
2025-09-27 00:26:29 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=108 choice='命夜行鸦假扮楚军斥候，混入敌营传递假情报'
2025-09-27 00:26:29 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=117 parent=108 choice='命夜行鸦假扮楚军斥候，混入敌营传递假情报'
2025-09-27 00:26:29 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=117 image_url=/static/generated/ai_gen_c55bbfba88394a201fb352fb2758508c.png
2025-09-27 00:26:29 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=8 node=117 depth=1
2025-09-27 00:26:29 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=117 completed, triggered next level depth=1
2025-09-27 00:26:38 | INFO     | backend.main:shutdown_event:122 - 重生之我是……API服务关闭
2025-09-27 00:36:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:36:20 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:36:21 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:36:21 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:36:21 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:36:21 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:36:21 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:36:21 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:36:21 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:36:21 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:36:21 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:36:21 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 00:36:21 | INFO     | backend.main:<module>:60 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 00:36:21 | INFO     | backend.main:_run_alembic_cmd:97 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:36:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:36:22 | INFO     | backend.main:_run_alembic_cmd:99 - Alembic migration complete.
2025-09-27 00:36:22 | INFO     | backend.main:startup_event:110 - 重生之我是……API服务启动
2025-09-27 00:36:22 | INFO     | backend.main:startup_event:111 - 调试模式: True
2025-09-27 00:36:22 | INFO     | backend.main:startup_event:116 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:36:22 | INFO     | backend.main:startup_event:117 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:36:39 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：刘备...
2025-09-27 00:36:39 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 00:36:39 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 9
2025-09-27 00:36:39 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 473
2025-09-27 00:36:41 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:36:41 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 887
2025-09-27 00:36:41 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 216
2025-09-27 00:36:41 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 00:36:41 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 重生为刘备：桃园初起, background: 公元184年，黄巾之乱席卷天下，汉室衰微。你以刘备之身重生于幽州涿郡，与关羽、张飞结义于桃园。三人志..., quest: 在三个月内集结三十六名忠义之士，建立首个据点...
2025-09-27 00:36:41 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:36:41 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:36:41 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:36:41 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-27 00:36:44 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:36:44 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1369
2025-09-27 00:36:44 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=864 预览='{"text": "夜色如墨，荆州城门在风中低语。你立于暗巷深处，手中紧握一封密信——那是诸葛亮托人辗转送来的急报：曹操已派细作潜入城中，意图策反守将。远处传来更夫的梆子声，三更已过。火把摇曳，巡逻的兵卒脚步渐近。你袖中藏着半块玉佩，是当年桃园结义时所赠，如今它正微微发烫，仿佛在提醒你：历史的齿轮正在转动。你必须在不惊动守军的前提下，将密信送达城南军营的徐庶手中。但若稍有差池，不仅功败垂成，连这微弱的希望也将化为灰烬。", "choices": [{"option": "将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行", "summary": "以信物触发隐秘通道，冒险却可能打开新局", "ef'
2025-09-27 00:36:44 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=864 预览='{"text": "夜色如墨，荆州城门在风中低语。你立于暗巷深处，手中紧握一封密信——那是诸葛亮托人辗转送来的急报：曹操已派细作潜入城中，意图策反守将。远处传来更夫的梆子声，三更已过。火把摇曳，巡逻的兵卒脚步渐近。你袖中藏着半块玉佩，是当年桃园结义时所赠，如今它正微微发烫，仿佛在提醒你：历史的齿轮正在转动。你必须在不惊'
2025-09-27 00:36:44 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=864 预览='{"text": "夜色如墨，荆州城门在风中低语。你立于暗巷深处，手中紧握一封密信——那是诸葛亮托人辗转送来的急报：曹操已派细作潜入城中，意图策反守将。远处传来更夫的梆子声，三更已过。火把摇曳，巡逻的兵卒脚步渐近。你袖中藏着半块玉佩，是当年桃园结义时所赠，如今它正微微发烫，仿佛在提醒你：历史的齿轮正在转动。你必须在不惊'
2025-09-27 00:36:44 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 201
2025-09-27 00:36:44 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:36:44 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 201
2025-09-27 00:36:44 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:36:44 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 00:36:44 | INFO     | core.image_storage:__init__:29 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:36:44 | INFO     | core.image_storage:__init__:30 - 图像web访问前缀: http://127.0.0.1:8000/static/generated
2025-09-27 00:36:44 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:36:44 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，荆州城门在风中...
2025-09-27 00:36:44 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:36:44 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，荆州城门在风中...
2025-09-27 00:36:56 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:36:56 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:36:56 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:36:56 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904616382_499.png
2025-09-27 00:36:56 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904616382_499.png
2025-09-27 00:36:56 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:36:56 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904616382_499.png
2025-09-27 00:37:00 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png (大小: 1236353 字节)
2025-09-27 00:37:00 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:00 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:00 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:00 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:00 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 00:37:00 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=201
2025-09-27 00:37:00 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=9
2025-09-27 00:37:00 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=118
2025-09-27 00:37:00 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=118 image_url=http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:00 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=9 node=118 depth=3
2025-09-27 00:37:00 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=9, node=118
2025-09-27 00:37:00 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=9
2025-09-27 00:37:00 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:37:00 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=118
2025-09-27 00:37:00 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=118 choice='将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行'
2025-09-27 00:37:00 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=118 choice='扮作巡夜老卒，用方言与守卫搭话，借机混入军营'
2025-09-27 00:37:00 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=118 choice='将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行'
2025-09-27 00:37:00 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=118 choice='点燃一支火折子，向城楼投掷信号，引燃烽火台示警'
2025-09-27 00:37:00 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=118 choice='扮作巡夜老卒，用方言与守卫搭话，借机混入军营'
2025-09-27 00:37:00 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行
2025-09-27 00:37:00 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=118 choice='点燃一支火折子，向城楼投掷信号，引燃烽火台示警'
2025-09-27 00:37:00 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 扮作巡夜老卒，用方言与守卫搭话，借机混入军营
2025-09-27 00:37:00 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃一支火折子，向城楼投掷信号，引燃烽火台示警
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 刘备...
2025-09-27 00:37:03 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 00:37:03 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:442956286317391387
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=9, node=118
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=9, node_id=118
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=9, node_id=118
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 201, 选择数: 3, 图片: http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:475 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:484 - [Start] 📁 [图片文件检查] 文件存在: True, 大小: 1236353字节, 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:492 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=9, node=118
2025-09-27 00:37:03 | INFO     | api.story:start_new_story:494 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/generated/ai_gen_4668ea37fdf60de336bdd8f93c6f3eb9.png
2025-09-27 00:37:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:37:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1529
2025-09-27 00:37:04 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=846 预览='{"text": "夜风卷起残叶，城楼上的火把在风中摇曳如鬼影。你贴着墙根前行，玉佩的热度骤然加剧，仿佛在回应某种古老的召唤。远处传来铁甲碰撞的轻响，巡逻队正从西门折返。你猛然瞥见一名守卫倚在墙角打盹，腰间钥匙串微微晃动。若此时动手，只需一瞬便可夺钥；但若惊动他人，整条暗巷将陷入警戒。更令人不安的是，那玉佩的温热竟开始渗入掌心，似有低语——是结义兄弟的魂灵在提醒你什么？还是命运早已埋下伏笔？你必须在三息之内做出抉择。", "choices": [{"option": "猛然抽剑抵住守卫咽喉，以绝杀之势逼其交出钥匙", "summary": "以雷霆手段斩断犹豫，直取核心目标", "effect'
2025-09-27 00:37:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=846 预览='{"text": "夜风卷起残叶，城楼上的火把在风中摇曳如鬼影。你贴着墙根前行，玉佩的热度骤然加剧，仿佛在回应某种古老的召唤。远处传来铁甲碰撞的轻响，巡逻队正从西门折返。你猛然瞥见一名守卫倚在墙角打盹，腰间钥匙串微微晃动。若此时动手，只需一瞬便可夺钥；但若惊动他人，整条暗巷将陷入警戒。更令人不安的是，那玉佩的温热竟开始'
2025-09-27 00:37:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=846 预览='{"text": "夜风卷起残叶，城楼上的火把在风中摇曳如鬼影。你贴着墙根前行，玉佩的热度骤然加剧，仿佛在回应某种古老的召唤。远处传来铁甲碰撞的轻响，巡逻队正从西门折返。你猛然瞥见一名守卫倚在墙角打盹，腰间钥匙串微微晃动。若此时动手，只需一瞬便可夺钥；但若惊动他人，整条暗巷将陷入警戒。更令人不安的是，那玉佩的温热竟开始'
2025-09-27 00:37:04 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 200
2025-09-27 00:37:04 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:37:04 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 200
2025-09-27 00:37:04 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:37:04 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:37:04 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残叶，城楼上的火...
2025-09-27 00:37:04 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:37:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残叶，城楼上的火...
2025-09-27 00:37:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:37:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1521
2025-09-27 00:37:05 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=829 预览='{"text": "风卷残云，城楼上的铜铃轻响如泣。你贴着墙根前行，玉佩的温热在袖中愈发灼人，仿佛在催促你做出抉择。前方三步之遥，守卫正倚在门柱上打盹，火把映出他粗重的呼吸。一队巡兵从巷口转来，脚步声渐近。你低头藏身于阴影，指尖触到一枚锈迹斑斑的铜钱——那是昨夜从一名醉汉手中得来，传说能换半盏茶的命。若用它引开巡逻队，或许可借乱入营；若贸然现身，玉佩的异动恐怕会暴露身份。夜色深沉，时间如刀，每一息都可能改写结局。", "choices": [{"option": "将铜钱掷向远处石堆，引开巡逻队的注意", "summary": "以小物扰敌，制造混乱的瞬间突破口", "effects": {"'
2025-09-27 00:37:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=829 预览='{"text": "风卷残云，城楼上的铜铃轻响如泣。你贴着墙根前行，玉佩的温热在袖中愈发灼人，仿佛在催促你做出抉择。前方三步之遥，守卫正倚在门柱上打盹，火把映出他粗重的呼吸。一队巡兵从巷口转来，脚步声渐近。你低头藏身于阴影，指尖触到一枚锈迹斑斑的铜钱——那是昨夜从一名醉汉手中得来，传说能换半盏茶的命。若用它引开巡逻队，'
2025-09-27 00:37:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=829 预览='{"text": "风卷残云，城楼上的铜铃轻响如泣。你贴着墙根前行，玉佩的温热在袖中愈发灼人，仿佛在催促你做出抉择。前方三步之遥，守卫正倚在门柱上打盹，火把映出他粗重的呼吸。一队巡兵从巷口转来，脚步声渐近。你低头藏身于阴影，指尖触到一枚锈迹斑斑的铜钱——那是昨夜从一名醉汉手中得来，传说能换半盏茶的命。若用它引开巡逻队，'
2025-09-27 00:37:05 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 198
2025-09-27 00:37:05 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:37:05 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 198
2025-09-27 00:37:05 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:37:05 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:37:05 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残云，城楼上的铜铃轻...
2025-09-27 00:37:05 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:37:05 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残云，城楼上的铜铃轻...
2025-09-27 00:37:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:37:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1577
2025-09-27 00:37:05 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=884 预览='{"text": "夜风卷起残破的战旗，城墙上斑驳的箭孔如凝固的泪痕。你紧握玉佩，指尖传来灼热——那不是金属的温度，而是某种古老誓约的回响。远处巡逻队的脚步声渐近，火把映出他们铠甲上裂开的缝隙，仿佛这整座城都已不堪重负。你忽然听见墙角传来细微的窸窣声，一只灰鼠拖着半片碎帛窜过石缝，帛上墨迹未干：‘徐庶已至南门，速来接应’。原来密信早已被拆封，而敌营的耳目正悄然织网。你必须在不惊动巡逻队的前提下，借着更夫的梆子声掩护，将真信送入军营。可若稍有不慎，连这最后的线索都将被焚为灰烬。", "choices": [{"option": "将密信塞进更夫的竹筒，假扮成报时的巡夜人混入军营", "summa'
2025-09-27 00:37:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=884 预览='{"text": "夜风卷起残破的战旗，城墙上斑驳的箭孔如凝固的泪痕。你紧握玉佩，指尖传来灼热——那不是金属的温度，而是某种古老誓约的回响。远处巡逻队的脚步声渐近，火把映出他们铠甲上裂开的缝隙，仿佛这整座城都已不堪重负。你忽然听见墙角传来细微的窸窣声，一只灰鼠拖着半片碎帛窜过石缝，帛上墨迹未干：‘徐庶已至南门，速来接应'
2025-09-27 00:37:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=884 预览='{"text": "夜风卷起残破的战旗，城墙上斑驳的箭孔如凝固的泪痕。你紧握玉佩，指尖传来灼热——那不是金属的温度，而是某种古老誓约的回响。远处巡逻队的脚步声渐近，火把映出他们铠甲上裂开的缝隙，仿佛这整座城都已不堪重负。你忽然听见墙角传来细微的窸窣声，一只灰鼠拖着半片碎帛窜过石缝，帛上墨迹未干：‘徐庶已至南门，速来接应'
2025-09-27 00:37:05 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 230
2025-09-27 00:37:05 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:37:05 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 230
2025-09-27 00:37:05 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:37:05 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:37:05 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残破的战旗，城墙...
2025-09-27 00:37:05 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:37:05 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残破的战旗，城墙...
2025-09-27 00:37:13 | INFO     | backend.main:shutdown_event:123 - 重生之我是……API服务关闭
2025-09-27 00:37:15 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 820
2025-09-27 00:37:15 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 184
2025-09-27 00:37:15 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:37:15 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904634543_680.png
2025-09-27 00:37:15 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904634543_680.png
2025-09-27 00:37:15 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:37:15 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904634543_680.png
2025-09-27 00:37:18 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:37:18 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:37:18 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:37:18 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904637780_309.png
2025-09-27 00:37:18 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904637780_309.png
2025-09-27 00:37:18 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:37:18 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904637780_309.png
2025-09-27 00:37:20 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:37:20 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:37:20 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:37:20 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904639692_537.png
2025-09-27 00:37:20 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904639692_537.png
2025-09-27 00:37:20 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:37:20 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904639692_537.png
2025-09-27 00:37:20 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d3a3742821230454192ba42c54432f84.png (大小: 1275098 字节)
2025-09-27 00:37:20 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d3a3742821230454192ba42c54432f84.png
2025-09-27 00:37:20 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d3a3742821230454192ba42c54432f84.png
2025-09-27 00:37:20 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d3a3742821230454192ba42c54432f84.png
2025-09-27 00:37:20 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d3a3742821230454192ba42c54432f84.png
2025-09-27 00:37:20 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:37:20 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=118 choice='点燃一支火折子，向城楼投掷信号，引燃烽火台示警' text_length=198
2025-09-27 00:37:20 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=118 choice='点燃一支火折子，向城楼投掷信号，引燃烽火台示警'
2025-09-27 00:37:20 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=119 parent=118 choice='点燃一支火折子，向城楼投掷信号，引燃烽火台示警'
2025-09-27 00:37:20 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=119 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d3a3742821230454192ba42c54432f84.png
2025-09-27 00:37:20 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=9 node=119 depth=2
2025-09-27 00:37:20 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '点燃一支火折子，向城楼投掷信号，引燃烽火台示警': cannot schedule new futures after interpreter shutdown
2025-09-27 00:37:22 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_9f2d131370f6b85a85abc7e296efecbe.png (大小: 1330631 字节)
2025-09-27 00:37:22 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_9f2d131370f6b85a85abc7e296efecbe.png
2025-09-27 00:37:22 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_9f2d131370f6b85a85abc7e296efecbe.png
2025-09-27 00:37:22 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_9f2d131370f6b85a85abc7e296efecbe.png
2025-09-27 00:37:22 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_9f2d131370f6b85a85abc7e296efecbe.png
2025-09-27 00:37:22 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:37:22 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=118 choice='将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行' text_length=200
2025-09-27 00:37:22 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=118 choice='将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行'
2025-09-27 00:37:22 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=120 parent=118 choice='将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行'
2025-09-27 00:37:22 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=120 image_url=http://127.0.0.1:8000/static/generated/ai_gen_9f2d131370f6b85a85abc7e296efecbe.png
2025-09-27 00:37:22 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=9 node=120 depth=2
2025-09-27 00:37:22 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行': cannot schedule new futures after interpreter shutdown
2025-09-27 00:37:24 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_014e76b4c4e03f349b840d5940708df0.png (大小: 1544979 字节)
2025-09-27 00:37:24 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_014e76b4c4e03f349b840d5940708df0.png
2025-09-27 00:37:24 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_014e76b4c4e03f349b840d5940708df0.png
2025-09-27 00:37:24 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_014e76b4c4e03f349b840d5940708df0.png
2025-09-27 00:37:24 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_014e76b4c4e03f349b840d5940708df0.png
2025-09-27 00:37:24 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:37:24 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=118 choice='扮作巡夜老卒，用方言与守卫搭话，借机混入军营' text_length=230
2025-09-27 00:37:24 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=118 choice='扮作巡夜老卒，用方言与守卫搭话，借机混入军营'
2025-09-27 00:37:24 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=121 parent=118 choice='扮作巡夜老卒，用方言与守卫搭话，借机混入军营'
2025-09-27 00:37:24 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=121 image_url=http://127.0.0.1:8000/static/generated/ai_gen_014e76b4c4e03f349b840d5940708df0.png
2025-09-27 00:37:24 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=9 node=121 depth=2
2025-09-27 00:37:24 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '扮作巡夜老卒，用方言与守卫搭话，借机混入军营': cannot schedule new futures after interpreter shutdown
2025-09-27 00:39:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:41:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:41:03 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:41:04 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:41:04 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:41:04 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:41:04 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:41:04 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:41:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:41:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:41:04 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:41:04 | INFO     | backend.main:<module>:51 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:41:04 | INFO     | backend.main:<module>:59 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 00:41:04 | INFO     | backend.main:<module>:60 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 00:41:04 | INFO     | backend.main:_run_alembic_cmd:97 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:41:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:41:05 | INFO     | backend.main:_run_alembic_cmd:99 - Alembic migration complete.
2025-09-27 00:41:05 | INFO     | backend.main:startup_event:110 - 重生之我是……API服务启动
2025-09-27 00:41:05 | INFO     | backend.main:startup_event:111 - 调试模式: True
2025-09-27 00:41:05 | INFO     | backend.main:startup_event:116 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:41:05 | INFO     | backend.main:startup_event:117 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:41:16 | INFO     | api.story:continue_existing_story:514 - 收到故事继续请求，选择: 将玉佩嵌入墙缝，引出埋伏的暗哨，借其引路潜行
2025-09-27 00:41:16 | INFO     | api.story:continue_existing_story:558 - [NodeReady] 检查节点完整性：node_id=120
2025-09-27 00:41:16 | INFO     | api.story:_wait_for_node_complete:126 - [NodeComplete] 开始等待节点完全准备：node_id=120
2025-09-27 00:41:16 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] ✅ 节点完全准备就绪：node_id=120 (等待了 0.0 秒)
2025-09-27 00:41:16 | INFO     | api.story:continue_existing_story:561 - [NodeReady] ✅ 节点完全准备就绪：node_id=120
2025-09-27 00:41:27 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：张飞...
2025-09-27 00:41:27 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 00:41:27 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 9
2025-09-27 00:41:27 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 473
2025-09-27 00:41:29 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:41:29 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 886
2025-09-27 00:41:29 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 195
2025-09-27 00:41:29 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 00:41:29 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 怒吼重铸历史, background: 东汉末年，群雄并起。张飞立于长坂坡前，铁甲染血，战马嘶鸣。昔日忠义之士，今为乱世孤勇。他忆起刘备被围..., quest: 在长坂坡之战中改变历史走向...
2025-09-27 00:41:29 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:41:29 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:41:29 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:41:29 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '张飞'
2025-09-27 00:41:32 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:41:32 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1393
2025-09-27 00:41:32 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=858 预览='{"text": "夜色如墨，江风卷起残旗猎猎作响。张飞立于江畔古渡口，铁甲染霜，双目如炬，凝视着对岸那座灯火通明的军营——那是曹军屯粮重地，也是他此行必须踏破的命门。远处传来更鼓声，三更将尽，守卫换班在即。他猛然攥紧蛇矛，喉间低吼如雷，却忽而止住，目光扫过岸边一具被遗弃的破船残骸。若能借这浮木暗渡，或可绕开正面死守的箭楼。可一旦惊动巡江水卒，便是万箭穿心之局。", "choices": [{"option": "扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头", "summary": "以伪装为刃，直取敌方水上枢纽", "effects": {"delta_progress": 1'
2025-09-27 00:41:32 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=858 预览='{"text": "夜色如墨，江风卷起残旗猎猎作响。张飞立于江畔古渡口，铁甲染霜，双目如炬，凝视着对岸那座灯火通明的军营——那是曹军屯粮重地，也是他此行必须踏破的命门。远处传来更鼓声，三更将尽，守卫换班在即。他猛然攥紧蛇矛，喉间低吼如雷，却忽而止住，目光扫过岸边一具被遗弃的破船残骸。若能借这浮木暗渡，或可绕开正面死守的'
2025-09-27 00:41:32 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=858 预览='{"text": "夜色如墨，江风卷起残旗猎猎作响。张飞立于江畔古渡口，铁甲染霜，双目如炬，凝视着对岸那座灯火通明的军营——那是曹军屯粮重地，也是他此行必须踏破的命门。远处传来更鼓声，三更将尽，守卫换班在即。他猛然攥紧蛇矛，喉间低吼如雷，却忽而止住，目光扫过岸边一具被遗弃的破船残骸。若能借这浮木暗渡，或可绕开正面死守的'
2025-09-27 00:41:32 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 172
2025-09-27 00:41:32 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:41:32 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 172
2025-09-27 00:41:32 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:41:32 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 00:41:32 | INFO     | core.image_storage:__init__:29 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:41:32 | INFO     | core.image_storage:__init__:30 - 图像web访问前缀: http://127.0.0.1:8000/static/generated
2025-09-27 00:41:32 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:41:32 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，江风卷起残旗猎...
2025-09-27 00:41:32 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:41:32 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，江风卷起残旗猎...
2025-09-27 00:41:41 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:41:41 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:41:41 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:41:41 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904901289_357.png
2025-09-27 00:41:41 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904901289_357.png
2025-09-27 00:41:41 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:41:41 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904901289_357.png
2025-09-27 00:41:45 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_6ffda289290fa9e8832b2106c878838d.png (大小: 923303 字节)
2025-09-27 00:41:45 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:45 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:45 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:45 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:45 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 00:41:45 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=172
2025-09-27 00:41:45 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=10
2025-09-27 00:41:45 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=122
2025-09-27 00:41:45 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=122 image_url=http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:45 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=10 node=122 depth=3
2025-09-27 00:41:45 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=10, node=122
2025-09-27 00:41:45 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=10
2025-09-27 00:41:45 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:41:45 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=122
2025-09-27 00:41:45 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=122 choice='扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头'
2025-09-27 00:41:45 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=122 choice='跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭'
2025-09-27 00:41:45 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=122 choice='扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头'
2025-09-27 00:41:45 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=122 choice='点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀'
2025-09-27 00:41:45 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=122 choice='跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭'
2025-09-27 00:41:45 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头
2025-09-27 00:41:45 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=122 choice='点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀'
2025-09-27 00:41:45 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭
2025-09-27 00:41:45 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 张飞...
2025-09-27 00:41:49 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 00:41:49 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:-7811710145445610836
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=10, node=122
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=10, node_id=122
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=10, node_id=122
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 172, 选择数: 3, 图片: http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:475 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:484 - [Start] 📁 [图片文件检查] 文件存在: True, 大小: 923303字节, 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:492 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=10, node=122
2025-09-27 00:41:49 | INFO     | api.story:start_new_story:494 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:41:49 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:41:49 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1540
2025-09-27 00:41:49 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=846 预览='{"text": "江面浮冰碎裂，发出细响。张飞俯身将蛇矛插入破船木缝，借力一荡，竟将整艘残骸拖入暗流。他翻身跃上，双足踏在朽木之上如履平地，任江水拍打铁甲，发出沉闷轰鸣。远处哨塔传来犬吠，火把晃动，他猛然屏息，将头埋进湿漉漉的船板缝隙中，只余一双鹰眼穿透雾气，死死盯住对岸箭楼上的巡兵轮换路线。风起时，一缕血腥味混着焦油气息从上游飘来——那是曹军火油库的方向，或许正是破局之机。", "choices": [{"option": "点燃破船残骸，制造浓烟吸引敌军注意，趁乱潜行", "summary": "以烈焰为盾，引开视线的冒险之举", "effects": {"delta_progress"'
2025-09-27 00:41:49 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=846 预览='{"text": "江面浮冰碎裂，发出细响。张飞俯身将蛇矛插入破船木缝，借力一荡，竟将整艘残骸拖入暗流。他翻身跃上，双足踏在朽木之上如履平地，任江水拍打铁甲，发出沉闷轰鸣。远处哨塔传来犬吠，火把晃动，他猛然屏息，将头埋进湿漉漉的船板缝隙中，只余一双鹰眼穿透雾气，死死盯住对岸箭楼上的巡兵轮换路线。风起时，一缕血腥味混着焦'
2025-09-27 00:41:49 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=846 预览='{"text": "江面浮冰碎裂，发出细响。张飞俯身将蛇矛插入破船木缝，借力一荡，竟将整艘残骸拖入暗流。他翻身跃上，双足踏在朽木之上如履平地，任江水拍打铁甲，发出沉闷轰鸣。远处哨塔传来犬吠，火把晃动，他猛然屏息，将头埋进湿漉漉的船板缝隙中，只余一双鹰眼穿透雾气，死死盯住对岸箭楼上的巡兵轮换路线。风起时，一缕血腥味混着焦'
2025-09-27 00:41:49 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 180
2025-09-27 00:41:49 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 180
2025-09-27 00:41:49 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:41:49 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面浮冰碎裂，发出细响。...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:41:49 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面浮冰碎裂，发出细响。...
2025-09-27 00:41:49 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:41:49 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1514
2025-09-27 00:41:49 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=801 预览='{"text": "江面浮冰碎裂，发出细响。张飞俯身将蛇矛插入船底朽木，借力一撑，破船如离弦之箭滑向对岸。水花未溅，他已单膝跪在泥滩上，铁甲压弯了芦苇。远处火把摇曳，巡江队正从上游转来。他猛然扯下披风，裹住半边脸，露出狰狞獠牙——若被认出，便是万劫不复。但更深处，那座粮仓的轮廓在夜雾中若隐若现，仿佛在低语：此行非为杀敌，而是改写天命。他深吸一口寒气，双目如刀，直指那扇紧闭的门。", "choices": [{"option": "点燃船尾残布制造烟雾，趁乱潜入敌营侧墙", "summary": "以火为引，扰乱视线，伺机而动", "effects": {"delta_progress": 12'
2025-09-27 00:41:49 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=801 预览='{"text": "江面浮冰碎裂，发出细响。张飞俯身将蛇矛插入船底朽木，借力一撑，破船如离弦之箭滑向对岸。水花未溅，他已单膝跪在泥滩上，铁甲压弯了芦苇。远处火把摇曳，巡江队正从上游转来。他猛然扯下披风，裹住半边脸，露出狰狞獠牙——若被认出，便是万劫不复。但更深处，那座粮仓的轮廓在夜雾中若隐若现，仿佛在低语：此行非为杀敌'
2025-09-27 00:41:49 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=801 预览='{"text": "江面浮冰碎裂，发出细响。张飞俯身将蛇矛插入船底朽木，借力一撑，破船如离弦之箭滑向对岸。水花未溅，他已单膝跪在泥滩上，铁甲压弯了芦苇。远处火把摇曳，巡江队正从上游转来。他猛然扯下披风，裹住半边脸，露出狰狞獠牙——若被认出，便是万劫不复。但更深处，那座粮仓的轮廓在夜雾中若隐若现，仿佛在低语：此行非为杀敌'
2025-09-27 00:41:49 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 180
2025-09-27 00:41:49 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 180
2025-09-27 00:41:49 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:41:49 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面浮冰碎裂，发出细响。...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:41:49 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面浮冰碎裂，发出细响。...
2025-09-27 00:41:49 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:41:49 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1547
2025-09-27 00:41:49 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=836 预览='{"text": "江风骤紧，破船残骸在浪尖轻颤，仿佛随时会碎成木屑。张飞猛然俯身，将蛇矛插入泥中稳住身形，目光如刀扫过水道暗流——那正是曹军巡江船队必经的窄口。他忽而咧嘴一笑，露出森白獠牙，竟解下铁甲内衬的兽皮，裹住矛尖浸入水中。血色渗出，染红江面，腥气四散。这是他惯用的诱饵之法，专引水鬼与游鱼躁动，扰乱守卫耳目。可若水卒察觉异常，便是前功尽弃。他咬破舌尖，一声低吼自喉底滚出，似野兽嘶鸣，又似战鼓初擂。", "choices": [{"option": "将染血的兽皮投入急流，借鱼群惊扰吸引巡逻船调头", "summary": "以血为饵，诱敌自乱阵脚", "effects": {"delt'
2025-09-27 00:41:49 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=836 预览='{"text": "江风骤紧，破船残骸在浪尖轻颤，仿佛随时会碎成木屑。张飞猛然俯身，将蛇矛插入泥中稳住身形，目光如刀扫过水道暗流——那正是曹军巡江船队必经的窄口。他忽而咧嘴一笑，露出森白獠牙，竟解下铁甲内衬的兽皮，裹住矛尖浸入水中。血色渗出，染红江面，腥气四散。这是他惯用的诱饵之法，专引水鬼与游鱼躁动，扰乱守卫耳目。可'
2025-09-27 00:41:49 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=836 预览='{"text": "江风骤紧，破船残骸在浪尖轻颤，仿佛随时会碎成木屑。张飞猛然俯身，将蛇矛插入泥中稳住身形，目光如刀扫过水道暗流——那正是曹军巡江船队必经的窄口。他忽而咧嘴一笑，露出森白獠牙，竟解下铁甲内衬的兽皮，裹住矛尖浸入水中。血色渗出，染红江面，腥气四散。这是他惯用的诱饵之法，专引水鬼与游鱼躁动，扰乱守卫耳目。可'
2025-09-27 00:41:49 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 194
2025-09-27 00:41:49 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 194
2025-09-27 00:41:49 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:41:49 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，破船残骸在浪尖...
2025-09-27 00:41:49 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:41:49 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，破船残骸在浪尖...
2025-09-27 00:41:52 | INFO     | backend.main:shutdown_event:123 - 重生之我是……API服务关闭
2025-09-27 00:42:02 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:42:02 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:42:02 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:42:02 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904921733_838.png
2025-09-27 00:42:02 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904921733_838.png
2025-09-27 00:42:02 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:42:02 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904921733_838.png
2025-09-27 00:42:03 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:42:03 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:42:03 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:42:03 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904923353_444.png
2025-09-27 00:42:03 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904923353_444.png
2025-09-27 00:42:03 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:42:03 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904923353_444.png
2025-09-27 00:42:05 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d7a43ccc18c4fe1372f7b0e5767ee051.png (大小: 1284339 字节)
2025-09-27 00:42:05 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d7a43ccc18c4fe1372f7b0e5767ee051.png
2025-09-27 00:42:05 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d7a43ccc18c4fe1372f7b0e5767ee051.png
2025-09-27 00:42:05 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d7a43ccc18c4fe1372f7b0e5767ee051.png
2025-09-27 00:42:05 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d7a43ccc18c4fe1372f7b0e5767ee051.png
2025-09-27 00:42:05 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:42:05 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=122 choice='跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭' text_length=180
2025-09-27 00:42:05 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=122 choice='跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭'
2025-09-27 00:42:05 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=123 parent=122 choice='跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭'
2025-09-27 00:42:05 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=123 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d7a43ccc18c4fe1372f7b0e5767ee051.png
2025-09-27 00:42:05 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=10 node=123 depth=2
2025-09-27 00:42:05 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '跃入寒江，潜游至敌船底，用铁爪钩住船板，从水下发动突袭': cannot schedule new futures after interpreter shutdown
2025-09-27 00:42:08 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_8ee1e9b3d300f9d0cdf8ca70e962f7bc.png (大小: 1176201 字节)
2025-09-27 00:42:08 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_8ee1e9b3d300f9d0cdf8ca70e962f7bc.png
2025-09-27 00:42:08 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_8ee1e9b3d300f9d0cdf8ca70e962f7bc.png
2025-09-27 00:42:08 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_8ee1e9b3d300f9d0cdf8ca70e962f7bc.png
2025-09-27 00:42:08 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_8ee1e9b3d300f9d0cdf8ca70e962f7bc.png
2025-09-27 00:42:08 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:42:08 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=122 choice='点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀' text_length=180
2025-09-27 00:42:08 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=122 choice='点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀'
2025-09-27 00:42:08 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=124 parent=122 choice='点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀'
2025-09-27 00:42:08 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=124 image_url=http://127.0.0.1:8000/static/generated/ai_gen_8ee1e9b3d300f9d0cdf8ca70e962f7bc.png
2025-09-27 00:42:08 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=10 node=124 depth=2
2025-09-27 00:42:08 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '点燃一堆枯枝引燃火光，故意暴露位置吸引敌军注意力，趁乱从侧翼冲杀': cannot schedule new futures after interpreter shutdown
2025-09-27 00:42:09 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:42:09 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:42:09 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:42:09 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758904928638_184.png
2025-09-27 00:42:09 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758904928638_184.png
2025-09-27 00:42:09 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:42:09 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758904928638_184.png
2025-09-27 00:42:13 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_9dddf2b14161beb8b9982c387369b966.png (大小: 1604751 字节)
2025-09-27 00:42:13 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_9dddf2b14161beb8b9982c387369b966.png
2025-09-27 00:42:13 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_9dddf2b14161beb8b9982c387369b966.png
2025-09-27 00:42:13 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_9dddf2b14161beb8b9982c387369b966.png
2025-09-27 00:42:13 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_9dddf2b14161beb8b9982c387369b966.png
2025-09-27 00:42:13 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:42:13 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=122 choice='扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头' text_length=194
2025-09-27 00:42:13 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=122 choice='扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头'
2025-09-27 00:42:13 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=125 parent=122 choice='扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头'
2025-09-27 00:42:13 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=125 image_url=http://127.0.0.1:8000/static/generated/ai_gen_9dddf2b14161beb8b9982c387369b966.png
2025-09-27 00:42:13 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=10 node=125 depth=2
2025-09-27 00:42:13 | ERROR    | core.speculation:_generate_children_pipeline:216 - [Speculation] pipeline child generation failed for choice '扯下战袍裹住长矛，佯装渔夫摇橹靠近敌船，趁其不备突袭船头': cannot schedule new futures after interpreter shutdown
2025-09-27 00:50:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:51:00 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 00:51:01 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 00:51:01 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 00:51:01 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 00:51:01 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:51:01 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 00:51:01 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:51:01 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:51:01 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 00:51:01 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 00:51:01 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 00:51:01 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 00:51:01 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 00:51:01 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 00:51:01 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 00:51:01 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 00:51:01 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 00:51:01 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 00:51:01 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 00:51:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 00:51:02 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 00:51:02 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 00:51:02 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 00:51:02 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 00:51:02 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 00:51:42 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_6ffda289290fa9e8832b2106c878838d.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_6ffda289290fa9e8832b2106c878838d.png exists=True size=923303
2025-09-27 00:51:42 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:51:43 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_6ffda289290fa9e8832b2106c878838d.png
2025-09-27 00:53:15 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：关羽...
2025-09-27 00:53:15 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 00:53:15 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 9
2025-09-27 00:53:15 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 473
2025-09-27 00:53:17 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:17 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 895
2025-09-27 00:53:17 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 224
2025-09-27 00:53:17 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 00:53:17 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 赤壁未燃，关公再起, background: 公元208年冬，长江之畔，火光未起，历史裂痕初现。关羽身陷时空断层，重生于赤壁之战前夕的江陵城外。昔..., quest: 阻止曹操南下，促成孙刘同盟...
2025-09-27 00:53:17 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:53:17 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:53:17 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:53:17 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-27 00:53:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1334
2025-09-27 00:53:20 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=811 预览='{"text": "夜色如墨，寒风卷起残旗，关羽立于城楼边缘，目光穿透浓雾，锁定那道紧闭的偏门。铜锁在月光下泛着冷光，守卫的脚步声由远及近。他握紧青龙偃月刀，刀锋轻颤，仿佛在回应血脉中的战意。远处传来马蹄踏雪的声响——是援军？还是陷阱？他必须在下一刻做出抉择：是借风势突袭，以雷霆之势破局；还是静待时机，用智谋绕过铁壁？历史的齿轮在此刻转动，每一步都可能改写结局。", "choices": [{"option": "猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营", "summary": "以勇猛之姿强行破局，瞬间打破僵局", "effects": {"delta_progress": 12'
2025-09-27 00:53:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=811 预览='{"text": "夜色如墨，寒风卷起残旗，关羽立于城楼边缘，目光穿透浓雾，锁定那道紧闭的偏门。铜锁在月光下泛着冷光，守卫的脚步声由远及近。他握紧青龙偃月刀，刀锋轻颤，仿佛在回应血脉中的战意。远处传来马蹄踏雪的声响——是援军？还是陷阱？他必须在下一刻做出抉择：是借风势突袭，以雷霆之势破局；还是静待时机，用智谋绕过铁壁？'
2025-09-27 00:53:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=811 预览='{"text": "夜色如墨，寒风卷起残旗，关羽立于城楼边缘，目光穿透浓雾，锁定那道紧闭的偏门。铜锁在月光下泛着冷光，守卫的脚步声由远及近。他握紧青龙偃月刀，刀锋轻颤，仿佛在回应血脉中的战意。远处传来马蹄踏雪的声响——是援军？还是陷阱？他必须在下一刻做出抉择：是借风势突袭，以雷霆之势破局；还是静待时机，用智谋绕过铁壁？'
2025-09-27 00:53:20 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 172
2025-09-27 00:53:20 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:20 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 172
2025-09-27 00:53:20 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:20 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 00:53:20 | INFO     | core.image_storage:__init__:29 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 00:53:20 | INFO     | core.image_storage:__init__:30 - 图像web访问前缀: http://127.0.0.1:8000/static/generated
2025-09-27 00:53:20 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:20 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，寒风卷起残旗，...
2025-09-27 00:53:20 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，寒风卷起残旗，...
2025-09-27 00:53:33 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:53:33 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:53:33 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:53:33 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905613042_688.png
2025-09-27 00:53:33 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905613042_688.png
2025-09-27 00:53:33 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:53:33 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905613042_688.png
2025-09-27 00:53:35 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png (大小: 1118563 字节)
2025-09-27 00:53:35 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:35 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:35 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:35 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:35 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 00:53:35 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=172
2025-09-27 00:53:35 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=11
2025-09-27 00:53:35 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=126
2025-09-27 00:53:35 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=126 image_url=http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:35 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=126 depth=3
2025-09-27 00:53:35 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=11, node=126
2025-09-27 00:53:35 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=11
2025-09-27 00:53:35 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:53:35 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=126
2025-09-27 00:53:35 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=126 choice='猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营'
2025-09-27 00:53:35 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=126 choice='低声吟唱《关山月》，用熟悉的曲调唤醒旧部埋伏的暗哨'
2025-09-27 00:53:35 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=126 choice='猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营'
2025-09-27 00:53:35 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=126 choice='悄然脱下外袍，披上敌军服饰，混入换班队伍中无声潜入'
2025-09-27 00:53:35 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=126 choice='低声吟唱《关山月》，用熟悉的曲调唤醒旧部埋伏的暗哨'
2025-09-27 00:53:35 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营
2025-09-27 00:53:35 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=126 choice='悄然脱下外袍，披上敌军服饰，混入换班队伍中无声潜入'
2025-09-27 00:53:35 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 低声吟唱《关山月》，用熟悉的曲调唤醒旧部埋伏的暗哨
2025-09-27 00:53:35 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然脱下外袍，披上敌军服饰，混入换班队伍中无声潜入
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 关羽...
2025-09-27 00:53:37 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 00:53:37 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:-6344802536559875145
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=11, node=126
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=11, node_id=126
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=11, node_id=126
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 172, 选择数: 3, 图片: http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:475 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:484 - [Start] 📁 [图片文件检查] 文件存在: True, 大小: 1118563字节, 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:492 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=11, node=126
2025-09-27 00:53:37 | INFO     | api.story:start_new_story:494 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:37 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png exists=True size=1118563
2025-09-27 00:53:37 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:37 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 00:53:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1520
2025-09-27 00:53:39 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=857 预览='{"text": "寒风撕扯着战袍，关羽的呼吸在冷雾中凝成白烟。铜锁纹丝不动，而脚步声已近至三丈之内。他猛然抬头，目光如电扫过墙头暗影——一缕青烟自偏门缝隙渗出，竟是早已埋伏的火油引信！原来此门非为守卫，而是诱饵。他低喝一声，纵身跃上城垛，借风势将青龙偃月刀横斩于空中，刀锋划破夜幕，带起一串火星，直击那根引信。火光骤然炸裂，浓烟翻滚间，一道被封死的暗道豁然洞开，腥风扑面，似有无数亡魂低语。", "choices": [{"option": "纵身跃入烟尘，借爆炸余波冲向暗道深处", "summary": "以命搏机，趁乱突袭敌阵核心", "effects": {"delta_progress"'
2025-09-27 00:53:39 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=857 预览='{"text": "寒风撕扯着战袍，关羽的呼吸在冷雾中凝成白烟。铜锁纹丝不动，而脚步声已近至三丈之内。他猛然抬头，目光如电扫过墙头暗影——一缕青烟自偏门缝隙渗出，竟是早已埋伏的火油引信！原来此门非为守卫，而是诱饵。他低喝一声，纵身跃上城垛，借风势将青龙偃月刀横斩于空中，刀锋划破夜幕，带起一串火星，直击那根引信。火光骤然'
2025-09-27 00:53:39 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=857 预览='{"text": "寒风撕扯着战袍，关羽的呼吸在冷雾中凝成白烟。铜锁纹丝不动，而脚步声已近至三丈之内。他猛然抬头，目光如电扫过墙头暗影——一缕青烟自偏门缝隙渗出，竟是早已埋伏的火油引信！原来此门非为守卫，而是诱饵。他低喝一声，纵身跃上城垛，借风势将青龙偃月刀横斩于空中，刀锋划破夜幕，带起一串火星，直击那根引信。火光骤然'
2025-09-27 00:53:39 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 186
2025-09-27 00:53:39 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:39 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 186
2025-09-27 00:53:39 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:39 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:39 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风撕扯着战袍，关羽的呼...
2025-09-27 00:53:39 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:39 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风撕扯着战袍，关羽的呼...
2025-09-27 00:53:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1544
2025-09-27 00:53:40 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=876 预览='{"text": "风雪愈发急骤，城楼上的铜铃在寒风中发出凄厉的鸣响。关羽凝视着那扇紧闭的偏门，锁孔深处仿佛有暗流涌动。远处马蹄声渐近，却忽然停驻于三丈之外——是敌是友？他猛然察觉，守卫换班的间隙正悄然浮现，而左侧墙角的枯枝上，竟挂着半截残破的军旗，旗角绣着熟悉的‘汉’字。这绝非偶然。他深吸一口气，青龙偃月刀在掌心微微震颤，刀锋映出他眼中燃起的决意。此刻，是趁乱突袭，还是借物引信，点燃一场以命为薪的火？历史的裂隙就在眼前。", "choices": [{"option": "将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入", "summary": "以刀为镜，借光影迷惑敌人"'
2025-09-27 00:53:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=876 预览='{"text": "风雪愈发急骤，城楼上的铜铃在寒风中发出凄厉的鸣响。关羽凝视着那扇紧闭的偏门，锁孔深处仿佛有暗流涌动。远处马蹄声渐近，却忽然停驻于三丈之外——是敌是友？他猛然察觉，守卫换班的间隙正悄然浮现，而左侧墙角的枯枝上，竟挂着半截残破的军旗，旗角绣着熟悉的‘汉’字。这绝非偶然。他深吸一口气，青龙偃月刀在掌心微微'
2025-09-27 00:53:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=876 预览='{"text": "风雪愈发急骤，城楼上的铜铃在寒风中发出凄厉的鸣响。关羽凝视着那扇紧闭的偏门，锁孔深处仿佛有暗流涌动。远处马蹄声渐近，却忽然停驻于三丈之外——是敌是友？他猛然察觉，守卫换班的间隙正悄然浮现，而左侧墙角的枯枝上，竟挂着半截残破的军旗，旗角绣着熟悉的‘汉’字。这绝非偶然。他深吸一口气，青龙偃月刀在掌心微微'
2025-09-27 00:53:40 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 203
2025-09-27 00:53:40 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:40 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 203
2025-09-27 00:53:40 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:40 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:40 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风雪愈发急骤，城楼上的铜...
2025-09-27 00:53:40 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:40 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风雪愈发急骤，城楼上的铜...
2025-09-27 00:53:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1543
2025-09-27 00:53:40 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=879 预览='{"text": "风雪愈发急促，城楼上的铜铃在寒风中发出凄厉的呜咽。关羽凝视着那扇紧闭的偏门，刀锋映着月光如霜。守卫的脚步声在石阶上回荡，三步一停，两步一望，显然戒备森严。他忽然嗅到一丝异香——是酒气混着草药味，从门缝下悄然渗出。原来这守卫竟在饮酒驱寒，醉意已染眉梢。夜色如墨，马蹄声渐近，却未见人影，只余空旷雪原。是援军？还是诱饵？他心中杀意翻涌，但更有一丝诡谲的直觉：这门后，或许藏着比敌军更危险的秘密。", "choices": [{"option": "用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门", "summary": "以微小动静扰乱对方心神，制造突袭契机", "eff'
2025-09-27 00:53:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=879 预览='{"text": "风雪愈发急促，城楼上的铜铃在寒风中发出凄厉的呜咽。关羽凝视着那扇紧闭的偏门，刀锋映着月光如霜。守卫的脚步声在石阶上回荡，三步一停，两步一望，显然戒备森严。他忽然嗅到一丝异香——是酒气混着草药味，从门缝下悄然渗出。原来这守卫竟在饮酒驱寒，醉意已染眉梢。夜色如墨，马蹄声渐近，却未见人影，只余空旷雪原。是'
2025-09-27 00:53:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=879 预览='{"text": "风雪愈发急促，城楼上的铜铃在寒风中发出凄厉的呜咽。关羽凝视着那扇紧闭的偏门，刀锋映着月光如霜。守卫的脚步声在石阶上回荡，三步一停，两步一望，显然戒备森严。他忽然嗅到一丝异香——是酒气混着草药味，从门缝下悄然渗出。原来这守卫竟在饮酒驱寒，醉意已染眉梢。夜色如墨，马蹄声渐近，却未见人影，只余空旷雪原。是'
2025-09-27 00:53:40 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 195
2025-09-27 00:53:40 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:40 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 195
2025-09-27 00:53:40 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:40 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:40 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风雪愈发急促，城楼上的铜...
2025-09-27 00:53:40 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:40 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风雪愈发急促，城楼上的铜...
2025-09-27 00:53:50 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:53:50 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:53:50 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:53:50 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905629762_272.png
2025-09-27 00:53:50 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905629762_272.png
2025-09-27 00:53:50 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:53:50 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905629762_272.png
2025-09-27 00:53:51 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 785
2025-09-27 00:53:51 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 151
2025-09-27 00:53:51 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:53:51 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905631226_207.png
2025-09-27 00:53:51 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905631226_207.png
2025-09-27 00:53:51 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:53:51 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905631226_207.png
2025-09-27 00:53:52 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:53:52 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:53:52 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:53:52 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905632205_316.png
2025-09-27 00:53:52 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905632205_316.png
2025-09-27 00:53:52 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:53:52 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905632205_316.png
2025-09-27 00:53:53 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_99042cb7d9086137a14e8daf706ca875.png (大小: 1442170 字节)
2025-09-27 00:53:53 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_99042cb7d9086137a14e8daf706ca875.png
2025-09-27 00:53:53 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_99042cb7d9086137a14e8daf706ca875.png
2025-09-27 00:53:53 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_99042cb7d9086137a14e8daf706ca875.png
2025-09-27 00:53:53 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_99042cb7d9086137a14e8daf706ca875.png
2025-09-27 00:53:53 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=126 choice='悄然脱下外袍，披上敌军服饰，混入换班队伍中无声潜入' text_length=186
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=126 choice='悄然脱下外袍，披上敌军服饰，混入换班队伍中无声潜入'
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=127 parent=126 choice='悄然脱下外袍，披上敌军服饰，混入换班队伍中无声潜入'
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=127 image_url=http://127.0.0.1:8000/static/generated/ai_gen_99042cb7d9086137a14e8daf706ca875.png
2025-09-27 00:53:53 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=127 depth=2
2025-09-27 00:53:53 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=127 completed, triggered next level depth=2
2025-09-27 00:53:53 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=127
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=127 choice='纵身跃入烟尘，借爆炸余波冲向暗道深处'
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=127 choice='背靠城墙静立，以刀尖点地稳住身形，观察暗道内动静'
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=127 choice='纵身跃入烟尘，借爆炸余波冲向暗道深处'
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=127 choice='将战袍撕下裹住刀刃，反手掷向暗道入口，制造声响引蛇出洞'
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=127 choice='背靠城墙静立，以刀尖点地稳住身形，观察暗道内动静'
2025-09-27 00:53:53 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 纵身跃入烟尘，借爆炸余波冲向暗道深处
2025-09-27 00:53:53 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=127 choice='将战袍撕下裹住刀刃，反手掷向暗道入口，制造声响引蛇出洞'
2025-09-27 00:53:53 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 背靠城墙静立，以刀尖点地稳住身形，观察暗道内动静
2025-09-27 00:53:53 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将战袍撕下裹住刀刃，反手掷向暗道入口，制造声响引蛇出洞
2025-09-27 00:53:55 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d69d04ce8142d20109be8f23716ccfc8.png (大小: 1444140 字节)
2025-09-27 00:53:55 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:55 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:55 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:55 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:55 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=126 choice='猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营' text_length=195
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=126 choice='猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营'
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=128 parent=126 choice='猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营'
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=128 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:55 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=128 depth=2
2025-09-27 00:53:55 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=128 completed, triggered next level depth=2
2025-09-27 00:53:55 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=128
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=128 choice='用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门'
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=128 choice='用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门'
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=128 choice='低声吟唱《关山月》旧曲，以音律试探守卫反应，或唤醒其故国记忆'
2025-09-27 00:53:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=128 choice='解下披风，故意让风卷起一角，引守卫目光，趁其回头查看时疾步潜入'
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=128 choice='低声吟唱《关山月》旧曲，以音律试探守卫反应，或唤醒其故国记忆'
2025-09-27 00:53:55 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=128 choice='解下披风，故意让风卷起一角，引守卫目光，趁其回头查看时疾步潜入'
2025-09-27 00:53:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 低声吟唱《关山月》旧曲，以音律试探守卫反应，或唤醒其故国记忆
2025-09-27 00:53:55 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 解下披风，故意让风卷起一角，引守卫目光，趁其回头查看时疾步潜入
2025-09-27 00:53:56 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_a1043dc61e23d3d50db12414513f4843.png (大小: 1770246 字节)
2025-09-27 00:53:56 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_a1043dc61e23d3d50db12414513f4843.png
2025-09-27 00:53:56 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_a1043dc61e23d3d50db12414513f4843.png
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_a1043dc61e23d3d50db12414513f4843.png
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_a1043dc61e23d3d50db12414513f4843.png
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=126 choice='低声吟唱《关山月》，用熟悉的曲调唤醒旧部埋伏的暗哨' text_length=203
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=126 choice='低声吟唱《关山月》，用熟悉的曲调唤醒旧部埋伏的暗哨'
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=129 parent=126 choice='低声吟唱《关山月》，用熟悉的曲调唤醒旧部埋伏的暗哨'
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=129 image_url=http://127.0.0.1:8000/static/generated/ai_gen_a1043dc61e23d3d50db12414513f4843.png
2025-09-27 00:53:56 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=129 depth=2
2025-09-27 00:53:56 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=129 completed, triggered next level depth=2
2025-09-27 00:53:56 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=129
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=129 choice='将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入'
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=129 choice='将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入'
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=129 choice='摘下护腕，用血在墙上写下‘忠义’二字，引动守卫内心动摇'
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=129 choice='点燃随身火折子，将残旗投入风中，借火焰与旗帜的飘动制造混乱入口'
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=129 choice='摘下护腕，用血在墙上写下‘忠义’二字，引动守卫内心动摇'
2025-09-27 00:53:56 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=129 choice='点燃随身火折子，将残旗投入风中，借火焰与旗帜的飘动制造混乱入口'
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 摘下护腕，用血在墙上写下‘忠义’二字，引动守卫内心动摇
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃随身火折子，将残旗投入风中，借火焰与旗帜的飘动制造混乱入口
2025-09-27 00:53:56 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:56 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1723
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=877 预览='{"text": "夜风裹着焦土气息掠过城墙，关羽将染血的外袍轻轻披在肩头，衣角垂落如暗影。他俯身拾起一具敌军尸体的铠甲，以残破布条缠紧手腕，模仿换班士卒的步履节奏。火光摇曳中，三队巡哨交错而过，脚步声渐远。他混入队伍，低垂着头，呼吸与战靴踏雪的频率悄然同步。前方是主帐入口，一道铁帘后传来低语——‘明日午时，斩首祭旗’。他心头一震：原来此地并非寻常关隘，竟是曹操密令处决降将的刑场！而那被锁的偏门，正是通往地牢的唯一活路。他必须在下一刻做出选择，否则将永远困于这无名之役。", "choices": [{"option": "趁守卫低头整理腰带时，猛然抽刀刺向其咽喉", "summary": "以'
2025-09-27 00:53:56 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=877 预览='{"text": "夜风裹着焦土气息掠过城墙，关羽将染血的外袍轻轻披在肩头，衣角垂落如暗影。他俯身拾起一具敌军尸体的铠甲，以残破布条缠紧手腕，模仿换班士卒的步履节奏。火光摇曳中，三队巡哨交错而过，脚步声渐远。他混入队伍，低垂着头，呼吸与战靴踏雪的频率悄然同步。前方是主帐入口，一道铁帘后传来低语——‘明日午时，斩首祭旗’'
2025-09-27 00:53:56 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=877 预览='{"text": "夜风裹着焦土气息掠过城墙，关羽将染血的外袍轻轻披在肩头，衣角垂落如暗影。他俯身拾起一具敌军尸体的铠甲，以残破布条缠紧手腕，模仿换班士卒的步履节奏。火光摇曳中，三队巡哨交错而过，脚步声渐远。他混入队伍，低垂着头，呼吸与战靴踏雪的频率悄然同步。前方是主帐入口，一道铁帘后传来低语——‘明日午时，斩首祭旗’'
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 227
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 227
2025-09-27 00:53:56 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:56 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风裹着焦土气息掠过城墙...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:56 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风裹着焦土气息掠过城墙...
2025-09-27 00:53:56 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:56 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1725
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=883 预览='{"text": "夜风卷起你披在身上的敌军战袍，布料猎猎作响，如同亡魂低语。你混入换班的队伍，脚步沉稳如常，呼吸与三步一停的节奏同步。火把摇曳间，守卫目光扫过你的面庞，却只觉一阵寒意掠过——那不是熟悉的面孔，而是被风沙磨钝的轮廓。你低头行礼，指尖悄然扣住腰间短刃，暗中记下哨位间距与巡逻间隙。当队伍转入内廊，一道铁栅后传来金属撞击声，似有重物被拖动。你忽然顿住，耳畔响起一声极轻的叹息，仿佛有人在呼唤‘云长’——可这声音，分明来自你已逝的故人之口。是幻觉？还是此地早有埋伏？你必须在下一瞬决定：是继续前行，还是借机反制？", "choices": [{"option": "突然跪倒，佯装脚踝扭伤，'
2025-09-27 00:53:56 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=883 预览='{"text": "夜风卷起你披在身上的敌军战袍，布料猎猎作响，如同亡魂低语。你混入换班的队伍，脚步沉稳如常，呼吸与三步一停的节奏同步。火把摇曳间，守卫目光扫过你的面庞，却只觉一阵寒意掠过——那不是熟悉的面孔，而是被风沙磨钝的轮廓。你低头行礼，指尖悄然扣住腰间短刃，暗中记下哨位间距与巡逻间隙。当队伍转入内廊，一道铁栅后'
2025-09-27 00:53:56 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=883 预览='{"text": "夜风卷起你披在身上的敌军战袍，布料猎猎作响，如同亡魂低语。你混入换班的队伍，脚步沉稳如常，呼吸与三步一停的节奏同步。火把摇曳间，守卫目光扫过你的面庞，却只觉一阵寒意掠过——那不是熟悉的面孔，而是被风沙磨钝的轮廓。你低头行礼，指尖悄然扣住腰间短刃，暗中记下哨位间距与巡逻间隙。当队伍转入内廊，一道铁栅后'
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 251
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 251
2025-09-27 00:53:56 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:56 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起你披在身上的敌军...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:56 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起你披在身上的敌军...
2025-09-27 00:53:56 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:56 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1740
2025-09-27 00:53:56 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=893 预览='{"text": "夜风裹着血腥与焦土的气息，关羽披着敌军破旧的铠甲，混在换班的士卒间缓步前行。皮甲摩擦声如细碎雷鸣，他低头压帽，呼吸沉入胸腔，每一步都踩在生死边缘。守卫的火把摇曳，映出他半边脸庞的轮廓——那双眸子却如寒潭深水，不动声色地扫视着每一处暗哨。前方三丈，一道铁栅门缓缓开启，内里传来马蹄轻踏石板的回响。他忽然停步，右脚后撤半寸，鞋底碾碎一粒枯叶——那是陷阱的前兆。可更令人窒息的是，门后传来低语：‘将军已命人封锁所有出口，若有异动，格杀勿论。’他心头一紧，原来这并非寻常换防，而是一场精心布置的围猎。", "choices": [{"option": "突然拔刀劈断绳索，引爆埋伏的火油桶'
2025-09-27 00:53:56 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=893 预览='{"text": "夜风裹着血腥与焦土的气息，关羽披着敌军破旧的铠甲，混在换班的士卒间缓步前行。皮甲摩擦声如细碎雷鸣，他低头压帽，呼吸沉入胸腔，每一步都踩在生死边缘。守卫的火把摇曳，映出他半边脸庞的轮廓——那双眸子却如寒潭深水，不动声色地扫视着每一处暗哨。前方三丈，一道铁栅门缓缓开启，内里传来马蹄轻踏石板的回响。他忽然'
2025-09-27 00:53:56 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=893 预览='{"text": "夜风裹着血腥与焦土的气息，关羽披着敌军破旧的铠甲，混在换班的士卒间缓步前行。皮甲摩擦声如细碎雷鸣，他低头压帽，呼吸沉入胸腔，每一步都踩在生死边缘。守卫的火把摇曳，映出他半边脸庞的轮廓——那双眸子却如寒潭深水，不动声色地扫视着每一处暗哨。前方三丈，一道铁栅门缓缓开启，内里传来马蹄轻踏石板的回响。他忽然'
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 246
2025-09-27 00:53:56 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 246
2025-09-27 00:53:56 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:56 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风裹着血腥与焦土的气息...
2025-09-27 00:53:56 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:56 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风裹着血腥与焦土的气息...
2025-09-27 00:53:58 | INFO     | api.story:continue_existing_story:514 - 收到故事继续请求，选择: 猛然跃上墙头，借风势挥刀劈开锁链，引动警钟惊动全营
2025-09-27 00:53:58 | INFO     | api.story:continue_existing_story:558 - [NodeReady] 检查节点完整性：node_id=128
2025-09-27 00:53:58 | INFO     | api.story:_wait_for_node_complete:126 - [NodeComplete] 开始等待节点完全准备：node_id=128
2025-09-27 00:53:58 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] ✅ 节点完全准备就绪：node_id=128 (等待了 0.0 秒)
2025-09-27 00:53:58 | INFO     | api.story:continue_existing_story:561 - [NodeReady] ✅ 节点完全准备就绪：node_id=128
2025-09-27 00:53:58 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d69d04ce8142d20109be8f23716ccfc8.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d69d04ce8142d20109be8f23716ccfc8.png exists=True size=1444140
2025-09-27 00:53:58 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:58 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 00:53:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1741
2025-09-27 00:53:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=876 预览='{"text": "刀锋撕裂寒风，锁链应声崩断，铜铃骤然炸响，如泣如诉的钟声划破夜空。城楼守卫惊醒，火把在雪地投下扭曲的影，三步并作两步冲向偏门。关羽借势跃下，青龙偃月刀在空中划出一道弧光，将扑来的敌兵逼退半步。他立于雪中，衣袍猎猎，目光如炬，却未见援军踪影——那马蹄声早已消散于风雪深处。远处传来号角声，是敌营已察觉异动，箭矢如蝗。他猛然意识到：这扇门后并非空室，而是一处密道入口，地面残留着新鲜的车辙与血迹，指向幽深的地下甬道。历史的齿轮在脚下转动，真相正从黑暗中浮现。", "choices": [{"option": "纵身跃入密道，循着血迹追踪暗流", "summary": "直面未知，深'
2025-09-27 00:53:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=876 预览='{"text": "刀锋撕裂寒风，锁链应声崩断，铜铃骤然炸响，如泣如诉的钟声划破夜空。城楼守卫惊醒，火把在雪地投下扭曲的影，三步并作两步冲向偏门。关羽借势跃下，青龙偃月刀在空中划出一道弧光，将扑来的敌兵逼退半步。他立于雪中，衣袍猎猎，目光如炬，却未见援军踪影——那马蹄声早已消散于风雪深处。远处传来号角声，是敌营已察觉异'
2025-09-27 00:53:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=876 预览='{"text": "刀锋撕裂寒风，锁链应声崩断，铜铃骤然炸响，如泣如诉的钟声划破夜空。城楼守卫惊醒，火把在雪地投下扭曲的影，三步并作两步冲向偏门。关羽借势跃下，青龙偃月刀在空中划出一道弧光，将扑来的敌兵逼退半步。他立于雪中，衣袍猎猎，目光如炬，却未见援军踪影——那马蹄声早已消散于风雪深处。远处传来号角声，是敌营已察觉异'
2025-09-27 00:53:59 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 227
2025-09-27 00:53:59 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 227
2025-09-27 00:53:59 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:59 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 刀锋撕裂寒风，锁链应声崩...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 刀锋撕裂寒风，锁链应声崩...
2025-09-27 00:53:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1759
2025-09-27 00:53:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=886 预览='{"text": "寒风撕裂夜幕，关羽凌空跃起，青龙偃月刀如银虹贯日，劈向铜锁。锁链崩断的脆响刺破寂静，警钟骤然轰鸣，回荡在雪原之上。城楼守卫惊醒，火把骤亮，箭矢如雨倾泻而下。他借势翻落，刀锋划过雪地，留下一道血痕般的轨迹。远处马蹄声骤然密集，黑影从雾中奔涌而出——是敌军？还是援兵？火光映照下，他看见一队披甲骑兵正疾驰而来，旗帜猎猎，竟非曹军，而是……荆州旧部？他们为何在此？更诡异的是，那面旗帜上赫然绣着‘关’字，与他当年所佩战旗如出一辙。这究竟是命运的巧合，还是有人刻意布局？风雪未歇，杀机已至。", "choices": [{"option": "迎着骑兵冲去，高举战刀大喊‘吾乃关云长！’"'
2025-09-27 00:53:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=886 预览='{"text": "寒风撕裂夜幕，关羽凌空跃起，青龙偃月刀如银虹贯日，劈向铜锁。锁链崩断的脆响刺破寂静，警钟骤然轰鸣，回荡在雪原之上。城楼守卫惊醒，火把骤亮，箭矢如雨倾泻而下。他借势翻落，刀锋划过雪地，留下一道血痕般的轨迹。远处马蹄声骤然密集，黑影从雾中奔涌而出——是敌军？还是援兵？火光映照下，他看见一队披甲骑兵正疾驰'
2025-09-27 00:53:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=886 预览='{"text": "寒风撕裂夜幕，关羽凌空跃起，青龙偃月刀如银虹贯日，劈向铜锁。锁链崩断的脆响刺破寂静，警钟骤然轰鸣，回荡在雪原之上。城楼守卫惊醒，火把骤亮，箭矢如雨倾泻而下。他借势翻落，刀锋划过雪地，留下一道血痕般的轨迹。远处马蹄声骤然密集，黑影从雾中奔涌而出——是敌军？还是援兵？火光映照下，他看见一队披甲骑兵正疾驰'
2025-09-27 00:53:59 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 241
2025-09-27 00:53:59 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 241
2025-09-27 00:53:59 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:59 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风撕裂夜幕，关羽凌空跃...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风撕裂夜幕，关羽凌空跃...
2025-09-27 00:53:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:53:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1755
2025-09-27 00:53:59 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=890 预览='{"text": "刀锋撕裂寒风，锁链应声而断，铜铃骤然炸响，如丧钟般划破夜空。城楼火把齐燃，箭矢从四面八方攒射而来，关羽借势跃下，青龙偃月刀在雪地上划出一道血痕。他未退反进，踏着飞溅的冰碴冲向敌营深处，身后火光映照出他披风猎猎、宛如战神降临的身影。守卫惊惶奔逃，却见他竟在半空中猛然转身，刀锋横扫，将一队弓手连人带弩斩为两段。雪地之上，血雾与残雪交织成一幅诡异画卷。远处马蹄声骤停——那支‘援军’竟已悄然列阵，黑甲如铁，刀锋朝内，似在等待某种信号。他忽然意识到：这根本不是救援，而是围猎。", "choices": [{"option": "猛然撞开敌阵前排，以雷霆之势直取中军帅旗", "summ'
2025-09-27 00:53:59 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=890 预览='{"text": "刀锋撕裂寒风，锁链应声而断，铜铃骤然炸响，如丧钟般划破夜空。城楼火把齐燃，箭矢从四面八方攒射而来，关羽借势跃下，青龙偃月刀在雪地上划出一道血痕。他未退反进，踏着飞溅的冰碴冲向敌营深处，身后火光映照出他披风猎猎、宛如战神降临的身影。守卫惊惶奔逃，却见他竟在半空中猛然转身，刀锋横扫，将一队弓手连人带弩斩'
2025-09-27 00:53:59 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=890 预览='{"text": "刀锋撕裂寒风，锁链应声而断，铜铃骤然炸响，如丧钟般划破夜空。城楼火把齐燃，箭矢从四面八方攒射而来，关羽借势跃下，青龙偃月刀在雪地上划出一道血痕。他未退反进，踏着飞溅的冰碴冲向敌营深处，身后火光映照出他披风猎猎、宛如战神降临的身影。守卫惊惶奔逃，却见他竟在半空中猛然转身，刀锋横扫，将一队弓手连人带弩斩'
2025-09-27 00:53:59 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 235
2025-09-27 00:53:59 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 235
2025-09-27 00:53:59 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:53:59 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 刀锋撕裂寒风，锁链应声而...
2025-09-27 00:53:59 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:53:59 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 刀锋撕裂寒风，锁链应声而...
2025-09-27 00:54:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:54:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1768
2025-09-27 00:54:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=925 预览='{"text": "你低吟《关山月》，声如寒泉击石，穿透风雪。那曲调苍凉而熟悉，仿佛从千军万马的烽火中走来。墙角残旗微微一颤，枯枝间忽有异动——一道黑影自暗处滑出，单膝跪地，喉间滚出一声极轻的‘将军’。三丈外的马蹄声骤然碎裂，似被这歌声钉在原地。远处传来金属摩擦声，守卫的巡夜队竟缓缓停步，有人低声应和起调子。旧部已闻声而动，暗哨如星火燎原。然而，风雪渐密，你忽然察觉，那支应和的嗓音……竟带着几分陌生的沙哑。是故人？还是敌人的模仿？若此刻突袭，能否点燃整座城池的火种？若再等片刻，是否将错失良机？历史的弦，在这一瞬绷至极限。", "choices": [{"option": "猛然收声，拔刀直指那'
2025-09-27 00:54:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=925 预览='{"text": "你低吟《关山月》，声如寒泉击石，穿透风雪。那曲调苍凉而熟悉，仿佛从千军万马的烽火中走来。墙角残旗微微一颤，枯枝间忽有异动——一道黑影自暗处滑出，单膝跪地，喉间滚出一声极轻的‘将军’。三丈外的马蹄声骤然碎裂，似被这歌声钉在原地。远处传来金属摩擦声，守卫的巡夜队竟缓缓停步，有人低声应和起调子。旧部已闻声'
2025-09-27 00:54:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=925 预览='{"text": "你低吟《关山月》，声如寒泉击石，穿透风雪。那曲调苍凉而熟悉，仿佛从千军万马的烽火中走来。墙角残旗微微一颤，枯枝间忽有异动——一道黑影自暗处滑出，单膝跪地，喉间滚出一声极轻的‘将军’。三丈外的马蹄声骤然碎裂，似被这歌声钉在原地。远处传来金属摩擦声，守卫的巡夜队竟缓缓停步，有人低声应和起调子。旧部已闻声'
2025-09-27 00:54:00 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 253
2025-09-27 00:54:00 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 253
2025-09-27 00:54:00 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:54:00 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 你低吟《关山月》，声如寒...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:54:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 你低吟《关山月》，声如寒...
2025-09-27 00:54:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:54:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1727
2025-09-27 00:54:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=869 预览='{"text": "你低吟《关山月》，声如寒泉滴石，字字入骨。那熟悉的曲调在风雪中蜿蜒而上，仿佛唤醒沉睡的魂灵。刹那间，墙角枯枝上的残旗微微一颤，旗角‘汉’字在月光下竟似泛起微光。三丈外的暗影里，一道黑袍人影悄然抬头，手中短刃轻点地面——那是旧部暗哨的应答信号。风雪骤停，天地为之一静。你知，时机已至：伏兵将动，但若暴露，整局棋局或将崩裂。远处马蹄声再起，却不再急促，反而如鼓点般规律逼近，是援军？还是更严密的围猎？你须在下一瞬决定如何点燃这无声的烽火。", "choices": [{"option": "以刀尖挑断枯枝，让残旗坠落引燃守卫警觉", "summary": "以意外制造混乱，打乱敌方'
2025-09-27 00:54:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=869 预览='{"text": "你低吟《关山月》，声如寒泉滴石，字字入骨。那熟悉的曲调在风雪中蜿蜒而上，仿佛唤醒沉睡的魂灵。刹那间，墙角枯枝上的残旗微微一颤，旗角‘汉’字在月光下竟似泛起微光。三丈外的暗影里，一道黑袍人影悄然抬头，手中短刃轻点地面——那是旧部暗哨的应答信号。风雪骤停，天地为之一静。你知，时机已至：伏兵将动，但若暴露'
2025-09-27 00:54:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=869 预览='{"text": "你低吟《关山月》，声如寒泉滴石，字字入骨。那熟悉的曲调在风雪中蜿蜒而上，仿佛唤醒沉睡的魂灵。刹那间，墙角枯枝上的残旗微微一颤，旗角‘汉’字在月光下竟似泛起微光。三丈外的暗影里，一道黑袍人影悄然抬头，手中短刃轻点地面——那是旧部暗哨的应答信号。风雪骤停，天地为之一静。你知，时机已至：伏兵将动，但若暴露'
2025-09-27 00:54:00 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 217
2025-09-27 00:54:00 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 217
2025-09-27 00:54:00 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:54:00 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 你低吟《关山月》，声如寒...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:54:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 你低吟《关山月》，声如寒...
2025-09-27 00:54:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:54:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1777
2025-09-27 00:54:00 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=954 预览='{"text": "夜风卷起残旗，关羽低吟《关山月》，声如裂帛，穿透风雪。那曲调苍凉悠远，似从千年战鼓中浮出，直抵人心深处。墙角枯枝上的残旗忽然微微颤动，仿佛被无形之手拨动。片刻后，三丈外的暗影里，一道人影无声滑出，单膝跪地，声音沙哑却坚定：‘将军，旧部在此！’ 灰袍军士从怀中取出一枚铜铃，轻轻一摇——清越之声划破寒夜，竟与城楼铜铃应和。远处传来马蹄轻响，却是敌营方向的巡逻队骤然停步，疑云顿生。这曲调唤醒的不只是旧部，更是埋藏于敌阵深处的伏线。而更远处，一缕青烟悄然升腾，来自南侧粮仓——那是约定的信号？还是陷阱的开端？风雪未歇，战局已在无声中悄然改写。", "choices": [{"opti'
2025-09-27 00:54:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=954 预览='{"text": "夜风卷起残旗，关羽低吟《关山月》，声如裂帛，穿透风雪。那曲调苍凉悠远，似从千年战鼓中浮出，直抵人心深处。墙角枯枝上的残旗忽然微微颤动，仿佛被无形之手拨动。片刻后，三丈外的暗影里，一道人影无声滑出，单膝跪地，声音沙哑却坚定：‘将军，旧部在此！’ 灰袍军士从怀中取出一枚铜铃，轻轻一摇——清越之声划破寒夜'
2025-09-27 00:54:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=954 预览='{"text": "夜风卷起残旗，关羽低吟《关山月》，声如裂帛，穿透风雪。那曲调苍凉悠远，似从千年战鼓中浮出，直抵人心深处。墙角枯枝上的残旗忽然微微颤动，仿佛被无形之手拨动。片刻后，三丈外的暗影里，一道人影无声滑出，单膝跪地，声音沙哑却坚定：‘将军，旧部在此！’ 灰袍军士从怀中取出一枚铜铃，轻轻一摇——清越之声划破寒夜'
2025-09-27 00:54:00 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 269
2025-09-27 00:54:00 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 269
2025-09-27 00:54:00 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:54:00 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残旗，关羽低吟《...
2025-09-27 00:54:00 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:54:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残旗，关羽低吟《...
2025-09-27 00:54:06 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 766
2025-09-27 00:54:06 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 132
2025-09-27 00:54:06 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:06 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905645624_550.png
2025-09-27 00:54:06 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905645624_550.png
2025-09-27 00:54:06 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:06 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905645624_550.png
2025-09-27 00:54:06 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:06 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:06 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:06 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905646215_756.png
2025-09-27 00:54:06 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905646215_756.png
2025-09-27 00:54:06 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:06 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905646215_756.png
2025-09-27 00:54:08 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_b3855f8dff83e17fbde161d837e18db3.png (大小: 1130992 字节)
2025-09-27 00:54:08 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_b3855f8dff83e17fbde161d837e18db3.png
2025-09-27 00:54:08 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_b3855f8dff83e17fbde161d837e18db3.png
2025-09-27 00:54:08 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_b3855f8dff83e17fbde161d837e18db3.png
2025-09-27 00:54:08 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_b3855f8dff83e17fbde161d837e18db3.png
2025-09-27 00:54:08 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:08 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=127 choice='背靠城墙静立，以刀尖点地稳住身形，观察暗道内动静' text_length=246
2025-09-27 00:54:08 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=127 choice='背靠城墙静立，以刀尖点地稳住身形，观察暗道内动静'
2025-09-27 00:54:08 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=130 parent=127 choice='背靠城墙静立，以刀尖点地稳住身形，观察暗道内动静'
2025-09-27 00:54:08 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=130 image_url=http://127.0.0.1:8000/static/generated/ai_gen_b3855f8dff83e17fbde161d837e18db3.png
2025-09-27 00:54:08 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=130 depth=1
2025-09-27 00:54:08 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=130 completed, triggered next level depth=1
2025-09-27 00:54:08 | INFO     | core.speculation:_run_pipeline:100 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=11 node=130
2025-09-27 00:54:09 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 801
2025-09-27 00:54:09 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 154
2025-09-27 00:54:09 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:09 | WARNING  | core.image_service:_extract_image_url:138 - 无法从AI响应中提取图像URL: Here's an image that captures the dramatic scene you described: 

|>

|>I'm just a language model and can't help with that.

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-27 00:54:09 | WARNING  | core.image_service:generate_image_realtime:105 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL，降级到随机图库
2025-09-27 00:54:09 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 00:54:09 | INFO     | core.image_service:get_random_image_from_library:59 - [ImageLibrary] ✅ 随机选择图片: background1.jpg
2025-09-27 00:54:09 | INFO     | core.image_service:get_random_image_from_library:60 - [ImageLibrary] 🎯 返回图片URL: http://127.0.0.1:8000/static/background1.jpg
2025-09-27 00:54:09 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/background1.jpg
2025-09-27 00:54:09 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=128 choice='用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门' text_length=235
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=128 choice='用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门'
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=131 parent=128 choice='用刀尖挑起一片雪片，轻轻投向守卫脚边，借其惊跳时趁机夺门'
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=131 image_url=http://127.0.0.1:8000/static/background1.jpg
2025-09-27 00:54:09 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=131 depth=1
2025-09-27 00:54:09 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=131 completed, triggered next level depth=1
2025-09-27 00:54:09 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_f292194d2dda9d632517526626733ed4.png (大小: 1448314 字节)
2025-09-27 00:54:09 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f292194d2dda9d632517526626733ed4.png
2025-09-27 00:54:09 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f292194d2dda9d632517526626733ed4.png
2025-09-27 00:54:09 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_f292194d2dda9d632517526626733ed4.png
2025-09-27 00:54:09 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_f292194d2dda9d632517526626733ed4.png
2025-09-27 00:54:09 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=127 choice='纵身跃入烟尘，借爆炸余波冲向暗道深处' text_length=251
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=127 choice='纵身跃入烟尘，借爆炸余波冲向暗道深处'
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=132 parent=127 choice='纵身跃入烟尘，借爆炸余波冲向暗道深处'
2025-09-27 00:54:09 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=132 image_url=http://127.0.0.1:8000/static/generated/ai_gen_f292194d2dda9d632517526626733ed4.png
2025-09-27 00:54:09 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=132 depth=1
2025-09-27 00:54:09 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=132 completed, triggered next level depth=1
2025-09-27 00:54:11 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:11 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:11 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:11 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905650262_626.png
2025-09-27 00:54:11 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905650262_626.png
2025-09-27 00:54:11 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:11 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905650262_626.png
2025-09-27 00:54:12 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:12 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:12 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:12 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905651523_296.png
2025-09-27 00:54:12 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905651523_296.png
2025-09-27 00:54:12 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:12 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905651523_296.png
2025-09-27 00:54:12 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:12 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:12 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:12 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905651864_209.png
2025-09-27 00:54:12 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905651864_209.png
2025-09-27 00:54:12 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:12 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905651864_209.png
2025-09-27 00:54:13 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:13 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:13 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:13 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905652495_781.png
2025-09-27 00:54:13 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905652495_781.png
2025-09-27 00:54:13 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:13 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905652495_781.png
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_46c38ec0298edd863a961fb4e140b312.png (大小: 1541952 字节)
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_46c38ec0298edd863a961fb4e140b312.png
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_46c38ec0298edd863a961fb4e140b312.png
2025-09-27 00:54:14 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_46c38ec0298edd863a961fb4e140b312.png
2025-09-27 00:54:14 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_46c38ec0298edd863a961fb4e140b312.png
2025-09-27 00:54:14 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=128 choice='解下披风，故意让风卷起一角，引守卫目光，趁其回头查看时疾步潜入' text_length=227
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=128 choice='解下披风，故意让风卷起一角，引守卫目光，趁其回头查看时疾步潜入'
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=133 parent=128 choice='解下披风，故意让风卷起一角，引守卫目光，趁其回头查看时疾步潜入'
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=133 image_url=http://127.0.0.1:8000/static/generated/ai_gen_46c38ec0298edd863a961fb4e140b312.png
2025-09-27 00:54:14 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=133 depth=1
2025-09-27 00:54:14 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=133 completed, triggered next level depth=1
2025-09-27 00:54:14 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:14 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:14 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:14 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905654080_711.png
2025-09-27 00:54:14 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905654080_711.png
2025-09-27 00:54:14 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905654080_711.png
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_78eb39385aac95eadc70dbcca8fcda33.png (大小: 1481294 字节)
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_78eb39385aac95eadc70dbcca8fcda33.png
2025-09-27 00:54:14 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_78eb39385aac95eadc70dbcca8fcda33.png
2025-09-27 00:54:14 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_78eb39385aac95eadc70dbcca8fcda33.png
2025-09-27 00:54:14 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_78eb39385aac95eadc70dbcca8fcda33.png
2025-09-27 00:54:14 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=127 choice='将战袍撕下裹住刀刃，反手掷向暗道入口，制造声响引蛇出洞' text_length=227
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=127 choice='将战袍撕下裹住刀刃，反手掷向暗道入口，制造声响引蛇出洞'
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=134 parent=127 choice='将战袍撕下裹住刀刃，反手掷向暗道入口，制造声响引蛇出洞'
2025-09-27 00:54:14 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=134 image_url=http://127.0.0.1:8000/static/generated/ai_gen_78eb39385aac95eadc70dbcca8fcda33.png
2025-09-27 00:54:14 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=134 depth=1
2025-09-27 00:54:14 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=134 completed, triggered next level depth=1
2025-09-27 00:54:15 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:54:15 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:54:15 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:54:15 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905654544_084.png
2025-09-27 00:54:15 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905654544_084.png
2025-09-27 00:54:15 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:54:15 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905654544_084.png
2025-09-27 00:54:16 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_29035370617991c2dd72bfe3160540e2.png (大小: 1615648 字节)
2025-09-27 00:54:16 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_29035370617991c2dd72bfe3160540e2.png
2025-09-27 00:54:16 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_29035370617991c2dd72bfe3160540e2.png
2025-09-27 00:54:16 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_29035370617991c2dd72bfe3160540e2.png
2025-09-27 00:54:16 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_29035370617991c2dd72bfe3160540e2.png
2025-09-27 00:54:16 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=128 choice='低声吟唱《关山月》旧曲，以音律试探守卫反应，或唤醒其故国记忆' text_length=241
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=128 choice='低声吟唱《关山月》旧曲，以音律试探守卫反应，或唤醒其故国记忆'
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=135 parent=128 choice='低声吟唱《关山月》旧曲，以音律试探守卫反应，或唤醒其故国记忆'
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=135 image_url=http://127.0.0.1:8000/static/generated/ai_gen_29035370617991c2dd72bfe3160540e2.png
2025-09-27 00:54:16 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=135 depth=1
2025-09-27 00:54:16 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=135 completed, triggered next level depth=1
2025-09-27 00:54:16 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_26fa89bb29398a9feca07d2d1bd61c9e.png (大小: 1512831 字节)
2025-09-27 00:54:16 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_26fa89bb29398a9feca07d2d1bd61c9e.png
2025-09-27 00:54:16 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_26fa89bb29398a9feca07d2d1bd61c9e.png
2025-09-27 00:54:16 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_26fa89bb29398a9feca07d2d1bd61c9e.png
2025-09-27 00:54:16 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_26fa89bb29398a9feca07d2d1bd61c9e.png
2025-09-27 00:54:16 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=129 choice='摘下护腕，用血在墙上写下‘忠义’二字，引动守卫内心动摇' text_length=253
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=129 choice='摘下护腕，用血在墙上写下‘忠义’二字，引动守卫内心动摇'
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=136 parent=129 choice='摘下护腕，用血在墙上写下‘忠义’二字，引动守卫内心动摇'
2025-09-27 00:54:16 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=136 image_url=http://127.0.0.1:8000/static/generated/ai_gen_26fa89bb29398a9feca07d2d1bd61c9e.png
2025-09-27 00:54:16 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=136 depth=1
2025-09-27 00:54:16 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=136 completed, triggered next level depth=1
2025-09-27 00:54:18 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_c724837b992466883c5722ebf20ae5d5.png (大小: 1363763 字节)
2025-09-27 00:54:18 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_c724837b992466883c5722ebf20ae5d5.png
2025-09-27 00:54:18 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_c724837b992466883c5722ebf20ae5d5.png
2025-09-27 00:54:18 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_c724837b992466883c5722ebf20ae5d5.png
2025-09-27 00:54:18 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_c724837b992466883c5722ebf20ae5d5.png
2025-09-27 00:54:18 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=129 choice='将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入' text_length=217
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=129 choice='将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入'
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=137 parent=129 choice='将青龙偃月刀插进雪地，借刀身反光诱使守卫侧目，趁其分神时翻墙而入'
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=137 image_url=http://127.0.0.1:8000/static/generated/ai_gen_c724837b992466883c5722ebf20ae5d5.png
2025-09-27 00:54:18 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=137 depth=1
2025-09-27 00:54:18 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=137 completed, triggered next level depth=1
2025-09-27 00:54:18 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_56f35b32c1b951e3b5cffa7cf2ead721.png (大小: 1392074 字节)
2025-09-27 00:54:18 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_56f35b32c1b951e3b5cffa7cf2ead721.png
2025-09-27 00:54:18 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_56f35b32c1b951e3b5cffa7cf2ead721.png
2025-09-27 00:54:18 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_56f35b32c1b951e3b5cffa7cf2ead721.png
2025-09-27 00:54:18 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_56f35b32c1b951e3b5cffa7cf2ead721.png
2025-09-27 00:54:18 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=129 choice='点燃随身火折子，将残旗投入风中，借火焰与旗帜的飘动制造混乱入口' text_length=269
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=129 choice='点燃随身火折子，将残旗投入风中，借火焰与旗帜的飘动制造混乱入口'
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=138 parent=129 choice='点燃随身火折子，将残旗投入风中，借火焰与旗帜的飘动制造混乱入口'
2025-09-27 00:54:18 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=138 image_url=http://127.0.0.1:8000/static/generated/ai_gen_56f35b32c1b951e3b5cffa7cf2ead721.png
2025-09-27 00:54:18 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=11 node=138 depth=1
2025-09-27 00:54:18 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=138 completed, triggered next level depth=1
2025-09-27 00:55:27 | INFO     | api.user:logout_current_user:128 - 用户 690161230@qq.com 已登出，token_version -> 5
2025-09-27 00:55:36 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：周瑜...
2025-09-27 00:55:36 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 00:55:36 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 9
2025-09-27 00:55:36 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 473
2025-09-27 00:55:38 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:55:38 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 882
2025-09-27 00:55:38 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 206
2025-09-27 00:55:38 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 00:55:38 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 赤壁之弈：重生周瑜, background: 公元208年，长江如血。你以周瑜之身重返历史长河，肩负扭转赤壁之战命运的使命。曹操大军压境，孙刘联盟..., quest: 在三日内凝聚孙刘联军，部署赤壁火攻计划...
2025-09-27 00:55:38 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:55:38 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:55:38 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:55:38 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '周瑜'
2025-09-27 00:55:41 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:55:41 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1367
2025-09-27 00:55:41 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=837 预览='{"text": "江风卷着残火的气息掠过赤壁断崖，周瑜立于石台之巅，手中羽扇轻颤。远处战船的轮廓在雾中若隐若现，火光映照出他凝重的侧脸。传令兵刚报来急讯：曹操水军主力已悄然调转方向，意图绕道袭我后路。此刻，若不及时截断其粮道，江东将陷入腹背受敌之局。他目光扫过沙盘上那条被标注为‘死地’的水道，忽然冷笑——这或许正是破局之机。夜色渐深，暗流涌动，而他的抉择，正将决定这场风暴的流向。", "choices": [{"option": "命人点燃烽火信号，引诱敌船误入浅滩伏击区", "summary": "以声东击西之策扰乱敌军部署", "effects": {"delta_progress": '
2025-09-27 00:55:41 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=837 预览='{"text": "江风卷着残火的气息掠过赤壁断崖，周瑜立于石台之巅，手中羽扇轻颤。远处战船的轮廓在雾中若隐若现，火光映照出他凝重的侧脸。传令兵刚报来急讯：曹操水军主力已悄然调转方向，意图绕道袭我后路。此刻，若不及时截断其粮道，江东将陷入腹背受敌之局。他目光扫过沙盘上那条被标注为‘死地’的水道，忽然冷笑——这或许正是破'
2025-09-27 00:55:41 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=837 预览='{"text": "江风卷着残火的气息掠过赤壁断崖，周瑜立于石台之巅，手中羽扇轻颤。远处战船的轮廓在雾中若隐若现，火光映照出他凝重的侧脸。传令兵刚报来急讯：曹操水军主力已悄然调转方向，意图绕道袭我后路。此刻，若不及时截断其粮道，江东将陷入腹背受敌之局。他目光扫过沙盘上那条被标注为‘死地’的水道，忽然冷笑——这或许正是破'
2025-09-27 00:55:41 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 182
2025-09-27 00:55:41 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:55:41 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 182
2025-09-27 00:55:41 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:55:41 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:55:41 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风卷着残火的气息掠过赤...
2025-09-27 00:55:41 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:55:41 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风卷着残火的气息掠过赤...
2025-09-27 00:55:57 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:55:57 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:55:57 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:55:57 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905757213_694.png
2025-09-27 00:55:57 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905757213_694.png
2025-09-27 00:55:57 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:55:57 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905757213_694.png
2025-09-27 00:56:01 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d58715d424be34273d88db802dc69fd5.png (大小: 1352537 字节)
2025-09-27 00:56:01 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:01 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:01 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:01 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:01 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 00:56:01 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=182
2025-09-27 00:56:01 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=12
2025-09-27 00:56:01 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=139
2025-09-27 00:56:01 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=139 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:01 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=139 depth=3
2025-09-27 00:56:01 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=12, node=139
2025-09-27 00:56:01 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=12
2025-09-27 00:56:01 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 00:56:01 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=139
2025-09-27 00:56:01 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=139 choice='命人点燃烽火信号，引诱敌船误入浅滩伏击区'
2025-09-27 00:56:01 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=139 choice='亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓'
2025-09-27 00:56:01 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=139 choice='命人点燃烽火信号，引诱敌船误入浅滩伏击区'
2025-09-27 00:56:01 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=139 choice='假意撤军，诱敌深入，再以火攻反制其先锋'
2025-09-27 00:56:01 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=139 choice='亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓'
2025-09-27 00:56:01 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人点燃烽火信号，引诱敌船误入浅滩伏击区
2025-09-27 00:56:01 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=139 choice='假意撤军，诱敌深入，再以火攻反制其先锋'
2025-09-27 00:56:01 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓
2025-09-27 00:56:01 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 假意撤军，诱敌深入，再以火攻反制其先锋
2025-09-27 00:56:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1557
2025-09-27 00:56:04 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=864 预览='{"text": "江面雾气如纱，战船的残影在水波中摇曳。周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然将羽扇掷于案上——火光映照出他眼中燃起的烈焰。曹操的粮船正悄然驶入水道深处，而守军只知前路凶险，却不知这‘死地’正是他布下的活局。他转身对亲卫低语：‘传令三更时分，命轻舟队沿江岸逆流而上，以鼓声为号，佯攻上游，引敌分兵。’话音未落，远处忽有异响传来——有人正从暗处靠近，靴底踏碎枯枝，脚步沉稳如刀。周瑜不动声色，指尖已扣住腰间短刃，风里似有杀意悄然逼近。", "choices": [{"option": "悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身", "summary": "以声制人，借自'
2025-09-27 00:56:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=864 预览='{"text": "江面雾气如纱，战船的残影在水波中摇曳。周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然将羽扇掷于案上——火光映照出他眼中燃起的烈焰。曹操的粮船正悄然驶入水道深处，而守军只知前路凶险，却不知这‘死地’正是他布下的活局。他转身对亲卫低语：‘传令三更时分，命轻舟队沿江岸逆流而上，以鼓声为号，佯攻上游，引敌'
2025-09-27 00:56:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=864 预览='{"text": "江面雾气如纱，战船的残影在水波中摇曳。周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然将羽扇掷于案上——火光映照出他眼中燃起的烈焰。曹操的粮船正悄然驶入水道深处，而守军只知前路凶险，却不知这‘死地’正是他布下的活局。他转身对亲卫低语：‘传令三更时分，命轻舟队沿江岸逆流而上，以鼓声为号，佯攻上游，引敌'
2025-09-27 00:56:04 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 220
2025-09-27 00:56:04 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:04 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 220
2025-09-27 00:56:04 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:04 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:04 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾气如纱，战船的残影...
2025-09-27 00:56:04 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾气如纱，战船的残影...
2025-09-27 00:56:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1564
2025-09-27 00:56:04 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=897 预览='{"text": "江雾如纱，战船的残影在水面摇曳，仿佛幽灵游荡。周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然轻笑出声。他转身拂袖，命人将三艘蒙着黑布的快舟推入江心——那是早已备好的‘鬼火船’，内藏火油与引信。夜风骤起，他低语：‘曹操以为我困于正面，却不知我已借雾布网，欲以虚实之术诱其入彀。’远处传来橹声渐近，敌军巡逻队正悄然逼近。此刻，是点燃火船，以烈焰撕裂江雾？还是静待时机，让敌军自投罗网？风中，战鼓未响，杀机已至。", "choices": [{"option": "点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾", "summary": "以火攻破敌阵，制造混乱突破口", "eff'
2025-09-27 00:56:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=897 预览='{"text": "江雾如纱，战船的残影在水面摇曳，仿佛幽灵游荡。周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然轻笑出声。他转身拂袖，命人将三艘蒙着黑布的快舟推入江心——那是早已备好的‘鬼火船’，内藏火油与引信。夜风骤起，他低语：‘曹操以为我困于正面，却不知我已借雾布网，欲以虚实之术诱其入彀。’远处传来橹声渐近，敌军'
2025-09-27 00:56:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=897 预览='{"text": "江雾如纱，战船的残影在水面摇曳，仿佛幽灵游荡。周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然轻笑出声。他转身拂袖，命人将三艘蒙着黑布的快舟推入江心——那是早已备好的‘鬼火船’，内藏火油与引信。夜风骤起，他低语：‘曹操以为我困于正面，却不知我已借雾布网，欲以虚实之术诱其入彀。’远处传来橹声渐近，敌军'
2025-09-27 00:56:04 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 204
2025-09-27 00:56:04 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:04 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 204
2025-09-27 00:56:04 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:04 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:04 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如纱，战船的残影在水...
2025-09-27 00:56:04 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如纱，战船的残影在水...
2025-09-27 00:56:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1566
2025-09-27 00:56:05 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=896 预览='{"text": "江面雾气如纱，战船的轮廓在暗流中缓缓移动，周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然低笑出声。他掷下羽扇，青丝随风拂动，眼中燃起决绝之火——曹操以为此路不通，却不知正是天赐奇兵。他转身命人点燃三支狼烟，又取出一卷浸透桐油的帛书，轻轻置于火盆之上。火焰腾起的刹那，他望向远方，仿佛已听见敌军粮车碾过泥泞的声响。此刻，若能以火为信、以夜为刃，便可将这‘死地’化作血路。而真正的风暴，才刚刚开始酝酿。", "choices": [{"option": "命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营", "summary": "以火为引，制造混乱，打乱敌方部署", "ef'
2025-09-27 00:56:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=896 预览='{"text": "江面雾气如纱，战船的轮廓在暗流中缓缓移动，周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然低笑出声。他掷下羽扇，青丝随风拂动，眼中燃起决绝之火——曹操以为此路不通，却不知正是天赐奇兵。他转身命人点燃三支狼烟，又取出一卷浸透桐油的帛书，轻轻置于火盆之上。火焰腾起的刹那，他望向远方，仿佛已听见敌军粮车碾'
2025-09-27 00:56:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=896 预览='{"text": "江面雾气如纱，战船的轮廓在暗流中缓缓移动，周瑜凝视着沙盘上那条被标记为‘死地’的水道，忽然低笑出声。他掷下羽扇，青丝随风拂动，眼中燃起决绝之火——曹操以为此路不通，却不知正是天赐奇兵。他转身命人点燃三支狼烟，又取出一卷浸透桐油的帛书，轻轻置于火盆之上。火焰腾起的刹那，他望向远方，仿佛已听见敌军粮车碾'
2025-09-27 00:56:05 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 200
2025-09-27 00:56:05 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:05 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 200
2025-09-27 00:56:05 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:05 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:05 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾气如纱，战船的轮廓...
2025-09-27 00:56:05 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:05 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾气如纱，战船的轮廓...
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 周瑜...
2025-09-27 00:56:07 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 00:56:07 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:-4976116688606650150
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=12, node=139
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=12, node_id=139
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=12, node_id=139
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 182, 选择数: 3, 图片: http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:475 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:484 - [Start] 📁 [图片文件检查] 文件存在: True, 大小: 1352537字节, 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:492 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=12, node=139
2025-09-27 00:56:07 | INFO     | api.story:start_new_story:494 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:07 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d58715d424be34273d88db802dc69fd5.png exists=True size=1352537
2025-09-27 00:56:07 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:07 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 00:56:19 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:19 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:19 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905778558_526.png
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905778558_526.png
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:19 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905778558_526.png
2025-09-27 00:56:19 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:19 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:19 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905777482_815.png
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905777482_815.png
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:19 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905777482_815.png
2025-09-27 00:56:19 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:19 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:19 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905779124_767.png
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905779124_767.png
2025-09-27 00:56:19 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:19 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905779124_767.png
2025-09-27 00:56:21 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png (大小: 1360830 字节)
2025-09-27 00:56:21 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:21 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:21 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:21 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:21 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=139 choice='亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓' text_length=204
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=139 choice='亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓'
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=140 parent=139 choice='亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓'
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=140 image_url=http://127.0.0.1:8000/static/generated/ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:21 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=140 depth=2
2025-09-27 00:56:21 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=140 completed, triggered next level depth=2
2025-09-27 00:56:21 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=140
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=140 choice='点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾'
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=140 choice='命人伪装成曹军溃兵，混入敌营探听虚实'
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=140 choice='点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾'
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=140 choice='静候潮汐更替，利用暗流将敌军引向浅滩埋伏'
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=140 choice='命人伪装成曹军溃兵，混入敌营探听虚实'
2025-09-27 00:56:21 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾
2025-09-27 00:56:21 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=140 choice='静候潮汐更替，利用暗流将敌军引向浅滩埋伏'
2025-09-27 00:56:21 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人伪装成曹军溃兵，混入敌营探听虚实
2025-09-27 00:56:21 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 静候潮汐更替，利用暗流将敌军引向浅滩埋伏
2025-09-27 00:56:22 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_539717b00ded0e2457a9457b870be318.png (大小: 1337561 字节)
2025-09-27 00:56:22 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_539717b00ded0e2457a9457b870be318.png
2025-09-27 00:56:22 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_539717b00ded0e2457a9457b870be318.png
2025-09-27 00:56:22 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_539717b00ded0e2457a9457b870be318.png
2025-09-27 00:56:22 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_539717b00ded0e2457a9457b870be318.png
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=139 choice='命人点燃烽火信号，引诱敌船误入浅滩伏击区' text_length=220
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=139 choice='命人点燃烽火信号，引诱敌船误入浅滩伏击区'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=141 parent=139 choice='命人点燃烽火信号，引诱敌船误入浅滩伏击区'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=141 image_url=http://127.0.0.1:8000/static/generated/ai_gen_539717b00ded0e2457a9457b870be318.png
2025-09-27 00:56:22 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=141 depth=2
2025-09-27 00:56:22 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=141 completed, triggered next level depth=2
2025-09-27 00:56:22 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=141
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=141 choice='悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=141 choice='故意松开衣襟，露出腰间玉佩，引对方误判身份'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=141 choice='悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=141 choice='猛然起身，挥袖点燃火把，高声呼喝‘敌袭’以乱其心'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=141 choice='故意松开衣襟，露出腰间玉佩，引对方误判身份'
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=141 choice='猛然起身，挥袖点燃火把，高声呼喝‘敌袭’以乱其心'
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 故意松开衣襟，露出腰间玉佩，引对方误判身份
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 猛然起身，挥袖点燃火把，高声呼喝‘敌袭’以乱其心
2025-09-27 00:56:22 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_1b6401306838ec3bcf77c7c8e186a404.png (大小: 1127588 字节)
2025-09-27 00:56:22 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_1b6401306838ec3bcf77c7c8e186a404.png
2025-09-27 00:56:22 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1b6401306838ec3bcf77c7c8e186a404.png
2025-09-27 00:56:22 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_1b6401306838ec3bcf77c7c8e186a404.png
2025-09-27 00:56:22 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_1b6401306838ec3bcf77c7c8e186a404.png
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=139 choice='假意撤军，诱敌深入，再以火攻反制其先锋' text_length=200
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=139 choice='假意撤军，诱敌深入，再以火攻反制其先锋'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=142 parent=139 choice='假意撤军，诱敌深入，再以火攻反制其先锋'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=142 image_url=http://127.0.0.1:8000/static/generated/ai_gen_1b6401306838ec3bcf77c7c8e186a404.png
2025-09-27 00:56:22 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=142 depth=2
2025-09-27 00:56:22 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=142 completed, triggered next level depth=2
2025-09-27 00:56:22 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=142
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=142 choice='命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=142 choice='亲率轻舟队沿暗河潜行，用鱼皮筏子避开巡逻船，直插敌军补给线'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=142 choice='命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=142 choice='写一封假信伪装成降书，诱使敌将派兵接收，再于途中设伏歼灭'
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=142 choice='亲率轻舟队沿暗河潜行，用鱼皮筏子避开巡逻船，直插敌军补给线'
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营
2025-09-27 00:56:22 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=142 choice='写一封假信伪装成降书，诱使敌将派兵接收，再于途中设伏歼灭'
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率轻舟队沿暗河潜行，用鱼皮筏子避开巡逻船，直插敌军补给线
2025-09-27 00:56:22 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 写一封假信伪装成降书，诱使敌将派兵接收，再于途中设伏歼灭
2025-09-27 00:56:24 | INFO     | api.story:continue_existing_story:514 - 收到故事继续请求，选择: 亲率精锐小舟，夜潜敌后水道，直接焚毁其粮仓
2025-09-27 00:56:24 | INFO     | api.story:continue_existing_story:558 - [NodeReady] 检查节点完整性：node_id=140
2025-09-27 00:56:24 | INFO     | api.story:_wait_for_node_complete:126 - [NodeComplete] 开始等待节点完全准备：node_id=140
2025-09-27 00:56:24 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] ✅ 节点完全准备就绪：node_id=140 (等待了 0.0 秒)
2025-09-27 00:56:24 | INFO     | api.story:continue_existing_story:561 - [NodeReady] ✅ 节点完全准备就绪：node_id=140
2025-09-27 00:56:24 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png exists=True size=1360830
2025-09-27 00:56:24 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:24 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1746
2025-09-27 00:56:25 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=843 预览='{"text": "江雾如墨，三艘蒙黑布的快舟悄然破浪而行，周瑜立于船首，披风猎猎。他目光如刃，穿透浓雾，直指敌军后方那座隐于山坳的粮仓。火油桶在舱底轻响，引信已备，只待一瞬点燃。夜风送来远处更鼓声，巡逻队正从东南方向靠近。他低喝一声：‘点火！’——可就在此刻，前方水道骤然出现数盏灯笼，敌军哨兵已设伏。火船若现，必遭围剿；若退，粮仓将成铁壁。他眯眼凝视，指尖划过羽扇边缘，忽然冷笑：‘既然你们想看火，那便让这江心，燃成一座祭坛。’", "choices": [{"option": "命人弃舟潜入芦苇丛，借水草掩护逼近粮仓外围", "summary": "利用自然地形规避正面冲突，伺机突袭", "'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=843 预览='{"text": "江雾如墨，三艘蒙黑布的快舟悄然破浪而行，周瑜立于船首，披风猎猎。他目光如刃，穿透浓雾，直指敌军后方那座隐于山坳的粮仓。火油桶在舱底轻响，引信已备，只待一瞬点燃。夜风送来远处更鼓声，巡逻队正从东南方向靠近。他低喝一声：‘点火！’——可就在此刻，前方水道骤然出现数盏灯笼，敌军哨兵已设伏。火船若现，必遭围'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=843 预览='{"text": "江雾如墨，三艘蒙黑布的快舟悄然破浪而行，周瑜立于船首，披风猎猎。他目光如刃，穿透浓雾，直指敌军后方那座隐于山坳的粮仓。火油桶在舱底轻响，引信已备，只待一瞬点燃。夜风送来远处更鼓声，巡逻队正从东南方向靠近。他低喝一声：‘点火！’——可就在此刻，前方水道骤然出现数盏灯笼，敌军哨兵已设伏。火船若现，必遭围'
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 206
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 206
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，三艘蒙黑布的快...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，三艘蒙黑布的快...
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1780
2025-09-27 00:56:25 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=868 预览='{"text": "江雾如墨，三艘蒙黑布的快舟悄然破浪而行，周瑜立于船首，披风猎猎。他目光如刃，穿透浓雾，直指敌军后方那座隐于山坳的粮仓。火油桶在舱底轻响，引信已备，只待一瞬点燃。夜风送来远处更鼓声，守卫换班的间隙尚余半刻。他低喝一声，令水手收桨，以木枝轻拨江面，借水流无声推进。船身如游鱼滑入死水湾，岸边芦苇丛中，隐约可见巡哨身影。此刻，是趁其不备，以火船撞入粮仓，纵火焚营？还是潜伏至近，以短刃逐个清除守卒，再引火自燃？江心暗流涌动，胜负只在一念之间。", "choices": [{"option": "点燃火船，借江流之势猛冲粮仓，以烈焰撕裂夜幕", "summary": "雷霆一击，以火势'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=868 预览='{"text": "江雾如墨，三艘蒙黑布的快舟悄然破浪而行，周瑜立于船首，披风猎猎。他目光如刃，穿透浓雾，直指敌军后方那座隐于山坳的粮仓。火油桶在舱底轻响，引信已备，只待一瞬点燃。夜风送来远处更鼓声，守卫换班的间隙尚余半刻。他低喝一声，令水手收桨，以木枝轻拨江面，借水流无声推进。船身如游鱼滑入死水湾，岸边芦苇丛中，隐约'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=868 预览='{"text": "江雾如墨，三艘蒙黑布的快舟悄然破浪而行，周瑜立于船首，披风猎猎。他目光如刃，穿透浓雾，直指敌军后方那座隐于山坳的粮仓。火油桶在舱底轻响，引信已备，只待一瞬点燃。夜风送来远处更鼓声，守卫换班的间隙尚余半刻。他低喝一声，令水手收桨，以木枝轻拨江面，借水流无声推进。船身如游鱼滑入死水湾，岸边芦苇丛中，隐约'
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 218
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 218
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，三艘蒙黑布的快...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，三艘蒙黑布的快...
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1786
2025-09-27 00:56:25 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=885 预览='{"text": "烽火台的火焰骤然腾起，赤红如血划破夜幕，三道火光在江岸连成弧线，直指那条被称作‘死地’的浅滩。周瑜立于高台，目光如刃扫过敌船行进轨迹——曹操的粮船果然中计，船队缓缓驶入水道狭窄处，桅杆碰撞声渐次响起。暗流之下，埋伏已久的弓弩手已悄然就位，只待一声令下。然而，就在火光映照的刹那，江心深处传来金属摩擦的异响，一艘黑影船从雾中浮现，船首刻着‘曹’字金纹，竟似早有预谋。周瑜瞳孔微缩，手中羽扇猛然一震——这并非诱敌之局，而是一场更深的反制。", "choices": [{"option": "命鼓手改击急鼓，催动伏兵突袭，不惜暴露主力位置", "summary": "以雷霆之势击溃敌'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=885 预览='{"text": "烽火台的火焰骤然腾起，赤红如血划破夜幕，三道火光在江岸连成弧线，直指那条被称作‘死地’的浅滩。周瑜立于高台，目光如刃扫过敌船行进轨迹——曹操的粮船果然中计，船队缓缓驶入水道狭窄处，桅杆碰撞声渐次响起。暗流之下，埋伏已久的弓弩手已悄然就位，只待一声令下。然而，就在火光映照的刹那，江心深处传来金属摩擦的'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=885 预览='{"text": "烽火台的火焰骤然腾起，赤红如血划破夜幕，三道火光在江岸连成弧线，直指那条被称作‘死地’的浅滩。周瑜立于高台，目光如刃扫过敌船行进轨迹——曹操的粮船果然中计，船队缓缓驶入水道狭窄处，桅杆碰撞声渐次响起。暗流之下，埋伏已久的弓弩手已悄然就位，只待一声令下。然而，就在火光映照的刹那，江心深处传来金属摩擦的'
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 217
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 217
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 烽火台的火焰骤然腾起，赤...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 烽火台的火焰骤然腾起，赤...
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1765
2025-09-27 00:56:25 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=856 预览='{"text": "烽火台骤然腾起赤焰，如血丝撕裂夜幕。周瑜立于高台，目光如刃穿透浓雾，只见远处江面水道深处，敌船队正被这突如其来的信号引得微微偏航。火光映照下，他嘴角微扬——那‘死地’的浅滩早已埋伏了千名弓手与滚木雷石，只待敌船误入。然而就在此时，岸边芦苇丛中传来异响，数道黑影悄然逼近，似是敌方斥候察觉异常，正欲折返报信。风卷残叶，战意在寂静中悄然升温。", "choices": [{"option": "命人点燃第二道烽火，伪装成主军主力调转方向，诱使敌将轻敌冒进", "summary": "以虚张声势扰乱敌军判断，扩大伏击效果", "effects": {"delta_progress"'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=856 预览='{"text": "烽火台骤然腾起赤焰，如血丝撕裂夜幕。周瑜立于高台，目光如刃穿透浓雾，只见远处江面水道深处，敌船队正被这突如其来的信号引得微微偏航。火光映照下，他嘴角微扬——那‘死地’的浅滩早已埋伏了千名弓手与滚木雷石，只待敌船误入。然而就在此时，岸边芦苇丛中传来异响，数道黑影悄然逼近，似是敌方斥候察觉异常，正欲折返'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=856 预览='{"text": "烽火台骤然腾起赤焰，如血丝撕裂夜幕。周瑜立于高台，目光如刃穿透浓雾，只见远处江面水道深处，敌船队正被这突如其来的信号引得微微偏航。火光映照下，他嘴角微扬——那‘死地’的浅滩早已埋伏了千名弓手与滚木雷石，只待敌船误入。然而就在此时，岸边芦苇丛中传来异响，数道黑影悄然逼近，似是敌方斥候察觉异常，正欲折返'
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 169
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 169
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 烽火台骤然腾起赤焰，如血...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 烽火台骤然腾起赤焰，如血...
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1807
2025-09-27 00:56:25 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=902 预览='{"text": "江雾如墨，三艘蒙黑布的快舟如幽灵般贴着水底暗流滑行。周瑜伏在船首，羽扇轻点水面，示意停桨。前方十丈处，敌军粮仓浮于浅滩，火把交错如星阵，守卫巡弋不息。他凝视那堆高耸的粮垛，忽然低语：‘火油已备，只待一瞬之机。’风起时，他猛然挥手——三船同时松缆，借浪势疾冲而上，船尾拖出的火线如血丝划破夜色。火油桶在撞击中炸裂，烈焰腾空而起，映得江面赤红如血。敌营惊乱，鼓声骤响，但已迟了。他立于船头，长发猎猎，眼中无惧，唯有战意如刀锋般锐利。", "choices": [{"option": "点燃引信后立即调头，借浓烟掩护撤退", "summary": "趁火势未稳迅速撤离，避免被围困",'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=902 预览='{"text": "江雾如墨，三艘蒙黑布的快舟如幽灵般贴着水底暗流滑行。周瑜伏在船首，羽扇轻点水面，示意停桨。前方十丈处，敌军粮仓浮于浅滩，火把交错如星阵，守卫巡弋不息。他凝视那堆高耸的粮垛，忽然低语：‘火油已备，只待一瞬之机。’风起时，他猛然挥手——三船同时松缆，借浪势疾冲而上，船尾拖出的火线如血丝划破夜色。火油桶在'
2025-09-27 00:56:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=902 预览='{"text": "江雾如墨，三艘蒙黑布的快舟如幽灵般贴着水底暗流滑行。周瑜伏在船首，羽扇轻点水面，示意停桨。前方十丈处，敌军粮仓浮于浅滩，火把交错如星阵，守卫巡弋不息。他凝视那堆高耸的粮垛，忽然低语：‘火油已备，只待一瞬之机。’风起时，他猛然挥手——三船同时松缆，借浪势疾冲而上，船尾拖出的火线如血丝划破夜色。火油桶在'
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 214
2025-09-27 00:56:25 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 214
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:25 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，三艘蒙黑布的快...
2025-09-27 00:56:25 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，三艘蒙黑布的快...
2025-09-27 00:56:26 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:26 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1815
2025-09-27 00:56:26 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=921 预览='{"text": "烽火台骤然腾起赤焰，如血染天际。周瑜立于高台，目送信号升空，火光映照出他冷峻的侧脸。远处江面，敌船果然被引动，船队如游鱼般驶向浅滩区域——那正是他布下的铁索连环阵与水底陷坑的交汇点。鼓声渐密，伏兵已悄然潜伏于两岸芦苇深处，只待敌船触礁。然而就在此时，一阵急促马蹄声自后方疾驰而来，一名斥候跌落马背，嘶喊着：‘将军！上游有异动，敌军正以轻舟佯攻我左翼，意图诱我分兵！’风中传来隐约号角，仿佛两面夹击的杀机已悄然合拢。周瑜凝视着火光与战影交织的江面，指尖轻抚羽扇边缘——真正的风暴，才刚刚开始。", "choices": [{"option": "命人调转火光方向，佯装主力在右翼，诱'
2025-09-27 00:56:26 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=921 预览='{"text": "烽火台骤然腾起赤焰，如血染天际。周瑜立于高台，目送信号升空，火光映照出他冷峻的侧脸。远处江面，敌船果然被引动，船队如游鱼般驶向浅滩区域——那正是他布下的铁索连环阵与水底陷坑的交汇点。鼓声渐密，伏兵已悄然潜伏于两岸芦苇深处，只待敌船触礁。然而就在此时，一阵急促马蹄声自后方疾驰而来，一名斥候跌落马背，嘶'
2025-09-27 00:56:26 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=921 预览='{"text": "烽火台骤然腾起赤焰，如血染天际。周瑜立于高台，目送信号升空，火光映照出他冷峻的侧脸。远处江面，敌船果然被引动，船队如游鱼般驶向浅滩区域——那正是他布下的铁索连环阵与水底陷坑的交汇点。鼓声渐密，伏兵已悄然潜伏于两岸芦苇深处，只待敌船触礁。然而就在此时，一阵急促马蹄声自后方疾驰而来，一名斥候跌落马背，嘶'
2025-09-27 00:56:26 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 245
2025-09-27 00:56:26 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:26 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 245
2025-09-27 00:56:26 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:26 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:26 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 烽火台骤然腾起赤焰，如血...
2025-09-27 00:56:26 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:26 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 烽火台骤然腾起赤焰，如血...
2025-09-27 00:56:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1786
2025-09-27 00:56:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=918 预览='{"text": "江面雾霭如墨，战船的影子在暗流中缓缓漂移。周瑜立于船头，目光如炬，手中羽扇轻挥，仿佛已将敌军动向尽收眼底。他下令全军撤退，旌旗低垂，战鼓渐歇，只余水波轻拍船舷的声响。远处曹军先锋果然中计，误以为江东溃败，急令追击，粮车辎重尽数暴露于夜色之中。周瑜嘴角微扬，命人点燃早已埋伏于两岸芦苇丛中的火油桶。刹那间，烈焰腾空而起，映红半边江天，火蛇吞吐间，敌军阵型大乱，惨叫与翻船声交织成一片。然而，火势蔓延之快，远超预期，连我方部分斥候船也险些被卷入——这把火，既是利刃，也是双刃。", "choices": [{"option": "命人砍断浮桥，截断敌军退路，逼其困于火海", "sum'
2025-09-27 00:56:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=918 预览='{"text": "江面雾霭如墨，战船的影子在暗流中缓缓漂移。周瑜立于船头，目光如炬，手中羽扇轻挥，仿佛已将敌军动向尽收眼底。他下令全军撤退，旌旗低垂，战鼓渐歇，只余水波轻拍船舷的声响。远处曹军先锋果然中计，误以为江东溃败，急令追击，粮车辎重尽数暴露于夜色之中。周瑜嘴角微扬，命人点燃早已埋伏于两岸芦苇丛中的火油桶。刹那'
2025-09-27 00:56:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=918 预览='{"text": "江面雾霭如墨，战船的影子在暗流中缓缓漂移。周瑜立于船头，目光如炬，手中羽扇轻挥，仿佛已将敌军动向尽收眼底。他下令全军撤退，旌旗低垂，战鼓渐歇，只余水波轻拍船舷的声响。远处曹军先锋果然中计，误以为江东溃败，急令追击，粮车辎重尽数暴露于夜色之中。周瑜嘴角微扬，命人点燃早已埋伏于两岸芦苇丛中的火油桶。刹那'
2025-09-27 00:56:28 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 236
2025-09-27 00:56:28 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:28 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 236
2025-09-27 00:56:28 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:28 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:28 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾霭如墨，战船的影子...
2025-09-27 00:56:28 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾霭如墨，战船的影子...
2025-09-27 00:56:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1798
2025-09-27 00:56:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=931 预览='{"text": "江雾如墨，战船的轮廓在暗流中缓缓游移，周瑜立于高台，火光映照着他冷峻的侧脸。他轻挥羽扇，指向那条被标注为‘死地’的水道——此刻，正是诱敌入彀的最佳时机。他命人将三支狼烟点燃，火光冲天而起，又令亲兵假意撤军，旌旗飘摇、鼓声渐远，仿佛江东大军已溃不成军。夜风卷起残甲，江面泛起涟漪，曹操先锋果然中计，水军大部顺流而下，直扑虚设的粮仓空营。周瑜嘴角微扬，指尖划过沙盘上那道死路，眼中燃起焚天之火：以退为进，以静制动，待其深入，便以火攻断其归路。", "choices": [{"option": "命精锐潜入下游密林，用浸油的草堆引燃江心浮筏，制造连环火海", "summary": "'
2025-09-27 00:56:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=931 预览='{"text": "江雾如墨，战船的轮廓在暗流中缓缓游移，周瑜立于高台，火光映照着他冷峻的侧脸。他轻挥羽扇，指向那条被标注为‘死地’的水道——此刻，正是诱敌入彀的最佳时机。他命人将三支狼烟点燃，火光冲天而起，又令亲兵假意撤军，旌旗飘摇、鼓声渐远，仿佛江东大军已溃不成军。夜风卷起残甲，江面泛起涟漪，曹操先锋果然中计，水军'
2025-09-27 00:56:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=931 预览='{"text": "江雾如墨，战船的轮廓在暗流中缓缓游移，周瑜立于高台，火光映照着他冷峻的侧脸。他轻挥羽扇，指向那条被标注为‘死地’的水道——此刻，正是诱敌入彀的最佳时机。他命人将三支狼烟点燃，火光冲天而起，又令亲兵假意撤军，旌旗飘摇、鼓声渐远，仿佛江东大军已溃不成军。夜风卷起残甲，江面泛起涟漪，曹操先锋果然中计，水军'
2025-09-27 00:56:28 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 219
2025-09-27 00:56:28 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:28 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 219
2025-09-27 00:56:28 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:28 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:28 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，战船的轮廓在暗...
2025-09-27 00:56:28 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江雾如墨，战船的轮廓在暗...
2025-09-27 00:56:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 00:56:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1756
2025-09-27 00:56:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=869 预览='{"text": "江面雾气如沸，战船的轮廓在暗流中缓缓移动，周瑜立于断崖石台，羽扇轻挥，火光映照出他眼底的锐利。他已命人将三支狼烟点燃，烽火信号如血丝般刺破夜幕——那是诱敌深入的密令。水道深处，早已埋伏着浸透桐油的火船，只待敌军先锋踏入死地。他转身望向沙盘，指尖轻点那条被标记为‘死地’的水道，低声道：‘曹操，你若来，便让你尝尝这‘绝路’的滋味。’风起时，芦苇丛中传来窸窣声响，仿佛有无数幽魂在低语，预示着一场烈焰焚天的奇谋即将开启。", "choices": [{"option": "命亲兵伪装溃兵，沿江岸疾奔引敌军追击", "summary": "以假乱真，制造混乱诱敌入局", "effec'
2025-09-27 00:56:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=869 预览='{"text": "江面雾气如沸，战船的轮廓在暗流中缓缓移动，周瑜立于断崖石台，羽扇轻挥，火光映照出他眼底的锐利。他已命人将三支狼烟点燃，烽火信号如血丝般刺破夜幕——那是诱敌深入的密令。水道深处，早已埋伏着浸透桐油的火船，只待敌军先锋踏入死地。他转身望向沙盘，指尖轻点那条被标记为‘死地’的水道，低声道：‘曹操，你若来，'
2025-09-27 00:56:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=869 预览='{"text": "江面雾气如沸，战船的轮廓在暗流中缓缓移动，周瑜立于断崖石台，羽扇轻挥，火光映照出他眼底的锐利。他已命人将三支狼烟点燃，烽火信号如血丝般刺破夜幕——那是诱敌深入的密令。水道深处，早已埋伏着浸透桐油的火船，只待敌军先锋踏入死地。他转身望向沙盘，指尖轻点那条被标记为‘死地’的水道，低声道：‘曹操，你若来，'
2025-09-27 00:56:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 208
2025-09-27 00:56:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 00:56:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 208
2025-09-27 00:56:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 00:56:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 00:56:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾气如沸，战船的轮廓...
2025-09-27 00:56:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 00:56:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江面雾气如沸，战船的轮廓...
2025-09-27 00:56:37 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:37 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:37 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:37 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905797360_980.png
2025-09-27 00:56:37 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905797360_980.png
2025-09-27 00:56:37 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:37 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905797360_980.png
2025-09-27 00:56:38 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:38 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:38 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905797570_562.png
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905797570_562.png
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:38 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905797570_562.png
2025-09-27 00:56:38 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:38 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:38 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905797895_919.png
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905797895_919.png
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:38 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905797895_919.png
2025-09-27 00:56:38 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:38 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:38 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905798249_493.png
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905798249_493.png
2025-09-27 00:56:38 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:38 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905798249_493.png
2025-09-27 00:56:39 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:39 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:39 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:39 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905798810_590.png
2025-09-27 00:56:39 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905798810_590.png
2025-09-27 00:56:39 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:39 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905798810_590.png
2025-09-27 00:56:40 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:40 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:40 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:40 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905799859_202.png
2025-09-27 00:56:40 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905799859_202.png
2025-09-27 00:56:40 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:40 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905799859_202.png
2025-09-27 00:56:40 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_1a0ab069cec61b2a7c7a08221ed0cdf5.png (大小: 769398 字节)
2025-09-27 00:56:40 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_1a0ab069cec61b2a7c7a08221ed0cdf5.png
2025-09-27 00:56:40 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1a0ab069cec61b2a7c7a08221ed0cdf5.png
2025-09-27 00:56:40 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_1a0ab069cec61b2a7c7a08221ed0cdf5.png
2025-09-27 00:56:40 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_1a0ab069cec61b2a7c7a08221ed0cdf5.png
2025-09-27 00:56:40 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:40 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=141 choice='悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身' text_length=169
2025-09-27 00:56:40 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=141 choice='悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身'
2025-09-27 00:56:40 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=143 parent=141 choice='悄然伏于石后，以竹哨模仿夜枭鸣叫，诱敌现身'
2025-09-27 00:56:40 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=143 image_url=http://127.0.0.1:8000/static/generated/ai_gen_1a0ab069cec61b2a7c7a08221ed0cdf5.png
2025-09-27 00:56:40 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=143 depth=1
2025-09-27 00:56:40 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=143 completed, triggered next level depth=1
2025-09-27 00:56:40 | INFO     | core.speculation:_run_pipeline:100 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=12 node=143
2025-09-27 00:56:41 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_ff47b8f37226056b40466eb87ca7c014.png (大小: 959146 字节)
2025-09-27 00:56:41 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_ff47b8f37226056b40466eb87ca7c014.png
2025-09-27 00:56:41 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ff47b8f37226056b40466eb87ca7c014.png
2025-09-27 00:56:41 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_ff47b8f37226056b40466eb87ca7c014.png
2025-09-27 00:56:41 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_ff47b8f37226056b40466eb87ca7c014.png
2025-09-27 00:56:41 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=141 choice='猛然起身，挥袖点燃火把，高声呼喝‘敌袭’以乱其心' text_length=217
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=141 choice='猛然起身，挥袖点燃火把，高声呼喝‘敌袭’以乱其心'
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=144 parent=141 choice='猛然起身，挥袖点燃火把，高声呼喝‘敌袭’以乱其心'
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=144 image_url=http://127.0.0.1:8000/static/generated/ai_gen_ff47b8f37226056b40466eb87ca7c014.png
2025-09-27 00:56:41 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=144 depth=1
2025-09-27 00:56:41 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=144 completed, triggered next level depth=1
2025-09-27 00:56:41 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_38d11bf0ae8a19ed74814e4af39338d9.png (大小: 1150265 字节)
2025-09-27 00:56:41 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_38d11bf0ae8a19ed74814e4af39338d9.png
2025-09-27 00:56:41 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_38d11bf0ae8a19ed74814e4af39338d9.png
2025-09-27 00:56:41 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_38d11bf0ae8a19ed74814e4af39338d9.png
2025-09-27 00:56:41 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_38d11bf0ae8a19ed74814e4af39338d9.png
2025-09-27 00:56:41 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=140 choice='点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾' text_length=206
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=140 choice='点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾'
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=145 parent=140 choice='点燃鬼火船，趁夜色突袭敌军前锋，以烈焰撕裂江雾'
2025-09-27 00:56:41 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=145 image_url=http://127.0.0.1:8000/static/generated/ai_gen_38d11bf0ae8a19ed74814e4af39338d9.png
2025-09-27 00:56:41 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=145 depth=1
2025-09-27 00:56:41 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=145 completed, triggered next level depth=1
2025-09-27 00:56:42 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_f3ad69a71d1fd032ff6bf64d64f20e06.png (大小: 753661 字节)
2025-09-27 00:56:42 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f3ad69a71d1fd032ff6bf64d64f20e06.png
2025-09-27 00:56:42 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f3ad69a71d1fd032ff6bf64d64f20e06.png
2025-09-27 00:56:42 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_f3ad69a71d1fd032ff6bf64d64f20e06.png
2025-09-27 00:56:42 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_f3ad69a71d1fd032ff6bf64d64f20e06.png
2025-09-27 00:56:42 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=140 choice='静候潮汐更替，利用暗流将敌军引向浅滩埋伏' text_length=218
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=140 choice='静候潮汐更替，利用暗流将敌军引向浅滩埋伏'
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=146 parent=140 choice='静候潮汐更替，利用暗流将敌军引向浅滩埋伏'
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=146 image_url=http://127.0.0.1:8000/static/generated/ai_gen_f3ad69a71d1fd032ff6bf64d64f20e06.png
2025-09-27 00:56:42 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=146 depth=1
2025-09-27 00:56:42 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=146 completed, triggered next level depth=1
2025-09-27 00:56:42 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_899ef3c3d098eff3d0952b05210d0463.png (大小: 1286785 字节)
2025-09-27 00:56:42 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_899ef3c3d098eff3d0952b05210d0463.png
2025-09-27 00:56:42 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_899ef3c3d098eff3d0952b05210d0463.png
2025-09-27 00:56:42 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_899ef3c3d098eff3d0952b05210d0463.png
2025-09-27 00:56:42 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_899ef3c3d098eff3d0952b05210d0463.png
2025-09-27 00:56:42 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=140 choice='命人伪装成曹军溃兵，混入敌营探听虚实' text_length=214
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=140 choice='命人伪装成曹军溃兵，混入敌营探听虚实'
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=147 parent=140 choice='命人伪装成曹军溃兵，混入敌营探听虚实'
2025-09-27 00:56:42 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=147 image_url=http://127.0.0.1:8000/static/generated/ai_gen_899ef3c3d098eff3d0952b05210d0463.png
2025-09-27 00:56:42 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=147 depth=1
2025-09-27 00:56:42 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=147 completed, triggered next level depth=1
2025-09-27 00:56:44 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:44 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:44 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:44 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905803388_396.png
2025-09-27 00:56:44 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905803388_396.png
2025-09-27 00:56:44 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:44 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905803388_396.png
2025-09-27 00:56:44 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:44 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:44 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:44 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905804346_410.png
2025-09-27 00:56:44 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905804346_410.png
2025-09-27 00:56:44 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:44 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905804346_410.png
2025-09-27 00:56:45 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_5b833efa314987fbf0a05ca9104776d9.png (大小: 1411919 字节)
2025-09-27 00:56:45 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_5b833efa314987fbf0a05ca9104776d9.png
2025-09-27 00:56:45 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_5b833efa314987fbf0a05ca9104776d9.png
2025-09-27 00:56:45 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_5b833efa314987fbf0a05ca9104776d9.png
2025-09-27 00:56:45 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_5b833efa314987fbf0a05ca9104776d9.png
2025-09-27 00:56:45 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:45 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=141 choice='故意松开衣襟，露出腰间玉佩，引对方误判身份' text_length=245
2025-09-27 00:56:45 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=141 choice='故意松开衣襟，露出腰间玉佩，引对方误判身份'
2025-09-27 00:56:45 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=148 parent=141 choice='故意松开衣襟，露出腰间玉佩，引对方误判身份'
2025-09-27 00:56:45 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=148 image_url=http://127.0.0.1:8000/static/generated/ai_gen_5b833efa314987fbf0a05ca9104776d9.png
2025-09-27 00:56:45 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=148 depth=1
2025-09-27 00:56:45 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=148 completed, triggered next level depth=1
2025-09-27 00:56:45 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 00:56:45 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 00:56:45 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 00:56:45 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758905804455_069.png
2025-09-27 00:56:45 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758905804455_069.png
2025-09-27 00:56:45 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 00:56:45 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758905804455_069.png
2025-09-27 00:56:46 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_1be4213fee3d062c292fc5ebc7458aec.png (大小: 1193464 字节)
2025-09-27 00:56:46 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_1be4213fee3d062c292fc5ebc7458aec.png
2025-09-27 00:56:46 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1be4213fee3d062c292fc5ebc7458aec.png
2025-09-27 00:56:46 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_1be4213fee3d062c292fc5ebc7458aec.png
2025-09-27 00:56:46 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_1be4213fee3d062c292fc5ebc7458aec.png
2025-09-27 00:56:46 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:46 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=142 choice='亲率轻舟队沿暗河潜行，用鱼皮筏子避开巡逻船，直插敌军补给线' text_length=219
2025-09-27 00:56:46 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=142 choice='亲率轻舟队沿暗河潜行，用鱼皮筏子避开巡逻船，直插敌军补给线'
2025-09-27 00:56:46 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=149 parent=142 choice='亲率轻舟队沿暗河潜行，用鱼皮筏子避开巡逻船，直插敌军补给线'
2025-09-27 00:56:46 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=149 image_url=http://127.0.0.1:8000/static/generated/ai_gen_1be4213fee3d062c292fc5ebc7458aec.png
2025-09-27 00:56:46 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=149 depth=1
2025-09-27 00:56:46 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=149 completed, triggered next level depth=1
2025-09-27 00:56:48 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_a272fc4c6779a8074a07893422632759.png (大小: 1354079 字节)
2025-09-27 00:56:48 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_a272fc4c6779a8074a07893422632759.png
2025-09-27 00:56:48 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_a272fc4c6779a8074a07893422632759.png
2025-09-27 00:56:48 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_a272fc4c6779a8074a07893422632759.png
2025-09-27 00:56:48 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_a272fc4c6779a8074a07893422632759.png
2025-09-27 00:56:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=142 choice='写一封假信伪装成降书，诱使敌将派兵接收，再于途中设伏歼灭' text_length=236
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=142 choice='写一封假信伪装成降书，诱使敌将派兵接收，再于途中设伏歼灭'
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=150 parent=142 choice='写一封假信伪装成降书，诱使敌将派兵接收，再于途中设伏歼灭'
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=150 image_url=http://127.0.0.1:8000/static/generated/ai_gen_a272fc4c6779a8074a07893422632759.png
2025-09-27 00:56:48 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=150 depth=1
2025-09-27 00:56:48 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=150 completed, triggered next level depth=1
2025-09-27 00:56:48 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_c0ef896b3dee1d1269f0a309cc19fe01.png (大小: 1517830 字节)
2025-09-27 00:56:48 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_c0ef896b3dee1d1269f0a309cc19fe01.png
2025-09-27 00:56:48 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_c0ef896b3dee1d1269f0a309cc19fe01.png
2025-09-27 00:56:48 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_c0ef896b3dee1d1269f0a309cc19fe01.png
2025-09-27 00:56:48 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_c0ef896b3dee1d1269f0a309cc19fe01.png
2025-09-27 00:56:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=142 choice='命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营' text_length=208
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=142 choice='命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营'
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=151 parent=142 choice='命亲兵点燃烽火，借浓烟误导敌军视线，趁乱突袭其前哨营'
2025-09-27 00:56:48 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=151 image_url=http://127.0.0.1:8000/static/generated/ai_gen_c0ef896b3dee1d1269f0a309cc19fe01.png
2025-09-27 00:56:48 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=12 node=151 depth=1
2025-09-27 00:56:48 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=151 completed, triggered next level depth=1
2025-09-27 12:55:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 12:55:21 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 12:55:22 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 12:55:22 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 12:55:22 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 12:55:22 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 12:55:22 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 12:55:22 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 12:55:22 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 12:55:22 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 12:55:22 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 12:55:22 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 12:55:22 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 12:55:22 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 12:55:22 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 12:55:22 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 12:55:22 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 12:55:22 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 12:55:22 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 12:55:22 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 12:55:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 12:55:23 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 12:55:23 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 12:55:23 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 12:55:23 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 12:55:23 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 12:55:57 | INFO     | api.story:prepare_start_level:264 - [PrepareStart] 🚀 开始生成故事概要，愿望：刘邦...
2025-09-27 12:55:57 | DEBUG    | api.story:prepare_start_level:266 - [PrepareStart] 构建提示词上下文...
2025-09-27 12:55:57 | DEBUG    | api.story:prepare_start_level:268 - [PrepareStart] 上下文构建完成，推荐章节数: 11
2025-09-27 12:55:57 | INFO     | api.story:prepare_start_level:275 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 509
2025-09-27 12:55:59 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:55:59 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 923
2025-09-27 12:55:59 | INFO     | api.story:prepare_start_level:277 - [PrepareStart] ✅ LLM响应完成，响应长度: 203
2025-09-27 12:55:59 | INFO     | api.story:prepare_start_level:304 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 12:55:59 | DEBUG    | api.story:prepare_start_level:316 - [PrepareStart] 解析结果 - title: 草根起兵：沛县风云, background: 秦末暴政，天下大乱。你身为沛县亭长，目睹百姓流离，心中暗涌帝王之志。项羽崛起于江东，刘邦初露锋芒。鸿..., quest: 在十日内集结三支义军，夺取沛县控制权...
2025-09-27 12:55:59 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 12:55:59 | INFO     | api.story:prepare_start_level:348 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 12:55:59 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 12:55:59 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘邦'
2025-09-27 12:56:03 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:03 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1445
2025-09-27 12:56:03 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=909 预览='{"text": "夜色如墨，咸阳城外的烽火台只剩残烬。刘邦立于高坡，披风猎猎，目光扫过远处项羽军营的灯火。韩信刚送来密报：章邯暗中联络魏国旧部，意图反扑关中。他眯眼凝思，手中竹简轻叩掌心——这天下不是靠蛮力争来的，而是用人心一寸寸拼出来的。远处传来马蹄声，一名斥候翻身下马，跪地禀报：‘主公，沛县老父病重，托人捎来家书，说想见您最后一面。’刘邦手指微顿，眼中闪过一丝痛楚，随即又归于沉静。他知道，此刻若回乡，便是向天下昭示自己软弱；可若不归，又如何安将士之心？风卷起战旗，仿佛在催促抉择。", "choices": [{"option": "命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’",'
2025-09-27 12:56:03 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=909 预览='{"text": "夜色如墨，咸阳城外的烽火台只剩残烬。刘邦立于高坡，披风猎猎，目光扫过远处项羽军营的灯火。韩信刚送来密报：章邯暗中联络魏国旧部，意图反扑关中。他眯眼凝思，手中竹简轻叩掌心——这天下不是靠蛮力争来的，而是用人心一寸寸拼出来的。远处传来马蹄声，一名斥候翻身下马，跪地禀报：‘主公，沛县老父病重，托人捎来家书'
2025-09-27 12:56:03 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=909 预览='{"text": "夜色如墨，咸阳城外的烽火台只剩残烬。刘邦立于高坡，披风猎猎，目光扫过远处项羽军营的灯火。韩信刚送来密报：章邯暗中联络魏国旧部，意图反扑关中。他眯眼凝思，手中竹简轻叩掌心——这天下不是靠蛮力争来的，而是用人心一寸寸拼出来的。远处传来马蹄声，一名斥候翻身下马，跪地禀报：‘主公，沛县老父病重，托人捎来家书'
2025-09-27 12:56:03 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 235
2025-09-27 12:56:03 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:03 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 235
2025-09-27 12:56:03 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:03 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 12:56:03 | INFO     | core.image_storage:__init__:29 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 12:56:03 | INFO     | core.image_storage:__init__:30 - 图像web访问前缀: http://127.0.0.1:8000/static/generated
2025-09-27 12:56:03 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:03 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，咸阳城外的烽火...
2025-09-27 12:56:03 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:03 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，咸阳城外的烽火...
2025-09-27 12:56:07 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1221
2025-09-27 12:56:07 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 588
2025-09-27 12:56:07 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:07 | WARNING  | core.image_service:_extract_image_url:138 - 无法从AI响应中提取图像URL: I will create a cinematic and atmospheric image depicting Liu Bang standing on a high坡 at night, his cloak billowing in the wind. The remnants of a beacon tower will be visible, and in the distance, t...
2025-09-27 12:56:07 | WARNING  | core.image_service:generate_image_realtime:105 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL，降级到随机图库
2025-09-27 12:56:07 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 12:56:07 | INFO     | core.image_service:get_random_image_from_library:59 - [ImageLibrary] ✅ 随机选择图片: rebirth_gate_placeholder.png
2025-09-27 12:56:07 | INFO     | core.image_service:get_random_image_from_library:60 - [ImageLibrary] 🎯 返回图片URL: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:07 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:07 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 12:56:07 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=235
2025-09-27 12:56:07 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=13
2025-09-27 12:56:07 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=152
2025-09-27 12:56:07 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=152 image_url=http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:07 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=152 depth=3
2025-09-27 12:56:07 | INFO     | api.story:_background_generate_with_pregeneration:100 - [预生成] 已触发speculation预生成: session=13, node=152
2025-09-27 12:56:07 | INFO     | api.story:_background_generate_with_pregeneration:102 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=13
2025-09-27 12:56:07 | DEBUG    | api.story:_background_generate_with_pregeneration:114 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 12:56:07 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=152
2025-09-27 12:56:07 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=152 choice='命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’'
2025-09-27 12:56:07 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=152 choice='悄悄遣心腹送信回乡，附上亲笔字条‘待平定四海，必归故里’'
2025-09-27 12:56:07 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=152 choice='命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’'
2025-09-27 12:56:07 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=152 choice='召来张良与萧何，借酒酣畅议论‘忠孝难两全’，试探群臣态度'
2025-09-27 12:56:07 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=152 choice='悄悄遣心腹送信回乡，附上亲笔字条‘待平定四海，必归故里’'
2025-09-27 12:56:07 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’
2025-09-27 12:56:07 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=152 choice='召来张良与萧何，借酒酣畅议论‘忠孝难两全’，试探群臣态度'
2025-09-27 12:56:07 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄悄遣心腹送信回乡，附上亲笔字条‘待平定四海，必归故里’
2025-09-27 12:56:07 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 召来张良与萧何，借酒酣畅议论‘忠孝难两全’，试探群臣态度
2025-09-27 12:56:11 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:11 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1663
2025-09-27 12:56:11 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=915 预览='{"text": "夜风卷起刘邦的衣角，他凝视着那封泛黄的家书，指尖轻轻抚过‘父病危’三字。远处项羽军营的火光忽明忽暗，仿佛在嘲笑着他的犹豫。韩信的密报还在袖中发烫，而沛县的老父，正躺在床榻上等一个儿子的回望。他缓缓将家书折成纸鹤，抛向风中——那不是放弃，而是将思念化作信使。他转身对亲卫低语：‘传令三军，明日寅时整军，开赴河内。’随即又补一句：‘另遣心腹，以‘旧部探亲’为由，悄悄送信回沛县，就说……我已命人照料老父。’风声骤紧，战旗猎猎如怒涛，仿佛天地都在等待这一瞬的决断。", "choices": [{"option": "命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言"'
2025-09-27 12:56:11 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=915 预览='{"text": "夜风卷起刘邦的衣角，他凝视着那封泛黄的家书，指尖轻轻抚过‘父病危’三字。远处项羽军营的火光忽明忽暗，仿佛在嘲笑着他的犹豫。韩信的密报还在袖中发烫，而沛县的老父，正躺在床榻上等一个儿子的回望。他缓缓将家书折成纸鹤，抛向风中——那不是放弃，而是将思念化作信使。他转身对亲卫低语：‘传令三军，明日寅时整军，'
2025-09-27 12:56:11 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=915 预览='{"text": "夜风卷起刘邦的衣角，他凝视着那封泛黄的家书，指尖轻轻抚过‘父病危’三字。远处项羽军营的火光忽明忽暗，仿佛在嘲笑着他的犹豫。韩信的密报还在袖中发烫，而沛县的老父，正躺在床榻上等一个儿子的回望。他缓缓将家书折成纸鹤，抛向风中——那不是放弃，而是将思念化作信使。他转身对亲卫低语：‘传令三军，明日寅时整军，'
2025-09-27 12:56:11 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 229
2025-09-27 12:56:11 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:11 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 229
2025-09-27 12:56:11 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:11 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:11 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的衣角，他凝...
2025-09-27 12:56:11 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:11 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的衣角，他凝...
2025-09-27 12:56:11 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:11 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1669
2025-09-27 12:56:11 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=924 预览='{"text": "风卷残烬，火光在刘邦眉间跳动。家书在掌心被揉成一团，又缓缓展开。他望着远处魏地的烽烟，忽然轻笑一声：‘老父若见我，定会说‘儿啊，别忘了你从泥里爬出来的样子’。’他转身对亲卫道：‘传令三军，今夜子时，全营篝火不熄，粮草照常发放——让章邯的人以为我已松懈。’随即抽出佩剑，在沙地上划出一道虚线，指向沛县方向，又猛然折返，直指项羽大营。‘人心如水，能载舟亦能覆舟。我回乡，不是逃，是让天下人知道，刘邦不是铁打的将军，也是会疼的凡人。’战马嘶鸣，他勒缰回望，眼中已有决意。", "choices": [{"option": "命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐'
2025-09-27 12:56:11 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=924 预览='{"text": "风卷残烬，火光在刘邦眉间跳动。家书在掌心被揉成一团，又缓缓展开。他望着远处魏地的烽烟，忽然轻笑一声：‘老父若见我，定会说‘儿啊，别忘了你从泥里爬出来的样子’。’他转身对亲卫道：‘传令三军，今夜子时，全营篝火不熄，粮草照常发放——让章邯的人以为我已松懈。’随即抽出佩剑，在沙地上划出一道虚线，指向沛县方'
2025-09-27 12:56:11 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=924 预览='{"text": "风卷残烬，火光在刘邦眉间跳动。家书在掌心被揉成一团，又缓缓展开。他望着远处魏地的烽烟，忽然轻笑一声：‘老父若见我，定会说‘儿啊，别忘了你从泥里爬出来的样子’。’他转身对亲卫道：‘传令三军，今夜子时，全营篝火不熄，粮草照常发放——让章邯的人以为我已松懈。’随即抽出佩剑，在沙地上划出一道虚线，指向沛县方'
2025-09-27 12:56:11 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 232
2025-09-27 12:56:11 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:11 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 232
2025-09-27 12:56:11 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:11 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:11 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残烬，火光在刘邦眉间...
2025-09-27 12:56:11 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:11 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残烬，火光在刘邦眉间...
2025-09-27 12:56:12 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:12 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1681
2025-09-27 12:56:12 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=959 预览='{"text": "风卷残烬，烽火台的灰烬在夜色中如星点飘散。刘邦凝视着手中那封泛黄家书，指尖微微颤抖。他缓缓将信纸折成一只纸鹤，轻轻一掷，任其随风飞向远方——那是他对故土最后的回应。他转身对亲卫低语：‘传令三军，今夜子时，全营熄灯，只留东南角一盏孤灯。’又命人取来一坛烈酒，当众饮尽，仰天长笑：‘父病在床，儿岂能不归？可这天下，岂容一人之私而乱乾坤？’笑声未落，已下令整军待发，剑指关中。韩信立于侧，目光深邃，仿佛已窥见那场即将席卷八荒的风暴。", "choices": [{"option": "命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望", "summar'
2025-09-27 12:56:12 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=959 预览='{"text": "风卷残烬，烽火台的灰烬在夜色中如星点飘散。刘邦凝视着手中那封泛黄家书，指尖微微颤抖。他缓缓将信纸折成一只纸鹤，轻轻一掷，任其随风飞向远方——那是他对故土最后的回应。他转身对亲卫低语：‘传令三军，今夜子时，全营熄灯，只留东南角一盏孤灯。’又命人取来一坛烈酒，当众饮尽，仰天长笑：‘父病在床，儿岂能不归？'
2025-09-27 12:56:12 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=959 预览='{"text": "风卷残烬，烽火台的灰烬在夜色中如星点飘散。刘邦凝视着手中那封泛黄家书，指尖微微颤抖。他缓缓将信纸折成一只纸鹤，轻轻一掷，任其随风飞向远方——那是他对故土最后的回应。他转身对亲卫低语：‘传令三军，今夜子时，全营熄灯，只留东南角一盏孤灯。’又命人取来一坛烈酒，当众饮尽，仰天长笑：‘父病在床，儿岂能不归？'
2025-09-27 12:56:12 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 213
2025-09-27 12:56:12 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:12 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 213
2025-09-27 12:56:12 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:12 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:12 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残烬，烽火台的灰烬在...
2025-09-27 12:56:12 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:12 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残烬，烽火台的灰烬在...
2025-09-27 12:56:23 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1249
2025-09-27 12:56:23 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 612
2025-09-27 12:56:23 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:23 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758948982744_961.png
2025-09-27 12:56:23 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758948982744_961.png
2025-09-27 12:56:23 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:23 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758948982744_961.png
2025-09-27 12:56:25 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 12:56:25 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:25 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758948984554_456.png
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758948984554_456.png
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:25 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758948984554_456.png
2025-09-27 12:56:25 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1076
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 439
2025-09-27 12:56:25 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:25 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758948984567_400.png
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758948984567_400.png
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:25 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758948984567_400.png
2025-09-27 12:56:25 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_e63afeb011ccb29f41bba8ee60ea5461.png (大小: 1336804 字节)
2025-09-27 12:56:25 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_e63afeb011ccb29f41bba8ee60ea5461.png
2025-09-27 12:56:25 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_e63afeb011ccb29f41bba8ee60ea5461.png
2025-09-27 12:56:25 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_e63afeb011ccb29f41bba8ee60ea5461.png
2025-09-27 12:56:25 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_e63afeb011ccb29f41bba8ee60ea5461.png
2025-09-27 12:56:25 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=152 choice='召来张良与萧何，借酒酣畅议论‘忠孝难两全’，试探群臣态度' text_length=229
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=152 choice='召来张良与萧何，借酒酣畅议论‘忠孝难两全’，试探群臣态度'
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=153 parent=152 choice='召来张良与萧何，借酒酣畅议论‘忠孝难两全’，试探群臣态度'
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=153 image_url=http://127.0.0.1:8000/static/generated/ai_gen_e63afeb011ccb29f41bba8ee60ea5461.png
2025-09-27 12:56:25 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=153 depth=2
2025-09-27 12:56:25 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=153 completed, triggered next level depth=2
2025-09-27 12:56:25 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=153
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=153 choice='命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言'
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=153 choice='当众焚毁家书，宣称‘国事为重，孝道可暂搁’，以雷霆之威震慑军心'
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=153 choice='命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言'
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=153 choice='深夜独骑南下，不带随从，亲自走小路回沛县见父一面，再折返战场'
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=153 choice='当众焚毁家书，宣称‘国事为重，孝道可暂搁’，以雷霆之威震慑军心'
2025-09-27 12:56:25 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言
2025-09-27 12:56:25 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=153 choice='深夜独骑南下，不带随从，亲自走小路回沛县见父一面，再折返战场'
2025-09-27 12:56:25 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 当众焚毁家书，宣称‘国事为重，孝道可暂搁’，以雷霆之威震慑军心
2025-09-27 12:56:25 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 深夜独骑南下，不带随从，亲自走小路回沛县见父一面，再折返战场
2025-09-27 12:56:26 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_43c001eddd604619ae314afcc6030455.png (大小: 1349474 字节)
2025-09-27 12:56:26 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 12:56:26 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 12:56:26 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 12:56:26 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 12:56:26 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=152 choice='命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’' text_length=232
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=152 choice='命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’'
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=154 parent=152 choice='命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’'
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=154 image_url=http://127.0.0.1:8000/static/generated/ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 12:56:26 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=154 depth=2
2025-09-27 12:56:26 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=154 completed, triggered next level depth=2
2025-09-27 12:56:26 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=154
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=154 choice='命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐潜伏于故道'
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=154 choice='命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐潜伏于故道'
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=154 choice='当众焚毁家书，宣称‘孝道在心，不在形迹’，以此激励将士共赴国难'
2025-09-27 12:56:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐潜伏于故道
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=154 choice='只带两名亲信，伪装成商队连夜启程，借道魏地秘密返回故乡'
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=154 choice='当众焚毁家书，宣称‘孝道在心，不在形迹’，以此激励将士共赴国难'
2025-09-27 12:56:26 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=154 choice='只带两名亲信，伪装成商队连夜启程，借道魏地秘密返回故乡'
2025-09-27 12:56:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 当众焚毁家书，宣称‘孝道在心，不在形迹’，以此激励将士共赴国难
2025-09-27 12:56:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 只带两名亲信，伪装成商队连夜启程，借道魏地秘密返回故乡
2025-09-27 12:56:28 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d34c771ab2c788d8cb9ce1f3b2c491a0.png (大小: 1301814 字节)
2025-09-27 12:56:28 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d34c771ab2c788d8cb9ce1f3b2c491a0.png
2025-09-27 12:56:28 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d34c771ab2c788d8cb9ce1f3b2c491a0.png
2025-09-27 12:56:28 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d34c771ab2c788d8cb9ce1f3b2c491a0.png
2025-09-27 12:56:28 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d34c771ab2c788d8cb9ce1f3b2c491a0.png
2025-09-27 12:56:28 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=152 choice='悄悄遣心腹送信回乡，附上亲笔字条‘待平定四海，必归故里’' text_length=213
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=152 choice='悄悄遣心腹送信回乡，附上亲笔字条‘待平定四海，必归故里’'
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=155 parent=152 choice='悄悄遣心腹送信回乡，附上亲笔字条‘待平定四海，必归故里’'
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=155 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d34c771ab2c788d8cb9ce1f3b2c491a0.png
2025-09-27 12:56:28 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=155 depth=2
2025-09-27 12:56:28 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=155 completed, triggered next level depth=2
2025-09-27 12:56:28 | DEBUG    | core.speculation:_generate_children_pipeline:197 - [Speculation] pipeline generating 3 children for node=155
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=155 choice='命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望'
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=155 choice='亲率百骑假扮商队，趁夜潜入沛县，只为在父亲临终前握一次手'
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=155 choice='命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望'
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:224 - [Speculation] 开始生成故事+图像块：parent=155 choice='将家书焚于篝火，当众宣布：‘我刘季无父无母，唯有天下苍生是吾亲！’'
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=155 choice='亲率百骑假扮商队，趁夜潜入沛县，只为在父亲临终前握一次手'
2025-09-27 12:56:28 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望
2025-09-27 12:56:28 | INFO     | core.speculation:_generate_child_node:231 - [Speculation] 第1阶段-故事生成开始：parent=155 choice='将家书焚于篝火，当众宣布：‘我刘季无父无母，唯有天下苍生是吾亲！’'
2025-09-27 12:56:28 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率百骑假扮商队，趁夜潜入沛县，只为在父亲临终前握一次手
2025-09-27 12:56:28 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将家书焚于篝火，当众宣布：‘我刘季无父无母，唯有天下苍生是吾亲！’
2025-09-27 12:56:29 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:29 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1867
2025-09-27 12:56:29 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=887 预览='{"text": "夜色如铁，篝火在营帐间摇曳，映得张良眉目如画，萧何执卷凝神。刘邦将酒樽重重顿在石案上，声如闷雷：‘父病危，子当归；国事急，君难退。诸公以为，忠孝可两全否？’话音未落，风卷残烬，飞入酒盏，泛起一圈涟漪。张良轻抚袖中竹简，目光如刀剖开虚言；萧何缓缓合书，眼中闪过一丝悲悯。两人对视一眼，竟不答，反相视而笑。笑声如裂帛，惊起宿鸟。刘邦心头一震——他们不是在回避，而是在等他开口。这沉默，比千言万语更重。", "choices": [{"option": "突然起身，将家书掷入火中，高声宣告：‘今日起，我以天下为亲！’", "summary": "以决绝姿态立威，重塑君臣信念", "e'
2025-09-27 12:56:29 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=887 预览='{"text": "夜色如铁，篝火在营帐间摇曳，映得张良眉目如画，萧何执卷凝神。刘邦将酒樽重重顿在石案上，声如闷雷：‘父病危，子当归；国事急，君难退。诸公以为，忠孝可两全否？’话音未落，风卷残烬，飞入酒盏，泛起一圈涟漪。张良轻抚袖中竹简，目光如刀剖开虚言；萧何缓缓合书，眼中闪过一丝悲悯。两人对视一眼，竟不答，反相视而笑'
2025-09-27 12:56:29 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=887 预览='{"text": "夜色如铁，篝火在营帐间摇曳，映得张良眉目如画，萧何执卷凝神。刘邦将酒樽重重顿在石案上，声如闷雷：‘父病危，子当归；国事急，君难退。诸公以为，忠孝可两全否？’话音未落，风卷残烬，飞入酒盏，泛起一圈涟漪。张良轻抚袖中竹简，目光如刀剖开虚言；萧何缓缓合书，眼中闪过一丝悲悯。两人对视一眼，竟不答，反相视而笑'
2025-09-27 12:56:29 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 198
2025-09-27 12:56:29 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:29 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 198
2025-09-27 12:56:29 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:29 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:29 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，篝火在营帐间摇...
2025-09-27 12:56:29 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:29 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如铁，篝火在营帐间摇...
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1892
2025-09-27 12:56:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=923 预览='{"text": "篝火映红了军帐，张良执壶斟酒，眉间凝着深思；萧何低头摩挲竹简，指节微白。刘邦举杯，声音低沉如夜风：‘父病危，我却在千里之外，这忠与孝，究竟该向谁低头？’话音未落，火光跳动，帐外传来战马嘶鸣。张良轻叹，将酒盏推至案心：‘主公若为私情折腰，天下人便知您亦有软肋。’萧何忽而抬头，眼中锐光一闪：‘但若不归，沛县百姓会说，您连骨肉都不顾。’两人对视，沉默如铁。刘邦缓缓起身，袍角扫过地图上那条蜿蜒的渭水——他忽然笑了，笑声在风中裂开一道口子，仿佛要撕碎所有犹豫。", "choices": [{"option": "命人连夜抄写家书，亲笔附言‘吾心已赴关中，魂归故里’，让信使秘密送往沛县'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=923 预览='{"text": "篝火映红了军帐，张良执壶斟酒，眉间凝着深思；萧何低头摩挲竹简，指节微白。刘邦举杯，声音低沉如夜风：‘父病危，我却在千里之外，这忠与孝，究竟该向谁低头？’话音未落，火光跳动，帐外传来战马嘶鸣。张良轻叹，将酒盏推至案心：‘主公若为私情折腰，天下人便知您亦有软肋。’萧何忽而抬头，眼中锐光一闪：‘但若不归，'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=923 预览='{"text": "篝火映红了军帐，张良执壶斟酒，眉间凝着深思；萧何低头摩挲竹简，指节微白。刘邦举杯，声音低沉如夜风：‘父病危，我却在千里之外，这忠与孝，究竟该向谁低头？’话音未落，火光跳动，帐外传来战马嘶鸣。张良轻叹，将酒盏推至案心：‘主公若为私情折腰，天下人便知您亦有软肋。’萧何忽而抬头，眼中锐光一闪：‘但若不归，'
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 227
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 227
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火映红了军帐，张良执壶...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火映红了军帐，张良执壶...
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1855
2025-09-27 12:56:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=884 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲、化灰，青烟如叹息般升腾。刘邦立于火前，声音沉稳而清晰：‘为天下苍生，暂别亲情。’三军肃立，风卷战旗，仿佛天地也为之动容。远处章邯的斥候已窥见此景，悄然退去。韩信站在暗处，眸光微闪，低声对身旁亲兵道：‘主公这一把火，烧的不是信，是人心。’夜色深重，沛县方向的星火渐隐，而项羽大营的灯火却忽然熄了半数——有人在试探，也有人在观望。刘邦凝望天际，轻声道：‘他们以为我在演戏，可我演的，是未来。’", "choices": [{"option": "命人连夜绘制一幅‘孝子归乡图’悬于军营，暗示自己即将返乡探亲", "summary": "以虚招诱敌，制造'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=884 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲、化灰，青烟如叹息般升腾。刘邦立于火前，声音沉稳而清晰：‘为天下苍生，暂别亲情。’三军肃立，风卷战旗，仿佛天地也为之动容。远处章邯的斥候已窥见此景，悄然退去。韩信站在暗处，眸光微闪，低声对身旁亲兵道：‘主公这一把火，烧的不是信，是人心。’夜色深重，沛县方向的星火渐隐，而'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=884 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲、化灰，青烟如叹息般升腾。刘邦立于火前，声音沉稳而清晰：‘为天下苍生，暂别亲情。’三军肃立，风卷战旗，仿佛天地也为之动容。远处章邯的斥候已窥见此景，悄然退去。韩信站在暗处，眸光微闪，低声对身旁亲兵道：‘主公这一把火，烧的不是信，是人心。’夜色深重，沛县方向的星火渐隐，而'
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 210
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 210
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火噼啪作响，家书在烈焰...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火噼啪作响，家书在烈焰...
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1922
2025-09-27 12:56:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=957 预览='{"text": "夜风拂过营帐，烛火摇曳如心跳。刘邦命人摆上烈酒，召张良与萧何入席，三人围坐于军案前。他举杯轻笑：‘父病危，子归乡，此乃天理人情。然天下未定，我若回沛县，岂非向项羽示弱？’张良饮尽一杯，眸光微闪，低语：‘忠孝难两全，不如以‘国事为重’之名，行私情之实。’萧何则凝视杯中残酒，缓缓道：‘若传令回乡，将士必疑主公心有旁骛；若不归，又恐寒了人心。’话音未落，帐外传来更鼓声，似在催促抉择。刘邦静坐良久，忽然将酒杯重重顿下——这局，不是问群臣，而是看他们如何破局。", "choices": [{"option": "命人将家书焚于篝火，当众宣称‘国事为重，亲情暂搁’，借仪式感凝聚军心",'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=957 预览='{"text": "夜风拂过营帐，烛火摇曳如心跳。刘邦命人摆上烈酒，召张良与萧何入席，三人围坐于军案前。他举杯轻笑：‘父病危，子归乡，此乃天理人情。然天下未定，我若回沛县，岂非向项羽示弱？’张良饮尽一杯，眸光微闪，低语：‘忠孝难两全，不如以‘国事为重’之名，行私情之实。’萧何则凝视杯中残酒，缓缓道：‘若传令回乡，将士必'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=957 预览='{"text": "夜风拂过营帐，烛火摇曳如心跳。刘邦命人摆上烈酒，召张良与萧何入席，三人围坐于军案前。他举杯轻笑：‘父病危，子归乡，此乃天理人情。然天下未定，我若回沛县，岂非向项羽示弱？’张良饮尽一杯，眸光微闪，低语：‘忠孝难两全，不如以‘国事为重’之名，行私情之实。’萧何则凝视杯中残酒，缓缓道：‘若传令回乡，将士必'
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 227
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 227
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风拂过营帐，烛火摇曳如...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风拂过营帐，烛火摇曳如...
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1912
2025-09-27 12:56:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=953 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲成灰，如一片飘散的旧梦。刘邦立于火前，声音沉稳如钟：‘为天下苍生，暂别亲情。’风卷起残烬，扑向夜空，仿佛万千亡魂低语。将士们静默伫立，有人低头拭泪，有人攥紧刀柄。远处魏地的烽烟依旧明灭，而项羽大营的灯火，似乎也微微一颤。韩信悄然上前，目光深邃：‘主公此举，已将人心织入战局——既显悲悯，又铸铁心。’刘邦凝望火光尽头，轻声道：‘人若无情，何以得天下？可若全凭私情，又如何渡万民于水火？’他转身披上战袍，马蹄声渐近，一场以情为刃、以义为盾的棋局，正悄然展开。", "choices": [{"option": "命人连夜将家书抄录百份，分发给各营士卒，附'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=953 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲成灰，如一片飘散的旧梦。刘邦立于火前，声音沉稳如钟：‘为天下苍生，暂别亲情。’风卷起残烬，扑向夜空，仿佛万千亡魂低语。将士们静默伫立，有人低头拭泪，有人攥紧刀柄。远处魏地的烽烟依旧明灭，而项羽大营的灯火，似乎也微微一颤。韩信悄然上前，目光深邃：‘主公此举，已将人心织入战'
2025-09-27 12:56:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=953 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲成灰，如一片飘散的旧梦。刘邦立于火前，声音沉稳如钟：‘为天下苍生，暂别亲情。’风卷起残烬，扑向夜空，仿佛万千亡魂低语。将士们静默伫立，有人低头拭泪，有人攥紧刀柄。远处魏地的烽烟依旧明灭，而项羽大营的灯火，似乎也微微一颤。韩信悄然上前，目光深邃：‘主公此举，已将人心织入战'
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 242
2025-09-27 12:56:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 242
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火噼啪作响，家书在烈焰...
2025-09-27 12:56:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火噼啪作响，家书在烈焰...
2025-09-27 12:56:31 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:31 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1914
2025-09-27 12:56:31 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=957 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲、化灰，灰烬如蝶般飞向夜空。刘邦立于火前，声音低沉却穿透风声：‘为天下苍生，暂别亲情。’将士们默然伫立，有人低头拭泪，有人握紧刀柄。远处魏地的烽火忽明忽暗，仿佛在回应这句誓言。韩信快马疾驰而来，目光扫过火堆，低声道：‘章邯已遣密使入赵，与张耳暗通款曲。若此时分兵，或可断其首尾。’刘邦凝视火光，忽然转身，将佩剑插入沙地，剑柄朝北——那是通往沛县的方向。他轻声道：‘传令下去，明日寅时，全军拔营，佯攻河内，实则绕道太行，直取安邑。让章邯以为我心乱如麻，却不知我早已布下天罗地网。’风卷残烬，战旗猎猎，仿佛天地都在倾听这位草根帝王的布局。", "choi'
2025-09-27 12:56:31 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=957 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲、化灰，灰烬如蝶般飞向夜空。刘邦立于火前，声音低沉却穿透风声：‘为天下苍生，暂别亲情。’将士们默然伫立，有人低头拭泪，有人握紧刀柄。远处魏地的烽火忽明忽暗，仿佛在回应这句誓言。韩信快马疾驰而来，目光扫过火堆，低声道：‘章邯已遣密使入赵，与张耳暗通款曲。若此时分兵，或可断'
2025-09-27 12:56:31 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=957 预览='{"text": "篝火噼啪作响，家书在烈焰中蜷曲、化灰，灰烬如蝶般飞向夜空。刘邦立于火前，声音低沉却穿透风声：‘为天下苍生，暂别亲情。’将士们默然伫立，有人低头拭泪，有人握紧刀柄。远处魏地的烽火忽明忽暗，仿佛在回应这句誓言。韩信快马疾驰而来，目光扫过火堆，低声道：‘章邯已遣密使入赵，与张耳暗通款曲。若此时分兵，或可断'
2025-09-27 12:56:31 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 282
2025-09-27 12:56:31 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:31 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 282
2025-09-27 12:56:31 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:31 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:31 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火噼啪作响，家书在烈焰...
2025-09-27 12:56:31 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:31 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 篝火噼啪作响，家书在烈焰...
2025-09-27 12:56:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1897
2025-09-27 12:56:34 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=941 预览='{"text": "夜风卷起残旗，刘邦将那封家书轻轻置于火盆边缘，任其边缘泛黄蜷曲。他凝视火焰吞没字迹，忽然低语：‘父在，儿未归；天下定，方能还。’随即命亲信取来密函，以朱砂写就‘待平定四海，必归故里’八字，封入竹筒，交由一名老卒背负。那老卒身形佝偻，却步履沉稳，如影子般隐入林间。刘邦望着他远去的背影，嘴角微扬，仿佛已听见故乡炊烟升起的声音。然而，就在他转身欲回营时，一缕异香飘来——是楚军惯用的迷魂香。远处树影晃动，似有细作潜伏。这封信若被截，便是动摇军心之机；若不发，则失信于民。天边一道流星划过，仿佛在为这场无声的博弈点灯。", "choices": [{"option": "命人伪装成商队'
2025-09-27 12:56:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=941 预览='{"text": "夜风卷起残旗，刘邦将那封家书轻轻置于火盆边缘，任其边缘泛黄蜷曲。他凝视火焰吞没字迹，忽然低语：‘父在，儿未归；天下定，方能还。’随即命亲信取来密函，以朱砂写就‘待平定四海，必归故里’八字，封入竹筒，交由一名老卒背负。那老卒身形佝偻，却步履沉稳，如影子般隐入林间。刘邦望着他远去的背影，嘴角微扬，仿佛已'
2025-09-27 12:56:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=941 预览='{"text": "夜风卷起残旗，刘邦将那封家书轻轻置于火盆边缘，任其边缘泛黄蜷曲。他凝视火焰吞没字迹，忽然低语：‘父在，儿未归；天下定，方能还。’随即命亲信取来密函，以朱砂写就‘待平定四海，必归故里’八字，封入竹筒，交由一名老卒背负。那老卒身形佝偻，却步履沉稳，如影子般隐入林间。刘邦望着他远去的背影，嘴角微扬，仿佛已'
2025-09-27 12:56:34 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 256
2025-09-27 12:56:34 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:34 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 256
2025-09-27 12:56:34 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:34 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:34 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残旗，刘邦将那封...
2025-09-27 12:56:34 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:34 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起残旗，刘邦将那封...
2025-09-27 12:56:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1911
2025-09-27 12:56:34 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=937 预览='{"text": "夜风卷起刘邦的披风，他将那封家书轻轻置于火盆边缘，火舌舔舐纸页，字迹在灰烬中渐渐消融。他凝视着跳动的火焰，低声自语：‘待平定四海，必归故里。’随即唤来心腹密使，亲手将一枚刻有‘汉’字的铜符交予对方，命其昼伏夜行，绕道函谷关，以旧部密线为引，悄然送信至沛县。临行前，刘邦从怀中取出一缕青丝——那是幼时母亲系在他腕间的发带，轻轻系于信囊之上。‘若父尚在，见此物，便知儿未忘根。’风声渐紧，远处军营的更鼓响起，三更已过。韩信立于暗影中，目光如炬，似已察觉这隐秘的举动，却未出声。他知道，这一纸承诺，既是温情，也是刀锋上的誓言。", "choices": [{"option": "命人假'
2025-09-27 12:56:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=937 预览='{"text": "夜风卷起刘邦的披风，他将那封家书轻轻置于火盆边缘，火舌舔舐纸页，字迹在灰烬中渐渐消融。他凝视着跳动的火焰，低声自语：‘待平定四海，必归故里。’随即唤来心腹密使，亲手将一枚刻有‘汉’字的铜符交予对方，命其昼伏夜行，绕道函谷关，以旧部密线为引，悄然送信至沛县。临行前，刘邦从怀中取出一缕青丝——那是幼时母'
2025-09-27 12:56:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=937 预览='{"text": "夜风卷起刘邦的披风，他将那封家书轻轻置于火盆边缘，火舌舔舐纸页，字迹在灰烬中渐渐消融。他凝视着跳动的火焰，低声自语：‘待平定四海，必归故里。’随即唤来心腹密使，亲手将一枚刻有‘汉’字的铜符交予对方，命其昼伏夜行，绕道函谷关，以旧部密线为引，悄然送信至沛县。临行前，刘邦从怀中取出一缕青丝——那是幼时母'
2025-09-27 12:56:34 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 260
2025-09-27 12:56:34 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:34 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 260
2025-09-27 12:56:34 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:34 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:34 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的披风，他将...
2025-09-27 12:56:34 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:34 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的披风，他将...
2025-09-27 12:56:35 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 12:56:35 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1850
2025-09-27 12:56:35 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=880 预览='{"text": "夜风穿林，刘邦将那封写满牵挂的家书折成纸鹤，轻轻一掷，任其随风飘向远方。他转身对心腹低语：‘你即刻启程，不露踪迹，只带这枚玉佩与我亲笔字条——“待平定四海，必归故里”。’那人伏地领命，身影如影般隐入黑暗。刘邦立于高坡，仰望星河，眉间仍凝着一丝难掩的痛楚。他知此行若败，父骨未寒便已成孤坟；可若胜，终有重逢之日。远处传来更鼓声，三军已整，只等号令。韩信立于帐前，目光沉静，似已窥见未来风云。而此刻，一封密信正悄然踏上通往沛县的夜路，承载着一个帝王的承诺与挣扎。", "choices": [{"option": "命人将纸鹤投入黄河，让流水带去故乡的回音", "summary": '
2025-09-27 12:56:35 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=880 预览='{"text": "夜风穿林，刘邦将那封写满牵挂的家书折成纸鹤，轻轻一掷，任其随风飘向远方。他转身对心腹低语：‘你即刻启程，不露踪迹，只带这枚玉佩与我亲笔字条——“待平定四海，必归故里”。’那人伏地领命，身影如影般隐入黑暗。刘邦立于高坡，仰望星河，眉间仍凝着一丝难掩的痛楚。他知此行若败，父骨未寒便已成孤坟；可若胜，终有'
2025-09-27 12:56:35 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=880 预览='{"text": "夜风穿林，刘邦将那封写满牵挂的家书折成纸鹤，轻轻一掷，任其随风飘向远方。他转身对心腹低语：‘你即刻启程，不露踪迹，只带这枚玉佩与我亲笔字条——“待平定四海，必归故里”。’那人伏地领命，身影如影般隐入黑暗。刘邦立于高坡，仰望星河，眉间仍凝着一丝难掩的痛楚。他知此行若败，父骨未寒便已成孤坟；可若胜，终有'
2025-09-27 12:56:35 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 229
2025-09-27 12:56:35 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 12:56:35 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 229
2025-09-27 12:56:35 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 12:56:35 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 12:56:35 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风穿林，刘邦将那封写满...
2025-09-27 12:56:35 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 12:56:35 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风穿林，刘邦将那封写满...
2025-09-27 12:56:39 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1323
2025-09-27 12:56:39 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 688
2025-09-27 12:56:39 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:39 | WARNING  | core.image_service:_extract_image_url:138 - 无法从AI响应中提取图像URL: I will create a cinematic and atmospheric image depicting a pivotal moment in ancient China. The scene will showcase Liu Bang at night, standing on a high坡, having just released a paper crane made fro...
2025-09-27 12:56:39 | WARNING  | core.image_service:generate_image_realtime:105 - [AIImageGen] ⚠️ 无法从AI响应中提取图像URL，降级到随机图库
2025-09-27 12:56:39 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 12:56:39 | INFO     | core.image_service:get_random_image_from_library:59 - [ImageLibrary] ✅ 随机选择图片: cyberpunk_city.jpg
2025-09-27 12:56:39 | INFO     | core.image_service:get_random_image_from_library:60 - [ImageLibrary] 🎯 返回图片URL: http://127.0.0.1:8000/static/cyberpunk_city.jpg
2025-09-27 12:56:39 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/cyberpunk_city.jpg
2025-09-27 12:56:39 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:39 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=155 choice='亲率百骑假扮商队，趁夜潜入沛县，只为在父亲临终前握一次手' text_length=229
2025-09-27 12:56:39 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=155 choice='亲率百骑假扮商队，趁夜潜入沛县，只为在父亲临终前握一次手'
2025-09-27 12:56:39 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=156 parent=155 choice='亲率百骑假扮商队，趁夜潜入沛县，只为在父亲临终前握一次手'
2025-09-27 12:56:39 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=156 image_url=http://127.0.0.1:8000/static/cyberpunk_city.jpg
2025-09-27 12:56:39 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=156 depth=1
2025-09-27 12:56:39 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=156 completed, triggered next level depth=1
2025-09-27 12:56:39 | INFO     | core.speculation:_run_pipeline:100 - [Speculation] drop job due to per-user concurrency limit user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b session=13 node=156
2025-09-27 12:56:43 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1671
2025-09-27 12:56:43 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 1034
2025-09-27 12:56:43 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:43 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949002773_683.png
2025-09-27 12:56:43 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949002773_683.png
2025-09-27 12:56:43 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:43 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949002773_683.png
2025-09-27 12:56:44 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1579
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 942
2025-09-27 12:56:44 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:44 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949003355_364.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949003355_364.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949003355_364.png
2025-09-27 12:56:44 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 705
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 12:56:44 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:44 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949003556_550.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949003556_550.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949003556_550.png
2025-09-27 12:56:44 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1493
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 854
2025-09-27 12:56:44 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:44 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949004006_039.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949004006_039.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949004006_039.png
2025-09-27 12:56:44 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1794
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 1157
2025-09-27 12:56:44 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:44 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949004116_059.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949004116_059.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949004116_059.png
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_10b27e5e43d020d34f06d5a3d2206969.png (大小: 1376306 字节)
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_10b27e5e43d020d34f06d5a3d2206969.png
2025-09-27 12:56:44 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_10b27e5e43d020d34f06d5a3d2206969.png
2025-09-27 12:56:44 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_10b27e5e43d020d34f06d5a3d2206969.png
2025-09-27 12:56:44 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_10b27e5e43d020d34f06d5a3d2206969.png
2025-09-27 12:56:44 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:44 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=153 choice='深夜独骑南下，不带随从，亲自走小路回沛县见父一面，再折返战场' text_length=198
2025-09-27 12:56:44 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=153 choice='深夜独骑南下，不带随从，亲自走小路回沛县见父一面，再折返战场'
2025-09-27 12:56:44 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=157 parent=153 choice='深夜独骑南下，不带随从，亲自走小路回沛县见父一面，再折返战场'
2025-09-27 12:56:44 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=157 image_url=http://127.0.0.1:8000/static/generated/ai_gen_10b27e5e43d020d34f06d5a3d2206969.png
2025-09-27 12:56:44 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=157 depth=1
2025-09-27 12:56:44 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=157 completed, triggered next level depth=1
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:378 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 刘邦...
2025-09-27 12:56:44 | DEBUG    | api.story:start_new_story:381 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 12:56:44 | DEBUG    | api.story:start_new_story:386 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:8257349830529623538
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:390 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:396 - [预生成] 命中缓存，使用预生成的会话和节点: session=13, node=152
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:417 - [Start] ✅ 使用预生成节点: session_id=13, node_id=152
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:473 - [Start] 🎉 新故事生成成功！session_id=13, node_id=152
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:474 - [Start] 📊 响应详情 - 文本长度: 235, 选择数: 3, 图片: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:475 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:492 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=13, node=152
2025-09-27 12:56:44 | INFO     | api.story:start_new_story:494 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:45 | INFO     | backend.main:_static_probe:118 - [StaticProbe] images hit path=/static/rebirth_gate_placeholder.png
2025-09-27 12:56:45 | DEBUG    | backend.main:get_response:41 - [Static:images] request path=rebirth_gate_placeholder.png
2025-09-27 12:56:45 | INFO     | backend.main:get_response:44 - [Static:images] status=200 path=rebirth_gate_placeholder.png
2025-09-27 12:56:45 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_f6bd84f425260b92d0e663f4cc09c1df.png (大小: 1364902 字节)
2025-09-27 12:56:45 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f6bd84f425260b92d0e663f4cc09c1df.png
2025-09-27 12:56:45 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f6bd84f425260b92d0e663f4cc09c1df.png
2025-09-27 12:56:45 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_f6bd84f425260b92d0e663f4cc09c1df.png
2025-09-27 12:56:45 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_f6bd84f425260b92d0e663f4cc09c1df.png
2025-09-27 12:56:45 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:45 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=154 choice='只带两名亲信，伪装成商队连夜启程，借道魏地秘密返回故乡' text_length=210
2025-09-27 12:56:45 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=154 choice='只带两名亲信，伪装成商队连夜启程，借道魏地秘密返回故乡'
2025-09-27 12:56:45 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=158 parent=154 choice='只带两名亲信，伪装成商队连夜启程，借道魏地秘密返回故乡'
2025-09-27 12:56:45 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=158 image_url=http://127.0.0.1:8000/static/generated/ai_gen_f6bd84f425260b92d0e663f4cc09c1df.png
2025-09-27 12:56:45 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=158 depth=1
2025-09-27 12:56:45 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=158 completed, triggered next level depth=1
2025-09-27 12:56:45 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_073f630c4f6d1492de092da5c86e11d9.png (大小: 1371958 字节)
2025-09-27 12:56:45 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_073f630c4f6d1492de092da5c86e11d9.png
2025-09-27 12:56:45 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_073f630c4f6d1492de092da5c86e11d9.png
2025-09-27 12:56:45 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_073f630c4f6d1492de092da5c86e11d9.png
2025-09-27 12:56:45 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_073f630c4f6d1492de092da5c86e11d9.png
2025-09-27 12:56:45 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:45 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=154 choice='当众焚毁家书，宣称‘孝道在心，不在形迹’，以此激励将士共赴国难' text_length=282
2025-09-27 12:56:45 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=154 choice='当众焚毁家书，宣称‘孝道在心，不在形迹’，以此激励将士共赴国难'
2025-09-27 12:56:46 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=159 parent=154 choice='当众焚毁家书，宣称‘孝道在心，不在形迹’，以此激励将士共赴国难'
2025-09-27 12:56:46 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=159 image_url=http://127.0.0.1:8000/static/generated/ai_gen_073f630c4f6d1492de092da5c86e11d9.png
2025-09-27 12:56:46 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=159 depth=1
2025-09-27 12:56:46 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=159 completed, triggered next level depth=1
2025-09-27 12:56:46 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_09ed6713794480ff1ae36cce55c2ecea.png (大小: 1456152 字节)
2025-09-27 12:56:46 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_09ed6713794480ff1ae36cce55c2ecea.png
2025-09-27 12:56:46 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_09ed6713794480ff1ae36cce55c2ecea.png
2025-09-27 12:56:46 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_09ed6713794480ff1ae36cce55c2ecea.png
2025-09-27 12:56:46 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_09ed6713794480ff1ae36cce55c2ecea.png
2025-09-27 12:56:46 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:46 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=154 choice='命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐潜伏于故道' text_length=242
2025-09-27 12:56:46 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=154 choice='命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐潜伏于故道'
2025-09-27 12:56:46 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=160 parent=154 choice='命人快马加鞭送信给沛县，谎称自己即将归乡探亲，实则暗中调遣精锐潜伏于故道'
2025-09-27 12:56:46 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=160 image_url=http://127.0.0.1:8000/static/generated/ai_gen_09ed6713794480ff1ae36cce55c2ecea.png
2025-09-27 12:56:46 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=160 depth=1
2025-09-27 12:56:46 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=160 completed, triggered next level depth=1
2025-09-27 12:56:47 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_ec996ea6b77a2612d8d1b9efb9b18238.png (大小: 1453769 字节)
2025-09-27 12:56:47 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_ec996ea6b77a2612d8d1b9efb9b18238.png
2025-09-27 12:56:47 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ec996ea6b77a2612d8d1b9efb9b18238.png
2025-09-27 12:56:47 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_ec996ea6b77a2612d8d1b9efb9b18238.png
2025-09-27 12:56:47 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_ec996ea6b77a2612d8d1b9efb9b18238.png
2025-09-27 12:56:47 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:47 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=153 choice='命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言' text_length=227
2025-09-27 12:56:47 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=153 choice='命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言'
2025-09-27 12:56:47 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=161 parent=153 choice='命人假扮商队，用丝绸与酒换得乡里信使的信任，秘密传递家书与安抚之言'
2025-09-27 12:56:47 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=161 image_url=http://127.0.0.1:8000/static/generated/ai_gen_ec996ea6b77a2612d8d1b9efb9b18238.png
2025-09-27 12:56:47 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=161 depth=1
2025-09-27 12:56:47 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=161 completed, triggered next level depth=1
2025-09-27 12:56:48 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1678
2025-09-27 12:56:48 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 1041
2025-09-27 12:56:48 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:48 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949007539_544.png
2025-09-27 12:56:48 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949007539_544.png
2025-09-27 12:56:48 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:48 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949007539_544.png
2025-09-27 12:56:48 | INFO     | core.image_generation:_generate_oneapi:119 - 图像生成成功，响应长度: 1086
2025-09-27 12:56:48 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 449
2025-09-27 12:56:48 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 12:56:48 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758949008146_853.png
2025-09-27 12:56:48 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758949008146_853.png
2025-09-27 12:56:48 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 12:56:48 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758949008146_853.png
2025-09-27 12:56:50 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_f5765579a7195da82a3e0192498c9d03.png (大小: 1243286 字节)
2025-09-27 12:56:50 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f5765579a7195da82a3e0192498c9d03.png
2025-09-27 12:56:50 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f5765579a7195da82a3e0192498c9d03.png
2025-09-27 12:56:50 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_f5765579a7195da82a3e0192498c9d03.png
2025-09-27 12:56:50 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_f5765579a7195da82a3e0192498c9d03.png
2025-09-27 12:56:50 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:50 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=155 choice='将家书焚于篝火，当众宣布：‘我刘季无父无母，唯有天下苍生是吾亲！’' text_length=260
2025-09-27 12:56:50 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=155 choice='将家书焚于篝火，当众宣布：‘我刘季无父无母，唯有天下苍生是吾亲！’'
2025-09-27 12:56:50 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=162 parent=155 choice='将家书焚于篝火，当众宣布：‘我刘季无父无母，唯有天下苍生是吾亲！’'
2025-09-27 12:56:50 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=162 image_url=http://127.0.0.1:8000/static/generated/ai_gen_f5765579a7195da82a3e0192498c9d03.png
2025-09-27 12:56:50 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=162 depth=1
2025-09-27 12:56:50 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=162 completed, triggered next level depth=1
2025-09-27 12:56:51 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_302f0a8edae6d585c14d061795a91a5d.png (大小: 1467391 字节)
2025-09-27 12:56:51 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_302f0a8edae6d585c14d061795a91a5d.png
2025-09-27 12:56:51 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_302f0a8edae6d585c14d061795a91a5d.png
2025-09-27 12:56:51 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_302f0a8edae6d585c14d061795a91a5d.png
2025-09-27 12:56:51 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_302f0a8edae6d585c14d061795a91a5d.png
2025-09-27 12:56:51 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=155 choice='命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望' text_length=256
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=155 choice='命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望'
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=163 parent=155 choice='命人连夜快马加鞭送信给沛县旧部，请他们代为照料老父，并公开宣称自己已遣使回乡探望'
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=163 image_url=http://127.0.0.1:8000/static/generated/ai_gen_302f0a8edae6d585c14d061795a91a5d.png
2025-09-27 12:56:51 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=163 depth=1
2025-09-27 12:56:51 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=163 completed, triggered next level depth=1
2025-09-27 12:56:51 | ERROR    | core.image_generation:_generate_oneapi:131 - 图像生成请求失败: HTTPSConnectionPool(host='oneapi.cyberclaude.com', port=443): Max retries exceeded with url: /v1/chat/completions (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000002BDC860AB90>, 'Connection to oneapi.cyberclaude.com timed out. (connect timeout=60)'))
2025-09-27 12:56:51 | ERROR    | core.image_generation:generate_image:63 - 图像生成失败: 网络请求失败: HTTPSConnectionPool(host='oneapi.cyberclaude.com', port=443): Max retries exceeded with url: /v1/chat/completions (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000002BDC860AB90>, 'Connection to oneapi.cyberclaude.com timed out. (connect timeout=60)'))
2025-09-27 12:56:51 | ERROR    | core.image_service:generate_image_realtime:109 - [AIImageGen] ❌ 即时图片生成失败: 图像生成失败: 网络请求失败: HTTPSConnectionPool(host='oneapi.cyberclaude.com', port=443): Max retries exceeded with url: /v1/chat/completions (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000002BDC860AB90>, 'Connection to oneapi.cyberclaude.com timed out. (connect timeout=60)'))，降级到随机图库
2025-09-27 12:56:51 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] 从图库随机选择图片，图库大小: 6
2025-09-27 12:56:51 | INFO     | core.image_service:get_random_image_from_library:59 - [ImageLibrary] ✅ 随机选择图片: rebirth_gate_placeholder.png
2025-09-27 12:56:51 | INFO     | core.image_service:get_random_image_from_library:60 - [ImageLibrary] 🎯 返回图片URL: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:51 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:51 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 第1阶段-故事生成完成：parent=153 choice='当众焚毁家书，宣称‘国事为重，孝道可暂搁’，以雷霆之威震慑军心' text_length=227
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:250 - [Speculation] 第2阶段-创建数据库节点开始：parent=153 choice='当众焚毁家书，宣称‘国事为重，孝道可暂搁’，以雷霆之威震慑军心'
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] 第2阶段-数据库节点创建完成：node_id=164 parent=153 choice='当众焚毁家书，宣称‘国事为重，孝道可暂搁’，以雷霆之威震慑军心'
2025-09-27 12:56:51 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=164 image_url=http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-27 12:56:51 | DEBUG    | core.speculation:enqueue:63 - [Speculation] enqueue PIPELINE session=13 node=164 depth=1
2025-09-27 12:56:51 | DEBUG    | core.speculation:_generate_children_pipeline:214 - [Speculation] child node=164 completed, triggered next level depth=1
2025-09-27 12:58:30 | INFO     | api.story:continue_existing_story:514 - 收到故事继续请求，选择: 命人将家书焚于篝火，当众宣读‘为天下苍生，暂别亲情’
2025-09-27 12:58:30 | INFO     | api.story:continue_existing_story:558 - [NodeReady] 检查节点完整性：node_id=154
2025-09-27 12:58:30 | INFO     | api.story:_wait_for_node_complete:126 - [NodeComplete] 开始等待节点完全准备：node_id=154
2025-09-27 12:58:30 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] ✅ 节点完全准备就绪：node_id=154 (等待了 0.0 秒)
2025-09-27 12:58:30 | INFO     | api.story:continue_existing_story:561 - [NodeReady] ✅ 节点完全准备就绪：node_id=154
2025-09-27 12:58:30 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_43c001eddd604619ae314afcc6030455.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_43c001eddd604619ae314afcc6030455.png exists=True size=1349474
2025-09-27 12:58:30 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 12:58:30 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_43c001eddd604619ae314afcc6030455.png
2025-09-27 13:00:20 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d58715d424be34273d88db802dc69fd5.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d58715d424be34273d88db802dc69fd5.png exists=True size=1352537
2025-09-27 13:00:20 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 13:00:20 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png exists=True size=1360830
2025-09-27 13:00:20 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 13:00:20 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_d58715d424be34273d88db802dc69fd5.png
2025-09-27 13:00:20 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_3e98fa15626d1e9ae9b09e31d0685dbd.png
2025-09-27 13:00:21 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png exists=True size=1118563
2025-09-27 13:00:21 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 13:00:21 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d69d04ce8142d20109be8f23716ccfc8.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d69d04ce8142d20109be8f23716ccfc8.png exists=True size=1444140
2025-09-27 13:00:21 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 13:00:21 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_f38abeeaab806e855bbf9a391a87fcb7.png
2025-09-27 13:00:21 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_d69d04ce8142d20109be8f23716ccfc8.png
2025-09-27 13:00:25 | INFO     | api.story:retry_from_node:665 - 收到时空回溯请求，目标节点: 154
2025-09-27 13:00:25 | INFO     | database.crud:prune_story_after_node:301 - 正在从节点 154 之后进行时空回溯...
2025-09-27 13:00:25 | INFO     | database.crud:prune_story_after_node:312 - 节点 154 的所有后代节点 [160, 159, 158] 将被删除。
2025-09-27 13:00:25 | INFO     | database.crud:prune_story_after_node:323 - 已成功完成回溯，当前故事线的终点为节点 154。
2025-09-27 13:29:28 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 13:29:31 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 13:29:32 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 13:29:32 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 13:29:32 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 13:29:32 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:29:32 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 13:29:32 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:29:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:29:32 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 13:29:32 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 13:29:32 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 13:29:32 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 13:29:32 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 13:29:32 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 13:29:32 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 13:29:32 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 13:29:32 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 13:29:32 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 13:29:32 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 13:29:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:29:33 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 13:29:33 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 13:29:33 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 13:29:33 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 13:29:33 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:29:48 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 13:29:49 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 13:29:50 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 13:29:50 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 13:29:50 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 13:29:50 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:29:50 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 13:29:50 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:29:50 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:29:50 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 13:29:50 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 13:29:50 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 13:29:50 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 13:29:50 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 13:29:50 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 13:29:50 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 13:29:50 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 13:29:50 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 13:29:50 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 13:29:50 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 13:29:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:29:51 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 13:29:51 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 13:29:51 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 13:29:51 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 13:29:51 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:31:55 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 13:31:56 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 13:31:57 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 13:31:57 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 13:31:57 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 13:31:57 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:31:57 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 13:31:57 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:31:57 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:31:57 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 13:31:57 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 13:31:57 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 13:31:57 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 13:31:57 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 13:31:57 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 13:31:57 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 13:31:57 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 13:31:57 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 13:31:57 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 13:31:57 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 13:31:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:31:58 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 13:31:58 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 13:31:58 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 13:31:58 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 13:31:58 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:32:05 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 13:32:07 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 13:32:08 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 13:32:08 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 13:32:08 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 13:32:08 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:32:08 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 13:32:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:32:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:32:08 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=3 workers=4 choice_workers=3 expiry=30min
2025-09-27 13:32:08 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 13:32:08 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 13:32:08 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 13:32:08 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 13:32:08 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 13:32:08 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 13:32:08 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 13:32:08 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 13:32:08 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 13:32:08 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 13:32:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:32:09 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 13:32:09 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 13:32:09 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 13:32:09 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 13:32:09 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:35:21 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 13:35:22 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 13:35:23 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 13:35:23 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 13:35:23 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 13:35:23 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:35:23 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 13:35:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:35:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:35:23 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=2 workers=4 choice_workers=3 expiry=30min
2025-09-27 13:35:23 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 13:35:23 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 13:35:23 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 13:35:23 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 13:35:23 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 13:35:23 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 13:35:23 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 13:35:23 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 13:35:23 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 13:35:23 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 13:35:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:35:24 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 13:35:24 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 13:35:24 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 13:35:24 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 13:35:24 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:35:24 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 13:35:25 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 13:35:25 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 13:35:25 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 13:35:25 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 13:35:25 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 13:35:25 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 13:35:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:35:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:35:25 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=2 workers=4 choice_workers=3 expiry=30min
2025-09-27 13:35:25 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 13:35:25 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 13:35:25 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 13:35:25 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 13:35:25 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 13:35:25 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 13:35:25 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 13:35:25 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 13:35:25 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 13:35:26 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 13:35:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 13:35:26 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 13:35:26 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 13:35:26 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 13:35:26 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 13:35:26 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 14:14:53 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 14:14:54 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 14:14:55 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 14:14:55 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 14:14:55 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 14:14:55 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 14:14:55 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 14:14:55 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 14:14:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 14:14:55 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=2 workers=60 choice_workers=3 expiry=30min
2025-09-27 14:14:55 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 14:14:55 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 14:14:55 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 14:14:55 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 14:14:55 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 14:14:55 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 14:14:55 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 14:14:55 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 14:14:55 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 14:14:55 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 14:14:56 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 14:14:56 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 14:14:56 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 14:14:56 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 14:14:56 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 14:14:56 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 14:14:56 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 14:14:57 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 14:14:58 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 14:14:58 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 14:14:58 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 14:14:58 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 14:14:58 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 14:14:58 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 14:14:58 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 14:14:58 | INFO     | core.speculation:__init__:31 - [Speculation] enabled depth=2 workers=60 choice_workers=3 expiry=30min
2025-09-27 14:14:58 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 14:14:58 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 14:14:58 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 14:14:58 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 14:14:58 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 14:14:58 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 14:14:58 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 14:14:58 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 14:14:58 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 14:14:58 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 14:14:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 14:14:59 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 14:14:59 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 14:14:59 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 14:14:59 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 14:14:59 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:17:05 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:17:06 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:17:07 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:17:07 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:17:07 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:17:07 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:17:07 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:17:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:07 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=2 choice_workers=3 mode=thread-per-enqueue (no global pool)
2025-09-27 17:17:07 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:17:07 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:17:07 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:17:07 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:17:07 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:17:07 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:17:07 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:17:07 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:17:07 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:17:07 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:17:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:08 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:17:08 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:17:08 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:17:08 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:17:08 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:17:08 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:17:10 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:17:10 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:17:10 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:17:10 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:17:10 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:17:10 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:17:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:11 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=2 choice_workers=3 mode=thread-per-enqueue (no global pool)
2025-09-27 17:17:11 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:17:11 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:17:11 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:17:11 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:17:11 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:17:11 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:17:11 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:17:11 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:17:11 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:17:11 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:17:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:11 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:17:11 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:17:12 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:17:12 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:17:12 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:17:33 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:17:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:37 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:17:38 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:17:38 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:17:38 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:17:38 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:17:38 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:17:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:38 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=2 choice_workers=3 mode=thread-per-enqueue (no global pool)
2025-09-27 17:17:38 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:17:38 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:17:38 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:17:38 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:17:38 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:17:38 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:17:38 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:17:38 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:17:38 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:17:38 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:17:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:17:39 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:17:39 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:17:39 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:17:39 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:17:39 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:18:31 | INFO     | api.story:prepare_start_level:265 - [PrepareStart] 🚀 开始生成故事概要，愿望：刘邦...
2025-09-27 17:18:31 | DEBUG    | api.story:prepare_start_level:267 - [PrepareStart] 构建提示词上下文...
2025-09-27 17:18:31 | DEBUG    | api.story:prepare_start_level:269 - [PrepareStart] 上下文构建完成，推荐章节数: 11
2025-09-27 17:18:31 | INFO     | api.story:prepare_start_level:276 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 509
2025-09-27 17:18:32 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:18:32 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 928
2025-09-27 17:18:32 | INFO     | api.story:prepare_start_level:278 - [PrepareStart] ✅ LLM响应完成，响应长度: 208
2025-09-27 17:18:32 | INFO     | api.story:prepare_start_level:305 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 17:18:32 | DEBUG    | api.story:prepare_start_level:317 - [PrepareStart] 解析结果 - title: 草根起兵：反秦之路, background: 秦末天下大乱，六国旧族纷纷举旗。你身为沛县亭长，目睹暴政民不聊生，暗中积蓄力量。项羽崛起于江东，刘邦..., quest: 在三个月内拉拢三位关键盟友，建立初步势力...
2025-09-27 17:18:32 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:18:32 | INFO     | api.story:prepare_start_level:349 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:18:32 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:18:32 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘邦'
2025-09-27 17:18:36 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:18:36 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1435
2025-09-27 17:18:36 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=900 预览='{"text": "夜色如墨，咸阳城外的烽火台只剩残烬。刘邦立于断墙之下，手中紧握一封密信——韩信亲笔所书，言明项羽已命钟离昧率军北上，意图截断汉军粮道。风卷枯叶，似有千军万马在耳畔奔腾。他眯眼望向远处黑压压的山影，心中权衡：若此刻出兵迎击，或可夺回先机；但若贸然出击，恐陷重围。远处传来马蹄轻响，一骑飞驰而来，却是张良暗中传讯：‘项伯欲见你，于城东旧庙。’刘邦嘴角微扬，眼中闪过一丝锐利——这是一场棋局，而他，正悄然布子。", "choices": [{"option": "假意应约赴会，借酒宴试探项伯真实来意", "summary": "以柔克刚，借宴席探虚实", "effects": {"d'
2025-09-27 17:18:36 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=900 预览='{"text": "夜色如墨，咸阳城外的烽火台只剩残烬。刘邦立于断墙之下，手中紧握一封密信——韩信亲笔所书，言明项羽已命钟离昧率军北上，意图截断汉军粮道。风卷枯叶，似有千军万马在耳畔奔腾。他眯眼望向远处黑压压的山影，心中权衡：若此刻出兵迎击，或可夺回先机；但若贸然出击，恐陷重围。远处传来马蹄轻响，一骑飞驰而来，却是张良'
2025-09-27 17:18:36 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=900 预览='{"text": "夜色如墨，咸阳城外的烽火台只剩残烬。刘邦立于断墙之下，手中紧握一封密信——韩信亲笔所书，言明项羽已命钟离昧率军北上，意图截断汉军粮道。风卷枯叶，似有千军万马在耳畔奔腾。他眯眼望向远处黑压压的山影，心中权衡：若此刻出兵迎击，或可夺回先机；但若贸然出击，恐陷重围。远处传来马蹄轻响，一骑飞驰而来，却是张良'
2025-09-27 17:18:36 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 202
2025-09-27 17:18:36 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:18:36 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 202
2025-09-27 17:18:36 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:18:36 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 17:18:36 | INFO     | core.image_storage:__init__:29 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 17:18:36 | INFO     | core.image_storage:__init__:30 - 图像web访问前缀: http://127.0.0.1:8000/static/generated
2025-09-27 17:18:36 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:18:36 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，咸阳城外的烽火...
2025-09-27 17:18:36 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:18:36 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，咸阳城外的烽火...
2025-09-27 17:18:46 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:18:46 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:18:46 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:18:46 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758964725858_832.png
2025-09-27 17:18:46 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758964725858_832.png
2025-09-27 17:18:46 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:18:46 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758964725858_832.png
2025-09-27 17:18:48 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png (大小: 1163145 字节)
2025-09-27 17:18:48 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:18:48 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:18:48 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:18:48 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:18:48 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 17:18:48 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=202
2025-09-27 17:18:48 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=14
2025-09-27 17:18:48 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=165
2025-09-27 17:18:48 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=165 image_url=http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:18:48 | DEBUG    | core.speculation:enqueue:61 - [Speculation] enqueue PIPELINE session=14 node=165 depth=1
2025-09-27 17:18:48 | INFO     | api.story:_background_generate_with_pregeneration:101 - [预生成] 已触发speculation预生成: session=14, node=165
2025-09-27 17:18:48 | INFO     | api.story:_background_generate_with_pregeneration:103 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=14
2025-09-27 17:18:48 | DEBUG    | api.story:_background_generate_with_pregeneration:115 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:18:48 | DEBUG    | core.speculation:_generate_children_pipeline:195 - [Speculation] pipeline generating 3 children for node=165
2025-09-27 17:18:48 | INFO     | core.speculation:_generate_child_node:222 - [Speculation] 开始生成故事+图像块：parent=165 choice='假意应约赴会，借酒宴试探项伯真实来意'
2025-09-27 17:18:48 | INFO     | core.speculation:_generate_child_node:229 - [Speculation] 第1阶段-故事生成开始：parent=165 choice='假意应约赴会，借酒宴试探项伯真实来意'
2025-09-27 17:18:48 | INFO     | core.speculation:_generate_child_node:222 - [Speculation] 开始生成故事+图像块：parent=165 choice='连夜调遣樊哙部精锐，绕道山谷埋伏于敌军必经之路'
2025-09-27 17:18:48 | INFO     | core.speculation:_generate_child_node:222 - [Speculation] 开始生成故事+图像块：parent=165 choice='遣人送信给陈平，让他潜入楚营散布谣言，扰乱军心'
2025-09-27 17:18:48 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 假意应约赴会，借酒宴试探项伯真实来意
2025-09-27 17:18:48 | INFO     | core.speculation:_generate_child_node:229 - [Speculation] 第1阶段-故事生成开始：parent=165 choice='连夜调遣樊哙部精锐，绕道山谷埋伏于敌军必经之路'
2025-09-27 17:18:48 | INFO     | core.speculation:_generate_child_node:229 - [Speculation] 第1阶段-故事生成开始：parent=165 choice='遣人送信给陈平，让他潜入楚营散布谣言，扰乱军心'
2025-09-27 17:18:48 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 连夜调遣樊哙部精锐，绕道山谷埋伏于敌军必经之路
2025-09-27 17:18:48 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 遣人送信给陈平，让他潜入楚营散布谣言，扰乱军心
2025-09-27 17:18:52 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:18:52 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1605
2025-09-27 17:18:52 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=855 预览='{"text": "夜风掠过残垣断壁，韩信密信上的墨迹在月光下泛着冷光。刘邦将信缓缓折起，塞入袖中，目光却已越过山脊，落在城东那座荒废的旧庙——项伯现身，必有深意。他轻抚腰间剑柄，耳畔似有钟离昧铁蹄踏碎霜雪之声。若赴约，或可探得项羽虚实；若拒见，恐失先机。但更令人不安的是，张良传讯时那句‘他只等你一人’，像一根细针，刺进心底。远处火把忽明忽暗，仿佛有人正悄然靠近。此刻，是赴约设局，还是借夜色调虎离山？", "choices": [{"option": "换上破衣烂衫，扮作逃难老卒混入庙前杂役，静观项伯真意", "summary": "以卑微之姿窥探敌手布局，藏锋于拙", "effects": '
2025-09-27 17:18:52 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=855 预览='{"text": "夜风掠过残垣断壁，韩信密信上的墨迹在月光下泛着冷光。刘邦将信缓缓折起，塞入袖中，目光却已越过山脊，落在城东那座荒废的旧庙——项伯现身，必有深意。他轻抚腰间剑柄，耳畔似有钟离昧铁蹄踏碎霜雪之声。若赴约，或可探得项羽虚实；若拒见，恐失先机。但更令人不安的是，张良传讯时那句‘他只等你一人’，像一根细针，刺'
2025-09-27 17:18:52 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=855 预览='{"text": "夜风掠过残垣断壁，韩信密信上的墨迹在月光下泛着冷光。刘邦将信缓缓折起，塞入袖中，目光却已越过山脊，落在城东那座荒废的旧庙——项伯现身，必有深意。他轻抚腰间剑柄，耳畔似有钟离昧铁蹄踏碎霜雪之声。若赴约，或可探得项羽虚实；若拒见，恐失先机。但更令人不安的是，张良传讯时那句‘他只等你一人’，像一根细针，刺'
2025-09-27 17:18:52 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 192
2025-09-27 17:18:52 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 192
2025-09-27 17:18:52 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:18:52 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风掠过残垣断壁，韩信密...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:18:52 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风掠过残垣断壁，韩信密...
2025-09-27 17:18:52 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:18:52 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1600
2025-09-27 17:18:52 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=870 预览='{"text": "夜风卷着焦土气息扑面而来，刘邦凝视着远处旧庙的轮廓，檐角残破如断翅。张良的密信在掌心微微发烫，而韩信的急报仍在耳畔回响——项羽的铁蹄正踏碎北境的寂静。他缓缓将信纸折成一只飞鸟，掷向风中。那瞬间，庙门轻响，一道黑影自门后闪出，披甲执戟，正是项伯。他目光深沉，低声道：‘你若肯与我共谋，可保三军不焚，百姓免屠。’话音未落，远处传来战鼓闷响，似有伏兵逼近。刘邦嘴角微扬，眼中却无波澜——他知道，此刻不是信任或背叛的时刻，而是让棋局真正转动的一瞬。", "choices": [{"option": "假意应允项伯，借机探明其真实意图，暗中布下疑阵", "summary": "以虚言诱敌'
2025-09-27 17:18:52 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=870 预览='{"text": "夜风卷着焦土气息扑面而来，刘邦凝视着远处旧庙的轮廓，檐角残破如断翅。张良的密信在掌心微微发烫，而韩信的急报仍在耳畔回响——项羽的铁蹄正踏碎北境的寂静。他缓缓将信纸折成一只飞鸟，掷向风中。那瞬间，庙门轻响，一道黑影自门后闪出，披甲执戟，正是项伯。他目光深沉，低声道：‘你若肯与我共谋，可保三军不焚，百姓'
2025-09-27 17:18:52 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=870 预览='{"text": "夜风卷着焦土气息扑面而来，刘邦凝视着远处旧庙的轮廓，檐角残破如断翅。张良的密信在掌心微微发烫，而韩信的急报仍在耳畔回响——项羽的铁蹄正踏碎北境的寂静。他缓缓将信纸折成一只飞鸟，掷向风中。那瞬间，庙门轻响，一道黑影自门后闪出，披甲执戟，正是项伯。他目光深沉，低声道：‘你若肯与我共谋，可保三军不焚，百姓'
2025-09-27 17:18:52 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 220
2025-09-27 17:18:52 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 220
2025-09-27 17:18:52 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:18:52 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷着焦土气息扑面而来...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:18:52 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷着焦土气息扑面而来...
2025-09-27 17:18:52 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:18:52 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1617
2025-09-27 17:18:52 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=872 预览='{"text": "夜风卷起刘邦的衣角，他凝视着远处旧庙的轮廓，庙门半掩，烛火在风中摇曳如鬼影。项伯来意不明，却偏偏选在此刻现身——是陷阱，还是转机？韩信的密信仍在掌心发烫，而张良的讯息也如刀锋般悬在头顶。他缓缓摘下腰间玉佩，轻轻放在石台上，那是一枚曾象征楚怀王授命的信物。若此刻赴约，便是踏入虎口；若拒之门外，又恐失天下人心。他低笑一声，眼中寒光乍现：‘既然你们都来下棋，那便让我执黑先落子。’", "choices": [{"option": "只带一柄短剑，披风裹面，独自赴约于旧庙，静观其变", "summary": "孤身入局，以静制动，试探对方真实意图", "effects": {"de'
2025-09-27 17:18:52 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=872 预览='{"text": "夜风卷起刘邦的衣角，他凝视着远处旧庙的轮廓，庙门半掩，烛火在风中摇曳如鬼影。项伯来意不明，却偏偏选在此刻现身——是陷阱，还是转机？韩信的密信仍在掌心发烫，而张良的讯息也如刀锋般悬在头顶。他缓缓摘下腰间玉佩，轻轻放在石台上，那是一枚曾象征楚怀王授命的信物。若此刻赴约，便是踏入虎口；若拒之门外，又恐失天'
2025-09-27 17:18:52 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=872 预览='{"text": "夜风卷起刘邦的衣角，他凝视着远处旧庙的轮廓，庙门半掩，烛火在风中摇曳如鬼影。项伯来意不明，却偏偏选在此刻现身——是陷阱，还是转机？韩信的密信仍在掌心发烫，而张良的讯息也如刀锋般悬在头顶。他缓缓摘下腰间玉佩，轻轻放在石台上，那是一枚曾象征楚怀王授命的信物。若此刻赴约，便是踏入虎口；若拒之门外，又恐失天'
2025-09-27 17:18:52 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 188
2025-09-27 17:18:52 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 188
2025-09-27 17:18:52 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:18:52 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的衣角，他凝...
2025-09-27 17:18:52 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:18:52 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起刘邦的衣角，他凝...
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:379 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 刘邦...
2025-09-27 17:19:00 | DEBUG    | api.story:start_new_story:382 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 17:19:00 | DEBUG    | api.story:start_new_story:387 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:1831455458711150295
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:391 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:397 - [预生成] 命中缓存，使用预生成的会话和节点: session=14, node=165
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:418 - [Start] ✅ 使用预生成节点: session_id=14, node_id=165
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:474 - [Start] 🎉 新故事生成成功！session_id=14, node_id=165
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:475 - [Start] 📊 响应详情 - 文本长度: 202, 选择数: 3, 图片: http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:476 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:485 - [Start] 📁 [图片文件检查] 文件存在: True, 大小: 1163145字节, 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:493 - [Start] ⏭️ 使用预生成故事，跳过speculation触发: session=14, node=165
2025-09-27 17:19:00 | INFO     | api.story:start_new_story:495 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:19:00 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png exists=True size=1163145
2025-09-27 17:19:00 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:19:00 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_178f9dd1dc4c8a3b1f76325fcc8c660b.png
2025-09-27 17:19:03 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:19:03 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:19:03 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:19:03 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758964742748_486.png
2025-09-27 17:19:03 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758964742748_486.png
2025-09-27 17:19:03 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:19:03 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758964742748_486.png
2025-09-27 17:19:05 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_77154e03487a137613b78eda71b41496.png (大小: 1411765 字节)
2025-09-27 17:19:05 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_77154e03487a137613b78eda71b41496.png
2025-09-27 17:19:05 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_77154e03487a137613b78eda71b41496.png
2025-09-27 17:19:05 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_77154e03487a137613b78eda71b41496.png
2025-09-27 17:19:05 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_77154e03487a137613b78eda71b41496.png
2025-09-27 17:19:05 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:19:05 | INFO     | core.speculation:_generate_child_node:238 - [Speculation] 第1阶段-故事生成完成：parent=165 choice='遣人送信给陈平，让他潜入楚营散布谣言，扰乱军心' text_length=192
2025-09-27 17:19:05 | INFO     | core.speculation:_generate_child_node:248 - [Speculation] 第2阶段-创建数据库节点开始：parent=165 choice='遣人送信给陈平，让他潜入楚营散布谣言，扰乱军心'
2025-09-27 17:19:05 | INFO     | core.speculation:_generate_child_node:258 - [Speculation] 第2阶段-数据库节点创建完成：node_id=166 parent=165 choice='遣人送信给陈平，让他潜入楚营散布谣言，扰乱军心'
2025-09-27 17:19:05 | INFO     | core.speculation:_generate_child_node:273 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=166 image_url=http://127.0.0.1:8000/static/generated/ai_gen_77154e03487a137613b78eda71b41496.png
2025-09-27 17:19:05 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:19:05 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:19:05 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:19:05 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758964745166_760.png
2025-09-27 17:19:05 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758964745166_760.png
2025-09-27 17:19:05 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:19:05 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758964745166_760.png
2025-09-27 17:19:07 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_6f33f6b7dffcf98b3e9070c15f9f3d8b.png (大小: 1209017 字节)
2025-09-27 17:19:07 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_6f33f6b7dffcf98b3e9070c15f9f3d8b.png
2025-09-27 17:19:07 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_6f33f6b7dffcf98b3e9070c15f9f3d8b.png
2025-09-27 17:19:07 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_6f33f6b7dffcf98b3e9070c15f9f3d8b.png
2025-09-27 17:19:07 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_6f33f6b7dffcf98b3e9070c15f9f3d8b.png
2025-09-27 17:19:07 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:19:07 | INFO     | core.speculation:_generate_child_node:238 - [Speculation] 第1阶段-故事生成完成：parent=165 choice='连夜调遣樊哙部精锐，绕道山谷埋伏于敌军必经之路' text_length=220
2025-09-27 17:19:07 | INFO     | core.speculation:_generate_child_node:248 - [Speculation] 第2阶段-创建数据库节点开始：parent=165 choice='连夜调遣樊哙部精锐，绕道山谷埋伏于敌军必经之路'
2025-09-27 17:19:07 | INFO     | core.speculation:_generate_child_node:258 - [Speculation] 第2阶段-数据库节点创建完成：node_id=167 parent=165 choice='连夜调遣樊哙部精锐，绕道山谷埋伏于敌军必经之路'
2025-09-27 17:19:07 | INFO     | core.speculation:_generate_child_node:273 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=167 image_url=http://127.0.0.1:8000/static/generated/ai_gen_6f33f6b7dffcf98b3e9070c15f9f3d8b.png
2025-09-27 17:19:10 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 744 (attempt 1/2)
2025-09-27 17:19:10 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 110
2025-09-27 17:19:10 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:19:10 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758964749263_763.png
2025-09-27 17:19:10 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758964749263_763.png
2025-09-27 17:19:10 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:19:10 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758964749263_763.png
2025-09-27 17:19:12 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_9ed26dcb4cea619ccd4f3e43fbaa7392.png (大小: 1315242 字节)
2025-09-27 17:19:12 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_9ed26dcb4cea619ccd4f3e43fbaa7392.png
2025-09-27 17:19:12 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_9ed26dcb4cea619ccd4f3e43fbaa7392.png
2025-09-27 17:19:12 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_9ed26dcb4cea619ccd4f3e43fbaa7392.png
2025-09-27 17:19:12 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_9ed26dcb4cea619ccd4f3e43fbaa7392.png
2025-09-27 17:19:12 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:19:12 | INFO     | core.speculation:_generate_child_node:238 - [Speculation] 第1阶段-故事生成完成：parent=165 choice='假意应约赴会，借酒宴试探项伯真实来意' text_length=188
2025-09-27 17:19:12 | INFO     | core.speculation:_generate_child_node:248 - [Speculation] 第2阶段-创建数据库节点开始：parent=165 choice='假意应约赴会，借酒宴试探项伯真实来意'
2025-09-27 17:19:12 | INFO     | core.speculation:_generate_child_node:258 - [Speculation] 第2阶段-数据库节点创建完成：node_id=168 parent=165 choice='假意应约赴会，借酒宴试探项伯真实来意'
2025-09-27 17:19:12 | INFO     | core.speculation:_generate_child_node:273 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=168 image_url=http://127.0.0.1:8000/static/generated/ai_gen_9ed26dcb4cea619ccd4f3e43fbaa7392.png
2025-09-27 17:30:17 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:32:30 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:32:32 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:32:32 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:32:32 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:32:32 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:32:32 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:32:32 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:32:32 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:32:32 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=2 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 17:32:32 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:32:32 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:32:32 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:32:32 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:32:32 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:32:32 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:32:32 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:32:32 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:32:32 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:32:32 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:32:33 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:32:33 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:32:33 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:32:33 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:32:33 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:32:33 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:36:03 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:36:04 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:36:05 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:36:05 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:36:05 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:36:05 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:36:05 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:36:05 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:36:05 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:36:05 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 17:36:05 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:36:05 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:36:05 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:36:05 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:36:05 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:36:05 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:36:05 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:36:05 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:36:05 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:36:05 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:36:06 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:36:06 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:36:06 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:36:06 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:36:06 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:36:06 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:36:06 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:36:07 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:36:08 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:36:08 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:36:08 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:36:08 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:36:08 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:36:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:36:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:36:08 | INFO     | core.speculation:__init__:30 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 17:36:08 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:36:08 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:36:08 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:36:08 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:36:08 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:36:08 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:36:08 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:36:08 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:36:08 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:36:08 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:36:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:36:08 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:36:08 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:36:08 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:36:08 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:36:08 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:38:34 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:38:36 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:38:37 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:38:37 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:38:37 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:38:37 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:38:37 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:38:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:38:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:38:37 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 17:38:37 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:38:37 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:38:37 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:38:37 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:38:37 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:38:37 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:38:37 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:38:37 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:38:37 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:38:37 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:38:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:38:38 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:38:38 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:38:38 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:38:38 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:38:38 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:38:42 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:38:43 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:38:44 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:38:44 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:38:44 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:38:44 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:38:44 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:38:44 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:38:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:38:44 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 17:38:44 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:38:44 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:38:44 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:38:44 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:38:44 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:38:44 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:38:44 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:38:44 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:38:44 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:38:44 | INFO     | backend.main:_run_alembic_cmd:191 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:38:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:38:45 | INFO     | backend.main:_run_alembic_cmd:193 - Alembic migration complete.
2025-09-27 17:38:45 | INFO     | backend.main:startup_event:204 - 重生之我是……API服务启动
2025-09-27 17:38:45 | INFO     | backend.main:startup_event:205 - 调试模式: True
2025-09-27 17:38:45 | INFO     | backend.main:startup_event:210 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:38:45 | INFO     | backend.main:startup_event:211 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:39:20 | INFO     | api.story:prepare_start_level:265 - [PrepareStart] 🚀 开始生成故事概要，愿望：哈利波特...
2025-09-27 17:39:20 | DEBUG    | api.story:prepare_start_level:267 - [PrepareStart] 构建提示词上下文...
2025-09-27 17:39:20 | DEBUG    | api.story:prepare_start_level:269 - [PrepareStart] 上下文构建完成，推荐章节数: 9
2025-09-27 17:39:20 | INFO     | api.story:prepare_start_level:276 - [PrepareStart] 📝 调用LLM生成关卡元信息，提示词长度: 477
2025-09-27 17:39:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:39:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 899
2025-09-27 17:39:22 | INFO     | api.story:prepare_start_level:278 - [PrepareStart] ✅ LLM响应完成，响应长度: 252
2025-09-27 17:39:22 | INFO     | api.story:prepare_start_level:305 - [PrepareStart] 📊 JSON解析成功，包含字段: ['level_title', 'background', 'main_quest']
2025-09-27 17:39:22 | DEBUG    | api.story:prepare_start_level:317 - [PrepareStart] 解析结果 - title: 重塑命运的霍格沃茨, background: 1998年，魔法世界在伏地魔的阴影下濒临崩塌。哈利·波特作为唯一能终结黑暗的关键人物，却在最终决战中..., quest: 在不暴露身份的前提下，成功进入霍格沃茨并完成一年级入学仪式...
2025-09-27 17:39:22 | INFO     | api.story:_background_generate_with_pregeneration:72 - [预生成] 开始完整故事生成流程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:39:22 | INFO     | api.story:prepare_start_level:349 - [预生成] 已启动后台完整故事生成线程: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:39:22 | INFO     | api.story:_background_generate_with_pregeneration:75 - [预生成] 调用story_engine.start_story开始: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:39:22 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '哈利波特'
2025-09-27 17:39:25 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:39:25 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1328
2025-09-27 17:39:25 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=869 预览='{"text": "霍格沃茨的钟声在午夜悄然敲响，回荡在幽深的走廊间。哈利站在魔法石守护室的门前，石像鬼的眼中闪烁着不祥的蓝光。他紧握魔杖，呼吸凝滞——时间正被某种无形之力拉扯。远处传来脚步声，守卫正在巡逻。墙上的画像低声议论着‘命运之轮’的逆转可能，而那枚藏于暗格中的古老日记本，正无声地发烫，仿佛在召唤他打开真正的真相。他知道，此刻的选择将撕裂历史的线轴，让某个已被注定的结局重新摇曳。", "choices": [{"option": "用幻影移形瞬间闪入密室，直面守护魔法的古老谜题", "summary": "以速度打破僵局，冒险闯入核心区域", "effects": {"delta_pr'
2025-09-27 17:39:25 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=869 预览='{"text": "霍格沃茨的钟声在午夜悄然敲响，回荡在幽深的走廊间。哈利站在魔法石守护室的门前，石像鬼的眼中闪烁着不祥的蓝光。他紧握魔杖，呼吸凝滞——时间正被某种无形之力拉扯。远处传来脚步声，守卫正在巡逻。墙上的画像低声议论着‘命运之轮’的逆转可能，而那枚藏于暗格中的古老日记本，正无声地发烫，仿佛在召唤他打开真正的真'
2025-09-27 17:39:25 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=869 预览='{"text": "霍格沃茨的钟声在午夜悄然敲响，回荡在幽深的走廊间。哈利站在魔法石守护室的门前，石像鬼的眼中闪烁着不祥的蓝光。他紧握魔杖，呼吸凝滞——时间正被某种无形之力拉扯。远处传来脚步声，守卫正在巡逻。墙上的画像低声议论着‘命运之轮’的逆转可能，而那枚藏于暗格中的古老日记本，正无声地发烫，仿佛在召唤他打开真正的真'
2025-09-27 17:39:25 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 185
2025-09-27 17:39:25 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:39:25 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 185
2025-09-27 17:39:25 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:39:25 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-27 17:39:25 | INFO     | core.image_storage:__init__:29 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images
2025-09-27 17:39:25 | INFO     | core.image_storage:__init__:30 - 图像web访问前缀: http://127.0.0.1:8000/static/generated
2025-09-27 17:39:25 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:39:25 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 霍格沃茨的钟声在午夜悄然...
2025-09-27 17:39:25 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:39:25 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 霍格沃茨的钟声在午夜悄然...
2025-09-27 17:39:38 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:39:38 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:39:38 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:39:38 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758965977649_025.png
2025-09-27 17:39:38 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758965977649_025.png
2025-09-27 17:39:38 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:39:38 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758965977649_025.png
2025-09-27 17:39:40 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d2cae1ac64c2889db369a25192202035.png (大小: 1592363 字节)
2025-09-27 17:39:40 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:40 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:40 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:40 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:40 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-27 17:39:40 | INFO     | api.story:_background_generate_with_pregeneration:77 - [预生成] 第一节故事LLM生成完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, text长度=185
2025-09-27 17:39:40 | INFO     | api.story:_background_generate_with_pregeneration:81 - [预生成] 创建会话成功: session_id=15
2025-09-27 17:39:40 | INFO     | api.story:_background_generate_with_pregeneration:85 - [预生成] 创建第一个节点成功: node_id=169
2025-09-27 17:39:40 | INFO     | api.story:_background_generate_with_pregeneration:88 - [预生成] 首节点图像已由story_engine处理: node_id=169 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:40 | INFO     | api.story:_background_generate_with_pregeneration:101 - [预生成] 已触发speculation预生成: session=15, node=169
2025-09-27 17:39:40 | INFO     | api.story:_background_generate_with_pregeneration:103 - [预生成] 完整流程成功完成: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b, session=15
2025-09-27 17:39:40 | DEBUG    | api.story:_background_generate_with_pregeneration:115 - [预生成] 数据库会话已安全关闭: user=4f4c5c05-6bef-4d5b-9272-c37ff7268f8b
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:379 - [Start] 👤 用户 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b 收到新故事请求，愿望: 哈利波特...
2025-09-27 17:39:44 | DEBUG    | api.story:start_new_story:382 - [Start] 愿望校验已通过，开始处理故事生成
2025-09-27 17:39:44 | DEBUG    | api.story:start_new_story:387 - [Start] 生成缓存键: 4f4c5c05-6bef-4d5b-9272-c37ff7268f8b:6054170509742980927
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:391 - [Start] 🔍 缓存查询结果: 命中
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:397 - [预生成] 命中缓存，使用预生成的会话和节点: session=15, node=169
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:418 - [Start] ✅ 使用预生成节点: session_id=15, node_id=169
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:474 - [Start] 🎉 新故事生成成功！session_id=15, node_id=169
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:475 - [Start] 📊 响应详情 - 文本长度: 185, 选择数: 3, 图片: http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:476 - [Start] 🖼️ [图片URL调试] 返回给前端的图片URL: http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:484 - [Start] 📁 [图片文件检查] 文件存在: True, 大小: 1592363字节, 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:487 - [Start] 🔮 触发动态窗口补齐: session=15, node=169, depth=1
2025-09-27 17:39:44 | DEBUG    | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=15 node=169 depth=1
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:489 - [Start] ✅ speculation补齐任务已启动
2025-09-27 17:39:44 | INFO     | api.story:start_new_story:491 - [Start] 🚀 API响应即将返回，图片URL: http://127.0.0.1:8000/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:44 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d2cae1ac64c2889db369a25192202035.png exists=True size=1592363
2025-09-27 17:39:44 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:44 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=169
2025-09-27 17:39:44 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=169 choice='用幻影移形瞬间闪入密室，直面守护魔法的古老谜题'
2025-09-27 17:39:44 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=169 choice='用幻影移形瞬间闪入密室，直面守护魔法的古老谜题'
2025-09-27 17:39:44 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=169 choice='用复方汤剂伪装成教授模样，混入巡逻队伍寻找破绽'
2025-09-27 17:39:44 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=169 choice='轻声吟唱一首遗忘的咒语，唤醒石像鬼的记忆碎片'
2025-09-27 17:39:44 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 用幻影移形瞬间闪入密室，直面守护魔法的古老谜题
2025-09-27 17:39:44 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=169 choice='用复方汤剂伪装成教授模样，混入巡逻队伍寻找破绽'
2025-09-27 17:39:44 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=169 choice='轻声吟唱一首遗忘的咒语，唤醒石像鬼的记忆碎片'
2025-09-27 17:39:44 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 用复方汤剂伪装成教授模样，混入巡逻队伍寻找破绽
2025-09-27 17:39:44 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 轻声吟唱一首遗忘的咒语，唤醒石像鬼的记忆碎片
2025-09-27 17:39:45 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:39:47 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:39:47 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1490
2025-09-27 17:39:47 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=879 预览='{"text": "魔杖尖端的微光在石墙间跳跃，哈利凝视着日记本上逐渐浮现的古老符文——那不是魔法，而是时间本身的低语。他忽然意识到，这本日记并非记录历史，而是被篡改过的历史本身。走廊尽头的守卫脚步声停顿了，仿佛也被某种无形的引力拉住。墙上画像的面孔开始扭曲，其中一位老巫师低声说：‘你若打开它，便不再是那个被命运选中的人。’空气骤然凝滞，风铃无声，唯有日记本的封皮微微发烫，像一颗即将跳动的心脏。他知道，此刻的抉择将决定是否让整个魔法世界从记忆中彻底消失。", "choices": [{"option": "将日记本砸向地面，用碎裂的魔法碎片唤醒沉睡的时间之眼", "summary": "以毁灭'
2025-09-27 17:39:47 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=879 预览='{"text": "魔杖尖端的微光在石墙间跳跃，哈利凝视着日记本上逐渐浮现的古老符文——那不是魔法，而是时间本身的低语。他忽然意识到，这本日记并非记录历史，而是被篡改过的历史本身。走廊尽头的守卫脚步声停顿了，仿佛也被某种无形的引力拉住。墙上画像的面孔开始扭曲，其中一位老巫师低声说：‘你若打开它，便不再是那个被命运选中的'
2025-09-27 17:39:47 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=879 预览='{"text": "魔杖尖端的微光在石墙间跳跃，哈利凝视着日记本上逐渐浮现的古老符文——那不是魔法，而是时间本身的低语。他忽然意识到，这本日记并非记录历史，而是被篡改过的历史本身。走廊尽头的守卫脚步声停顿了，仿佛也被某种无形的引力拉住。墙上画像的面孔开始扭曲，其中一位老巫师低声说：‘你若打开它，便不再是那个被命运选中的'
2025-09-27 17:39:47 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 219
2025-09-27 17:39:47 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:39:47 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 219
2025-09-27 17:39:47 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:39:47 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:39:47 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 魔杖尖端的微光在石墙间跳...
2025-09-27 17:39:47 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:39:47 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 魔杖尖端的微光在石墙间跳...
2025-09-27 17:39:48 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:39:48 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1515
2025-09-27 17:39:48 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=898 预览='{"text": "哈利屏住呼吸，指尖触到日记本的烫痕，那字迹竟在缓缓蠕动，仿佛活物。他猛然意识到——这并非单纯的记录，而是被施了记忆咒语的‘活体档案’，正试图篡改自己对伏地魔之死的记忆。走廊尽头的守卫脚步声骤然停顿，石像鬼的蓝光忽明忽暗，如同心跳。他瞥见墙角阴影中浮现出一个模糊人影，手持银色怀表，正是邓布利多年轻时的模样，正凝视着他，嘴唇微动，似在低语：‘你不是来守护历史的，你是来重写它的。’魔法石的微光在门后闪烁，像一颗即将熄灭的心。", "choices": [{"option": "将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’", "summary": "以心理战'
2025-09-27 17:39:48 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=898 预览='{"text": "哈利屏住呼吸，指尖触到日记本的烫痕，那字迹竟在缓缓蠕动，仿佛活物。他猛然意识到——这并非单纯的记录，而是被施了记忆咒语的‘活体档案’，正试图篡改自己对伏地魔之死的记忆。走廊尽头的守卫脚步声骤然停顿，石像鬼的蓝光忽明忽暗，如同心跳。他瞥见墙角阴影中浮现出一个模糊人影，手持银色怀表，正是邓布利多年轻时的'
2025-09-27 17:39:48 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=898 预览='{"text": "哈利屏住呼吸，指尖触到日记本的烫痕，那字迹竟在缓缓蠕动，仿佛活物。他猛然意识到——这并非单纯的记录，而是被施了记忆咒语的‘活体档案’，正试图篡改自己对伏地魔之死的记忆。走廊尽头的守卫脚步声骤然停顿，石像鬼的蓝光忽明忽暗，如同心跳。他瞥见墙角阴影中浮现出一个模糊人影，手持银色怀表，正是邓布利多年轻时的'
2025-09-27 17:39:48 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 211
2025-09-27 17:39:48 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:39:48 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 211
2025-09-27 17:39:48 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:39:48 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:39:48 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利屏住呼吸，指尖触到日...
2025-09-27 17:39:48 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:39:48 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利屏住呼吸，指尖触到日...
2025-09-27 17:39:48 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:39:48 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1512
2025-09-27 17:39:48 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=900 预览='{"text": "魔法石守护室的门缝中渗出幽蓝光晕，仿佛有生命般脉动。哈利的手指触到冰冷的石像鬼额头，那双眼睛骤然睁开，瞳孔中浮现出他童年时在女贞路被欺凌的画面——时间的裂缝正在吞噬现实。日记本的纸页无风自动，墨迹如血般流淌出一句陌生咒语：‘以记忆为祭，换未来之门’。远处守卫的脚步声渐近，而墙上的画像突然集体低语，指向那本不断翻页的日记。他知道，此刻若不回应这召唤，历史将永远困在原地；可若贸然触碰，也许连‘自己’都将被抹去。", "choices": [{"option": "用魔杖轻点日记本，将童年记忆注入咒文，激活时间裂隙", "summary": "以自我过往为代价，换取通往真相的通道'
2025-09-27 17:39:48 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=900 预览='{"text": "魔法石守护室的门缝中渗出幽蓝光晕，仿佛有生命般脉动。哈利的手指触到冰冷的石像鬼额头，那双眼睛骤然睁开，瞳孔中浮现出他童年时在女贞路被欺凌的画面——时间的裂缝正在吞噬现实。日记本的纸页无风自动，墨迹如血般流淌出一句陌生咒语：‘以记忆为祭，换未来之门’。远处守卫的脚步声渐近，而墙上的画像突然集体低语，指'
2025-09-27 17:39:48 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=900 预览='{"text": "魔法石守护室的门缝中渗出幽蓝光晕，仿佛有生命般脉动。哈利的手指触到冰冷的石像鬼额头，那双眼睛骤然睁开，瞳孔中浮现出他童年时在女贞路被欺凌的画面——时间的裂缝正在吞噬现实。日记本的纸页无风自动，墨迹如血般流淌出一句陌生咒语：‘以记忆为祭，换未来之门’。远处守卫的脚步声渐近，而墙上的画像突然集体低语，指'
2025-09-27 17:39:48 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 205
2025-09-27 17:39:48 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:39:48 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 205
2025-09-27 17:39:48 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:39:48 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:39:48 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 魔法石守护室的门缝中渗出...
2025-09-27 17:39:48 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:39:48 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 魔法石守护室的门缝中渗出...
2025-09-27 17:40:00 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:40:00 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:40:00 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:40:00 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966000343_351.png
2025-09-27 17:40:00 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966000343_351.png
2025-09-27 17:40:00 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:40:00 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966000343_351.png
2025-09-27 17:40:01 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:40:01 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:40:01 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:40:01 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966001426_816.png
2025-09-27 17:40:01 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966001426_816.png
2025-09-27 17:40:01 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:40:01 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966001426_816.png
2025-09-27 17:40:02 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:40:02 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:40:02 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:40:02 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966001595_285.png
2025-09-27 17:40:02 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966001595_285.png
2025-09-27 17:40:02 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:40:02 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966001595_285.png
2025-09-27 17:40:02 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_1da921336f712311d83c46ed8262bf62.png (大小: 1382313 字节)
2025-09-27 17:40:02 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:40:02 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:40:02 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:40:02 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:40:02 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:40:02 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=169 choice='用幻影移形瞬间闪入密室，直面守护魔法的古老谜题' text_length=211
2025-09-27 17:40:02 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=169 choice='用幻影移形瞬间闪入密室，直面守护魔法的古老谜题'
2025-09-27 17:40:02 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=170 parent=169 choice='用幻影移形瞬间闪入密室，直面守护魔法的古老谜题'
2025-09-27 17:40:02 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=170 image_url=http://127.0.0.1:8000/static/generated/ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:40:03 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_1ca68010b1109d0efc56b27fcaa1bab1.png (大小: 1476389 字节)
2025-09-27 17:40:03 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_1ca68010b1109d0efc56b27fcaa1bab1.png
2025-09-27 17:40:03 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1ca68010b1109d0efc56b27fcaa1bab1.png
2025-09-27 17:40:03 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_1ca68010b1109d0efc56b27fcaa1bab1.png
2025-09-27 17:40:03 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_1ca68010b1109d0efc56b27fcaa1bab1.png
2025-09-27 17:40:03 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:40:03 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=169 choice='轻声吟唱一首遗忘的咒语，唤醒石像鬼的记忆碎片' text_length=219
2025-09-27 17:40:03 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=169 choice='轻声吟唱一首遗忘的咒语，唤醒石像鬼的记忆碎片'
2025-09-27 17:40:03 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=171 parent=169 choice='轻声吟唱一首遗忘的咒语，唤醒石像鬼的记忆碎片'
2025-09-27 17:40:03 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=171 image_url=http://127.0.0.1:8000/static/generated/ai_gen_1ca68010b1109d0efc56b27fcaa1bab1.png
2025-09-27 17:40:04 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_d7a91162d6ed05c6e90fba7ca816de56.png (大小: 1580592 字节)
2025-09-27 17:40:04 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_d7a91162d6ed05c6e90fba7ca816de56.png
2025-09-27 17:40:04 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d7a91162d6ed05c6e90fba7ca816de56.png
2025-09-27 17:40:04 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_d7a91162d6ed05c6e90fba7ca816de56.png
2025-09-27 17:40:04 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_d7a91162d6ed05c6e90fba7ca816de56.png
2025-09-27 17:40:04 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:40:04 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=169 choice='用复方汤剂伪装成教授模样，混入巡逻队伍寻找破绽' text_length=205
2025-09-27 17:40:04 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=169 choice='用复方汤剂伪装成教授模样，混入巡逻队伍寻找破绽'
2025-09-27 17:40:04 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=172 parent=169 choice='用复方汤剂伪装成教授模样，混入巡逻队伍寻找破绽'
2025-09-27 17:40:04 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=172 image_url=http://127.0.0.1:8000/static/generated/ai_gen_d7a91162d6ed05c6e90fba7ca816de56.png
2025-09-27 17:41:26 | INFO     | api.story:continue_existing_story:511 - 收到故事继续请求，选择: 用幻影移形瞬间闪入密室，直面守护魔法的古老谜题
2025-09-27 17:41:26 | INFO     | api.story:continue_existing_story:554 - [NodeReady] 检查节点完整性：node_id=170
2025-09-27 17:41:26 | INFO     | api.story:_wait_for_node_complete:127 - [NodeComplete] 开始等待节点完全准备：node_id=170
2025-09-27 17:41:26 | INFO     | api.story:_wait_for_node_complete:181 - [NodeComplete] ✅ 节点完全准备就绪：node_id=170 (等待了 0.0 秒)
2025-09-27 17:41:26 | INFO     | api.story:continue_existing_story:557 - [NodeReady] ✅ 节点完全准备就绪：node_id=170
2025-09-27 17:41:26 | INFO     | api.story:continue_existing_story:566 - [Continue] 🔮 触发动态窗口补齐(已存在子节点): session=15, node=170, depth=1
2025-09-27 17:41:26 | DEBUG    | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=15 node=170 depth=1
2025-09-27 17:41:26 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=170
2025-09-27 17:41:26 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=170 choice='将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’'
2025-09-27 17:41:26 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=170 choice='低声吟诵《遗忘咒》的反向版本，让整个走廊陷入短暂的意识错乱'
2025-09-27 17:41:26 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=170 choice='将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’'
2025-09-27 17:41:26 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=170 choice='打开日记本，任由其中涌出的黑雾缠绕手臂，与记忆中的自己对话'
2025-09-27 17:41:26 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=170 choice='低声吟诵《遗忘咒》的反向版本，让整个走廊陷入短暂的意识错乱'
2025-09-27 17:41:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’
2025-09-27 17:41:26 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=170 choice='打开日记本，任由其中涌出的黑雾缠绕手臂，与记忆中的自己对话'
2025-09-27 17:41:26 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_1da921336f712311d83c46ed8262bf62.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1da921336f712311d83c46ed8262bf62.png exists=True size=1382313
2025-09-27 17:41:26 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:41:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 低声吟诵《遗忘咒》的反向版本，让整个走廊陷入短暂的意识错乱
2025-09-27 17:41:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 打开日记本，任由其中涌出的黑雾缠绕手臂，与记忆中的自己对话
2025-09-27 17:41:27 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:41:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:41:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1713
2025-09-27 17:41:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=905 预览='{"text": "哈利的魔杖尖端划破空气，幻影移形的瞬间，空间如玻璃般碎裂。他跌入密室深处，脚下是冰冷的石阶，四周浮现出古老的符文阵列，它们在黑暗中缓缓旋转，仿佛在呼吸。魔法石的光芒从地底深处透出，与墙上的咒语共鸣，形成一道不断变化的星图。突然，地面震动，一尊青铜巨像从阴影中苏醒，双眼燃起幽绿火焰，低沉的声音回荡：‘唯有以记忆为祭，方可开启真相之门。’ 哈利的日记本在胸前剧烈震颤，字迹开始逆流，拼出一段从未读过的文字——‘你曾亲手埋葬的，正是你即将重见的。’ 而那年轻邓布利多的幻影，在石像背后轻轻摇头，似在叹息时间的错位。", "choices": [{"option": "将日记本投入符文'
2025-09-27 17:41:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=905 预览='{"text": "哈利的魔杖尖端划破空气，幻影移形的瞬间，空间如玻璃般碎裂。他跌入密室深处，脚下是冰冷的石阶，四周浮现出古老的符文阵列，它们在黑暗中缓缓旋转，仿佛在呼吸。魔法石的光芒从地底深处透出，与墙上的咒语共鸣，形成一道不断变化的星图。突然，地面震动，一尊青铜巨像从阴影中苏醒，双眼燃起幽绿火焰，低沉的声音回荡：‘'
2025-09-27 17:41:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=905 预览='{"text": "哈利的魔杖尖端划破空气，幻影移形的瞬间，空间如玻璃般碎裂。他跌入密室深处，脚下是冰冷的石阶，四周浮现出古老的符文阵列，它们在黑暗中缓缓旋转，仿佛在呼吸。魔法石的光芒从地底深处透出，与墙上的咒语共鸣，形成一道不断变化的星图。突然，地面震动，一尊青铜巨像从阴影中苏醒，双眼燃起幽绿火焰，低沉的声音回荡：‘'
2025-09-27 17:41:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 255
2025-09-27 17:41:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 255
2025-09-27 17:41:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:41:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利的魔杖尖端划破空气，...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:41:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利的魔杖尖端划破空气，...
2025-09-27 17:41:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:41:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1701
2025-09-27 17:41:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=885 预览='{"text": "哈利猛地念出‘幻影移形’，身形如烟消散在石室门前。下一瞬，他已在密室深处——空气凝滞如冰，墙壁上浮现出古老的符文阵列，如同活体血管般缓缓搏动。魔法石悬浮于祭坛之上，散发幽蓝微光，而地底传来低沉的吟唱，仿佛整座城堡正在苏醒。他脚边的地板裂开，露出一具被锁链缠绕的骑士遗骸，手中紧握的盾牌刻着‘守护者之誓’。突然，日记本在他怀中剧烈震动，一行血字浮现：‘你已踏入我记忆的回廊，但真正的试炼，是面对自己未曾说出的真相。’远处钟声重响，每一声都让空间微微扭曲，仿佛时间本身在撕裂。", "choices": [{"option": "用魔杖触碰骑士遗骸的盾牌，尝试唤醒其记忆残片", "s'
2025-09-27 17:41:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=885 预览='{"text": "哈利猛地念出‘幻影移形’，身形如烟消散在石室门前。下一瞬，他已在密室深处——空气凝滞如冰，墙壁上浮现出古老的符文阵列，如同活体血管般缓缓搏动。魔法石悬浮于祭坛之上，散发幽蓝微光，而地底传来低沉的吟唱，仿佛整座城堡正在苏醒。他脚边的地板裂开，露出一具被锁链缠绕的骑士遗骸，手中紧握的盾牌刻着‘守护者之誓'
2025-09-27 17:41:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=885 预览='{"text": "哈利猛地念出‘幻影移形’，身形如烟消散在石室门前。下一瞬，他已在密室深处——空气凝滞如冰，墙壁上浮现出古老的符文阵列，如同活体血管般缓缓搏动。魔法石悬浮于祭坛之上，散发幽蓝微光，而地底传来低沉的吟唱，仿佛整座城堡正在苏醒。他脚边的地板裂开，露出一具被锁链缠绕的骑士遗骸，手中紧握的盾牌刻着‘守护者之誓'
2025-09-27 17:41:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 236
2025-09-27 17:41:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 236
2025-09-27 17:41:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:41:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利猛地念出‘幻影移形’...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:41:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利猛地念出‘幻影移形’...
2025-09-27 17:41:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:41:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1711
2025-09-27 17:41:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=906 预览='{"text": "哈利的魔杖在掌心震颤，幻影移形的瞬间，空气如玻璃碎裂。他凭空出现在密室中央，脚下是刻满古老符文的石板，墙壁上浮现出流动的魔法阵，像被唤醒的星河。空气凝滞，一股低语从地底传来：‘唯有以记忆为钥，方可开启真相之门。’他手中的日记本突然翻页，浮现一行新字：‘你曾在此处，亲手埋葬了另一个自己。’石像鬼的蓝光骤然转为猩红，整个密室开始旋转，时间仿佛倒流——他看见自己站在伏地魔面前，却举起魔杖，没有杀戮，而是轻轻将对方推入深渊。那不是胜利，而是一次遗忘的牺牲。他的心跳与密室共鸣，每一秒都在重写命运的笔迹。", "choices": [{"option": "将日记本投入石板中心的火焰中'
2025-09-27 17:41:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=906 预览='{"text": "哈利的魔杖在掌心震颤，幻影移形的瞬间，空气如玻璃碎裂。他凭空出现在密室中央，脚下是刻满古老符文的石板，墙壁上浮现出流动的魔法阵，像被唤醒的星河。空气凝滞，一股低语从地底传来：‘唯有以记忆为钥，方可开启真相之门。’他手中的日记本突然翻页，浮现一行新字：‘你曾在此处，亲手埋葬了另一个自己。’石像鬼的蓝光'
2025-09-27 17:41:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=906 预览='{"text": "哈利的魔杖在掌心震颤，幻影移形的瞬间，空气如玻璃碎裂。他凭空出现在密室中央，脚下是刻满古老符文的石板，墙壁上浮现出流动的魔法阵，像被唤醒的星河。空气凝滞，一股低语从地底传来：‘唯有以记忆为钥，方可开启真相之门。’他手中的日记本突然翻页，浮现一行新字：‘你曾在此处，亲手埋葬了另一个自己。’石像鬼的蓝光'
2025-09-27 17:41:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 249
2025-09-27 17:41:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 249
2025-09-27 17:41:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:41:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利的魔杖在掌心震颤，幻...
2025-09-27 17:41:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:41:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利的魔杖在掌心震颤，幻...
2025-09-27 17:41:41 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:41:41 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:41:41 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:41:41 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966100689_225.png
2025-09-27 17:41:41 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966100689_225.png
2025-09-27 17:41:41 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:41:41 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966100689_225.png
2025-09-27 17:41:42 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_7a375d061105ac7659280edfbaf28c1b.png (大小: 1812992 字节)
2025-09-27 17:41:42 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_7a375d061105ac7659280edfbaf28c1b.png
2025-09-27 17:41:42 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_7a375d061105ac7659280edfbaf28c1b.png
2025-09-27 17:41:42 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_7a375d061105ac7659280edfbaf28c1b.png
2025-09-27 17:41:42 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_7a375d061105ac7659280edfbaf28c1b.png
2025-09-27 17:41:42 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:41:42 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=170 choice='低声吟诵《遗忘咒》的反向版本，让整个走廊陷入短暂的意识错乱' text_length=255
2025-09-27 17:41:42 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=170 choice='低声吟诵《遗忘咒》的反向版本，让整个走廊陷入短暂的意识错乱'
2025-09-27 17:41:42 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=173 parent=170 choice='低声吟诵《遗忘咒》的反向版本，让整个走廊陷入短暂的意识错乱'
2025-09-27 17:41:42 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=173 image_url=http://127.0.0.1:8000/static/generated/ai_gen_7a375d061105ac7659280edfbaf28c1b.png
2025-09-27 17:41:43 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 731 (attempt 1/2)
2025-09-27 17:41:43 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 97
2025-09-27 17:41:43 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:41:43 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966102697_524.png
2025-09-27 17:41:43 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966102697_524.png
2025-09-27 17:41:43 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:41:43 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966102697_524.png
2025-09-27 17:41:44 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_dc0d196978c0abc32e5e11a4a1d6a73b.png (大小: 1811677 字节)
2025-09-27 17:41:44 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_dc0d196978c0abc32e5e11a4a1d6a73b.png
2025-09-27 17:41:44 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_dc0d196978c0abc32e5e11a4a1d6a73b.png
2025-09-27 17:41:44 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_dc0d196978c0abc32e5e11a4a1d6a73b.png
2025-09-27 17:41:44 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_dc0d196978c0abc32e5e11a4a1d6a73b.png
2025-09-27 17:41:44 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:41:44 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=170 choice='打开日记本，任由其中涌出的黑雾缠绕手臂，与记忆中的自己对话' text_length=236
2025-09-27 17:41:44 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=170 choice='打开日记本，任由其中涌出的黑雾缠绕手臂，与记忆中的自己对话'
2025-09-27 17:41:44 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=174 parent=170 choice='打开日记本，任由其中涌出的黑雾缠绕手臂，与记忆中的自己对话'
2025-09-27 17:41:44 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=174 image_url=http://127.0.0.1:8000/static/generated/ai_gen_dc0d196978c0abc32e5e11a4a1d6a73b.png
2025-09-27 17:41:46 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:41:46 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:41:46 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:41:46 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966105965_808.png
2025-09-27 17:41:46 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966105965_808.png
2025-09-27 17:41:46 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:41:46 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966105965_808.png
2025-09-27 17:41:48 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png (大小: 1634393 字节)
2025-09-27 17:41:48 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:41:48 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:41:48 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:41:48 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:41:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:41:48 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=170 choice='将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’' text_length=249
2025-09-27 17:41:48 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=170 choice='将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’'
2025-09-27 17:41:48 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=175 parent=170 choice='将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’'
2025-09-27 17:41:48 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=175 image_url=http://127.0.0.1:8000/static/generated/ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:42:25 | INFO     | api.story:continue_existing_story:511 - 收到故事继续请求，选择: 将日记本塞进长袍内衬，假装镇定走向守卫，用眼神传递‘我已知晓一切’
2025-09-27 17:42:25 | INFO     | api.story:continue_existing_story:554 - [NodeReady] 检查节点完整性：node_id=175
2025-09-27 17:42:25 | INFO     | api.story:_wait_for_node_complete:127 - [NodeComplete] 开始等待节点完全准备：node_id=175
2025-09-27 17:42:25 | INFO     | api.story:_wait_for_node_complete:181 - [NodeComplete] ✅ 节点完全准备就绪：node_id=175 (等待了 0.0 秒)
2025-09-27 17:42:25 | INFO     | api.story:continue_existing_story:557 - [NodeReady] ✅ 节点完全准备就绪：node_id=175
2025-09-27 17:42:25 | INFO     | api.story:continue_existing_story:566 - [Continue] 🔮 触发动态窗口补齐(已存在子节点): session=15, node=175, depth=1
2025-09-27 17:42:25 | DEBUG    | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=15 node=175 depth=1
2025-09-27 17:42:25 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=175
2025-09-27 17:42:25 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png exists=True size=1634393
2025-09-27 17:42:25 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=175 choice='将日记本投入石板中心的火焰中，用自我记忆点燃真相'
2025-09-27 17:42:25 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:42:25 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=175 choice='用魔杖指向石像鬼的眼睛，反向施放记忆咒，夺回被篡改的过去'
2025-09-27 17:42:25 | INFO     | core.speculation:_generate_child_node:240 - [Speculation] 开始生成故事+图像块：parent=175 choice='轻声呼唤邓布利多年的影像，请求他指引如何打破这循环的谜题'
2025-09-27 17:42:25 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=175 choice='将日记本投入石板中心的火焰中，用自我记忆点燃真相'
2025-09-27 17:42:25 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=175 choice='用魔杖指向石像鬼的眼睛，反向施放记忆咒，夺回被篡改的过去'
2025-09-27 17:42:25 | INFO     | core.speculation:_generate_child_node:247 - [Speculation] 第1阶段-故事生成开始：parent=175 choice='轻声呼唤邓布利多年的影像，请求他指引如何打破这循环的谜题'
2025-09-27 17:42:25 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将日记本投入石板中心的火焰中，用自我记忆点燃真相
2025-09-27 17:42:25 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 用魔杖指向石像鬼的眼睛，反向施放记忆咒，夺回被篡改的过去
2025-09-27 17:42:25 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_eac57a74c86e9d5ebd788546ddae27a7.png
2025-09-27 17:42:25 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 轻声呼唤邓布利多年的影像，请求他指引如何打破这循环的谜题
2025-09-27 17:42:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:42:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1916
2025-09-27 17:42:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=866 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦间传来微弱的灼热。守卫的脚步声在走廊尽头停驻，两道黑影缓缓逼近。他挺直脊背，目光如刀锋般扫过对方肩章上的纹章——那正是魔法部暗影监察团的标记。他忽然轻笑一声，声音低哑却带着不容置疑的权威：‘我刚从禁书区回来，邓布利多年轻时的密令，你可敢查？’话音未落，守卫瞳孔骤缩，仿佛被某种无形之力击中。空气凝滞，墙上的画像瞬间闭眼，连石像鬼的蓝光也微微颤动。远处传来一声钟响，时间仿佛被拉长——而他的心跳，正与密室深处的魔法阵同频共振。", "choices": [{"option": "突然甩出魔杖，用记忆咒反向激活日记本中的旧影像", "summary":'
2025-09-27 17:42:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=866 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦间传来微弱的灼热。守卫的脚步声在走廊尽头停驻，两道黑影缓缓逼近。他挺直脊背，目光如刀锋般扫过对方肩章上的纹章——那正是魔法部暗影监察团的标记。他忽然轻笑一声，声音低哑却带着不容置疑的权威：‘我刚从禁书区回来，邓布利多年轻时的密令，你可敢查？’话音未落，守卫瞳孔骤缩，仿佛'
2025-09-27 17:42:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=866 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦间传来微弱的灼热。守卫的脚步声在走廊尽头停驻，两道黑影缓缓逼近。他挺直脊背，目光如刀锋般扫过对方肩章上的纹章——那正是魔法部暗影监察团的标记。他忽然轻笑一声，声音低哑却带着不容置疑的权威：‘我刚从禁书区回来，邓布利多年轻时的密令，你可敢查？’话音未落，守卫瞳孔骤缩，仿佛'
2025-09-27 17:42:28 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 227
2025-09-27 17:42:28 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:42:28 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 227
2025-09-27 17:42:28 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:42:28 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:42:28 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利将日记本紧贴胸口，布...
2025-09-27 17:42:28 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:42:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利将日记本紧贴胸口，布...
2025-09-27 17:42:29 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:42:29 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1913
2025-09-27 17:42:29 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=863 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦间传来微弱的灼热感。他挺直脊背，目光如刃扫过守卫的面庞——那双眼睛里映出的，不只是一个学生，而是一个早已看透命运的旅人。守卫脚步一顿，喉结滚动，仿佛被某种无形之力刺中。空气凝滞，墙上的画像突然噤声，连烛火都微微摇曳。他缓步前行，每一步都踩在时间的裂缝上。身后，密室的石门悄然合拢，发出沉闷的回响，如同历史之书被封印。而他胸前的日记本，字迹正缓缓褪去，仿佛在承认：‘你已不再是那个必须记住的人。’", "choices": [{"option": "突然抽出魔杖指向守卫，用‘记忆咒’反向读取他的真实身份", "summary": "以攻为守，揭开隐藏'
2025-09-27 17:42:29 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=863 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦间传来微弱的灼热感。他挺直脊背，目光如刃扫过守卫的面庞——那双眼睛里映出的，不只是一个学生，而是一个早已看透命运的旅人。守卫脚步一顿，喉结滚动，仿佛被某种无形之力刺中。空气凝滞，墙上的画像突然噤声，连烛火都微微摇曳。他缓步前行，每一步都踩在时间的裂缝上。身后，密室的石门'
2025-09-27 17:42:29 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=863 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦间传来微弱的灼热感。他挺直脊背，目光如刃扫过守卫的面庞——那双眼睛里映出的，不只是一个学生，而是一个早已看透命运的旅人。守卫脚步一顿，喉结滚动，仿佛被某种无形之力刺中。空气凝滞，墙上的画像突然噤声，连烛火都微微摇曳。他缓步前行，每一步都踩在时间的裂缝上。身后，密室的石门'
2025-09-27 17:42:29 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 212
2025-09-27 17:42:29 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:42:29 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 212
2025-09-27 17:42:29 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:42:29 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:42:29 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利将日记本紧贴胸口，布...
2025-09-27 17:42:29 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:42:29 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利将日记本紧贴胸口，布...
2025-09-27 17:42:30 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-27 17:42:30 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1924
2025-09-27 17:42:30 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=896 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦着烫痕，仿佛在低语。他挺直脊背，缓步走向守卫，目光如刀锋般扫过对方的瞳孔——那不是恐惧，而是一种近乎宿命的确认。守卫脚步一顿，眼神微缩，喉结滚动，似乎察觉了什么不该存在的气息。空气中弥漫着魔力的余震，墙上的画像突然齐刷刷闭上眼睛，连呼吸都凝滞。远处传来钟声，但并非霍格沃茨的钟，而是某种更古老、更沉重的回响，像是时间本身在颤抖。他听见自己心跳与密室深处的脉动同步，仿佛整个魔法世界正屏息等待他的下一步。那本日记，不再只是记录，它正在成为新的记忆源头。", "choices": [{"option": "突然转身，用魔杖指向石像鬼，高喊‘我才是真正的'
2025-09-27 17:42:30 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=896 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦着烫痕，仿佛在低语。他挺直脊背，缓步走向守卫，目光如刀锋般扫过对方的瞳孔——那不是恐惧，而是一种近乎宿命的确认。守卫脚步一顿，眼神微缩，喉结滚动，似乎察觉了什么不该存在的气息。空气中弥漫着魔力的余震，墙上的画像突然齐刷刷闭上眼睛，连呼吸都凝滞。远处传来钟声，但并非霍格沃'
2025-09-27 17:42:30 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=896 预览='{"text": "哈利将日记本紧贴胸口，布料摩擦着烫痕，仿佛在低语。他挺直脊背，缓步走向守卫，目光如刀锋般扫过对方的瞳孔——那不是恐惧，而是一种近乎宿命的确认。守卫脚步一顿，眼神微缩，喉结滚动，似乎察觉了什么不该存在的气息。空气中弥漫着魔力的余震，墙上的画像突然齐刷刷闭上眼睛，连呼吸都凝滞。远处传来钟声，但并非霍格沃'
2025-09-27 17:42:30 | INFO     | core.image_service:get_image_for_story:167 - [ImageService] 🎨 开始为故事获取图片，故事文本长度: 240
2025-09-27 17:42:30 | INFO     | core.image_service:get_image_for_story:174 - [ImageService] 🤖 AI图像生成已启用，优先尝试AI生成...
2025-09-27 17:42:30 | INFO     | core.image_service:generate_image_realtime:68 - [AIImageGen] 🚀 开始即时生成图片，故事文本长度: 240
2025-09-27 17:42:30 | DEBUG    | core.image_service:generate_image_realtime:72 - [AIImageGen] 导入图像生成客户端和存储服务...
2025-09-27 17:42:30 | DEBUG    | core.image_service:generate_image_realtime:77 - [AIImageGen] 提取图像提示词...
2025-09-27 17:42:30 | INFO     | core.image_service:generate_image_realtime:79 - [AIImageGen] 📝 生成的图像提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利将日记本紧贴胸口，布...
2025-09-27 17:42:30 | INFO     | core.image_service:generate_image_realtime:82 - [AIImageGen] 🎨 调用AI生成图像中...
2025-09-27 17:42:30 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 哈利将日记本紧贴胸口，布...
2025-09-27 17:42:40 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:42:40 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:42:40 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:42:40 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966160106_450.png
2025-09-27 17:42:40 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966160106_450.png
2025-09-27 17:42:40 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:42:40 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966160106_450.png
2025-09-27 17:42:42 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_38d70ed14832fd4f442d7406e1d14362.png (大小: 1326037 字节)
2025-09-27 17:42:42 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:42:42 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_38d70ed14832fd4f442d7406e1d14362.png
2025-09-27 17:42:42 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:42:42 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:42:42 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966162426_603.png
2025-09-27 17:42:42 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_38d70ed14832fd4f442d7406e1d14362.png
2025-09-27 17:42:42 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966162426_603.png
2025-09-27 17:42:42 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_38d70ed14832fd4f442d7406e1d14362.png
2025-09-27 17:42:42 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:42:42 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_38d70ed14832fd4f442d7406e1d14362.png
2025-09-27 17:42:42 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966162426_603.png
2025-09-27 17:42:42 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:42:42 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=175 choice='轻声呼唤邓布利多年的影像，请求他指引如何打破这循环的谜题' text_length=227
2025-09-27 17:42:42 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=175 choice='轻声呼唤邓布利多年的影像，请求他指引如何打破这循环的谜题'
2025-09-27 17:42:42 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=176 parent=175 choice='轻声呼唤邓布利多年的影像，请求他指引如何打破这循环的谜题'
2025-09-27 17:42:42 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=176 image_url=http://127.0.0.1:8000/static/generated/ai_gen_38d70ed14832fd4f442d7406e1d14362.png
2025-09-27 17:42:43 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-27 17:42:43 | INFO     | core.image_service:generate_image_realtime:84 - [AIImageGen] ✅ AI图像生成API调用成功，响应长度: 73
2025-09-27 17:42:43 | DEBUG    | core.image_service:generate_image_realtime:87 - [AIImageGen] 提取图像URL...
2025-09-27 17:42:43 | DEBUG    | core.image_service:_extract_image_url:135 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1758966162631_807.png
2025-09-27 17:42:43 | INFO     | core.image_service:generate_image_realtime:91 - [AIImageGen] 🔗 提取到图像URL: https://cloudflarer2.nananobanana.com/png/1758966162631_807.png
2025-09-27 17:42:43 | INFO     | core.image_service:generate_image_realtime:94 - [AIImageGen] 💾 开始下载并保存图像到本地...
2025-09-27 17:42:43 | INFO     | core.image_storage:save_ai_image:50 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1758966162631_807.png
2025-09-27 17:42:44 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_ed829c88fb22f954dffac5032b01ec43.png (大小: 1452499 字节)
2025-09-27 17:42:44 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_ed829c88fb22f954dffac5032b01ec43.png
2025-09-27 17:42:44 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ed829c88fb22f954dffac5032b01ec43.png
2025-09-27 17:42:44 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_ed829c88fb22f954dffac5032b01ec43.png
2025-09-27 17:42:44 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_ed829c88fb22f954dffac5032b01ec43.png
2025-09-27 17:42:44 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=175 choice='用魔杖指向石像鬼的眼睛，反向施放记忆咒，夺回被篡改的过去' text_length=212
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=175 choice='用魔杖指向石像鬼的眼睛，反向施放记忆咒，夺回被篡改的过去'
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=177 parent=175 choice='用魔杖指向石像鬼的眼睛，反向施放记忆咒，夺回被篡改的过去'
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=177 image_url=http://127.0.0.1:8000/static/generated/ai_gen_ed829c88fb22f954dffac5032b01ec43.png
2025-09-27 17:42:44 | INFO     | core.image_storage:save_ai_image:87 - ✅ 图像下载成功: ai_gen_7e0eca7f7c822731cc66e94cf60a58ba.png (大小: 1167850 字节)
2025-09-27 17:42:44 | INFO     | core.image_storage:save_ai_image:91 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_7e0eca7f7c822731cc66e94cf60a58ba.png
2025-09-27 17:42:44 | INFO     | core.image_storage:save_ai_image:92 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_7e0eca7f7c822731cc66e94cf60a58ba.png
2025-09-27 17:42:44 | INFO     | core.image_service:generate_image_realtime:98 - [AIImageGen] ✅ 图像已完全保存并验证可访问: http://127.0.0.1:8000/static/generated/ai_gen_7e0eca7f7c822731cc66e94cf60a58ba.png
2025-09-27 17:42:44 | INFO     | core.image_service:get_image_for_story:181 - [ImageService] ✅ AI生成成功: http://127.0.0.1:8000/static/generated/ai_gen_7e0eca7f7c822731cc66e94cf60a58ba.png
2025-09-27 17:42:44 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:256 - [Speculation] 第1阶段-故事生成完成：parent=175 choice='将日记本投入石板中心的火焰中，用自我记忆点燃真相' text_length=240
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:266 - [Speculation] 第2阶段-创建数据库节点开始：parent=175 choice='将日记本投入石板中心的火焰中，用自我记忆点燃真相'
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:276 - [Speculation] 第2阶段-数据库节点创建完成：node_id=178 parent=175 choice='将日记本投入石板中心的火焰中，用自我记忆点燃真相'
2025-09-27 17:42:44 | INFO     | core.speculation:_generate_child_node:291 - [Speculation] 第3阶段-节点创建完成，图像已由story_engine处理：node_id=178 image_url=http://127.0.0.1:8000/static/generated/ai_gen_7e0eca7f7c822731cc66e94cf60a58ba.png
2025-09-27 17:43:00 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d2cae1ac64c2889db369a25192202035.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d2cae1ac64c2889db369a25192202035.png exists=True size=1592363
2025-09-27 17:43:00 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:43:00 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_1da921336f712311d83c46ed8262bf62.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_1da921336f712311d83c46ed8262bf62.png exists=True size=1382313
2025-09-27 17:43:00 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:43:00 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_d2cae1ac64c2889db369a25192202035.png
2025-09-27 17:43:00 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_1da921336f712311d83c46ed8262bf62.png
2025-09-27 17:57:08 | INFO     | backend.main:shutdown_event:217 - 重生之我是……API服务关闭
2025-09-27 17:57:09 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 17:57:10 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 17:57:10 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 17:57:10 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 17:57:10 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 17:57:10 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 17:57:10 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:57:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:57:10 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 17:57:10 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 17:57:10 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 17:57:10 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 17:57:10 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 17:57:10 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 17:57:10 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 17:57:10 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 17:57:10 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 17:57:10 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 17:57:10 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 17:57:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 17:57:11 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 17:57:11 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 17:57:11 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 17:57:11 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 17:57:11 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:18:44 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 18:18:46 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 18:18:47 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 18:18:47 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 18:18:47 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 18:18:47 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:18:47 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 18:18:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:18:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:18:47 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 18:18:47 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 18:18:47 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 18:18:47 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 18:18:47 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 18:18:47 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 18:18:47 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 18:18:47 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 18:18:47 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 18:18:47 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 18:18:47 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 18:18:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:18:48 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 18:18:48 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 18:18:48 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 18:18:48 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 18:18:48 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:21:48 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 18:21:50 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 18:21:51 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 18:21:51 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 18:21:51 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 18:21:51 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:21:51 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 18:21:51 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:21:51 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:21:51 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 18:21:51 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 18:21:51 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 18:21:51 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 18:21:51 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 18:21:51 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 18:21:51 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 18:21:51 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 18:21:51 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 18:21:51 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 18:21:51 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 18:21:52 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:21:52 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 18:21:52 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 18:21:52 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 18:21:52 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 18:21:52 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:22:36 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 18:22:38 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 18:22:39 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 18:22:39 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 18:22:39 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 18:22:39 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:22:39 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 18:22:39 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:22:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:22:39 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 18:22:39 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 18:22:39 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 18:22:39 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 18:22:39 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 18:22:39 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 18:22:39 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 18:22:39 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 18:22:39 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 18:22:39 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 18:22:39 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 18:22:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:22:40 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 18:22:40 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 18:22:40 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 18:22:40 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 18:22:40 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:23:42 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 18:23:43 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 18:23:44 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 18:23:44 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 18:23:44 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 18:23:44 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 18:23:44 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 18:23:44 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:23:44 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:23:44 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 18:23:44 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 18:23:44 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 18:23:44 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 18:23:44 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 18:23:44 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 18:23:44 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 18:23:44 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 18:23:44 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 18:23:44 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 18:23:44 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 18:23:45 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 18:23:45 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 18:23:45 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 18:23:45 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 18:23:45 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 18:23:45 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:19:36 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:19:37 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:19:38 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:19:38 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:19:38 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:19:38 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:19:38 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:19:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:19:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:19:38 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:19:38 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:19:38 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:19:38 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:19:38 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:19:38 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:19:38 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:19:38 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:19:38 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:19:38 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:19:38 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:19:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:19:39 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:19:39 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:19:39 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:19:39 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:19:39 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:19:47 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:19:48 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:19:49 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:19:49 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:19:49 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:19:49 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:19:49 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:19:49 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:19:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:19:49 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:19:49 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:19:49 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:19:49 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:19:49 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:19:49 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:19:49 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:19:49 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:19:49 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:19:49 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:19:49 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:19:49 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:19:50 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:19:50 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:19:50 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:19:50 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:19:50 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:20:00 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:20:01 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:20:02 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:20:02 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:20:02 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:20:02 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:20:02 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:20:02 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:20:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:20:02 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:20:02 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:20:02 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:20:02 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:20:02 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:20:02 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:20:02 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:20:02 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:20:02 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:20:02 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:20:02 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:20:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:20:03 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:20:03 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:20:03 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:20:03 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:20:03 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:21:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-27 19:23:45 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:23:46 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:23:47 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:23:47 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:23:47 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:23:47 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:23:47 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:23:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:23:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:23:47 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:23:47 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:23:47 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:23:47 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:23:47 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:23:47 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:23:47 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:23:47 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:23:47 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:23:47 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:23:47 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:23:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:23:48 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:23:48 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:23:48 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:23:48 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:23:48 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:24:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-27 19:25:09 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:25:10 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:25:11 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:25:11 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:25:11 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:25:11 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:25:11 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:25:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:25:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:25:11 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:25:11 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:25:11 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:25:11 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:25:11 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:25:11 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:25:11 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:25:11 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:25:11 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:25:11 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:25:11 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:25:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:25:12 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:25:12 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:25:12 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:25:12 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:25:12 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:07 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:26:08 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:26:09 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:26:09 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:26:09 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:26:09 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:09 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:26:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:09 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:26:09 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:26:09 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:26:09 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:26:09 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:26:09 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:26:09 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:26:09 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:26:09 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:26:09 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:26:09 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:26:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:10 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:26:10 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:26:10 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:26:10 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:26:10 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:14 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:26:15 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:26:15 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:26:15 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:26:15 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:26:15 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:15 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:26:15 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:16 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:26:16 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:26:16 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:26:16 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:26:16 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:26:16 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:26:16 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:26:16 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:26:16 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:26:16 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:26:16 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:26:16 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:16 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:26:16 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:26:16 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:26:16 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:26:16 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:21 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:26:22 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:26:23 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:26:23 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:26:23 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:26:23 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:23 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:26:23 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:23 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:23 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:26:23 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:26:23 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:26:23 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:26:23 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:26:23 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:26:23 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:26:23 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:26:23 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:26:23 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:26:23 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:26:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:24 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:26:24 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:26:24 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:26:24 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:26:24 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:44 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:26:45 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:26:46 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:26:46 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:26:46 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:26:46 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:26:46 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:26:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:46 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:26:46 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:26:46 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:26:46 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:26:46 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:26:46 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:26:46 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:26:46 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:26:46 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:26:46 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:26:46 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:26:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:26:47 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:26:47 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:26:47 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:26:47 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:26:47 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:27:06 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:27:07 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:27:08 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:27:08 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:27:08 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:27:08 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:27:08 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:27:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:27:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:27:08 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:27:08 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:27:08 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:27:08 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:27:08 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:27:08 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:27:08 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:27:08 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:27:08 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:27:08 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:27:08 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:27:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:27:09 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:27:09 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:27:09 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:27:09 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:27:09 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:34:06 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:34:07 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:34:08 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:34:08 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:34:08 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:34:08 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:34:08 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:34:08 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:34:08 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:34:08 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:34:08 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:34:08 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:34:08 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:34:08 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:34:08 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:34:08 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:34:08 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:34:08 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:34:08 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:34:08 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:34:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:34:09 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:34:09 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:34:09 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:34:09 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:34:09 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:45:44 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:45:45 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:45:46 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:45:46 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:45:46 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:45:46 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:45:46 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:45:46 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:45:46 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:45:47 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:45:47 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:45:47 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:45:47 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:45:47 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:45:47 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:45:47 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:45:47 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:45:47 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:45:47 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:45:47 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:45:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:45:47 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:45:47 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:45:47 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:45:47 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:45:47 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:46:36 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:46:38 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:46:38 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:46:38 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:46:38 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:46:38 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:46:38 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:46:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:46:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:46:39 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:46:39 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:46:39 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:46:39 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:46:39 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:46:39 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:46:39 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:46:39 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:46:39 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:46:39 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:46:39 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:46:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:46:39 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-27 19:46:39 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:46:39 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:46:39 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:46:39 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:46:45 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-27 19:46:46 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-27 19:46:47 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-27 19:46:47 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-27 19:46:47 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-27 19:46:47 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-27 19:46:47 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-27 19:46:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:46:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:46:47 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-27 19:46:47 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-27 19:46:47 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-27 19:46:47 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-27 19:46:47 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-27 19:46:47 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-27 19:46:47 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-27 19:46:47 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-27 19:46:47 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-27 19:46:47 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-27 19:46:47 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-27 19:46:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-27 19:46:48 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 4294967295.
2025-09-27 19:46:48 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-27 19:46:48 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-27 19:46:48 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-27 19:46:48 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
