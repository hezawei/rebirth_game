2025-09-28 14:13:36 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v12025-09-28 14:14:03 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:309 - PrepareStart start wish=项羽2025-09-28 14:14:03 | DEBUG    | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:311 - prepare context building2025-09-28 14:14:03 | DEBUG    | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=102025-09-28 14:14:03 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=5132025-09-28 14:14:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。2025-09-28 14:14:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 9102025-09-28 14:14:05 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:322 - prepare LLM done raw_len=1872025-09-28 14:14:05 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest2025-09-28 14:14:05 | DEBUG    | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:361 - prepare data parsed title=霸王重生：巨鹿烽火 quest=于三日内集结二十万楚军，震慑诸侯，确立霸主之位2025-09-28 14:14:05 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start2025-09-28 14:14:05 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf12025-09-28 14:14:05 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start2025-09-28 14:14:05 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'2025-09-28 14:14:09 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。2025-09-28 14:14:09 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 14212025-09-28 14:14:09 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=840 预览='{"text": "夜色如墨，楚营外的篝火在寒风中摇曳，项羽立于高台之上，铁甲映着火光，眉间锁着深壑。斥候急报：刘邦军已悄然绕过彭城侧翼，意图截断粮道。他握紧剑柄，耳畔是战马嘶鸣与士兵低语交织的喧嚣。若不速决，粮草将尽，士气将溃。远处传来铜铃轻响——那是敌军前哨的暗号，仿佛在嘲弄西楚的孤注一掷。他转身望向帐内那幅未完成的舆图，指尖划过一条被血迹染红的路径，心中翻涌着杀意与决断。此刻，时间如刀锋般悬于一线。", "choices": [{"option": "命人点燃三面烽火，佯装主力南撤，引敌军追击至伏击圈", "summary": "以声东击西之计诱敌深入，布下天罗地网", "effects'2025-09-28 14:14:09 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=840 预览='{"text": "夜色如墨，楚营外的篝火在寒风中摇曳，项羽立于高台之上，铁甲映着火光，眉间锁着深壑。斥候急报：刘邦军已悄然绕过彭城侧翼，意图截断粮道。他握紧剑柄，耳畔是战马嘶鸣与士兵低语交织的喧嚣。若不速决，粮草将尽，士气将溃。远处传来铜铃轻响——那是敌军前哨的暗号，仿佛在嘲弄西楚的孤注一掷。他转身望向帐内那幅未完成'2025-09-28 14:14:09 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=840 预览='{"text": "夜色如墨，楚营外的篝火在寒风中摇曳，项羽立于高台之上，铁甲映着火光，眉间锁着深壑。斥候急报：刘邦军已悄然绕过彭城侧翼，意图截断粮道。他握紧剑柄，耳畔是战马嘶鸣与士兵低语交织的喧嚣。若不速决，粮草将尽，士气将溃。远处传来铜铃轻响——那是敌军前哨的暗号，仿佛在嘲弄西楚的孤注一掷。他转身望向帐内那幅未完成'2025-09-28 14:14:09 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=1942025-09-28 14:14:09 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=194 preview="夜色如墨，楚营外的篝火在寒风中摇曳，项羽立于高台之上，铁甲映着火光，眉间锁着深壑。斥候急报：刘邦军已悄然绕过彭城侧翼，意图截断粮道。他握紧剑柄，耳畔是战马嘶鸣与士兵低语交织的喧嚣。若不速决，粮草将尽，士气将溃。远处传来铜铃轻响——那是敌军前哨的暗号，仿佛在嘲弄西楚的孤注一掷。他转身望向帐内那幅未完成的舆图，指尖划过一条被血迹染红的路径，心中翻涌着杀意与决断。此刻，时间如刀锋般悬于一线。"
2025-09-28 14:14:09 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai2025-09-28 14:14:10 | INFO     | core.image_storage:__init__:34 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images2025-09-28 14:14:10 | INFO     | core.image_storage:__init__:35 - 图像web访问前缀: http://127.0.0.1:8000/static/generated2025-09-28 14:14:10 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，楚营外的篝火在寒风中摇曳，项羽立于高台之上，铁甲映着火光，眉间锁着深壑。斥候急报：刘邦军已悄然绕过彭城侧翼，意图截断粮道。他握紧剑柄，…"
2025-09-28 14:14:10 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，楚营外的篝火在...2025-09-28 14:14:21 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)2025-09-28 14:14:21 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73
2025-09-28 14:14:21 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759040061068_806.png2025-09-28 14:14:21 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759040061068_806.png
2025-09-28 14:14:21 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759040061068_806.png2025-09-28 14:14:22 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.png (大小: 1024722 字节)2025-09-28 14:14:22 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp 大小 48174 字节 (原始 1024722 字节, 压缩比 0.05)2025-09-28 14:14:22 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.png2025-09-28 14:14:22 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp2025-09-28 14:14:22 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp2025-09-28 14:14:22 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp
2025-09-28 14:14:22 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp2025-09-28 14:14:22 | INFO     | core.story_engine:start_story:447 - 新故事生成成功2025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=1942025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:118 - pregeneration session created2025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 node=51 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:123 - pregeneration node created2025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 node=51 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:126 - pregeneration node imageimage=http://127.0.0.1:8000/static/generated/ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp2025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 node=51 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:135 - pregeneration cache stored2025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 node=51 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:140 - pregeneration speculation enqueueddepth=02025-09-28 14:14:22 | INFO     | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 node=51 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:142 - pregeneration done2025-09-28 14:14:22 | DEBUG    | trace=a40fd36f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=11 node=51 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed2025-09-28 14:20:23 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭2025-09-28 14:20:24 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）2025-09-28 14:20:25 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}2025-09-28 14:20:25 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)2025-09-28 14:20:25 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-282025-09-28 14:20:25 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v12025-09-28 14:20:25 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成2025-09-28 14:20:25 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth2025-09-28 14:20:25 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth2025-09-28 14:20:25 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)2025-09-28 14:20:25 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)2025-09-28 14:20:25 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png2025-09-28 14:20:25 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images2025-09-28 14:20:25 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json2025-09-28 14:20:25 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs2025-09-28 14:20:25 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect2025-09-28 14:20:25 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc2025-09-28 14:20:25 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated2025-09-28 14:20:25 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static2025-09-28 14:20:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth2025-09-28 14:20:25 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head2025-09-28 14:20:26 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.2025-09-28 14:20:26 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动2025-09-28 14:20:26 | INFO     | backend.main:startup_event:239 - 调试模式: True2025-09-28 14:20:26 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-282025-09-28 14:20:26 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v12025-09-28 14:26:16 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭2025-09-28 14:26:17 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 14:26:18 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 14:26:18 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 14:26:18 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 14:26:18 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 14:26:18 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 14:26:18 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 14:26:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 14:26:19 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 14:26:19 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 14:26:19 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 14:26:19 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 14:26:19 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 14:26:19 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 14:26:19 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 14:26:19 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 14:26:19 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 14:26:19 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 14:26:19 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 14:26:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 14:26:20 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 14:26:20 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 14:26:20 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 14:26:20 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 14:26:20 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 15:08:55 | INFO     | api.user:refresh_access_token:127 - 用户 %s 发起令牌续期
2025-09-28 15:08:55 | DEBUG    | api.user:refresh_access_token:129 - 续期成功: expires_in=%s
2025-09-28 19:53:00 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 19:53:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 19:53:10 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 19:53:11 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 19:53:11 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 19:53:11 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 19:53:11 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 19:53:11 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 19:53:11 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 19:53:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 19:53:11 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 19:53:11 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 19:53:11 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 19:53:11 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 19:53:11 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 19:53:11 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 19:53:11 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 19:53:11 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 19:53:11 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 19:53:11 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 19:53:11 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 19:53:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 19:53:12 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 19:53:12 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 19:53:12 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 19:53:12 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 19:53:12 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 19:53:40 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:309 - PrepareStart start wish=项羽
2025-09-28 19:53:40 | DEBUG    | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:311 - prepare context building
2025-09-28 19:53:40 | DEBUG    | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=10
2025-09-28 19:53:40 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=513
2025-09-28 19:53:41 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:53:41 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 918
2025-09-28 19:53:41 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:322 - prepare LLM done raw_len=192
2025-09-28 19:53:41 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 19:53:41 | DEBUG    | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:361 - prepare data parsed title=霸王重生：巨鹿之誓 quest=率军攻陷巨鹿城，重建西楚威信
2025-09-28 19:53:41 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 19:53:41 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 19:53:41 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start
2025-09-28 19:53:41 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-28 19:53:45 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:53:45 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1449
2025-09-28 19:53:45 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=885 预览='{"text": "垓下寒夜，朔风如刀。楚军残部蜷缩于荒丘，战马嘶鸣声渐弱，粮尽箭绝。项羽独坐帐中，青铜剑横于膝上，目光凝视着远处汉营灯火如星。他听见亲兵低声禀报：‘东边哨骑传来消息，有老卒携家眷欲投汉营，言‘霸王已失人心’。’项羽猛然攥紧剑柄，指节发白。他知，这非仅一队逃兵，而是人心将溃的先兆。若此刻不立威，明日便再无将士愿随其死战。他缓缓起身，披上那件染血的玄甲，走向帐外——月光如霜，照见他孤影矗立，仿佛一尊不肯倒下的战神。", "choices": [{"option": "当众斩杀一名欲逃的老卒，将其头颅悬于旗杆，以儆效尤", "summary": "以雷霆手段震慑军心，彰显霸王不容挑'
2025-09-28 19:53:45 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=885 预览='{"text": "垓下寒夜，朔风如刀。楚军残部蜷缩于荒丘，战马嘶鸣声渐弱，粮尽箭绝。项羽独坐帐中，青铜剑横于膝上，目光凝视着远处汉营灯火如星。他听见亲兵低声禀报：‘东边哨骑传来消息，有老卒携家眷欲投汉营，言‘霸王已失人心’。’项羽猛然攥紧剑柄，指节发白。他知，这非仅一队逃兵，而是人心将溃的先兆。若此刻不立威，明日便再'
2025-09-28 19:53:45 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=885 预览='{"text": "垓下寒夜，朔风如刀。楚军残部蜷缩于荒丘，战马嘶鸣声渐弱，粮尽箭绝。项羽独坐帐中，青铜剑横于膝上，目光凝视着远处汉营灯火如星。他听见亲兵低声禀报：‘东边哨骑传来消息，有老卒携家眷欲投汉营，言‘霸王已失人心’。’项羽猛然攥紧剑柄，指节发白。他知，这非仅一队逃兵，而是人心将溃的先兆。若此刻不立威，明日便再'
2025-09-28 19:53:45 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=206
2025-09-28 19:53:45 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=206 preview="垓下寒夜，朔风如刀。楚军残部蜷缩于荒丘，战马嘶鸣声渐弱，粮尽箭绝。项羽独坐帐中，青铜剑横于膝上，目光凝视着远处汉营灯火如星。他听见亲兵低声禀报：‘东边哨骑传来消息，有老卒携家眷欲投汉营，言‘霸王已失人心’。’项羽猛然攥紧剑柄，指节发白。他知，这非仅一队逃兵，而是人心将溃的先兆。若此刻不立威，明日便再无将士愿随其死战。他缓缓起身，披上那件染血的玄甲，走向帐外——月光如霜，照见他孤影矗立，仿佛一尊不肯…"

2025-09-28 19:53:45 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-28 19:53:45 | INFO     | core.image_storage:__init__:34 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images

2025-09-28 19:53:45 | INFO     | core.image_storage:__init__:35 - 图像web访问前缀: http://127.0.0.1:8000/static/generated

2025-09-28 19:53:45 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 垓下寒夜，朔风如刀。楚军残部蜷缩于荒丘，战马嘶鸣声渐弱，粮尽箭绝。项羽独坐帐中，青铜剑横于膝上，目光凝视着远处汉营灯火如星。他听见亲兵低声禀报：…"

2025-09-28 19:53:45 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 垓下寒夜，朔风如刀。楚军...
2025-09-28 19:53:58 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 19:53:58 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:53:58 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060437963_743.png
2025-09-28 19:53:58 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060437963_743.png

2025-09-28 19:53:58 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060437963_743.png

2025-09-28 19:53:59 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_fde546289195bf9a900e588c602c48bc.png (大小: 1421861 字节)

2025-09-28 19:54:00 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_fde546289195bf9a900e588c602c48bc.webp 大小 76824 字节 (原始 1421861 字节, 压缩比 0.05)

2025-09-28 19:54:00 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_fde546289195bf9a900e588c602c48bc.png

2025-09-28 19:54:00 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp

2025-09-28 19:54:00 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_fde546289195bf9a900e588c602c48bc.webp

2025-09-28 19:54:00 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp

2025-09-28 19:54:00 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:00 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=206
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:118 - pregeneration session created
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:123 - pregeneration node created
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:126 - pregeneration node imageimage=http://127.0.0.1:8000/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:135 - pregeneration cache stored
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:140 - pregeneration speculation enqueueddepth=0
2025-09-28 19:54:00 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:142 - pregeneration done
2025-09-28 19:54:00 | DEBUG    | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed
2025-09-28 19:54:04 | INFO     | trace=480ec784 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:432 - start request wish=项羽
2025-09-28 19:54:04 | DEBUG    | trace=480ec784 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:435 - start wish validated
2025-09-28 19:54:04 | DEBUG    | trace=480ec784 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:439 - start cache keycache_key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 19:54:04 | DEBUG    | api.story:_cache_pop:92 - [预生成] 从缓存中取出 key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:455 - start trace resumed
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:456 - start cache first hithit=True
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=start wish=项羽 | api.story:start_new_story:473 - start use pregenerated
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=start wish=项羽 | api.story:start_new_story:494 - start use cached nodesession_id=12 node_id=52
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=start wish=项羽 | api.story:start_new_story:554 - start donetext_len=206 choice_count=3 image=http://127.0.0.1:8000/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=start wish=项羽 | api.story:start_new_story:561 - start image filefile_exists=True size=76824 path=C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=start wish=项羽 | api.story:start_new_story:564 - start speculation enqueuedepth=1
2025-09-28 19:54:04 | DEBUG    | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=52 depth=1
2025-09-28 19:54:04 | INFO     | trace=66200da6 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=start wish=项羽 | api.story:start_new_story:567 - start response readyimage=http://127.0.0.1:8000/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:04 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_fde546289195bf9a900e588c602c48bc.webp exists=True size=76824
2025-09-28 19:54:04 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:04 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=52
2025-09-28 19:54:04 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=52 | choice="当众斩杀一名欲逃的老卒，将其头颅悬于旗杆，以儆效尤"
2025-09-28 19:54:04 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=52 | choice="召来所有将领与士卒，亲口讲述巨鹿之战的火光与怒吼，重燃战魂"
2025-09-28 19:54:04 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 当众斩杀一名欲逃的老卒，将其头颅悬于旗杆，以儆效尤
2025-09-28 19:54:04 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=52 | choice="悄然命人释放几名逃兵，附上一封亲笔信，劝他们归去后传话‘霸王未死，尚在等你归来’"
2025-09-28 19:54:04 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 召来所有将领与士卒，亲口讲述巨鹿之战的火光与怒吼，重燃战魂
2025-09-28 19:54:04 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然命人释放几名逃兵，附上一封亲笔信，劝他们归去后传话‘霸王未死，尚在等你归来’
2025-09-28 19:54:04 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:54:08 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:54:08 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1629
2025-09-28 19:54:08 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=875 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，目光如刃扫过溃散的军营。他听见远处传来孩童啼哭，一老卒抱着襁褓在雪中踉跄前行，身后是数名欲逃的兵士。他缓缓抽出青铜剑，剑尖指向天穹，声音低沉如雷：‘若今日不斩一人以儆效尤，明日便是全军尽溃。’话音未落，他猛然挥剑劈向地面，裂土三尺，血痕渗入冻土。士兵们惊惧跪伏，连风都似凝滞。可那老卒仍执拗前行，怀中婴孩睁眼望向这战神般的身影——项羽忽然顿住，剑尖微颤，仿佛听见了什么不该听的回响。", "choices": [{"option": "命人将老卒与婴孩押至阵前，当众问罪并处决，以儆效尤", "summary": "以雷霆手段震慑军心，但可能激起隐'
2025-09-28 19:54:08 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=875 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，目光如刃扫过溃散的军营。他听见远处传来孩童啼哭，一老卒抱着襁褓在雪中踉跄前行，身后是数名欲逃的兵士。他缓缓抽出青铜剑，剑尖指向天穹，声音低沉如雷：‘若今日不斩一人以儆效尤，明日便是全军尽溃。’话音未落，他猛然挥剑劈向地面，裂土三尺，血痕渗入冻土。士兵们惊惧跪伏，连风都'
2025-09-28 19:54:08 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=875 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，目光如刃扫过溃散的军营。他听见远处传来孩童啼哭，一老卒抱着襁褓在雪中踉跄前行，身后是数名欲逃的兵士。他缓缓抽出青铜剑，剑尖指向天穹，声音低沉如雷：‘若今日不斩一人以儆效尤，明日便是全军尽溃。’话音未落，他猛然挥剑劈向地面，裂土三尺，血痕渗入冻土。士兵们惊惧跪伏，连风都'
2025-09-28 19:54:08 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=207
2025-09-28 19:54:08 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=207 preview="寒风卷起残旗，项羽立于荒丘之巅，目光如刃扫过溃散的军营。他听见远处传来孩童啼哭，一老卒抱着襁褓在雪中踉跄前行，身后是数名欲逃的兵士。他缓缓抽出青铜剑，剑尖指向天穹，声音低沉如雷：‘若今日不斩一人以儆效尤，明日便是全军尽溃。’话音未落，他猛然挥剑劈向地面，裂土三尺，血痕渗入冻土。士兵们惊惧跪伏，连风都似凝滞。可那老卒仍执拗前行，怀中婴孩睁眼望向这战神般的身影——项羽忽然顿住，剑尖微颤，仿佛听见了什么…"

2025-09-28 19:54:08 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起残旗，项羽立于荒丘之巅，目光如刃扫过溃散的军营。他听见远处传来孩童啼哭，一老卒抱着襁褓在雪中踉跄前行，身后是数名欲逃的兵士。他缓缓抽出青…"

2025-09-28 19:54:08 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起残旗，项羽立于荒...
2025-09-28 19:54:08 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:54:08 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1635
2025-09-28 19:54:08 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=872 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，玄甲映着冷月，如铁铸的孤峰。他凝视远方汉营灯火，忽而仰天长啸，声震四野，似要撕裂这无边夜色。亲兵惊惧跪地，却见他骤然收声，转身走向那群欲投敌的老卒。他未拔剑，只以剑尖轻点地面，低语：‘你们走，我留。’话音未落，一骑疾驰而来，马蹄踏碎霜雪——是探子回报：刘邦军中已传檄楚将降者不杀，且封侯赐田。项羽眸光一闪，仿佛刀锋出鞘。他知，人心可失，但霸业不可废。此刻，他必须做出抉择：是放他们离去，以保最后一点体面；还是以雷霆手段震慑军心？", "choices": [{"option": "命人将老卒绑缚于火堆前，当众宣读楚律，以示军纪如山", "summ'
2025-09-28 19:54:08 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=872 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，玄甲映着冷月，如铁铸的孤峰。他凝视远方汉营灯火，忽而仰天长啸，声震四野，似要撕裂这无边夜色。亲兵惊惧跪地，却见他骤然收声，转身走向那群欲投敌的老卒。他未拔剑，只以剑尖轻点地面，低语：‘你们走，我留。’话音未落，一骑疾驰而来，马蹄踏碎霜雪——是探子回报：刘邦军中已传檄楚'
2025-09-28 19:54:08 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=872 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，玄甲映着冷月，如铁铸的孤峰。他凝视远方汉营灯火，忽而仰天长啸，声震四野，似要撕裂这无边夜色。亲兵惊惧跪地，却见他骤然收声，转身走向那群欲投敌的老卒。他未拔剑，只以剑尖轻点地面，低语：‘你们走，我留。’话音未落，一骑疾驰而来，马蹄踏碎霜雪——是探子回报：刘邦军中已传檄楚'
2025-09-28 19:54:08 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=230
2025-09-28 19:54:08 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=230 preview="寒风卷起残旗，项羽立于荒丘之巅，玄甲映着冷月，如铁铸的孤峰。他凝视远方汉营灯火，忽而仰天长啸，声震四野，似要撕裂这无边夜色。亲兵惊惧跪地，却见他骤然收声，转身走向那群欲投敌的老卒。他未拔剑，只以剑尖轻点地面，低语：‘你们走，我留。’话音未落，一骑疾驰而来，马蹄踏碎霜雪——是探子回报：刘邦军中已传檄楚将降者不杀，且封侯赐田。项羽眸光一闪，仿佛刀锋出鞘。他知，人心可失，但霸业不可废。此刻，他必须做出抉…"

2025-09-28 19:54:08 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起残旗，项羽立于荒丘之巅，玄甲映着冷月，如铁铸的孤峰。他凝视远方汉营灯火，忽而仰天长啸，声震四野，似要撕裂这无边夜色。亲兵惊惧跪地，却见他…"

2025-09-28 19:54:08 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起残旗，项羽立于荒...
2025-09-28 19:54:09 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:54:09 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1636
2025-09-28 19:54:09 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=898 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，青铜剑锋映着冷月。他听见远处传来孩童的啼哭，循声望去，一队老卒携家眷蜷缩在断墙之下，衣衫褴褛，眼中尽是恐惧与绝望。那声音如刀，割裂了军心最后的屏障。他缓缓抽出佩剑，剑尖指向天际，低语如雷：‘若我今日不斩一人以儆效尤，明日便再无人愿为楚死。’他转身走向那群逃兵，玄甲在月下如墨，每一步都踏碎寂静。风停了，天地间只剩一声长叹——这并非杀戮，而是一场祭礼。", "choices": [{"option": "当众将那带头逃亡的老卒推上断头台，以血洗军心", "summary": "以残酷震慑动摇者，重燃士气", "effects": {"delta_'
2025-09-28 19:54:09 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=898 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，青铜剑锋映着冷月。他听见远处传来孩童的啼哭，循声望去，一队老卒携家眷蜷缩在断墙之下，衣衫褴褛，眼中尽是恐惧与绝望。那声音如刀，割裂了军心最后的屏障。他缓缓抽出佩剑，剑尖指向天际，低语如雷：‘若我今日不斩一人以儆效尤，明日便再无人愿为楚死。’他转身走向那群逃兵，玄甲在月'
2025-09-28 19:54:09 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=898 预览='{"text": "寒风卷起残旗，项羽立于荒丘之巅，青铜剑锋映着冷月。他听见远处传来孩童的啼哭，循声望去，一队老卒携家眷蜷缩在断墙之下，衣衫褴褛，眼中尽是恐惧与绝望。那声音如刀，割裂了军心最后的屏障。他缓缓抽出佩剑，剑尖指向天际，低语如雷：‘若我今日不斩一人以儆效尤，明日便再无人愿为楚死。’他转身走向那群逃兵，玄甲在月'
2025-09-28 19:54:09 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=191
2025-09-28 19:54:09 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=191 preview="寒风卷起残旗，项羽立于荒丘之巅，青铜剑锋映着冷月。他听见远处传来孩童的啼哭，循声望去，一队老卒携家眷蜷缩在断墙之下，衣衫褴褛，眼中尽是恐惧与绝望。那声音如刀，割裂了军心最后的屏障。他缓缓抽出佩剑，剑尖指向天际，低语如雷：‘若我今日不斩一人以儆效尤，明日便再无人愿为楚死。’他转身走向那群逃兵，玄甲在月下如墨，每一步都踏碎寂静。风停了，天地间只剩一声长叹——这并非杀戮，而是一场祭礼。"

2025-09-28 19:54:09 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起残旗，项羽立于荒丘之巅，青铜剑锋映着冷月。他听见远处传来孩童的啼哭，循声望去，一队老卒携家眷蜷缩在断墙之下，衣衫褴褛，眼中尽是恐惧与绝望…"

2025-09-28 19:54:09 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起残旗，项羽立于荒...
2025-09-28 19:54:18 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 796 (attempt 1/2)
2025-09-28 19:54:18 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=189

2025-09-28 19:54:18 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: {"usageMetadata":{"promptTokenCount":214,"totalTokenCount":214,"trafficType":"ON_DEMAND","promptTokensDetails":[{"modality":"TEXT","tokenCount":214}]}}
Vertex AI 过滤了你的请求内容，无法生成回复，请更换内容后再重试!...
2025-09-28 19:54:18 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:54:18 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:54:18 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=cyberpunk_city.jpg | url=http://127.0.0.1:8000/static/cyberpunk_city.jpg
2025-09-28 19:54:18 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/cyberpunk_city.jpg
2025-09-28 19:54:18 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:54:18 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=52 | choice="召来所有将领与士卒，亲口讲述巨鹿之战的火光与怒吼，重燃战魂" | text_len=207 | text="寒风卷起残旗，项羽立于荒丘之巅，目光如刃扫过溃散的军营。他听见远处传来孩童啼哭，一老卒抱着襁褓在雪中踉跄前行，身后是数名欲逃的兵士。他缓缓抽出青铜剑，剑尖指向天穹，声音低沉如雷：‘若今日不斩一人以儆效尤，明日便是全军尽溃。’话音未落，他猛然挥剑劈向地面，裂土三尺，血痕渗入冻土。士兵们惊惧跪伏，连风都似凝滞。可那老卒仍执拗前行，怀中婴孩睁眼望向这战神般的身影——项羽忽然顿住，剑尖微颤，仿佛听见了什么不该听的回响。"
2025-09-28 19:54:18 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=52 | choice="召来所有将领与士卒，亲口讲述巨鹿之战的火光与怒吼，重燃战魂" | node=53 | text_len=207 | image=http://127.0.0.1:8000/static/cyberpunk_city.jpg
2025-09-28 19:54:20 | INFO     | trace=b3e554c5 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=52 task=continue | api.story:continue_existing_story:595 - continue requestchoice=当众斩杀一名欲逃的老卒，将其头颅悬于旗杆，以儆效尤
2025-09-28 19:54:21 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 749 (attempt 1/2)
2025-09-28 19:54:21 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=115

2025-09-28 19:54:21 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060461215_533.png
2025-09-28 19:54:21 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060461215_533.png

2025-09-28 19:54:21 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060461215_533.png

2025-09-28 19:54:23 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.png (大小: 1203356 字节)

2025-09-28 19:54:23 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp 大小 49750 字节 (原始 1203356 字节, 压缩比 0.04)

2025-09-28 19:54:23 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.png

2025-09-28 19:54:23 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp

2025-09-28 19:54:23 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp

2025-09-28 19:54:23 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp

2025-09-28 19:54:23 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 19:54:23 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:54:23 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=52 | choice="当众斩杀一名欲逃的老卒，将其头颅悬于旗杆，以儆效尤" | text_len=191 | text="寒风卷起残旗，项羽立于荒丘之巅，青铜剑锋映着冷月。他听见远处传来孩童的啼哭，循声望去，一队老卒携家眷蜷缩在断墙之下，衣衫褴褛，眼中尽是恐惧与绝望。那声音如刀，割裂了军心最后的屏障。他缓缓抽出佩剑，剑尖指向天际，低语如雷：‘若我今日不斩一人以儆效尤，明日便再无人愿为楚死。’他转身走向那群逃兵，玄甲在月下如墨，每一步都踏碎寂静。风停了，天地间只剩一声长叹——这并非杀戮，而是一场祭礼。"
2025-09-28 19:54:23 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=52 | choice="当众斩杀一名欲逃的老卒，将其头颅悬于旗杆，以儆效尤" | node=54 | text_len=191 | image=http://127.0.0.1:8000/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 19:54:23 | INFO     | trace=b3e554c5 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=54 task=continue | api.story:continue_existing_story:641 - continue node ready check
2025-09-28 19:54:23 | INFO     | api.story:_wait_for_node_complete:165 - [NodeComplete] 开始等待节点完全准备：node_id=54
2025-09-28 19:54:23 | INFO     | api.story:_wait_for_node_complete:218 - [NodeComplete] ✅ 节点完全准备就绪：node_id=54 (等待了 0.0 秒)
2025-09-28 19:54:23 | INFO     | trace=b3e554c5 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=54 task=continue | api.story:continue_existing_story:644 - continue node ready success
2025-09-28 19:54:23 | INFO     | trace=b3e554c5 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=54 task=continue | api.story:continue_existing_story:653 - continue speculation enqueue existingdepth=1
2025-09-28 19:54:23 | DEBUG    | trace=b3e554c5 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=54 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=54 depth=1
2025-09-28 19:54:23 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp exists=True size=49750
2025-09-28 19:54:23 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 19:54:23 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 19:54:23 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=54
2025-09-28 19:54:23 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=54 | choice="当众将那带头逃亡的老卒推上断头台，以血洗军心"
2025-09-28 19:54:23 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 当众将那带头逃亡的老卒推上断头台，以血洗军心
2025-09-28 19:54:23 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=54 | choice="命人取来干粮与布帛，亲自将食物分给逃兵，言道：‘楚虽败，仍护苍生’"
2025-09-28 19:54:23 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=54 | choice="悄然放走那队逃兵，却暗中遣亲卫尾随，探明其去向与汉营动向"
2025-09-28 19:54:23 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人取来干粮与布帛，亲自将食物分给逃兵，言道：‘楚虽败，仍护苍生’
2025-09-28 19:54:23 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然放走那队逃兵，却暗中遣亲卫尾随，探明其去向与汉营动向
2025-09-28 19:54:25 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 664 (attempt 1/2)
2025-09-28 19:54:25 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:54:25 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060463966_426.png
2025-09-28 19:54:25 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060463966_426.png

2025-09-28 19:54:25 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060463966_426.png

2025-09-28 19:54:26 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_16629dea7455815ef60ab6a2c03f3834.png (大小: 1552379 字节)

2025-09-28 19:54:26 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_16629dea7455815ef60ab6a2c03f3834.webp 大小 66822 字节 (原始 1552379 字节, 压缩比 0.04)

2025-09-28 19:54:26 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_16629dea7455815ef60ab6a2c03f3834.png

2025-09-28 19:54:26 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_16629dea7455815ef60ab6a2c03f3834.webp

2025-09-28 19:54:26 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_16629dea7455815ef60ab6a2c03f3834.webp

2025-09-28 19:54:26 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_16629dea7455815ef60ab6a2c03f3834.webp

2025-09-28 19:54:26 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_16629dea7455815ef60ab6a2c03f3834.webp
2025-09-28 19:54:26 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:54:26 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=52 | choice="悄然命人释放几名逃兵，附上一封亲笔信，劝他们归去后传话‘霸王未死，尚在等你归来’" | text_len=230 | text="寒风卷起残旗，项羽立于荒丘之巅，玄甲映着冷月，如铁铸的孤峰。他凝视远方汉营灯火，忽而仰天长啸，声震四野，似要撕裂这无边夜色。亲兵惊惧跪地，却见他骤然收声，转身走向那群欲投敌的老卒。他未拔剑，只以剑尖轻点地面，低语：‘你们走，我留。’话音未落，一骑疾驰而来，马蹄踏碎霜雪——是探子回报：刘邦军中已传檄楚将降者不杀，且封侯赐田。项羽眸光一闪，仿佛刀锋出鞘。他知，人心可失，但霸业不可废。此刻，他必须做出抉择：是放他们离去，以保最后一点体面；还是以雷霆手段震慑军心？"
2025-09-28 19:54:26 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=52 | choice="悄然命人释放几名逃兵，附上一封亲笔信，劝他们归去后传话‘霸王未死，尚在等你归来’" | node=55 | text_len=230 | image=http://127.0.0.1:8000/static/generated/ai_gen_16629dea7455815ef60ab6a2c03f3834.webp
2025-09-28 19:54:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:54:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1815
2025-09-28 19:54:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=872 预览='{"text": "项羽立于断墙之前，青铜剑缓缓下压，血光在月色中溅起如墨花。老卒头颅被高悬旗杆，风过处，残发轻扬，仿佛仍在哀鸣。楚军将士默然伫立，目光低垂，却无人敢动。那孩童的啼哭戛然而止，仿佛天地也为之屏息。项羽凝视着远方汉营灯火，低语：‘人心若散，纵有千军万马，亦不过一具空壳。’他转身，玄甲在寒夜中如黑铁铸成，每一步都踏碎寂静。风再起时，卷动残旗，似有万千冤魂低语。他未回头，只将剑锋指向天际——那是对命运的宣战，也是对自身孤独的祭奠。", "choices": [{"option": "命人将老卒遗骸火化，以灰烬入酒，分饮全军，宣告亡者为忠魂", "summary": "以悲壮仪式转化恐'
2025-09-28 19:54:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=872 预览='{"text": "项羽立于断墙之前，青铜剑缓缓下压，血光在月色中溅起如墨花。老卒头颅被高悬旗杆，风过处，残发轻扬，仿佛仍在哀鸣。楚军将士默然伫立，目光低垂，却无人敢动。那孩童的啼哭戛然而止，仿佛天地也为之屏息。项羽凝视着远方汉营灯火，低语：‘人心若散，纵有千军万马，亦不过一具空壳。’他转身，玄甲在寒夜中如黑铁铸成，每'
2025-09-28 19:54:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=872 预览='{"text": "项羽立于断墙之前，青铜剑缓缓下压，血光在月色中溅起如墨花。老卒头颅被高悬旗杆，风过处，残发轻扬，仿佛仍在哀鸣。楚军将士默然伫立，目光低垂，却无人敢动。那孩童的啼哭戛然而止，仿佛天地也为之屏息。项羽凝视着远方汉营灯火，低语：‘人心若散，纵有千军万马，亦不过一具空壳。’他转身，玄甲在寒夜中如黑铁铸成，每'
2025-09-28 19:54:28 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=212
2025-09-28 19:54:28 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=212 preview="项羽立于断墙之前，青铜剑缓缓下压，血光在月色中溅起如墨花。老卒头颅被高悬旗杆，风过处，残发轻扬，仿佛仍在哀鸣。楚军将士默然伫立，目光低垂，却无人敢动。那孩童的啼哭戛然而止，仿佛天地也为之屏息。项羽凝视着远方汉营灯火，低语：‘人心若散，纵有千军万马，亦不过一具空壳。’他转身，玄甲在寒夜中如黑铁铸成，每一步都踏碎寂静。风再起时，卷动残旗，似有万千冤魂低语。他未回头，只将剑锋指向天际——那是对命运的宣战…"

2025-09-28 19:54:28 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于断墙之前，青铜剑缓缓下压，血光在月色中溅起如墨花。老卒头颅被高悬旗杆，风过处，残发轻扬，仿佛仍在哀鸣。楚军将士默然伫立，目光低垂，却无人…"

2025-09-28 19:54:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于断墙之前，青铜剑...
2025-09-28 19:54:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:54:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1830
2025-09-28 19:54:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=889 预览='{"text": "项羽缓步走近那群瑟缩的逃兵，玄甲在月光下泛着冷光。他俯身，从老卒颤抖的手中夺过孩童的襁褓，将婴孩轻轻置于地上，随即拔剑，剑锋划破空气，如霜雪坠地。血滴落荒土，头颅滚入泥中，脖颈残断处犹带未尽的呜咽。他命亲兵将头颅高悬旗杆，风卷残旗，人头在夜中微微摇晃。远处军营骤然寂静，战马惊嘶，士卒低首，无人敢言。然而就在那一刻，一个年幼女童挣脱母亲怀抱，奔向旗杆，跪地抱起父亲的头颅，哭声撕裂寒夜——那声音如针，刺穿了项羽心中最后一道铁幕。", "choices": [{"option": "下令将女童押至阵前，以她为饵诱敌现身", "summary": "以残酷之法试探敌情，或动摇军心"'
2025-09-28 19:54:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=889 预览='{"text": "项羽缓步走近那群瑟缩的逃兵，玄甲在月光下泛着冷光。他俯身，从老卒颤抖的手中夺过孩童的襁褓，将婴孩轻轻置于地上，随即拔剑，剑锋划破空气，如霜雪坠地。血滴落荒土，头颅滚入泥中，脖颈残断处犹带未尽的呜咽。他命亲兵将头颅高悬旗杆，风卷残旗，人头在夜中微微摇晃。远处军营骤然寂静，战马惊嘶，士卒低首，无人敢言。'
2025-09-28 19:54:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=889 预览='{"text": "项羽缓步走近那群瑟缩的逃兵，玄甲在月光下泛着冷光。他俯身，从老卒颤抖的手中夺过孩童的襁褓，将婴孩轻轻置于地上，随即拔剑，剑锋划破空气，如霜雪坠地。血滴落荒土，头颅滚入泥中，脖颈残断处犹带未尽的呜咽。他命亲兵将头颅高悬旗杆，风卷残旗，人头在夜中微微摇晃。远处军营骤然寂静，战马惊嘶，士卒低首，无人敢言。'
2025-09-28 19:54:28 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=214
2025-09-28 19:54:28 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=214 preview="项羽缓步走近那群瑟缩的逃兵，玄甲在月光下泛着冷光。他俯身，从老卒颤抖的手中夺过孩童的襁褓，将婴孩轻轻置于地上，随即拔剑，剑锋划破空气，如霜雪坠地。血滴落荒土，头颅滚入泥中，脖颈残断处犹带未尽的呜咽。他命亲兵将头颅高悬旗杆，风卷残旗，人头在夜中微微摇晃。远处军营骤然寂静，战马惊嘶，士卒低首，无人敢言。然而就在那一刻，一个年幼女童挣脱母亲怀抱，奔向旗杆，跪地抱起父亲的头颅，哭声撕裂寒夜——那声音如针，…"

2025-09-28 19:54:28 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽缓步走近那群瑟缩的逃兵，玄甲在月光下泛着冷光。他俯身，从老卒颤抖的手中夺过孩童的襁褓，将婴孩轻轻置于地上，随即拔剑，剑锋划破空气，如霜雪坠地…"

2025-09-28 19:54:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽缓步走近那群瑟缩的逃...
2025-09-28 19:54:28 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:54:28 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1832
2025-09-28 19:54:28 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=892 预览='{"text": "项羽的剑锋划过老卒脖颈，血如墨线溅上残破的楚旗。头颅被高悬于旗杆，风卷着断发与残衣，猎猎作响。那孩童的哭声戛然而止，四周死寂如坟。亲兵跪伏，战马惊嘶，有士兵低头咬破嘴唇，却无人敢移目。项羽凝视着那颗无神的眼睛，仿佛在看自己即将崩塌的江山。他缓缓拔出剑，将剑尖插入土中，声音低沉如雷：‘今日之血，非为杀戮，乃为守心。若吾不立威，明日楚地尽成汉土。’夜风骤起，火把摇曳，映得他玄甲如铁铸，身影似山岳压境。远处，一匹孤马奔逃入黑，蹄声渐远——那是军心开始溃散的第一声回响。", "choices": [{"option": "当众焚烧敌军降书，以烈焰焚尽背叛的可能", "summary'
2025-09-28 19:54:28 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=892 预览='{"text": "项羽的剑锋划过老卒脖颈，血如墨线溅上残破的楚旗。头颅被高悬于旗杆，风卷着断发与残衣，猎猎作响。那孩童的哭声戛然而止，四周死寂如坟。亲兵跪伏，战马惊嘶，有士兵低头咬破嘴唇，却无人敢移目。项羽凝视着那颗无神的眼睛，仿佛在看自己即将崩塌的江山。他缓缓拔出剑，将剑尖插入土中，声音低沉如雷：‘今日之血，非为杀'
2025-09-28 19:54:28 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=892 预览='{"text": "项羽的剑锋划过老卒脖颈，血如墨线溅上残破的楚旗。头颅被高悬于旗杆，风卷着断发与残衣，猎猎作响。那孩童的哭声戛然而止，四周死寂如坟。亲兵跪伏，战马惊嘶，有士兵低头咬破嘴唇，却无人敢移目。项羽凝视着那颗无神的眼睛，仿佛在看自己即将崩塌的江山。他缓缓拔出剑，将剑尖插入土中，声音低沉如雷：‘今日之血，非为杀'
2025-09-28 19:54:28 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=233
2025-09-28 19:54:28 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=233 preview="项羽的剑锋划过老卒脖颈，血如墨线溅上残破的楚旗。头颅被高悬于旗杆，风卷着断发与残衣，猎猎作响。那孩童的哭声戛然而止，四周死寂如坟。亲兵跪伏，战马惊嘶，有士兵低头咬破嘴唇，却无人敢移目。项羽凝视着那颗无神的眼睛，仿佛在看自己即将崩塌的江山。他缓缓拔出剑，将剑尖插入土中，声音低沉如雷：‘今日之血，非为杀戮，乃为守心。若吾不立威，明日楚地尽成汉土。’夜风骤起，火把摇曳，映得他玄甲如铁铸，身影似山岳压境。…"

2025-09-28 19:54:28 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽的剑锋划过老卒脖颈，血如墨线溅上残破的楚旗。头颅被高悬于旗杆，风卷着断发与残衣，猎猎作响。那孩童的哭声戛然而止，四周死寂如坟。亲兵跪伏，战马…"

2025-09-28 19:54:28 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽的剑锋划过老卒脖颈，...
2025-09-28 19:54:36 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 729 (attempt 1/2)
2025-09-28 19:54:36 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=86

2025-09-28 19:54:36 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: Here's an image that captures the scene you described: 

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-28 19:54:36 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:54:36 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:54:36 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=magic_forest.jpg | url=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 19:54:36 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 19:54:36 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:54:36 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=54 | choice="悄然放走那队逃兵，却暗中遣亲卫尾随，探明其去向与汉营动向" | text_len=212 | text="项羽立于断墙之前，青铜剑缓缓下压，血光在月色中溅起如墨花。老卒头颅被高悬旗杆，风过处，残发轻扬，仿佛仍在哀鸣。楚军将士默然伫立，目光低垂，却无人敢动。那孩童的啼哭戛然而止，仿佛天地也为之屏息。项羽凝视着远方汉营灯火，低语：‘人心若散，纵有千军万马，亦不过一具空壳。’他转身，玄甲在寒夜中如黑铁铸成，每一步都踏碎寂静。风再起时，卷动残旗，似有万千冤魂低语。他未回头，只将剑锋指向天际——那是对命运的宣战，也是对自身孤独的祭奠。"
2025-09-28 19:54:36 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=54 | choice="悄然放走那队逃兵，却暗中遣亲卫尾随，探明其去向与汉营动向" | node=56 | text_len=212 | image=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 19:54:37 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 796 (attempt 1/2)
2025-09-28 19:54:37 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=189

2025-09-28 19:54:37 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: {"usageMetadata":{"promptTokenCount":244,"totalTokenCount":244,"trafficType":"ON_DEMAND","promptTokensDetails":[{"modality":"TEXT","tokenCount":244}]}}
Vertex AI 过滤了你的请求内容，无法生成回复，请更换内容后再重试!...
2025-09-28 19:54:37 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:54:37 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:54:37 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=fantasy_castle.jpg | url=http://127.0.0.1:8000/static/fantasy_castle.jpg
2025-09-28 19:54:37 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/fantasy_castle.jpg
2025-09-28 19:54:37 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:54:37 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=54 | choice="当众将那带头逃亡的老卒推上断头台，以血洗军心" | text_len=233 | text="项羽的剑锋划过老卒脖颈，血如墨线溅上残破的楚旗。头颅被高悬于旗杆，风卷着断发与残衣，猎猎作响。那孩童的哭声戛然而止，四周死寂如坟。亲兵跪伏，战马惊嘶，有士兵低头咬破嘴唇，却无人敢移目。项羽凝视着那颗无神的眼睛，仿佛在看自己即将崩塌的江山。他缓缓拔出剑，将剑尖插入土中，声音低沉如雷：‘今日之血，非为杀戮，乃为守心。若吾不立威，明日楚地尽成汉土。’夜风骤起，火把摇曳，映得他玄甲如铁铸，身影似山岳压境。远处，一匹孤马奔逃入黑，蹄声渐远——那是军心开始溃散的第一声回响。"
2025-09-28 19:54:37 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=54 | choice="当众将那带头逃亡的老卒推上断头台，以血洗军心" | node=57 | text_len=233 | image=http://127.0.0.1:8000/static/fantasy_castle.jpg
2025-09-28 19:54:38 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 796 (attempt 1/2)
2025-09-28 19:54:38 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=189

2025-09-28 19:54:38 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: {"usageMetadata":{"promptTokenCount":227,"totalTokenCount":227,"trafficType":"ON_DEMAND","promptTokensDetails":[{"modality":"TEXT","tokenCount":227}]}}
Vertex AI 过滤了你的请求内容，无法生成回复，请更换内容后再重试!...
2025-09-28 19:54:38 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:54:38 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:54:38 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=background1.jpg | url=http://127.0.0.1:8000/static/background1.jpg
2025-09-28 19:54:38 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/background1.jpg
2025-09-28 19:54:38 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:54:38 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=54 | choice="命人取来干粮与布帛，亲自将食物分给逃兵，言道：‘楚虽败，仍护苍生’" | text_len=214 | text="项羽缓步走近那群瑟缩的逃兵，玄甲在月光下泛着冷光。他俯身，从老卒颤抖的手中夺过孩童的襁褓，将婴孩轻轻置于地上，随即拔剑，剑锋划破空气，如霜雪坠地。血滴落荒土，头颅滚入泥中，脖颈残断处犹带未尽的呜咽。他命亲兵将头颅高悬旗杆，风卷残旗，人头在夜中微微摇晃。远处军营骤然寂静，战马惊嘶，士卒低首，无人敢言。然而就在那一刻，一个年幼女童挣脱母亲怀抱，奔向旗杆，跪地抱起父亲的头颅，哭声撕裂寒夜——那声音如针，刺穿了项羽心中最后一道铁幕。"
2025-09-28 19:54:38 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=54 | choice="命人取来干粮与布帛，亲自将食物分给逃兵，言道：‘楚虽败，仍护苍生’" | node=58 | text_len=214 | image=http://127.0.0.1:8000/static/background1.jpg
2025-09-28 19:54:57 | INFO     | trace=8d3d8a66 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=54 task=continue | api.story:continue_existing_story:595 - continue requestchoice=命人取来干粮与布帛，亲自将食物分给逃兵，言道：‘楚虽败，仍护苍生’
2025-09-28 19:54:57 | INFO     | trace=8d3d8a66 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=58 task=continue | api.story:continue_existing_story:641 - continue node ready check
2025-09-28 19:54:57 | INFO     | api.story:_wait_for_node_complete:165 - [NodeComplete] 开始等待节点完全准备：node_id=58
2025-09-28 19:54:57 | INFO     | api.story:_wait_for_node_complete:218 - [NodeComplete] ✅ 节点完全准备就绪：node_id=58 (等待了 0.0 秒)
2025-09-28 19:54:57 | INFO     | trace=8d3d8a66 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=58 task=continue | api.story:continue_existing_story:644 - continue node ready success
2025-09-28 19:54:57 | INFO     | trace=8d3d8a66 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=58 task=continue | api.story:continue_existing_story:653 - continue speculation enqueue existingdepth=1
2025-09-28 19:54:57 | DEBUG    | trace=8d3d8a66 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=58 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=58 depth=1
2025-09-28 19:54:57 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=58
2025-09-28 19:54:57 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=58 | choice="下令将女童押至阵前，以她为饵诱敌现身"
2025-09-28 19:54:57 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=58 | choice="亲自走下高台，将女童抱起，轻抚其发，低声安抚"
2025-09-28 19:54:57 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 下令将女童押至阵前，以她为饵诱敌现身
2025-09-28 19:54:57 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=58 | choice="命人取来酒坛，当众饮尽三坛，随后仰天长啸，震碎旗杆"
2025-09-28 19:54:57 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲自走下高台，将女童抱起，轻抚其发，低声安抚
2025-09-28 19:54:57 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人取来酒坛，当众饮尽三坛，随后仰天长啸，震碎旗杆
2025-09-28 19:55:01 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:01 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2069
2025-09-28 19:55:01 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=903 预览='{"text": "项羽缓步走向那群蜷缩的逃兵，玄甲在寒风中轻响。他俯身，将手中干粮掰开，递向一位老妇人，又解下外袍，铺于泥地之上，为婴孩遮风。‘楚虽败，仍护苍生。’他声音低沉，却如钟声回荡。老卒们怔住，有人低头啜泣，有人颤抖着接过布帛。远处军营中，一杆旗突然倒下，继而第二杆、第三杆——仿佛有无形之手在撕裂战阵。然而就在此刻，一名年轻士卒猛然抬头，目光灼灼：‘若霸王不弃我们，我愿再战一日！’呼声如浪，自荒丘蔓延至四野。项羽凝视夜空，月光如霜，照见他眉间一道旧伤，似在回应这无声的觉醒。", "choices": [{"option": "命亲兵点燃火把，率军列阵于丘顶，以烈焰宣告楚魂未灭", "'
2025-09-28 19:55:01 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=903 预览='{"text": "项羽缓步走向那群蜷缩的逃兵，玄甲在寒风中轻响。他俯身，将手中干粮掰开，递向一位老妇人，又解下外袍，铺于泥地之上，为婴孩遮风。‘楚虽败，仍护苍生。’他声音低沉，却如钟声回荡。老卒们怔住，有人低头啜泣，有人颤抖着接过布帛。远处军营中，一杆旗突然倒下，继而第二杆、第三杆——仿佛有无形之手在撕裂战阵。然而就'
2025-09-28 19:55:01 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=903 预览='{"text": "项羽缓步走向那群蜷缩的逃兵，玄甲在寒风中轻响。他俯身，将手中干粮掰开，递向一位老妇人，又解下外袍，铺于泥地之上，为婴孩遮风。‘楚虽败，仍护苍生。’他声音低沉，却如钟声回荡。老卒们怔住，有人低头啜泣，有人颤抖着接过布帛。远处军营中，一杆旗突然倒下，继而第二杆、第三杆——仿佛有无形之手在撕裂战阵。然而就'
2025-09-28 19:55:01 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=234
2025-09-28 19:55:01 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=234 preview="项羽缓步走向那群蜷缩的逃兵，玄甲在寒风中轻响。他俯身，将手中干粮掰开，递向一位老妇人，又解下外袍，铺于泥地之上，为婴孩遮风。‘楚虽败，仍护苍生。’他声音低沉，却如钟声回荡。老卒们怔住，有人低头啜泣，有人颤抖着接过布帛。远处军营中，一杆旗突然倒下，继而第二杆、第三杆——仿佛有无形之手在撕裂战阵。然而就在此刻，一名年轻士卒猛然抬头，目光灼灼：‘若霸王不弃我们，我愿再战一日！’呼声如浪，自荒丘蔓延至四野…"

2025-09-28 19:55:01 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽缓步走向那群蜷缩的逃兵，玄甲在寒风中轻响。他俯身，将手中干粮掰开，递向一位老妇人，又解下外袍，铺于泥地之上，为婴孩遮风。‘楚虽败，仍护苍生。…"

2025-09-28 19:55:01 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽缓步走向那群蜷缩的逃...
2025-09-28 19:55:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2078
2025-09-28 19:55:02 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=904 预览='{"text": "项羽缓步走近那群蜷缩的逃兵，玄甲在寒风中无声摇曳。他俯身，将手中干粮掰开，递向一名老卒的手中，又解下披风，轻轻覆在襁褓之上。‘楚虽败，仍护苍生。’他声音低沉，却如钟声穿透夜幕。老卒颤抖着接过，泪落于冻土；孩童停止啼哭，仰头望向这位曾令天下震怖的霸王。远处军营灯火微颤，似有低语悄然蔓延。一队士卒默默放下刀剑，跪地叩首。然而就在此时，帐外传来急促马蹄——汉军斥候竟已潜至三里之外，火把如星点逼近。风卷残旗，战鼓未歇，生死之局，正待下一瞬抉择。", "choices": [{"option": "命亲兵点燃烽火，召集全军列阵迎敌，以气势压倒来犯之敌", "summary": "以雷'
2025-09-28 19:55:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=904 预览='{"text": "项羽缓步走近那群蜷缩的逃兵，玄甲在寒风中无声摇曳。他俯身，将手中干粮掰开，递向一名老卒的手中，又解下披风，轻轻覆在襁褓之上。‘楚虽败，仍护苍生。’他声音低沉，却如钟声穿透夜幕。老卒颤抖着接过，泪落于冻土；孩童停止啼哭，仰头望向这位曾令天下震怖的霸王。远处军营灯火微颤，似有低语悄然蔓延。一队士卒默默放'
2025-09-28 19:55:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=904 预览='{"text": "项羽缓步走近那群蜷缩的逃兵，玄甲在寒风中无声摇曳。他俯身，将手中干粮掰开，递向一名老卒的手中，又解下披风，轻轻覆在襁褓之上。‘楚虽败，仍护苍生。’他声音低沉，却如钟声穿透夜幕。老卒颤抖着接过，泪落于冻土；孩童停止啼哭，仰头望向这位曾令天下震怖的霸王。远处军营灯火微颤，似有低语悄然蔓延。一队士卒默默放'
2025-09-28 19:55:02 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=220
2025-09-28 19:55:02 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=220 preview="项羽缓步走近那群蜷缩的逃兵，玄甲在寒风中无声摇曳。他俯身，将手中干粮掰开，递向一名老卒的手中，又解下披风，轻轻覆在襁褓之上。‘楚虽败，仍护苍生。’他声音低沉，却如钟声穿透夜幕。老卒颤抖着接过，泪落于冻土；孩童停止啼哭，仰头望向这位曾令天下震怖的霸王。远处军营灯火微颤，似有低语悄然蔓延。一队士卒默默放下刀剑，跪地叩首。然而就在此时，帐外传来急促马蹄——汉军斥候竟已潜至三里之外，火把如星点逼近。风卷残…"

2025-09-28 19:55:02 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽缓步走近那群蜷缩的逃兵，玄甲在寒风中无声摇曳。他俯身，将手中干粮掰开，递向一名老卒的手中，又解下披风，轻轻覆在襁褓之上。‘楚虽败，仍护苍生。…"

2025-09-28 19:55:02 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽缓步走近那群蜷缩的逃...
2025-09-28 19:55:02 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:02 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2078
2025-09-28 19:55:02 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=941 预览='{"text": "项羽将干粮与布帛分予老卒，动作沉稳如铁。他俯身轻抚孩童脸颊，目光扫过每一张枯槁面容，声音低沉却穿透寒夜：‘楚虽败，仍护苍生。’一缕微光在残兵眼中闪动，有人跪地叩首，有人掩面啜泣。风起，残旗轻扬，仿佛天地也为这刹那的温情默然。远处汉营灯火忽明忽暗，似有探哨悄然靠近。军中士卒窃语渐起，有人低呼‘霸王未失仁心’，也有人眼神犹疑，如风中残烛。项羽立于寒夜中央，玄甲映月，身影孤绝，却不再只是战神——他正以血肉之躯，为溃散的军心缝补最后一道裂痕。", "choices": [{"option": "命亲兵点燃火把，高举‘楚不弃民’旌旗，列阵于荒丘之上，向四野宣告此誓", "summar'
2025-09-28 19:55:02 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=941 预览='{"text": "项羽将干粮与布帛分予老卒，动作沉稳如铁。他俯身轻抚孩童脸颊，目光扫过每一张枯槁面容，声音低沉却穿透寒夜：‘楚虽败，仍护苍生。’一缕微光在残兵眼中闪动，有人跪地叩首，有人掩面啜泣。风起，残旗轻扬，仿佛天地也为这刹那的温情默然。远处汉营灯火忽明忽暗，似有探哨悄然靠近。军中士卒窃语渐起，有人低呼‘霸王未失'
2025-09-28 19:55:02 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=941 预览='{"text": "项羽将干粮与布帛分予老卒，动作沉稳如铁。他俯身轻抚孩童脸颊，目光扫过每一张枯槁面容，声音低沉却穿透寒夜：‘楚虽败，仍护苍生。’一缕微光在残兵眼中闪动，有人跪地叩首，有人掩面啜泣。风起，残旗轻扬，仿佛天地也为这刹那的温情默然。远处汉营灯火忽明忽暗，似有探哨悄然靠近。军中士卒窃语渐起，有人低呼‘霸王未失'
2025-09-28 19:55:02 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=219
2025-09-28 19:55:02 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=219 preview="项羽将干粮与布帛分予老卒，动作沉稳如铁。他俯身轻抚孩童脸颊，目光扫过每一张枯槁面容，声音低沉却穿透寒夜：‘楚虽败，仍护苍生。’一缕微光在残兵眼中闪动，有人跪地叩首，有人掩面啜泣。风起，残旗轻扬，仿佛天地也为这刹那的温情默然。远处汉营灯火忽明忽暗，似有探哨悄然靠近。军中士卒窃语渐起，有人低呼‘霸王未失仁心’，也有人眼神犹疑，如风中残烛。项羽立于寒夜中央，玄甲映月，身影孤绝，却不再只是战神——他正以血…"

2025-09-28 19:55:02 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽将干粮与布帛分予老卒，动作沉稳如铁。他俯身轻抚孩童脸颊，目光扫过每一张枯槁面容，声音低沉却穿透寒夜：‘楚虽败，仍护苍生。’一缕微光在残兵眼中…"

2025-09-28 19:55:02 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽将干粮与布帛分予老卒...
2025-09-28 19:55:13 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 744 (attempt 1/2)
2025-09-28 19:55:13 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=110

2025-09-28 19:55:13 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060512955_053.png
2025-09-28 19:55:13 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060512955_053.png

2025-09-28 19:55:13 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060512955_053.png

2025-09-28 19:55:13 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 19:55:13 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:55:13 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060513035_504.png
2025-09-28 19:55:13 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060513035_504.png

2025-09-28 19:55:13 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060513035_504.png

2025-09-28 19:55:13 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 19:55:13 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:55:13 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060513720_564.png
2025-09-28 19:55:13 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060513720_564.png

2025-09-28 19:55:13 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060513720_564.png

2025-09-28 19:55:14 | INFO     | trace=2cd1ca4b user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=58 task=continue | api.story:continue_existing_story:595 - continue requestchoice=下令将女童押至阵前，以她为饵诱敌现身
2025-09-28 19:55:14 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_90ca51454c7ceaae054e8f0dab316aec.png (大小: 1287995 字节)

2025-09-28 19:55:14 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_90ca51454c7ceaae054e8f0dab316aec.webp 大小 61400 字节 (原始 1287995 字节, 压缩比 0.05)

2025-09-28 19:55:14 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_90ca51454c7ceaae054e8f0dab316aec.png

2025-09-28 19:55:14 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_90ca51454c7ceaae054e8f0dab316aec.webp

2025-09-28 19:55:14 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_90ca51454c7ceaae054e8f0dab316aec.webp

2025-09-28 19:55:14 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_90ca51454c7ceaae054e8f0dab316aec.webp

2025-09-28 19:55:14 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_90ca51454c7ceaae054e8f0dab316aec.webp
2025-09-28 19:55:14 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:14 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=58 | choice="亲自走下高台，将女童抱起，轻抚其发，低声安抚" | text_len=234 | text="项羽缓步走向那群蜷缩的逃兵，玄甲在寒风中轻响。他俯身，将手中干粮掰开，递向一位老妇人，又解下外袍，铺于泥地之上，为婴孩遮风。‘楚虽败，仍护苍生。’他声音低沉，却如钟声回荡。老卒们怔住，有人低头啜泣，有人颤抖着接过布帛。远处军营中，一杆旗突然倒下，继而第二杆、第三杆——仿佛有无形之手在撕裂战阵。然而就在此刻，一名年轻士卒猛然抬头，目光灼灼：‘若霸王不弃我们，我愿再战一日！’呼声如浪，自荒丘蔓延至四野。项羽凝视夜空，月光如霜，照见他眉间一道旧伤，似在回应这无声的觉醒。"
2025-09-28 19:55:14 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=58 | choice="亲自走下高台，将女童抱起，轻抚其发，低声安抚" | node=59 | text_len=234 | image=http://127.0.0.1:8000/static/generated/ai_gen_90ca51454c7ceaae054e8f0dab316aec.webp
2025-09-28 19:55:15 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_7f4985d2dfa44a228345b5c209bb7f93.png (大小: 1225511 字节)

2025-09-28 19:55:15 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_7f4985d2dfa44a228345b5c209bb7f93.webp 大小 55202 字节 (原始 1225511 字节, 压缩比 0.05)

2025-09-28 19:55:15 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_7f4985d2dfa44a228345b5c209bb7f93.png

2025-09-28 19:55:15 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_7f4985d2dfa44a228345b5c209bb7f93.webp

2025-09-28 19:55:15 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_7f4985d2dfa44a228345b5c209bb7f93.webp

2025-09-28 19:55:15 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_7f4985d2dfa44a228345b5c209bb7f93.webp

2025-09-28 19:55:15 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_7f4985d2dfa44a228345b5c209bb7f93.webp
2025-09-28 19:55:15 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:15 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=58 | choice="命人取来酒坛，当众饮尽三坛，随后仰天长啸，震碎旗杆" | text_len=219 | text="项羽将干粮与布帛分予老卒，动作沉稳如铁。他俯身轻抚孩童脸颊，目光扫过每一张枯槁面容，声音低沉却穿透寒夜：‘楚虽败，仍护苍生。’一缕微光在残兵眼中闪动，有人跪地叩首，有人掩面啜泣。风起，残旗轻扬，仿佛天地也为这刹那的温情默然。远处汉营灯火忽明忽暗，似有探哨悄然靠近。军中士卒窃语渐起，有人低呼‘霸王未失仁心’，也有人眼神犹疑，如风中残烛。项羽立于寒夜中央，玄甲映月，身影孤绝，却不再只是战神——他正以血肉之躯，为溃散的军心缝补最后一道裂痕。"
2025-09-28 19:55:15 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=58 | choice="命人取来酒坛，当众饮尽三坛，随后仰天长啸，震碎旗杆" | node=60 | text_len=219 | image=http://127.0.0.1:8000/static/generated/ai_gen_7f4985d2dfa44a228345b5c209bb7f93.webp
2025-09-28 19:55:15 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.png (大小: 1467019 字节)

2025-09-28 19:55:16 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp 大小 76982 字节 (原始 1467019 字节, 压缩比 0.05)

2025-09-28 19:55:16 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.png

2025-09-28 19:55:16 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp

2025-09-28 19:55:16 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp

2025-09-28 19:55:16 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp

2025-09-28 19:55:16 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 19:55:16 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:16 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=58 | choice="下令将女童押至阵前，以她为饵诱敌现身" | text_len=220 | text="项羽缓步走近那群蜷缩的逃兵，玄甲在寒风中无声摇曳。他俯身，将手中干粮掰开，递向一名老卒的手中，又解下披风，轻轻覆在襁褓之上。‘楚虽败，仍护苍生。’他声音低沉，却如钟声穿透夜幕。老卒颤抖着接过，泪落于冻土；孩童停止啼哭，仰头望向这位曾令天下震怖的霸王。远处军营灯火微颤，似有低语悄然蔓延。一队士卒默默放下刀剑，跪地叩首。然而就在此时，帐外传来急促马蹄——汉军斥候竟已潜至三里之外，火把如星点逼近。风卷残旗，战鼓未歇，生死之局，正待下一瞬抉择。"
2025-09-28 19:55:16 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=58 | choice="下令将女童押至阵前，以她为饵诱敌现身" | node=61 | text_len=220 | image=http://127.0.0.1:8000/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 19:55:16 | INFO     | trace=2cd1ca4b user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=61 task=continue | api.story:continue_existing_story:641 - continue node ready check
2025-09-28 19:55:16 | INFO     | api.story:_wait_for_node_complete:165 - [NodeComplete] 开始等待节点完全准备：node_id=61
2025-09-28 19:55:16 | INFO     | api.story:_wait_for_node_complete:218 - [NodeComplete] ✅ 节点完全准备就绪：node_id=61 (等待了 0.0 秒)
2025-09-28 19:55:16 | INFO     | trace=2cd1ca4b user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=61 task=continue | api.story:continue_existing_story:644 - continue node ready success
2025-09-28 19:55:16 | INFO     | trace=2cd1ca4b user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=61 task=continue | api.story:continue_existing_story:653 - continue speculation enqueue existingdepth=1
2025-09-28 19:55:16 | DEBUG    | trace=2cd1ca4b user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=61 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=61 depth=1
2025-09-28 19:55:16 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp exists=True size=76982
2025-09-28 19:55:16 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 19:55:16 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=61
2025-09-28 19:55:16 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=61 | choice="命亲兵点燃烽火，召集全军列阵迎敌，以气势压倒来犯之敌"
2025-09-28 19:55:16 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=61 | choice="悄然下令撤向山林密道，借夜色与地形藏匿主力，保存最后火种"
2025-09-28 19:55:16 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命亲兵点燃烽火，召集全军列阵迎敌，以气势压倒来犯之敌
2025-09-28 19:55:16 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 19:55:16 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=61 | choice="独自策马出营，向汉军方向高举双手，以一人之躯换将士生路"
2025-09-28 19:55:16 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然下令撤向山林密道，借夜色与地形藏匿主力，保存最后火种
2025-09-28 19:55:16 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 独自策马出营，向汉军方向高举双手，以一人之躯换将士生路
2025-09-28 19:55:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2267
2025-09-28 19:55:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2299
2025-09-28 19:55:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=879 预览='{"text": "项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他下令将她置于战旗之下，身披染血的旧甲，剑锋指天，声如裂帛：‘汉军若敢来犯，此女便是第一道祭品！’夜色沉如墨，火把在远处摇曳，仿佛回应他的挑衅。风卷残旗，战鼓未歇，天地间只剩那稚嫩的呼吸与铁甲的冷光。一瞬之间，敌营深处传来马蹄轻响——有人正悄然逼近，似为诱饵而来，亦或真为救一人而至。生死之局，只待下一刻的决断。", "choices": [{"option": "命亲兵以弓箭围射，逼退靠近的骑兵，再将女童秘密转移至后方营地", "summary": "以智谋保全人质，同时试探敌军意图", "effects'
2025-09-28 19:55:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=879 预览='{"text": "项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他下令将她置于战旗之下，身披染血的旧甲，剑锋指天，声如裂帛：‘汉军若敢来犯，此女便是第一道祭品！’夜色沉如墨，火把在远处摇曳，仿佛回应他的挑衅。风卷残旗，战鼓未歇，天地间只剩那稚嫩的呼吸与铁甲的冷光。一瞬之间，敌营深处传来马蹄轻响'
2025-09-28 19:55:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=879 预览='{"text": "项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他下令将她置于战旗之下，身披染血的旧甲，剑锋指天，声如裂帛：‘汉军若敢来犯，此女便是第一道祭品！’夜色沉如墨，火把在远处摇曳，仿佛回应他的挑衅。风卷残旗，战鼓未歇，天地间只剩那稚嫩的呼吸与铁甲的冷光。一瞬之间，敌营深处传来马蹄轻响'
2025-09-28 19:55:20 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=908 预览='{"text": "项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他缓缓抽出青铜剑，剑锋在月光下划出一道冷弧，却未落向孩童，而是指向远处汉军营寨——‘以孤女为饵，诱敌现身’。他声音如铁，震得战旗猎猎作响。士兵将女童推至断墙之上，她抬头望天，眼中无惧，只有一丝微弱的光。夜风骤起，火把如星火般从四面逼近，汉军斥候果然被引动，埋伏于林间的箭矢已悄然对准此地。然而就在那刹那，一声稚嫩的哭喊撕裂长空：‘娘——！’那不是恐惧，是呼唤，是血肉相连的呐喊。天地为之静默，连风都停了。", "choices": [{"option": "命亲兵突袭侧翼，趁敌阵乱时救下女童并撤退", "su'
2025-09-28 19:55:20 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=908 预览='{"text": "项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他缓缓抽出青铜剑，剑锋在月光下划出一道冷弧，却未落向孩童，而是指向远处汉军营寨——‘以孤女为饵，诱敌现身’。他声音如铁，震得战旗猎猎作响。士兵将女童推至断墙之上，她抬头望天，眼中无惧，只有一丝微弱的光。夜风骤起，火把如星火般从四面'
2025-09-28 19:55:20 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=908 预览='{"text": "项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他缓缓抽出青铜剑，剑锋在月光下划出一道冷弧，却未落向孩童，而是指向远处汉军营寨——‘以孤女为饵，诱敌现身’。他声音如铁，震得战旗猎猎作响。士兵将女童推至断墙之上，她抬头望天，眼中无惧，只有一丝微弱的光。夜风骤起，火把如星火般从四面'
2025-09-28 19:55:20 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=191
2025-09-28 19:55:20 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=237
2025-09-28 19:55:20 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=191 preview="项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他下令将她置于战旗之下，身披染血的旧甲，剑锋指天，声如裂帛：‘汉军若敢来犯，此女便是第一道祭品！’夜色沉如墨，火把在远处摇曳，仿佛回应他的挑衅。风卷残旗，战鼓未歇，天地间只剩那稚嫩的呼吸与铁甲的冷光。一瞬之间，敌营深处传来马蹄轻响——有人正悄然逼近，似为诱饵而来，亦或真为救一人而至。生死之局，只待下一刻的决断。"

2025-09-28 19:55:20 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=237 preview="项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他缓缓抽出青铜剑，剑锋在月光下划出一道冷弧，却未落向孩童，而是指向远处汉军营寨——‘以孤女为饵，诱敌现身’。他声音如铁，震得战旗猎猎作响。士兵将女童推至断墙之上，她抬头望天，眼中无惧，只有一丝微弱的光。夜风骤起，火把如星火般从四面逼近，汉军斥候果然被引动，埋伏于林间的箭矢已悄然对准此地。然而就在那刹那，一声稚嫩的哭喊撕裂长空：‘…"

2025-09-28 19:55:20 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他下令将她置于战旗之下，身披染血的旧甲，剑锋指天，声如裂帛：‘汉军若敢来犯…"

2025-09-28 19:55:20 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他缓缓抽出青铜剑，剑锋在月光下划出一道冷弧，却未落向孩童，而是指向远处汉军…"

2025-09-28 19:55:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着被押至阵前的女...
2025-09-28 19:55:20 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽凝视着被押至阵前的女...
2025-09-28 19:55:21 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:21 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2240
2025-09-28 19:55:21 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=835 预览='{"text": "项羽立于阵前，寒风卷起残旗，女童被押至中央，衣衫单薄，目光如炬。他缓缓抽出青铜剑，剑锋映着冷月，指向汉军来路，低语如雷：‘敌若来，便以稚子为饵，引其入彀。’话音未落，远处火把骤然晃动，马蹄声由远及近，似有千军压境。守军屏息凝神，箭矢上弦，战鼓将鸣。然而就在此刻，女童突然仰头，望向项羽，竟轻轻一笑，如雪融春溪——那笑容中无惧，唯有悲悯。天地仿佛一静，连风都停了。", "choices": [{"option": "将女童推入陷阱壕沟，以血肉诱敌入伏", "summary": "以最狠手段逼出敌军主力，代价沉重", "effects": {"delta_progress": 1'
2025-09-28 19:55:21 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=835 预览='{"text": "项羽立于阵前，寒风卷起残旗，女童被押至中央，衣衫单薄，目光如炬。他缓缓抽出青铜剑，剑锋映着冷月，指向汉军来路，低语如雷：‘敌若来，便以稚子为饵，引其入彀。’话音未落，远处火把骤然晃动，马蹄声由远及近，似有千军压境。守军屏息凝神，箭矢上弦，战鼓将鸣。然而就在此刻，女童突然仰头，望向项羽，竟轻轻一笑，如'
2025-09-28 19:55:21 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=835 预览='{"text": "项羽立于阵前，寒风卷起残旗，女童被押至中央，衣衫单薄，目光如炬。他缓缓抽出青铜剑，剑锋映着冷月，指向汉军来路，低语如雷：‘敌若来，便以稚子为饵，引其入彀。’话音未落，远处火把骤然晃动，马蹄声由远及近，似有千军压境。守军屏息凝神，箭矢上弦，战鼓将鸣。然而就在此刻，女童突然仰头，望向项羽，竟轻轻一笑，如'
2025-09-28 19:55:21 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=181
2025-09-28 19:55:21 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=181 preview="项羽立于阵前，寒风卷起残旗，女童被押至中央，衣衫单薄，目光如炬。他缓缓抽出青铜剑，剑锋映着冷月，指向汉军来路，低语如雷：‘敌若来，便以稚子为饵，引其入彀。’话音未落，远处火把骤然晃动，马蹄声由远及近，似有千军压境。守军屏息凝神，箭矢上弦，战鼓将鸣。然而就在此刻，女童突然仰头，望向项羽，竟轻轻一笑，如雪融春溪——那笑容中无惧，唯有悲悯。天地仿佛一静，连风都停了。"

2025-09-28 19:55:21 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于阵前，寒风卷起残旗，女童被押至中央，衣衫单薄，目光如炬。他缓缓抽出青铜剑，剑锋映着冷月，指向汉军来路，低语如雷：‘敌若来，便以稚子为饵，…"

2025-09-28 19:55:21 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于阵前，寒风卷起残...
2025-09-28 19:55:31 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 750 (attempt 1/2)
2025-09-28 19:55:31 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=95

2025-09-28 19:55:31 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: Here is an image depicting the scene you described: 

|>
请注意,回复提前终止,原因:IMAGE_PROHIBITED_CONTENT...
2025-09-28 19:55:31 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:55:31 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:55:31 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=fantasy_castle.jpg | url=http://127.0.0.1:8000/static/fantasy_castle.jpg
2025-09-28 19:55:31 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/fantasy_castle.jpg
2025-09-28 19:55:31 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:31 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=61 | choice="命亲兵点燃烽火，召集全军列阵迎敌，以气势压倒来犯之敌" | text_len=191 | text="项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他下令将她置于战旗之下，身披染血的旧甲，剑锋指天，声如裂帛：‘汉军若敢来犯，此女便是第一道祭品！’夜色沉如墨，火把在远处摇曳，仿佛回应他的挑衅。风卷残旗，战鼓未歇，天地间只剩那稚嫩的呼吸与铁甲的冷光。一瞬之间，敌营深处传来马蹄轻响——有人正悄然逼近，似为诱饵而来，亦或真为救一人而至。生死之局，只待下一刻的决断。"
2025-09-28 19:55:31 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=61 | choice="命亲兵点燃烽火，召集全军列阵迎敌，以气势压倒来犯之敌" | node=62 | text_len=191 | image=http://127.0.0.1:8000/static/fantasy_castle.jpg
2025-09-28 19:55:33 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 19:55:33 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:55:33 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060533211_416.png
2025-09-28 19:55:33 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060533211_416.png

2025-09-28 19:55:33 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060533211_416.png

2025-09-28 19:55:33 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 19:55:33 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:55:33 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060533607_253.png
2025-09-28 19:55:33 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060533607_253.png

2025-09-28 19:55:33 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060533607_253.png

2025-09-28 19:55:35 | INFO     | trace=9f832432 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=61 task=continue | api.story:continue_existing_story:595 - continue requestchoice=悄然下令撤向山林密道，借夜色与地形藏匿主力，保存最后火种
2025-09-28 19:55:35 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_4141e587019311055a01a828423d09df.png (大小: 1346048 字节)

2025-09-28 19:55:35 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_4141e587019311055a01a828423d09df.webp 大小 64312 字节 (原始 1346048 字节, 压缩比 0.05)

2025-09-28 19:55:35 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_4141e587019311055a01a828423d09df.png

2025-09-28 19:55:35 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_4141e587019311055a01a828423d09df.webp

2025-09-28 19:55:35 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_4141e587019311055a01a828423d09df.webp

2025-09-28 19:55:35 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_4141e587019311055a01a828423d09df.webp

2025-09-28 19:55:35 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_4141e587019311055a01a828423d09df.webp
2025-09-28 19:55:35 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:35 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=61 | choice="独自策马出营，向汉军方向高举双手，以一人之躯换将士生路" | text_len=237 | text="项羽凝视着被押至阵前的女童，她蜷缩在寒风中，小手紧攥着父亲残破的衣角。他缓缓抽出青铜剑，剑锋在月光下划出一道冷弧，却未落向孩童，而是指向远处汉军营寨——‘以孤女为饵，诱敌现身’。他声音如铁，震得战旗猎猎作响。士兵将女童推至断墙之上，她抬头望天，眼中无惧，只有一丝微弱的光。夜风骤起，火把如星火般从四面逼近，汉军斥候果然被引动，埋伏于林间的箭矢已悄然对准此地。然而就在那刹那，一声稚嫩的哭喊撕裂长空：‘娘——！’那不是恐惧，是呼唤，是血肉相连的呐喊。天地为之静默，连风都停了。"
2025-09-28 19:55:35 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=61 | choice="独自策马出营，向汉军方向高举双手，以一人之躯换将士生路" | node=63 | text_len=237 | image=http://127.0.0.1:8000/static/generated/ai_gen_4141e587019311055a01a828423d09df.webp
2025-09-28 19:55:35 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_66c82b47faedd97337276e0e272dc39c.png (大小: 1395223 字节)

2025-09-28 19:55:36 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_66c82b47faedd97337276e0e272dc39c.webp 大小 74606 字节 (原始 1395223 字节, 压缩比 0.05)

2025-09-28 19:55:36 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_66c82b47faedd97337276e0e272dc39c.png

2025-09-28 19:55:36 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp

2025-09-28 19:55:36 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_66c82b47faedd97337276e0e272dc39c.webp

2025-09-28 19:55:36 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp

2025-09-28 19:55:36 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 19:55:36 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:36 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=61 | choice="悄然下令撤向山林密道，借夜色与地形藏匿主力，保存最后火种" | text_len=181 | text="项羽立于阵前，寒风卷起残旗，女童被押至中央，衣衫单薄，目光如炬。他缓缓抽出青铜剑，剑锋映着冷月，指向汉军来路，低语如雷：‘敌若来，便以稚子为饵，引其入彀。’话音未落，远处火把骤然晃动，马蹄声由远及近，似有千军压境。守军屏息凝神，箭矢上弦，战鼓将鸣。然而就在此刻，女童突然仰头，望向项羽，竟轻轻一笑，如雪融春溪——那笑容中无惧，唯有悲悯。天地仿佛一静，连风都停了。"
2025-09-28 19:55:36 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=61 | choice="悄然下令撤向山林密道，借夜色与地形藏匿主力，保存最后火种" | node=64 | text_len=181 | image=http://127.0.0.1:8000/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 19:55:36 | INFO     | trace=9f832432 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=64 task=continue | api.story:continue_existing_story:641 - continue node ready check
2025-09-28 19:55:36 | INFO     | api.story:_wait_for_node_complete:165 - [NodeComplete] 开始等待节点完全准备：node_id=64
2025-09-28 19:55:36 | INFO     | api.story:_wait_for_node_complete:218 - [NodeComplete] ✅ 节点完全准备就绪：node_id=64 (等待了 0.0 秒)
2025-09-28 19:55:36 | INFO     | trace=9f832432 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=64 task=continue | api.story:continue_existing_story:644 - continue node ready success
2025-09-28 19:55:36 | INFO     | trace=9f832432 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=64 task=continue | api.story:continue_existing_story:653 - continue speculation enqueue existingdepth=1
2025-09-28 19:55:36 | DEBUG    | trace=9f832432 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=64 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=64 depth=1
2025-09-28 19:55:36 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_66c82b47faedd97337276e0e272dc39c.webp exists=True size=74606
2025-09-28 19:55:36 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 19:55:36 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 19:55:36 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=64
2025-09-28 19:55:36 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=64 | choice="将女童推入陷阱壕沟，以血肉诱敌入伏"
2025-09-28 19:55:36 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=64 | choice="命亲兵将女童背负于肩，当众宣誓：‘楚不弃幼，宁死不辱’"
2025-09-28 19:55:36 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将女童推入陷阱壕沟，以血肉诱敌入伏
2025-09-28 19:55:36 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=64 | choice="突然拔剑斩断绳索，让女童奔向汉营，高呼：‘我以孤身换万民安’"
2025-09-28 19:55:36 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命亲兵将女童背负于肩，当众宣誓：‘楚不弃幼，宁死不辱’
2025-09-28 19:55:36 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 突然拔剑斩断绳索，让女童奔向汉营，高呼：‘我以孤身换万民安’
2025-09-28 19:55:40 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:40 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2471
2025-09-28 19:55:40 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=887 预览='{"text": "夜色如墨，山林密道蜿蜒于断崖之间，项羽率残部悄然潜行，脚步轻如落叶。他回望最后一眼荒丘，火把已熄，旗杆空悬，风中似有低语飘散。亲兵低声禀报：‘后方传来马蹄声，汉军疑有追兵。’项羽凝神片刻，挥手令全军隐入密林深处，仅留一缕青烟升腾于天际——那是向天地告别的信号。山雾渐起，遮蔽了所有足迹，也掩去了楚军最后的轮廓。然而就在队伍即将完全隐没之际，一名小卒突然跪地，捧出一枚刻有‘楚’字的铜印，颤抖着递向项羽：‘这是大王赐予的信物，若失此印，便再无人认得我们……’话音未落，远处传来一声冷箭破空之声，直射那枚铜印，将其钉入土中。", "choices": [{"option": "命人取'
2025-09-28 19:55:40 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=887 预览='{"text": "夜色如墨，山林密道蜿蜒于断崖之间，项羽率残部悄然潜行，脚步轻如落叶。他回望最后一眼荒丘，火把已熄，旗杆空悬，风中似有低语飘散。亲兵低声禀报：‘后方传来马蹄声，汉军疑有追兵。’项羽凝神片刻，挥手令全军隐入密林深处，仅留一缕青烟升腾于天际——那是向天地告别的信号。山雾渐起，遮蔽了所有足迹，也掩去了楚军最'
2025-09-28 19:55:40 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=887 预览='{"text": "夜色如墨，山林密道蜿蜒于断崖之间，项羽率残部悄然潜行，脚步轻如落叶。他回望最后一眼荒丘，火把已熄，旗杆空悬，风中似有低语飘散。亲兵低声禀报：‘后方传来马蹄声，汉军疑有追兵。’项羽凝神片刻，挥手令全军隐入密林深处，仅留一缕青烟升腾于天际——那是向天地告别的信号。山雾渐起，遮蔽了所有足迹，也掩去了楚军最'
2025-09-28 19:55:40 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=260
2025-09-28 19:55:40 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=260 preview="夜色如墨，山林密道蜿蜒于断崖之间，项羽率残部悄然潜行，脚步轻如落叶。他回望最后一眼荒丘，火把已熄，旗杆空悬，风中似有低语飘散。亲兵低声禀报：‘后方传来马蹄声，汉军疑有追兵。’项羽凝神片刻，挥手令全军隐入密林深处，仅留一缕青烟升腾于天际——那是向天地告别的信号。山雾渐起，遮蔽了所有足迹，也掩去了楚军最后的轮廓。然而就在队伍即将完全隐没之际，一名小卒突然跪地，捧出一枚刻有‘楚’字的铜印，颤抖着递向项羽…"

2025-09-28 19:55:40 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，山林密道蜿蜒于断崖之间，项羽率残部悄然潜行，脚步轻如落叶。他回望最后一眼荒丘，火把已熄，旗杆空悬，风中似有低语飘散。亲兵低声禀报：‘后…"

2025-09-28 19:55:40 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，山林密道蜿蜒于...
2025-09-28 19:55:41 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:41 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2448
2025-09-28 19:55:41 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=838 预览='{"text": "项羽悄然下令，军中火把熄灭，战马蒙耳，铁甲裹布。残兵如游魂般潜入山林密道，足音隐于落叶与寒风之间。他立于崖顶，回望汉营灯火渐远，目光如刃，划破夜幕。身后，女童的笑声犹在耳畔——那不是恐惧，而是对生的执念。他低语：‘此去非逃，乃存楚之魂。’密道蜿蜒如蛇，深陷幽谷，岩壁滴水如泪。远处传来犬吠，汉军巡哨正向此处逼近。然而就在那一刻，山腹深处，一道微光忽明忽暗，似有旧部守候多年，静待故主归来。生死未定，但火种尚存。", "choices": [{"option": "命亲兵点燃三堆枯枝，以烽火为号唤醒山中旧部", "summary": "以火为信，唤起沉睡的故人之力", "effe'
2025-09-28 19:55:41 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=838 预览='{"text": "项羽悄然下令，军中火把熄灭，战马蒙耳，铁甲裹布。残兵如游魂般潜入山林密道，足音隐于落叶与寒风之间。他立于崖顶，回望汉营灯火渐远，目光如刃，划破夜幕。身后，女童的笑声犹在耳畔——那不是恐惧，而是对生的执念。他低语：‘此去非逃，乃存楚之魂。’密道蜿蜒如蛇，深陷幽谷，岩壁滴水如泪。远处传来犬吠，汉军巡哨正'
2025-09-28 19:55:41 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=838 预览='{"text": "项羽悄然下令，军中火把熄灭，战马蒙耳，铁甲裹布。残兵如游魂般潜入山林密道，足音隐于落叶与寒风之间。他立于崖顶，回望汉营灯火渐远，目光如刃，划破夜幕。身后，女童的笑声犹在耳畔——那不是恐惧，而是对生的执念。他低语：‘此去非逃，乃存楚之魂。’密道蜿蜒如蛇，深陷幽谷，岩壁滴水如泪。远处传来犬吠，汉军巡哨正'
2025-09-28 19:55:41 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=205
2025-09-28 19:55:41 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=205 preview="项羽悄然下令，军中火把熄灭，战马蒙耳，铁甲裹布。残兵如游魂般潜入山林密道，足音隐于落叶与寒风之间。他立于崖顶，回望汉营灯火渐远，目光如刃，划破夜幕。身后，女童的笑声犹在耳畔——那不是恐惧，而是对生的执念。他低语：‘此去非逃，乃存楚之魂。’密道蜿蜒如蛇，深陷幽谷，岩壁滴水如泪。远处传来犬吠，汉军巡哨正向此处逼近。然而就在那一刻，山腹深处，一道微光忽明忽暗，似有旧部守候多年，静待故主归来。生死未定，但…"

2025-09-28 19:55:41 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽悄然下令，军中火把熄灭，战马蒙耳，铁甲裹布。残兵如游魂般潜入山林密道，足音隐于落叶与寒风之间。他立于崖顶，回望汉营灯火渐远，目光如刃，划破夜…"

2025-09-28 19:55:41 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽悄然下令，军中火把熄...
2025-09-28 19:55:41 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:55:41 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2474
2025-09-28 19:55:41 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=882 预览='{"text": "夜色如墨，山林深处雾气弥漫。项羽一声令下，残部悄然撤入密道，脚步轻如落叶，呼吸凝于喉间。火把熄灭，战鼓隐匿，唯有风穿过松针的低语。他立于山脊回望，汉军火光已在三里外闪烁，却未察觉这最后的楚军已如游龙潜入幽谷。密道蜿蜒向下，岩壁湿滑，婴孩在襁褓中轻啼，被老卒以衣襟裹紧。项羽低头，将一柄断剑埋入土中，血迹未干——那是他最后一道誓约：不灭之火，藏于荒野。远处传来马蹄踏碎枯枝的声响，但已迟了。他们活着，便尚有翻盘之机。", "choices": [{"option": "命人将女童秘密送往江南旧部，托付给一位隐居的儒生抚养", "summary": "以未来为赌注，埋下复兴的种子"'
2025-09-28 19:55:41 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=882 预览='{"text": "夜色如墨，山林深处雾气弥漫。项羽一声令下，残部悄然撤入密道，脚步轻如落叶，呼吸凝于喉间。火把熄灭，战鼓隐匿，唯有风穿过松针的低语。他立于山脊回望，汉军火光已在三里外闪烁，却未察觉这最后的楚军已如游龙潜入幽谷。密道蜿蜒向下，岩壁湿滑，婴孩在襁褓中轻啼，被老卒以衣襟裹紧。项羽低头，将一柄断剑埋入土中，血'
2025-09-28 19:55:41 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=882 预览='{"text": "夜色如墨，山林深处雾气弥漫。项羽一声令下，残部悄然撤入密道，脚步轻如落叶，呼吸凝于喉间。火把熄灭，战鼓隐匿，唯有风穿过松针的低语。他立于山脊回望，汉军火光已在三里外闪烁，却未察觉这最后的楚军已如游龙潜入幽谷。密道蜿蜒向下，岩壁湿滑，婴孩在襁褓中轻啼，被老卒以衣襟裹紧。项羽低头，将一柄断剑埋入土中，血'
2025-09-28 19:55:41 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=207
2025-09-28 19:55:41 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=207 preview="夜色如墨，山林深处雾气弥漫。项羽一声令下，残部悄然撤入密道，脚步轻如落叶，呼吸凝于喉间。火把熄灭，战鼓隐匿，唯有风穿过松针的低语。他立于山脊回望，汉军火光已在三里外闪烁，却未察觉这最后的楚军已如游龙潜入幽谷。密道蜿蜒向下，岩壁湿滑，婴孩在襁褓中轻啼，被老卒以衣襟裹紧。项羽低头，将一柄断剑埋入土中，血迹未干——那是他最后一道誓约：不灭之火，藏于荒野。远处传来马蹄踏碎枯枝的声响，但已迟了。他们活着，便…"

2025-09-28 19:55:41 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，山林深处雾气弥漫。项羽一声令下，残部悄然撤入密道，脚步轻如落叶，呼吸凝于喉间。火把熄灭，战鼓隐匿，唯有风穿过松针的低语。他立于山脊回望…"

2025-09-28 19:55:41 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，山林深处雾气弥...
2025-09-28 19:55:51 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 771 (attempt 1/2)
2025-09-28 19:55:51 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=137

2025-09-28 19:55:51 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060551543_931.png
2025-09-28 19:55:51 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060551543_931.png

2025-09-28 19:55:51 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060551543_931.png

2025-09-28 19:55:53 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.png (大小: 1210381 字节)

2025-09-28 19:55:53 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.webp 大小 52908 字节 (原始 1210381 字节, 压缩比 0.04)

2025-09-28 19:55:53 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.png

2025-09-28 19:55:53 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.webp

2025-09-28 19:55:53 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.webp

2025-09-28 19:55:53 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.webp

2025-09-28 19:55:53 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.webp
2025-09-28 19:55:53 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:55:53 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=64 | choice="突然拔剑斩断绳索，让女童奔向汉营，高呼：‘我以孤身换万民安’" | text_len=260 | text="夜色如墨，山林密道蜿蜒于断崖之间，项羽率残部悄然潜行，脚步轻如落叶。他回望最后一眼荒丘，火把已熄，旗杆空悬，风中似有低语飘散。亲兵低声禀报：‘后方传来马蹄声，汉军疑有追兵。’项羽凝神片刻，挥手令全军隐入密林深处，仅留一缕青烟升腾于天际——那是向天地告别的信号。山雾渐起，遮蔽了所有足迹，也掩去了楚军最后的轮廓。然而就在队伍即将完全隐没之际，一名小卒突然跪地，捧出一枚刻有‘楚’字的铜印，颤抖着递向项羽：‘这是大王赐予的信物，若失此印，便再无人认得我们……’话音未落，远处传来一声冷箭破空之声，直射那枚铜印，将其钉入土中。"
2025-09-28 19:55:53 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=64 | choice="突然拔剑斩断绳索，让女童奔向汉营，高呼：‘我以孤身换万民安’" | node=65 | text_len=260 | image=http://127.0.0.1:8000/static/generated/ai_gen_85db5a80ea1bd1c8b50e1b4562275bb2.webp
2025-09-28 19:56:01 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 19:56:01 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:56:01 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060560668_328.png
2025-09-28 19:56:01 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060560668_328.png

2025-09-28 19:56:01 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060560668_328.png

2025-09-28 19:56:02 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_547c604482b9ea9a2f9972d4921cef59.png (大小: 1394523 字节)

2025-09-28 19:56:03 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_547c604482b9ea9a2f9972d4921cef59.webp 大小 61142 字节 (原始 1394523 字节, 压缩比 0.04)

2025-09-28 19:56:03 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_547c604482b9ea9a2f9972d4921cef59.png

2025-09-28 19:56:03 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_547c604482b9ea9a2f9972d4921cef59.webp

2025-09-28 19:56:03 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_547c604482b9ea9a2f9972d4921cef59.webp

2025-09-28 19:56:03 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_547c604482b9ea9a2f9972d4921cef59.webp

2025-09-28 19:56:03 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_547c604482b9ea9a2f9972d4921cef59.webp
2025-09-28 19:56:03 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:56:03 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=64 | choice="将女童推入陷阱壕沟，以血肉诱敌入伏" | text_len=207 | text="夜色如墨，山林深处雾气弥漫。项羽一声令下，残部悄然撤入密道，脚步轻如落叶，呼吸凝于喉间。火把熄灭，战鼓隐匿，唯有风穿过松针的低语。他立于山脊回望，汉军火光已在三里外闪烁，却未察觉这最后的楚军已如游龙潜入幽谷。密道蜿蜒向下，岩壁湿滑，婴孩在襁褓中轻啼，被老卒以衣襟裹紧。项羽低头，将一柄断剑埋入土中，血迹未干——那是他最后一道誓约：不灭之火，藏于荒野。远处传来马蹄踏碎枯枝的声响，但已迟了。他们活着，便尚有翻盘之机。"
2025-09-28 19:56:03 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=64 | choice="将女童推入陷阱壕沟，以血肉诱敌入伏" | node=66 | text_len=207 | image=http://127.0.0.1:8000/static/generated/ai_gen_547c604482b9ea9a2f9972d4921cef59.webp
2025-09-28 19:56:03 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 666 (attempt 1/2)
2025-09-28 19:56:03 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 19:56:03 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759060561684_784.png
2025-09-28 19:56:03 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759060561684_784.png

2025-09-28 19:56:03 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759060561684_784.png

2025-09-28 19:56:05 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.png (大小: 1591053 字节)

2025-09-28 19:56:05 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.webp 大小 69446 字节 (原始 1591053 字节, 压缩比 0.04)

2025-09-28 19:56:05 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.png

2025-09-28 19:56:05 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.webp

2025-09-28 19:56:05 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.webp

2025-09-28 19:56:05 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.webp

2025-09-28 19:56:05 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.webp
2025-09-28 19:56:05 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:56:05 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=64 | choice="命亲兵将女童背负于肩，当众宣誓：‘楚不弃幼，宁死不辱’" | text_len=205 | text="项羽悄然下令，军中火把熄灭，战马蒙耳，铁甲裹布。残兵如游魂般潜入山林密道，足音隐于落叶与寒风之间。他立于崖顶，回望汉营灯火渐远，目光如刃，划破夜幕。身后，女童的笑声犹在耳畔——那不是恐惧，而是对生的执念。他低语：‘此去非逃，乃存楚之魂。’密道蜿蜒如蛇，深陷幽谷，岩壁滴水如泪。远处传来犬吠，汉军巡哨正向此处逼近。然而就在那一刻，山腹深处，一道微光忽明忽暗，似有旧部守候多年，静待故主归来。生死未定，但火种尚存。"
2025-09-28 19:56:05 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=64 | choice="命亲兵将女童背负于肩，当众宣誓：‘楚不弃幼，宁死不辱’" | node=67 | text_len=205 | image=http://127.0.0.1:8000/static/generated/ai_gen_8b1864e6b8205423e8c5e146f7ece3a0.webp
2025-09-28 19:56:26 | INFO     | trace=16f4cb59 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=64 task=continue | api.story:continue_existing_story:595 - continue requestchoice=将女童推入陷阱壕沟，以血肉诱敌入伏
2025-09-28 19:56:26 | INFO     | trace=16f4cb59 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=66 task=continue | api.story:continue_existing_story:641 - continue node ready check
2025-09-28 19:56:26 | INFO     | api.story:_wait_for_node_complete:165 - [NodeComplete] 开始等待节点完全准备：node_id=66
2025-09-28 19:56:26 | INFO     | api.story:_wait_for_node_complete:218 - [NodeComplete] ✅ 节点完全准备就绪：node_id=66 (等待了 0.0 秒)
2025-09-28 19:56:26 | INFO     | trace=16f4cb59 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=66 task=continue | api.story:continue_existing_story:644 - continue node ready success
2025-09-28 19:56:26 | INFO     | trace=16f4cb59 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=66 task=continue | api.story:continue_existing_story:653 - continue speculation enqueue existingdepth=1
2025-09-28 19:56:26 | DEBUG    | trace=16f4cb59 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=66 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=66 depth=1
2025-09-28 19:56:26 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_547c604482b9ea9a2f9972d4921cef59.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_547c604482b9ea9a2f9972d4921cef59.webp exists=True size=61142
2025-09-28 19:56:26 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_547c604482b9ea9a2f9972d4921cef59.webp
2025-09-28 19:56:26 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_547c604482b9ea9a2f9972d4921cef59.webp
2025-09-28 19:56:26 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=66
2025-09-28 19:56:26 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=66 | choice="命人将女童秘密送往江南旧部，托付给一位隐居的儒生抚养"
2025-09-28 19:56:26 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=66 | choice="将所有战旗焚毁，只留一面绣有‘楚’字的残布，作为日后聚义的信物"
2025-09-28 19:56:26 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=66 | choice="暗中派遣亲信伪装成樵夫，混入汉军粮道，散布谣言称楚军已得神助"
2025-09-28 19:56:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人将女童秘密送往江南旧部，托付给一位隐居的儒生抚养
2025-09-28 19:56:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将所有战旗焚毁，只留一面绣有‘楚’字的残布，作为日后聚义的信物
2025-09-28 19:56:26 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 暗中派遣亲信伪装成樵夫，混入汉军粮道，散布谣言称楚军已得神助
2025-09-28 19:56:31 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:56:31 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2661
2025-09-28 19:56:31 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=856 预览='{"text": "项羽目光如铁，将女童推入早已设好的陷阱壕沟，泥水溅起，她惊呼未尽，已被深坑吞噬。血色渗入腐叶，腥气弥漫。他立于沟沿，冷声下令：‘伏兵待命，敌若来探，便以血肉为饵，引其入死地。’风卷残旗，火光忽明忽暗，远处传来犬吠与马蹄轻响——汉军斥候果然循血迹逼近。战鼓未鸣，箭已在弦，而那女孩在坑底挣扎的身影，竟缓缓抬手，朝天伸去，仿佛在祈求什么，又似在告别。天地寂静，只余一声微弱的呜咽，穿透夜幕。", "choices": [{"option": "点燃火把，伪装成溃兵诱敌深入，借烟雾掩护埋伏", "summary": "以火为引，制造混乱，诱敌入瓮", "effects": {"del'
2025-09-28 19:56:31 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=856 预览='{"text": "项羽目光如铁，将女童推入早已设好的陷阱壕沟，泥水溅起，她惊呼未尽，已被深坑吞噬。血色渗入腐叶，腥气弥漫。他立于沟沿，冷声下令：‘伏兵待命，敌若来探，便以血肉为饵，引其入死地。’风卷残旗，火光忽明忽暗，远处传来犬吠与马蹄轻响——汉军斥候果然循血迹逼近。战鼓未鸣，箭已在弦，而那女孩在坑底挣扎的身影，竟缓'
2025-09-28 19:56:31 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=856 预览='{"text": "项羽目光如铁，将女童推入早已设好的陷阱壕沟，泥水溅起，她惊呼未尽，已被深坑吞噬。血色渗入腐叶，腥气弥漫。他立于沟沿，冷声下令：‘伏兵待命，敌若来探，便以血肉为饵，引其入死地。’风卷残旗，火光忽明忽暗，远处传来犬吠与马蹄轻响——汉军斥候果然循血迹逼近。战鼓未鸣，箭已在弦，而那女孩在坑底挣扎的身影，竟缓'
2025-09-28 19:56:31 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=193
2025-09-28 19:56:31 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=193 preview="项羽目光如铁，将女童推入早已设好的陷阱壕沟，泥水溅起，她惊呼未尽，已被深坑吞噬。血色渗入腐叶，腥气弥漫。他立于沟沿，冷声下令：‘伏兵待命，敌若来探，便以血肉为饵，引其入死地。’风卷残旗，火光忽明忽暗，远处传来犬吠与马蹄轻响——汉军斥候果然循血迹逼近。战鼓未鸣，箭已在弦，而那女孩在坑底挣扎的身影，竟缓缓抬手，朝天伸去，仿佛在祈求什么，又似在告别。天地寂静，只余一声微弱的呜咽，穿透夜幕。"

2025-09-28 19:56:31 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽目光如铁，将女童推入早已设好的陷阱壕沟，泥水溅起，她惊呼未尽，已被深坑吞噬。血色渗入腐叶，腥气弥漫。他立于沟沿，冷声下令：‘伏兵待命，敌若来…"

2025-09-28 19:56:31 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽目光如铁，将女童推入...
2025-09-28 19:56:31 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:56:31 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2658
2025-09-28 19:56:31 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=861 预览='{"text": "项羽立于深沟边缘，寒风卷起残袍。女童坠入陷阱的瞬间，血肉溅落泥中，腥气弥漫夜雾。他目光如铁，不动声色地挥手，伏兵从两侧密林跃出，弓弦拉满，箭锋对准汉军探路先锋。火光闪烁间，敌骑惊觉异动，马匹嘶鸣翻滚，陷入预设陷坑。然而就在那一刻，沟底传来微弱哭声——女童未死，挣扎着爬出泥泞，眼中无惧，只凝视着上方那个披甲的身影。天地骤静，连风都屏息。这并非战术，而是一场以心为祭的试炼。", "choices": [{"option": "亲自跃下沟中，将女童背出战场，命人掩护撤离", "summary": "以身犯险救下孩童，换取军心与道义", "effects": {"delta_pro'
2025-09-28 19:56:31 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=861 预览='{"text": "项羽立于深沟边缘，寒风卷起残袍。女童坠入陷阱的瞬间，血肉溅落泥中，腥气弥漫夜雾。他目光如铁，不动声色地挥手，伏兵从两侧密林跃出，弓弦拉满，箭锋对准汉军探路先锋。火光闪烁间，敌骑惊觉异动，马匹嘶鸣翻滚，陷入预设陷坑。然而就在那一刻，沟底传来微弱哭声——女童未死，挣扎着爬出泥泞，眼中无惧，只凝视着上方那'
2025-09-28 19:56:31 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=861 预览='{"text": "项羽立于深沟边缘，寒风卷起残袍。女童坠入陷阱的瞬间，血肉溅落泥中，腥气弥漫夜雾。他目光如铁，不动声色地挥手，伏兵从两侧密林跃出，弓弦拉满，箭锋对准汉军探路先锋。火光闪烁间，敌骑惊觉异动，马匹嘶鸣翻滚，陷入预设陷坑。然而就在那一刻，沟底传来微弱哭声——女童未死，挣扎着爬出泥泞，眼中无惧，只凝视着上方那'
2025-09-28 19:56:31 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=186
2025-09-28 19:56:31 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=186 preview="项羽立于深沟边缘，寒风卷起残袍。女童坠入陷阱的瞬间，血肉溅落泥中，腥气弥漫夜雾。他目光如铁，不动声色地挥手，伏兵从两侧密林跃出，弓弦拉满，箭锋对准汉军探路先锋。火光闪烁间，敌骑惊觉异动，马匹嘶鸣翻滚，陷入预设陷坑。然而就在那一刻，沟底传来微弱哭声——女童未死，挣扎着爬出泥泞，眼中无惧，只凝视着上方那个披甲的身影。天地骤静，连风都屏息。这并非战术，而是一场以心为祭的试炼。"

2025-09-28 19:56:31 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于深沟边缘，寒风卷起残袍。女童坠入陷阱的瞬间，血肉溅落泥中，腥气弥漫夜雾。他目光如铁，不动声色地挥手，伏兵从两侧密林跃出，弓弦拉满，箭锋对…"

2025-09-28 19:56:31 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于深沟边缘，寒风卷...
2025-09-28 19:56:32 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 19:56:32 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 2721
2025-09-28 19:56:32 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=927 预览='{"text": "项羽立于陷坑边缘，寒风卷起女童的发丝。他低头凝视那双清澈如泉的眼眸，仿佛看见当年江东少年时的自己。一瞬迟疑后，他猛然将女童推入深沟——血肉坠落之声沉闷如雷，回荡在山谷之间。刹那间，陷阱四周尘土翻飞，火把骤然亮起，汉军伏兵从四面密林中冲出，箭矢如蝗。但就在这千钧一发之际，项羽却未下令反击，反而转身疾奔，嘶吼如裂帛：‘走！’残部如潮水退入暗影，而那陷坑中，竟传来微弱的呼吸声——女童未死，正以残躯引动敌军，为楚军开辟生路。夜色吞没一切，唯有血与火，在山林间悄然重燃。", "choices": [{"option": "命人潜行至陷坑边，以绳索将女童拖出，藏于密道深处", "sum'
2025-09-28 19:56:32 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=927 预览='{"text": "项羽立于陷坑边缘，寒风卷起女童的发丝。他低头凝视那双清澈如泉的眼眸，仿佛看见当年江东少年时的自己。一瞬迟疑后，他猛然将女童推入深沟——血肉坠落之声沉闷如雷，回荡在山谷之间。刹那间，陷阱四周尘土翻飞，火把骤然亮起，汉军伏兵从四面密林中冲出，箭矢如蝗。但就在这千钧一发之际，项羽却未下令反击，反而转身疾奔'
2025-09-28 19:56:32 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=927 预览='{"text": "项羽立于陷坑边缘，寒风卷起女童的发丝。他低头凝视那双清澈如泉的眼眸，仿佛看见当年江东少年时的自己。一瞬迟疑后，他猛然将女童推入深沟——血肉坠落之声沉闷如雷，回荡在山谷之间。刹那间，陷阱四周尘土翻飞，火把骤然亮起，汉军伏兵从四面密林中冲出，箭矢如蝗。但就在这千钧一发之际，项羽却未下令反击，反而转身疾奔'
2025-09-28 19:56:32 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=232
2025-09-28 19:56:32 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=232 preview="项羽立于陷坑边缘，寒风卷起女童的发丝。他低头凝视那双清澈如泉的眼眸，仿佛看见当年江东少年时的自己。一瞬迟疑后，他猛然将女童推入深沟——血肉坠落之声沉闷如雷，回荡在山谷之间。刹那间，陷阱四周尘土翻飞，火把骤然亮起，汉军伏兵从四面密林中冲出，箭矢如蝗。但就在这千钧一发之际，项羽却未下令反击，反而转身疾奔，嘶吼如裂帛：‘走！’残部如潮水退入暗影，而那陷坑中，竟传来微弱的呼吸声——女童未死，正以残躯引动敌…"

2025-09-28 19:56:32 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于陷坑边缘，寒风卷起女童的发丝。他低头凝视那双清澈如泉的眼眸，仿佛看见当年江东少年时的自己。一瞬迟疑后，他猛然将女童推入深沟——血肉坠落之…"

2025-09-28 19:56:32 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 项羽立于陷坑边缘，寒风卷...
2025-09-28 19:56:40 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 796 (attempt 1/2)
2025-09-28 19:56:40 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=189

2025-09-28 19:56:40 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: {"usageMetadata":{"promptTokenCount":241,"totalTokenCount":241,"trafficType":"ON_DEMAND","promptTokensDetails":[{"modality":"TEXT","tokenCount":241}]}}
Vertex AI 过滤了你的请求内容，无法生成回复，请更换内容后再重试!...
2025-09-28 19:56:40 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:56:40 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:56:40 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=rebirth_gate_placeholder.png | url=http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-28 19:56:40 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-28 19:56:40 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:56:40 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=66 | choice="暗中派遣亲信伪装成樵夫，混入汉军粮道，散布谣言称楚军已得神助" | text_len=232 | text="项羽立于陷坑边缘，寒风卷起女童的发丝。他低头凝视那双清澈如泉的眼眸，仿佛看见当年江东少年时的自己。一瞬迟疑后，他猛然将女童推入深沟——血肉坠落之声沉闷如雷，回荡在山谷之间。刹那间，陷阱四周尘土翻飞，火把骤然亮起，汉军伏兵从四面密林中冲出，箭矢如蝗。但就在这千钧一发之际，项羽却未下令反击，反而转身疾奔，嘶吼如裂帛：‘走！’残部如潮水退入暗影，而那陷坑中，竟传来微弱的呼吸声——女童未死，正以残躯引动敌军，为楚军开辟生路。夜色吞没一切，唯有血与火，在山林间悄然重燃。"
2025-09-28 19:56:40 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=66 | choice="暗中派遣亲信伪装成樵夫，混入汉军粮道，散布谣言称楚军已得神助" | node=68 | text_len=232 | image=http://127.0.0.1:8000/static/rebirth_gate_placeholder.png
2025-09-28 19:56:41 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 599 (attempt 1/2)
2025-09-28 19:56:41 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=0

2025-09-28 19:56:41 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: ...
2025-09-28 19:56:41 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:56:41 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:56:41 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=magic_forest.jpg | url=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 19:56:41 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 19:56:41 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:56:41 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=66 | choice="将所有战旗焚毁，只留一面绣有‘楚’字的残布，作为日后聚义的信物" | text_len=193 | text="项羽目光如铁，将女童推入早已设好的陷阱壕沟，泥水溅起，她惊呼未尽，已被深坑吞噬。血色渗入腐叶，腥气弥漫。他立于沟沿，冷声下令：‘伏兵待命，敌若来探，便以血肉为饵，引其入死地。’风卷残旗，火光忽明忽暗，远处传来犬吠与马蹄轻响——汉军斥候果然循血迹逼近。战鼓未鸣，箭已在弦，而那女孩在坑底挣扎的身影，竟缓缓抬手，朝天伸去，仿佛在祈求什么，又似在告别。天地寂静，只余一声微弱的呜咽，穿透夜幕。"
2025-09-28 19:56:41 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=66 | choice="将所有战旗焚毁，只留一面绣有‘楚’字的残布，作为日后聚义的信物" | node=69 | text_len=193 | image=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 19:56:41 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 796 (attempt 1/2)
2025-09-28 19:56:41 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=189

2025-09-28 19:56:41 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: {"usageMetadata":{"promptTokenCount":197,"totalTokenCount":197,"trafficType":"ON_DEMAND","promptTokensDetails":[{"modality":"TEXT","tokenCount":197}]}}
Vertex AI 过滤了你的请求内容，无法生成回复，请更换内容后再重试!...
2025-09-28 19:56:41 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 19:56:41 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 19:56:41 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=space_station.jpg | url=http://127.0.0.1:8000/static/space_station.jpg
2025-09-28 19:56:41 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/space_station.jpg
2025-09-28 19:56:41 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 19:56:41 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=66 | choice="命人将女童秘密送往江南旧部，托付给一位隐居的儒生抚养" | text_len=186 | text="项羽立于深沟边缘，寒风卷起残袍。女童坠入陷阱的瞬间，血肉溅落泥中，腥气弥漫夜雾。他目光如铁，不动声色地挥手，伏兵从两侧密林跃出，弓弦拉满，箭锋对准汉军探路先锋。火光闪烁间，敌骑惊觉异动，马匹嘶鸣翻滚，陷入预设陷坑。然而就在那一刻，沟底传来微弱哭声——女童未死，挣扎着爬出泥泞，眼中无惧，只凝视着上方那个披甲的身影。天地骤静，连风都屏息。这并非战术，而是一场以心为祭的试炼。"
2025-09-28 19:56:41 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=66 | choice="命人将女童秘密送往江南旧部，托付给一位隐居的儒生抚养" | node=70 | text_len=186 | image=http://127.0.0.1:8000/static/space_station.jpg
2025-09-28 19:56:53 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_fde546289195bf9a900e588c602c48bc.webp exists=True size=76824
2025-09-28 19:56:53 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:56:53 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp exists=True size=49750
2025-09-28 19:56:53 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 19:56:53 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_66c82b47faedd97337276e0e272dc39c.webp exists=True size=74606
2025-09-28 19:56:53 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp exists=True size=76982
2025-09-28 19:56:53 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 19:56:53 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 19:56:53 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 19:56:53 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 19:56:53 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 19:56:53 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 20:28:06 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 20:28:15 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:28:16 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 20:28:17 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 20:28:17 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 20:28:17 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 20:28:17 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:28:17 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 20:28:17 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:28:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:28:17 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 20:28:17 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 20:28:17 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 20:28:17 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 20:28:17 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 20:28:17 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 20:28:17 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 20:28:17 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 20:28:17 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 20:28:17 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 20:28:17 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 20:28:17 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:28:18 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 20:28:18 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 20:28:18 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 20:28:18 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 20:28:18 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:28:41 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:309 - PrepareStart start wish=刘备
2025-09-28 20:28:41 | DEBUG    | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:311 - prepare context building
2025-09-28 20:28:41 | DEBUG    | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=9
2025-09-28 20:28:41 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=473
2025-09-28 20:28:42 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:28:42 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 896
2025-09-28 20:28:42 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:322 - prepare LLM done raw_len=226
2025-09-28 20:28:42 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 20:28:42 | DEBUG    | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:361 - prepare data parsed title=重生为刘备：桃园初起 quest=在黄巾起义爆发前，成功组建并凝聚桃园三兄弟
2025-09-28 20:28:42 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 20:28:42 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=刘备 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 20:28:42 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start
2025-09-28 20:28:42 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '刘备'
2025-09-28 20:28:46 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:28:46 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1379
2025-09-28 20:28:46 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=861 预览='{"text": "夜色如墨，江风卷起残旗，刘备立于江畔孤舟之上，目光穿透雾霭，直指对岸那座灯火摇曳的城楼。传令兵刚报：曹操已命人封锁渡口，三更前若无通行符节，将断绝所有退路。他指尖轻抚腰间玉佩——那是当年桃园结义时，关羽所赠的信物。远处传来马蹄踏碎寒霜的声响，一队铁甲骑兵正向此地逼近。他深吸一口气，江面倒映着天穹裂痕般的星轨，仿佛历史正在悄然改写。他必须在黎明前做出抉择：是借势而行，还是逆流而上？", "choices": [{"option": "点燃火把佯装大军压境，趁敌军疑虑之际从水道潜行突袭", "summary": "以声势制造混乱，借夜色掩护奇袭", "effects": {"d'
2025-09-28 20:28:46 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=861 预览='{"text": "夜色如墨，江风卷起残旗，刘备立于江畔孤舟之上，目光穿透雾霭，直指对岸那座灯火摇曳的城楼。传令兵刚报：曹操已命人封锁渡口，三更前若无通行符节，将断绝所有退路。他指尖轻抚腰间玉佩——那是当年桃园结义时，关羽所赠的信物。远处传来马蹄踏碎寒霜的声响，一队铁甲骑兵正向此地逼近。他深吸一口气，江面倒映着天穹裂痕'
2025-09-28 20:28:46 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=861 预览='{"text": "夜色如墨，江风卷起残旗，刘备立于江畔孤舟之上，目光穿透雾霭，直指对岸那座灯火摇曳的城楼。传令兵刚报：曹操已命人封锁渡口，三更前若无通行符节，将断绝所有退路。他指尖轻抚腰间玉佩——那是当年桃园结义时，关羽所赠的信物。远处传来马蹄踏碎寒霜的声响，一队铁甲骑兵正向此地逼近。他深吸一口气，江面倒映着天穹裂痕'
2025-09-28 20:28:46 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=191
2025-09-28 20:28:46 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=191 preview="夜色如墨，江风卷起残旗，刘备立于江畔孤舟之上，目光穿透雾霭，直指对岸那座灯火摇曳的城楼。传令兵刚报：曹操已命人封锁渡口，三更前若无通行符节，将断绝所有退路。他指尖轻抚腰间玉佩——那是当年桃园结义时，关羽所赠的信物。远处传来马蹄踏碎寒霜的声响，一队铁甲骑兵正向此地逼近。他深吸一口气，江面倒映着天穹裂痕般的星轨，仿佛历史正在悄然改写。他必须在黎明前做出抉择：是借势而行，还是逆流而上？"

2025-09-28 20:28:46 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-28 20:28:46 | INFO     | core.image_storage:__init__:34 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images

2025-09-28 20:28:46 | INFO     | core.image_storage:__init__:35 - 图像web访问前缀: http://127.0.0.1:8000/static/generated

2025-09-28 20:28:46 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，江风卷起残旗，刘备立于江畔孤舟之上，目光穿透雾霭，直指对岸那座灯火摇曳的城楼。传令兵刚报：曹操已命人封锁渡口，三更前若无通行符节，将断…"

2025-09-28 20:28:46 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，江风卷起残旗，...
2025-09-28 20:28:54 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:432 - start request wish=刘备
2025-09-28 20:28:54 | DEBUG    | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:435 - start wish validated
2025-09-28 20:28:54 | DEBUG    | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:439 - start cache keycache_key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:daf7b56cd3aea44f7fdfd23d3def543b725668291e54be5dc130dbec27aa3f11
2025-09-28 20:28:54 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:456 - start cache first hithit=False
2025-09-28 20:28:54 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=0.0 limit=8
2025-09-28 20:28:54 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=0.4 limit=8
2025-09-28 20:28:55 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=0.8 limit=8
2025-09-28 20:28:55 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=1.2000000000000002 limit=8
2025-09-28 20:28:56 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=1.6 limit=8
2025-09-28 20:28:56 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=2.0 limit=8
2025-09-28 20:28:56 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=2.4 limit=8
2025-09-28 20:28:57 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=2.8 limit=8
2025-09-28 20:28:57 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=3.1999999999999997 limit=8
2025-09-28 20:28:58 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=3.5999999999999996 limit=8
2025-09-28 20:28:58 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:28:58 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:28:58 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062537987_347.png
2025-09-28 20:28:58 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062537987_347.png

2025-09-28 20:28:58 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062537987_347.png

2025-09-28 20:28:58 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=3.9999999999999996 limit=8
2025-09-28 20:28:58 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=4.3999999999999995 limit=8
2025-09-28 20:28:59 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=4.8 limit=8
2025-09-28 20:28:59 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=5.2 limit=8
2025-09-28 20:28:59 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.png (大小: 804779 字节)

2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=5.6000000000000005 limit=8
2025-09-28 20:29:00 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp 大小 27636 字节 (原始 804779 字节, 压缩比 0.03)

2025-09-28 20:29:00 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.png

2025-09-28 20:29:00 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp

2025-09-28 20:29:00 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp

2025-09-28 20:29:00 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp

2025-09-28 20:29:00 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:00 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=191
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:118 - pregeneration session created
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:123 - pregeneration node created
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:126 - pregeneration node imageimage=http://127.0.0.1:8000/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:135 - pregeneration cache stored
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:140 - pregeneration speculation enqueueddepth=0
2025-09-28 20:29:00 | INFO     | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:142 - pregeneration done
2025-09-28 20:29:00 | DEBUG    | trace=fb65adbb user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=pregeneration wish=刘备 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed
2025-09-28 20:29:00 | DEBUG    | api.story:_cache_pop:92 - [预生成] 从缓存中取出 key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:daf7b56cd3aea44f7fdfd23d3def543b725668291e54be5dc130dbec27aa3f11
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=刘备 | api.story:start_new_story:466 - start cache successsession_id=13 node_id=71 elapsed=6.000000000000001
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=start wish=刘备 | api.story:start_new_story:473 - start use pregenerated
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=start wish=刘备 | api.story:start_new_story:494 - start use cached nodesession_id=13 node_id=71
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=start wish=刘备 | api.story:start_new_story:554 - start donetext_len=191 choice_count=3 image=http://127.0.0.1:8000/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=start wish=刘备 | api.story:start_new_story:561 - start image filefile_exists=True size=27636 path=C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=start wish=刘备 | api.story:start_new_story:564 - start speculation enqueuedepth=1
2025-09-28 20:29:00 | DEBUG    | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=13 node=71 depth=1
2025-09-28 20:29:00 | INFO     | trace=c7819141 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=start wish=刘备 | api.story:start_new_story:567 - start response readyimage=http://127.0.0.1:8000/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:00 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp exists=True size=27636
2025-09-28 20:29:00 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:00 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=71
2025-09-28 20:29:00 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=71 | choice="点燃火把佯装大军压境，趁敌军疑虑之际从水道潜行突袭"
2025-09-28 20:29:00 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=71 | choice="脱下战袍，披上渔夫蓑衣，混入江边打鱼的船队顺流而下"
2025-09-28 20:29:00 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃火把佯装大军压境，趁敌军疑虑之际从水道潜行突袭
2025-09-28 20:29:00 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=71 | choice="登上高台，击鼓鸣号，以旧日兄弟之名召唤守军响应"
2025-09-28 20:29:00 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 脱下战袍，披上渔夫蓑衣，混入江边打鱼的船队顺流而下
2025-09-28 20:29:00 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 登上高台，击鼓鸣号，以旧日兄弟之名召唤守军响应
2025-09-28 20:29:00 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 20:29:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:29:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1561
2025-09-28 20:29:04 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=874 预览='{"text": "江风骤紧，铁蹄声如雷贯耳，三更将至，渡口火把摇曳，守军已列阵待命。刘备凝视玉佩，指尖微颤——那枚刻着‘义’字的玉，正映出他眼中未熄的星火。远处传来低沉号角，骑兵队形忽变，竟似在布设包围圈。他猛然抬头，望见对岸城楼之上，一道熟悉的身影伫立于烽火台边，披风猎猎，仿佛在等他。是关羽？还是幻象？夜雾弥漫，江面如镜，倒映出两道重叠的身影，一前一后，似在争抢命运的船桨。他必须立刻决定：是借风而行，还是逆浪登岸？", "choices": [{"option": "将玉佩投入江心，借水波荡漾引开守军注意力，趁乱潜行", "summary": "以信物为饵，制造混乱突破防线", "effe'
2025-09-28 20:29:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=874 预览='{"text": "江风骤紧，铁蹄声如雷贯耳，三更将至，渡口火把摇曳，守军已列阵待命。刘备凝视玉佩，指尖微颤——那枚刻着‘义’字的玉，正映出他眼中未熄的星火。远处传来低沉号角，骑兵队形忽变，竟似在布设包围圈。他猛然抬头，望见对岸城楼之上，一道熟悉的身影伫立于烽火台边，披风猎猎，仿佛在等他。是关羽？还是幻象？夜雾弥漫，江'
2025-09-28 20:29:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=874 预览='{"text": "江风骤紧，铁蹄声如雷贯耳，三更将至，渡口火把摇曳，守军已列阵待命。刘备凝视玉佩，指尖微颤——那枚刻着‘义’字的玉，正映出他眼中未熄的星火。远处传来低沉号角，骑兵队形忽变，竟似在布设包围圈。他猛然抬头，望见对岸城楼之上，一道熟悉的身影伫立于烽火台边，披风猎猎，仿佛在等他。是关羽？还是幻象？夜雾弥漫，江'
2025-09-28 20:29:04 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=201
2025-09-28 20:29:04 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=201 preview="江风骤紧，铁蹄声如雷贯耳，三更将至，渡口火把摇曳，守军已列阵待命。刘备凝视玉佩，指尖微颤——那枚刻着‘义’字的玉，正映出他眼中未熄的星火。远处传来低沉号角，骑兵队形忽变，竟似在布设包围圈。他猛然抬头，望见对岸城楼之上，一道熟悉的身影伫立于烽火台边，披风猎猎，仿佛在等他。是关羽？还是幻象？夜雾弥漫，江面如镜，倒映出两道重叠的身影，一前一后，似在争抢命运的船桨。他必须立刻决定：是借风而行，还是逆浪登岸…"

2025-09-28 20:29:04 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，铁蹄声如雷贯耳，三更将至，渡口火把摇曳，守军已列阵待命。刘备凝视玉佩，指尖微颤——那枚刻着‘义’字的玉，正映出他眼中未熄的星火。远处传…"

2025-09-28 20:29:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，铁蹄声如雷贯耳...
2025-09-28 20:29:04 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:29:04 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1511
2025-09-28 20:29:04 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=826 预览='{"text": "江风骤紧，芦苇丛中传来窸窣声响，一缕焦烟自对岸飘来。刘备凝视玉佩，忽觉其内侧刻痕竟与当年桃园盟誓时的暗记隐隐相合——那并非寻常信物，而是藏有密道机关的凭证。他猛然抬头，远处骑兵已近，马蹄踏碎霜花如雷鸣。若此时亮出玉佩，或可唤醒旧部暗线，但一旦暴露身份，便再无退路。他指尖轻叩玉佩，一声轻响如裂帛，江面倒影中浮现出一道隐秘水道的轮廓，仿佛命运在雾中悄然铺展。", "choices": [{"option": "将玉佩掷入江心，借其沉没之瞬引动水下机关，开启密道", "summary": "以信物为祭，触发隐藏路径", "effects": {"delta_progress": '
2025-09-28 20:29:04 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=826 预览='{"text": "江风骤紧，芦苇丛中传来窸窣声响，一缕焦烟自对岸飘来。刘备凝视玉佩，忽觉其内侧刻痕竟与当年桃园盟誓时的暗记隐隐相合——那并非寻常信物，而是藏有密道机关的凭证。他猛然抬头，远处骑兵已近，马蹄踏碎霜花如雷鸣。若此时亮出玉佩，或可唤醒旧部暗线，但一旦暴露身份，便再无退路。他指尖轻叩玉佩，一声轻响如裂帛，江面'
2025-09-28 20:29:04 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=826 预览='{"text": "江风骤紧，芦苇丛中传来窸窣声响，一缕焦烟自对岸飘来。刘备凝视玉佩，忽觉其内侧刻痕竟与当年桃园盟誓时的暗记隐隐相合——那并非寻常信物，而是藏有密道机关的凭证。他猛然抬头，远处骑兵已近，马蹄踏碎霜花如雷鸣。若此时亮出玉佩，或可唤醒旧部暗线，但一旦暴露身份，便再无退路。他指尖轻叩玉佩，一声轻响如裂帛，江面'
2025-09-28 20:29:04 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=178
2025-09-28 20:29:04 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=178 preview="江风骤紧，芦苇丛中传来窸窣声响，一缕焦烟自对岸飘来。刘备凝视玉佩，忽觉其内侧刻痕竟与当年桃园盟誓时的暗记隐隐相合——那并非寻常信物，而是藏有密道机关的凭证。他猛然抬头，远处骑兵已近，马蹄踏碎霜花如雷鸣。若此时亮出玉佩，或可唤醒旧部暗线，但一旦暴露身份，便再无退路。他指尖轻叩玉佩，一声轻响如裂帛，江面倒影中浮现出一道隐秘水道的轮廓，仿佛命运在雾中悄然铺展。"

2025-09-28 20:29:04 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，芦苇丛中传来窸窣声响，一缕焦烟自对岸飘来。刘备凝视玉佩，忽觉其内侧刻痕竟与当年桃园盟誓时的暗记隐隐相合——那并非寻常信物，而是藏有密道…"

2025-09-28 20:29:04 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，芦苇丛中传来窸...
2025-09-28 20:29:05 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:29:05 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1602
2025-09-28 20:29:05 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=937 预览='{"text": "江风骤紧，铁蹄声如雷贯耳，火把在雾中划出猩红轨迹。刘备凝视玉佩，指尖微颤——那枚曾见证三兄弟誓约的信物，此刻竟泛起一丝温热。他猛然抬头，望见对岸城楼墙上，一道熟悉的青色战旗正随风猎猎作响，那是关羽亲率的先锋营标志！可这不该在此处，更不该在曹军封锁前夜。他脑中轰然炸开：是幻象？还是命运的暗语？他俯身将玉佩贴于江面，水纹涟漪间，竟浮现出一段模糊的旧时密语：‘若见赤焰照江，当逆流而上’。刹那间，江心深处传来沉闷鼓点，仿佛有千军万马自深渊苏醒。他必须抉择——是听从天意，还是执掌自己的命途？", "choices": [{"option": "将玉佩投入江心，引动水下异象，借潮汐之力'
2025-09-28 20:29:05 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=937 预览='{"text": "江风骤紧，铁蹄声如雷贯耳，火把在雾中划出猩红轨迹。刘备凝视玉佩，指尖微颤——那枚曾见证三兄弟誓约的信物，此刻竟泛起一丝温热。他猛然抬头，望见对岸城楼墙上，一道熟悉的青色战旗正随风猎猎作响，那是关羽亲率的先锋营标志！可这不该在此处，更不该在曹军封锁前夜。他脑中轰然炸开：是幻象？还是命运的暗语？他俯身将'
2025-09-28 20:29:05 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=937 预览='{"text": "江风骤紧，铁蹄声如雷贯耳，火把在雾中划出猩红轨迹。刘备凝视玉佩，指尖微颤——那枚曾见证三兄弟誓约的信物，此刻竟泛起一丝温热。他猛然抬头，望见对岸城楼墙上，一道熟悉的青色战旗正随风猎猎作响，那是关羽亲率的先锋营标志！可这不该在此处，更不该在曹军封锁前夜。他脑中轰然炸开：是幻象？还是命运的暗语？他俯身将'
2025-09-28 20:29:05 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=243
2025-09-28 20:29:05 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=243 preview="江风骤紧，铁蹄声如雷贯耳，火把在雾中划出猩红轨迹。刘备凝视玉佩，指尖微颤——那枚曾见证三兄弟誓约的信物，此刻竟泛起一丝温热。他猛然抬头，望见对岸城楼墙上，一道熟悉的青色战旗正随风猎猎作响，那是关羽亲率的先锋营标志！可这不该在此处，更不该在曹军封锁前夜。他脑中轰然炸开：是幻象？还是命运的暗语？他俯身将玉佩贴于江面，水纹涟漪间，竟浮现出一段模糊的旧时密语：‘若见赤焰照江，当逆流而上’。刹那间，江心深处…"

2025-09-28 20:29:05 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，铁蹄声如雷贯耳，火把在雾中划出猩红轨迹。刘备凝视玉佩，指尖微颤——那枚曾见证三兄弟誓约的信物，此刻竟泛起一丝温热。他猛然抬头，望见对岸…"

2025-09-28 20:29:05 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 江风骤紧，铁蹄声如雷贯耳...
2025-09-28 20:29:15 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:29:15 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:29:15 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062555341_893.png
2025-09-28 20:29:15 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062555341_893.png

2025-09-28 20:29:15 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062555341_893.png

2025-09-28 20:29:16 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:29:16 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:29:16 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062555907_961.png
2025-09-28 20:29:16 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062555907_961.png

2025-09-28 20:29:16 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062555907_961.png

2025-09-28 20:29:17 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:29:17 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:29:17 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062556852_265.png
2025-09-28 20:29:17 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062556852_265.png

2025-09-28 20:29:17 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062556852_265.png

2025-09-28 20:29:17 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_ce69a393b6e0170c65497479654e314a.png (大小: 1408562 字节)

2025-09-28 20:29:17 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_ce69a393b6e0170c65497479654e314a.webp 大小 73730 字节 (原始 1408562 字节, 压缩比 0.05)

2025-09-28 20:29:17 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_ce69a393b6e0170c65497479654e314a.png

2025-09-28 20:29:17 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_ce69a393b6e0170c65497479654e314a.webp

2025-09-28 20:29:17 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ce69a393b6e0170c65497479654e314a.webp

2025-09-28 20:29:17 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_ce69a393b6e0170c65497479654e314a.webp

2025-09-28 20:29:17 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_ce69a393b6e0170c65497479654e314a.webp
2025-09-28 20:29:17 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:29:17 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=71 | choice="脱下战袍，披上渔夫蓑衣，混入江边打鱼的船队顺流而下" | text_len=178 | text="江风骤紧，芦苇丛中传来窸窣声响，一缕焦烟自对岸飘来。刘备凝视玉佩，忽觉其内侧刻痕竟与当年桃园盟誓时的暗记隐隐相合——那并非寻常信物，而是藏有密道机关的凭证。他猛然抬头，远处骑兵已近，马蹄踏碎霜花如雷鸣。若此时亮出玉佩，或可唤醒旧部暗线，但一旦暴露身份，便再无退路。他指尖轻叩玉佩，一声轻响如裂帛，江面倒影中浮现出一道隐秘水道的轮廓，仿佛命运在雾中悄然铺展。"
2025-09-28 20:29:17 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=71 | choice="脱下战袍，披上渔夫蓑衣，混入江边打鱼的船队顺流而下" | node=72 | text_len=178 | image=http://127.0.0.1:8000/static/generated/ai_gen_ce69a393b6e0170c65497479654e314a.webp
2025-09-28 20:29:18 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.png (大小: 1330300 字节)

2025-09-28 20:29:18 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp 大小 68482 字节 (原始 1330300 字节, 压缩比 0.05)

2025-09-28 20:29:18 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.png

2025-09-28 20:29:18 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp

2025-09-28 20:29:18 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp

2025-09-28 20:29:18 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp

2025-09-28 20:29:18 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp
2025-09-28 20:29:18 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:29:18 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=71 | choice="点燃火把佯装大军压境，趁敌军疑虑之际从水道潜行突袭" | text_len=243 | text="江风骤紧，铁蹄声如雷贯耳，火把在雾中划出猩红轨迹。刘备凝视玉佩，指尖微颤——那枚曾见证三兄弟誓约的信物，此刻竟泛起一丝温热。他猛然抬头，望见对岸城楼墙上，一道熟悉的青色战旗正随风猎猎作响，那是关羽亲率的先锋营标志！可这不该在此处，更不该在曹军封锁前夜。他脑中轰然炸开：是幻象？还是命运的暗语？他俯身将玉佩贴于江面，水纹涟漪间，竟浮现出一段模糊的旧时密语：‘若见赤焰照江，当逆流而上’。刹那间，江心深处传来沉闷鼓点，仿佛有千军万马自深渊苏醒。他必须抉择——是听从天意，还是执掌自己的命途？"
2025-09-28 20:29:18 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=71 | choice="点燃火把佯装大军压境，趁敌军疑虑之际从水道潜行突袭" | node=73 | text_len=243 | image=http://127.0.0.1:8000/static/generated/ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp
2025-09-28 20:29:19 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.png (大小: 1326537 字节)

2025-09-28 20:29:19 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.webp 大小 59422 字节 (原始 1326537 字节, 压缩比 0.04)

2025-09-28 20:29:19 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.png

2025-09-28 20:29:19 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.webp

2025-09-28 20:29:19 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.webp

2025-09-28 20:29:19 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.webp

2025-09-28 20:29:19 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.webp
2025-09-28 20:29:19 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:29:19 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=71 | choice="登上高台，击鼓鸣号，以旧日兄弟之名召唤守军响应" | text_len=201 | text="江风骤紧，铁蹄声如雷贯耳，三更将至，渡口火把摇曳，守军已列阵待命。刘备凝视玉佩，指尖微颤——那枚刻着‘义’字的玉，正映出他眼中未熄的星火。远处传来低沉号角，骑兵队形忽变，竟似在布设包围圈。他猛然抬头，望见对岸城楼之上，一道熟悉的身影伫立于烽火台边，披风猎猎，仿佛在等他。是关羽？还是幻象？夜雾弥漫，江面如镜，倒映出两道重叠的身影，一前一后，似在争抢命运的船桨。他必须立刻决定：是借风而行，还是逆浪登岸？"
2025-09-28 20:29:19 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=71 | choice="登上高台，击鼓鸣号，以旧日兄弟之名召唤守军响应" | node=74 | text_len=201 | image=http://127.0.0.1:8000/static/generated/ai_gen_adf969bdd963a6c0fe76f71e67ad19a4.webp
2025-09-28 20:29:29 | INFO     | api.story:retry_from_node:758 - 收到时空回溯请求，目标节点: 71
2025-09-28 20:29:29 | INFO     | database.crud:prune_story_after_node:302 - 正在从节点 71 之后进行时空回溯...
2025-09-28 20:29:29 | INFO     | database.crud:prune_story_after_node:324 - 已完成回溯：保留并标记节点 71 的子孙节点 [74, 72, 73] 为推演缓存。
2025-09-28 20:29:31 | INFO     | trace=73ec4f60 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=71 task=continue | api.story:continue_existing_story:595 - continue requestchoice=点燃火把佯装大军压境，趁敌军疑虑之际从水道潜行突袭
2025-09-28 20:29:31 | INFO     | trace=73ec4f60 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=73 task=continue | api.story:continue_existing_story:641 - continue node ready check
2025-09-28 20:29:31 | INFO     | api.story:_wait_for_node_complete:165 - [NodeComplete] 开始等待节点完全准备：node_id=73
2025-09-28 20:29:31 | INFO     | api.story:_wait_for_node_complete:218 - [NodeComplete] ✅ 节点完全准备就绪：node_id=73 (等待了 0.0 秒)
2025-09-28 20:29:31 | INFO     | trace=73ec4f60 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=73 task=continue | api.story:continue_existing_story:644 - continue node ready success
2025-09-28 20:29:31 | INFO     | trace=73ec4f60 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=73 task=continue | api.story:continue_existing_story:653 - continue speculation enqueue existingdepth=1
2025-09-28 20:29:31 | DEBUG    | trace=73ec4f60 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=13 node=73 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=13 node=73 depth=1
2025-09-28 20:29:31 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=73
2025-09-28 20:29:31 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=73 | choice="将玉佩投入江心，引动水下异象，借潮汐之力强行破阵"
2025-09-28 20:29:31 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=73 | choice="点燃火把，高举玉佩于船头，向对岸发出桃园结义的旧日信号"
2025-09-28 20:29:31 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 将玉佩投入江心，引动水下异象，借潮汐之力强行破阵
2025-09-28 20:29:31 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=73 | choice="命亲兵驾小舟佯攻东侧，自己则潜行至北岸石壁，寻找传说中的隐道"
2025-09-28 20:29:31 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp exists=True size=68482
2025-09-28 20:29:31 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 点燃火把，高举玉佩于船头，向对岸发出桃园结义的旧日信号
2025-09-28 20:29:31 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp
2025-09-28 20:29:31 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命亲兵驾小舟佯攻东侧，自己则潜行至北岸石壁，寻找传说中的隐道
2025-09-28 20:29:31 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp
2025-09-28 20:29:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:29:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1825
2025-09-28 20:29:34 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=938 预览='{"text": "火把在江雾中腾起赤焰，如龙蛇般蜿蜒于水道两岸。刘备将火把掷入水中，火焰顺着浮木蔓延，映得江面如血。敌军哨塔上惊鸣骤起，弓弩手纷纷转向火光源头，疑为大军压境。就在此时，他悄然解开船缆，令小舟顺流而下，隐入暗影深处。江底传来沉闷的震动，仿佛有千军万马在水底踏步前行——那玉佩所唤起的异象，竟与这夜色共震。前方水道尽头，一道铁索横江，锁链锈迹斑斑，却仍牢牢钉住渡口。若强行破锁，必惊动守军；若绕行，则需穿越幽深水洞，内藏未知险境。更令人不安的是，江心深处传来低语般的战鼓声，似有人在呼唤‘三弟’……", "choices": [{"option": "用火油点燃铁索，借烈焰冲开封锁，纵'
2025-09-28 20:29:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=938 预览='{"text": "火把在江雾中腾起赤焰，如龙蛇般蜿蜒于水道两岸。刘备将火把掷入水中，火焰顺着浮木蔓延，映得江面如血。敌军哨塔上惊鸣骤起，弓弩手纷纷转向火光源头，疑为大军压境。就在此时，他悄然解开船缆，令小舟顺流而下，隐入暗影深处。江底传来沉闷的震动，仿佛有千军万马在水底踏步前行——那玉佩所唤起的异象，竟与这夜色共震。'
2025-09-28 20:29:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=938 预览='{"text": "火把在江雾中腾起赤焰，如龙蛇般蜿蜒于水道两岸。刘备将火把掷入水中，火焰顺着浮木蔓延，映得江面如血。敌军哨塔上惊鸣骤起，弓弩手纷纷转向火光源头，疑为大军压境。就在此时，他悄然解开船缆，令小舟顺流而下，隐入暗影深处。江底传来沉闷的震动，仿佛有千军万马在水底踏步前行——那玉佩所唤起的异象，竟与这夜色共震。'
2025-09-28 20:29:34 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=246
2025-09-28 20:29:34 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=246 preview="火把在江雾中腾起赤焰，如龙蛇般蜿蜒于水道两岸。刘备将火把掷入水中，火焰顺着浮木蔓延，映得江面如血。敌军哨塔上惊鸣骤起，弓弩手纷纷转向火光源头，疑为大军压境。就在此时，他悄然解开船缆，令小舟顺流而下，隐入暗影深处。江底传来沉闷的震动，仿佛有千军万马在水底踏步前行——那玉佩所唤起的异象，竟与这夜色共震。前方水道尽头，一道铁索横江，锁链锈迹斑斑，却仍牢牢钉住渡口。若强行破锁，必惊动守军；若绕行，则需穿越…"

2025-09-28 20:29:34 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 火把在江雾中腾起赤焰，如龙蛇般蜿蜒于水道两岸。刘备将火把掷入水中，火焰顺着浮木蔓延，映得江面如血。敌军哨塔上惊鸣骤起，弓弩手纷纷转向火光源头，疑…"

2025-09-28 20:29:34 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 火把在江雾中腾起赤焰，如...
2025-09-28 20:29:34 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:29:34 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1783
2025-09-28 20:29:34 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=865 预览='{"text": "火把在江面点燃，赤焰如龙腾跃，映得水波翻滚如血。刘备将火把掷入水中，火光顺着浮木顺流而下，远处敌营瞬间警铃大作，旌旗乱舞。他低声下令：‘点起十支火把，分三路引燃，声势要足！’船队悄然潜入暗流，铁甲轻响，如同游鱼穿行于夜雾之中。江底传来沉闷轰鸣，仿佛有千军万马在水下奔袭。突然，前方水道中浮出一具披甲尸首，手持锈迹斑斑的铜戟，双眼空洞地望向天际——那是当年长坂坡战死的旧部？还是冥河守门人？更令人惊心的是，玉佩在胸前微微发烫，竟与那尸首手中铜戟共鸣，泛起幽蓝微光。", "choices": [{"option": "用玉佩触碰尸首铜戟，试探其灵异之力", "summary": "'
2025-09-28 20:29:34 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=865 预览='{"text": "火把在江面点燃，赤焰如龙腾跃，映得水波翻滚如血。刘备将火把掷入水中，火光顺着浮木顺流而下，远处敌营瞬间警铃大作，旌旗乱舞。他低声下令：‘点起十支火把，分三路引燃，声势要足！’船队悄然潜入暗流，铁甲轻响，如同游鱼穿行于夜雾之中。江底传来沉闷轰鸣，仿佛有千军万马在水下奔袭。突然，前方水道中浮出一具披甲尸'
2025-09-28 20:29:34 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=865 预览='{"text": "火把在江面点燃，赤焰如龙腾跃，映得水波翻滚如血。刘备将火把掷入水中，火光顺着浮木顺流而下，远处敌营瞬间警铃大作，旌旗乱舞。他低声下令：‘点起十支火把，分三路引燃，声势要足！’船队悄然潜入暗流，铁甲轻响，如同游鱼穿行于夜雾之中。江底传来沉闷轰鸣，仿佛有千军万马在水下奔袭。突然，前方水道中浮出一具披甲尸'
2025-09-28 20:29:34 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=231
2025-09-28 20:29:34 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=231 preview="火把在江面点燃，赤焰如龙腾跃，映得水波翻滚如血。刘备将火把掷入水中，火光顺着浮木顺流而下，远处敌营瞬间警铃大作，旌旗乱舞。他低声下令：‘点起十支火把，分三路引燃，声势要足！’船队悄然潜入暗流，铁甲轻响，如同游鱼穿行于夜雾之中。江底传来沉闷轰鸣，仿佛有千军万马在水下奔袭。突然，前方水道中浮出一具披甲尸首，手持锈迹斑斑的铜戟，双眼空洞地望向天际——那是当年长坂坡战死的旧部？还是冥河守门人？更令人惊心的…"

2025-09-28 20:29:34 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 火把在江面点燃，赤焰如龙腾跃，映得水波翻滚如血。刘备将火把掷入水中，火光顺着浮木顺流而下，远处敌营瞬间警铃大作，旌旗乱舞。他低声下令：‘点起十支…"

2025-09-28 20:29:34 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 火把在江面点燃，赤焰如龙...
2025-09-28 20:29:35 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:29:35 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1796
2025-09-28 20:29:35 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=880 预览='{"text": "火把在江面点燃，烈焰如赤龙腾跃，映得两岸水色翻红。刘备立于船首，将火把掷入水中，瞬间激起一片沸腾的光浪。远处敌营传来惊呼，火光摇曳中，仿佛千军万马正从暗流中踏波而来。他紧握玉佩，低声念道：‘若天意不弃，便借这虚影破局。’舟身悄然滑入密布芦苇的水道，桨声轻如呼吸，唯余江心倒影中那抹青旗，依旧在雾中飘荡，似有若无。前方水道尽头，隐约可见一队曹军巡哨正向此处逼近，而更深处，传来铁甲摩擦石壁的声响——那是另一支伏兵正在移动。时间如刀，每一息都可能决定生死。", "choices": [{"option": "将火把绑在浮木上顺流漂向敌营，制造大军来袭假象", "summary": '
2025-09-28 20:29:35 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=880 预览='{"text": "火把在江面点燃，烈焰如赤龙腾跃，映得两岸水色翻红。刘备立于船首，将火把掷入水中，瞬间激起一片沸腾的光浪。远处敌营传来惊呼，火光摇曳中，仿佛千军万马正从暗流中踏波而来。他紧握玉佩，低声念道：‘若天意不弃，便借这虚影破局。’舟身悄然滑入密布芦苇的水道，桨声轻如呼吸，唯余江心倒影中那抹青旗，依旧在雾中飘荡'
2025-09-28 20:29:35 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=880 预览='{"text": "火把在江面点燃，烈焰如赤龙腾跃，映得两岸水色翻红。刘备立于船首，将火把掷入水中，瞬间激起一片沸腾的光浪。远处敌营传来惊呼，火光摇曳中，仿佛千军万马正从暗流中踏波而来。他紧握玉佩，低声念道：‘若天意不弃，便借这虚影破局。’舟身悄然滑入密布芦苇的水道，桨声轻如呼吸，唯余江心倒影中那抹青旗，依旧在雾中飘荡'
2025-09-28 20:29:35 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=226
2025-09-28 20:29:35 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=226 preview="火把在江面点燃，烈焰如赤龙腾跃，映得两岸水色翻红。刘备立于船首，将火把掷入水中，瞬间激起一片沸腾的光浪。远处敌营传来惊呼，火光摇曳中，仿佛千军万马正从暗流中踏波而来。他紧握玉佩，低声念道：‘若天意不弃，便借这虚影破局。’舟身悄然滑入密布芦苇的水道，桨声轻如呼吸，唯余江心倒影中那抹青旗，依旧在雾中飘荡，似有若无。前方水道尽头，隐约可见一队曹军巡哨正向此处逼近，而更深处，传来铁甲摩擦石壁的声响——那是…"

2025-09-28 20:29:35 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 火把在江面点燃，烈焰如赤龙腾跃，映得两岸水色翻红。刘备立于船首，将火把掷入水中，瞬间激起一片沸腾的光浪。远处敌营传来惊呼，火光摇曳中，仿佛千军万…"

2025-09-28 20:29:35 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 火把在江面点燃，烈焰如赤...
2025-09-28 20:29:46 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:29:46 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:29:46 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062585962_766.png
2025-09-28 20:29:46 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062585962_766.png

2025-09-28 20:29:46 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062585962_766.png

2025-09-28 20:29:47 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_49797617b904cac9c78a25ddc1949836.png (大小: 1373692 字节)

2025-09-28 20:29:47 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_49797617b904cac9c78a25ddc1949836.webp 大小 60784 字节 (原始 1373692 字节, 压缩比 0.04)

2025-09-28 20:29:47 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_49797617b904cac9c78a25ddc1949836.png

2025-09-28 20:29:47 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_49797617b904cac9c78a25ddc1949836.webp

2025-09-28 20:29:47 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_49797617b904cac9c78a25ddc1949836.webp

2025-09-28 20:29:47 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_49797617b904cac9c78a25ddc1949836.webp

2025-09-28 20:29:47 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_49797617b904cac9c78a25ddc1949836.webp
2025-09-28 20:29:47 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:29:47 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=73 | choice="命亲兵驾小舟佯攻东侧，自己则潜行至北岸石壁，寻找传说中的隐道" | text_len=226 | text="火把在江面点燃，烈焰如赤龙腾跃，映得两岸水色翻红。刘备立于船首，将火把掷入水中，瞬间激起一片沸腾的光浪。远处敌营传来惊呼，火光摇曳中，仿佛千军万马正从暗流中踏波而来。他紧握玉佩，低声念道：‘若天意不弃，便借这虚影破局。’舟身悄然滑入密布芦苇的水道，桨声轻如呼吸，唯余江心倒影中那抹青旗，依旧在雾中飘荡，似有若无。前方水道尽头，隐约可见一队曹军巡哨正向此处逼近，而更深处，传来铁甲摩擦石壁的声响——那是另一支伏兵正在移动。时间如刀，每一息都可能决定生死。"
2025-09-28 20:29:47 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=73 | choice="命亲兵驾小舟佯攻东侧，自己则潜行至北岸石壁，寻找传说中的隐道" | node=75 | text_len=226 | image=http://127.0.0.1:8000/static/generated/ai_gen_49797617b904cac9c78a25ddc1949836.webp
2025-09-28 20:29:48 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:29:48 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:29:48 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062587829_824.png
2025-09-28 20:29:48 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062587829_824.png

2025-09-28 20:29:48 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062587829_824.png

2025-09-28 20:29:50 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_f9d31c41df95f6e0e7687a855d8e0225.png (大小: 1434499 字节)

2025-09-28 20:29:50 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 734 (attempt 1/2)
2025-09-28 20:29:50 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=139

2025-09-28 20:29:50 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759062590008_517.png
2025-09-28 20:29:50 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759062590008_517.png

2025-09-28 20:29:50 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759062590008_517.png

2025-09-28 20:29:50 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_f9d31c41df95f6e0e7687a855d8e0225.webp 大小 73096 字节 (原始 1434499 字节, 压缩比 0.05)

2025-09-28 20:29:50 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_f9d31c41df95f6e0e7687a855d8e0225.png

2025-09-28 20:29:50 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f9d31c41df95f6e0e7687a855d8e0225.webp

2025-09-28 20:29:50 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f9d31c41df95f6e0e7687a855d8e0225.webp

2025-09-28 20:29:50 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_f9d31c41df95f6e0e7687a855d8e0225.webp

2025-09-28 20:29:50 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_f9d31c41df95f6e0e7687a855d8e0225.webp
2025-09-28 20:29:50 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:29:50 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=73 | choice="将玉佩投入江心，引动水下异象，借潮汐之力强行破阵" | text_len=231 | text="火把在江面点燃，赤焰如龙腾跃，映得水波翻滚如血。刘备将火把掷入水中，火光顺着浮木顺流而下，远处敌营瞬间警铃大作，旌旗乱舞。他低声下令：‘点起十支火把，分三路引燃，声势要足！’船队悄然潜入暗流，铁甲轻响，如同游鱼穿行于夜雾之中。江底传来沉闷轰鸣，仿佛有千军万马在水下奔袭。突然，前方水道中浮出一具披甲尸首，手持锈迹斑斑的铜戟，双眼空洞地望向天际——那是当年长坂坡战死的旧部？还是冥河守门人？更令人惊心的是，玉佩在胸前微微发烫，竟与那尸首手中铜戟共鸣，泛起幽蓝微光。"
2025-09-28 20:29:50 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=73 | choice="将玉佩投入江心，引动水下异象，借潮汐之力强行破阵" | node=76 | text_len=231 | image=http://127.0.0.1:8000/static/generated/ai_gen_f9d31c41df95f6e0e7687a855d8e0225.webp
2025-09-28 20:29:52 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.png (大小: 1578200 字节)

2025-09-28 20:29:52 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.webp 大小 70998 字节 (原始 1578200 字节, 压缩比 0.04)

2025-09-28 20:29:52 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.png

2025-09-28 20:29:52 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.webp

2025-09-28 20:29:52 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.webp

2025-09-28 20:29:52 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.webp

2025-09-28 20:29:52 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.webp
2025-09-28 20:29:52 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:29:52 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=73 | choice="点燃火把，高举玉佩于船头，向对岸发出桃园结义的旧日信号" | text_len=246 | text="火把在江雾中腾起赤焰，如龙蛇般蜿蜒于水道两岸。刘备将火把掷入水中，火焰顺着浮木蔓延，映得江面如血。敌军哨塔上惊鸣骤起，弓弩手纷纷转向火光源头，疑为大军压境。就在此时，他悄然解开船缆，令小舟顺流而下，隐入暗影深处。江底传来沉闷的震动，仿佛有千军万马在水底踏步前行——那玉佩所唤起的异象，竟与这夜色共震。前方水道尽头，一道铁索横江，锁链锈迹斑斑，却仍牢牢钉住渡口。若强行破锁，必惊动守军；若绕行，则需穿越幽深水洞，内藏未知险境。更令人不安的是，江心深处传来低语般的战鼓声，似有人在呼唤‘三弟’……"
2025-09-28 20:29:52 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=73 | choice="点燃火把，高举玉佩于船头，向对岸发出桃园结义的旧日信号" | node=77 | text_len=246 | image=http://127.0.0.1:8000/static/generated/ai_gen_ee69c0057f4ecaf4f21dc341bd7cda73.webp
2025-09-28 20:45:17 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:309 - PrepareStart start wish=关羽
2025-09-28 20:45:17 | DEBUG    | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:311 - prepare context building
2025-09-28 20:45:17 | DEBUG    | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=9
2025-09-28 20:45:17 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=473
2025-09-28 20:45:18 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:45:18 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 894
2025-09-28 20:45:18 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:322 - prepare LLM done raw_len=221
2025-09-28 20:45:18 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 20:45:18 | DEBUG    | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:361 - prepare data parsed title=重返赤壁，改写历史 quest=阻止周瑜密令，改变赤壁火攻计划
2025-09-28 20:45:18 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 20:45:18 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 20:45:18 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start
2025-09-28 20:45:18 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-28 20:45:22 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:45:22 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1380
2025-09-28 20:45:22 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=862 预览='{"text": "寒风卷起战旗残片，关羽立于古城墙头，目光如炬凝视着远方烽火连天的平原。敌军已逼近城门，守将却闭门不出，只道‘天命难违’。他紧握青龙偃月刀，刀锋映着血色残阳，心中翻涌：若历史注定败亡，那便由我亲手改写这一页。远处传来马蹄声碎，一骑疾驰而来，竟是刘备旧部密使，手中紧攥一封染血书信——‘若不破局，荆州将倾于一夜之间’。他咬牙，决意不再等待天命，而是以人定胜天之志，撕裂既定命运的丝线。", "choices": [{"option": "单骑冲阵，直闯敌营质问主帅，以义气逼其退兵", "summary": "以忠义为刃，挑战敌方高层的意志", "effects": {"delta_'
2025-09-28 20:45:22 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=862 预览='{"text": "寒风卷起战旗残片，关羽立于古城墙头，目光如炬凝视着远方烽火连天的平原。敌军已逼近城门，守将却闭门不出，只道‘天命难违’。他紧握青龙偃月刀，刀锋映着血色残阳，心中翻涌：若历史注定败亡，那便由我亲手改写这一页。远处传来马蹄声碎，一骑疾驰而来，竟是刘备旧部密使，手中紧攥一封染血书信——‘若不破局，荆州将倾'
2025-09-28 20:45:22 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=862 预览='{"text": "寒风卷起战旗残片，关羽立于古城墙头，目光如炬凝视着远方烽火连天的平原。敌军已逼近城门，守将却闭门不出，只道‘天命难违’。他紧握青龙偃月刀，刀锋映着血色残阳，心中翻涌：若历史注定败亡，那便由我亲手改写这一页。远处传来马蹄声碎，一骑疾驰而来，竟是刘备旧部密使，手中紧攥一封染血书信——‘若不破局，荆州将倾'
2025-09-28 20:45:22 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=190
2025-09-28 20:45:22 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=190 preview="寒风卷起战旗残片，关羽立于古城墙头，目光如炬凝视着远方烽火连天的平原。敌军已逼近城门，守将却闭门不出，只道‘天命难违’。他紧握青龙偃月刀，刀锋映着血色残阳，心中翻涌：若历史注定败亡，那便由我亲手改写这一页。远处传来马蹄声碎，一骑疾驰而来，竟是刘备旧部密使，手中紧攥一封染血书信——‘若不破局，荆州将倾于一夜之间’。他咬牙，决意不再等待天命，而是以人定胜天之志，撕裂既定命运的丝线。"

2025-09-28 20:45:22 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗残片，关羽立于古城墙头，目光如炬凝视着远方烽火连天的平原。敌军已逼近城门，守将却闭门不出，只道‘天命难违’。他紧握青龙偃月刀，刀锋映…"

2025-09-28 20:45:22 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗残片，关羽立...
2025-09-28 20:45:33 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 20:45:33 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 20:45:33 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759063533442_331.png
2025-09-28 20:45:33 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759063533442_331.png

2025-09-28 20:45:33 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759063533442_331.png

2025-09-28 20:45:42 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_3126bea2684e5639ff229c4a56561752.png (大小: 1452065 字节)

2025-09-28 20:45:42 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_3126bea2684e5639ff229c4a56561752.webp 大小 82944 字节 (原始 1452065 字节, 压缩比 0.06)

2025-09-28 20:45:42 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_3126bea2684e5639ff229c4a56561752.png

2025-09-28 20:45:42 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_3126bea2684e5639ff229c4a56561752.webp

2025-09-28 20:45:42 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3126bea2684e5639ff229c4a56561752.webp

2025-09-28 20:45:42 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_3126bea2684e5639ff229c4a56561752.webp

2025-09-28 20:45:42 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_3126bea2684e5639ff229c4a56561752.webp
2025-09-28 20:45:42 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=190
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:118 - pregeneration session created
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=78 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:123 - pregeneration node created
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=78 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:126 - pregeneration node imageimage=http://127.0.0.1:8000/static/generated/ai_gen_3126bea2684e5639ff229c4a56561752.webp
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=78 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:135 - pregeneration cache stored
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=78 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:140 - pregeneration speculation enqueueddepth=0
2025-09-28 20:45:42 | INFO     | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=78 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:142 - pregeneration done
2025-09-28 20:45:42 | DEBUG    | trace=7487708e user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=78 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed
2025-09-28 20:46:01 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 20:46:02 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 20:46:03 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 20:46:03 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 20:46:03 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 20:46:03 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:46:03 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 20:46:03 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:03 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:03 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 20:46:03 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 20:46:03 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 20:46:03 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 20:46:03 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 20:46:03 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 20:46:03 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 20:46:03 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 20:46:03 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 20:46:03 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 20:46:03 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 20:46:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:04 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 20:46:04 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 20:46:04 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 20:46:04 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 20:46:04 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:46:34 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 20:46:35 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 20:46:36 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 20:46:36 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 20:46:36 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 20:46:36 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:46:36 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 20:46:36 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:36 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:36 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 20:46:36 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 20:46:36 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 20:46:36 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 20:46:36 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 20:46:36 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 20:46:36 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 20:46:36 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 20:46:36 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 20:46:36 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 20:46:36 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 20:46:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:37 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 1.
2025-09-28 20:46:37 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 20:46:37 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 20:46:37 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 20:46:37 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:46:51 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 20:46:52 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 20:46:53 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 20:46:53 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 20:46:53 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 20:46:53 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:46:53 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 20:46:53 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:53 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:53 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 20:46:53 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 20:46:53 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 20:46:53 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 20:46:53 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 20:46:53 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 20:46:53 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 20:46:53 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 20:46:53 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 20:46:53 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 20:46:53 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 20:46:54 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:46:54 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 1.
2025-09-28 20:46:54 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 20:46:54 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 20:46:54 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 20:46:54 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:47:40 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 20:47:41 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 20:47:42 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 20:47:42 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 20:47:42 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 20:47:42 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:47:42 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 20:47:42 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:47:42 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:47:42 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 20:47:42 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 20:47:42 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 20:47:42 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 20:47:42 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 20:47:42 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 20:47:42 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 20:47:42 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 20:47:42 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 20:47:42 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 20:47:42 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 20:47:43 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:47:43 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 1.
2025-09-28 20:47:43 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 20:47:43 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 20:47:43 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 20:47:43 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:47:53 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 20:47:55 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-28 20:49:02 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-28 20:49:59 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-28 20:50:11 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:50:13 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 20:50:13 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 20:50:13 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 20:50:13 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 20:50:13 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:50:13 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 20:50:13 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:50:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:50:14 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 20:50:14 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 20:50:14 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 20:50:14 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 20:50:14 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 20:50:14 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 20:50:14 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 20:50:14 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 20:50:14 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 20:50:14 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 20:50:14 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 20:50:14 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 20:50:14 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 20:50:14 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 20:50:14 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 20:50:14 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 20:50:14 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 20:50:37 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:309 - PrepareStart start wish=关羽
2025-09-28 20:50:37 | DEBUG    | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:311 - prepare context building
2025-09-28 20:50:37 | DEBUG    | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=9
2025-09-28 20:50:37 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=473
2025-09-28 20:50:39 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:50:39 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 875
2025-09-28 20:50:39 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:322 - prepare LLM done raw_len=211
2025-09-28 20:50:39 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 20:50:39 | DEBUG    | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:361 - prepare data parsed title=重返赤壁：关羽的抉择 quest=阻止周瑜借箭计，改变赤壁战局走向
2025-09-28 20:50:39 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 20:50:39 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=关羽 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 20:50:39 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start
2025-09-28 20:50:39 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '关羽'
2025-09-28 20:50:42 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:50:42 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1311
2025-09-28 20:50:42 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=792 预览='{"text": "夜色如墨，寒风卷起残旗，关羽立于城楼之下，青龙偃月刀横在膝上。远处火光摇曳，敌军巡哨的脚步声渐近。他凝视着那道紧闭的西门——传说中藏有破局密钥的暗室入口。守卫换班前的一瞬，是唯一可乘之机。他深吸一口气，披风猎猎，目光如炬，仿佛已听见历史齿轮转动的低鸣。若此刻不决，明日便是万劫不复。", "choices": [{"option": "猛然跃上墙头，以刀尖点地借力翻入内院，引燃火把制造混乱", "summary": "以猛攻破局，瞬间扰乱敌军部署", "effects": {"delta_progress": 12, "delta_risk": 8, "delta_expos'
2025-09-28 20:50:42 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=792 预览='{"text": "夜色如墨，寒风卷起残旗，关羽立于城楼之下，青龙偃月刀横在膝上。远处火光摇曳，敌军巡哨的脚步声渐近。他凝视着那道紧闭的西门——传说中藏有破局密钥的暗室入口。守卫换班前的一瞬，是唯一可乘之机。他深吸一口气，披风猎猎，目光如炬，仿佛已听见历史齿轮转动的低鸣。若此刻不决，明日便是万劫不复。", "choic'
2025-09-28 20:50:42 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=792 预览='{"text": "夜色如墨，寒风卷起残旗，关羽立于城楼之下，青龙偃月刀横在膝上。远处火光摇曳，敌军巡哨的脚步声渐近。他凝视着那道紧闭的西门——传说中藏有破局密钥的暗室入口。守卫换班前的一瞬，是唯一可乘之机。他深吸一口气，披风猎猎，目光如炬，仿佛已听见历史齿轮转动的低鸣。若此刻不决，明日便是万劫不复。", "choic'
2025-09-28 20:50:42 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=141
2025-09-28 20:50:42 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=141 preview="夜色如墨，寒风卷起残旗，关羽立于城楼之下，青龙偃月刀横在膝上。远处火光摇曳，敌军巡哨的脚步声渐近。他凝视着那道紧闭的西门——传说中藏有破局密钥的暗室入口。守卫换班前的一瞬，是唯一可乘之机。他深吸一口气，披风猎猎，目光如炬，仿佛已听见历史齿轮转动的低鸣。若此刻不决，明日便是万劫不复。"

2025-09-28 20:50:42 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-28 20:50:42 | INFO     | core.image_storage:__init__:34 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images

2025-09-28 20:50:42 | INFO     | core.image_storage:__init__:35 - 图像web访问前缀: http://127.0.0.1:8000/static/generated

2025-09-28 20:50:42 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，寒风卷起残旗，关羽立于城楼之下，青龙偃月刀横在膝上。远处火光摇曳，敌军巡哨的脚步声渐近。他凝视着那道紧闭的西门——传说中藏有破局密钥的…"

2025-09-28 20:50:42 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，寒风卷起残旗，...
2025-09-28 20:50:54 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 730 (attempt 1/2)
2025-09-28 20:50:54 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=96

2025-09-28 20:50:54 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759063853823_961.png
2025-09-28 20:50:54 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759063853823_961.png

2025-09-28 20:50:54 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759063853823_961.png

2025-09-28 20:50:56 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_3412dbc5c616ebfff577da72572c85cf.png (大小: 1262300 字节)

2025-09-28 20:50:56 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_3412dbc5c616ebfff577da72572c85cf.webp 大小 52444 字节 (原始 1262300 字节, 压缩比 0.04)

2025-09-28 20:50:56 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_3412dbc5c616ebfff577da72572c85cf.png

2025-09-28 20:50:56 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp

2025-09-28 20:50:56 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3412dbc5c616ebfff577da72572c85cf.webp

2025-09-28 20:50:56 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp

2025-09-28 20:50:56 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:50:56 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=141
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:118 - pregeneration session created
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:123 - pregeneration node created
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:126 - pregeneration node imageimage=http://127.0.0.1:8000/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:135 - pregeneration cache stored
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:140 - pregeneration speculation enqueueddepth=0
2025-09-28 20:50:56 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:142 - pregeneration done
2025-09-28 20:50:56 | DEBUG    | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=pregeneration wish=关羽 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed
2025-09-28 20:51:30 | INFO     | trace=5e944722 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=关羽 | api.story:start_new_story:432 - start request wish=关羽
2025-09-28 20:51:30 | DEBUG    | trace=5e944722 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=关羽 | api.story:start_new_story:435 - start wish validated
2025-09-28 20:51:30 | DEBUG    | trace=5e944722 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=关羽 | api.story:start_new_story:439 - start cache keycache_key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:4b97cac39000f1c8f17e9e863b20d3a2b8d619ddc6613d6f623dcaac77162ef3
2025-09-28 20:51:30 | DEBUG    | api.story:_cache_pop:92 - [预生成] 从缓存中取出 key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:4b97cac39000f1c8f17e9e863b20d3a2b8d619ddc6613d6f623dcaac77162ef3
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=关羽 | api.story:start_new_story:455 - start trace resumed
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=关羽 | api.story:start_new_story:456 - start cache first hithit=True
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=start wish=关羽 | api.story:start_new_story:473 - start use pregenerated
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=start wish=关羽 | api.story:start_new_story:494 - start use cached nodesession_id=14 node_id=79
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=start wish=关羽 | api.story:start_new_story:554 - start donetext_len=141 choice_count=3 image=http://127.0.0.1:8000/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=start wish=关羽 | api.story:start_new_story:561 - start image filefile_exists=True size=52444 path=C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=start wish=关羽 | api.story:start_new_story:564 - start speculation enqueuedepth=1
2025-09-28 20:51:30 | DEBUG    | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=14 node=79 depth=1
2025-09-28 20:51:30 | INFO     | trace=84cd18ca user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=14 node=79 task=start wish=关羽 | api.story:start_new_story:567 - start response readyimage=http://127.0.0.1:8000/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:51:30 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3412dbc5c616ebfff577da72572c85cf.webp exists=True size=52444
2025-09-28 20:51:30 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:51:30 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=79
2025-09-28 20:51:30 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=79 | choice="猛然跃上墙头，以刀尖点地借力翻入内院，引燃火把制造混乱"
2025-09-28 20:51:30 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=79 | choice="取出随身玉佩，低声吟诵一段古谣，试图唤醒守将旧日记忆"
2025-09-28 20:51:30 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 猛然跃上墙头，以刀尖点地借力翻入内院，引燃火把制造混乱
2025-09-28 20:51:30 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=79 | choice="悄然退至水渠旁，潜入暗流，从地下通道悄然逼近密室入口"
2025-09-28 20:51:30 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 取出随身玉佩，低声吟诵一段古谣，试图唤醒守将旧日记忆
2025-09-28 20:51:30 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 悄然退至水渠旁，潜入暗流，从地下通道悄然逼近密室入口
2025-09-28 20:51:30 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 20:51:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:51:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1471
2025-09-28 20:51:33 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=814 预览='{"text": "风卷残雪，西门铁链轻响。关羽缓缓起身，刀尖轻点地面，发出低鸣。他凝视着那道被火把映得斑驳的暗室门缝——门后是传说中能改写战局的密钥，但守卫换班的间隙仅剩三息。他猛然摘下头盔，将青丝束于脑后，披风一扬，竟朝哨塔方向大步走去，衣袂翻飞如战旗猎猎。敌兵惊疑抬头，却见他高声喝道：‘奉命巡查，速开城门！’声如洪钟，震落檐角积雪。这一步，是赌命的假面，亦是破局的雷霆之始。", "choices": [{"option": "高声呼喝冒充督军，借威势逼开守卫", "summary": "以气势压人，制造混乱突破口", "effects": {"delta_progress": 12, "'
2025-09-28 20:51:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=814 预览='{"text": "风卷残雪，西门铁链轻响。关羽缓缓起身，刀尖轻点地面，发出低鸣。他凝视着那道被火把映得斑驳的暗室门缝——门后是传说中能改写战局的密钥，但守卫换班的间隙仅剩三息。他猛然摘下头盔，将青丝束于脑后，披风一扬，竟朝哨塔方向大步走去，衣袂翻飞如战旗猎猎。敌兵惊疑抬头，却见他高声喝道：‘奉命巡查，速开城门！’声如'
2025-09-28 20:51:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=814 预览='{"text": "风卷残雪，西门铁链轻响。关羽缓缓起身，刀尖轻点地面，发出低鸣。他凝视着那道被火把映得斑驳的暗室门缝——门后是传说中能改写战局的密钥，但守卫换班的间隙仅剩三息。他猛然摘下头盔，将青丝束于脑后，披风一扬，竟朝哨塔方向大步走去，衣袂翻飞如战旗猎猎。敌兵惊疑抬头，却见他高声喝道：‘奉命巡查，速开城门！’声如'
2025-09-28 20:51:33 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=181
2025-09-28 20:51:33 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=181 preview="风卷残雪，西门铁链轻响。关羽缓缓起身，刀尖轻点地面，发出低鸣。他凝视着那道被火把映得斑驳的暗室门缝——门后是传说中能改写战局的密钥，但守卫换班的间隙仅剩三息。他猛然摘下头盔，将青丝束于脑后，披风一扬，竟朝哨塔方向大步走去，衣袂翻飞如战旗猎猎。敌兵惊疑抬头，却见他高声喝道：‘奉命巡查，速开城门！’声如洪钟，震落檐角积雪。这一步，是赌命的假面，亦是破局的雷霆之始。"

2025-09-28 20:51:33 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残雪，西门铁链轻响。关羽缓缓起身，刀尖轻点地面，发出低鸣。他凝视着那道被火把映得斑驳的暗室门缝——门后是传说中能改写战局的密钥，但守卫换班的…"

2025-09-28 20:51:33 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残雪，西门铁链轻响。...
2025-09-28 20:51:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:51:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1449
2025-09-28 20:51:33 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=788 预览='{"text": "风卷残雪，西门石缝间渗出幽蓝寒气。关羽轻抚刀背，耳畔忽闻铜壶滴漏声——换班之刻将至。他凝神于门轴暗纹，指尖划过一道旧日刻痕，似有血书残迹隐现。远处马蹄踏碎冰层，一队巡哨正向城楼逼近。若不趁此瞬息破局，密室将永锁于历史尘埃。他猛然闭目，仿佛听见赤兔嘶鸣穿越时空，回应那未竟的忠义之誓。", "choices": [{"option": "以古琴曲《广陵散》引动守卫心弦，借其失神时夺钥", "summary": "以音律攻心，巧取时机", "effects": {"delta_progress": 12, "delta_risk": 6, "delta_exposure": 4,'
2025-09-28 20:51:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=788 预览='{"text": "风卷残雪，西门石缝间渗出幽蓝寒气。关羽轻抚刀背，耳畔忽闻铜壶滴漏声——换班之刻将至。他凝神于门轴暗纹，指尖划过一道旧日刻痕，似有血书残迹隐现。远处马蹄踏碎冰层，一队巡哨正向城楼逼近。若不趁此瞬息破局，密室将永锁于历史尘埃。他猛然闭目，仿佛听见赤兔嘶鸣穿越时空，回应那未竟的忠义之誓。", "choic'
2025-09-28 20:51:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=788 预览='{"text": "风卷残雪，西门石缝间渗出幽蓝寒气。关羽轻抚刀背，耳畔忽闻铜壶滴漏声——换班之刻将至。他凝神于门轴暗纹，指尖划过一道旧日刻痕，似有血书残迹隐现。远处马蹄踏碎冰层，一队巡哨正向城楼逼近。若不趁此瞬息破局，密室将永锁于历史尘埃。他猛然闭目，仿佛听见赤兔嘶鸣穿越时空，回应那未竟的忠义之誓。", "choic'
2025-09-28 20:51:33 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=141
2025-09-28 20:51:33 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=141 preview="风卷残雪，西门石缝间渗出幽蓝寒气。关羽轻抚刀背，耳畔忽闻铜壶滴漏声——换班之刻将至。他凝神于门轴暗纹，指尖划过一道旧日刻痕，似有血书残迹隐现。远处马蹄踏碎冰层，一队巡哨正向城楼逼近。若不趁此瞬息破局，密室将永锁于历史尘埃。他猛然闭目，仿佛听见赤兔嘶鸣穿越时空，回应那未竟的忠义之誓。"

2025-09-28 20:51:33 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残雪，西门石缝间渗出幽蓝寒气。关羽轻抚刀背，耳畔忽闻铜壶滴漏声——换班之刻将至。他凝神于门轴暗纹，指尖划过一道旧日刻痕，似有血书残迹隐现。远…"

2025-09-28 20:51:33 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残雪，西门石缝间渗出...
2025-09-28 20:51:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 20:51:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1471
2025-09-28 20:51:33 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=816 预览='{"text": "风卷残雪，西门铁链轻响。关羽凝视着那道被夜色吞没的暗室石门，门缝间透出一丝幽蓝微光——似非人间之火。守卫换班的钟声将至，三息之后，巡逻队将从南侧绕行。他右手轻抚刀柄，左掌悄然按在冰冷石壁上，仿佛能听见地底传来古老机关的低语。若此刻不动，明日便是千军万马踏破城门；若贸然闯入，恐陷于死局。他闭目片刻，再睁眼时，眼中已无犹豫，唯余决意如刀锋割裂长夜。", "choices": [{"option": "以青龙偃月刀轻敲石壁三下，模仿守卫暗号，试探门后反应", "summary": "以音律破谜，借敌之律测虚实", "effects": {"delta_progress": 12,'
2025-09-28 20:51:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=816 预览='{"text": "风卷残雪，西门铁链轻响。关羽凝视着那道被夜色吞没的暗室石门，门缝间透出一丝幽蓝微光——似非人间之火。守卫换班的钟声将至，三息之后，巡逻队将从南侧绕行。他右手轻抚刀柄，左掌悄然按在冰冷石壁上，仿佛能听见地底传来古老机关的低语。若此刻不动，明日便是千军万马踏破城门；若贸然闯入，恐陷于死局。他闭目片刻，再'
2025-09-28 20:51:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=816 预览='{"text": "风卷残雪，西门铁链轻响。关羽凝视着那道被夜色吞没的暗室石门，门缝间透出一丝幽蓝微光——似非人间之火。守卫换班的钟声将至，三息之后，巡逻队将从南侧绕行。他右手轻抚刀柄，左掌悄然按在冰冷石壁上，仿佛能听见地底传来古老机关的低语。若此刻不动，明日便是千军万马踏破城门；若贸然闯入，恐陷于死局。他闭目片刻，再'
2025-09-28 20:51:33 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=173
2025-09-28 20:51:33 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=173 preview="风卷残雪，西门铁链轻响。关羽凝视着那道被夜色吞没的暗室石门，门缝间透出一丝幽蓝微光——似非人间之火。守卫换班的钟声将至，三息之后，巡逻队将从南侧绕行。他右手轻抚刀柄，左掌悄然按在冰冷石壁上，仿佛能听见地底传来古老机关的低语。若此刻不动，明日便是千军万马踏破城门；若贸然闯入，恐陷于死局。他闭目片刻，再睁眼时，眼中已无犹豫，唯余决意如刀锋割裂长夜。"

2025-09-28 20:51:33 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残雪，西门铁链轻响。关羽凝视着那道被夜色吞没的暗室石门，门缝间透出一丝幽蓝微光——似非人间之火。守卫换班的钟声将至，三息之后，巡逻队将从南侧…"

2025-09-28 20:51:33 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 风卷残雪，西门铁链轻响。...
2025-09-28 20:51:45 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 749 (attempt 1/2)
2025-09-28 20:51:45 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=115

2025-09-28 20:51:45 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759063905191_092.png
2025-09-28 20:51:45 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759063905191_092.png

2025-09-28 20:51:45 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759063905191_092.png

2025-09-28 20:51:45 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 769 (attempt 1/2)
2025-09-28 20:51:45 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=133

2025-09-28 20:51:45 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759063905506_525.png
2025-09-28 20:51:45 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759063905506_525.png

2025-09-28 20:51:45 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759063905506_525.png

2025-09-28 20:51:47 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_41ce0a10fa184386e7586df61cdc5bbc.png (大小: 1680585 字节)

2025-09-28 20:51:48 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.png (大小: 1565109 字节)

2025-09-28 20:51:48 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_41ce0a10fa184386e7586df61cdc5bbc.webp 大小 120212 字节 (原始 1680585 字节, 压缩比 0.07)

2025-09-28 20:51:48 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_41ce0a10fa184386e7586df61cdc5bbc.png

2025-09-28 20:51:48 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_41ce0a10fa184386e7586df61cdc5bbc.webp

2025-09-28 20:51:48 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_41ce0a10fa184386e7586df61cdc5bbc.webp

2025-09-28 20:51:48 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_41ce0a10fa184386e7586df61cdc5bbc.webp

2025-09-28 20:51:48 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_41ce0a10fa184386e7586df61cdc5bbc.webp
2025-09-28 20:51:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:51:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=79 | choice="取出随身玉佩，低声吟诵一段古谣，试图唤醒守将旧日记忆" | text_len=141 | text="风卷残雪，西门石缝间渗出幽蓝寒气。关羽轻抚刀背，耳畔忽闻铜壶滴漏声——换班之刻将至。他凝神于门轴暗纹，指尖划过一道旧日刻痕，似有血书残迹隐现。远处马蹄踏碎冰层，一队巡哨正向城楼逼近。若不趁此瞬息破局，密室将永锁于历史尘埃。他猛然闭目，仿佛听见赤兔嘶鸣穿越时空，回应那未竟的忠义之誓。"
2025-09-28 20:51:48 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=79 | choice="取出随身玉佩，低声吟诵一段古谣，试图唤醒守将旧日记忆" | node=80 | text_len=141 | image=http://127.0.0.1:8000/static/generated/ai_gen_41ce0a10fa184386e7586df61cdc5bbc.webp
2025-09-28 20:51:48 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.webp 大小 91070 字节 (原始 1565109 字节, 压缩比 0.06)

2025-09-28 20:51:48 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.png

2025-09-28 20:51:48 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.webp

2025-09-28 20:51:48 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.webp

2025-09-28 20:51:48 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.webp

2025-09-28 20:51:48 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.webp
2025-09-28 20:51:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:51:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=79 | choice="悄然退至水渠旁，潜入暗流，从地下通道悄然逼近密室入口" | text_len=181 | text="风卷残雪，西门铁链轻响。关羽缓缓起身，刀尖轻点地面，发出低鸣。他凝视着那道被火把映得斑驳的暗室门缝——门后是传说中能改写战局的密钥，但守卫换班的间隙仅剩三息。他猛然摘下头盔，将青丝束于脑后，披风一扬，竟朝哨塔方向大步走去，衣袂翻飞如战旗猎猎。敌兵惊疑抬头，却见他高声喝道：‘奉命巡查，速开城门！’声如洪钟，震落檐角积雪。这一步，是赌命的假面，亦是破局的雷霆之始。"
2025-09-28 20:51:48 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=79 | choice="悄然退至水渠旁，潜入暗流，从地下通道悄然逼近密室入口" | node=81 | text_len=181 | image=http://127.0.0.1:8000/static/generated/ai_gen_15ee7b67aa379faa57e2ab65aa1f9fa3.webp
2025-09-28 20:51:51 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 700 (attempt 1/2)
2025-09-28 20:51:51 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=106

2025-09-28 20:51:51 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759063909982_156.png
2025-09-28 20:51:51 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759063909982_156.png

2025-09-28 20:51:51 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759063909982_156.png

2025-09-28 20:51:55 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_55952c96e0c103615b8d42bd7977490e.png (大小: 1689231 字节)

2025-09-28 20:51:55 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_55952c96e0c103615b8d42bd7977490e.webp 大小 86820 字节 (原始 1689231 字节, 压缩比 0.05)

2025-09-28 20:51:55 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_55952c96e0c103615b8d42bd7977490e.png

2025-09-28 20:51:55 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_55952c96e0c103615b8d42bd7977490e.webp

2025-09-28 20:51:55 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_55952c96e0c103615b8d42bd7977490e.webp

2025-09-28 20:51:55 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_55952c96e0c103615b8d42bd7977490e.webp

2025-09-28 20:51:55 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_55952c96e0c103615b8d42bd7977490e.webp
2025-09-28 20:51:55 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 20:51:55 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=79 | choice="猛然跃上墙头，以刀尖点地借力翻入内院，引燃火把制造混乱" | text_len=173 | text="风卷残雪，西门铁链轻响。关羽凝视着那道被夜色吞没的暗室石门，门缝间透出一丝幽蓝微光——似非人间之火。守卫换班的钟声将至，三息之后，巡逻队将从南侧绕行。他右手轻抚刀柄，左掌悄然按在冰冷石壁上，仿佛能听见地底传来古老机关的低语。若此刻不动，明日便是千军万马踏破城门；若贸然闯入，恐陷于死局。他闭目片刻，再睁眼时，眼中已无犹豫，唯余决意如刀锋割裂长夜。"
2025-09-28 20:51:55 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=79 | choice="猛然跃上墙头，以刀尖点地借力翻入内院，引燃火把制造混乱" | node=82 | text_len=173 | image=http://127.0.0.1:8000/static/generated/ai_gen_55952c96e0c103615b8d42bd7977490e.webp
2025-09-28 21:03:01 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:03:02 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:03:04 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:03:04 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:03:04 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:03:04 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:03:04 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:03:04 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:03:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:03:04 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:03:04 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:03:04 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:03:04 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:03:04 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:03:04 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:03:04 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:03:04 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:03:04 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:03:04 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:03:04 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:03:04 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:03:05 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 4294967295.
2025-09-28 21:03:05 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:03:05 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:03:05 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:03:05 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:03:05 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:03:06 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:03:07 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:03:07 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:03:07 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:03:07 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:03:07 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:03:07 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:03:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:03:07 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:03:07 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:03:07 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:03:07 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:03:07 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:03:07 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:03:07 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:03:07 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:03:07 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:03:07 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:03:07 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:03:07 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:03:08 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 4294967295.
2025-09-28 21:03:08 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:03:08 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:03:08 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:03:08 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:04:19 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:04:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-28 21:05:29 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-28 21:05:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:13:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass!@127.0.0.1:5432/rebirth
2025-09-28 21:13:24 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:13:25 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:13:26 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:13:26 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:13:26 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:13:26 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:13:26 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:13:26 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:13:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:13:26 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:13:26 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:13:26 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:13:26 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:13:26 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:13:26 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:13:26 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:13:26 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:13:26 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:13:26 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:13:26 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:13:26 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:13:26 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:13:26 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:13:26 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:13:26 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:13:26 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:13:45 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:309 - PrepareStart start wish=项羽
2025-09-28 21:13:45 | DEBUG    | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:311 - prepare context building
2025-09-28 21:13:45 | DEBUG    | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=10
2025-09-28 21:13:45 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=513
2025-09-28 21:13:47 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:13:47 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 916
2025-09-28 21:13:47 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:322 - prepare LLM done raw_len=193
2025-09-28 21:13:47 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 21:13:47 | DEBUG    | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:361 - prepare data parsed title=重掌西楚 quest=在三日内召集诸侯，确立西楚霸主地位
2025-09-28 21:13:47 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 21:13:47 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 21:13:47 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start
2025-09-28 21:13:47 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-28 21:13:51 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:13:51 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1483
2025-09-28 21:13:51 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=915 预览='{"text": "夜色如墨，楚营外的篝火在风中摇曳，仿佛无数未熄的战魂低语。项羽立于高台，铠甲染霜，目光穿透重重雾霭，直视那座被刘邦军围困的孤城。斥候来报：城中粮草将尽，守将已遣密使求援。他缓缓拔出腰间青铜剑，剑锋映着残月，寒光如冰。‘若救之，则损我兵势；若弃之，则失人心。’他低声自语，指尖划过剑刃，血珠滴落尘土，似为抉择祭奠。远处传来马蹄轻响，一骑疾驰而来，信使跪地呈上一封密函——竟是韩信亲笔，言其欲借道楚境，共击刘邦。项羽瞳孔微缩，一股杀意与野心在胸中翻腾，却也夹杂一丝迟疑。这一步，是破局良机，还是又一场鸿门宴？", "choices": [{"option": "命人暗中接应韩信部，借'
2025-09-28 21:13:51 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=915 预览='{"text": "夜色如墨，楚营外的篝火在风中摇曳，仿佛无数未熄的战魂低语。项羽立于高台，铠甲染霜，目光穿透重重雾霭，直视那座被刘邦军围困的孤城。斥候来报：城中粮草将尽，守将已遣密使求援。他缓缓拔出腰间青铜剑，剑锋映着残月，寒光如冰。‘若救之，则损我兵势；若弃之，则失人心。’他低声自语，指尖划过剑刃，血珠滴落尘土，似'
2025-09-28 21:13:51 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=915 预览='{"text": "夜色如墨，楚营外的篝火在风中摇曳，仿佛无数未熄的战魂低语。项羽立于高台，铠甲染霜，目光穿透重重雾霭，直视那座被刘邦军围困的孤城。斥候来报：城中粮草将尽，守将已遣密使求援。他缓缓拔出腰间青铜剑，剑锋映着残月，寒光如冰。‘若救之，则损我兵势；若弃之，则失人心。’他低声自语，指尖划过剑刃，血珠滴落尘土，似'
2025-09-28 21:13:51 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=252
2025-09-28 21:13:51 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=252 preview="夜色如墨，楚营外的篝火在风中摇曳，仿佛无数未熄的战魂低语。项羽立于高台，铠甲染霜，目光穿透重重雾霭，直视那座被刘邦军围困的孤城。斥候来报：城中粮草将尽，守将已遣密使求援。他缓缓拔出腰间青铜剑，剑锋映着残月，寒光如冰。‘若救之，则损我兵势；若弃之，则失人心。’他低声自语，指尖划过剑刃，血珠滴落尘土，似为抉择祭奠。远处传来马蹄轻响，一骑疾驰而来，信使跪地呈上一封密函——竟是韩信亲笔，言其欲借道楚境，共…"

2025-09-28 21:13:51 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-28 21:13:51 | INFO     | core.image_storage:__init__:34 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images

2025-09-28 21:13:51 | INFO     | core.image_storage:__init__:35 - 图像web访问前缀: http://127.0.0.1:8000/static/generated

2025-09-28 21:13:51 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，楚营外的篝火在风中摇曳，仿佛无数未熄的战魂低语。项羽立于高台，铠甲染霜，目光穿透重重雾霭，直视那座被刘邦军围困的孤城。斥候来报：城中粮…"

2025-09-28 21:13:51 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，楚营外的篝火在...
2025-09-28 21:14:10 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:14:10 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:14:10 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759065249787_988.png
2025-09-28 21:14:10 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759065249787_988.png

2025-09-28 21:14:10 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759065249787_988.png

2025-09-28 21:14:11 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_cb127f0c09eab2715d1dca033bdce771.png (大小: 926574 字节)

2025-09-28 21:14:11 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_cb127f0c09eab2715d1dca033bdce771.webp 大小 48780 字节 (原始 926574 字节, 压缩比 0.05)

2025-09-28 21:14:11 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_cb127f0c09eab2715d1dca033bdce771.png

2025-09-28 21:14:11 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_cb127f0c09eab2715d1dca033bdce771.webp

2025-09-28 21:14:11 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_cb127f0c09eab2715d1dca033bdce771.webp

2025-09-28 21:14:11 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_cb127f0c09eab2715d1dca033bdce771.webp

2025-09-28 21:14:11 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_cb127f0c09eab2715d1dca033bdce771.webp
2025-09-28 21:14:11 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 21:14:11 | INFO     | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=252
2025-09-28 21:14:11 | ERROR    | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:145 - pregeneration failederror=(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_game_sessions_user_wish"
DETAIL:  Key (user_id, wish)=(ff258ee1-869b-40f7-aae7-d9e1c48ecdf1, 项羽) already exists.

[SQL: INSERT INTO game_sessions (user_id, wish) VALUES (%(user_id)s::UUID, %(wish)s) RETURNING game_sessions.id, game_sessions.created_at]
[parameters: {'user_id': 'ff258ee1-869b-40f7-aae7-d9e1c48ecdf1', 'wish': '项羽'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-28 21:14:11 | DEBUG    | trace=37ec5c6a user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed
2025-09-28 21:14:12 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:432 - start request wish=项羽
2025-09-28 21:14:12 | DEBUG    | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:435 - start wish validated
2025-09-28 21:14:12 | DEBUG    | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:439 - start cache keycache_key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:14:12 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:456 - start cache first hithit=False
2025-09-28 21:14:12 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=0.0 limit=8
2025-09-28 21:14:12 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=0.4 limit=8
2025-09-28 21:14:13 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=0.8 limit=8
2025-09-28 21:14:13 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=1.2000000000000002 limit=8
2025-09-28 21:14:14 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=1.6 limit=8
2025-09-28 21:14:14 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=2.0 limit=8
2025-09-28 21:14:15 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=2.4 limit=8
2025-09-28 21:14:15 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=2.8 limit=8
2025-09-28 21:14:15 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=3.1999999999999997 limit=8
2025-09-28 21:14:16 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=3.5999999999999996 limit=8
2025-09-28 21:14:16 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=3.9999999999999996 limit=8
2025-09-28 21:14:17 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=4.3999999999999995 limit=8
2025-09-28 21:14:17 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=4.8 limit=8
2025-09-28 21:14:17 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=5.2 limit=8
2025-09-28 21:14:18 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=5.6000000000000005 limit=8
2025-09-28 21:14:18 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=6.000000000000001 limit=8
2025-09-28 21:14:19 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=6.400000000000001 limit=8
2025-09-28 21:14:19 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=6.800000000000002 limit=8
2025-09-28 21:14:19 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.4 elapsed=7.200000000000002 limit=8
2025-09-28 21:14:20 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:461 - start cache waitwait=0.3999999999999977 elapsed=7.600000000000002 limit=8
2025-09-28 21:14:20 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:498 - start cache miss -> realtime
2025-09-28 21:14:20 | INFO     | trace=300b66dd user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:500 - start realtime create session
2025-09-28 21:14:20 | ERROR    | backend.main:global_exception_handler:217 - 全局异常: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_game_sessions_user_wish"
DETAIL:  Key (user_id, wish)=(ff258ee1-869b-40f7-aae7-d9e1c48ecdf1, 项羽) already exists.

[SQL: INSERT INTO game_sessions (user_id, wish) VALUES (%(user_id)s::UUID, %(wish)s) RETURNING game_sessions.id, game_sessions.created_at]
[parameters: {'user_id': UUID('ff258ee1-869b-40f7-aae7-d9e1c48ecdf1'), 'wish': '项羽'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-28 21:31:10 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:31:11 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:31:12 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:31:12 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:31:12 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:31:12 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:31:12 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:31:12 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:31:12 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:31:12 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:31:12 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:31:12 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:31:12 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:31:12 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:31:12 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:31:12 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:31:12 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:31:12 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:31:12 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:31:12 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:31:13 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:31:13 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:31:13 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:31:13 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:31:13 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:31:13 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:33:38 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:33:39 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:33:40 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:33:40 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:33:40 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:33:40 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:33:40 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:33:40 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:33:40 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:33:40 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:33:40 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:33:40 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:33:40 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:33:40 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:33:40 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:33:40 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:33:40 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:33:40 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:33:40 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:33:40 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:33:41 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:33:41 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:33:41 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:33:41 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:33:41 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:33:41 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:33:45 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:33:46 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:33:47 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:33:47 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:33:47 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:33:47 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:33:47 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:33:47 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:33:47 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:33:47 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:33:47 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:33:47 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:33:47 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:33:47 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:33:47 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:33:47 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:33:47 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:33:47 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:33:47 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:33:47 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:33:48 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:33:48 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:33:48 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:33:48 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:33:48 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:33:48 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:34:07 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:34:08 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:34:09 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:34:09 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:34:09 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:34:09 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:34:09 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:34:09 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:09 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:09 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:34:09 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:34:09 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:34:09 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:34:09 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:34:09 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:34:09 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:34:09 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:34:09 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:34:09 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:34:09 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:34:10 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:10 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:34:10 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:34:10 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:34:10 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:34:10 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:34:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:38 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:34:38 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:34:38 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:34:38 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:34:38 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:34:38 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:34:38 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:39 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:34:39 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:34:39 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:34:39 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:34:39 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:34:39 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:34:39 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:34:39 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:34:39 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:34:39 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:34:39 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:34:39 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:34:39 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:34:39 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:34:39 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:34:39 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:34:39 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:34:56 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:309 - PrepareStart start wish=项羽
2025-09-28 21:34:56 | DEBUG    | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:311 - prepare context building
2025-09-28 21:34:56 | DEBUG    | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:313 - prepare context ready recommended_chapters=10
2025-09-28 21:34:56 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:320 - prepare LLM request prompt_len=513
2025-09-28 21:34:57 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:34:57 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 926
2025-09-28 21:34:57 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:322 - prepare LLM done raw_len=196
2025-09-28 21:34:57 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:349 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 21:34:57 | DEBUG    | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:361 - prepare data parsed title=重临巨鹿，再战天命 quest=率军击溃秦军残部，稳固诸侯归附
2025-09-28 21:34:57 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 21:34:57 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:393 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 21:34:57 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:111 - pregeneration story engine start
2025-09-28 21:34:57 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-28 21:35:00 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:35:00 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1359
2025-09-28 21:35:00 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=783 预览='{"text": "夜风卷起楚军大帐的帘角，项羽立于中军帐前，青铜剑穗在风中轻颤。斥候急报：刘邦派密使潜入彭城外围，欲策反陈平旧部。帐内烛火摇曳，映出他眉间深锁的疑云。他握紧剑柄，眼中掠过杀意与权衡——若严惩，恐寒将士之心；若放任，又似纵虎归山。远处传来战马嘶鸣，仿佛预示着一场无声的风暴正在酝酿。", "choices": [{"option": "召来亲信暗中设局，以假情报诱敌自曝", "summary": "以智谋反制阴谋，布下无形之网", "effects": {"delta_progress": 12, "delta_risk": 6, "delta_exposure": 4, "ta'
2025-09-28 21:35:00 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=783 预览='{"text": "夜风卷起楚军大帐的帘角，项羽立于中军帐前，青铜剑穗在风中轻颤。斥候急报：刘邦派密使潜入彭城外围，欲策反陈平旧部。帐内烛火摇曳，映出他眉间深锁的疑云。他握紧剑柄，眼中掠过杀意与权衡——若严惩，恐寒将士之心；若放任，又似纵虎归山。远处传来战马嘶鸣，仿佛预示着一场无声的风暴正在酝酿。", "choices'
2025-09-28 21:35:00 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=783 预览='{"text": "夜风卷起楚军大帐的帘角，项羽立于中军帐前，青铜剑穗在风中轻颤。斥候急报：刘邦派密使潜入彭城外围，欲策反陈平旧部。帐内烛火摇曳，映出他眉间深锁的疑云。他握紧剑柄，眼中掠过杀意与权衡——若严惩，恐寒将士之心；若放任，又似纵虎归山。远处传来战马嘶鸣，仿佛预示着一场无声的风暴正在酝酿。", "choices'
2025-09-28 21:35:00 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=139
2025-09-28 21:35:00 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=139 preview="夜风卷起楚军大帐的帘角，项羽立于中军帐前，青铜剑穗在风中轻颤。斥候急报：刘邦派密使潜入彭城外围，欲策反陈平旧部。帐内烛火摇曳，映出他眉间深锁的疑云。他握紧剑柄，眼中掠过杀意与权衡——若严惩，恐寒将士之心；若放任，又似纵虎归山。远处传来战马嘶鸣，仿佛预示着一场无声的风暴正在酝酿。"

2025-09-28 21:35:00 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起楚军大帐的帘角，项羽立于中军帐前，青铜剑穗在风中轻颤。斥候急报：刘邦派密使潜入彭城外围，欲策反陈平旧部。帐内烛火摇曳，映出他眉间深锁的疑…"

2025-09-28 21:35:00 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜风卷起楚军大帐的帘角，...
2025-09-28 21:35:12 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 766 (attempt 1/2)
2025-09-28 21:35:12 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=132

2025-09-28 21:35:12 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759066512626_616.png
2025-09-28 21:35:12 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759066512626_616.png

2025-09-28 21:35:12 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759066512626_616.png

2025-09-28 21:35:14 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_f447e6f0cf607244bd979ccad96a3285.png (大小: 1351650 字节)

2025-09-28 21:35:14 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_f447e6f0cf607244bd979ccad96a3285.webp 大小 60408 字节 (原始 1351650 字节, 压缩比 0.04)

2025-09-28 21:35:14 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_f447e6f0cf607244bd979ccad96a3285.png

2025-09-28 21:35:14 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_f447e6f0cf607244bd979ccad96a3285.webp

2025-09-28 21:35:14 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f447e6f0cf607244bd979ccad96a3285.webp

2025-09-28 21:35:14 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_f447e6f0cf607244bd979ccad96a3285.webp

2025-09-28 21:35:14 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_f447e6f0cf607244bd979ccad96a3285.webp
2025-09-28 21:35:14 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 21:35:14 | INFO     | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration story readytext_len=139
2025-09-28 21:35:14 | ERROR    | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:145 - pregeneration failederror=(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_game_sessions_user_wish"
DETAIL:  Key (user_id, wish)=(ff258ee1-869b-40f7-aae7-d9e1c48ecdf1, 项羽) already exists.

[SQL: INSERT INTO game_sessions (user_id, wish) VALUES (%(user_id)s::UUID, %(wish)s) RETURNING game_sessions.id, game_sessions.created_at]
[parameters: {'user_id': 'ff258ee1-869b-40f7-aae7-d9e1c48ecdf1', 'wish': '项羽'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-28 21:35:14 | DEBUG    | trace=985ef45f user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:153 - pregeneration db closed
2025-09-28 21:36:35 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:36:35 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:36:36 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:36:37 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:36:37 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:36:37 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:36:37 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:36:37 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:36:37 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:36:37 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:36:37 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:36:37 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:36:37 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:36:37 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:36:37 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:36:37 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:36:37 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:36:37 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:36:37 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:36:37 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:36:37 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:36:38 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:36:38 | INFO     | backend.main:_run_alembic_cmd:227 - Alembic migration complete.
2025-09-28 21:36:38 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:36:38 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:36:38 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:36:38 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:37:18 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:324 - PrepareStart start wish=项羽
2025-09-28 21:37:18 | DEBUG    | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:326 - prepare context building
2025-09-28 21:37:18 | DEBUG    | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:328 - prepare context ready recommended_chapters=10
2025-09-28 21:37:18 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:335 - prepare LLM request prompt_len=513
2025-09-28 21:37:20 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:37:20 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 927
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:337 - prepare LLM done raw_len=207
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:364 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 21:37:20 | DEBUG    | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:376 - prepare data parsed title=重铸西楚江山 quest=在十日内确立西楚中央权威
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:408 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration reuse existing session
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:130 - pregeneration reuse root node
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:150 - pregeneration cache stored
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:155 - pregeneration speculation enqueueddepth=0
2025-09-28 21:37:20 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:157 - pregeneration done
2025-09-28 21:37:20 | DEBUG    | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:168 - pregeneration db closed
2025-09-28 21:37:40 | INFO     | trace=e827a9ae user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:447 - start request wish=项羽
2025-09-28 21:37:40 | DEBUG    | trace=e827a9ae user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:450 - start wish validated
2025-09-28 21:37:40 | DEBUG    | trace=e827a9ae user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:454 - start cache keycache_key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:37:40 | DEBUG    | api.story:_cache_pop:92 - [预生成] 从缓存中取出 key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:470 - start trace resumed
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:471 - start cache first hithit=True
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:488 - start use pregenerated
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:509 - start use cached nodesession_id=12 node_id=11
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:569 - start donetext_len=169 choice_count=3 image=http://127.0.0.1:8000/static/generated/ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:576 - start image filefile_exists=True size=37534 path=C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:579 - start speculation enqueuedepth=1
2025-09-28 21:37:40 | DEBUG    | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=11 depth=1
2025-09-28 21:37:40 | INFO     | trace=c417d37c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:582 - start response readyimage=http://127.0.0.1:8000/static/generated/ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:37:40 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_feb82d921135ca235cc1263c21b640a2.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_feb82d921135ca235cc1263c21b640a2.webp exists=True size=37534
2025-09-28 21:37:40 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:37:40 | DEBUG    | core.speculation:_generate_children_pipeline:205 - [Speculation] no new choices to generate for node=11
2025-09-28 21:37:40 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:37:53 | INFO     | trace=4d12f961 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=continue | api.story:continue_existing_story:610 - continue requestchoice=命亲卫假扮敌军斥候，引诱汉军营地自乱阵脚
2025-09-28 21:37:53 | INFO     | trace=4d12f961 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=12 task=continue | api.story:continue_existing_story:656 - continue node ready check
2025-09-28 21:37:53 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] 开始等待节点完全准备：node_id=12
2025-09-28 21:37:53 | INFO     | api.story:_wait_for_node_complete:233 - [NodeComplete] ✅ 节点完全准备就绪：node_id=12 (等待了 0.0 秒)
2025-09-28 21:37:53 | INFO     | trace=4d12f961 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=12 task=continue | api.story:continue_existing_story:659 - continue node ready success
2025-09-28 21:37:53 | INFO     | trace=4d12f961 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=12 task=continue | api.story:continue_existing_story:668 - continue speculation enqueue existingdepth=1
2025-09-28 21:37:53 | DEBUG    | trace=4d12f961 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=12 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=12 depth=1
2025-09-28 21:37:53 | DEBUG    | core.speculation:_generate_children_pipeline:205 - [Speculation] no new choices to generate for node=12
2025-09-28 21:37:53 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_769911374de8b58b517e4455b0f982d4.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_769911374de8b58b517e4455b0f982d4.webp exists=True size=73272
2025-09-28 21:37:53 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_769911374de8b58b517e4455b0f982d4.webp
2025-09-28 21:37:53 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_769911374de8b58b517e4455b0f982d4.webp
2025-09-28 21:38:09 | INFO     | trace=896eb02c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=12 task=continue | api.story:continue_existing_story:610 - continue requestchoice=当众焚毁密信，宣称援军已至，命全军整备夜袭刘邦大营
2025-09-28 21:38:09 | INFO     | trace=896eb02c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=17 task=continue | api.story:continue_existing_story:656 - continue node ready check
2025-09-28 21:38:09 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] 开始等待节点完全准备：node_id=17
2025-09-28 21:38:09 | INFO     | api.story:_wait_for_node_complete:233 - [NodeComplete] ✅ 节点完全准备就绪：node_id=17 (等待了 0.0 秒)
2025-09-28 21:38:09 | INFO     | trace=896eb02c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=17 task=continue | api.story:continue_existing_story:659 - continue node ready success
2025-09-28 21:38:09 | INFO     | trace=896eb02c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=17 task=continue | api.story:continue_existing_story:668 - continue speculation enqueue existingdepth=1
2025-09-28 21:38:09 | DEBUG    | trace=896eb02c user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=17 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=17 depth=1
2025-09-28 21:38:09 | DEBUG    | core.speculation:_generate_children_pipeline:205 - [Speculation] no new choices to generate for node=17
2025-09-28 21:38:09 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_6455b5200fb852035c9d9b22e2aa509c.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_6455b5200fb852035c9d9b22e2aa509c.webp exists=True size=74364
2025-09-28 21:38:09 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_6455b5200fb852035c9d9b22e2aa509c.webp
2025-09-28 21:38:09 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_6455b5200fb852035c9d9b22e2aa509c.webp
2025-09-28 21:38:15 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_f85c3b9c60fa256e51985a241cf116e2.png -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f85c3b9c60fa256e51985a241cf116e2.png exists=True size=940559
2025-09-28 21:38:15 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_f85c3b9c60fa256e51985a241cf116e2.png
2025-09-28 21:38:15 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_3126bea2684e5639ff229c4a56561752.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3126bea2684e5639ff229c4a56561752.webp exists=True size=82944
2025-09-28 21:38:15 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_3126bea2684e5639ff229c4a56561752.webp
2025-09-28 21:38:15 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_3412dbc5c616ebfff577da72572c85cf.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_3412dbc5c616ebfff577da72572c85cf.webp exists=True size=52444
2025-09-28 21:38:15 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 21:38:15 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_f85c3b9c60fa256e51985a241cf116e2.png
2025-09-28 21:38:15 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_3126bea2684e5639ff229c4a56561752.webp
2025-09-28 21:38:15 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_3412dbc5c616ebfff577da72572c85cf.webp
2025-09-28 21:38:17 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp exists=True size=27636
2025-09-28 21:38:17 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 21:38:17 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp exists=True size=68482
2025-09-28 21:38:17 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp
2025-09-28 21:38:17 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_f80f7af8846c1bbc058c1c1ca98d12cb.webp
2025-09-28 21:38:17 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_0bdfbae0d51ada6c99e0c3e6d15cb15b.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_dc1b966b1dd51f1e27736356d2646633.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_dc1b966b1dd51f1e27736356d2646633.webp exists=True size=89238
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_dc1b966b1dd51f1e27736356d2646633.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_2969eb1a2ef73b5788ead99f37f34540.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_2969eb1a2ef73b5788ead99f37f34540.webp exists=True size=92704
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_7135ca903521b890db5371256d929a25.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_7135ca903521b890db5371256d929a25.webp exists=True size=63264
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_2969eb1a2ef73b5788ead99f37f34540.webp
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_7135ca903521b890db5371256d929a25.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_422e676965b80f2343cccd4faf130e34.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_422e676965b80f2343cccd4faf130e34.webp exists=True size=127662
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_d9a6418b661c0b7d075d3354eab9e1a9.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_d9a6418b661c0b7d075d3354eab9e1a9.webp exists=True size=88096
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_422e676965b80f2343cccd4faf130e34.webp
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_d9a6418b661c0b7d075d3354eab9e1a9.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_dc1b966b1dd51f1e27736356d2646633.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_2969eb1a2ef73b5788ead99f37f34540.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_7135ca903521b890db5371256d929a25.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_988777636d547f174d8dcba46d1eeb77.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_988777636d547f174d8dcba46d1eeb77.webp exists=True size=92268
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_988777636d547f174d8dcba46d1eeb77.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_422e676965b80f2343cccd4faf130e34.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_d9a6418b661c0b7d075d3354eab9e1a9.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_988777636d547f174d8dcba46d1eeb77.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_27f63f4a8c78e6798257b2ff5f037688.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_27f63f4a8c78e6798257b2ff5f037688.webp exists=True size=78402
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_27f63f4a8c78e6798257b2ff5f037688.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp exists=True size=48174
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_fde546289195bf9a900e588c602c48bc.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_fde546289195bf9a900e588c602c48bc.webp exists=True size=76824
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp exists=True size=49750
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_27f63f4a8c78e6798257b2ff5f037688.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp exists=True size=76982
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_a39bd5062a062a2fe646bbf4adcc20e0.webp
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_fde546289195bf9a900e588c602c48bc.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_ac14b89cb2b3c8c2c43481f3555166ad.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_e91a2dcde623f8327e1c7b21e3c123ef.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_66c82b47faedd97337276e0e272dc39c.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_66c82b47faedd97337276e0e272dc39c.webp exists=True size=74606
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 21:38:18 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_547c604482b9ea9a2f9972d4921cef59.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_547c604482b9ea9a2f9972d4921cef59.webp exists=True size=61142
2025-09-28 21:38:18 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_547c604482b9ea9a2f9972d4921cef59.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_66c82b47faedd97337276e0e272dc39c.webp
2025-09-28 21:38:18 | INFO     | backend.main:get_response:44 - [Static:generated] status=304 path=ai_gen_547c604482b9ea9a2f9972d4921cef59.webp
2025-09-28 21:38:30 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:324 - PrepareStart start wish=项羽
2025-09-28 21:38:30 | DEBUG    | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:326 - prepare context building
2025-09-28 21:38:30 | DEBUG    | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:328 - prepare context ready recommended_chapters=10
2025-09-28 21:38:30 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:335 - prepare LLM request prompt_len=513
2025-09-28 21:38:32 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:38:32 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 935
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:337 - prepare LLM done raw_len=201
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:364 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 21:38:32 | DEBUG    | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:376 - prepare data parsed title=霸王重生：巨鹿破局 quest=率军击溃秦军主力，夺取巨鹿之战胜利
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=prepare_start wish=项羽 | api.story:prepare_start_level:408 - prepare background thread starteduser=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:113 - pregeneration reuse existing session
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:130 - pregeneration reuse root node
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:150 - pregeneration cache stored
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:155 - pregeneration speculation enqueueddepth=0
2025-09-28 21:38:32 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:157 - pregeneration done
2025-09-28 21:38:32 | DEBUG    | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:168 - pregeneration db closed
2025-09-28 21:38:51 | INFO     | trace=320a8394 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:447 - start request wish=项羽
2025-09-28 21:38:51 | DEBUG    | trace=320a8394 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:450 - start wish validated
2025-09-28 21:38:51 | DEBUG    | trace=320a8394 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:454 - start cache keycache_key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:38:51 | DEBUG    | api.story:_cache_pop:92 - [预生成] 从缓存中取出 key=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:470 - start trace resumed
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 task=start wish=项羽 | api.story:start_new_story:471 - start cache first hithit=True
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:488 - start use pregenerated
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:509 - start use cached nodesession_id=12 node_id=11
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:569 - start donetext_len=169 choice_count=3 image=http://127.0.0.1:8000/static/generated/ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:576 - start image filefile_exists=True size=37534 path=C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:579 - start speculation enqueuedepth=1
2025-09-28 21:38:51 | DEBUG    | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=12 node=11 depth=1
2025-09-28 21:38:51 | INFO     | trace=3ffcdaf3 user=ff258ee1-869b-40f7-aae7-d9e1c48ecdf1 session=12 node=11 task=start wish=项羽 | api.story:start_new_story:582 - start response readyimage=http://127.0.0.1:8000/static/generated/ai_gen_feb82d921135ca235cc1263c21b640a2.webp
2025-09-28 21:38:51 | DEBUG    | core.speculation:_generate_children_pipeline:205 - [Speculation] no new choices to generate for node=11
2025-09-28 21:38:58 | INFO     | backend.database.crud:create_user:37 - 创建新用户: 2930922@qq.com
2025-09-28 21:39:08 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:324 - PrepareStart start wish=项羽
2025-09-28 21:39:08 | DEBUG    | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:326 - prepare context building
2025-09-28 21:39:08 | DEBUG    | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:328 - prepare context ready recommended_chapters=10
2025-09-28 21:39:08 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:335 - prepare LLM request prompt_len=513
2025-09-28 21:39:09 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:39:09 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 920
2025-09-28 21:39:09 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:337 - prepare LLM done raw_len=199
2025-09-28 21:39:09 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:364 - prepare json parsed fields=level_title|background|main_quest
2025-09-28 21:39:09 | DEBUG    | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:376 - prepare data parsed title=霸王重生：巨鹿之始 quest=在诸侯面前立威，确立西楚霸主地位
2025-09-28 21:39:09 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:108 - pregeneration start
2025-09-28 21:39:09 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=prepare_start wish=项羽 | api.story:prepare_start_level:408 - prepare background thread starteduser=dbcf516e-6d67-4dca-ace8-0f168208849f
2025-09-28 21:39:09 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:118 - pregeneration session created
2025-09-28 21:39:09 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:133 - pregeneration story engine start
2025-09-28 21:39:09 | INFO     | core.story_engine:start_story:386 - 收到新的故事开始请求，愿望是: '项羽'
2025-09-28 21:39:12 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:39:12 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1386
2025-09-28 21:39:12 | INFO     | core.story_engine:start_story:402 - [LLM raw][start] 长度=816 预览='{"text": "夜色如墨，楚营外的篝火在寒风中摇曳，映得项羽的铠甲泛出冷光。斥候急报：刘邦军正悄然调动，意图绕道袭我粮道。你凝视着沙盘上那条蜿蜒的暗线，耳边是将士们压抑的喘息与战马低鸣。远处传来铁蹄轻响，仿佛命运的鼓点正步步逼近。你握紧剑柄，心中翻涌着怒意与决断——是挥兵迎击，还是设伏诱敌？亦或以雷霆手段震慑敌胆，令其不战自溃？每一步都关乎西楚存亡，而你的选择，将决定这乱世的走向。", "choices": [{"option": "亲率精骑突袭敌后，以雷霆之势斩断其运粮队首尾", "summary": "以勇猛破局，直击敌军命脉", "effects": {"delta_progress'
2025-09-28 21:39:12 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=816 预览='{"text": "夜色如墨，楚营外的篝火在寒风中摇曳，映得项羽的铠甲泛出冷光。斥候急报：刘邦军正悄然调动，意图绕道袭我粮道。你凝视着沙盘上那条蜿蜒的暗线，耳边是将士们压抑的喘息与战马低鸣。远处传来铁蹄轻响，仿佛命运的鼓点正步步逼近。你握紧剑柄，心中翻涌着怒意与决断——是挥兵迎击，还是设伏诱敌？亦或以雷霆手段震慑敌胆，'
2025-09-28 21:39:12 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=816 预览='{"text": "夜色如墨，楚营外的篝火在寒风中摇曳，映得项羽的铠甲泛出冷光。斥候急报：刘邦军正悄然调动，意图绕道袭我粮道。你凝视着沙盘上那条蜿蜒的暗线，耳边是将士们压抑的喘息与战马低鸣。远处传来铁蹄轻响，仿佛命运的鼓点正步步逼近。你握紧剑柄，心中翻涌着怒意与决断——是挥兵迎击，还是设伏诱敌？亦或以雷霆手段震慑敌胆，'
2025-09-28 21:39:12 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=184
2025-09-28 21:39:12 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=184 preview="夜色如墨，楚营外的篝火在寒风中摇曳，映得项羽的铠甲泛出冷光。斥候急报：刘邦军正悄然调动，意图绕道袭我粮道。你凝视着沙盘上那条蜿蜒的暗线，耳边是将士们压抑的喘息与战马低鸣。远处传来铁蹄轻响，仿佛命运的鼓点正步步逼近。你握紧剑柄，心中翻涌着怒意与决断——是挥兵迎击，还是设伏诱敌？亦或以雷霆手段震慑敌胆，令其不战自溃？每一步都关乎西楚存亡，而你的选择，将决定这乱世的走向。"

2025-09-28 21:39:12 | INFO     | core.image_generation:__init__:24 - 图像生成客户端初始化完成，使用提供商: openai
2025-09-28 21:39:12 | INFO     | core.image_storage:__init__:34 - 图像存储服务初始化完成，存储目录: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images

2025-09-28 21:39:12 | INFO     | core.image_storage:__init__:35 - 图像web访问前缀: http://127.0.0.1:8000/static/generated

2025-09-28 21:39:12 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，楚营外的篝火在寒风中摇曳，映得项羽的铠甲泛出冷光。斥候急报：刘邦军正悄然调动，意图绕道袭我粮道。你凝视着沙盘上那条蜿蜒的暗线，耳边是将…"

2025-09-28 21:39:12 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，楚营外的篝火在...
2025-09-28 21:39:24 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:39:24 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:39:24 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759066764423_028.png
2025-09-28 21:39:24 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759066764423_028.png

2025-09-28 21:39:24 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759066764423_028.png

2025-09-28 21:39:26 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_8c119c567eb6a29fc34b4127c9932a22.png (大小: 1357642 字节)

2025-09-28 21:39:26 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp 大小 74754 字节 (原始 1357642 字节, 压缩比 0.06)

2025-09-28 21:39:26 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_8c119c567eb6a29fc34b4127c9932a22.png

2025-09-28 21:39:26 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp

2025-09-28 21:39:26 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp

2025-09-28 21:39:26 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp

2025-09-28 21:39:26 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:26 | INFO     | core.story_engine:start_story:447 - 新故事生成成功
2025-09-28 21:39:26 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:135 - pregeneration story readytext_len=184
2025-09-28 21:39:26 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:140 - pregeneration node created
2025-09-28 21:39:26 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:141 - pregeneration node imageimage=http://127.0.0.1:8000/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:26 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:150 - pregeneration cache stored
2025-09-28 21:39:26 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:155 - pregeneration speculation enqueueddepth=0
2025-09-28 21:39:26 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:157 - pregeneration done
2025-09-28 21:39:26 | DEBUG    | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=pregeneration wish=项羽 | api.story:_background_generate_with_pregeneration:168 - pregeneration db closed
2025-09-28 21:39:29 | INFO     | trace=f2fde283 user=dbcf516e-6d67-4dca-ace8-0f168208849f task=start wish=项羽 | api.story:start_new_story:447 - start request wish=项羽
2025-09-28 21:39:29 | DEBUG    | trace=f2fde283 user=dbcf516e-6d67-4dca-ace8-0f168208849f task=start wish=项羽 | api.story:start_new_story:450 - start wish validated
2025-09-28 21:39:29 | DEBUG    | trace=f2fde283 user=dbcf516e-6d67-4dca-ace8-0f168208849f task=start wish=项羽 | api.story:start_new_story:454 - start cache keycache_key=dbcf516e-6d67-4dca-ace8-0f168208849f:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:39:29 | DEBUG    | api.story:_cache_pop:92 - [预生成] 从缓存中取出 key=dbcf516e-6d67-4dca-ace8-0f168208849f:7865e02d41aa67b5b63c21fda711c5216856f3f413c5ff4f7bda5467e5d1aedd
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=start wish=项羽 | api.story:start_new_story:470 - start trace resumed
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f task=start wish=项羽 | api.story:start_new_story:471 - start cache first hithit=True
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=start wish=项羽 | api.story:start_new_story:488 - start use pregenerated
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=start wish=项羽 | api.story:start_new_story:509 - start use cached nodesession_id=19 node_id=83
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=start wish=项羽 | api.story:start_new_story:569 - start donetext_len=184 choice_count=3 image=http://127.0.0.1:8000/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=start wish=项羽 | api.story:start_new_story:576 - start image filefile_exists=True size=74754 path=C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=start wish=项羽 | api.story:start_new_story:579 - start speculation enqueuedepth=1
2025-09-28 21:39:29 | DEBUG    | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=19 node=83 depth=1
2025-09-28 21:39:29 | INFO     | trace=fb225a0e user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=start wish=项羽 | api.story:start_new_story:582 - start response readyimage=http://127.0.0.1:8000/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:29 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=83
2025-09-28 21:39:29 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=83 | choice="亲率精骑突袭敌后，以雷霆之势斩断其运粮队首尾"
2025-09-28 21:39:29 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=83 | choice="命人伪造密信，散布谣言称刘邦欲背盟投秦，挑起其内斗"
2025-09-28 21:39:29 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率精骑突袭敌后，以雷霆之势斩断其运粮队首尾
2025-09-28 21:39:29 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=83 | choice="召集群将，当众宣誓血盟，以气势压倒敌军士气"
2025-09-28 21:39:29 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人伪造密信，散布谣言称刘邦欲背盟投秦，挑起其内斗
2025-09-28 21:39:29 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 召集群将，当众宣誓血盟，以气势压倒敌军士气
2025-09-28 21:39:29 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp exists=True size=74754
2025-09-28 21:39:29 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:29 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_8c119c567eb6a29fc34b4127c9932a22.webp
2025-09-28 21:39:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:39:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1605
2025-09-28 21:39:33 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=868 预览='{"text": "寒风卷起战旗，猎猎作响。你凝视沙盘上那条悄然逼近的敌线，忽然冷笑一声，将铁戟重重插地。‘刘邦想抄我粮道？’你声音如裂帛，‘那便让他尝尝楚军的怒火——可别忘了，这天下，本就是我项羽用血与刀劈出来的！’你转身大步走向校场，命人擂鼓聚将，战马嘶鸣，士卒列阵如林。你立于高台，目光扫过一张张坚毅的脸庞，手中长戟指向天际：‘今夜，我们不攻，也不守——我们要让敌人知道，西楚的雷霆，从不在他们预料之中。’", "choices": [{"option": "下令全军偃旗息鼓，暗中调集精锐埋伏于山隘，以静制动诱敌深入", "summary": "以沉寂之姿藏锋芒，等待敌军踏入死局", "ef'
2025-09-28 21:39:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=868 预览='{"text": "寒风卷起战旗，猎猎作响。你凝视沙盘上那条悄然逼近的敌线，忽然冷笑一声，将铁戟重重插地。‘刘邦想抄我粮道？’你声音如裂帛，‘那便让他尝尝楚军的怒火——可别忘了，这天下，本就是我项羽用血与刀劈出来的！’你转身大步走向校场，命人擂鼓聚将，战马嘶鸣，士卒列阵如林。你立于高台，目光扫过一张张坚毅的脸庞，手中长'
2025-09-28 21:39:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=868 预览='{"text": "寒风卷起战旗，猎猎作响。你凝视沙盘上那条悄然逼近的敌线，忽然冷笑一声，将铁戟重重插地。‘刘邦想抄我粮道？’你声音如裂帛，‘那便让他尝尝楚军的怒火——可别忘了，这天下，本就是我项羽用血与刀劈出来的！’你转身大步走向校场，命人擂鼓聚将，战马嘶鸣，士卒列阵如林。你立于高台，目光扫过一张张坚毅的脸庞，手中长'
2025-09-28 21:39:33 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=196
2025-09-28 21:39:33 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=196 preview="寒风卷起战旗，猎猎作响。你凝视沙盘上那条悄然逼近的敌线，忽然冷笑一声，将铁戟重重插地。‘刘邦想抄我粮道？’你声音如裂帛，‘那便让他尝尝楚军的怒火——可别忘了，这天下，本就是我项羽用血与刀劈出来的！’你转身大步走向校场，命人擂鼓聚将，战马嘶鸣，士卒列阵如林。你立于高台，目光扫过一张张坚毅的脸庞，手中长戟指向天际：‘今夜，我们不攻，也不守——我们要让敌人知道，西楚的雷霆，从不在他们预料之中。’"

2025-09-28 21:39:33 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗，猎猎作响。你凝视沙盘上那条悄然逼近的敌线，忽然冷笑一声，将铁戟重重插地。‘刘邦想抄我粮道？’你声音如裂帛，‘那便让他尝尝楚军的怒火…"

2025-09-28 21:39:33 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗，猎猎作响。...
2025-09-28 21:39:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:39:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1635
2025-09-28 21:39:33 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=897 预览='{"text": "寒风卷起战旗，猎猎如血。项羽立于高台，目光如刀扫过沙盘上那条蜿蜒的敌军行迹。他猛地一掌拍碎案几，木屑飞溅：‘刘邦小儿，竟敢绕道断我粮道！’ 士兵们齐声怒吼，战鼓轰鸣。然而就在千钧一发之际，远处火光忽明忽暗——是敌军设伏？还是诱敌之计？你眼中闪过一丝杀意，手已按在剑柄，却听见帐外传来马蹄急响，一名斥候跌撞而入：‘大王！粮道无恙，但有密使潜入我营，自称是韩信旧部，愿献奇谋！’ 乱局之中，真假难辨，而每一秒都可能改写战局。", "choices": [{"option": "命人将密使押至辕门，当众斩首示众，以儆效尤", "summary": "以雷霆手段震慑营中异心，立威于军前'
2025-09-28 21:39:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=897 预览='{"text": "寒风卷起战旗，猎猎如血。项羽立于高台，目光如刀扫过沙盘上那条蜿蜒的敌军行迹。他猛地一掌拍碎案几，木屑飞溅：‘刘邦小儿，竟敢绕道断我粮道！’ 士兵们齐声怒吼，战鼓轰鸣。然而就在千钧一发之际，远处火光忽明忽暗——是敌军设伏？还是诱敌之计？你眼中闪过一丝杀意，手已按在剑柄，却听见帐外传来马蹄急响，一名斥候'
2025-09-28 21:39:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=897 预览='{"text": "寒风卷起战旗，猎猎如血。项羽立于高台，目光如刀扫过沙盘上那条蜿蜒的敌军行迹。他猛地一掌拍碎案几，木屑飞溅：‘刘邦小儿，竟敢绕道断我粮道！’ 士兵们齐声怒吼，战鼓轰鸣。然而就在千钧一发之际，远处火光忽明忽暗——是敌军设伏？还是诱敌之计？你眼中闪过一丝杀意，手已按在剑柄，却听见帐外传来马蹄急响，一名斥候'
2025-09-28 21:39:33 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=210
2025-09-28 21:39:33 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=210 preview="寒风卷起战旗，猎猎如血。项羽立于高台，目光如刀扫过沙盘上那条蜿蜒的敌军行迹。他猛地一掌拍碎案几，木屑飞溅：‘刘邦小儿，竟敢绕道断我粮道！’ 士兵们齐声怒吼，战鼓轰鸣。然而就在千钧一发之际，远处火光忽明忽暗——是敌军设伏？还是诱敌之计？你眼中闪过一丝杀意，手已按在剑柄，却听见帐外传来马蹄急响，一名斥候跌撞而入：‘大王！粮道无恙，但有密使潜入我营，自称是韩信旧部，愿献奇谋！’ 乱局之中，真假难辨，而每…"

2025-09-28 21:39:33 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗，猎猎如血。项羽立于高台，目光如刀扫过沙盘上那条蜿蜒的敌军行迹。他猛地一掌拍碎案几，木屑飞溅：‘刘邦小儿，竟敢绕道断我粮道！’ 士兵…"

2025-09-28 21:39:33 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗，猎猎如血。...
2025-09-28 21:39:33 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:39:33 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1598
2025-09-28 21:39:33 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=862 预览='{"text": "寒风卷起战旗，猎猎如雷。项羽立于高台，目光如刃扫过沙盘上那条逼近粮道的暗线。他忽然冷笑一声，拔剑劈向案几，木屑飞溅：‘刘邦想偷我命根子？那就让他尝尝什么叫断臂之痛！’他转身大步走向营帐深处，铁甲铿锵如战鼓。亲卫欲言又止，只见他抽出一卷火漆密函，掷于案上——那是早已埋伏在山口的死士名单。他眼中燃起野火，低语道：‘不是我怕你来，是你不敢走这条路。’夜色如墨，战鼓未响，但杀机已如蛛网密布于每一寸空气之中。", "choices": [{"option": "亲率精锐骑兵突袭敌军侧翼，以雷霆之势搅乱其阵型", "summary": "以猛攻破敌谋，展现霸王无畏气概", "effec'
2025-09-28 21:39:33 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=862 预览='{"text": "寒风卷起战旗，猎猎如雷。项羽立于高台，目光如刃扫过沙盘上那条逼近粮道的暗线。他忽然冷笑一声，拔剑劈向案几，木屑飞溅：‘刘邦想偷我命根子？那就让他尝尝什么叫断臂之痛！’他转身大步走向营帐深处，铁甲铿锵如战鼓。亲卫欲言又止，只见他抽出一卷火漆密函，掷于案上——那是早已埋伏在山口的死士名单。他眼中燃起野火'
2025-09-28 21:39:33 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=862 预览='{"text": "寒风卷起战旗，猎猎如雷。项羽立于高台，目光如刃扫过沙盘上那条逼近粮道的暗线。他忽然冷笑一声，拔剑劈向案几，木屑飞溅：‘刘邦想偷我命根子？那就让他尝尝什么叫断臂之痛！’他转身大步走向营帐深处，铁甲铿锵如战鼓。亲卫欲言又止，只见他抽出一卷火漆密函，掷于案上——那是早已埋伏在山口的死士名单。他眼中燃起野火'
2025-09-28 21:39:33 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=201
2025-09-28 21:39:33 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=201 preview="寒风卷起战旗，猎猎如雷。项羽立于高台，目光如刃扫过沙盘上那条逼近粮道的暗线。他忽然冷笑一声，拔剑劈向案几，木屑飞溅：‘刘邦想偷我命根子？那就让他尝尝什么叫断臂之痛！’他转身大步走向营帐深处，铁甲铿锵如战鼓。亲卫欲言又止，只见他抽出一卷火漆密函，掷于案上——那是早已埋伏在山口的死士名单。他眼中燃起野火，低语道：‘不是我怕你来，是你不敢走这条路。’夜色如墨，战鼓未响，但杀机已如蛛网密布于每一寸空气之中…"

2025-09-28 21:39:33 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗，猎猎如雷。项羽立于高台，目光如刃扫过沙盘上那条逼近粮道的暗线。他忽然冷笑一声，拔剑劈向案几，木屑飞溅：‘刘邦想偷我命根子？那就让他…"

2025-09-28 21:39:33 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 寒风卷起战旗，猎猎如雷。...
2025-09-28 21:39:45 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:39:45 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:39:45 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759066784903_452.png
2025-09-28 21:39:45 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759066784903_452.png

2025-09-28 21:39:45 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759066784903_452.png

2025-09-28 21:39:46 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:39:46 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:39:46 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759066785775_339.png
2025-09-28 21:39:46 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759066785775_339.png

2025-09-28 21:39:46 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759066785775_339.png

2025-09-28 21:39:47 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:39:47 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:39:47 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759066787018_873.png
2025-09-28 21:39:47 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759066787018_873.png

2025-09-28 21:39:47 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759066787018_873.png

2025-09-28 21:39:48 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_26a3373e1d20dcd6b757c5924a9204e5.png (大小: 1061880 字节)

2025-09-28 21:39:48 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_26a3373e1d20dcd6b757c5924a9204e5.webp 大小 51032 字节 (原始 1061880 字节, 压缩比 0.05)

2025-09-28 21:39:48 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_26a3373e1d20dcd6b757c5924a9204e5.png

2025-09-28 21:39:48 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_26a3373e1d20dcd6b757c5924a9204e5.webp

2025-09-28 21:39:48 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_26a3373e1d20dcd6b757c5924a9204e5.webp

2025-09-28 21:39:48 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_26a3373e1d20dcd6b757c5924a9204e5.webp

2025-09-28 21:39:48 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_26a3373e1d20dcd6b757c5924a9204e5.webp
2025-09-28 21:39:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 21:39:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=83 | choice="命人伪造密信，散布谣言称刘邦欲背盟投秦，挑起其内斗" | text_len=201 | text="寒风卷起战旗，猎猎如雷。项羽立于高台，目光如刃扫过沙盘上那条逼近粮道的暗线。他忽然冷笑一声，拔剑劈向案几，木屑飞溅：‘刘邦想偷我命根子？那就让他尝尝什么叫断臂之痛！’他转身大步走向营帐深处，铁甲铿锵如战鼓。亲卫欲言又止，只见他抽出一卷火漆密函，掷于案上——那是早已埋伏在山口的死士名单。他眼中燃起野火，低语道：‘不是我怕你来，是你不敢走这条路。’夜色如墨，战鼓未响，但杀机已如蛛网密布于每一寸空气之中。"
2025-09-28 21:39:48 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=83 | choice="命人伪造密信，散布谣言称刘邦欲背盟投秦，挑起其内斗" | node=84 | text_len=201 | image=http://127.0.0.1:8000/static/generated/ai_gen_26a3373e1d20dcd6b757c5924a9204e5.webp
2025-09-28 21:39:48 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_0a4b8b0efafaea4950963e62bbd1194e.png (大小: 1538599 字节)

2025-09-28 21:39:48 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_0a4b8b0efafaea4950963e62bbd1194e.webp 大小 93332 字节 (原始 1538599 字节, 压缩比 0.06)

2025-09-28 21:39:48 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_0a4b8b0efafaea4950963e62bbd1194e.png

2025-09-28 21:39:48 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_0a4b8b0efafaea4950963e62bbd1194e.webp

2025-09-28 21:39:48 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_0a4b8b0efafaea4950963e62bbd1194e.webp

2025-09-28 21:39:48 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_0a4b8b0efafaea4950963e62bbd1194e.webp

2025-09-28 21:39:48 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_0a4b8b0efafaea4950963e62bbd1194e.webp
2025-09-28 21:39:48 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 21:39:48 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=83 | choice="召集群将，当众宣誓血盟，以气势压倒敌军士气" | text_len=210 | text="寒风卷起战旗，猎猎如血。项羽立于高台，目光如刀扫过沙盘上那条蜿蜒的敌军行迹。他猛地一掌拍碎案几，木屑飞溅：‘刘邦小儿，竟敢绕道断我粮道！’ 士兵们齐声怒吼，战鼓轰鸣。然而就在千钧一发之际，远处火光忽明忽暗——是敌军设伏？还是诱敌之计？你眼中闪过一丝杀意，手已按在剑柄，却听见帐外传来马蹄急响，一名斥候跌撞而入：‘大王！粮道无恙，但有密使潜入我营，自称是韩信旧部，愿献奇谋！’ 乱局之中，真假难辨，而每一秒都可能改写战局。"
2025-09-28 21:39:48 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=83 | choice="召集群将，当众宣誓血盟，以气势压倒敌军士气" | node=85 | text_len=210 | image=http://127.0.0.1:8000/static/generated/ai_gen_0a4b8b0efafaea4950963e62bbd1194e.webp
2025-09-28 21:39:49 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_4abbd006899296c09e3d06de055b10f8.png (大小: 1563244 字节)

2025-09-28 21:39:49 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_4abbd006899296c09e3d06de055b10f8.webp 大小 99976 字节 (原始 1563244 字节, 压缩比 0.06)

2025-09-28 21:39:49 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_4abbd006899296c09e3d06de055b10f8.png

2025-09-28 21:39:49 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_4abbd006899296c09e3d06de055b10f8.webp

2025-09-28 21:39:49 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_4abbd006899296c09e3d06de055b10f8.webp

2025-09-28 21:39:49 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_4abbd006899296c09e3d06de055b10f8.webp

2025-09-28 21:39:49 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_4abbd006899296c09e3d06de055b10f8.webp
2025-09-28 21:39:49 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 21:39:49 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=83 | choice="亲率精骑突袭敌后，以雷霆之势斩断其运粮队首尾" | text_len=196 | text="寒风卷起战旗，猎猎作响。你凝视沙盘上那条悄然逼近的敌线，忽然冷笑一声，将铁戟重重插地。‘刘邦想抄我粮道？’你声音如裂帛，‘那便让他尝尝楚军的怒火——可别忘了，这天下，本就是我项羽用血与刀劈出来的！’你转身大步走向校场，命人擂鼓聚将，战马嘶鸣，士卒列阵如林。你立于高台，目光扫过一张张坚毅的脸庞，手中长戟指向天际：‘今夜，我们不攻，也不守——我们要让敌人知道，西楚的雷霆，从不在他们预料之中。’"
2025-09-28 21:39:49 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=83 | choice="亲率精骑突袭敌后，以雷霆之势斩断其运粮队首尾" | node=86 | text_len=196 | image=http://127.0.0.1:8000/static/generated/ai_gen_4abbd006899296c09e3d06de055b10f8.webp
2025-09-28 21:45:46 | INFO     | trace=4dd43fb3 user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=83 task=continue | api.story:continue_existing_story:610 - continue requestchoice=亲率精骑突袭敌后，以雷霆之势斩断其运粮队首尾
2025-09-28 21:45:46 | INFO     | trace=4dd43fb3 user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=86 task=continue | api.story:continue_existing_story:656 - continue node ready check
2025-09-28 21:45:46 | INFO     | api.story:_wait_for_node_complete:180 - [NodeComplete] 开始等待节点完全准备：node_id=86
2025-09-28 21:45:46 | INFO     | api.story:_wait_for_node_complete:233 - [NodeComplete] ✅ 节点完全准备就绪：node_id=86 (等待了 0.0 秒)
2025-09-28 21:45:46 | INFO     | trace=4dd43fb3 user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=86 task=continue | api.story:continue_existing_story:659 - continue node ready success
2025-09-28 21:45:46 | INFO     | trace=4dd43fb3 user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=86 task=continue | api.story:continue_existing_story:668 - continue speculation enqueue existingdepth=1
2025-09-28 21:45:46 | DEBUG    | trace=4dd43fb3 user=dbcf516e-6d67-4dca-ace8-0f168208849f session=19 node=86 task=speculation | core.speculation:enqueue:60 - [Speculation] enqueue PIPELINE session=19 node=86 depth=1
2025-09-28 21:45:46 | DEBUG    | core.speculation:_generate_children_pipeline:213 - [Speculation] pipeline generating 3 children for node=86
2025-09-28 21:45:46 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=86 | choice="下令全军偃旗息鼓，暗中调集精锐埋伏于山隘，以静制动诱敌深入"
2025-09-28 21:45:46 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=86 | choice="亲率百骑突袭敌营后方，以雷霆之势斩其主将首级，震慑群敌"
2025-09-28 21:45:46 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 下令全军偃旗息鼓，暗中调集精锐埋伏于山隘，以静制动诱敌深入
2025-09-28 21:45:46 | INFO     | core.speculation:_generate_child_node:245 - [Speculation] start | parent=86 | choice="命人伪造粮草溃败假象，引敌军轻敌冒进，再以火攻断其归路"
2025-09-28 21:45:46 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 亲率百骑突袭敌营后方，以雷霆之势斩其主将首级，震慑群敌
2025-09-28 21:45:46 | INFO     | backend.main:_static_probe:116 - [StaticProbe] generated hit path=/static/generated/ai_gen_4abbd006899296c09e3d06de055b10f8.webp -> C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_4abbd006899296c09e3d06de055b10f8.webp exists=True size=99976
2025-09-28 21:45:46 | DEBUG    | backend.main:get_response:41 - [Static:generated] request path=ai_gen_4abbd006899296c09e3d06de055b10f8.webp
2025-09-28 21:45:46 | INFO     | core.story_engine:continue_story:462 - 继续故事，用户选择: 命人伪造粮草溃败假象，引敌军轻敌冒进，再以火攻断其归路
2025-09-28 21:45:46 | INFO     | backend.main:get_response:44 - [Static:generated] status=200 path=ai_gen_4abbd006899296c09e3d06de055b10f8.webp
2025-09-28 21:45:50 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:45:50 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1800
2025-09-28 21:45:50 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=897 预览='{"text": "夜色如墨，寒风卷起楚军战旗，猎猎作响。你率三千精骑悄然出营，马蹄裹布，铁甲无声。前方十里，便是刘邦运粮队的必经之路——一条狭窄的山谷隘口。你下令全军潜伏于两侧山林，只待敌军首尾相接、阵型拉长之时，便如雷霆般自天而降。火把熄灭，唯有星月为引，战马低鸣，将士们紧握兵刃，呼吸凝滞。你立于高坡之上，目光如炬，手中长戟指向山谷深处：‘等他们走进来，就让这山涧，变成他们的葬身之地。’远处传来车轮碾过碎石的声响，越来越近……", "choices": [{"option": "命人点燃预先埋设的火油桶，制造混乱后突袭断头部队", "summary": "以烈焰扰乱敌军阵型，趁机斩杀前锋"'
2025-09-28 21:45:50 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=897 预览='{"text": "夜色如墨，寒风卷起楚军战旗，猎猎作响。你率三千精骑悄然出营，马蹄裹布，铁甲无声。前方十里，便是刘邦运粮队的必经之路——一条狭窄的山谷隘口。你下令全军潜伏于两侧山林，只待敌军首尾相接、阵型拉长之时，便如雷霆般自天而降。火把熄灭，唯有星月为引，战马低鸣，将士们紧握兵刃，呼吸凝滞。你立于高坡之上，目光如炬'
2025-09-28 21:45:50 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=897 预览='{"text": "夜色如墨，寒风卷起楚军战旗，猎猎作响。你率三千精骑悄然出营，马蹄裹布，铁甲无声。前方十里，便是刘邦运粮队的必经之路——一条狭窄的山谷隘口。你下令全军潜伏于两侧山林，只待敌军首尾相接、阵型拉长之时，便如雷霆般自天而降。火把熄灭，唯有星月为引，战马低鸣，将士们紧握兵刃，呼吸凝滞。你立于高坡之上，目光如炬'
2025-09-28 21:45:50 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=207
2025-09-28 21:45:50 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=207 preview="夜色如墨，寒风卷起楚军战旗，猎猎作响。你率三千精骑悄然出营，马蹄裹布，铁甲无声。前方十里，便是刘邦运粮队的必经之路——一条狭窄的山谷隘口。你下令全军潜伏于两侧山林，只待敌军首尾相接、阵型拉长之时，便如雷霆般自天而降。火把熄灭，唯有星月为引，战马低鸣，将士们紧握兵刃，呼吸凝滞。你立于高坡之上，目光如炬，手中长戟指向山谷深处：‘等他们走进来，就让这山涧，变成他们的葬身之地。’远处传来车轮碾过碎石的声响…"

2025-09-28 21:45:50 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，寒风卷起楚军战旗，猎猎作响。你率三千精骑悄然出营，马蹄裹布，铁甲无声。前方十里，便是刘邦运粮队的必经之路——一条狭窄的山谷隘口。你下令…"

2025-09-28 21:45:50 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜色如墨，寒风卷起楚军战...
2025-09-28 21:45:50 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:45:50 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1833
2025-09-28 21:45:50 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=924 预览='{"text": "夜如墨染，寒星隐现。你亲率三千铁骑，踏碎霜原，马蹄声如雷滚过荒野，仿佛千军万马奔腾于幽冥之间。火把在风中摇曳，映得你披风猎猎，长戟指向敌后那条蜿蜒的粮道。斥候传来密报：运粮队已至断崖谷口，前队正缓缓入谷，后队尚在山外。你冷笑一声，挥戟为令——‘以火为号，三更时分，杀入腹心！’战马嘶鸣，铁甲铿锵，三千精骑如黑潮般潜行于山脊暗影之中，只待雷霆一击。前方，是刘邦的命脉；身后，是西楚的生死。此刻，不是胜负，而是天意与胆魄的对决。", "choices": [{"option": "命轻骑佯攻山口，引敌主力出营，趁机从侧翼穿插突袭粮车", "summary": "以虚张声势诱敌，再以'
2025-09-28 21:45:50 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=924 预览='{"text": "夜如墨染，寒星隐现。你亲率三千铁骑，踏碎霜原，马蹄声如雷滚过荒野，仿佛千军万马奔腾于幽冥之间。火把在风中摇曳，映得你披风猎猎，长戟指向敌后那条蜿蜒的粮道。斥候传来密报：运粮队已至断崖谷口，前队正缓缓入谷，后队尚在山外。你冷笑一声，挥戟为令——‘以火为号，三更时分，杀入腹心！’战马嘶鸣，铁甲铿锵，三千'
2025-09-28 21:45:50 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=924 预览='{"text": "夜如墨染，寒星隐现。你亲率三千铁骑，踏碎霜原，马蹄声如雷滚过荒野，仿佛千军万马奔腾于幽冥之间。火把在风中摇曳，映得你披风猎猎，长戟指向敌后那条蜿蜒的粮道。斥候传来密报：运粮队已至断崖谷口，前队正缓缓入谷，后队尚在山外。你冷笑一声，挥戟为令——‘以火为号，三更时分，杀入腹心！’战马嘶鸣，铁甲铿锵，三千'
2025-09-28 21:45:50 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=212
2025-09-28 21:45:50 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=212 preview="夜如墨染，寒星隐现。你亲率三千铁骑，踏碎霜原，马蹄声如雷滚过荒野，仿佛千军万马奔腾于幽冥之间。火把在风中摇曳，映得你披风猎猎，长戟指向敌后那条蜿蜒的粮道。斥候传来密报：运粮队已至断崖谷口，前队正缓缓入谷，后队尚在山外。你冷笑一声，挥戟为令——‘以火为号，三更时分，杀入腹心！’战马嘶鸣，铁甲铿锵，三千精骑如黑潮般潜行于山脊暗影之中，只待雷霆一击。前方，是刘邦的命脉；身后，是西楚的生死。此刻，不是胜负…"

2025-09-28 21:45:50 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜如墨染，寒星隐现。你亲率三千铁骑，踏碎霜原，马蹄声如雷滚过荒野，仿佛千军万马奔腾于幽冥之间。火把在风中摇曳，映得你披风猎猎，长戟指向敌后那条蜿…"

2025-09-28 21:45:50 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜如墨染，寒星隐现。你亲...
2025-09-28 21:45:51 | INFO     | core.llm_clients:generate:240 - [JSON-in-JSON] 检测到并成功解析了嵌套的JSON响应。
2025-09-28 21:45:51 | INFO     | core.llm_clients:generate:250 - 模型生成成功 - 模型: qwen-flash-2025-07-28, tokens使用: 1869
2025-09-28 21:45:51 | INFO     | core.story_engine:continue_story:492 - [LLM raw][continue] 长度=950 预览='{"text": "夜如墨染，寒星隐现。你率三千铁骑自密林疾驰而出，马蹄踏碎霜雪，战旗如血刃撕裂黑暗。前方火光摇曳，正是刘邦运粮队的辎重行营——粮车连绵如龙，守卫疏于防备。你低喝一声，亲执长戟，率军如雷霆般从侧翼突入，刀锋划破寂静，火把应声熄灭。敌军惊乱，尚未列阵，已有数辆粮车轰然倾覆，烈焰腾空而起，映红半边天幕。你纵马冲入敌阵中央，怒吼震落树梢残雪，一戟劈开敌将头盔，血花溅上你的面甲。‘楚军在此！’这声咆哮如雷贯耳，令敌胆俱裂。然而，你亦知此战虽胜，却已暴露行踪，刘邦必遣精兵追击，后方大营恐成孤岛。", "choices": [{"option": "命人焚烧剩余粮草，引燃整条补给线，再率部'
2025-09-28 21:45:51 | DEBUG    | core.story_engine:_extract_json:203 - [JSON] 原始长度=950 预览='{"text": "夜如墨染，寒星隐现。你率三千铁骑自密林疾驰而出，马蹄踏碎霜雪，战旗如血刃撕裂黑暗。前方火光摇曳，正是刘邦运粮队的辎重行营——粮车连绵如龙，守卫疏于防备。你低喝一声，亲执长戟，率军如雷霆般从侧翼突入，刀锋划破寂静，火把应声熄灭。敌军惊乱，尚未列阵，已有数辆粮车轰然倾覆，烈焰腾空而起，映红半边天幕。你纵'
2025-09-28 21:45:51 | DEBUG    | core.story_engine:_extract_json:246 - [JSON] 括号配对提取成功，长度=950 预览='{"text": "夜如墨染，寒星隐现。你率三千铁骑自密林疾驰而出，马蹄踏碎霜雪，战旗如血刃撕裂黑暗。前方火光摇曳，正是刘邦运粮队的辎重行营——粮车连绵如龙，守卫疏于防备。你低喝一声，亲执长戟，率军如雷霆般从侧翼突入，刀锋划破寂静，火把应声熄灭。敌军惊乱，尚未列阵，已有数辆粮车轰然倾覆，烈焰腾空而起，映红半边天幕。你纵'
2025-09-28 21:45:51 | INFO     | core.image_service:get_image_for_story:180 - [ImageService] start | text_len=243
2025-09-28 21:45:51 | INFO     | core.image_service:_log:84 - [AIImageGen] start | text_len=243 preview="夜如墨染，寒星隐现。你率三千铁骑自密林疾驰而出，马蹄踏碎霜雪，战旗如血刃撕裂黑暗。前方火光摇曳，正是刘邦运粮队的辎重行营——粮车连绵如龙，守卫疏于防备。你低喝一声，亲执长戟，率军如雷霆般从侧翼突入，刀锋划破寂静，火把应声熄灭。敌军惊乱，尚未列阵，已有数辆粮车轰然倾覆，烈焰腾空而起，映红半边天幕。你纵马冲入敌阵中央，怒吼震落树梢残雪，一戟劈开敌将头盔，血花溅上你的面甲。‘楚军在此！’这声咆哮如雷贯耳…"

2025-09-28 21:45:51 | INFO     | core.image_service:_log:84 - [AIImageGen] prompt | value="Create a cinematic and atmospheric image that captures the essence of this story scene: 夜如墨染，寒星隐现。你率三千铁骑自密林疾驰而出，马蹄踏碎霜雪，战旗如血刃撕裂黑暗。前方火光摇曳，正是刘邦运粮队的辎重行营——粮车连绵如龙，守卫疏…"

2025-09-28 21:45:51 | INFO     | core.image_generation:_generate_oneapi:107 - 发送图像生成请求，模型: nano-banana, 提示词: Create a cinematic and atmospheric image that captures the essence of this story scene: 夜如墨染，寒星隐现。你率...
2025-09-28 21:46:02 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 774 (attempt 1/2)
2025-09-28 21:46:02 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=131

2025-09-28 21:46:02 | WARNING  | core.image_service:_extract_image_url:151 - 无法从AI响应中提取图像URL: Here's an image that aims to capture the dramatic and cinematic essence of the scene you described: 

|>
请注意,回复提前终止,原因:IMAGE_SAFETY...
2025-09-28 21:46:02 | WARNING  | core.image_service:generate_image_realtime:118 - [AIImageGen] no_url | fallback=random
2025-09-28 21:46:02 | INFO     | core.image_service:get_random_image_from_library:48 - [ImageLibrary] select | size=6
2025-09-28 21:46:02 | INFO     | core.image_service:get_random_image_from_library:61 - [ImageLibrary] result | file=magic_forest.jpg | url=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 21:46:02 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 21:46:02 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 21:46:02 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=86 | choice="命人伪造粮草溃败假象，引敌军轻敌冒进，再以火攻断其归路" | text_len=243 | text="夜如墨染，寒星隐现。你率三千铁骑自密林疾驰而出，马蹄踏碎霜雪，战旗如血刃撕裂黑暗。前方火光摇曳，正是刘邦运粮队的辎重行营——粮车连绵如龙，守卫疏于防备。你低喝一声，亲执长戟，率军如雷霆般从侧翼突入，刀锋划破寂静，火把应声熄灭。敌军惊乱，尚未列阵，已有数辆粮车轰然倾覆，烈焰腾空而起，映红半边天幕。你纵马冲入敌阵中央，怒吼震落树梢残雪，一戟劈开敌将头盔，血花溅上你的面甲。‘楚军在此！’这声咆哮如雷贯耳，令敌胆俱裂。然而，你亦知此战虽胜，却已暴露行踪，刘邦必遣精兵追击，后方大营恐成孤岛。"
2025-09-28 21:46:02 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=86 | choice="命人伪造粮草溃败假象，引敌军轻敌冒进，再以火攻断其归路" | node=87 | text_len=243 | image=http://127.0.0.1:8000/static/magic_forest.jpg
2025-09-28 21:46:02 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:46:02 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:46:02 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759067162471_926.png
2025-09-28 21:46:02 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759067162471_926.png

2025-09-28 21:46:02 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759067162471_926.png

2025-09-28 21:46:03 | INFO     | core.image_generation:_generate_oneapi:128 - 图像生成成功，响应长度: 705 (attempt 1/2)
2025-09-28 21:46:03 | INFO     | core.image_service:_log:84 - [AIImageGen] api_success | response_len=73

2025-09-28 21:46:03 | DEBUG    | core.image_service:_extract_image_url:148 - 从AI响应中提取到URL: https://cloudflarer2.nananobanana.com/png/1759067162633_764.png
2025-09-28 21:46:03 | INFO     | core.image_service:_log:84 - [AIImageGen] url | value=https://cloudflarer2.nananobanana.com/png/1759067162633_764.png

2025-09-28 21:46:03 | INFO     | core.image_storage:save_ai_image:55 - 开始下载AI图像: https://cloudflarer2.nananobanana.com/png/1759067162633_764.png

2025-09-28 21:46:13 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_b999720e72ce83027758e488279469de.png (大小: 1562013 字节)

2025-09-28 21:46:13 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_b999720e72ce83027758e488279469de.webp 大小 104800 字节 (原始 1562013 字节, 压缩比 0.07)

2025-09-28 21:46:13 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_b999720e72ce83027758e488279469de.png

2025-09-28 21:46:13 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_b999720e72ce83027758e488279469de.webp

2025-09-28 21:46:13 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_b999720e72ce83027758e488279469de.webp

2025-09-28 21:46:13 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_b999720e72ce83027758e488279469de.webp

2025-09-28 21:46:13 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_b999720e72ce83027758e488279469de.webp
2025-09-28 21:46:13 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 21:46:13 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=86 | choice="下令全军偃旗息鼓，暗中调集精锐埋伏于山隘，以静制动诱敌深入" | text_len=207 | text="夜色如墨，寒风卷起楚军战旗，猎猎作响。你率三千精骑悄然出营，马蹄裹布，铁甲无声。前方十里，便是刘邦运粮队的必经之路——一条狭窄的山谷隘口。你下令全军潜伏于两侧山林，只待敌军首尾相接、阵型拉长之时，便如雷霆般自天而降。火把熄灭，唯有星月为引，战马低鸣，将士们紧握兵刃，呼吸凝滞。你立于高坡之上，目光如炬，手中长戟指向山谷深处：‘等他们走进来，就让这山涧，变成他们的葬身之地。’远处传来车轮碾过碎石的声响，越来越近……"
2025-09-28 21:46:13 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=86 | choice="下令全军偃旗息鼓，暗中调集精锐埋伏于山隘，以静制动诱敌深入" | node=88 | text_len=207 | image=http://127.0.0.1:8000/static/generated/ai_gen_b999720e72ce83027758e488279469de.webp
2025-09-28 21:46:14 | INFO     | core.image_storage:save_ai_image:101 - ✅ 图像下载成功: ai_gen_050471d39c1cc2152ae4c26e3c8396e4.png (大小: 1607837 字节)

2025-09-28 21:46:14 | INFO     | core.image_storage:_convert_to_webp:178 - [WebP] 转换成功: ai_gen_050471d39c1cc2152ae4c26e3c8396e4.webp 大小 117536 字节 (原始 1607837 字节, 压缩比 0.07)

2025-09-28 21:46:14 | DEBUG    | core.image_storage:_convert_to_webp:183 - [WebP] 已删除原始文件: ai_gen_050471d39c1cc2152ae4c26e3c8396e4.png

2025-09-28 21:46:14 | INFO     | core.image_storage:save_ai_image:108 - [图像访问URL]: http://127.0.0.1:8000/static/generated/ai_gen_050471d39c1cc2152ae4c26e3c8396e4.webp

2025-09-28 21:46:14 | INFO     | core.image_storage:save_ai_image:109 - [本地文件路径]: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images\ai_gen_050471d39c1cc2152ae4c26e3c8396e4.webp

2025-09-28 21:46:14 | INFO     | core.image_service:_log:84 - [AIImageGen] saved | path=http://127.0.0.1:8000/static/generated/ai_gen_050471d39c1cc2152ae4c26e3c8396e4.webp

2025-09-28 21:46:14 | INFO     | core.image_service:get_image_for_story:191 - [ImageService] success | source=ai | url=http://127.0.0.1:8000/static/generated/ai_gen_050471d39c1cc2152ae4c26e3c8396e4.webp
2025-09-28 21:46:14 | INFO     | core.story_engine:continue_story:573 - 故事继续生成成功
2025-09-28 21:46:14 | INFO     | core.speculation:_generate_child_node:261 - [Speculation] story | parent=86 | choice="亲率百骑突袭敌营后方，以雷霆之势斩其主将首级，震慑群敌" | text_len=212 | text="夜如墨染，寒星隐现。你亲率三千铁骑，踏碎霜原，马蹄声如雷滚过荒野，仿佛千军万马奔腾于幽冥之间。火把在风中摇曳，映得你披风猎猎，长戟指向敌后那条蜿蜒的粮道。斥候传来密报：运粮队已至断崖谷口，前队正缓缓入谷，后队尚在山外。你冷笑一声，挥戟为令——‘以火为号，三更时分，杀入腹心！’战马嘶鸣，铁甲铿锵，三千精骑如黑潮般潜行于山脊暗影之中，只待雷霆一击。前方，是刘邦的命脉；身后，是西楚的生死。此刻，不是胜负，而是天意与胆魄的对决。"
2025-09-28 21:46:14 | INFO     | core.speculation:_generate_child_node:299 - [Speculation] complete | parent=86 | choice="亲率百骑突袭敌营后方，以雷霆之势斩其主将首级，震慑群敌" | node=89 | text_len=212 | image=http://127.0.0.1:8000/static/generated/ai_gen_050471d39c1cc2152ae4c26e3c8396e4.webp
2025-09-28 21:46:27 | INFO     | backend.main:shutdown_event:251 - 重生之我是……API服务关闭
2025-09-28 21:46:28 | INFO     | core.image_service:_load_image_library:41 - 成功从 'C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images' 载入 6 张预置图片（已排除错误占位符）
2025-09-28 21:46:29 | DEBUG    | core.llm_clients:__init__:81 - [CLIENT PARAMS] {'api_key': 'sk-e2eae7aa4d794271890b0772c963b102', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'default_headers': {'User-Agent': 'PostmanRuntime/7.47.1', 'Accept': '*/*', 'Cache-Control': 'no-cache', 'Accept-Encoding': 'gzip, deflate, br', 'Connection': 'keep-alive'}}
2025-09-28 21:46:29 | INFO     | core.llm_clients:__init__:84 - LLM客户端初始化成功 - 提供商: OpenAI (兼容层)
2025-09-28 21:46:29 | INFO     | core.llm_clients:__init__:89 - 模型: qwen-flash-2025-07-28
2025-09-28 21:46:29 | INFO     | core.llm_clients:__init__:90 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
2025-09-28 21:46:29 | INFO     | core.story_engine:__init__:25 - 故事引擎初始化完成
2025-09-28 21:46:29 | INFO     | database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:46:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:46:30 | INFO     | core.speculation:__init__:29 - [Speculation] enabled depth=1 choice_workers=9 mode=thread-per-enqueue (no global pool)
2025-09-28 21:46:30 | INFO     | backend.main:<module>:75 - AI生成图像服务已挂载到 /static/generated 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\generated_images (热重载兼容模式)
2025-09-28 21:46:30 | INFO     | backend.main:<module>:78 - [静态文件服务] 后端完整访问地址示例: http://127.0.0.1:8000/static/generated/xxx.png
2025-09-28 21:46:30 | INFO     | backend.main:<module>:90 - 静态文件服务已挂载到 /static 路径: C:\Users\SuperV\Desktop\ai_game\rebirth_game\assets\images
2025-09-28 21:46:30 | INFO     | backend.main:<module>:101 - [RouteDump] #0 type=Route path=/openapi.json
2025-09-28 21:46:30 | INFO     | backend.main:<module>:101 - [RouteDump] #1 type=Route path=/docs
2025-09-28 21:46:30 | INFO     | backend.main:<module>:101 - [RouteDump] #2 type=Route path=/docs/oauth2-redirect
2025-09-28 21:46:30 | INFO     | backend.main:<module>:101 - [RouteDump] #3 type=Route path=/redoc
2025-09-28 21:46:30 | INFO     | backend.main:<module>:101 - [RouteDump] #4 type=Mount path=/static/generated
2025-09-28 21:46:30 | INFO     | backend.main:<module>:101 - [RouteDump] #5 type=Mount path=/static
2025-09-28 21:46:30 | INFO     | backend.main:_run_alembic_cmd:225 - Running Alembic: D:\python3.11\python.exe -m alembic upgrade head
2025-09-28 21:46:30 | INFO     | backend.database.base:<module>:24 - 数据库配置: vendor=postgresql, url=postgresql+psycopg2://rebirth:StrongPass%21@127.0.0.1:5432/rebirth
2025-09-28 21:46:30 | ERROR    | backend.main:_run_alembic_cmd:229 - Alembic migration failed: Command '['D:\\python3.11\\python.exe', '-m', 'alembic', 'upgrade', 'head']' returned non-zero exit status 1.
2025-09-28 21:46:30 | INFO     | backend.main:startup_event:238 - 重生之我是……API服务启动
2025-09-28 21:46:30 | INFO     | backend.main:startup_event:239 - 调试模式: True
2025-09-28 21:46:30 | INFO     | backend.main:startup_event:244 - 当前使用模型: qwen-flash-2025-07-28
2025-09-28 21:46:30 | INFO     | backend.main:startup_event:245 - 模型API地址: https://dashscope.aliyuncs.com/compatible-mode/v1
